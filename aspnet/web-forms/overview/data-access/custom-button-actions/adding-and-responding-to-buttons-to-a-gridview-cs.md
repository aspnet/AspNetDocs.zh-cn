---
uid: web-forms/overview/data-access/custom-button-actions/adding-and-responding-to-buttons-to-a-gridview-cs
title: 添加和响应 GridView 的按钮（C#） |Microsoft Docs
author: rick-anderson
description: 在本教程中，我们将介绍如何将自定义按钮添加到模板以及 GridView 或 DetailsView 控件的字段。 特别是，我们将 l
ms.author: riande
ms.date: 09/13/2006
ms.assetid: 128fdb5f-4c5e-42b5-b485-f3aee90a8e38
msc.legacyurl: /web-forms/overview/data-access/custom-button-actions/adding-and-responding-to-buttons-to-a-gridview-cs
msc.type: authoredcontent
ms.openlocfilehash: 5c87386e4fe2c53b39162071689f2522dcc6c7ac
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/06/2020
ms.locfileid: "78442418"
---
# <a name="adding-and-responding-to-buttons-to-a-gridview-c"></a><span data-ttu-id="d67c7-104">添加和响应 GridView 的按钮 (C#)</span><span class="sxs-lookup"><span data-stu-id="d67c7-104">Adding and Responding to Buttons to a GridView (C#)</span></span>

<span data-ttu-id="d67c7-105">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="d67c7-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="d67c7-106">[下载示例应用](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_28_CS.exe)或[下载 PDF](adding-and-responding-to-buttons-to-a-gridview-cs/_static/datatutorial28cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="d67c7-106">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_28_CS.exe) or [Download PDF](adding-and-responding-to-buttons-to-a-gridview-cs/_static/datatutorial28cs1.pdf)</span></span>

> <span data-ttu-id="d67c7-107">在本教程中，我们将介绍如何将自定义按钮添加到模板以及 GridView 或 DetailsView 控件的字段。</span><span class="sxs-lookup"><span data-stu-id="d67c7-107">In this tutorial we'll look at how to add custom buttons, both to a template and to the fields of a GridView or DetailsView control.</span></span> <span data-ttu-id="d67c7-108">具体而言，我们将生成一个接口，该接口具有允许用户逐页浏览供应商的 FormView。</span><span class="sxs-lookup"><span data-stu-id="d67c7-108">In particular, we'll build an interface that has a FormView that allows the user to page through the suppliers.</span></span>

## <a name="introduction"></a><span data-ttu-id="d67c7-109">简介</span><span class="sxs-lookup"><span data-stu-id="d67c7-109">Introduction</span></span>

<span data-ttu-id="d67c7-110">虽然很多报表方案都涉及对报表数据的只读访问，但报表包含根据所显示的数据执行操作的能力并不少见。</span><span class="sxs-lookup"><span data-stu-id="d67c7-110">While many reporting scenarios involve read-only access to the report data, it's not uncommon for reports to include the ability to perform actions based upon the data displayed.</span></span> <span data-ttu-id="d67c7-111">通常这涉及到使用报表中显示的每个记录添加按钮、LinkButton 或 ImageButton Web 控件，在单击此控件时，将导致回发并调用某些服务器端代码。</span><span class="sxs-lookup"><span data-stu-id="d67c7-111">Typically this involved adding a Button, LinkButton, or ImageButton Web control with each record displayed in the report that, when clicked, causes a postback and invokes some server-side code.</span></span> <span data-ttu-id="d67c7-112">逐记录编辑和删除数据是最常见的示例。</span><span class="sxs-lookup"><span data-stu-id="d67c7-112">Editing and deleting the data on a record-by-record basis is the most common example.</span></span> <span data-ttu-id="d67c7-113">事实上，正如我们所看到的，从[插入、更新和删除数据](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)教程的概述开始，编辑和删除很常见，因为 GridView、DetailsView 和 FormView 控件可以支持此类功能，而无需编写一行代码。</span><span class="sxs-lookup"><span data-stu-id="d67c7-113">In fact, as we saw starting with the [Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial, editing and deleting is so common that the GridView, DetailsView, and FormView controls can support such functionality without the need for writing a single line of code.</span></span>

<span data-ttu-id="d67c7-114">除了 "编辑" 和 "删除" 按钮外，GridView、DetailsView 和 FormView 控件还可以包含按钮、LinkButtons 或 ImageButtons，在单击该按钮时，将执行一些自定义服务器端逻辑。</span><span class="sxs-lookup"><span data-stu-id="d67c7-114">In addition to Edit and Delete buttons, the GridView, DetailsView, and FormView controls can also include Buttons, LinkButtons, or ImageButtons that, when clicked, perform some custom server-side logic.</span></span> <span data-ttu-id="d67c7-115">在本教程中，我们将介绍如何将自定义按钮添加到模板以及 GridView 或 DetailsView 控件的字段。</span><span class="sxs-lookup"><span data-stu-id="d67c7-115">In this tutorial we'll look at how to add custom buttons, both to a template and to the fields of a GridView or DetailsView control.</span></span> <span data-ttu-id="d67c7-116">具体而言，我们将生成一个接口，该接口具有允许用户逐页浏览供应商的 FormView。</span><span class="sxs-lookup"><span data-stu-id="d67c7-116">In particular, we'll build an interface that has a FormView that allows the user to page through the suppliers.</span></span> <span data-ttu-id="d67c7-117">对于指定的供应商，FormView 将显示有关该供应商的信息以及一个按钮 Web 控件，如果单击此控件，则会将其所有关联产品标记为已停用。</span><span class="sxs-lookup"><span data-stu-id="d67c7-117">For a given supplier, the FormView will show information about the supplier along with a Button Web control that, if clicked, will mark all of their associated products as discontinued.</span></span> <span data-ttu-id="d67c7-118">此外，GridView 列出了所选供应商提供的产品，其中每行都包含 "增加价格" 和 "折扣价格" 按钮，如果单击该按钮，则将产品的 `UnitPrice` 提高10% （参见图1）。</span><span class="sxs-lookup"><span data-stu-id="d67c7-118">Additionally, a GridView lists those products provided by the selected supplier, with each row containing Increase Price and Discount Price Buttons that, if clicked, raise or reduce the product's `UnitPrice` by 10% (see Figure 1).</span></span>

<span data-ttu-id="d67c7-119">[![FormView 和 GridView 都包含执行自定义操作的按钮](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image2.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="d67c7-119">[![Both the FormView and GridView Contain Buttons That Perform Custom Actions](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image2.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image1.png)</span></span>

<span data-ttu-id="d67c7-120">**图 1**： FormView 和 GridView 都包含执行自定义操作的按钮（[单击查看完全尺寸的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="d67c7-120">**Figure 1**: Both the FormView and GridView Contain Buttons That Perform Custom Actions ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image3.png))</span></span>

## <a name="step-1-adding-the-button-tutorial-web-pages"></a><span data-ttu-id="d67c7-121">步骤1：添加按钮教程网页</span><span class="sxs-lookup"><span data-stu-id="d67c7-121">Step 1: Adding the Button Tutorial Web Pages</span></span>

<span data-ttu-id="d67c7-122">在介绍如何添加自定义按钮之前，首先请花点时间在我们的网站项目中创建 ASP.NET 页面，我们将在本教程中使用这些页面。</span><span class="sxs-lookup"><span data-stu-id="d67c7-122">Before we look at how to add a custom buttons, let's first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial.</span></span> <span data-ttu-id="d67c7-123">首先添加一个名为 `CustomButtons`的新文件夹。</span><span class="sxs-lookup"><span data-stu-id="d67c7-123">Start by adding a new folder named `CustomButtons`.</span></span> <span data-ttu-id="d67c7-124">接下来，将以下两个 ASP.NET 页面添加到该文件夹，确保将每个页面与 `Site.master` 母版页关联：</span><span class="sxs-lookup"><span data-stu-id="d67c7-124">Next, add the following two ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `CustomButtons.aspx`

![为自定义按钮相关教程添加 ASP.NET 页](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image4.png)

<span data-ttu-id="d67c7-126">**图 2**：为自定义按钮相关教程添加 ASP.NET 页</span><span class="sxs-lookup"><span data-stu-id="d67c7-126">**Figure 2**: Add the ASP.NET Pages for the Custom Buttons-Related Tutorials</span></span>

<span data-ttu-id="d67c7-127">与在其他文件夹中一样，`CustomButtons` 文件夹中的 `Default.aspx` 会在其部分列出教程。</span><span class="sxs-lookup"><span data-stu-id="d67c7-127">Like in the other folders, `Default.aspx` in the `CustomButtons` folder will list the tutorials in its section.</span></span> <span data-ttu-id="d67c7-128">请记住，`SectionLevelTutorialListing.ascx` 用户控件提供此功能。</span><span class="sxs-lookup"><span data-stu-id="d67c7-128">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="d67c7-129">因此，通过将此用户控件从解决方案资源管理器拖到页面的设计视图上，将其添加到 `Default.aspx`。</span><span class="sxs-lookup"><span data-stu-id="d67c7-129">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page's Design view.</span></span>

<span data-ttu-id="d67c7-130">[![将 SectionLevelTutorialListing 用户控件添加到 default.aspx](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image6.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="d67c7-130">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image6.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image5.png)</span></span>

<span data-ttu-id="d67c7-131">**图 3**：将 `SectionLevelTutorialListing.ascx` 用户控件添加到 `Default.aspx` （[单击以查看完全大小的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image7.png)）</span><span class="sxs-lookup"><span data-stu-id="d67c7-131">**Figure 3**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image7.png))</span></span>

<span data-ttu-id="d67c7-132">最后，将页面作为条目添加到 `Web.sitemap` 文件中。</span><span class="sxs-lookup"><span data-stu-id="d67c7-132">Lastly, add the pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="d67c7-133">具体而言，在分页和排序 `<siteMapNode>`之后添加以下标记：</span><span class="sxs-lookup"><span data-stu-id="d67c7-133">Specifically, add the following markup after the Paging and Sorting `<siteMapNode>`:</span></span>

[!code-xml[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample1.xml)]

<span data-ttu-id="d67c7-134">更新 `Web.sitemap`后，请花点时间通过浏览器查看教程网站。</span><span class="sxs-lookup"><span data-stu-id="d67c7-134">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="d67c7-135">左侧菜单现在包含用于编辑、插入和删除教程的项。</span><span class="sxs-lookup"><span data-stu-id="d67c7-135">The menu on the left now includes items for the editing, inserting, and deleting tutorials.</span></span>

![站点映射现在包含用于自定义按钮教程的条目](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image8.png)

<span data-ttu-id="d67c7-137">**图 4**：站点地图现在包含用于自定义按钮教程的条目</span><span class="sxs-lookup"><span data-stu-id="d67c7-137">**Figure 4**: The Site Map Now Includes the Entry for the Custom Buttons Tutorial</span></span>

## <a name="step-2-adding-a-formview-that-lists-the-suppliers"></a><span data-ttu-id="d67c7-138">步骤2：添加列出供应商的 FormView</span><span class="sxs-lookup"><span data-stu-id="d67c7-138">Step 2: Adding a FormView that Lists the Suppliers</span></span>

<span data-ttu-id="d67c7-139">让我们通过添加列出供应商的 FormView 开始学习本教程。</span><span class="sxs-lookup"><span data-stu-id="d67c7-139">Let's get started with this tutorial by adding the FormView that lists the suppliers.</span></span> <span data-ttu-id="d67c7-140">如简介中所述，此 FormView 允许用户逐页浏览供应商，并显示 GridView 中供应商提供的产品。</span><span class="sxs-lookup"><span data-stu-id="d67c7-140">As discussed in the Introduction, this FormView will allow the user to page through the suppliers, showing the products provided by the supplier in a GridView.</span></span> <span data-ttu-id="d67c7-141">此外，此 FormView 还包括一个按钮，单击该按钮时，会将供应商的所有产品标记为不再使用。</span><span class="sxs-lookup"><span data-stu-id="d67c7-141">Additionally, this FormView will include a Button that, when clicked, will mark all of the supplier's products as discontinued.</span></span> <span data-ttu-id="d67c7-142">在我们考虑将自定义按钮添加到 FormView 之前，首先请创建 FormView，使其显示供应商信息。</span><span class="sxs-lookup"><span data-stu-id="d67c7-142">Before we concern ourselves with adding the custom button to the FormView, let's first just create the FormView so that it displays the supplier information.</span></span>

<span data-ttu-id="d67c7-143">首先打开 `CustomButtons` 文件夹中的 "`CustomButtons.aspx`" 页。</span><span class="sxs-lookup"><span data-stu-id="d67c7-143">Start by opening the `CustomButtons.aspx` page in the `CustomButtons` folder.</span></span> <span data-ttu-id="d67c7-144">将 FormView 从工具箱拖到设计器上，将其添加到页面，并将其 `ID` 属性设置为 `Suppliers`。</span><span class="sxs-lookup"><span data-stu-id="d67c7-144">Add a FormView to the page by dragging it from the Toolbox onto the Designer and set its `ID` property to `Suppliers`.</span></span> <span data-ttu-id="d67c7-145">在 FormView 的智能标记中，选择创建名为 `SuppliersDataSource`的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="d67c7-145">From the FormView's smart tag, opt to create a new ObjectDataSource named `SuppliersDataSource`.</span></span>

<span data-ttu-id="d67c7-146">[![创建一个名为 SuppliersDataSource 的新 ObjectDataSource](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image10.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="d67c7-146">[![Create a New ObjectDataSource Named SuppliersDataSource](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image10.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image9.png)</span></span>

<span data-ttu-id="d67c7-147">**图 5**：创建名为 `SuppliersDataSource` 的新 ObjectDataSource （[单击以查看完全大小的映像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image11.png)）</span><span class="sxs-lookup"><span data-stu-id="d67c7-147">**Figure 5**: Create a New ObjectDataSource Named `SuppliersDataSource` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image11.png))</span></span>

<span data-ttu-id="d67c7-148">配置此新 ObjectDataSource，使其从 `SuppliersBLL` 类的 `GetSuppliers()` 方法进行查询（参见图6）。</span><span class="sxs-lookup"><span data-stu-id="d67c7-148">Configure this new ObjectDataSource such that it queries from the `SuppliersBLL` class's `GetSuppliers()` method (see Figure 6).</span></span> <span data-ttu-id="d67c7-149">由于此 FormView 不提供更新供应商信息的接口，因此请从 "更新" 选项卡的下拉列表中选择 "（无）" 选项。</span><span class="sxs-lookup"><span data-stu-id="d67c7-149">Since this FormView does not provide an interface for updating the supplier information, select the (None) option from the drop-down list in the UPDATE tab.</span></span>

<span data-ttu-id="d67c7-150">[![将数据源配置为使用 SuppliersBLL Class s GetSuppliers （）方法](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image13.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="d67c7-150">[![Configure the Data Source to use the SuppliersBLL Class s GetSuppliers() Method](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image13.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image12.png)</span></span>

<span data-ttu-id="d67c7-151">**图 6**：将数据源配置为使用 `SuppliersBLL` 类的 `GetSuppliers()` 方法（[单击以查看完全大小的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image14.png)）</span><span class="sxs-lookup"><span data-stu-id="d67c7-151">**Figure 6**: Configure the Data Source to use the `SuppliersBLL` Class's `GetSuppliers()` Method ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image14.png))</span></span>

<span data-ttu-id="d67c7-152">配置 ObjectDataSource 后，Visual Studio 将为 FormView 生成 `InsertItemTemplate`、`EditItemTemplate`和 `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="d67c7-152">After configuring the ObjectDataSource, Visual Studio will generate an `InsertItemTemplate`, `EditItemTemplate`, and `ItemTemplate` for the FormView.</span></span> <span data-ttu-id="d67c7-153">删除 `InsertItemTemplate`，并 `EditItemTemplate` 并修改 `ItemTemplate`，使其只显示供应商的公司名称和电话号码。</span><span class="sxs-lookup"><span data-stu-id="d67c7-153">Remove the `InsertItemTemplate` and `EditItemTemplate` and modify the `ItemTemplate` so that it displays just the supplier's company name and phone number.</span></span> <span data-ttu-id="d67c7-154">最后，通过选中 "启用分页" 复选框（或通过将其 `AllowPaging` 属性设置为 `True`），启用 FormView 的分页支持。</span><span class="sxs-lookup"><span data-stu-id="d67c7-154">Finally, turn on paging support for the FormView by checking the Enable Paging checkbox from its smart tag (or by setting its `AllowPaging` property to `True`).</span></span> <span data-ttu-id="d67c7-155">完成这些更改后，页面的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="d67c7-155">After these changes your page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample2.aspx)]

<span data-ttu-id="d67c7-156">图7显示了通过浏览器查看 CustomButtons 页。</span><span class="sxs-lookup"><span data-stu-id="d67c7-156">Figure 7 shows the CustomButtons.aspx page when viewed through a browser.</span></span>

<span data-ttu-id="d67c7-157">[![FormView 列出当前所选供应商的 "公司名称" 和 "电话" 字段](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image16.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="d67c7-157">[![The FormView Lists the CompanyName and Phone Fields from the Currently Selected Supplier](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image16.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image15.png)</span></span>

<span data-ttu-id="d67c7-158">**图 7**： FormView 列出了当前所选供应商的 "`CompanyName`" 和 "`Phone`" 字段（[单击以查看完全大小的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image17.png)）</span><span class="sxs-lookup"><span data-stu-id="d67c7-158">**Figure 7**: The FormView Lists the `CompanyName` and `Phone` Fields from the Currently Selected Supplier ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image17.png))</span></span>

## <a name="step-3-adding-a-gridview-that-lists-the-selected-suppliers-products"></a><span data-ttu-id="d67c7-159">步骤3：添加一个 GridView，其中列出了所选供应商的产品</span><span class="sxs-lookup"><span data-stu-id="d67c7-159">Step 3: Adding a GridView that Lists the Selected Supplier's Products</span></span>

<span data-ttu-id="d67c7-160">在将 "停止所有产品" 按钮添加到 FormView 的模板之前，让我们先在 FormView 下添加一个 GridView，其中列出了所选供应商提供的产品。</span><span class="sxs-lookup"><span data-stu-id="d67c7-160">Before we add the Discontinue All Products Button to the FormView's template, let's first add a GridView beneath the FormView that lists the products provided by the selected supplier.</span></span> <span data-ttu-id="d67c7-161">若要实现此目的，请将 GridView 添加到页面，将其 `ID` 属性设置为 `SuppliersProducts`，然后添加名为 `SuppliersProductsDataSource`的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="d67c7-161">To accomplish this, add a GridView to the page, set its `ID` property to `SuppliersProducts`, and add a new ObjectDataSource named `SuppliersProductsDataSource`.</span></span>

<span data-ttu-id="d67c7-162">[![创建一个名为 SuppliersProductsDataSource 的新 ObjectDataSource](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image19.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="d67c7-162">[![Create a New ObjectDataSource Named SuppliersProductsDataSource](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image19.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image18.png)</span></span>

<span data-ttu-id="d67c7-163">**图 8**：创建名为 `SuppliersProductsDataSource` 的新 ObjectDataSource （[单击以查看完全大小的映像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image20.png)）</span><span class="sxs-lookup"><span data-stu-id="d67c7-163">**Figure 8**: Create a New ObjectDataSource Named `SuppliersProductsDataSource` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image20.png))</span></span>

<span data-ttu-id="d67c7-164">将此 ObjectDataSource 配置为使用 ProductsBLL 类的 `GetProductsBySupplierID(supplierID)` 方法（请参阅图9）。</span><span class="sxs-lookup"><span data-stu-id="d67c7-164">Configure this ObjectDataSource to use the ProductsBLL class's `GetProductsBySupplierID(supplierID)` method (see Figure 9).</span></span> <span data-ttu-id="d67c7-165">尽管此 GridView 允许调整产品的价格，但它不会使用来自 GridView 的内置编辑或删除功能。</span><span class="sxs-lookup"><span data-stu-id="d67c7-165">While this GridView will allow for a product's price to be adjusted, it won't be using the built-in editing or deleting features from the GridView.</span></span> <span data-ttu-id="d67c7-166">因此，可以将该下拉列表设置为 "（无）" 作为 ObjectDataSource 的 "更新"、"插入" 和 "删除" 选项卡。</span><span class="sxs-lookup"><span data-stu-id="d67c7-166">Therefore, we can set the drop-down list to (None) for the ObjectDataSource's UPDATE, INSERT, and DELETE tabs.</span></span>

<span data-ttu-id="d67c7-167">[![将数据源配置为使用 ProductsBLL 类 s GetProductsBySupplierID （供应商）方法](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image22.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="d67c7-167">[![Configure the Data Source to use the ProductsBLL Class s GetProductsBySupplierID(supplierID) Method](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image22.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image21.png)</span></span>

<span data-ttu-id="d67c7-168">**图 9**：将数据源配置为使用 `ProductsBLL` 类的 `GetProductsBySupplierID(supplierID)` 方法（[单击以查看完全大小的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image23.png)）</span><span class="sxs-lookup"><span data-stu-id="d67c7-168">**Figure 9**: Configure the Data Source to use the `ProductsBLL` Class's `GetProductsBySupplierID(supplierID)` Method ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image23.png))</span></span>

<span data-ttu-id="d67c7-169">由于 `GetProductsBySupplierID(supplierID)` 方法接受输入参数，因此 ObjectDataSource 向导会提示我们输入此参数值的源。</span><span class="sxs-lookup"><span data-stu-id="d67c7-169">Since the `GetProductsBySupplierID(supplierID)` method accepts an input parameter, the ObjectDataSource wizard prompts us for the source of this parameter value.</span></span> <span data-ttu-id="d67c7-170">若要从 FormView 传入 `SupplierID` 值，请将 "参数源" 下拉列表设置为 "控制"，并将 "ControlID" 下拉列表设置为 "`Suppliers`" （在步骤2中创建的 FormView 的 ID）。</span><span class="sxs-lookup"><span data-stu-id="d67c7-170">To pass in the `SupplierID` value from the FormView, set the Parameter source drop-down list to Control and the ControlID drop-down list to `Suppliers` (the ID of the FormView created in Step 2).</span></span>

<span data-ttu-id="d67c7-171">[![指示供应商参数应来自供应商 FormView 控件](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image25.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image24.png)</span><span class="sxs-lookup"><span data-stu-id="d67c7-171">[![Indicate that the supplierID Parameter Should Come from the Suppliers FormView Control](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image25.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image24.png)</span></span>

<span data-ttu-id="d67c7-172">**图 10**：指示 *`supplierID`* 参数应来自于 `Suppliers` FormView 控件（[单击查看完全大小的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image26.png)）</span><span class="sxs-lookup"><span data-stu-id="d67c7-172">**Figure 10**: Indicate that the *`supplierID`* Parameter Should Come from the `Suppliers` FormView Control ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image26.png))</span></span>

<span data-ttu-id="d67c7-173">完成 ObjectDataSource 向导后，GridView 将包含每个产品的数据字段的 BoundField 或 CheckBoxField。</span><span class="sxs-lookup"><span data-stu-id="d67c7-173">After completing the ObjectDataSource wizard, the GridView will contain a BoundField or CheckBoxField for each of the product's data fields.</span></span> <span data-ttu-id="d67c7-174">让我们将此修整为仅显示 `ProductName` 和 `UnitPrice` BoundFields 以及 `Discontinued` CheckBoxField;此外，我们将 `UnitPrice` 的格式设置为 BoundField，以便将其文本设置为货币格式。</span><span class="sxs-lookup"><span data-stu-id="d67c7-174">Let's trim this down to show just the `ProductName` and `UnitPrice` BoundFields along with the `Discontinued` CheckBoxField; furthermore, let's format the `UnitPrice` BoundField such that its text is formatted as a currency.</span></span> <span data-ttu-id="d67c7-175">GridView 和 `SuppliersProductsDataSource` ObjectDataSource 的声明性标记应类似于以下标记：</span><span class="sxs-lookup"><span data-stu-id="d67c7-175">Your GridView and `SuppliersProductsDataSource` ObjectDataSource's declarative markup should look similar to the following markup:</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample3.aspx)]

<span data-ttu-id="d67c7-176">此时，我们的教程将显示一个主/详细信息报表，使用户可以从顶部的 FormView 中选择一个供应商，并通过底部的 GridView 查看该供应商提供的产品。</span><span class="sxs-lookup"><span data-stu-id="d67c7-176">At this point our tutorial displays a master/details report, allowing the user to pick a supplier from the FormView at the top and to view the products provided by that supplier through the GridView at the bottom.</span></span> <span data-ttu-id="d67c7-177">图11显示了在 FormView 中选择东京商贸供应商时此页的屏幕截图。</span><span class="sxs-lookup"><span data-stu-id="d67c7-177">Figure 11 shows a screen shot of this page when selecting the Tokyo Traders supplier from the FormView.</span></span>

<span data-ttu-id="d67c7-178">[![所选供应商的产品显示在 GridView 中](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image28.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="d67c7-178">[![The Selected Supplier s Products are Displayed in the GridView](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image28.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image27.png)</span></span>

<span data-ttu-id="d67c7-179">**图 11**：选择的供应商的产品显示在 GridView 中（[单击以查看完全大小的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image29.png)）</span><span class="sxs-lookup"><span data-stu-id="d67c7-179">**Figure 11**: The Selected Supplier's Products are Displayed in the GridView ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image29.png))</span></span>

## <a name="step-4-creating-dal-and-bll-methods-to-discontinue-all-products-for-a-supplier"></a><span data-ttu-id="d67c7-180">步骤4：创建 DAL 和 BLL 方法，停止供应商的所有产品</span><span class="sxs-lookup"><span data-stu-id="d67c7-180">Step 4: Creating DAL and BLL Methods to Discontinue All Products for a Supplier</span></span>

<span data-ttu-id="d67c7-181">在我们可以向 FormView 添加一个按钮，单击该按钮会使供应商的所有产品停止运行，我们首先需要向执行此操作的 DAL 和 BLL 添加方法。</span><span class="sxs-lookup"><span data-stu-id="d67c7-181">Before we can add a Button to the FormView that, when clicked, discontinues all of the supplier's products, we first need to add a method to both the DAL and BLL that performs this action.</span></span> <span data-ttu-id="d67c7-182">具体而言，此方法将命名为 `DiscontinueAllProductsForSupplier(supplierID)`。</span><span class="sxs-lookup"><span data-stu-id="d67c7-182">In particular, this method will be named `DiscontinueAllProductsForSupplier(supplierID)`.</span></span> <span data-ttu-id="d67c7-183">单击 FormView 的按钮后，将在业务逻辑层中调用此方法，并传入所选供应商的 `SupplierID`;然后，BLL 将向下调用相应的数据访问层方法，该方法将向数据库发出 `UPDATE` 语句，该语句会使指定的供应商产品中断。</span><span class="sxs-lookup"><span data-stu-id="d67c7-183">When the FormView's Button is clicked, we'll invoke this method in the Business Logic Layer, passing in the selected supplier's `SupplierID`; the BLL will then call down to the corresponding Data Access Layer method, which will issue an `UPDATE` statement to the database that discontinues the specified supplier's products.</span></span>

<span data-ttu-id="d67c7-184">正如我们在前面的教程中所做的那样，我们将使用自下而上的方法，从创建 DAL 方法，然后是 BLL 方法开始，最后在 ASP.NET 页中实现该功能。</span><span class="sxs-lookup"><span data-stu-id="d67c7-184">As we have done in our previous tutorials, we'll use a bottom-up approach, starting with creating the DAL method, then the BLL method, and finally implementing the functionality in the ASP.NET page.</span></span> <span data-ttu-id="d67c7-185">打开 `App_Code/DAL` 文件夹中 `Northwind.xsd` 的类型化数据集，并将新方法添加到 `ProductsTableAdapter` （右键单击 `ProductsTableAdapter`，然后选择 "添加查询"）。</span><span class="sxs-lookup"><span data-stu-id="d67c7-185">Open the `Northwind.xsd` Typed DataSet in the `App_Code/DAL` folder and add a new method to the `ProductsTableAdapter` (right-click on the `ProductsTableAdapter` and choose Add Query).</span></span> <span data-ttu-id="d67c7-186">这样做将显示 "TableAdapter 查询配置向导"，指导我们完成添加新方法的过程。</span><span class="sxs-lookup"><span data-stu-id="d67c7-186">Doing so will bring up the TableAdapter Query Configuration wizard, which walks us through the process of adding the new method.</span></span> <span data-ttu-id="d67c7-187">首先，指示 DAL 方法将使用即席 SQL 语句。</span><span class="sxs-lookup"><span data-stu-id="d67c7-187">Start by indicating that our DAL method will use an ad-hoc SQL statement.</span></span>

<span data-ttu-id="d67c7-188">[![使用即席 SQL 语句创建 DAL 方法](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image31.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image30.png)</span><span class="sxs-lookup"><span data-stu-id="d67c7-188">[![Create the DAL Method Using an Ad-Hoc SQL Statement](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image31.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image30.png)</span></span>

<span data-ttu-id="d67c7-189">**图 12**：使用即席 SQL 语句创建 DAL 方法（[单击以查看完全大小的映像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image32.png)）</span><span class="sxs-lookup"><span data-stu-id="d67c7-189">**Figure 12**: Create the DAL Method Using an Ad-Hoc SQL Statement ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image32.png))</span></span>

<span data-ttu-id="d67c7-190">接下来，向导将提示我们输入要创建的查询类型。</span><span class="sxs-lookup"><span data-stu-id="d67c7-190">Next, the wizard prompts us as to what type of query to create.</span></span> <span data-ttu-id="d67c7-191">由于 `DiscontinueAllProductsForSupplier(supplierID)` 方法需要更新 `Products` 数据库表，因此，需要创建一个更新数据的查询，将 `Discontinued` 字段设置为 *`supplierID`* 1。</span><span class="sxs-lookup"><span data-stu-id="d67c7-191">Since the `DiscontinueAllProductsForSupplier(supplierID)` method will need to update the `Products` database table, setting the `Discontinued` field to 1 for all products provided by the specified *`supplierID`*, we need to create a query that updates data.</span></span>

<span data-ttu-id="d67c7-192">[![选择更新查询类型](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image34.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="d67c7-192">[![Choose the UPDATE Query Type](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image34.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image33.png)</span></span>

<span data-ttu-id="d67c7-193">**图 13**：选择 "更新" 查询类型（[单击以查看完全大小的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image35.png)）</span><span class="sxs-lookup"><span data-stu-id="d67c7-193">**Figure 13**: Choose the UPDATE Query Type ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image35.png))</span></span>

<span data-ttu-id="d67c7-194">下一个向导屏幕提供了 TableAdapter 的现有 `UPDATE` 语句，该语句更新 `Products` DataTable 中定义的每个字段。</span><span class="sxs-lookup"><span data-stu-id="d67c7-194">The next wizard screen provides the TableAdapter's existing `UPDATE` statement, which updates each of the fields defined in the `Products` DataTable.</span></span> <span data-ttu-id="d67c7-195">将此查询文本替换为以下语句：</span><span class="sxs-lookup"><span data-stu-id="d67c7-195">Replace this query text with the following statement:</span></span>

[!code-sql[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample4.sql)]

<span data-ttu-id="d67c7-196">输入此查询并单击 "下一步" 后，最后一个向导屏幕会要求 `DiscontinueAllProductsForSupplier`使用新方法的名称。</span><span class="sxs-lookup"><span data-stu-id="d67c7-196">After entering this query and clicking Next, the last wizard screen asks for the new method's name use `DiscontinueAllProductsForSupplier`.</span></span> <span data-ttu-id="d67c7-197">通过单击 "完成" 按钮完成向导。</span><span class="sxs-lookup"><span data-stu-id="d67c7-197">Complete the wizard by clicking the Finish button.</span></span> <span data-ttu-id="d67c7-198">返回到数据集设计器后，应会在名为 `DiscontinueAllProductsForSupplier(@SupplierID)`的 `ProductsTableAdapter` 中看到一个新方法。</span><span class="sxs-lookup"><span data-stu-id="d67c7-198">Upon returning to the DataSet Designer you should see a new method in the `ProductsTableAdapter` named `DiscontinueAllProductsForSupplier(@SupplierID)`.</span></span>

<span data-ttu-id="d67c7-199">[![命名新的 DAL 方法 DiscontinueAllProductsForSupplier](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image37.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image36.png)</span><span class="sxs-lookup"><span data-stu-id="d67c7-199">[![Name the New DAL Method DiscontinueAllProductsForSupplier](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image37.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image36.png)</span></span>

<span data-ttu-id="d67c7-200">**图 14**：将新的 DAL 方法命名 `DiscontinueAllProductsForSupplier` （[单击以查看完全大小的映像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image38.png)）</span><span class="sxs-lookup"><span data-stu-id="d67c7-200">**Figure 14**: Name the New DAL Method `DiscontinueAllProductsForSupplier` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image38.png))</span></span>

<span data-ttu-id="d67c7-201">使用在数据访问层中创建的 `DiscontinueAllProductsForSupplier(supplierID)` 方法时，我们的下一个任务是在业务逻辑层中创建 `DiscontinueAllProductsForSupplier(supplierID)` 方法。</span><span class="sxs-lookup"><span data-stu-id="d67c7-201">With the `DiscontinueAllProductsForSupplier(supplierID)` method created in the Data Access Layer, our next task is to create the `DiscontinueAllProductsForSupplier(supplierID)` method in the Business Logic Layer.</span></span> <span data-ttu-id="d67c7-202">若要完成此操作，请打开 `ProductsBLL` 类文件，并添加以下内容：</span><span class="sxs-lookup"><span data-stu-id="d67c7-202">To accomplish this, open the `ProductsBLL` class file and add the following:</span></span>

[!code-csharp[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample5.cs)]

<span data-ttu-id="d67c7-203">此方法只需向下调用 DAL 中的 `DiscontinueAllProductsForSupplier(supplierID)` 方法，同时传递提供的 *`supplierID`* 参数值。</span><span class="sxs-lookup"><span data-stu-id="d67c7-203">This method simply calls down to the `DiscontinueAllProductsForSupplier(supplierID)` method in the DAL, passing along the provided *`supplierID`* parameter value.</span></span> <span data-ttu-id="d67c7-204">如果在某些情况下，只有允许供应商的产品停用的任何业务规则，则应在 BLL 中实施这些规则。</span><span class="sxs-lookup"><span data-stu-id="d67c7-204">If there were any business rules that only allowed a supplier's products to be discontinued under certain circumstances, those rules should be implemented here, in the BLL.</span></span>

> [!NOTE]
> <span data-ttu-id="d67c7-205">与 `ProductsBLL` 类中的 `UpdateProduct` 重载不同，`DiscontinueAllProductsForSupplier(supplierID)` 方法签名不包含 `DataObjectMethodAttribute` 特性（`<System.ComponentModel.DataObjectMethodAttribute(System.ComponentModel.DataObjectMethodType.Update, Boolean)>`）。</span><span class="sxs-lookup"><span data-stu-id="d67c7-205">Unlike the `UpdateProduct` overloads in the `ProductsBLL` class, the `DiscontinueAllProductsForSupplier(supplierID)` method signature does not include the `DataObjectMethodAttribute` attribute (`<System.ComponentModel.DataObjectMethodAttribute(System.ComponentModel.DataObjectMethodType.Update, Boolean)>`).</span></span> <span data-ttu-id="d67c7-206">这将从 "更新" 选项卡中 ObjectDataSource 的 "配置数据源" 向导的下拉列表中排除 `DiscontinueAllProductsForSupplier(supplierID)` 方法。我以前省略了此属性，因为我们将在 ASP.NET 页中直接从事件处理程序调用 `DiscontinueAllProductsForSupplier(supplierID)` 方法。</span><span class="sxs-lookup"><span data-stu-id="d67c7-206">This precludes the `DiscontinueAllProductsForSupplier(supplierID)` method from the ObjectDataSource's Configure Data Source wizard's drop-down list in the UPDATE tab. I ve omitted this attribute because we'll be calling the `DiscontinueAllProductsForSupplier(supplierID)` method directly from an event handler in our ASP.NET page.</span></span>

## <a name="step-5-adding-a-discontinue-all-products-button-to-the-formview"></a><span data-ttu-id="d67c7-207">步骤5：向 FormView 添加 "停止所有产品" 按钮</span><span class="sxs-lookup"><span data-stu-id="d67c7-207">Step 5: Adding a Discontinue All Products Button to the FormView</span></span>

<span data-ttu-id="d67c7-208">使用 BLL 和 DAL 中的 `DiscontinueAllProductsForSupplier(supplierID)` 方法完成后，为所选供应商添加停止所有产品的功能的最后一步是将按钮 Web 控件添加到 FormView 的 `ItemTemplate`中。</span><span class="sxs-lookup"><span data-stu-id="d67c7-208">With the `DiscontinueAllProductsForSupplier(supplierID)` method in the BLL and DAL complete, the final step for adding the ability to discontinue all products for the selected supplier is to add a Button Web control to the FormView's `ItemTemplate`.</span></span> <span data-ttu-id="d67c7-209">让我们将此类按钮添加到供应商的电话号码下面的按钮文本，停止所有产品，并 `ID` 属性值 `DiscontinueAllProductsForSupplier`。</span><span class="sxs-lookup"><span data-stu-id="d67c7-209">Let's add such a Button below the supplier's phone number with the button text, Discontinue All Products and an `ID` property value of `DiscontinueAllProductsForSupplier`.</span></span> <span data-ttu-id="d67c7-210">通过在 FormView 的智能标记中单击 "编辑模板" 链接（见图15），或直接通过声明性语法，可以在设计器中添加此按钮 Web 控件。</span><span class="sxs-lookup"><span data-stu-id="d67c7-210">You can add this Button Web control through the Designer by clicking on the Edit Templates link in the FormView's smart tag (see Figure 15), or directly through the declarative syntax.</span></span>

<span data-ttu-id="d67c7-211">[![将 "停止所有产品" 按钮 Web 控件添加到 FormView s ItemTemplate](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image40.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="d67c7-211">[![Add a Discontinue All Products Button Web Control to the FormView s ItemTemplate](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image40.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image39.png)</span></span>

<span data-ttu-id="d67c7-212">**图 15**：向 FormView 的 `ItemTemplate` 添加 "停止所有产品" 按钮 Web 控件（[单击查看完全大小的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image41.png)）</span><span class="sxs-lookup"><span data-stu-id="d67c7-212">**Figure 15**: Add a Discontinue All Products Button Web Control to the FormView's `ItemTemplate` ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image41.png))</span></span>

<span data-ttu-id="d67c7-213">当访问该页的用户单击该按钮时，将触发回发可以和 FormView 的[`ItemCommand` 事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.itemcommand.aspx)。</span><span class="sxs-lookup"><span data-stu-id="d67c7-213">When the Button is clicked by a user visiting the page, a postback ensues and the FormView's [`ItemCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.itemcommand.aspx) fires.</span></span> <span data-ttu-id="d67c7-214">若要执行自定义代码来响应单击此按钮，可以为此事件创建事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="d67c7-214">To execute custom code in response to this Button being clicked, we can create an event handler for this event.</span></span> <span data-ttu-id="d67c7-215">但请注意，只要在 FormView 内单击*任何*按钮、LinkButton 或 ImageButton Web 控件，就会触发 `ItemCommand` 事件。</span><span class="sxs-lookup"><span data-stu-id="d67c7-215">Understand, though, that the `ItemCommand` event fires whenever *any* Button, LinkButton, or ImageButton Web control is clicked within the FormView.</span></span> <span data-ttu-id="d67c7-216">这意味着，当用户在 FormView 中从一个页面移动到另一个页面时，将激发 `ItemCommand` 事件;当用户在支持插入、更新或删除的 FormView 中单击 "新建"、"编辑" 或 "删除" 时，也是如此。</span><span class="sxs-lookup"><span data-stu-id="d67c7-216">That means that when the user moves from one page to another in the FormView, the `ItemCommand` event fires; same thing when the user clicks New, Edit, or Delete in a FormView that supports inserting, updating, or deleting.</span></span>

<span data-ttu-id="d67c7-217">因为无论单击哪个按钮，都将激发 `ItemCommand`，因此，在事件处理程序中，我们需要一种方法来确定是否已单击 "停止所有产品" 按钮，或者是否为其他按钮。</span><span class="sxs-lookup"><span data-stu-id="d67c7-217">Since the `ItemCommand` fires regardless of what button is clicked, in the event handler we need a way to determine if the Discontinue All Products Button was clicked or if it was some other button.</span></span> <span data-ttu-id="d67c7-218">为实现此目的，我们可以将按钮 Web 控件的 `CommandName` 属性设置为某个标识值。</span><span class="sxs-lookup"><span data-stu-id="d67c7-218">To accomplish this, we can set the Button Web control's `CommandName` property to some identifying value.</span></span> <span data-ttu-id="d67c7-219">单击该按钮时，此 `CommandName` 会传递到 `ItemCommand` 事件处理程序，从而使我们能够确定是否已单击 "停止所有产品" 按钮。</span><span class="sxs-lookup"><span data-stu-id="d67c7-219">When the Button is clicked, this `CommandName` value is passed into the `ItemCommand` event handler, enabling us to determine whether the Discontinue All Products Button was the button clicked.</span></span> <span data-ttu-id="d67c7-220">将 "停止所有产品" 按钮的 `CommandName` 属性设置为 "DiscontinueProducts"。</span><span class="sxs-lookup"><span data-stu-id="d67c7-220">Set the Discontinue All Products Button's `CommandName` property to DiscontinueProducts .</span></span>

<span data-ttu-id="d67c7-221">最后，让我们使用客户端确认对话框，以确保用户确实要停止所选供应商的产品。</span><span class="sxs-lookup"><span data-stu-id="d67c7-221">Finally, let's use a client-side confirm dialog box to ensure that the user really wants to discontinue the selected supplier's products.</span></span> <span data-ttu-id="d67c7-222">正如我们在[删除教程时添加客户端确认](../editing-inserting-and-deleting-data/adding-client-side-confirmation-when-deleting-cs.md)中看到的那样，这可以通过一些 JavaScript 来完成。</span><span class="sxs-lookup"><span data-stu-id="d67c7-222">As we saw in the [Adding Client-Side Confirmation When Deleting](../editing-inserting-and-deleting-data/adding-client-side-confirmation-when-deleting-cs.md) tutorial, this can be accomplished with a bit of JavaScript.</span></span> <span data-ttu-id="d67c7-223">具体而言，将按钮 Web 控件的 OnClientClick 属性设置为 `return confirm('This will mark _all_ of this supplier\'s products as discontinued. Are you certain you want to do this?');`</span><span class="sxs-lookup"><span data-stu-id="d67c7-223">In particular, set the Button Web control's OnClientClick property to `return confirm('This will mark _all_ of this supplier\'s products as discontinued. Are you certain you want to do this?');`</span></span>

<span data-ttu-id="d67c7-224">进行这些更改后，FormView 的声明性语法应该如下所示：</span><span class="sxs-lookup"><span data-stu-id="d67c7-224">After making these changes, the FormView's declarative syntax should look like the following:</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample6.aspx)]

<span data-ttu-id="d67c7-225">接下来，创建 FormView 的 `ItemCommand` 事件的事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="d67c7-225">Next, create an event handler for the FormView's `ItemCommand` event.</span></span> <span data-ttu-id="d67c7-226">在此事件处理程序中，我们需要首先确定是否已单击 "停止所有产品" 按钮。</span><span class="sxs-lookup"><span data-stu-id="d67c7-226">In this event handler we need to first determine whether the Discontinue All Products Button was clicked.</span></span> <span data-ttu-id="d67c7-227">如果是这样，我们想要创建 `ProductsBLL` 类的实例并调用其 `DiscontinueAllProductsForSupplier(supplierID)` 方法，并传入所选 FormView 的 `SupplierID`：</span><span class="sxs-lookup"><span data-stu-id="d67c7-227">If so, we want to create an instance of the `ProductsBLL` class and invoke its `DiscontinueAllProductsForSupplier(supplierID)` method, passing in the `SupplierID` of the selected FormView:</span></span>

[!code-csharp[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample7.cs)]

<span data-ttu-id="d67c7-228">请注意，可以使用 FormView 的[`SelectedValue` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.selectedvalue.aspx)访问 formview 中当前所选供应商的 `SupplierID`。</span><span class="sxs-lookup"><span data-stu-id="d67c7-228">Note that the `SupplierID` of the current selected supplier in the FormView can be accessed using the FormView's [`SelectedValue` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.formview.selectedvalue.aspx).</span></span> <span data-ttu-id="d67c7-229">`SelectedValue` 属性返回在 FormView 中显示的记录的第一个数据键值。</span><span class="sxs-lookup"><span data-stu-id="d67c7-229">The `SelectedValue` property returns the first data key value for the record being displayed in the FormView.</span></span> <span data-ttu-id="d67c7-230">FormView 的[`DataKeyNames` 属性](https://msdn.microsoft.com/system.web.ui.webcontrols.formview.datakeynames.aspx)（指示从中提取数据键值的数据字段）在将 ObjectDataSource 绑定到步骤2中的 FormView 时自动设置为 `SupplierID`。</span><span class="sxs-lookup"><span data-stu-id="d67c7-230">The FormView's [`DataKeyNames` property](https://msdn.microsoft.com/system.web.ui.webcontrols.formview.datakeynames.aspx), which indicates the data fields from which the data key values are pulled from, was automatically set to `SupplierID` by Visual Studio when binding the ObjectDataSource to the FormView back in Step 2.</span></span>

<span data-ttu-id="d67c7-231">创建 `ItemCommand` 事件处理程序后，请花点时间测试页面。</span><span class="sxs-lookup"><span data-stu-id="d67c7-231">With the `ItemCommand` event handler created, take a moment to test out the page.</span></span> <span data-ttu-id="d67c7-232">浏览到 Cooperativa de Quesos ' 内华达 Cabras ' 供应商（这是 FormView for the 的第五个供应商）。</span><span class="sxs-lookup"><span data-stu-id="d67c7-232">Browse to the Cooperativa de Quesos 'Las Cabras' supplier (it's the fifth supplier in the FormView for me).</span></span> <span data-ttu-id="d67c7-233">此供应商提供了两个产品： Queso Cabrales 和 Queso Manchego La Pastora，两者都*不*停用。</span><span class="sxs-lookup"><span data-stu-id="d67c7-233">This supplier provides two products, Queso Cabrales and Queso Manchego La Pastora, both of which are *not* discontinued.</span></span>

<span data-ttu-id="d67c7-234">假设 Cooperativa de Quesos "内华达 Cabras" 已开生意，因此其产品将被淘汰。</span><span class="sxs-lookup"><span data-stu-id="d67c7-234">Imagine that Cooperativa de Quesos 'Las Cabras' has gone out of business and therefore its products are to be discontinued.</span></span> <span data-ttu-id="d67c7-235">单击 "停止所有产品" 按钮。</span><span class="sxs-lookup"><span data-stu-id="d67c7-235">Click the Discontinue All Products Button.</span></span> <span data-ttu-id="d67c7-236">此时将显示 "客户端确认" 对话框（请参阅图16）。</span><span class="sxs-lookup"><span data-stu-id="d67c7-236">This will display the client-side confirm dialog box (see Figure 16).</span></span>

<span data-ttu-id="d67c7-237">[![Cooperativa de Quesos 拉斯维加斯 Cabras 提供了两个活动产品](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image43.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image42.png)</span><span class="sxs-lookup"><span data-stu-id="d67c7-237">[![Cooperativa de Quesos Las Cabras Supplies Two Active Products](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image43.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image42.png)</span></span>

<span data-ttu-id="d67c7-238">**图 16**： Cooperativa De Quesos 拉斯维加斯 Cabras 提供了两个活动产品（[单击查看全尺寸图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image44.png)）</span><span class="sxs-lookup"><span data-stu-id="d67c7-238">**Figure 16**: Cooperativa de Quesos Las Cabras Supplies Two Active Products ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image44.png))</span></span>

<span data-ttu-id="d67c7-239">如果在 "客户端确认" 对话框中单击 "确定"，则窗体提交将继续进行，从而导致激发 FormView 的 `ItemCommand` 事件的回发。</span><span class="sxs-lookup"><span data-stu-id="d67c7-239">If you click OK in the client-side confirm dialog box, the form submission will proceed, causing a postback in which the FormView's `ItemCommand` event will fire.</span></span> <span data-ttu-id="d67c7-240">然后，创建的事件处理程序将执行，同时调用 `DiscontinueAllProductsForSupplier(supplierID)` 方法，同时停止 Queso Cabrales 和 Queso Manchego La Pastora 产品。</span><span class="sxs-lookup"><span data-stu-id="d67c7-240">The event handler we created will then execute, invoking the `DiscontinueAllProductsForSupplier(supplierID)` method and discontinuing both the Queso Cabrales and Queso Manchego La Pastora products.</span></span>

<span data-ttu-id="d67c7-241">如果已禁用 GridView 的视图状态，则将在每次回发时将 GridView 重新绑定到基础数据存储区，因此会立即更新以反映这两种产品现在已停止使用（请参阅图17）。</span><span class="sxs-lookup"><span data-stu-id="d67c7-241">If you have disabled the GridView's view state, the GridView is being rebound to the underlying data store on every postback, and therefore will immediately be updated to reflect that these two products are now discontinued (see Figure 17).</span></span> <span data-ttu-id="d67c7-242">但是，如果您在 GridView 中未禁用视图状态，则在进行此更改后，您将需要手动将数据重新绑定到 GridView。</span><span class="sxs-lookup"><span data-stu-id="d67c7-242">If, however, you have not disabled view state in the GridView, you will need to manually rebind the data to the GridView after making this change.</span></span> <span data-ttu-id="d67c7-243">若要实现此目的，只需在调用 `DiscontinueAllProductsForSupplier(supplierID)` 方法之后立即调用 GridView 的 `DataBind()` 方法。</span><span class="sxs-lookup"><span data-stu-id="d67c7-243">To accomplish this, simply make a call to the GridView's `DataBind()` method immediately after invoking the `DiscontinueAllProductsForSupplier(supplierID)` method.</span></span>

<span data-ttu-id="d67c7-244">[![单击 "停止所有产品" 按钮后，将相应地更新供应商产品](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image46.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="d67c7-244">[![After Clicking the Discontinue All Products Button, the Supplier s Products are Updated Accordingly](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image46.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image45.png)</span></span>

<span data-ttu-id="d67c7-245">**图 17**：单击 "停止所有产品" 按钮后，将相应地更新供应商的产品（[单击以查看完全大小的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image47.png)）</span><span class="sxs-lookup"><span data-stu-id="d67c7-245">**Figure 17**: After Clicking the Discontinue All Products Button, the Supplier's Products are Updated Accordingly ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image47.png))</span></span>

## <a name="step-6-creating-an-updateproduct-overload-in-the-business-logic-layer-for-adjusting-a-products-price"></a><span data-ttu-id="d67c7-246">步骤6：在业务逻辑层创建 UpdateProduct 重载以调整产品的价格</span><span class="sxs-lookup"><span data-stu-id="d67c7-246">Step 6: Creating an UpdateProduct Overload in the Business Logic Layer for Adjusting a Product's Price</span></span>

<span data-ttu-id="d67c7-247">与 FormView 中的 "停止所有产品" 按钮一样，为了增加在 GridView 中增加和减少产品价格的按钮，我们需要首先添加适当的数据访问层和业务逻辑层方法。</span><span class="sxs-lookup"><span data-stu-id="d67c7-247">Like with the Discontinue All Products Button in the FormView, in order to add buttons for increasing and decreasing the price for a product in the GridView we need to first add the appropriate Data Access Layer and Business Logic Layer methods.</span></span> <span data-ttu-id="d67c7-248">由于我们已经有了一个方法来更新 DAL 中的单个产品行，因此可以通过为 BLL 中的 `UpdateProduct` 方法创建新的重载来提供此类功能。</span><span class="sxs-lookup"><span data-stu-id="d67c7-248">Since we already have a method that updates a single product row in the DAL, we can provide such functionality by creating a new overload for the `UpdateProduct` method in the BLL.</span></span>

<span data-ttu-id="d67c7-249">过去的 `UpdateProduct` 重载采用某种形式的产品字段作为标量输入值，然后仅更新了指定产品的字段。</span><span class="sxs-lookup"><span data-stu-id="d67c7-249">Our past `UpdateProduct` overloads have taken in some combination of product fields as scalar input values and have then updated just those fields for the specified product.</span></span> <span data-ttu-id="d67c7-250">对于此重载，我们将与此标准略有不同，并改为传入产品的 `ProductID` 和调整 `UnitPrice` 的百分比（而不是传入新的、调整后的 `UnitPrice` 本身）。</span><span class="sxs-lookup"><span data-stu-id="d67c7-250">For this overload we'll vary slightly from this standard and instead pass in the product's `ProductID` and the percentage by which to adjust the `UnitPrice` (as opposed to passing in the new, adjusted `UnitPrice` itself).</span></span> <span data-ttu-id="d67c7-251">这种方法可以简化我们需要在 ASP.NET 页代码隐藏类中编写的代码，因为我们不必担心如何确定当前产品的 `UnitPrice`。</span><span class="sxs-lookup"><span data-stu-id="d67c7-251">This approach will simplify the code we need to write in the ASP.NET page code-behind class, since we don't have to bother with determining the current product's `UnitPrice`.</span></span>

<span data-ttu-id="d67c7-252">本教程的 `UpdateProduct` 重载如下所示：</span><span class="sxs-lookup"><span data-stu-id="d67c7-252">The `UpdateProduct` overload for this tutorial is shown below:</span></span>

[!code-csharp[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample8.cs)]

<span data-ttu-id="d67c7-253">此重载通过 DAL 的 `GetProductByProductID(productID)` 方法检索有关指定产品的信息。</span><span class="sxs-lookup"><span data-stu-id="d67c7-253">This overload retrieves information about the specified product through the DAL's `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="d67c7-254">然后，它会检查是否为产品的 `UnitPrice` 分配了数据库 `NULL` 值。</span><span class="sxs-lookup"><span data-stu-id="d67c7-254">It then checks to see whether the product's `UnitPrice` is assigned a database `NULL` value.</span></span> <span data-ttu-id="d67c7-255">如果是这样，价格将保持不变。</span><span class="sxs-lookup"><span data-stu-id="d67c7-255">If it is, the price is left unaltered.</span></span> <span data-ttu-id="d67c7-256">然而，如果存在非`NULL` `UnitPrice` 值，则该方法将按指定百分比（`unitPriceAdjustmentPercent`）更新产品的 `UnitPrice`。</span><span class="sxs-lookup"><span data-stu-id="d67c7-256">If, however, there is a non-`NULL` `UnitPrice` value, the method updates the product's `UnitPrice` by the specified percent (`unitPriceAdjustmentPercent`).</span></span>

## <a name="step-7-adding-the-increase-and-decrease-buttons-to-the-gridview"></a><span data-ttu-id="d67c7-257">步骤7：将增加和减少按钮添加到 GridView</span><span class="sxs-lookup"><span data-stu-id="d67c7-257">Step 7: Adding the Increase and Decrease Buttons to the GridView</span></span>

<span data-ttu-id="d67c7-258">GridView （和 DetailsView）都由字段集合构成。</span><span class="sxs-lookup"><span data-stu-id="d67c7-258">The GridView (and DetailsView) are both made up of a collection of fields.</span></span> <span data-ttu-id="d67c7-259">除了 BoundFields、CheckBoxFields 和 Templatefield 外，ASP.NET 还包括 ButtonField，该 LinkButton 将呈现为每一行都带有按钮、ImageButton 或的列。</span><span class="sxs-lookup"><span data-stu-id="d67c7-259">In addition to BoundFields, CheckBoxFields, and TemplateFields, ASP.NET includes the ButtonField, which, as its name implies, renders as a column with a Button, LinkButton, or ImageButton for each row.</span></span> <span data-ttu-id="d67c7-260">类似于 FormView，单击 GridView 分页按钮中的*任意*按钮、编辑或删除按钮、排序按钮等将导致回发并引发 GridView 的[`RowCommand` 事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowcommand.aspx)。</span><span class="sxs-lookup"><span data-stu-id="d67c7-260">Similar to the FormView, clicking *any* button within the GridView paging buttons, Edit or Delete buttons, sorting buttons, and so on causes a postback and raises the GridView's [`RowCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowcommand.aspx).</span></span>

<span data-ttu-id="d67c7-261">ButtonField 有一个 `CommandName` 属性，该属性将指定值分配给其每个按钮 `CommandName` 属性。</span><span class="sxs-lookup"><span data-stu-id="d67c7-261">The ButtonField has a `CommandName` property that assigns the specified value to each of its Buttons `CommandName` properties.</span></span> <span data-ttu-id="d67c7-262">与 FormView 一样，`RowCommand` 事件处理程序使用 `CommandName` 值来确定单击了哪个按钮。</span><span class="sxs-lookup"><span data-stu-id="d67c7-262">Like with the FormView, the `CommandName` value is used by the `RowCommand` event handler to determine which button was clicked.</span></span>

<span data-ttu-id="d67c7-263">接下来，将两个新的 ButtonFields 添加到 GridView，其中一个按钮的文本价格为 + 10%，另一个带有文本价格-10%。</span><span class="sxs-lookup"><span data-stu-id="d67c7-263">Let's add two new ButtonFields to the GridView, one with a button text Price +10% and the other with the text Price -10%.</span></span> <span data-ttu-id="d67c7-264">若要添加这些 ButtonFields，请在 GridView 的智能标记中单击 "编辑列" 链接，从左上角的列表中选择 "ButtonField" 字段类型，然后单击 "添加" 按钮。</span><span class="sxs-lookup"><span data-stu-id="d67c7-264">To add these ButtonFields, click on the Edit Columns link from the GridView's smart tag, select the ButtonField field type from the list in the upper left and click the Add button.</span></span>

![将两个 ButtonFields 添加到 GridView](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image48.png)

<span data-ttu-id="d67c7-266">**图 18**：将两个 ButtonFields 添加到 GridView</span><span class="sxs-lookup"><span data-stu-id="d67c7-266">**Figure 18**: Add Two ButtonFields to the GridView</span></span>

<span data-ttu-id="d67c7-267">移动两个 ButtonFields，使其显示为前两个 GridView 字段。</span><span class="sxs-lookup"><span data-stu-id="d67c7-267">Move the two ButtonFields so that they appear as the first two GridView fields.</span></span> <span data-ttu-id="d67c7-268">接下来，将这两个 ButtonFields 的 `Text` 属性分别设置为 "价格 + 10%" 和 "Price-10%"，并将 `CommandName` 属性分别设置为 "IncreasePrice" 和 "DecreasePrice"。</span><span class="sxs-lookup"><span data-stu-id="d67c7-268">Next, set the `Text` properties of these two ButtonFields to Price +10% and Price -10% and the `CommandName` properties to IncreasePrice and DecreasePrice, respectively.</span></span> <span data-ttu-id="d67c7-269">默认情况下，ButtonField 将其按钮列呈现为 LinkButtons。</span><span class="sxs-lookup"><span data-stu-id="d67c7-269">By default, a ButtonField renders its column of buttons as LinkButtons.</span></span> <span data-ttu-id="d67c7-270">不过，可以通过 ButtonField 的[`ButtonType` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.buttonfieldbase.buttontype.aspx)更改此属性。</span><span class="sxs-lookup"><span data-stu-id="d67c7-270">This can be changed, however, through the ButtonField's [`ButtonType` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.buttonfieldbase.buttontype.aspx).</span></span> <span data-ttu-id="d67c7-271">让我们将这两个 ButtonFields 呈现为普通的按钮;因此，请将 `ButtonType` 属性设置为 `Button`。</span><span class="sxs-lookup"><span data-stu-id="d67c7-271">Let's have these two ButtonFields rendered as regular push buttons; therefore, set the `ButtonType` property to `Button`.</span></span> <span data-ttu-id="d67c7-272">图19在进行这些更改之后，将显示 "字段" 对话框。下面是 GridView 的声明性标记。</span><span class="sxs-lookup"><span data-stu-id="d67c7-272">Figure 19 shows the Fields dialog box after these changes have been made; following that is the GridView's declarative markup.</span></span>

![配置 ButtonFields Text、CommandName 和 ButtonType 属性](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image49.png)

<span data-ttu-id="d67c7-274">**图 19**：配置 ButtonFields `Text`、`CommandName`和 `ButtonType` 属性</span><span class="sxs-lookup"><span data-stu-id="d67c7-274">**Figure 19**: Configure the ButtonFields `Text`, `CommandName`, and `ButtonType` Properties</span></span>

[!code-aspx[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample9.aspx)]

<span data-ttu-id="d67c7-275">创建这些 ButtonFields 后，最后一步是为 GridView `RowCommand` 事件创建事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="d67c7-275">With these ButtonFields created, the final step is to create an event handler for the GridView's `RowCommand` event.</span></span> <span data-ttu-id="d67c7-276">此事件处理程序（如果在单击 "价格 + 10%" 或 "价格-10%" 按钮的情况下被激发）需要确定单击按钮的行的 `ProductID`，然后调用 `ProductsBLL` 类的 `UpdateProduct` 方法，并传入相应的 `UnitPrice` 百分比调整和 `ProductID`。</span><span class="sxs-lookup"><span data-stu-id="d67c7-276">This event handler, if fired because either the Price +10% or Price -10% buttons were clicked, needs to determine the `ProductID` for the row whose button was clicked and then invoke the `ProductsBLL` class's `UpdateProduct` method, passing in the appropriate `UnitPrice` percentage adjustment along with the `ProductID`.</span></span> <span data-ttu-id="d67c7-277">以下代码执行这些任务：</span><span class="sxs-lookup"><span data-stu-id="d67c7-277">The following code performs these tasks:</span></span>

[!code-csharp[Main](adding-and-responding-to-buttons-to-a-gridview-cs/samples/sample10.cs)]

<span data-ttu-id="d67c7-278">若要确定单击了 "价格 + 10%" 或 "Price-10%" 按钮的行的 `ProductID`，需要查阅 GridView 的 `DataKeys` 集合。</span><span class="sxs-lookup"><span data-stu-id="d67c7-278">In order to determine the `ProductID` for the row whose Price +10% or Price -10% button was clicked, we need to consult the GridView's `DataKeys` collection.</span></span> <span data-ttu-id="d67c7-279">此集合保存每个 GridView 行的 `DataKeyNames` 属性中指定的字段的值。</span><span class="sxs-lookup"><span data-stu-id="d67c7-279">This collection holds the values of the fields specified in the `DataKeyNames` property for each GridView row.</span></span> <span data-ttu-id="d67c7-280">由于在将 ObjectDataSource 绑定到 GridView 时，GridView 的 `DataKeyNames` 属性已设置为 ProductID，因此 `DataKeys(rowIndex).Value` 为指定的*rowIndex*提供 `ProductID`。</span><span class="sxs-lookup"><span data-stu-id="d67c7-280">Since the GridView's `DataKeyNames` property was set to ProductID by Visual Studio when binding the ObjectDataSource to the GridView, `DataKeys(rowIndex).Value` provides the `ProductID` for the specified *rowIndex*.</span></span>

<span data-ttu-id="d67c7-281">ButtonField 自动传入其按钮通过 `e.CommandArgument` 参数单击的行的*rowIndex* 。</span><span class="sxs-lookup"><span data-stu-id="d67c7-281">The ButtonField automatically passes in the *rowIndex* of the row whose button was clicked through the `e.CommandArgument` parameter.</span></span> <span data-ttu-id="d67c7-282">因此，若要确定已单击 "价格 + 10%" 或 "Price-10%" 按钮的行的 `ProductID`，请使用： `Convert.ToInt32(SuppliersProducts.DataKeys(Convert.ToInt32(e.CommandArgument)).Value)`。</span><span class="sxs-lookup"><span data-stu-id="d67c7-282">Therefore, to determine the `ProductID` for the row whose Price +10% or Price -10% button was clicked, we use: `Convert.ToInt32(SuppliersProducts.DataKeys(Convert.ToInt32(e.CommandArgument)).Value)`.</span></span>

<span data-ttu-id="d67c7-283">对于 "停止所有产品" 按钮，如果禁用了 GridView 的视图状态，则将在每次回发时将 GridView 重新绑定到基础数据存储区，因此会立即更新以反映单击任意一个按钮。</span><span class="sxs-lookup"><span data-stu-id="d67c7-283">As with the Discontinue All Products button, if you have disabled the GridView's view state, the GridView is being rebound to the underlying data store on every postback, and therefore will immediately be updated to reflect a price change that occurs from clicking either of the buttons.</span></span> <span data-ttu-id="d67c7-284">但是，如果您在 GridView 中未禁用视图状态，则在进行此更改后，您将需要手动将数据重新绑定到 GridView。</span><span class="sxs-lookup"><span data-stu-id="d67c7-284">If, however, you have not disabled view state in the GridView, you will need to manually rebind the data to the GridView after making this change.</span></span> <span data-ttu-id="d67c7-285">若要实现此目的，只需在调用 `UpdateProduct` 方法之后立即调用 GridView 的 `DataBind()` 方法。</span><span class="sxs-lookup"><span data-stu-id="d67c7-285">To accomplish this, simply make a call to the GridView's `DataBind()` method immediately after invoking the `UpdateProduct` method.</span></span>

<span data-ttu-id="d67c7-286">图20显示了查看奶奶王 Homestead 提供的产品时的页面。</span><span class="sxs-lookup"><span data-stu-id="d67c7-286">Figure 20 shows the page when viewing the products provided by Grandma Kelly's Homestead.</span></span> <span data-ttu-id="d67c7-287">图21显示了为奶奶的 Boysenberry 传播两次单击 "价格 + 10%" 按钮后的结果，为 Northwoods Cranberry 酱单击了 "价格-10%" 按钮一次。</span><span class="sxs-lookup"><span data-stu-id="d67c7-287">Figure 21 shows the results after the Price +10% button has been clicked twice for Grandma's Boysenberry Spread and the Price -10% button once for Northwoods Cranberry Sauce.</span></span>

<span data-ttu-id="d67c7-288">[![GridView 包含价格 + 10% 和价格-10% 按钮](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image51.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image50.png)</span><span class="sxs-lookup"><span data-stu-id="d67c7-288">[![The GridView Includes Price +10% and Price -10% Buttons](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image51.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image50.png)</span></span>

<span data-ttu-id="d67c7-289">**图 20**： GridView 包含价格 + 10% 和价格-10% 按钮（[单击以查看完全大小的图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image52.png)）</span><span class="sxs-lookup"><span data-stu-id="d67c7-289">**Figure 20**: The GridView Includes Price +10% and Price -10% Buttons ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image52.png))</span></span>

<span data-ttu-id="d67c7-290">[![第一个和第三个产品的价格已通过价格 + 10% 和价格-10% 按钮进行更新](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image54.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image53.png)</span><span class="sxs-lookup"><span data-stu-id="d67c7-290">[![The Prices for the First and Third Product Have Been Updated via the Price +10% and Price -10% Buttons](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image54.png)](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image53.png)</span></span>

<span data-ttu-id="d67c7-291">**图 21**：第一个和第三个产品的价格已通过价格 + 10% 和价格-10% 按钮更新（[单击查看全尺寸图像](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image55.png)）</span><span class="sxs-lookup"><span data-stu-id="d67c7-291">**Figure 21**: The Prices for the First and Third Product Have Been Updated via the Price +10% and Price -10% Buttons ([Click to view full-size image](adding-and-responding-to-buttons-to-a-gridview-cs/_static/image55.png))</span></span>

> [!NOTE]
> <span data-ttu-id="d67c7-292">GridView （和 DetailsView）还可以将按钮、LinkButtons 或 ImageButtons 添加到其 Templatefield。</span><span class="sxs-lookup"><span data-stu-id="d67c7-292">The GridView (and DetailsView) can also have Buttons, LinkButtons, or ImageButtons added to their TemplateFields.</span></span> <span data-ttu-id="d67c7-293">与 BoundField 一样，单击这些按钮时，将引发回发，引发 GridView 的 `RowCommand` 事件。</span><span class="sxs-lookup"><span data-stu-id="d67c7-293">As with the BoundField, these Buttons, when clicked, will induce a postback, raising the GridView's `RowCommand` event.</span></span> <span data-ttu-id="d67c7-294">但是，当在 TemplateField 中添加按钮时，该按钮的 `CommandArgument` 不会自动设置为行的索引，因为使用 ButtonFields 时。</span><span class="sxs-lookup"><span data-stu-id="d67c7-294">When adding buttons in a TemplateField, however, the Button's `CommandArgument` is not automatically set to the index of the row as it is when using ButtonFields.</span></span> <span data-ttu-id="d67c7-295">如果需要确定在 `RowCommand` 事件处理程序中单击的按钮的行索引，则需要使用类似如下的代码，在 TemplateField 中手动设置该按钮的声明性语法中的 `CommandArgument` 属性：</span><span class="sxs-lookup"><span data-stu-id="d67c7-295">If you need to determine the row index of the button that was clicked within the `RowCommand` event handler, you'll need to manually set the Button's `CommandArgument` property in its declarative syntax within the TemplateField, using code like:</span></span>  
> <span data-ttu-id="d67c7-296">`<asp:Button runat="server" ... CommandArgument='<%# ((GridViewRow) Container).RowIndex %>'`。</span><span class="sxs-lookup"><span data-stu-id="d67c7-296">`<asp:Button runat="server" ... CommandArgument='<%# ((GridViewRow) Container).RowIndex %>'`.</span></span>

## <a name="summary"></a><span data-ttu-id="d67c7-297">摘要</span><span class="sxs-lookup"><span data-stu-id="d67c7-297">Summary</span></span>

<span data-ttu-id="d67c7-298">GridView、DetailsView 和 FormView 控件都可以包括按钮、LinkButtons 或 ImageButtons。</span><span class="sxs-lookup"><span data-stu-id="d67c7-298">The GridView, DetailsView, and FormView controls all can include Buttons, LinkButtons, or ImageButtons.</span></span> <span data-ttu-id="d67c7-299">当单击此类按钮时，会导致回发，并引发在 "FormView" 和 "DetailsView" 控件中的 `ItemCommand` 事件和 GridView 中的 `RowCommand` 事件。</span><span class="sxs-lookup"><span data-stu-id="d67c7-299">Such buttons, when clicked, cause a postback and raise the `ItemCommand` event in the FormView and DetailsView controls and the `RowCommand` event in the GridView.</span></span> <span data-ttu-id="d67c7-300">这些数据 Web 控件具有内置功能，可处理常见的命令相关操作，例如删除或编辑记录。</span><span class="sxs-lookup"><span data-stu-id="d67c7-300">These data Web controls have built-in functionality to handle common command-related actions, such as deleting or editing records.</span></span> <span data-ttu-id="d67c7-301">但是，我们还可以使用按钮，在单击该按钮时，会通过执行我们自己的自定义代码来做出响应。</span><span class="sxs-lookup"><span data-stu-id="d67c7-301">However, we can also use buttons that, when clicked, respond with executing our own custom code.</span></span>

<span data-ttu-id="d67c7-302">若要实现此目的，需要为 `ItemCommand` 或 `RowCommand` 事件创建事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="d67c7-302">To accomplish this, we need to create an event handler for the `ItemCommand` or `RowCommand` event.</span></span> <span data-ttu-id="d67c7-303">在此事件处理程序中，我们首先检查传入 `CommandName` 值以确定单击了哪个按钮，然后采取适当的自定义操作。</span><span class="sxs-lookup"><span data-stu-id="d67c7-303">In this event handler we first check the incoming `CommandName` value to determine which button was clicked and then take appropriate custom action.</span></span> <span data-ttu-id="d67c7-304">在本教程中，我们介绍了如何使用按钮和 ButtonFields 停止指定供应商的所有产品，或将特定产品的价格增加或降低10%。</span><span class="sxs-lookup"><span data-stu-id="d67c7-304">In this tutorial we saw how to use buttons and ButtonFields to discontinue all products for a specified supplier or to increase or decrease the price of a particular product by 10%.</span></span>

<span data-ttu-id="d67c7-305">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="d67c7-305">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="d67c7-306">关于作者</span><span class="sxs-lookup"><span data-stu-id="d67c7-306">About the Author</span></span>

<span data-ttu-id="d67c7-307">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，创始人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已在使用 Microsoft Web 技术，自1998开始。</span><span class="sxs-lookup"><span data-stu-id="d67c7-307">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="d67c7-308">Scott 的工作方式是独立的顾问、培训师和撰稿人。</span><span class="sxs-lookup"><span data-stu-id="d67c7-308">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="d67c7-309">他的最新书籍是，[*在24小时内，sam ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="d67c7-309">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="d67c7-310">可以[mitchell@4GuysFromRolla.com访问。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="d67c7-310">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="d67c7-311">或通过他的博客，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="d67c7-311">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="d67c7-312">下一部分</span><span class="sxs-lookup"><span data-stu-id="d67c7-312">Next</span></span>](adding-and-responding-to-buttons-to-a-gridview-vb.md)
