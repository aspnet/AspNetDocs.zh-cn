---
uid: web-forms/overview/data-access/displaying-data-with-the-datalist-and-repeater/formatting-the-datalist-and-repeater-based-upon-data-cs
title: 基于数据设置 DataList 和 Repeater 的格式（C#） |Microsoft Docs
author: rick-anderson
description: 在本教程中，我们将逐步介绍如何设置 DataList 和 Repeater 控件的外观格式的示例，方法是使用格式设置函数和 。
ms.author: riande
ms.date: 09/13/2006
ms.assetid: 83e3d759-82b8-41e6-8d62-f0f4b3edec41
msc.legacyurl: /web-forms/overview/data-access/displaying-data-with-the-datalist-and-repeater/formatting-the-datalist-and-repeater-based-upon-data-cs
msc.type: authoredcontent
ms.openlocfilehash: 68de3450ed97fc7bd0efb27e089d9db8e3e85fb0
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/06/2020
ms.locfileid: "78495554"
---
# <a name="formatting-the-datalist-and-repeater-based-upon-data-c"></a><span data-ttu-id="32bea-103">基于数据设置 DataList 和 Repeater 的格式 (C#)</span><span class="sxs-lookup"><span data-stu-id="32bea-103">Formatting the DataList and Repeater Based Upon Data (C#)</span></span>

<span data-ttu-id="32bea-104">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="32bea-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="32bea-105">[下载示例应用](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_30_CS.exe)或[下载 PDF](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/datatutorial30cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="32bea-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_30_CS.exe) or [Download PDF](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/datatutorial30cs1.pdf)</span></span>

> <span data-ttu-id="32bea-106">在本教程中，我们将逐步介绍如何设置 DataList 和 Repeater 控件的外观格式，方法是使用模板中的格式设置函数或处理数据绑定事件。</span><span class="sxs-lookup"><span data-stu-id="32bea-106">In this tutorial we'll step through examples of how we format the appearance of the DataList and Repeater controls, either by using formatting functions within templates or by handling the DataBound event.</span></span>

## <a name="introduction"></a><span data-ttu-id="32bea-107">简介</span><span class="sxs-lookup"><span data-stu-id="32bea-107">Introduction</span></span>

<span data-ttu-id="32bea-108">如前面的教程中所述，DataList 提供了许多与样式相关的属性，这些属性会影响其外观。</span><span class="sxs-lookup"><span data-stu-id="32bea-108">As we saw in the preceding tutorial, the DataList offers a number of style-related properties that affect its appearance.</span></span> <span data-ttu-id="32bea-109">具体而言，我们已了解如何向 DataList s 分配默认的 CSS 类 `HeaderStyle`、`ItemStyle`、`AlternatingItemStyle`和 `SelectedItemStyle` 属性。</span><span class="sxs-lookup"><span data-stu-id="32bea-109">In particular, we saw how to assign default CSS classes to the DataList s `HeaderStyle`, `ItemStyle`, `AlternatingItemStyle`, and `SelectedItemStyle` properties.</span></span> <span data-ttu-id="32bea-110">除了这四个属性，DataList 还包含许多其他样式相关的属性，例如 `Font`、`ForeColor`、`BackColor`和 `BorderWidth`等。</span><span class="sxs-lookup"><span data-stu-id="32bea-110">In addition to these four properties, the DataList includes a number of other style-related properties, such as `Font`, `ForeColor`, `BackColor`, and `BorderWidth`, to name a few.</span></span> <span data-ttu-id="32bea-111">Repeater 控件不包含任何与样式相关的属性。</span><span class="sxs-lookup"><span data-stu-id="32bea-111">The Repeater control does not contain any style-related properties.</span></span> <span data-ttu-id="32bea-112">任何此类样式设置都必须直接在 Repeater 模板的标记中进行。</span><span class="sxs-lookup"><span data-stu-id="32bea-112">Any such style settings must be made directly within the markup in the Repeater s templates.</span></span>

<span data-ttu-id="32bea-113">通常，如何设置数据的格式取决于数据本身。</span><span class="sxs-lookup"><span data-stu-id="32bea-113">Often, though, how data should be formatted depends on the data itself.</span></span> <span data-ttu-id="32bea-114">例如，在列出产品时，如果产品信息已停用，我们可能希望以浅灰色的字体颜色显示产品信息，或者，如果此值为零，则可能想要突出显示 `UnitsInStock` 值。</span><span class="sxs-lookup"><span data-stu-id="32bea-114">For example, when listing products we might want to display the product information in a light gray font color if it is discontinued, or we may want to highlight the `UnitsInStock` value if it is zero.</span></span> <span data-ttu-id="32bea-115">如前面的教程中所述，GridView、DetailsView 和 FormView 提供了两种不同的方法来根据数据的数据设置其外观：</span><span class="sxs-lookup"><span data-stu-id="32bea-115">As we saw in previous tutorials, the GridView, DetailsView, and FormView offer two distinct ways to format their appearance based on their data:</span></span>

- <span data-ttu-id="32bea-116">**`DataBound` 事件**为相应的 `DataBound` 事件创建事件处理程序，该事件处理程序在数据绑定到每一项后触发（对于 GridView，它是 `RowDataBound` 事件; 对于 DataList 和中继器，它是 `ItemDataBound` 事件）。</span><span class="sxs-lookup"><span data-stu-id="32bea-116">**The `DataBound` event** create an event handler for the appropriate `DataBound` event, which fires after the data has been bound to each item (for the GridView it was the `RowDataBound` event; for the DataList and Repeater it is the `ItemDataBound` event).</span></span> <span data-ttu-id="32bea-117">在该事件处理程序中，可以检查刚刚绑定的数据，并做出格式决策。</span><span class="sxs-lookup"><span data-stu-id="32bea-117">In that event handler, the data just bound can be examined and formatting decisions made.</span></span> <span data-ttu-id="32bea-118">我们[基于数据教程在自定义格式设置](../custom-formatting/custom-formatting-based-upon-data-cs.md)中检查了此方法。</span><span class="sxs-lookup"><span data-stu-id="32bea-118">We examined this technique in the [Custom Formatting Based Upon Data](../custom-formatting/custom-formatting-based-upon-data-cs.md) tutorial.</span></span>
- <span data-ttu-id="32bea-119">在 DetailsView 或 GridView 控件中使用 Templatefield 或使用 FormView 控件中的模板时，**模板中的格式设置**函数可以将格式设置函数添加到 ASP.NET 页的代码隐藏类、业务逻辑层或可从 web 应用程序访问的任何其他类库。</span><span class="sxs-lookup"><span data-stu-id="32bea-119">**Formatting Functions in Templates** when using TemplateFields in the DetailsView or GridView controls, or a template in the FormView control, we can add a formatting function to the ASP.NET page s code-behind class, the Business Logic Layer, or any other class library that is accessible from the web application.</span></span> <span data-ttu-id="32bea-120">此格式设置函数可以接受任意数量的输入参数，但必须返回要在模板中呈现的 HTML。</span><span class="sxs-lookup"><span data-stu-id="32bea-120">This formatting function can accept an arbitrary number of input parameters, but must return the HTML to render in the template.</span></span> <span data-ttu-id="32bea-121">首次[使用 GridView 控件](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md)教程中的 templatefield 检查格式设置函数。</span><span class="sxs-lookup"><span data-stu-id="32bea-121">Formatting functions were first examined in the [Using TemplateFields in the GridView Control](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md) tutorial.</span></span>

<span data-ttu-id="32bea-122">这两种格式设置方法均可用于 DataList 和 Repeater 控件。</span><span class="sxs-lookup"><span data-stu-id="32bea-122">Both of these formatting techniques are available with the DataList and Repeater controls.</span></span> <span data-ttu-id="32bea-123">在本教程中，我们将逐步介绍如何对这两个控件使用这两种方法。</span><span class="sxs-lookup"><span data-stu-id="32bea-123">In this tutorial we'll step through examples using both techniques for both controls.</span></span>

## <a name="using-theitemdataboundevent-handler"></a><span data-ttu-id="32bea-124">使用`ItemDataBound`事件处理程序</span><span class="sxs-lookup"><span data-stu-id="32bea-124">Using the`ItemDataBound`Event Handler</span></span>

<span data-ttu-id="32bea-125">当数据绑定到 DataList 时，无论是通过数据源控件还是以编程方式将数据分配给控件的 `DataSource` 属性并调用其 `DataBind()` 方法，会触发 DataList s `DataBinding` 事件，枚举的数据源，每个数据记录都绑定到 DataList。</span><span class="sxs-lookup"><span data-stu-id="32bea-125">When data is bound to a DataList, either from a data source control or through programmatically assigning data to the control s `DataSource` property and calling its `DataBind()` method, the DataList s `DataBinding` event fires, the data source enumerated, and each data record is bound to the DataList.</span></span> <span data-ttu-id="32bea-126">对于数据源中的每个记录，DataList 创建一个[`DataListItem`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalistitem.aspx)对象，然后将其绑定到当前记录。</span><span class="sxs-lookup"><span data-stu-id="32bea-126">For each record in the data source, the DataList creates a [`DataListItem`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalistitem.aspx) object that is then bound to the current record.</span></span> <span data-ttu-id="32bea-127">在此过程中，DataList 将引发两个事件：</span><span class="sxs-lookup"><span data-stu-id="32bea-127">During this process, the DataList raises two events:</span></span>

- <span data-ttu-id="32bea-128">在创建 `DataListItem` 之后 **`ItemCreated`** 激发</span><span class="sxs-lookup"><span data-stu-id="32bea-128">**`ItemCreated`** fires after the `DataListItem` has been created</span></span>
- <span data-ttu-id="32bea-129">当前记录绑定到 `DataListItem` 之后 **`ItemDataBound`** 激发</span><span class="sxs-lookup"><span data-stu-id="32bea-129">**`ItemDataBound`** fires after the current record has been bound to the `DataListItem`</span></span>

<span data-ttu-id="32bea-130">以下步骤概述了 DataList 控件的数据绑定过程。</span><span class="sxs-lookup"><span data-stu-id="32bea-130">The following steps outline the data binding process for the DataList control.</span></span>

1. <span data-ttu-id="32bea-131">引发 DataList s [`DataBinding` 事件](https://msdn.microsoft.com/library/system.web.ui.control.databinding.aspx)</span><span class="sxs-lookup"><span data-stu-id="32bea-131">The DataList s [`DataBinding` event](https://msdn.microsoft.com/library/system.web.ui.control.databinding.aspx) fires</span></span>
2. <span data-ttu-id="32bea-132">数据绑定到 DataList</span><span class="sxs-lookup"><span data-stu-id="32bea-132">The data is bound to the DataList</span></span>  
  
   <span data-ttu-id="32bea-133">对于数据源中的每个记录</span><span class="sxs-lookup"><span data-stu-id="32bea-133">For each record in the data source</span></span> 

    1. <span data-ttu-id="32bea-134">创建 `DataListItem` 对象</span><span class="sxs-lookup"><span data-stu-id="32bea-134">Create a `DataListItem` object</span></span>
    2. <span data-ttu-id="32bea-135">激发[`ItemCreated` 事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.itemcreated.aspx)</span><span class="sxs-lookup"><span data-stu-id="32bea-135">Fire the [`ItemCreated` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.itemcreated.aspx)</span></span>
    3. <span data-ttu-id="32bea-136">将记录绑定到 `DataListItem`</span><span class="sxs-lookup"><span data-stu-id="32bea-136">Bind the record to the `DataListItem`</span></span>
    4. <span data-ttu-id="32bea-137">激发[`ItemDataBound` 事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.itemdatabound.aspx)</span><span class="sxs-lookup"><span data-stu-id="32bea-137">Fire the [`ItemDataBound` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.itemdatabound.aspx)</span></span>
    5. <span data-ttu-id="32bea-138">将 `DataListItem` 添加到 `Items` 集合</span><span class="sxs-lookup"><span data-stu-id="32bea-138">Add the `DataListItem` to the `Items` collection</span></span>

<span data-ttu-id="32bea-139">在将数据绑定到 Repeater 控件时，它会经历完全相同的步骤顺序。</span><span class="sxs-lookup"><span data-stu-id="32bea-139">When binding data to the Repeater control, it progresses through the exact same sequence of steps.</span></span> <span data-ttu-id="32bea-140">唯一的区别是，中继器使用[`RepeaterItem`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeateritem(VS.80).aspx)，而不是创建 `DataListItem` 实例。</span><span class="sxs-lookup"><span data-stu-id="32bea-140">The only difference is that instead of `DataListItem` instances being created, the Repeater uses [`RepeaterItem`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeateritem(VS.80).aspx)s.</span></span>

> [!NOTE]
> <span data-ttu-id="32bea-141">敏锐读取器可能已注意到，当 DataList 和 Repeater 绑定到数据时，以及 GridView 绑定到数据时所发生的一系列步骤之间发生了略微异常。</span><span class="sxs-lookup"><span data-stu-id="32bea-141">The astute reader may have noticed a slight anomaly between the sequence of steps that transpire when the DataList and Repeater are bound to data versus when the GridView is bound to data.</span></span> <span data-ttu-id="32bea-142">在数据绑定过程的结尾处，GridView 引发 `DataBound` 事件;但是，DataList 和 Repeater 控件都没有此类事件。</span><span class="sxs-lookup"><span data-stu-id="32bea-142">At the tail end of the data binding process, the GridView raises the `DataBound` event; however, neither the DataList nor Repeater control have such an event.</span></span> <span data-ttu-id="32bea-143">这是因为 DataList 和 Repeater 控件是在 ASP.NET 1.x 时间范围内创建的，并且在前期和后期级别事件处理程序模式变得很常见之前。</span><span class="sxs-lookup"><span data-stu-id="32bea-143">This is because the DataList and Repeater controls were created back in the ASP.NET 1.x timeframe, before the pre- and post-level event handler pattern had become common.</span></span>

<span data-ttu-id="32bea-144">与 GridView 一样，根据数据进行格式设置的一个选项是为 `ItemDataBound` 事件创建事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="32bea-144">Like with the GridView, one option for formatting based on the data is to create an event handler for the `ItemDataBound` event.</span></span> <span data-ttu-id="32bea-145">此事件处理程序将检查刚刚绑定到 `DataListItem` 或 `RepeaterItem` 的数据，并根据需要影响该控件的格式设置。</span><span class="sxs-lookup"><span data-stu-id="32bea-145">This event handler would inspect the data that had just been bound to the `DataListItem` or `RepeaterItem` and affect the formatting of the control as needed.</span></span>

<span data-ttu-id="32bea-146">对于 DataList 控件，可以使用与 `DataListItem` 的样式相关的属性来实现整个项的格式更改，其中包括标准 `Font`、`ForeColor`、`BackColor`、`CssClass`等。</span><span class="sxs-lookup"><span data-stu-id="32bea-146">For the DataList control, formatting changes for the entire item can be implemented using the `DataListItem` s style-related properties, which include the standard `Font`, `ForeColor`, `BackColor`, `CssClass`, and so on.</span></span> <span data-ttu-id="32bea-147">若要影响 DataList s 模板中特定 Web 控件的格式设置，需要以编程方式访问和修改这些 Web 控件的样式。</span><span class="sxs-lookup"><span data-stu-id="32bea-147">To affect the formatting of particular Web controls within the DataList s template, we need to programmatically access and modify the style of those Web controls.</span></span> <span data-ttu-id="32bea-148">我们已经了解了如何*基于数据*教程来完成此操作。</span><span class="sxs-lookup"><span data-stu-id="32bea-148">We saw how to accomplish this back in the *Custom Formatting Based Upon Data* tutorial.</span></span> <span data-ttu-id="32bea-149">与 Repeater 控件一样，`RepeaterItem` 类没有与样式相关的属性;因此，必须通过编程方式访问和更新模板中的 Web 控件，对 `ItemDataBound` 事件处理程序中的 `RepeaterItem` 所做的所有与样式相关的更改。</span><span class="sxs-lookup"><span data-stu-id="32bea-149">Like the Repeater control, the `RepeaterItem` class has no style-related properties; therefore, all style-related changes made to a `RepeaterItem` in the `ItemDataBound` event handler must be done by programmatically accessing and updating Web controls within the template.</span></span>

<span data-ttu-id="32bea-150">由于 DataList 和 Repeater `ItemDataBound` 的格式设置方法几乎完全相同，因此我们的示例将重点介绍如何使用 DataList。</span><span class="sxs-lookup"><span data-stu-id="32bea-150">Since the `ItemDataBound` formatting technique for the DataList and Repeater are virtually identical, our example will focus on using the DataList.</span></span>

## <a name="step-1-displaying-product-information-in-the-datalist"></a><span data-ttu-id="32bea-151">步骤1：在 DataList 中显示产品信息</span><span class="sxs-lookup"><span data-stu-id="32bea-151">Step 1: Displaying Product Information in the DataList</span></span>

<span data-ttu-id="32bea-152">在对格式进行担忧之前，先创建一个使用 DataList 显示产品信息的页面。</span><span class="sxs-lookup"><span data-stu-id="32bea-152">Before we worry about the formatting, let s first create a page that uses a DataList to display product information.</span></span> <span data-ttu-id="32bea-153">在[上一教程](displaying-data-with-the-datalist-and-repeater-controls-cs.md)中，我们创建了一个 DataList，其 `ItemTemplate` 显示每个产品的名称、类别、供应商、每个单位的数量和价格。</span><span class="sxs-lookup"><span data-stu-id="32bea-153">In the [previous tutorial](displaying-data-with-the-datalist-and-repeater-controls-cs.md) we created a DataList whose `ItemTemplate` displayed each product s name, category, supplier, quantity per unit, and price.</span></span> <span data-ttu-id="32bea-154">在本教程中，让我们重复此功能。</span><span class="sxs-lookup"><span data-stu-id="32bea-154">Let s repeat this functionality here in this tutorial.</span></span> <span data-ttu-id="32bea-155">若要实现此目的，可以从头开始重新创建 DataList 及其 ObjectDataSource，也可以从上一教程中创建的页面（`Basics.aspx`）复制这些控件，并将其粘贴到本教程的页面（`Formatting.aspx`）。</span><span class="sxs-lookup"><span data-stu-id="32bea-155">To accomplish this, you can either recreate the DataList and its ObjectDataSource from scratch, or you can copy over those controls from the page created in the previous tutorial (`Basics.aspx`) and paste them into the page for this tutorial (`Formatting.aspx`).</span></span>

<span data-ttu-id="32bea-156">将 DataList 和 ObjectDataSource 功能从 `Basics.aspx` 复制到 `Formatting.aspx`中后，请花点时间将 DataList s `ID` 属性从 `DataList1` 更改为更具描述性的 `ItemDataBoundFormattingExample`。</span><span class="sxs-lookup"><span data-stu-id="32bea-156">Once you have replicated the DataList and ObjectDataSource functionality from `Basics.aspx` into `Formatting.aspx`, take a moment to change the DataList s `ID` property from `DataList1` to a more descriptive `ItemDataBoundFormattingExample`.</span></span> <span data-ttu-id="32bea-157">接下来，在浏览器中查看 DataList。</span><span class="sxs-lookup"><span data-stu-id="32bea-157">Next, view the DataList in a browser.</span></span> <span data-ttu-id="32bea-158">如图1所示，每个产品之间唯一的格式设置差别在于背景色是备用的。</span><span class="sxs-lookup"><span data-stu-id="32bea-158">As Figure 1 shows, the only formatting difference between each product is that the background color alternates.</span></span>

<span data-ttu-id="32bea-159">[!["DataList" 控件中列出的产品](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image2.png)](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="32bea-159">[![The Products are Listed in the DataList Control](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image2.png)](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image1.png)</span></span>

<span data-ttu-id="32bea-160">**图 1**： "DataList" 控件中列出了产品（[单击以查看完全大小的图像](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="32bea-160">**Figure 1**: The Products are Listed in the DataList Control ([Click to view full-size image](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image3.png))</span></span>

<span data-ttu-id="32bea-161">对于本教程，让我们设置 DataList 的格式，以便价格低于 $20.00 的任何产品都将其名称和单价突出显示为黄色。</span><span class="sxs-lookup"><span data-stu-id="32bea-161">For this tutorial, let s format the DataList such that any products with a price less than $20.00 will have both its name and unit price highlighted yellow.</span></span>

## <a name="step-2-programmatically-determining-the-value-of-the-data-in-the-itemdatabound-event-handler"></a><span data-ttu-id="32bea-162">步骤2：以编程方式确定 ItemDataBound 事件处理程序中的数据值</span><span class="sxs-lookup"><span data-stu-id="32bea-162">Step 2: Programmatically Determining the Value of the Data in the ItemDataBound Event Handler</span></span>

<span data-ttu-id="32bea-163">由于只有价格低于 $20.00 的产品会应用自定义格式，因此我们必须能够确定每种产品的价格。</span><span class="sxs-lookup"><span data-stu-id="32bea-163">Since only those products with a price under $20.00 will have the custom formatting applied, we must be able to determine each product s price.</span></span> <span data-ttu-id="32bea-164">在将数据绑定到 DataList 时，DataList 将枚举其数据源中的记录，并为每个记录创建一个 `DataListItem` 实例，将数据源记录绑定到 `DataListItem`。</span><span class="sxs-lookup"><span data-stu-id="32bea-164">When binding data to a DataList, the DataList enumerates the records in its data source and, for each record, creates a `DataListItem` instance, binding the data source record to the `DataListItem`.</span></span> <span data-ttu-id="32bea-165">将特定记录的数据绑定到当前 `DataListItem` 对象之后，将触发 DataList s `ItemDataBound` 事件。</span><span class="sxs-lookup"><span data-stu-id="32bea-165">After the particular record s data has been bound to the current `DataListItem` object, the DataList s `ItemDataBound` event is fired.</span></span> <span data-ttu-id="32bea-166">我们可以为此事件创建事件处理程序，以检查当前 `DataListItem` 的数据值，并根据这些值进行任何格式更改。</span><span class="sxs-lookup"><span data-stu-id="32bea-166">We can create an event handler for this event to inspect the data values for the current `DataListItem` and, based upon those values, make any formatting changes necessary.</span></span>

<span data-ttu-id="32bea-167">为 DataList 创建 `ItemDataBound` 事件，并添加以下代码：</span><span class="sxs-lookup"><span data-stu-id="32bea-167">Create an `ItemDataBound` event for the DataList and add the following code:</span></span>

[!code-csharp[Main](formatting-the-datalist-and-repeater-based-upon-data-cs/samples/sample1.cs)]

<span data-ttu-id="32bea-168">尽管 DataList `ItemDataBound` 事件处理程序背后的概念和语义与*基于数据教程的自定义格式设置*中的 GridView `RowDataBound` 事件处理程序所使用的概念和语义相同，但语法略有不同。</span><span class="sxs-lookup"><span data-stu-id="32bea-168">While the concept and semantics behind the DataList s `ItemDataBound` event handler are the same as those used by the GridView s `RowDataBound` event handler in the *Custom Formatting Based Upon Data* tutorial, the syntax differs slightly.</span></span> <span data-ttu-id="32bea-169">当 `ItemDataBound` 事件触发时，绑定到数据的 `DataListItem` 将通过 `e.Item` （而不是 `e.Row`，与 GridView `RowDataBound` 事件处理程序）传递到相应的事件处理程序中。</span><span class="sxs-lookup"><span data-stu-id="32bea-169">When the `ItemDataBound` event fires, the `DataListItem` just bound to data is passed into corresponding event handler via `e.Item` (instead of `e.Row`, as with the GridView s `RowDataBound` event handler).</span></span> <span data-ttu-id="32bea-170">对于添加到 DataList 的*每个*行（包括标题行、行尾行和分隔符行），将激发 datalist `ItemDataBound` 事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="32bea-170">The DataList s `ItemDataBound` event handler fires for *each* row added to the DataList, including header rows, footer rows, and separator rows.</span></span> <span data-ttu-id="32bea-171">但是，产品信息仅绑定到数据行。</span><span class="sxs-lookup"><span data-stu-id="32bea-171">However, the product information is only bound to the data rows.</span></span> <span data-ttu-id="32bea-172">因此，在使用 `ItemDataBound` 事件检查绑定到 DataList 的数据时，我们需要首先确保我们使用数据项。</span><span class="sxs-lookup"><span data-stu-id="32bea-172">Therefore, when using the `ItemDataBound` event to inspect the data bound to the DataList, we need to first ensure that we re working with a data item.</span></span> <span data-ttu-id="32bea-173">这可以通过检查 `DataListItem` s [`ItemType` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalistitem.itemtype.aspx)来完成，该属性可以具有[以下8个值](https://msdn.microsoft.com/library/system.web.ui.webcontrols.listitemtype.aspx)之一：</span><span class="sxs-lookup"><span data-stu-id="32bea-173">This can be accomplished by checking the `DataListItem` s [`ItemType` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalistitem.itemtype.aspx), which can have one of [the following eight values](https://msdn.microsoft.com/library/system.web.ui.webcontrols.listitemtype.aspx):</span></span>

- `AlternatingItem`
- `EditItem`
- `Footer`
- `Header`
- `Item`
- `Pager`
- `SelectedItem`
- `Separator`

<span data-ttu-id="32bea-174">`Item` 和 `AlternatingItem``DataListItem` 均构成 DataList 的数据项。</span><span class="sxs-lookup"><span data-stu-id="32bea-174">Both `Item` and `AlternatingItem``DataListItem` s makeup the DataList s data items.</span></span> <span data-ttu-id="32bea-175">假设我们要使用 `Item` 或 `AlternatingItem`，则可以访问已绑定到当前 `DataListItem`的实际 `ProductsRow` 的实例。</span><span class="sxs-lookup"><span data-stu-id="32bea-175">Assuming we re working with an `Item` or `AlternatingItem`, we access the actual `ProductsRow` instance that was bound to the current `DataListItem`.</span></span> <span data-ttu-id="32bea-176">`DataListItem` s [`DataItem` 属性](https://msdn.microsoft.com/system.web.ui.webcontrols.datalistitem.dataitem.aspx)包含对 `DataRowView` 对象的引用，该对象的 `Row` 属性提供对实际 `ProductsRow` 对象的引用。</span><span class="sxs-lookup"><span data-stu-id="32bea-176">The `DataListItem` s [`DataItem` property](https://msdn.microsoft.com/system.web.ui.webcontrols.datalistitem.dataitem.aspx) contains a reference to the `DataRowView` object, whose `Row` property provides a reference to the actual `ProductsRow` object.</span></span>

<span data-ttu-id="32bea-177">接下来，检查 `ProductsRow` 实例的 `UnitPrice` 属性。</span><span class="sxs-lookup"><span data-stu-id="32bea-177">Next, we check the `ProductsRow` instance s `UnitPrice` property.</span></span> <span data-ttu-id="32bea-178">由于 Products 表的 `UnitPrice` 字段允许 `NULL` 值，因此在尝试访问 `UnitPrice` 属性之前，首先应查看它是否具有使用 `IsUnitPriceNull()` 方法的 `NULL` 值。</span><span class="sxs-lookup"><span data-stu-id="32bea-178">Since the Products table s `UnitPrice` field allows `NULL` values, before attempting to access the `UnitPrice` property we should first check to see if it has a `NULL` value using the `IsUnitPriceNull()` method.</span></span> <span data-ttu-id="32bea-179">如果未 `NULL``UnitPrice` 值，我们会检查它是否小于 $20.00。</span><span class="sxs-lookup"><span data-stu-id="32bea-179">If the `UnitPrice` value is not `NULL`, we then check to see if it s less than $20.00.</span></span> <span data-ttu-id="32bea-180">如果它确实低于 $20.00，则需要应用自定义格式设置。</span><span class="sxs-lookup"><span data-stu-id="32bea-180">If it is indeed under $20.00, we then need to apply the custom formatting.</span></span>

## <a name="step-3-highlighting-the-product-s-name-and-price"></a><span data-ttu-id="32bea-181">步骤3：突出显示产品的名称和价格</span><span class="sxs-lookup"><span data-stu-id="32bea-181">Step 3: Highlighting the Product s Name and Price</span></span>

<span data-ttu-id="32bea-182">知道产品价格低于 $20.00 后，剩下的就是强调其名称和价格。</span><span class="sxs-lookup"><span data-stu-id="32bea-182">Once we know that a product s price is less than $20.00, all that remains is to highlight its name and price.</span></span> <span data-ttu-id="32bea-183">若要实现此目的，必须先以编程方式引用 `ItemTemplate` 中显示产品的名称和价格的 "标签" 控件。</span><span class="sxs-lookup"><span data-stu-id="32bea-183">To accomplish this, we must first programmatically reference the Label controls in the `ItemTemplate` that display the product s name and price.</span></span> <span data-ttu-id="32bea-184">接下来，需要使它们显示黄色背景。</span><span class="sxs-lookup"><span data-stu-id="32bea-184">Next, we need to have them display a yellow background.</span></span> <span data-ttu-id="32bea-185">此格式设置信息可通过直接修改 `BackColor` 属性（`LabelID.BackColor = Color.Yellow`）的标签来应用;不过，理想情况下，所有与显示相关的问题都应该通过级联样式表来表示。</span><span class="sxs-lookup"><span data-stu-id="32bea-185">This formatting information can be applied by directly modifying the Labels `BackColor` properties (`LabelID.BackColor = Color.Yellow`); ideally, though, all display-related matters should be expressed through cascading stylesheets.</span></span> <span data-ttu-id="32bea-186">事实上，我们已经有了一个样式表，它提供了 `Styles.css` - `AffordablePriceEmphasis`中定义的所需格式，该格式已在*基于数据的自定义格式设置*教程中创建和讨论。</span><span class="sxs-lookup"><span data-stu-id="32bea-186">In fact, we already have a stylesheet that provides the desired formatting defined in `Styles.css` - `AffordablePriceEmphasis`, which was created and discussed in the *Custom Formatting Based Upon Data* tutorial.</span></span>

<span data-ttu-id="32bea-187">若要应用格式设置，只需将两个标签 Web 控件 `CssClass` 属性设置为 `AffordablePriceEmphasis`，如下面的代码所示：</span><span class="sxs-lookup"><span data-stu-id="32bea-187">To apply the formatting, simply set the two Label Web controls `CssClass` properties to `AffordablePriceEmphasis`, as shown in the following code:</span></span>

[!code-csharp[Main](formatting-the-datalist-and-repeater-based-upon-data-cs/samples/sample2.cs)]

<span data-ttu-id="32bea-188">完成 `ItemDataBound` 事件处理程序后，请在浏览器中重新访问 `Formatting.aspx` 页面。</span><span class="sxs-lookup"><span data-stu-id="32bea-188">With the `ItemDataBound` event handler completed, revisit the `Formatting.aspx` page in a browser.</span></span> <span data-ttu-id="32bea-189">如图2所示，价格低于 $20.00 的产品会突出显示其名称和价格。</span><span class="sxs-lookup"><span data-stu-id="32bea-189">As Figure 2 illustrates, those products with a price under $20.00 have both their name and price highlighted.</span></span>

<span data-ttu-id="32bea-190">[![突出显示小于 $20.00 的产品](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image5.png)](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="32bea-190">[![Those Products Less than $20.00 are Highlighted](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image5.png)](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image4.png)</span></span>

<span data-ttu-id="32bea-191">**图 2**：突出显示小于 $20.00 的产品（[单击以查看完全大小的图像](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="32bea-191">**Figure 2**: Those Products Less than $20.00 are Highlighted ([Click to view full-size image](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image6.png))</span></span>

> [!NOTE]
> <span data-ttu-id="32bea-192">由于 DataList 呈现为 HTML `<table>`，因此其 `DataListItem` 实例具有与样式相关的属性，这些属性可设置为将特定样式应用于整个项。</span><span class="sxs-lookup"><span data-stu-id="32bea-192">Since the DataList is rendered as an HTML `<table>`, its `DataListItem` instances have style-related properties that can be set to apply a specific style to the entire item.</span></span> <span data-ttu-id="32bea-193">例如，如果要在其价格低于 $20.00 时突出显示*整个*项黄色，则可以使用以下代码行替换引用标签的代码，并设置其 `CssClass` 属性： `e.Item.CssClass = "AffordablePriceEmphasis"` （请参阅图3）。</span><span class="sxs-lookup"><span data-stu-id="32bea-193">For example, if we wanted to highlight the *entire* item yellow when its price was less than $20.00, we could have replaced the code that referenced the Labels and set their `CssClass` properties with the following line of code: `e.Item.CssClass = "AffordablePriceEmphasis"` (see Figure 3).</span></span>

<span data-ttu-id="32bea-194">构成 Repeater 控件的 `RepeaterItem`，但不提供此类样式级属性。</span><span class="sxs-lookup"><span data-stu-id="32bea-194">The `RepeaterItem` s that make up the Repeater control, however, don t offer such style-level properties.</span></span> <span data-ttu-id="32bea-195">因此，将自定义格式应用于中继器需要将样式属性应用到 Repeater 模板内的 Web 控件，就像我们在图2中所做的一样。</span><span class="sxs-lookup"><span data-stu-id="32bea-195">Therefore, applying custom formatting to the Repeater requires the application of style properties to the Web controls within the Repeater s templates, just like we did in Figure 2.</span></span>

<span data-ttu-id="32bea-196">[![在 $20.00 下突出显示产品的整个产品项](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image8.png)](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="32bea-196">[![The Entire Product Item is Highlighted for Products Under $20.00](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image8.png)](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image7.png)</span></span>

<span data-ttu-id="32bea-197">**图 3**：在 $20.00 下突出显示产品的整个产品项（[单击以查看完全大小的图像](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="32bea-197">**Figure 3**: The Entire Product Item is Highlighted for Products Under $20.00 ([Click to view full-size image](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image9.png))</span></span>

## <a name="using-formatting-functions-from-within-the-template"></a><span data-ttu-id="32bea-198">在模板中使用格式设置函数</span><span class="sxs-lookup"><span data-stu-id="32bea-198">Using Formatting Functions from Within the Template</span></span>

<span data-ttu-id="32bea-199">在 GridView 控件教程中的 "*使用 templatefield* " 教程中，我们看到了如何使用 gridview TemplateField 内的格式设置函数根据绑定到 GridView 行的数据应用自定义格式设置。</span><span class="sxs-lookup"><span data-stu-id="32bea-199">In the *Using TemplateFields in the GridView Control* tutorial we saw how to use a formatting function within a GridView TemplateField to apply custom formatting based upon the data bound to the GridView s rows.</span></span> <span data-ttu-id="32bea-200">格式设置函数是一种方法，可从模板调用，并返回要在其位置发出的 HTML。</span><span class="sxs-lookup"><span data-stu-id="32bea-200">A formatting function is a method that can be invoked from a template and returns the HTML to be emitted in its place.</span></span> <span data-ttu-id="32bea-201">格式设置函数可以位于 ASP.NET 页 s 代码隐藏类中，也可以集中到 `App_Code` 文件夹或单独类库项目中的类文件中。</span><span class="sxs-lookup"><span data-stu-id="32bea-201">Formatting functions can reside in the ASP.NET page s code-behind class or can be centralized into class files in the `App_Code` folder or in a separate Class Library project.</span></span> <span data-ttu-id="32bea-202">如果你计划在多个 ASP.NET 页面或其他 ASP.NET web 应用程序中使用相同的格式设置功能，则将格式设置函数移出 ASP.NET 页的代码隐藏类是理想之选。</span><span class="sxs-lookup"><span data-stu-id="32bea-202">Moving the formatting function out of the ASP.NET page s code-behind class is ideal if you plan on using the same formatting function in multiple ASP.NET pages or in other ASP.NET web applications.</span></span>

<span data-ttu-id="32bea-203">若要演示格式设置功能，请在产品名为 "已停用" 时让 s 中的文本 [已停用]。</span><span class="sxs-lookup"><span data-stu-id="32bea-203">To demonstrate formatting functions, let s have the product information include the text [DISCONTINUED] next to the product s name if it s discontinued.</span></span> <span data-ttu-id="32bea-204">此外，如果小于 $20.00，则将价格突出显示为黄色（如我们在 `ItemDataBound` 事件处理程序示例中所做的那样）;如果价格为 $20.00 或更高，则让我们不显示实际价格，而是改为使用价格报价。</span><span class="sxs-lookup"><span data-stu-id="32bea-204">Also, let s have the price highlighted yellow if it s less than $20.00 (as we did in the `ItemDataBound` event handler example); if the price is $20.00 or higher, let s not display the actual price, but instead the text, Please call for a price quote.</span></span> <span data-ttu-id="32bea-205">图4显示了应用这些格式设置规则的产品列表的屏幕截图。</span><span class="sxs-lookup"><span data-stu-id="32bea-205">Figure 4 shows a screen shot of the products listing with these formatting rules applied.</span></span>

<span data-ttu-id="32bea-206">[![成本高昂的产品，则会将价格替换为文本，请拨打价格报价](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image11.png)](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="32bea-206">[![For Expensive Products, the Price is Replaced with the Text, Please call for a price quote](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image11.png)](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image10.png)</span></span>

<span data-ttu-id="32bea-207">**图 4**：对于昂贵的产品，价格将替换为文本，请拨打价格报价（[单击查看全尺寸图像](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="32bea-207">**Figure 4**: For Expensive Products, the Price is Replaced with the Text, Please call for a price quote ([Click to view full-size image](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image12.png))</span></span>

## <a name="step-1-create-the-formatting-functions"></a><span data-ttu-id="32bea-208">步骤1：创建格式设置函数</span><span class="sxs-lookup"><span data-stu-id="32bea-208">Step 1: Create the Formatting Functions</span></span>

<span data-ttu-id="32bea-209">在此示例中，我们需要两个格式设置功能，一个用于显示产品名称以及文本 [已停用]，如有需要，另一个显示突出显示的价格（如果小于 $20.00）或文本，请拨打价格报价。</span><span class="sxs-lookup"><span data-stu-id="32bea-209">For this example we need two formatting functions, one that displays the product name along with the text [DISCONTINUED], if needed, and another that displays either a highlighted price if it s less than $20.00, or the text, Please call for a price quote otherwise.</span></span> <span data-ttu-id="32bea-210">让我们在 ASP.NET 页 s 代码隐藏类中创建这些函数，并将它们命名为 `DisplayProductNameAndDiscontinuedStatus` 和 `DisplayPrice`。</span><span class="sxs-lookup"><span data-stu-id="32bea-210">Let s create these functions in the ASP.NET page s code-behind class and name them `DisplayProductNameAndDiscontinuedStatus` and `DisplayPrice`.</span></span> <span data-ttu-id="32bea-211">这两种方法都需要以字符串的形式返回要呈现的 HTML，并且两者都需要标记 `Protected` （或 `Public`），以便从 ASP.NET 页的声明性语法部分进行调用。</span><span class="sxs-lookup"><span data-stu-id="32bea-211">Both methods need to return the HTML to render as a string and both need to be marked `Protected` (or `Public`) in order to be invoked from the ASP.NET page s declarative syntax portion.</span></span> <span data-ttu-id="32bea-212">以下两种方法的代码如下所示：</span><span class="sxs-lookup"><span data-stu-id="32bea-212">The code for these two methods follows:</span></span>

[!code-csharp[Main](formatting-the-datalist-and-repeater-based-upon-data-cs/samples/sample3.cs)]

<span data-ttu-id="32bea-213">请注意，`DisplayProductNameAndDiscontinuedStatus` 方法接受 `productName` 的值并将数据字段作为标量值 `discontinued`，而 `DisplayPrice` 方法接受 `ProductsRow` 的实例（而不是标量值）。`unitPrice`</span><span class="sxs-lookup"><span data-stu-id="32bea-213">Note that the `DisplayProductNameAndDiscontinuedStatus` method accepts the values of the `productName` and `discontinued` data fields as scalar values, whereas the `DisplayPrice` method accepts a `ProductsRow` instance (rather than a `unitPrice` scalar value).</span></span> <span data-ttu-id="32bea-214">这两种方法都可行;但是，如果格式设置函数使用的标量值可以包含数据库 `NULL` 值（如 `UnitPrice`，则 `ProductName` 和 `Discontinued` 都不允许 `NULL` 值），则在处理这些标量输入时必须特别小心。</span><span class="sxs-lookup"><span data-stu-id="32bea-214">Either approach will work; however, if the formatting function is working with scalar values that can contain database `NULL` values (such as `UnitPrice`; neither `ProductName` nor `Discontinued` allow `NULL` values), special care must be taken in handling these scalar inputs.</span></span>

<span data-ttu-id="32bea-215">特别是，输入参数的类型必须为 `Object`，因为传入的值可能是 `DBNull` 实例，而不是预期的数据类型。</span><span class="sxs-lookup"><span data-stu-id="32bea-215">In particular, the input parameter must be of type `Object` since the incoming value might be a `DBNull` instance instead of the expected data type.</span></span> <span data-ttu-id="32bea-216">此外，必须进行检查以确定传入的值是否为数据库 `NULL` 值。</span><span class="sxs-lookup"><span data-stu-id="32bea-216">Additionally, a check must be made to determine whether or not the incoming value is a database `NULL` value.</span></span> <span data-ttu-id="32bea-217">也就是说，如果我们希望 `DisplayPrice` 方法接受作为标量值的价格，则需要使用以下代码：</span><span class="sxs-lookup"><span data-stu-id="32bea-217">That is, if we wanted the `DisplayPrice` method to accept the price as a scalar value, we d have to use the following code:</span></span>

[!code-csharp[Main](formatting-the-datalist-and-repeater-based-upon-data-cs/samples/sample4.cs)]

<span data-ttu-id="32bea-218">请注意，`unitPrice` 输入参数的类型为 `Object`，并且已修改条件语句以确定是否 `DBNull` `unitPrice`。</span><span class="sxs-lookup"><span data-stu-id="32bea-218">Note that the `unitPrice` input parameter is of type `Object` and that the conditional statement has been modified to ascertain if `unitPrice` is `DBNull` or not.</span></span> <span data-ttu-id="32bea-219">此外，由于 `unitPrice` 输入参数作为 `Object`传入，因此必须将其强制转换为十进制值。</span><span class="sxs-lookup"><span data-stu-id="32bea-219">Furthermore, since the `unitPrice` input parameter is passed in as an `Object`, it must be cast to a decimal value.</span></span>

## <a name="step-2-calling-the-formatting-function-from-the-datalist-s-itemtemplate"></a><span data-ttu-id="32bea-220">步骤2：从 DataList s ItemTemplate 调用格式设置函数</span><span class="sxs-lookup"><span data-stu-id="32bea-220">Step 2: Calling the Formatting Function from the DataList s ItemTemplate</span></span>

<span data-ttu-id="32bea-221">在 ASP.NET 页的代码隐藏类中添加格式设置函数后，剩下的就是从 DataList `ItemTemplate`调用这些格式设置函数。</span><span class="sxs-lookup"><span data-stu-id="32bea-221">With the formatting functions added to our ASP.NET page s code-behind class, all that remains is to invoke these formatting functions from the DataList s `ItemTemplate`.</span></span> <span data-ttu-id="32bea-222">若要从模板调用格式设置函数，请将函数调用置于 databinding 语法中：</span><span class="sxs-lookup"><span data-stu-id="32bea-222">To call a formatting function from a template, place the function call within the databinding syntax:</span></span>

[!code-aspx[Main](formatting-the-datalist-and-repeater-based-upon-data-cs/samples/sample5.aspx)]

<span data-ttu-id="32bea-223">在 DataList 中 `ItemTemplate` `ProductNameLabel` "标签 Web 控件" 当前显示产品名称，方法是将 `<%# Eval("ProductName") %>`的结果分配给其 `Text` 属性。</span><span class="sxs-lookup"><span data-stu-id="32bea-223">In the DataList s `ItemTemplate` the `ProductNameLabel` Label Web control currently displays the product s name by assigning its `Text` property the result of `<%# Eval("ProductName") %>`.</span></span> <span data-ttu-id="32bea-224">为了使它显示名称和文本 [已停用]，如果需要，请更新声明性语法，使其改为将 `Text` 属性分配 `DisplayProductNameAndDiscontinuedStatus` 方法的值。</span><span class="sxs-lookup"><span data-stu-id="32bea-224">In order to have it display the name plus the text [DISCONTINUED], if needed, update the declarative syntax so that it instead assigns the `Text` property the value of the `DisplayProductNameAndDiscontinuedStatus` method.</span></span> <span data-ttu-id="32bea-225">执行此操作时，必须使用 `Eval("columnName")` 语法传入 product s name 和废止值。</span><span class="sxs-lookup"><span data-stu-id="32bea-225">When doing so, we must pass in the product s name and discontinued values using the `Eval("columnName")` syntax.</span></span> <span data-ttu-id="32bea-226">`Eval` 返回 `Object`类型的值，但 `DisplayProductNameAndDiscontinuedStatus` 方法需要类型 `String` 和 `Boolean`的输入参数。因此，必须将 `Eval` 方法返回的值强制转换为所需的输入参数类型，如下所示：</span><span class="sxs-lookup"><span data-stu-id="32bea-226">`Eval` returns a value of type `Object`, but the `DisplayProductNameAndDiscontinuedStatus` method expects input parameters of type `String` and `Boolean`; therefore, we must cast the values returned by the `Eval` method to the expected input parameter types, like so:</span></span>

[!code-aspx[Main](formatting-the-datalist-and-repeater-based-upon-data-cs/samples/sample6.aspx)]

<span data-ttu-id="32bea-227">为了显示价格，只需将 `UnitPriceLabel` 标签的 `Text` 属性设置为 `DisplayPrice` 方法返回的值，就像我们为显示产品名称和 [废止] 文本所做的那样。</span><span class="sxs-lookup"><span data-stu-id="32bea-227">To display the price, we can simply set the `UnitPriceLabel` Label s `Text` property to the value returned by the `DisplayPrice` method, just like we did for displaying the product s name and [DISCONTINUED] text.</span></span> <span data-ttu-id="32bea-228">但是，我们改为传入整个 `ProductsRow` 实例，而不是作为标量输入参数传入 `UnitPrice`：</span><span class="sxs-lookup"><span data-stu-id="32bea-228">However, instead of passing in the `UnitPrice` as a scalar input parameter, we instead pass in the entire `ProductsRow` instance:</span></span>

[!code-aspx[Main](formatting-the-datalist-and-repeater-based-upon-data-cs/samples/sample7.aspx)]

<span data-ttu-id="32bea-229">在就地调用格式设置函数后，请花点时间在浏览器中查看进度。</span><span class="sxs-lookup"><span data-stu-id="32bea-229">With the calls to the formatting functions in place, take a moment to view our progress in a browser.</span></span> <span data-ttu-id="32bea-230">您的屏幕应类似于图5，其中包含文本 [已停用的产品]，而那些产品的价格超过 $20.00，但其价格已替换为文本。</span><span class="sxs-lookup"><span data-stu-id="32bea-230">Your screen should look similar to Figure 5, with the discontinued products including the text [DISCONTINUED] and those products costing more than $20.00 having their price replaced with the text Please call for a price quote .</span></span>

<span data-ttu-id="32bea-231">[![成本高昂的产品，则会将价格替换为文本，请拨打价格报价](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image14.png)](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="32bea-231">[![For Expensive Products, the Price is Replaced with the Text, Please call for a price quote](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image14.png)](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image13.png)</span></span>

<span data-ttu-id="32bea-232">**图 5**：对于昂贵的产品，价格将替换为文本，请拨打价格报价（[单击查看全尺寸图像](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="32bea-232">**Figure 5**: For Expensive Products, the Price is Replaced with the Text, Please call for a price quote ([Click to view full-size image](formatting-the-datalist-and-repeater-based-upon-data-cs/_static/image15.png))</span></span>

## <a name="summary"></a><span data-ttu-id="32bea-233">摘要</span><span class="sxs-lookup"><span data-stu-id="32bea-233">Summary</span></span>

<span data-ttu-id="32bea-234">可以使用两种方法来基于数据设置 DataList 或 Repeater 控件的内容的格式。</span><span class="sxs-lookup"><span data-stu-id="32bea-234">Formatting the contents of a DataList or Repeater control based upon the data can be accomplished using two techniques.</span></span> <span data-ttu-id="32bea-235">第一种方法是为 `ItemDataBound` 事件创建事件处理程序，当数据源中的每条记录绑定到新的 `DataListItem` 或 `RepeaterItem`时，将触发该事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="32bea-235">The first technique is to create an event handler for the `ItemDataBound` event, which fires as each record in the data source is bound to a new `DataListItem` or `RepeaterItem`.</span></span> <span data-ttu-id="32bea-236">在 `ItemDataBound` 事件处理程序中，可以检查当前项的数据，然后将格式设置应用于模板的内容，或应用于将 `DataListItem` 的内容应用于整个项本身。</span><span class="sxs-lookup"><span data-stu-id="32bea-236">In the `ItemDataBound` event handler, the current item s data can be examined and then formatting can be applied to the contents of the template or, for `DataListItem` s, to the entire item itself.</span></span>

<span data-ttu-id="32bea-237">或者，可以通过格式设置函数来实现自定义格式设置。</span><span class="sxs-lookup"><span data-stu-id="32bea-237">Alternatively, custom formatting can be realized through formatting functions.</span></span> <span data-ttu-id="32bea-238">格式设置函数是一种方法，可从 DataList 或 Repeater 模板调用，这些模板返回要在其位置发出的 HTML。</span><span class="sxs-lookup"><span data-stu-id="32bea-238">A formatting function is a method that can be invoked from the DataList or Repeater s templates that returns the HTML to emit in its place.</span></span> <span data-ttu-id="32bea-239">通常，格式设置函数返回的 HTML 由绑定到当前项的值确定。</span><span class="sxs-lookup"><span data-stu-id="32bea-239">Often, the HTML returned by a formatting function is determined by the values being bound to the current item.</span></span> <span data-ttu-id="32bea-240">这些值可作为标量值或通过传入要绑定到项的整个对象（如 `ProductsRow` 实例）传递到格式设置函数。</span><span class="sxs-lookup"><span data-stu-id="32bea-240">These values can be passed into the formatting function, either as scalar values or by passing in the entire object being bound to the item (such as the `ProductsRow` instance).</span></span>

<span data-ttu-id="32bea-241">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="32bea-241">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="32bea-242">关于作者</span><span class="sxs-lookup"><span data-stu-id="32bea-242">About the Author</span></span>

<span data-ttu-id="32bea-243">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，创始人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已在使用 Microsoft Web 技术，自1998开始。</span><span class="sxs-lookup"><span data-stu-id="32bea-243">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="32bea-244">Scott 的工作方式是独立的顾问、培训师和撰稿人。</span><span class="sxs-lookup"><span data-stu-id="32bea-244">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="32bea-245">他的最新书籍是，[*在24小时内，sam ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="32bea-245">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="32bea-246">可以[mitchell@4GuysFromRolla.com访问。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="32bea-246">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="32bea-247">或通过他的博客，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="32bea-247">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="32bea-248">特别感谢</span><span class="sxs-lookup"><span data-stu-id="32bea-248">Special Thanks To</span></span>

<span data-ttu-id="32bea-249">此教程系列由许多有用的审阅者查看。</span><span class="sxs-lookup"><span data-stu-id="32bea-249">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="32bea-250">本教程的主管评审者是 Yaakov Ellis、Randy Schmidt 和 Liz Shulok。</span><span class="sxs-lookup"><span data-stu-id="32bea-250">Lead reviewers for this tutorial were Yaakov Ellis, Randy Schmidt, and Liz Shulok.</span></span> <span data-ttu-id="32bea-251">想要查看我即将发布的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="32bea-251">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="32bea-252">如果是这样，请在mitchell@4GuysFromRolla.com放置一行[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="32bea-252">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="32bea-253">[上一页](displaying-data-with-the-datalist-and-repeater-controls-cs.md)
> [下一页](showing-multiple-records-per-row-with-the-datalist-control-cs.md)</span><span class="sxs-lookup"><span data-stu-id="32bea-253">[Previous](displaying-data-with-the-datalist-and-repeater-controls-cs.md)
[Next](showing-multiple-records-per-row-with-the-datalist-control-cs.md)</span></span>
