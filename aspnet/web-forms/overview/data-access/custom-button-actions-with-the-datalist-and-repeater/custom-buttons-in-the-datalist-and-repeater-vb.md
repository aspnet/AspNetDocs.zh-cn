---
uid: web-forms/overview/data-access/custom-button-actions-with-the-datalist-and-repeater/custom-buttons-in-the-datalist-and-repeater-vb
title: DataList 和 Repeater 中的自定义按钮（VB） |Microsoft Docs
author: rick-anderson
description: 在本教程中，我们将构建一个接口，该接口使用中继器列出系统中的类别，每个类别都提供一个按钮以显示其 associ 。
ms.author: riande
ms.date: 11/13/2006
ms.assetid: 1afdb14d-6e49-4e1f-aead-2934730d472e
msc.legacyurl: /web-forms/overview/data-access/custom-button-actions-with-the-datalist-and-repeater/custom-buttons-in-the-datalist-and-repeater-vb
msc.type: authoredcontent
ms.openlocfilehash: bc7e94e59226b739c2948434c1bfecb46b3d7856
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/06/2020
ms.locfileid: "78465350"
---
# <a name="custom-buttons-in-the-datalist-and-repeater-vb"></a><span data-ttu-id="7a591-103">DataList 和 Repeater 中的自定义按钮 (VB)</span><span class="sxs-lookup"><span data-stu-id="7a591-103">Custom Buttons in the DataList and Repeater (VB)</span></span>

<span data-ttu-id="7a591-104">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="7a591-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="7a591-105">[下载示例应用](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_46_VB.exe)或[下载 PDF](custom-buttons-in-the-datalist-and-repeater-vb/_static/datatutorial46vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="7a591-105">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_46_VB.exe) or [Download PDF](custom-buttons-in-the-datalist-and-repeater-vb/_static/datatutorial46vb1.pdf)</span></span>

> <span data-ttu-id="7a591-106">在本教程中，我们将构建一个接口，该接口使用中继器列出系统中的类别，每个类别都提供一个按钮来使用 BulletedList 控件显示其关联的产品。</span><span class="sxs-lookup"><span data-stu-id="7a591-106">In this tutorial we'll build an interface that uses a Repeater to list the categories in the system, with each category providing a button to show its associated products using a BulletedList control.</span></span>

## <a name="introduction"></a><span data-ttu-id="7a591-107">简介</span><span class="sxs-lookup"><span data-stu-id="7a591-107">Introduction</span></span>

<span data-ttu-id="7a591-108">在过去的十七个 DataList 和中继器教程中，我们创建了只读示例并编辑和删除了示例。</span><span class="sxs-lookup"><span data-stu-id="7a591-108">Throughout the past seventeen DataList and Repeater tutorials, we ve created both read-only examples and editing and deleting examples.</span></span> <span data-ttu-id="7a591-109">为了便于编辑和删除 DataList 中的功能，我们向 DataList s 添加了一些按钮，在单击该按钮时，该按钮 `ItemTemplate` 会导致回发并引发对应于按钮 s `CommandName` 属性的 DataList 事件。</span><span class="sxs-lookup"><span data-stu-id="7a591-109">To facilitate editing and deleting capabilities within a DataList, we added buttons to the DataList s `ItemTemplate` that, when clicked, caused a postback and raised a DataList event corresponding to the button s `CommandName` property.</span></span> <span data-ttu-id="7a591-110">例如，将一个按钮添加到 `CommandName` 属性值为 "编辑" 的 `ItemTemplate` 会导致 DataList `EditCommand` 在回发时激发;一个具有 `CommandName` 删除的将引发 `DeleteCommand`。</span><span class="sxs-lookup"><span data-stu-id="7a591-110">For example, adding a button to the `ItemTemplate` with a `CommandName` property value of Edit causes the DataList s `EditCommand` to fire on postback; one with the `CommandName` Delete raises the `DeleteCommand`.</span></span>

<span data-ttu-id="7a591-111">除了 "编辑" 和 "删除" 按钮外，DataList 和 Repeater 控件还可以包含按钮、LinkButtons 或 ImageButtons，单击该按钮时，将执行一些自定义服务器端逻辑。</span><span class="sxs-lookup"><span data-stu-id="7a591-111">In addition to Edit and Delete buttons, the DataList and Repeater controls can also include Buttons, LinkButtons, or ImageButtons that, when clicked, perform some custom server-side logic.</span></span> <span data-ttu-id="7a591-112">在本教程中，我们将构建一个接口，该接口使用中继器来列出系统中的类别。</span><span class="sxs-lookup"><span data-stu-id="7a591-112">In this tutorial we'll build an interface that uses a Repeater to list the categories in the system.</span></span> <span data-ttu-id="7a591-113">对于每个类别，中继器都将包含一个按钮，用于使用 BulletedList 控件显示与类别关联的产品（请参阅图1）。</span><span class="sxs-lookup"><span data-stu-id="7a591-113">For each category, the Repeater will include a button to show the category s associated products using a BulletedList control (see Figure 1).</span></span>

<span data-ttu-id="7a591-114">[![单击 "显示产品" 链接会在项目符号列表中显示类别的产品](custom-buttons-in-the-datalist-and-repeater-vb/_static/image2.png)](custom-buttons-in-the-datalist-and-repeater-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="7a591-114">[![Clicking the Show Products Link Displays the Category s Products in a Bulleted List](custom-buttons-in-the-datalist-and-repeater-vb/_static/image2.png)](custom-buttons-in-the-datalist-and-repeater-vb/_static/image1.png)</span></span>

<span data-ttu-id="7a591-115">**图 1**：单击 "显示产品" 链接可在项目符号列表中显示类别的产品（[单击以查看完全大小的图像](custom-buttons-in-the-datalist-and-repeater-vb/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="7a591-115">**Figure 1**: Clicking the Show Products Link Displays the Category s Products in a Bulleted List ([Click to view full-size image](custom-buttons-in-the-datalist-and-repeater-vb/_static/image3.png))</span></span>

## <a name="step-1-adding-the-custom-button-tutorial-web-pages"></a><span data-ttu-id="7a591-116">步骤1：添加自定义按钮教程网页</span><span class="sxs-lookup"><span data-stu-id="7a591-116">Step 1: Adding the Custom Button Tutorial Web Pages</span></span>

<span data-ttu-id="7a591-117">在我们介绍如何添加自定义按钮之前，首先请花点时间在我们的网站项目中创建 ASP.NET 页面，我们将在本教程中需要用到这些页面。</span><span class="sxs-lookup"><span data-stu-id="7a591-117">Before we look at how to add a custom button, let s first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial.</span></span> <span data-ttu-id="7a591-118">首先添加一个名为 `CustomButtonsDataListRepeater`的新文件夹。</span><span class="sxs-lookup"><span data-stu-id="7a591-118">Start by adding a new folder named `CustomButtonsDataListRepeater`.</span></span> <span data-ttu-id="7a591-119">接下来，将以下两个 ASP.NET 页面添加到该文件夹，确保将每个页面与 `Site.master` 母版页关联：</span><span class="sxs-lookup"><span data-stu-id="7a591-119">Next, add the following two ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `CustomButtons.aspx`

![为自定义按钮相关教程添加 ASP.NET 页](custom-buttons-in-the-datalist-and-repeater-vb/_static/image4.png)

<span data-ttu-id="7a591-121">**图 2**：为自定义按钮相关教程添加 ASP.NET 页</span><span class="sxs-lookup"><span data-stu-id="7a591-121">**Figure 2**: Add the ASP.NET Pages for the Custom Buttons-Related Tutorials</span></span>

<span data-ttu-id="7a591-122">与在其他文件夹中一样，`CustomButtonsDataListRepeater` 文件夹中的 `Default.aspx` 会在其部分列出教程。</span><span class="sxs-lookup"><span data-stu-id="7a591-122">Like in the other folders, `Default.aspx` in the `CustomButtonsDataListRepeater` folder will list the tutorials in its section.</span></span> <span data-ttu-id="7a591-123">请记住，`SectionLevelTutorialListing.ascx` 用户控件提供此功能。</span><span class="sxs-lookup"><span data-stu-id="7a591-123">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="7a591-124">将此用户控件从解决方案资源管理器拖到页面 s 设计视图，以将其添加到 `Default.aspx`。</span><span class="sxs-lookup"><span data-stu-id="7a591-124">Add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>

<span data-ttu-id="7a591-125">[![将 SectionLevelTutorialListing 用户控件添加到 default.aspx](custom-buttons-in-the-datalist-and-repeater-vb/_static/image6.png)](custom-buttons-in-the-datalist-and-repeater-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="7a591-125">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](custom-buttons-in-the-datalist-and-repeater-vb/_static/image6.png)](custom-buttons-in-the-datalist-and-repeater-vb/_static/image5.png)</span></span>

<span data-ttu-id="7a591-126">**图 3**：将 `SectionLevelTutorialListing.ascx` 用户控件添加到 `Default.aspx` （[单击以查看完全大小的图像](custom-buttons-in-the-datalist-and-repeater-vb/_static/image7.png)）</span><span class="sxs-lookup"><span data-stu-id="7a591-126">**Figure 3**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](custom-buttons-in-the-datalist-and-repeater-vb/_static/image7.png))</span></span>

<span data-ttu-id="7a591-127">最后，将页面作为条目添加到 `Web.sitemap` 文件中。</span><span class="sxs-lookup"><span data-stu-id="7a591-127">Lastly, add the pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="7a591-128">具体而言，请在 DataList 和 Repeater `<siteMapNode>`后面添加以下标记：</span><span class="sxs-lookup"><span data-stu-id="7a591-128">Specifically, add the following markup after the Paging and Sorting with the DataList and Repeater `<siteMapNode>`:</span></span>

[!code-xml[Main](custom-buttons-in-the-datalist-and-repeater-vb/samples/sample1.xml)]

<span data-ttu-id="7a591-129">更新 `Web.sitemap`后，请花点时间通过浏览器查看教程网站。</span><span class="sxs-lookup"><span data-stu-id="7a591-129">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="7a591-130">左侧菜单现在包含用于编辑、插入和删除教程的项。</span><span class="sxs-lookup"><span data-stu-id="7a591-130">The menu on the left now includes items for the editing, inserting, and deleting tutorials.</span></span>

![站点映射现在包含用于自定义按钮教程的条目](custom-buttons-in-the-datalist-and-repeater-vb/_static/image8.png)

<span data-ttu-id="7a591-132">**图 4**：站点地图现在包含用于自定义按钮教程的条目</span><span class="sxs-lookup"><span data-stu-id="7a591-132">**Figure 4**: The Site Map Now Includes the Entry for the Custom Buttons Tutorial</span></span>

## <a name="step-2-adding-the-list-of-categories"></a><span data-ttu-id="7a591-133">步骤2：添加类别列表</span><span class="sxs-lookup"><span data-stu-id="7a591-133">Step 2: Adding the List of Categories</span></span>

<span data-ttu-id="7a591-134">对于本教程，我们需要创建一个中继器，其中列出了所有类别以及 "显示产品" LinkButton，单击此项将在项目符号列表中显示关联的类别的产品。</span><span class="sxs-lookup"><span data-stu-id="7a591-134">For this tutorial we need to create a Repeater that lists all categories along with a Show Products LinkButton that, when clicked, displays the associated category s products in a bulleted list.</span></span> <span data-ttu-id="7a591-135">首先，让我们创建一个简单的中继器来列出系统中的类别。</span><span class="sxs-lookup"><span data-stu-id="7a591-135">Let s first create a simple Repeater that lists the categories in the system.</span></span> <span data-ttu-id="7a591-136">首先打开 `CustomButtonsDataListRepeater` 文件夹中的 "`CustomButtons.aspx`" 页。</span><span class="sxs-lookup"><span data-stu-id="7a591-136">Start by opening the `CustomButtons.aspx` page in the `CustomButtonsDataListRepeater` folder.</span></span> <span data-ttu-id="7a591-137">将 Repeater 从工具箱拖到设计器上，并将其 `ID` 属性设置为 `Categories`。</span><span class="sxs-lookup"><span data-stu-id="7a591-137">Drag a Repeater from the Toolbox onto the Designer and set its `ID` property to `Categories`.</span></span> <span data-ttu-id="7a591-138">接下来，从 Repeater 的智能标记创建新的数据源控件。</span><span class="sxs-lookup"><span data-stu-id="7a591-138">Next, create a new data source control from the Repeater s smart tag.</span></span> <span data-ttu-id="7a591-139">具体而言，将创建一个名为 `CategoriesDataSource` 的新 ObjectDataSource 控件，该控件从 `CategoriesBLL` 类 `GetCategories()` 方法中选择其数据。</span><span class="sxs-lookup"><span data-stu-id="7a591-139">Specifically, create a new ObjectDataSource control named `CategoriesDataSource` that selects its data from the `CategoriesBLL` class s `GetCategories()` method.</span></span>

<span data-ttu-id="7a591-140">[![将 ObjectDataSource 配置为使用 CategoriesBLL Class s GetCategories （）方法](custom-buttons-in-the-datalist-and-repeater-vb/_static/image10.png)](custom-buttons-in-the-datalist-and-repeater-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="7a591-140">[![Configure the ObjectDataSource to Use the CategoriesBLL Class s GetCategories() Method](custom-buttons-in-the-datalist-and-repeater-vb/_static/image10.png)](custom-buttons-in-the-datalist-and-repeater-vb/_static/image9.png)</span></span>

<span data-ttu-id="7a591-141">**图 5**：将 ObjectDataSource 配置为使用 `CategoriesBLL` 类 `GetCategories()` 方法（[单击以查看完全大小的映像](custom-buttons-in-the-datalist-and-repeater-vb/_static/image11.png)）</span><span class="sxs-lookup"><span data-stu-id="7a591-141">**Figure 5**: Configure the ObjectDataSource to Use the `CategoriesBLL` Class s `GetCategories()` Method ([Click to view full-size image](custom-buttons-in-the-datalist-and-repeater-vb/_static/image11.png))</span></span>

<span data-ttu-id="7a591-142">与 DataList 控件不同，Visual Studio 根据数据源创建默认 `ItemTemplate`，必须手动定义中继器。</span><span class="sxs-lookup"><span data-stu-id="7a591-142">Unlike the DataList control, for which Visual Studio creates a default `ItemTemplate` based on the data source, the Repeater s templates must be manually defined.</span></span> <span data-ttu-id="7a591-143">此外，必须以声明方式（即，在中继器 s 智能标记中没有 "编辑模板" 选项）创建和编辑中继器模板。</span><span class="sxs-lookup"><span data-stu-id="7a591-143">Furthermore, the Repeater s templates must be created and edited declaratively (that is, there s no Edit Templates option in the Repeater s smart tag).</span></span>

<span data-ttu-id="7a591-144">单击左下角的 "源" 选项卡，并添加一个 `ItemTemplate`，它在 `<h3>` 元素中显示类别的名称及其在段落标记中的说明;包括在每个类别之间显示水平标尺（`<hr />`）的 `SeparatorTemplate`。</span><span class="sxs-lookup"><span data-stu-id="7a591-144">Click on the Source tab in the bottom left corner and add an `ItemTemplate` that displays the category s name in an `<h3>` element and its description in a paragraph tag; include a `SeparatorTemplate` that displays a horizontal rule (`<hr />`) between each category.</span></span> <span data-ttu-id="7a591-145">另外添加一个 LinkButton，其 `Text` 属性设置为 "显示产品"。</span><span class="sxs-lookup"><span data-stu-id="7a591-145">Also add a LinkButton with its `Text` property set to Show Products.</span></span> <span data-ttu-id="7a591-146">完成这些步骤后，页面的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="7a591-146">After completing these steps, your page s declarative markup should look like the following:</span></span>

[!code-aspx[Main](custom-buttons-in-the-datalist-and-repeater-vb/samples/sample2.aspx)]

<span data-ttu-id="7a591-147">图6显示了通过浏览器查看的页面。</span><span class="sxs-lookup"><span data-stu-id="7a591-147">Figure 6 shows the page when viewed through a browser.</span></span> <span data-ttu-id="7a591-148">列出了每个类别的名称和描述。</span><span class="sxs-lookup"><span data-stu-id="7a591-148">Each category name and description is listed.</span></span> <span data-ttu-id="7a591-149">单击 "显示产品" 按钮会导致回发，但不会执行任何操作。</span><span class="sxs-lookup"><span data-stu-id="7a591-149">The Show Products button, when clicked, causes a postback but does not yet perform any action.</span></span>

<span data-ttu-id="7a591-150">[![显示每个类别的名称和描述，以及显示产品 LinkButton](custom-buttons-in-the-datalist-and-repeater-vb/_static/image13.png)](custom-buttons-in-the-datalist-and-repeater-vb/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="7a591-150">[![Each Category s Name and Description is Displayed, Along with a Show Products LinkButton](custom-buttons-in-the-datalist-and-repeater-vb/_static/image13.png)](custom-buttons-in-the-datalist-and-repeater-vb/_static/image12.png)</span></span>

<span data-ttu-id="7a591-151">**图 6**：显示了每个类别的名称和描述，以及显示产品 LinkButton （[单击查看完全大小的图像](custom-buttons-in-the-datalist-and-repeater-vb/_static/image14.png)）</span><span class="sxs-lookup"><span data-stu-id="7a591-151">**Figure 6**: Each Category s Name and Description is Displayed, Along with a Show Products LinkButton ([Click to view full-size image](custom-buttons-in-the-datalist-and-repeater-vb/_static/image14.png))</span></span>

## <a name="step-3-executing-server-side-logic-when-the-show-products-linkbutton-is-clicked"></a><span data-ttu-id="7a591-152">步骤3：单击显示产品 LinkButton 时执行服务器端逻辑</span><span class="sxs-lookup"><span data-stu-id="7a591-152">Step 3: Executing Server-Side Logic When the Show Products LinkButton is Clicked</span></span>

<span data-ttu-id="7a591-153">如果单击 DataList 或 Repeater 中模板内的按钮、LinkButton 或 ImageButton，则会发生回发，并引发 DataList 或 Repeater `ItemCommand` 事件。</span><span class="sxs-lookup"><span data-stu-id="7a591-153">Anytime a Button, LinkButton, or ImageButton within a template in a DataList or Repeater is clicked, a postback occurs and the DataList or Repeater s `ItemCommand` event fires.</span></span> <span data-ttu-id="7a591-154">除了 `ItemCommand` 事件之外，如果按钮的 `CommandName` 属性设置为保留的字符串之一（删除、编辑、取消、更新或选择），DataList 控件也可能引发另一个更具体的事件，但 `ItemCommand` 事件*始终*激发。</span><span class="sxs-lookup"><span data-stu-id="7a591-154">In addition to the `ItemCommand` event, the DataList control may also raise another, more specific event if the button s `CommandName` property is set to one of the reserved strings ( Delete, Edit, Cancel, Update, or Select ), but the `ItemCommand` event is *always* fired.</span></span>

<span data-ttu-id="7a591-155">当在 DataList 或中继器内单击某个按钮时，有时我们需要沿单击哪个按钮（如果控件中可能有多个按钮，例如 "编辑" 和 "删除" 按钮），以及其他一些信息（如单击了按钮的项的主键值）。</span><span class="sxs-lookup"><span data-stu-id="7a591-155">When a button is clicked within a DataList or Repeater, oftentimes we need to pass along which button was clicked (in the case that there may be multiple buttons within the control, such as both an Edit and Delete button) and perhaps some additional information (such as the primary key value of the item whose button was clicked).</span></span> <span data-ttu-id="7a591-156">按钮、LinkButton 和 ImageButton 提供了两个属性，这些属性的值将传递到 `ItemCommand` 事件处理程序：</span><span class="sxs-lookup"><span data-stu-id="7a591-156">The Button, LinkButton, and ImageButton provide two properties whose values are passed to the `ItemCommand` event handler:</span></span>

- <span data-ttu-id="7a591-157">`CommandName` 通常用于标识模板中的每个按钮的字符串</span><span class="sxs-lookup"><span data-stu-id="7a591-157">`CommandName` a string typically used to identify each button in the template</span></span>
- <span data-ttu-id="7a591-158">`CommandArgument` 通常用于保存某些数据字段的值，例如主键值</span><span class="sxs-lookup"><span data-stu-id="7a591-158">`CommandArgument` commonly used to hold the value of some data field, such as the primary key value</span></span>

<span data-ttu-id="7a591-159">对于本示例，请将 LinkButton s `CommandName` 属性设置为 ShowProducts，并使用 databinding 语法 `CategoryArgument='<%# Eval("CategoryID") %>'`将当前记录的主键值 `CategoryID` 绑定到 `CommandArgument` 属性。</span><span class="sxs-lookup"><span data-stu-id="7a591-159">For this example, set the LinkButton s `CommandName` property to ShowProducts and bind the current record s primary key value `CategoryID` to the `CommandArgument` property using the databinding syntax `CategoryArgument='<%# Eval("CategoryID") %>'`.</span></span> <span data-ttu-id="7a591-160">指定这两个属性后，LinkButton 的声明性语法应如下所示：</span><span class="sxs-lookup"><span data-stu-id="7a591-160">After specifying these two properties, the LinkButton s declarative syntax should look like the following:</span></span>

[!code-aspx[Main](custom-buttons-in-the-datalist-and-repeater-vb/samples/sample3.aspx)]

<span data-ttu-id="7a591-161">单击该按钮时，将发生回发，并激发 DataList 或 Repeater `ItemCommand` 事件。</span><span class="sxs-lookup"><span data-stu-id="7a591-161">When the button is clicked, a postback occurs and the DataList or Repeater s `ItemCommand` event fires.</span></span> <span data-ttu-id="7a591-162">向事件处理程序传递按钮 s `CommandName` 和 `CommandArgument` 值。</span><span class="sxs-lookup"><span data-stu-id="7a591-162">The event handler is passed the button s `CommandName` and `CommandArgument` values.</span></span>

<span data-ttu-id="7a591-163">为中继器 `ItemCommand` 事件创建事件处理程序，并记下传递到事件处理程序中的第二个参数（名为 `e`）。</span><span class="sxs-lookup"><span data-stu-id="7a591-163">Create an event handler for the Repeater s `ItemCommand` event and note the second parameter passed into the event handler (named `e`).</span></span> <span data-ttu-id="7a591-164">此第二个参数的类型为[`RepeaterCommandEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeatercommandeventargs.aspx) ，具有以下四个属性：</span><span class="sxs-lookup"><span data-stu-id="7a591-164">This second parameter is of type [`RepeaterCommandEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeatercommandeventargs.aspx) and has the following four properties:</span></span>

- <span data-ttu-id="7a591-165">`CommandArgument` 单击的按钮 `CommandArgument` 属性的值</span><span class="sxs-lookup"><span data-stu-id="7a591-165">`CommandArgument` the value of the clicked button s `CommandArgument` property</span></span>
- <span data-ttu-id="7a591-166">`CommandName` 按钮 `CommandName` 属性的值</span><span class="sxs-lookup"><span data-stu-id="7a591-166">`CommandName` the value of the button s `CommandName` property</span></span>
- <span data-ttu-id="7a591-167">`CommandSource` 对单击的按钮控件的引用</span><span class="sxs-lookup"><span data-stu-id="7a591-167">`CommandSource` a reference to the button control that was clicked</span></span>
- <span data-ttu-id="7a591-168">`Item` 对包含所单击按钮的[`RepeaterItem`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeateritem.aspx)的引用;绑定到 Repeater 的每个记录均表现为 `RepeaterItem`</span><span class="sxs-lookup"><span data-stu-id="7a591-168">`Item` a reference to the [`RepeaterItem`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeateritem.aspx) that contains the button that was clicked; each record bound to the Repeater is manifested as a `RepeaterItem`</span></span>

<span data-ttu-id="7a591-169">由于所选的类别 `CategoryID` 通过 `CommandArgument` 属性传入，因此，我们可以在 `ItemCommand` 事件处理程序中获取与所选类别关联的一组产品。</span><span class="sxs-lookup"><span data-stu-id="7a591-169">Since the selected category s `CategoryID` is passed in via the `CommandArgument` property, we can get the set of products associated with the selected category in the `ItemCommand` event handler.</span></span> <span data-ttu-id="7a591-170">然后，可以将这些产品绑定到 `ItemTemplate` 中的 BulletedList 控件（我们尚未添加）。</span><span class="sxs-lookup"><span data-stu-id="7a591-170">These products can then be bound to a BulletedList control in the `ItemTemplate` (which we ve yet to add).</span></span> <span data-ttu-id="7a591-171">接下来，我们将添加 BulletedList，在 `ItemCommand` 事件处理程序中引用该，并将其绑定到所选类别的产品集，我们将在步骤4中进行此操作。</span><span class="sxs-lookup"><span data-stu-id="7a591-171">All that remains, then, is to add the BulletedList, reference it in the `ItemCommand` event handler, and bind to it the set of products for the selected category, which we'll tackle in Step 4.</span></span>

> [!NOTE]
> <span data-ttu-id="7a591-172">为 DataList `ItemCommand` 事件处理程序传递[`DataListCommandEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalistcommandeventargs.aspx)类型的对象，该对象提供与 `RepeaterCommandEventArgs` 类相同的四个属性。</span><span class="sxs-lookup"><span data-stu-id="7a591-172">The DataList s `ItemCommand` event handler is passed an object of type [`DataListCommandEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalistcommandeventargs.aspx), which offers the same four properties as the `RepeaterCommandEventArgs` class.</span></span>

## <a name="step-4-displaying-the-selected-category-s-products-in-a-bulleted-list"></a><span data-ttu-id="7a591-173">步骤4：在项目符号列表中显示所选类别的产品</span><span class="sxs-lookup"><span data-stu-id="7a591-173">Step 4: Displaying the Selected Category s Products in a Bulleted List</span></span>

<span data-ttu-id="7a591-174">使用任意数量的控件，可以在 Repeater `ItemTemplate` 中显示所选类别的产品。</span><span class="sxs-lookup"><span data-stu-id="7a591-174">The selected category s products can be displayed within the Repeater s `ItemTemplate` using any number of controls.</span></span> <span data-ttu-id="7a591-175">可以添加其他嵌套的中继器、DataList、DropDownList、GridView 等。</span><span class="sxs-lookup"><span data-stu-id="7a591-175">We could add another nested Repeater, a DataList, a DropDownList, a GridView, and so on.</span></span> <span data-ttu-id="7a591-176">不过，由于我们想要将产品显示为项目符号列表，因此我们将使用 BulletedList 控件。</span><span class="sxs-lookup"><span data-stu-id="7a591-176">Since we want to display the products as a bulleted list, though, we'll use the BulletedList control.</span></span> <span data-ttu-id="7a591-177">返回到 `CustomButtons.aspx` 页的声明性标记，将 BulletedList 控件添加到 Show Products LinkButton 之后的 `ItemTemplate` 中。</span><span class="sxs-lookup"><span data-stu-id="7a591-177">Returning to the `CustomButtons.aspx` page s declarative markup, add a BulletedList control to the `ItemTemplate` after the Show Products LinkButton.</span></span> <span data-ttu-id="7a591-178">将 BulletedLists `ID` 设置为 `ProductsInCategory`。</span><span class="sxs-lookup"><span data-stu-id="7a591-178">Set the BulletedLists s `ID` to `ProductsInCategory`.</span></span> <span data-ttu-id="7a591-179">BulletedList 显示通过 `DataTextField` 属性指定的数据字段的值;由于此控件将绑定产品信息，因此请将 `DataTextField` 属性设置为 `ProductName`。</span><span class="sxs-lookup"><span data-stu-id="7a591-179">The BulletedList displays the value of the data field specified via the `DataTextField` property; since this control will have product information bound to it, set the `DataTextField` property to `ProductName`.</span></span>

[!code-aspx[Main](custom-buttons-in-the-datalist-and-repeater-vb/samples/sample4.aspx)]

<span data-ttu-id="7a591-180">在 `ItemCommand` 事件处理程序中，使用 `e.Item.FindControl("ProductsInCategory")` 引用此控件，并将其绑定到与所选类别关联的一组产品。</span><span class="sxs-lookup"><span data-stu-id="7a591-180">In the `ItemCommand` event handler, reference this control using `e.Item.FindControl("ProductsInCategory")` and bind it to the set of products associated with the selected category.</span></span>

[!code-vb[Main](custom-buttons-in-the-datalist-and-repeater-vb/samples/sample5.vb)]

<span data-ttu-id="7a591-181">在 `ItemCommand` 事件处理程序中执行任何操作之前，首先应检查传入 `CommandName`的值。</span><span class="sxs-lookup"><span data-stu-id="7a591-181">Before performing any action in the `ItemCommand` event handler, it s prudent to first check the value of the incoming `CommandName`.</span></span> <span data-ttu-id="7a591-182">由于在单击*任何*按钮时将触发 `ItemCommand` 事件处理程序，因此，如果模板中有多个按钮，则使用 `CommandName` 值来了解要执行的操作。</span><span class="sxs-lookup"><span data-stu-id="7a591-182">Since the `ItemCommand` event handler fires when *any* button is clicked, if there are multiple buttons in the template use the `CommandName` value to discern what action to take.</span></span> <span data-ttu-id="7a591-183">在此处检查 `CommandName` 是差异的，因为我们只有一个按钮，但这是一种很好的形式。</span><span class="sxs-lookup"><span data-stu-id="7a591-183">Checking the `CommandName` here is moot, since we only have a single button, but it is a good habit to form.</span></span> <span data-ttu-id="7a591-184">接下来，从 `CommandArgument` 属性中检索所选类别的 `CategoryID`。</span><span class="sxs-lookup"><span data-stu-id="7a591-184">Next, the `CategoryID` of the selected category is retrieved from the `CommandArgument` property.</span></span> <span data-ttu-id="7a591-185">然后，引用模板中的 BulletedList 控件并将其绑定到 `ProductsBLL` 类 s `GetProductsByCategoryID(categoryID)` 方法的结果。</span><span class="sxs-lookup"><span data-stu-id="7a591-185">The BulletedList control in the template is then referenced and bound to the results of the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method.</span></span>

<span data-ttu-id="7a591-186">在以前的教程中，使用了 DataList 内的按钮（例如[编辑和删除 datalist](../editing-and-deleting-data-through-the-datalist/an-overview-of-editing-and-deleting-data-in-the-datalist-vb.md)中的数据），我们通过 `DataKeys` 集合确定了给定项的主键值。</span><span class="sxs-lookup"><span data-stu-id="7a591-186">In previous tutorials that used the buttons within a DataList, such as [An Overview of Editing and Deleting Data in the DataList](../editing-and-deleting-data-through-the-datalist/an-overview-of-editing-and-deleting-data-in-the-datalist-vb.md), we determined the primary key value of a given item via the `DataKeys` collection.</span></span> <span data-ttu-id="7a591-187">尽管此方法非常适合用于 DataList，但 Repeater 没有 `DataKeys` 属性。</span><span class="sxs-lookup"><span data-stu-id="7a591-187">While this approach works well with the DataList, the Repeater does not have a `DataKeys` property.</span></span> <span data-ttu-id="7a591-188">相反，我们必须使用另一种方法来提供主键值，例如通过按钮 s `CommandArgument` 属性，或将主键值分配给模板内的隐藏标签 Web 控件，并使用 `e.Item.FindControl("LabelID")`在 `ItemCommand` 事件处理程序中读取其值。</span><span class="sxs-lookup"><span data-stu-id="7a591-188">Instead, we must use an alternative approach for supplying the primary key value, such as through the button s `CommandArgument` property or by assigning the primary key value to a hidden Label Web control within the template and reading its value back in the `ItemCommand` event handler using `e.Item.FindControl("LabelID")`.</span></span>

<span data-ttu-id="7a591-189">完成 `ItemCommand` 事件处理程序后，请花点时间在浏览器中测试此页。</span><span class="sxs-lookup"><span data-stu-id="7a591-189">After completing the `ItemCommand` event handler, take a moment to test out this page in a browser.</span></span> <span data-ttu-id="7a591-190">如图7所示，单击 "显示产品" 链接会导致回发并在 BulletedList 中显示所选类别的产品。</span><span class="sxs-lookup"><span data-stu-id="7a591-190">As Figure 7 shows, clicking the Show Products link causes a postback and displays the products for the selected category in a BulletedList.</span></span> <span data-ttu-id="7a591-191">此外，请注意，即使单击其他类别显示 "产品" 链接，也会保留此产品信息。</span><span class="sxs-lookup"><span data-stu-id="7a591-191">Furthermore, note that this product information remains, even if other categories Show Products links are clicked.</span></span>

> [!NOTE]
> <span data-ttu-id="7a591-192">如果要修改此报表的行为，以便一次只列出一种类别的产品，只需将 BulletedList 控件 `EnableViewState` 属性设置为 `False`。</span><span class="sxs-lookup"><span data-stu-id="7a591-192">If you want to modify the behavior of this report, such that the only one category s products are listed at a time, simply set the BulletedList control s `EnableViewState` property to `False`.</span></span>

<span data-ttu-id="7a591-193">[![BulletedList 用于显示所选类别的产品](custom-buttons-in-the-datalist-and-repeater-vb/_static/image16.png)](custom-buttons-in-the-datalist-and-repeater-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="7a591-193">[![A BulletedList is used to Display the Products of the Selected Category](custom-buttons-in-the-datalist-and-repeater-vb/_static/image16.png)](custom-buttons-in-the-datalist-and-repeater-vb/_static/image15.png)</span></span>

<span data-ttu-id="7a591-194">**图 7**： BulletedList 用于显示所选类别的产品（[单击以查看完全尺寸的图像](custom-buttons-in-the-datalist-and-repeater-vb/_static/image17.png)）</span><span class="sxs-lookup"><span data-stu-id="7a591-194">**Figure 7**: A BulletedList is used to Display the Products of the Selected Category ([Click to view full-size image](custom-buttons-in-the-datalist-and-repeater-vb/_static/image17.png))</span></span>

## <a name="summary"></a><span data-ttu-id="7a591-195">摘要</span><span class="sxs-lookup"><span data-stu-id="7a591-195">Summary</span></span>

<span data-ttu-id="7a591-196">DataList 和 Repeater 控件可以在其模板中包含任意数量的按钮、LinkButtons 或 ImageButtons。</span><span class="sxs-lookup"><span data-stu-id="7a591-196">The DataList and Repeater controls can include any number of Buttons, LinkButtons, or ImageButtons within their templates.</span></span> <span data-ttu-id="7a591-197">当单击此类按钮时，将导致回发并引发 `ItemCommand` 事件。</span><span class="sxs-lookup"><span data-stu-id="7a591-197">Such buttons, when clicked, cause a postback and raise the `ItemCommand` event.</span></span> <span data-ttu-id="7a591-198">若要将自定义服务器端操作与单击的按钮相关联，请为 `ItemCommand` 事件创建事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="7a591-198">To associate custom server-side action with a button being clicked, create an event handler for the `ItemCommand` event.</span></span> <span data-ttu-id="7a591-199">在此事件处理程序中，首先检查传入 `CommandName` 值以确定单击了哪个按钮。</span><span class="sxs-lookup"><span data-stu-id="7a591-199">In this event handler first check the incoming `CommandName` value to determine which button was clicked.</span></span> <span data-ttu-id="7a591-200">还可以选择通过 "button `CommandArgument`" 属性提供其他信息。</span><span class="sxs-lookup"><span data-stu-id="7a591-200">Additional information can optionally be supplied through the button s `CommandArgument` property.</span></span>

<span data-ttu-id="7a591-201">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="7a591-201">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="7a591-202">关于作者</span><span class="sxs-lookup"><span data-stu-id="7a591-202">About the Author</span></span>

<span data-ttu-id="7a591-203">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，创始人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已在使用 Microsoft Web 技术，自1998开始。</span><span class="sxs-lookup"><span data-stu-id="7a591-203">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="7a591-204">Scott 的工作方式是独立的顾问、培训师和撰稿人。</span><span class="sxs-lookup"><span data-stu-id="7a591-204">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="7a591-205">他的最新书籍是，[*在24小时内，sam ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="7a591-205">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="7a591-206">可以[mitchell@4GuysFromRolla.com访问。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="7a591-206">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="7a591-207">或通过他的博客，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="7a591-207">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="7a591-208">特别感谢</span><span class="sxs-lookup"><span data-stu-id="7a591-208">Special Thanks To</span></span>

<span data-ttu-id="7a591-209">此教程系列由许多有用的审阅者查看。</span><span class="sxs-lookup"><span data-stu-id="7a591-209">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="7a591-210">本教程的主管审查人员是 Dennis Patterson 将。</span><span class="sxs-lookup"><span data-stu-id="7a591-210">Lead reviewer for this tutorial was Dennis Patterson.</span></span> <span data-ttu-id="7a591-211">想要查看我即将发布的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="7a591-211">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="7a591-212">如果是这样，请在mitchell@4GuysFromRolla.com放置一行[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="7a591-212">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="7a591-213">上一页</span><span class="sxs-lookup"><span data-stu-id="7a591-213">Previous</span></span>](custom-buttons-in-the-datalist-and-repeater-cs.md)
