---
uid: web-forms/overview/data-access/introduction/creating-a-data-access-layer-cs
title: 创建数据访问层（C#） |Microsoft Docs
author: rick-anderson
description: 在本教程中，我们将从头开始，使用类型化数据集创建数据访问层（DAL）来访问数据库中的信息。
ms.author: riande
ms.date: 04/05/2010
ms.assetid: cfe2a6a0-1e56-4dc8-9537-c8ec76ba96a4
msc.legacyurl: /web-forms/overview/data-access/introduction/creating-a-data-access-layer-cs
msc.type: authoredcontent
ms.openlocfilehash: 5aaf97dc8448dcb7b94ef2e4e23f34fd37ac4426
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/06/2020
ms.locfileid: "78489902"
---
# <a name="creating-a-data-access-layer-c"></a><span data-ttu-id="03944-103">创建数据访问层 (C#)</span><span class="sxs-lookup"><span data-stu-id="03944-103">Creating a Data Access Layer (C#)</span></span>

<span data-ttu-id="03944-104">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="03944-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

[<span data-ttu-id="03944-105">下载 PDF</span><span class="sxs-lookup"><span data-stu-id="03944-105">Download PDF</span></span>](creating-a-data-access-layer-cs/_static/datatutorial01cs1.pdf)

> <span data-ttu-id="03944-106">在本教程中，我们将从头开始，使用类型化数据集创建数据访问层（DAL）来访问数据库中的信息。</span><span class="sxs-lookup"><span data-stu-id="03944-106">In this tutorial we'll start from the very beginning and create the Data Access Layer (DAL), using typed DataSets, to access the information in a database.</span></span>

## <a name="introduction"></a><span data-ttu-id="03944-107">简介</span><span class="sxs-lookup"><span data-stu-id="03944-107">Introduction</span></span>

<span data-ttu-id="03944-108">作为 web 开发人员，我们的生活正在处理数据。</span><span class="sxs-lookup"><span data-stu-id="03944-108">As web developers, our lives revolve around working with data.</span></span> <span data-ttu-id="03944-109">我们创建用于存储数据的数据库、用于检索和修改数据的代码，以及用于收集和汇总数据的网页。</span><span class="sxs-lookup"><span data-stu-id="03944-109">We create databases to store the data, code to retrieve and modify it, and web pages to collect and summarize it.</span></span> <span data-ttu-id="03944-110">这是较长系列教程中的第一个教程，该教程将探讨在 ASP.NET 2.0 中实现这些常用模式的方法。</span><span class="sxs-lookup"><span data-stu-id="03944-110">This is the first tutorial in a lengthy series that will explore techniques for implementing these common patterns in ASP.NET 2.0.</span></span> <span data-ttu-id="03944-111">首先，我们将创建由数据访问层（DAL）组成的[软件体系结构](http://en.wikipedia.org/wiki/Software_architecture)，使用类型化数据集、强制执行自定义业务规则的业务逻辑层（BLL）以及共享公共页面布局的 ASP.NET 页面。</span><span class="sxs-lookup"><span data-stu-id="03944-111">We'll start with creating a [software architecture](http://en.wikipedia.org/wiki/Software_architecture) composed of a Data Access Layer (DAL) using Typed DataSets, a Business Logic Layer (BLL) that enforces custom business rules, and a presentation layer composed of ASP.NET pages that share a common page layout.</span></span> <span data-ttu-id="03944-112">在此后端基础布局完成后，我们将转到报告中，其中展示了如何显示、汇总、收集和验证来自 web 应用程序的数据。</span><span class="sxs-lookup"><span data-stu-id="03944-112">Once this backend groundwork has been laid, we'll move into reporting, showing how to display, summarize, collect, and validate data from a web application.</span></span> <span data-ttu-id="03944-113">这些教程旨在简洁明了，并提供有关多个屏幕截图的分步说明，以直观地完成此过程。</span><span class="sxs-lookup"><span data-stu-id="03944-113">These tutorials are geared to be concise and provide step-by-step instructions with plenty of screen shots to walk you through the process visually.</span></span> <span data-ttu-id="03944-114">每个教程都在C#和 Visual Basic 版本中提供，并包括所使用的完整代码的下载。</span><span class="sxs-lookup"><span data-stu-id="03944-114">Each tutorial is available in C# and Visual Basic versions and includes a download of the complete code used.</span></span> <span data-ttu-id="03944-115">（本教程中的第一个教程非常耗时，但其余的理解块会更多。）</span><span class="sxs-lookup"><span data-stu-id="03944-115">(This first tutorial is quite lengthy, but the rest are presented in much more digestible chunks.)</span></span>

<span data-ttu-id="03944-116">对于这些教程，我们将使用位于**应用\_数据**目录中的 Northwind 数据库的 Microsoft SQL Server 2005 Express Edition 版本。</span><span class="sxs-lookup"><span data-stu-id="03944-116">For these tutorials we'll be using a Microsoft SQL Server 2005 Express Edition version of the Northwind database placed in the **App\_Data** directory.</span></span> <span data-ttu-id="03944-117">除了数据库文件，**应用\_Data**文件夹还包含用于创建数据库的 SQL 脚本，以防您要使用不同的数据库版本。</span><span class="sxs-lookup"><span data-stu-id="03944-117">In addition to the database file, the **App\_Data** folder also contains the SQL scripts for creating the database, in case you want to use a different database version.</span></span> <span data-ttu-id="03944-118">如果愿意，也可以[直接从 Microsoft 下载](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en)这些脚本。</span><span class="sxs-lookup"><span data-stu-id="03944-118">These scripts can be also be [downloaded directly from Microsoft](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en), if you'd prefer.</span></span> <span data-ttu-id="03944-119">如果使用不同的 SQL Server 版本的 Northwind 数据库，则需要更新应用程序的**web.config**文件中的**NORTHWNDConnectionString**设置。</span><span class="sxs-lookup"><span data-stu-id="03944-119">If you use a different SQL Server version of the Northwind database, you will need to update the **NORTHWNDConnectionString** setting in the application's **Web.config** file.</span></span> <span data-ttu-id="03944-120">Web 应用程序是使用 Visual Studio 2005 Professional Edition 作为基于文件系统的网站项目生成的。</span><span class="sxs-lookup"><span data-stu-id="03944-120">The web application was built using Visual Studio 2005 Professional Edition as a file system-based Web site project.</span></span> <span data-ttu-id="03944-121">但是，所有教程都将同样适用于 Visual Studio 2005 （ [Visual Web Developer](https://msdn.microsoft.com/vstudio/express/vwd/)）的免费版本。</span><span class="sxs-lookup"><span data-stu-id="03944-121">However, all of the tutorials will work equally well with the free version of Visual Studio 2005, [Visual Web Developer](https://msdn.microsoft.com/vstudio/express/vwd/).</span></span>  
  
<span data-ttu-id="03944-122">在本教程中，我们将从头开始创建数据访问层（DAL），然后在第二个教程中创建业务逻辑层（BLL），并在第三个教程中处理页面布局和导航。</span><span class="sxs-lookup"><span data-stu-id="03944-122">In this tutorial we'll start from the very beginning and create the Data Access Layer (DAL), followed by creating the Business Logic Layer (BLL) in the second tutorial, and working on page layout and navigation in the third.</span></span> <span data-ttu-id="03944-123">第三个教程之后的教程将基于前三个中的基础布局进行构建。</span><span class="sxs-lookup"><span data-stu-id="03944-123">The tutorials after the third one will build upon the foundation laid in the first three.</span></span> <span data-ttu-id="03944-124">在本教程的第一篇教程中，我们有很多介绍，因此请启动 Visual Studio，让我们开始吧！</span><span class="sxs-lookup"><span data-stu-id="03944-124">We've got a lot to cover in this first tutorial, so fire up Visual Studio and let's get started!</span></span>

## <a name="step-1-creating-a-web-project-and-connecting-to-the-database"></a><span data-ttu-id="03944-125">步骤1：创建 Web 项目并连接到数据库</span><span class="sxs-lookup"><span data-stu-id="03944-125">Step 1: Creating a Web Project and Connecting to the Database</span></span>

<span data-ttu-id="03944-126">在我们可以创建数据访问层（DAL）之前，首先需要创建一个网站并设置数据库。</span><span class="sxs-lookup"><span data-stu-id="03944-126">Before we can create our Data Access Layer (DAL), we first need to create a web site and setup our database.</span></span> <span data-ttu-id="03944-127">首先，创建新的基于文件系统的 ASP.NET 网站。</span><span class="sxs-lookup"><span data-stu-id="03944-127">Start by creating a new file system-based ASP.NET web site.</span></span> <span data-ttu-id="03944-128">若要实现此目的，请在 "文件" 菜单中选择 "新建网站"，并显示 "新建网站" 对话框。</span><span class="sxs-lookup"><span data-stu-id="03944-128">To accomplish this, go to the File menu and choose New Web Site, displaying the New Web Site dialog box.</span></span> <span data-ttu-id="03944-129">选择 ASP.NET 网站模板，将 "位置" 下拉列表设置为 "文件系统"，选择要放置该网站的文件夹，并将语言设置为C#。</span><span class="sxs-lookup"><span data-stu-id="03944-129">Choose the ASP.NET Web Site template, set the Location drop-down list to File System, choose a folder to place the web site, and set the language to C#.</span></span>

<span data-ttu-id="03944-130">[![创建基于文件系统的新网站](creating-a-data-access-layer-cs/_static/image2.png)](creating-a-data-access-layer-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="03944-130">[![Create a New File System-Based Web Site](creating-a-data-access-layer-cs/_static/image2.png)](creating-a-data-access-layer-cs/_static/image1.png)</span></span>

<span data-ttu-id="03944-131">**图 1**：创建新的基于文件系统的网站（[单击查看完全大小的图像](creating-a-data-access-layer-cs/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-131">**Figure 1**: Create a New File System-Based Web Site ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image3.png))</span></span>

<span data-ttu-id="03944-132">这将创建一个新网站，其中包含**默认的 .aspx** ASP.NET 页和一个**应用\_Data**文件夹。</span><span class="sxs-lookup"><span data-stu-id="03944-132">This will create a new web site with a **Default.aspx** ASP.NET page and an **App\_Data** folder.</span></span>

<span data-ttu-id="03944-133">创建网站后，下一步是在 Visual Studio 的服务器资源管理器中添加对数据库的引用。</span><span class="sxs-lookup"><span data-stu-id="03944-133">With the web site created, the next step is to add a reference to the database in Visual Studio's Server Explorer.</span></span> <span data-ttu-id="03944-134">通过将数据库添加到服务器资源管理器您可以在 Visual Studio 中添加表、存储过程、视图等。</span><span class="sxs-lookup"><span data-stu-id="03944-134">By adding a database to the Server Explorer you can add tables, stored procedures, views, and so on all from within Visual Studio.</span></span> <span data-ttu-id="03944-135">还可以通过查询生成器手动或以图形方式查看表数据或创建自己的查询。</span><span class="sxs-lookup"><span data-stu-id="03944-135">You can also view table data or create your own queries either by hand or graphically via the Query Builder.</span></span> <span data-ttu-id="03944-136">此外，当我们为 DAL 生成类型化数据集时，我们需要将 Visual Studio 指向用于构造类型化数据集的数据库。</span><span class="sxs-lookup"><span data-stu-id="03944-136">Furthermore, when we build the Typed DataSets for the DAL we'll need to point Visual Studio to the database from which the Typed DataSets should be constructed.</span></span> <span data-ttu-id="03944-137">虽然我们可以在该时间点提供此连接信息，但 Visual Studio 会自动填充已在服务器资源管理器中注册的数据库的下拉列表。</span><span class="sxs-lookup"><span data-stu-id="03944-137">While we can provide this connection information at that point in time, Visual Studio automatically populates a drop-down list of the databases already registered in the Server Explorer.</span></span>

<span data-ttu-id="03944-138">将 Northwind 数据库添加到服务器资源管理器的步骤取决于您是要使用**应用\_Data**文件夹中的 SQL Server 2005 Express Edition 数据库，还是要改为使用 Microsoft SQL Server 2000 或2005数据库服务器安装程序。</span><span class="sxs-lookup"><span data-stu-id="03944-138">The steps for adding the Northwind database to the Server Explorer depend on whether you want to use the SQL Server 2005 Express Edition database in the **App\_Data** folder or if you have a Microsoft SQL Server 2000 or 2005 database server setup that you want to use instead.</span></span>

## <a name="using-a-database-in-the-app_data-folder"></a><span data-ttu-id="03944-139">在应用中使用数据库\_Data 文件夹</span><span class="sxs-lookup"><span data-stu-id="03944-139">Using a Database in the App\_Data Folder</span></span>

<span data-ttu-id="03944-140">如果没有要连接到 SQL Server 2000 或2005数据库服务器，或者只是想要避免将数据库添加到数据库服务器，则可以使用下载网站的**应用\_Data**文件夹（northwnd.mdf）中的 SQL Server 2005 Express Edition 版本 Northwind 数据库 **.MDF**）。</span><span class="sxs-lookup"><span data-stu-id="03944-140">If you do not have a SQL Server 2000 or 2005 database server to connect to, or you simply want to avoid having to add the database to a database server, you can use the SQL Server 2005 Express Edition version of the Northwind database that is located in the downloaded website's **App\_Data** folder (**NORTHWND.MDF**).</span></span>

<span data-ttu-id="03944-141">放置在**应用\_Data**文件夹中的数据库将自动添加到服务器资源管理器中。</span><span class="sxs-lookup"><span data-stu-id="03944-141">A database placed in the **App\_Data** folder is automatically added to the Server Explorer.</span></span> <span data-ttu-id="03944-142">假设计算机上已安装 SQL Server 2005 Express Edition，应会看到名为 NORTHWND.MDF 的节点。服务器资源管理器中的 MDF，你可以展开并浏览其表、视图、存储过程等（参见图2）。</span><span class="sxs-lookup"><span data-stu-id="03944-142">Assuming you have SQL Server 2005 Express Edition installed on your machine you should see a node named NORTHWND.MDF in the Server Explorer, which you can expand and explore its tables, views, stored procedure, and so on (see Figure 2).</span></span>

<span data-ttu-id="03944-143">**应用\_Data**文件夹还可以保存 Microsoft Access **.mdb**文件，如其 SQL Server 对应项，它们会自动添加到服务器资源管理器中。</span><span class="sxs-lookup"><span data-stu-id="03944-143">The **App\_Data** folder can also hold Microsoft Access **.mdb** files, which, like their SQL Server counterparts, are automatically added to the Server Explorer.</span></span> <span data-ttu-id="03944-144">如果不想使用任何 SQL Server 选项，则始终可以[下载 Northwind 数据库文件的 Microsoft Access 版本](https://www.microsoft.com/downloads/details.aspx?FamilyID=C6661372-8DBE-422B-8676-C632D66C529C&amp;displaylang=EN)，并将其放入**应用\_数据**目录中。</span><span class="sxs-lookup"><span data-stu-id="03944-144">If you don't want to use any of the SQL Server options, you can always [download a Microsoft Access version of the Northwind database file](https://www.microsoft.com/downloads/details.aspx?FamilyID=C6661372-8DBE-422B-8676-C632D66C529C&amp;displaylang=EN) and drop into the **App\_Data** directory.</span></span> <span data-ttu-id="03944-145">但请记住，访问数据库与 SQL Server 功能不同，并且不是在网站方案中使用而设计的。</span><span class="sxs-lookup"><span data-stu-id="03944-145">Keep in mind, however, that Access databases aren't as feature-rich as SQL Server, and aren't designed to be used in web site scenarios.</span></span> <span data-ttu-id="03944-146">而且，有几个以上的教程将使用 Access 不支持的某些数据库级功能。</span><span class="sxs-lookup"><span data-stu-id="03944-146">Furthermore, a couple of the 35+ tutorials will utilize certain database-level features that aren't supported by Access.</span></span>

## <a name="connecting-to-the-database-in-a-microsoft-sql-server-2000-or-2005-database-server"></a><span data-ttu-id="03944-147">连接到 Microsoft SQL Server 2000 或2005数据库服务器中的数据库</span><span class="sxs-lookup"><span data-stu-id="03944-147">Connecting to the Database in a Microsoft SQL Server 2000 or 2005 Database Server</span></span>

<span data-ttu-id="03944-148">或者，您可以连接到在数据库服务器上安装的 Northwind 数据库。</span><span class="sxs-lookup"><span data-stu-id="03944-148">Alternatively, you may connect to a Northwind database installed on a database server.</span></span> <span data-ttu-id="03944-149">如果数据库服务器尚未安装 Northwind 数据库，则必须先通过运行本教程下载中包含的安装脚本，或直接从 Microsoft 网站[下载 SQL Server 2000 版 Northwind 和安装脚本](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en)，将其添加到数据库服务器。</span><span class="sxs-lookup"><span data-stu-id="03944-149">If the database server does not already have the Northwind database installed, you first must add it to database server by running the installation script included in this tutorial's download or by [downloading the SQL Server 2000 version of Northwind and installation script](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en) directly from Microsoft's web site.</span></span>

<span data-ttu-id="03944-150">安装数据库后，请在 Visual Studio 中转到服务器资源管理器，右键单击 "数据连接" 节点，然后选择 "添加连接"。</span><span class="sxs-lookup"><span data-stu-id="03944-150">Once you have the database installed, go to the Server Explorer in Visual Studio, right-click on the Data Connections node, and choose Add Connection.</span></span> <span data-ttu-id="03944-151">如果看不到 "服务器资源管理器请访问视图/服务器资源管理器，或按 Ctrl + Alt + S。</span><span class="sxs-lookup"><span data-stu-id="03944-151">If you don't see the Server Explorer go to the View / Server Explorer, or hit Ctrl+Alt+S.</span></span> <span data-ttu-id="03944-152">此时将显示 "添加连接" 对话框，你可以在该对话框中指定要连接的服务器、身份验证信息和数据库名称。</span><span class="sxs-lookup"><span data-stu-id="03944-152">This will bring up the Add Connection dialog box, where you can specify the server to connect to, the authentication information, and the database name.</span></span> <span data-ttu-id="03944-153">成功配置数据库连接信息并单击 "确定" 按钮后，该数据库将添加为 "数据连接" 节点下的节点。</span><span class="sxs-lookup"><span data-stu-id="03944-153">Once you have successfully configured the database connection information and clicked the OK button, the database will be added as a node underneath the Data Connections node.</span></span> <span data-ttu-id="03944-154">您可以展开 "数据库" 节点以浏览其表、视图和存储过程等。</span><span class="sxs-lookup"><span data-stu-id="03944-154">You can expand the database node to explore its tables, views, stored procedures, and so on.</span></span>

![添加与数据库服务器的 Northwind 数据库的连接](creating-a-data-access-layer-cs/_static/image4.png)

<span data-ttu-id="03944-156">**图 2**：将连接添加到数据库服务器的 Northwind 数据库</span><span class="sxs-lookup"><span data-stu-id="03944-156">**Figure 2**: Add a Connection to Your Database Server's Northwind Database</span></span>

## <a name="step-2-creating-the-data-access-layer"></a><span data-ttu-id="03944-157">步骤2：创建数据访问层</span><span class="sxs-lookup"><span data-stu-id="03944-157">Step 2: Creating the Data Access Layer</span></span>

<span data-ttu-id="03944-158">当处理数据时，一个选项是将特定于数据的逻辑直接嵌入到表示层（在 web 应用程序中，ASP.NET 页面构成表示层）。</span><span class="sxs-lookup"><span data-stu-id="03944-158">When working with data one option is to embed the data-specific logic directly into the presentation layer (in a web application, the ASP.NET pages make up the presentation layer).</span></span> <span data-ttu-id="03944-159">这可能采用以下形式：在 ASP.NET 页面的代码部分中编写 ADO.NET 代码，或从标记部分使用 SqlDataSource 控件。</span><span class="sxs-lookup"><span data-stu-id="03944-159">This may take the form of writing ADO.NET code in the ASP.NET page's code portion or using the SqlDataSource control from the markup portion.</span></span> <span data-ttu-id="03944-160">在这两种情况下，这种方法将数据访问逻辑与表示层紧密耦合在一起。</span><span class="sxs-lookup"><span data-stu-id="03944-160">In either case, this approach tightly couples the data access logic with the presentation layer.</span></span> <span data-ttu-id="03944-161">不过，建议的方法是将数据访问逻辑与表示层区分开来。</span><span class="sxs-lookup"><span data-stu-id="03944-161">The recommended approach, however, is to separate the data access logic from the presentation layer.</span></span> <span data-ttu-id="03944-162">这个单独的层称为数据访问层，DAL 表示 short，通常作为单独的类库项目来实现。</span><span class="sxs-lookup"><span data-stu-id="03944-162">This separate layer is referred to as the Data Access Layer, DAL for short, and is typically implemented as a separate Class Library project.</span></span> <span data-ttu-id="03944-163">此分层体系结构的优点已记录良好（有关这些优点的信息，请参阅本教程末尾的 "进一步阅读" 部分），这是我们将在此系列中采用的方法。</span><span class="sxs-lookup"><span data-stu-id="03944-163">The benefits of this layered architecture are well documented (see the "Further Readings" section at the end of this tutorial for information on these advantages) and is the approach we will take in this series.</span></span>

<span data-ttu-id="03944-164">所有特定于基础数据源的代码（例如创建与数据库的连接、发出**SELECT**、 **INSERT**、 **UPDATE**和**DELETE**命令等）都应该位于 DAL。</span><span class="sxs-lookup"><span data-stu-id="03944-164">All code that is specific to the underlying data source such as creating a connection to the database, issuing **SELECT**, **INSERT**, **UPDATE**, and **DELETE** commands, and so on should be located in the DAL.</span></span> <span data-ttu-id="03944-165">表示层不应包含对此类数据访问代码的任何引用，但应改为对任何和所有数据请求调用 DAL。</span><span class="sxs-lookup"><span data-stu-id="03944-165">The presentation layer should not contain any references to such data access code, but should instead make calls into the DAL for any and all data requests.</span></span> <span data-ttu-id="03944-166">数据访问层通常包含用于访问基础数据库数据的方法。</span><span class="sxs-lookup"><span data-stu-id="03944-166">Data Access Layers typically contain methods for accessing the underlying database data.</span></span> <span data-ttu-id="03944-167">例如，Northwind 数据库具有 "**产品**" 和 "**类别**" 表，它们记录要销售的产品及其所属的类别。</span><span class="sxs-lookup"><span data-stu-id="03944-167">The Northwind database, for example, has **Products** and **Categories** tables that record the products for sale and the categories to which they belong.</span></span> <span data-ttu-id="03944-168">在我们的 DAL 中，我们将有如下方法：</span><span class="sxs-lookup"><span data-stu-id="03944-168">In our DAL we will have methods like:</span></span>

- <span data-ttu-id="03944-169">**GetCategories （），** 将返回有关所有类别的信息</span><span class="sxs-lookup"><span data-stu-id="03944-169">**GetCategories(),** which will return information about all of the categories</span></span>
- <span data-ttu-id="03944-170">**GetProducts （）** ，将返回有关所有产品的信息</span><span class="sxs-lookup"><span data-stu-id="03944-170">**GetProducts()**, which will return information about all of the products</span></span>
- <span data-ttu-id="03944-171">**GetProductsByCategoryID （*类别 id*）** ，将返回属于指定类别的所有产品</span><span class="sxs-lookup"><span data-stu-id="03944-171">**GetProductsByCategoryID(*categoryID*)**, which will return all products that belong to a specified category</span></span>
- <span data-ttu-id="03944-172">**GetProductByProductID （*productID*）** ，将返回有关特定产品的信息</span><span class="sxs-lookup"><span data-stu-id="03944-172">**GetProductByProductID(*productID*)**, which will return information about a particular product</span></span>

<span data-ttu-id="03944-173">这些方法在调用时会连接到数据库，发出适当的查询并返回结果。</span><span class="sxs-lookup"><span data-stu-id="03944-173">These methods, when invoked, will connect to the database, issue the appropriate query, and return the results.</span></span> <span data-ttu-id="03944-174">我们返回这些结果的方式非常重要。</span><span class="sxs-lookup"><span data-stu-id="03944-174">How we return these results is important.</span></span> <span data-ttu-id="03944-175">这些方法只是返回由数据库查询填充的数据集或 DataReader，但最好使用*强类型对象*返回这些结果。</span><span class="sxs-lookup"><span data-stu-id="03944-175">These methods could simply return a DataSet or DataReader populated by the database query, but ideally these results should be returned using *strongly-typed objects*.</span></span> <span data-ttu-id="03944-176">强类型对象是其架构在编译时严格定义的对象，相反，松散类型化对象是指其架构在运行时之前是未知的。</span><span class="sxs-lookup"><span data-stu-id="03944-176">A strongly-typed object is one whose schema is rigidly defined at compile time, whereas the opposite, a loosely-typed object, is one whose schema is not known until runtime.</span></span>

<span data-ttu-id="03944-177">例如，DataReader 和 DataSet （默认情况下）是松散类型化的对象，因为它们的架构由用于填充它们的数据库查询所返回的列定义。</span><span class="sxs-lookup"><span data-stu-id="03944-177">For example, the DataReader and the DataSet (by default) are loosely-typed objects since their schema is defined by the columns returned by the database query used to populate them.</span></span> <span data-ttu-id="03944-178">若要从松散类型的 DataTable 访问特定列，需要使用类似于以下内容的语法：  <strong><em>DataTable</em>。Rows [<em>index</em>] ["<em>columnName</em>"]</strong>。</span><span class="sxs-lookup"><span data-stu-id="03944-178">To access a particular column from a loosely-typed DataTable we need to use syntax like: <strong><em>DataTable</em>.Rows[<em>index</em>]["<em>columnName</em>"]</strong>.</span></span> <span data-ttu-id="03944-179">在此示例中，DataTable 的松散类型会表现为需要使用字符串或序号索引访问列名的事实。</span><span class="sxs-lookup"><span data-stu-id="03944-179">The DataTable's loose typing in this example is exhibited by the fact that we need to access the column name using a string or ordinal index.</span></span> <span data-ttu-id="03944-180">另一方面，强类型的数据表会将其每个列作为属性实现，生成的代码如下所示：  <strong><em>DataTable</em>。Rows [<em>index</em>]。*columnName</strong>* 。</span><span class="sxs-lookup"><span data-stu-id="03944-180">A strongly-typed DataTable, on the other hand, will have each of its columns implemented as properties, resulting in code that looks like: <strong><em>DataTable</em>.Rows[<em>index</em>].*columnName</strong>*.</span></span>

<span data-ttu-id="03944-181">若要返回强类型对象，开发人员可以创建自己的自定义业务对象或使用类型化数据集。</span><span class="sxs-lookup"><span data-stu-id="03944-181">To return strongly-typed objects, developers can either create their own custom business objects or use Typed DataSets.</span></span> <span data-ttu-id="03944-182">业务对象由开发人员作为类实现，该类的属性通常反映业务对象表示的基础数据库表的列。</span><span class="sxs-lookup"><span data-stu-id="03944-182">A business object is implemented by the developer as a class whose properties typically reflect the columns of the underlying database table the business object represents.</span></span> <span data-ttu-id="03944-183">类型化数据集是由 Visual Studio 基于数据库架构生成的类，其成员根据此架构进行强类型化。</span><span class="sxs-lookup"><span data-stu-id="03944-183">A Typed DataSet is a class generated for you by Visual Studio based on a database schema and whose members are strongly-typed according to this schema.</span></span> <span data-ttu-id="03944-184">类型化数据集本身由扩展 ADO.NET 数据集、DataTable 和 DataRow 类的类组成。</span><span class="sxs-lookup"><span data-stu-id="03944-184">The Typed DataSet itself consists of classes that extend the ADO.NET DataSet, DataTable, and DataRow classes.</span></span> <span data-ttu-id="03944-185">除了强类型数据表以外，类型化的数据集现在还包括 Tableadapter，这些类具有用于填充数据集的数据表和将数据表中的修改传播回数据库的方法。</span><span class="sxs-lookup"><span data-stu-id="03944-185">In addition to strongly-typed DataTables, Typed DataSets now also include TableAdapters, which are classes with methods for populating the DataSet's DataTables and propagating modifications within the DataTables back to the database.</span></span>

> [!NOTE]
> <span data-ttu-id="03944-186">有关使用类型化数据集与自定义业务对象的优点和缺点的详细信息，请参阅[设计数据层组件和通过层传递数据](https://msdn.microsoft.com/library/ms978496.aspx)。</span><span class="sxs-lookup"><span data-stu-id="03944-186">For more information on the advantages and disadvantages of using Typed DataSets versus custom business objects, refer to [Designing Data Tier Components and Passing Data Through Tiers](https://msdn.microsoft.com/library/ms978496.aspx).</span></span>

<span data-ttu-id="03944-187">我们会将强类型化数据集用于这些教程的体系结构。</span><span class="sxs-lookup"><span data-stu-id="03944-187">We'll use strongly-typed DataSets for these tutorials' architecture.</span></span> <span data-ttu-id="03944-188">图3说明了使用类型化数据集的应用程序的不同层之间的工作流。</span><span class="sxs-lookup"><span data-stu-id="03944-188">Figure 3 illustrates the workflow between the different layers of an application that uses Typed DataSets.</span></span>

<span data-ttu-id="03944-189">[![将所有数据访问代码归入 DAL](creating-a-data-access-layer-cs/_static/image6.png)](creating-a-data-access-layer-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="03944-189">[![All Data Access Code is Relegated to the DAL](creating-a-data-access-layer-cs/_static/image6.png)](creating-a-data-access-layer-cs/_static/image5.png)</span></span>

<span data-ttu-id="03944-190">**图 3**：将所有数据访问代码归入 DAL （[单击以查看完全大小的图像](creating-a-data-access-layer-cs/_static/image7.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-190">**Figure 3**: All Data Access Code is Relegated to the DAL ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image7.png))</span></span>

## <a name="creating-a-typed-dataset-and-table-adapter"></a><span data-ttu-id="03944-191">创建类型化数据集和表适配器</span><span class="sxs-lookup"><span data-stu-id="03944-191">Creating a Typed DataSet and Table Adapter</span></span>

<span data-ttu-id="03944-192">若要开始创建 DAL，我们首先向项目中添加类型化数据集。</span><span class="sxs-lookup"><span data-stu-id="03944-192">To begin creating our DAL, we start by adding a Typed DataSet to our project.</span></span> <span data-ttu-id="03944-193">若要实现此目的，请在解决方案资源管理器中右键单击项目节点，然后选择 "添加新项"。</span><span class="sxs-lookup"><span data-stu-id="03944-193">To accomplish this, right-click on the project node in the Solution Explorer and choose Add a New Item.</span></span> <span data-ttu-id="03944-194">从模板列表中选择 "数据集" 选项，并将其命名为 " **Northwind**"。</span><span class="sxs-lookup"><span data-stu-id="03944-194">Select the DataSet option from the list of templates and name it **Northwind.xsd**.</span></span>

<span data-ttu-id="03944-195">[![选择向项目添加新的数据集](creating-a-data-access-layer-cs/_static/image9.png)](creating-a-data-access-layer-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="03944-195">[![Choose to Add a New DataSet to Your Project](creating-a-data-access-layer-cs/_static/image9.png)](creating-a-data-access-layer-cs/_static/image8.png)</span></span>

<span data-ttu-id="03944-196">**图 4**：选择将新的数据集添加到项目中（[单击以查看完全大小的图像](creating-a-data-access-layer-cs/_static/image10.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-196">**Figure 4**: Choose to Add a New DataSet to Your Project ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image10.png))</span></span>

<span data-ttu-id="03944-197">单击 "添加" 后，系统提示将数据集添加到**应用\_代码**文件夹中时，请选择 "是"。</span><span class="sxs-lookup"><span data-stu-id="03944-197">After clicking Add, when prompted to add the DataSet to the **App\_Code** folder, choose Yes.</span></span> <span data-ttu-id="03944-198">然后，将显示类型化数据集的设计器，并启动 TableAdapter 配置向导，使你可以将第一个 TableAdapter 添加到类型化数据集。</span><span class="sxs-lookup"><span data-stu-id="03944-198">The Designer for the Typed DataSet will then be displayed, and the TableAdapter Configuration Wizard will start, allowing you to add your first TableAdapter to the Typed DataSet.</span></span>

<span data-ttu-id="03944-199">类型化数据集用作数据的强类型集合;它由强类型的 DataTable 实例组成，其中每个实例又构成强类型的 DataRow 实例。</span><span class="sxs-lookup"><span data-stu-id="03944-199">A Typed DataSet serves as a strongly-typed collection of data; it is composed of strongly-typed DataTable instances, each of which is in turn composed of strongly-typed DataRow instances.</span></span> <span data-ttu-id="03944-200">我们将为每个需要在本教程系列中使用的基础数据库表创建一个强类型的数据表。</span><span class="sxs-lookup"><span data-stu-id="03944-200">We will create a strongly-typed DataTable for each of the underlying database tables that we need to work with in this tutorials series.</span></span> <span data-ttu-id="03944-201">首先，让我们为**Products**表创建 DataTable。</span><span class="sxs-lookup"><span data-stu-id="03944-201">Let's start with creating a DataTable for the **Products** table.</span></span>

<span data-ttu-id="03944-202">请记住，强类型的数据表不包含有关如何访问其基础数据库表中的数据的任何信息。</span><span class="sxs-lookup"><span data-stu-id="03944-202">Keep in mind that strongly-typed DataTables do not include any information on how to access data from their underlying database table.</span></span> <span data-ttu-id="03944-203">为了检索用于填充 DataTable 的数据，我们使用 TableAdapter 类作为数据访问层。</span><span class="sxs-lookup"><span data-stu-id="03944-203">In order to retrieve the data to populate the DataTable, we use a TableAdapter class, which functions as our Data Access Layer.</span></span> <span data-ttu-id="03944-204">对于**Products** DataTable，TableAdapter 将包含方法**GetProducts （）** 、 **GetProductByCategoryID （*类别 id*）** 等，我们将从表示层调用这些方法。</span><span class="sxs-lookup"><span data-stu-id="03944-204">For our **Products** DataTable, the TableAdapter will contain the methods **GetProducts()**, **GetProductByCategoryID(*categoryID*)**, and so on that we'll invoke from the presentation layer.</span></span> <span data-ttu-id="03944-205">DataTable 的角色充当用于在层之间传递数据的强类型对象。</span><span class="sxs-lookup"><span data-stu-id="03944-205">The DataTable's role is to serve as the strongly-typed objects used to pass data between the layers.</span></span>

<span data-ttu-id="03944-206">TableAdapter 配置向导首先提示您选择要使用的数据库。</span><span class="sxs-lookup"><span data-stu-id="03944-206">The TableAdapter Configuration Wizard begins by prompting you to select which database to work with.</span></span> <span data-ttu-id="03944-207">下拉列表显示了服务器资源管理器中的数据库。</span><span class="sxs-lookup"><span data-stu-id="03944-207">The drop-down list shows those databases in the Server Explorer.</span></span> <span data-ttu-id="03944-208">如果未将 Northwind 数据库添加到服务器资源管理器，则此时可以单击 "新建连接" 按钮来执行此操作。</span><span class="sxs-lookup"><span data-stu-id="03944-208">If you did not add the Northwind database to the Server Explorer, you can click the New Connection button at this time to do so.</span></span>

<span data-ttu-id="03944-209">[从下拉列表中 ![选择 Northwind 数据库](creating-a-data-access-layer-cs/_static/image12.png)](creating-a-data-access-layer-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="03944-209">[![Choose the Northwind Database from the Drop-Down List](creating-a-data-access-layer-cs/_static/image12.png)](creating-a-data-access-layer-cs/_static/image11.png)</span></span>

<span data-ttu-id="03944-210">**图 5**：从下拉列表中选择 Northwind 数据库（[单击以查看完全大小的映像](creating-a-data-access-layer-cs/_static/image13.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-210">**Figure 5**: Choose the Northwind Database from the Drop-Down List ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image13.png))</span></span>

<span data-ttu-id="03944-211">选择数据库并单击 "下一步" 后，系统会询问你是否要将连接字符串**保存到 web.config 文件中**。</span><span class="sxs-lookup"><span data-stu-id="03944-211">After selecting the database and clicking Next, you'll be asked if you want to save the connection string in the **Web.config** file.</span></span> <span data-ttu-id="03944-212">通过保存连接字符串，你将避免在 TableAdapter 类中对其进行硬编码，从而简化了连接字符串信息将来的更改。</span><span class="sxs-lookup"><span data-stu-id="03944-212">By saving the connection string you'll avoid having it hard coded in the TableAdapter classes, which simplifies things if the connection string information changes in the future.</span></span> <span data-ttu-id="03944-213">如果选择将连接字符串保存在配置文件中，则该字符串位于 **&lt;connectionStrings&gt;** "部分中，可以选择对其进行[加密](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx)以提高安全性，也可以在以后通过 IIS GUI 管理工具中的" 新建 ASP.NET 2.0 "属性页进行修改，这对管理员更加理想。</span><span class="sxs-lookup"><span data-stu-id="03944-213">If you opt to save the connection string in the configuration file it's placed in the **&lt;connectionStrings&gt;** section, which can be [optionally encrypted](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx) for improved security or modified later through the new ASP.NET 2.0 Property Page within the IIS GUI Admin Tool, which is more ideal for administrators.</span></span>

<span data-ttu-id="03944-214">[![将连接字符串保存到 web.config](creating-a-data-access-layer-cs/_static/image15.png)](creating-a-data-access-layer-cs/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="03944-214">[![Save the Connection String to Web.config](creating-a-data-access-layer-cs/_static/image15.png)](creating-a-data-access-layer-cs/_static/image14.png)</span></span>

<span data-ttu-id="03944-215">**图 6**：将连接字符串保存到**web.config （** [单击以查看完全大小的图像](creating-a-data-access-layer-cs/_static/image16.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-215">**Figure 6**: Save the Connection String to **Web.config** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image16.png))</span></span>

<span data-ttu-id="03944-216">接下来，我们需要为第一个强类型的 DataTable 定义架构，并提供在填充强类型化数据集时用于 TableAdapter 的第一种方法。</span><span class="sxs-lookup"><span data-stu-id="03944-216">Next, we need to define the schema for the first strongly-typed DataTable and provide the first method for our TableAdapter to use when populating the strongly-typed DataSet.</span></span> <span data-ttu-id="03944-217">这两个步骤是通过创建一个查询来实现的，该查询返回表中我们要在 DataTable 中反映的列。</span><span class="sxs-lookup"><span data-stu-id="03944-217">These two steps are accomplished simultaneously by creating a query that returns the columns from the table that we want reflected in our DataTable.</span></span> <span data-ttu-id="03944-218">在向导结束时，我们将为此查询指定方法名称。</span><span class="sxs-lookup"><span data-stu-id="03944-218">At the end of the wizard we'll give a method name to this query.</span></span> <span data-ttu-id="03944-219">完成此操作后，可以从表示层调用此方法。</span><span class="sxs-lookup"><span data-stu-id="03944-219">Once that's been accomplished, this method can be invoked from our presentation layer.</span></span> <span data-ttu-id="03944-220">方法将执行定义的查询并填充强类型的 DataTable。</span><span class="sxs-lookup"><span data-stu-id="03944-220">The method will execute the defined query and populate a strongly-typed DataTable.</span></span>

<span data-ttu-id="03944-221">若要开始定义 SQL 查询，我们必须首先指出我们希望 TableAdapter 如何发出查询。</span><span class="sxs-lookup"><span data-stu-id="03944-221">To get started defining the SQL query we must first indicate how we want the TableAdapter to issue the query.</span></span> <span data-ttu-id="03944-222">我们可以使用即席 SQL 语句、创建新的存储过程或使用现有的存储过程。</span><span class="sxs-lookup"><span data-stu-id="03944-222">We can use an ad-hoc SQL statement, create a new stored procedure, or use an existing stored procedure.</span></span> <span data-ttu-id="03944-223">对于这些教程，我们将使用即席 SQL 语句。</span><span class="sxs-lookup"><span data-stu-id="03944-223">For these tutorials we'll use ad-hoc SQL statements.</span></span> <span data-ttu-id="03944-224">有关使用存储过程的示例，请参阅[Brian Noyes](http://briannoyes.net/)的文章[使用 Visual Studio 2005 数据集设计器生成数据访问层](http://www.theserverside.net/articles/showarticle.tss?id=DataSetDesigner)。</span><span class="sxs-lookup"><span data-stu-id="03944-224">Refer to [Brian Noyes](http://briannoyes.net/)'s article, [Build a Data Access Layer with the Visual Studio 2005 DataSet Designer](http://www.theserverside.net/articles/showarticle.tss?id=DataSetDesigner) for an example of using stored procedures.</span></span>

<span data-ttu-id="03944-225">[使用即席 SQL 语句 ![查询数据](creating-a-data-access-layer-cs/_static/image18.png)](creating-a-data-access-layer-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="03944-225">[![Query the Data Using an Ad-Hoc SQL Statement](creating-a-data-access-layer-cs/_static/image18.png)](creating-a-data-access-layer-cs/_static/image17.png)</span></span>

<span data-ttu-id="03944-226">**图 7**：使用即席 SQL 语句查询数据（[单击以查看完全大小的映像](creating-a-data-access-layer-cs/_static/image19.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-226">**Figure 7**: Query the Data Using an Ad-Hoc SQL Statement ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image19.png))</span></span>

<span data-ttu-id="03944-227">此时，我们可以手动键入 SQL 查询。</span><span class="sxs-lookup"><span data-stu-id="03944-227">At this point we can type in the SQL query by hand.</span></span> <span data-ttu-id="03944-228">在 TableAdapter 中创建第一个方法时，通常希望让查询返回那些需要在对应的 DataTable 中表达的列。</span><span class="sxs-lookup"><span data-stu-id="03944-228">When creating the first method in the TableAdapter you typically want to have the query return those columns that need to be expressed in the corresponding DataTable.</span></span> <span data-ttu-id="03944-229">为此，我们可以创建一个查询，该查询返回**Products**表中的所有列和所有行：</span><span class="sxs-lookup"><span data-stu-id="03944-229">We can accomplish this by creating a query that returns all columns and all rows from the **Products** table:</span></span>

<span data-ttu-id="03944-230">[![在文本框中输入 SQL 查询](creating-a-data-access-layer-cs/_static/image21.png)](creating-a-data-access-layer-cs/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="03944-230">[![Enter the SQL Query Into the Textbox](creating-a-data-access-layer-cs/_static/image21.png)](creating-a-data-access-layer-cs/_static/image20.png)</span></span>

<span data-ttu-id="03944-231">**图 8**：在文本框中输入 SQL 查询（[单击以查看完全大小的图像](creating-a-data-access-layer-cs/_static/image22.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-231">**Figure 8**: Enter the SQL Query Into the Textbox ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image22.png))</span></span>

<span data-ttu-id="03944-232">或者，使用查询生成器，并以图形方式构造查询，如图9所示。</span><span class="sxs-lookup"><span data-stu-id="03944-232">Alternatively, use the Query Builder and graphically construct the query, as shown in Figure 9.</span></span>

<span data-ttu-id="03944-233">[![通过查询编辑器以图形方式创建查询](creating-a-data-access-layer-cs/_static/image24.png)](creating-a-data-access-layer-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="03944-233">[![Create the Query Graphically, through the Query Editor](creating-a-data-access-layer-cs/_static/image24.png)](creating-a-data-access-layer-cs/_static/image23.png)</span></span>

<span data-ttu-id="03944-234">**图 9**：通过查询编辑器以图形方式创建查询（[单击查看完全大小的图像](creating-a-data-access-layer-cs/_static/image25.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-234">**Figure 9**: Create the Query Graphically, through the Query Editor ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image25.png))</span></span>

<span data-ttu-id="03944-235">创建查询后，但在转到下一屏之前，请单击 "高级选项" 按钮。</span><span class="sxs-lookup"><span data-stu-id="03944-235">After creating the query, but before moving onto the next screen, click the Advanced Options button.</span></span> <span data-ttu-id="03944-236">在网站项目中，"生成 Insert、Update 和 Delete 语句" 是默认情况下唯一选择的高级选项;如果从类库或 Windows 项目运行此向导，则还将选择 "使用开放式并发" 选项。</span><span class="sxs-lookup"><span data-stu-id="03944-236">In Web Site Projects, "Generate Insert, Update, and Delete statements" is the only advanced option selected by default; if you run this wizard from a Class Library or a Windows Project the "Use optimistic concurrency" option will also be selected.</span></span> <span data-ttu-id="03944-237">暂时取消选中 "使用开放式并发" 选项。</span><span class="sxs-lookup"><span data-stu-id="03944-237">Leave the "Use optimistic concurrency" option unchecked for now.</span></span> <span data-ttu-id="03944-238">我们将在将来的教程中检查乐观并发。</span><span class="sxs-lookup"><span data-stu-id="03944-238">We'll examine optimistic concurrency in future tutorials.</span></span>

<span data-ttu-id="03944-239">[![仅选择 "生成 Insert、Update 和 Delete 语句" 选项](creating-a-data-access-layer-cs/_static/image27.png)](creating-a-data-access-layer-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="03944-239">[![Select Only the Generate Insert, Update, and Delete statements Option](creating-a-data-access-layer-cs/_static/image27.png)](creating-a-data-access-layer-cs/_static/image26.png)</span></span>

<span data-ttu-id="03944-240">**图 10**：仅选择 "生成 Insert、Update 和 Delete 语句" 选项（[单击以查看完全大小的映像](creating-a-data-access-layer-cs/_static/image28.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-240">**Figure 10**: Select Only the Generate Insert, Update, and Delete statements Option ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image28.png))</span></span>

<span data-ttu-id="03944-241">验证高级选项后，请单击 "下一步" 以进入最终屏幕。</span><span class="sxs-lookup"><span data-stu-id="03944-241">After verifying the advanced options, click Next to proceed to the final screen.</span></span> <span data-ttu-id="03944-242">此时，系统会要求选择要添加到 TableAdapter 的方法。</span><span class="sxs-lookup"><span data-stu-id="03944-242">Here we are asked to select which methods to add to the TableAdapter.</span></span> <span data-ttu-id="03944-243">用于填充数据的模式有两种：</span><span class="sxs-lookup"><span data-stu-id="03944-243">There are two patterns for populating data:</span></span>

- <span data-ttu-id="03944-244">使用此方法**填充 datatable**会创建一个方法，该方法以 DataTable 作为参数，并根据查询的结果来填充它。</span><span class="sxs-lookup"><span data-stu-id="03944-244">**Fill a DataTable** with this approach a method is created that takes in a DataTable as a parameter and populates it based on the results of the query.</span></span> <span data-ttu-id="03944-245">例如，ADO.NET DataAdapter 类通过其**Fill （）** 方法实现此模式。</span><span class="sxs-lookup"><span data-stu-id="03944-245">The ADO.NET DataAdapter class, for example, implements this pattern with its **Fill()** method.</span></span>
- <span data-ttu-id="03944-246">使用此方法**返回 datatable** 。方法创建并填充 datatable，并将其作为方法返回值返回。</span><span class="sxs-lookup"><span data-stu-id="03944-246">**Return a DataTable** with this approach the method creates and fills the DataTable for you and returns it as the methods return value.</span></span>

<span data-ttu-id="03944-247">可以让 TableAdapter 实现其中一种或两种模式。</span><span class="sxs-lookup"><span data-stu-id="03944-247">You can have the TableAdapter implement one or both of these patterns.</span></span> <span data-ttu-id="03944-248">还可以重命名此处提供的方法。</span><span class="sxs-lookup"><span data-stu-id="03944-248">You can also rename the methods provided here.</span></span> <span data-ttu-id="03944-249">让我们将这两个复选框保持选中状态，尽管我们在这些教程中只使用后一种模式。</span><span class="sxs-lookup"><span data-stu-id="03944-249">Let's leave both checkboxes checked, even though we'll only be using the latter pattern throughout these tutorials.</span></span> <span data-ttu-id="03944-250">同样，让我们将**GetProducts** **的方法重**命名为。</span><span class="sxs-lookup"><span data-stu-id="03944-250">Also, let's rename the rather generic **GetData** method to **GetProducts**.</span></span>

<span data-ttu-id="03944-251">如果选中，最后一个复选框 "GenerateDBDirectMethods" 将为 TableAdapter 创建**Insert （）** 、 **Update （）** 和**Delete （）** 方法。</span><span class="sxs-lookup"><span data-stu-id="03944-251">If checked, the final checkbox, "GenerateDBDirectMethods," creates **Insert()**, **Update()**, and **Delete()** methods for the TableAdapter.</span></span> <span data-ttu-id="03944-252">如果将此选项保留为未选中状态，则需要通过 TableAdapter 的唯一**Update （）** 方法完成所有更新，该方法采用类型化数据集、DataTable、单个 DataRow 或 datarow 数组。</span><span class="sxs-lookup"><span data-stu-id="03944-252">If you leave this option unchecked, all updates will need to be done through the TableAdapter's sole **Update()** method, which takes in the Typed DataSet, a DataTable, a single DataRow, or an array of DataRows.</span></span> <span data-ttu-id="03944-253">（如果已从图9的高级属性中取消选中 "生成插入、更新和删除语句" 选项，则此复选框的设置不起作用。）让我们选中此复选框。</span><span class="sxs-lookup"><span data-stu-id="03944-253">(If you've unchecked the "Generate Insert, Update, and Delete statements" option from the advanced properties in Figure 9 this checkbox's setting will have no effect.) Let's leave this checkbox selected.</span></span>

<span data-ttu-id="03944-254">[![将方法名称从 "GetProducts" 更改为 ""](creating-a-data-access-layer-cs/_static/image30.png)](creating-a-data-access-layer-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="03944-254">[![Change the Method Name from GetData to GetProducts](creating-a-data-access-layer-cs/_static/image30.png)](creating-a-data-access-layer-cs/_static/image29.png)</span></span>

<span data-ttu-id="03944-255">**图 11**：将方法**名称从 "** GetProducts" 更改为["" （单击查看完全大小的图像](creating-a-data-access-layer-cs/_static/image31.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-255">**Figure 11**: Change the Method Name from **GetData** to **GetProducts** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image31.png))</span></span>

<span data-ttu-id="03944-256">单击 "完成" 完成向导。</span><span class="sxs-lookup"><span data-stu-id="03944-256">Complete the wizard by clicking Finish.</span></span> <span data-ttu-id="03944-257">向导关闭后，将返回到 "数据集设计器"，其中显示刚刚创建的 DataTable。</span><span class="sxs-lookup"><span data-stu-id="03944-257">After the wizard closes we are returned to the DataSet Designer which shows the DataTable we just created.</span></span> <span data-ttu-id="03944-258">您可以在**Products**数据表（**ProductID**、 **ProductName**等）中查看列的列表，以及**ProductsTableAdapter** （**Fill （）** 和**GetProducts （）** ）的方法。</span><span class="sxs-lookup"><span data-stu-id="03944-258">You can see the list of columns in the **Products** DataTable (**ProductID**, **ProductName**, and so on), as well as the methods of the **ProductsTableAdapter** (**Fill()** and **GetProducts()**).</span></span>

<span data-ttu-id="03944-259">[![Products DataTable 和 ProductsTableAdapter 已添加到类型化数据集](creating-a-data-access-layer-cs/_static/image33.png)](creating-a-data-access-layer-cs/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="03944-259">[![The Products DataTable and ProductsTableAdapter have been Added to the Typed DataSet](creating-a-data-access-layer-cs/_static/image33.png)](creating-a-data-access-layer-cs/_static/image32.png)</span></span>

<span data-ttu-id="03944-260">**图 12**：已将**Products** DataTable 和**ProductsTableAdapter**添加到类型化数据集（[单击以查看完全大小的图像](creating-a-data-access-layer-cs/_static/image34.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-260">**Figure 12**: The **Products** DataTable and **ProductsTableAdapter** have been Added to the Typed DataSet ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image34.png))</span></span>

<span data-ttu-id="03944-261">此时，我们有一个具有单个 DataTable （**Northwind**）的类型化数据集，以及一个具有**GetProducts （）** 方法的强类型 DataAdapter 类（**NorthwindTableAdapters. ProductsTableAdapter**）。</span><span class="sxs-lookup"><span data-stu-id="03944-261">At this point we have a Typed DataSet with a single DataTable (**Northwind.Products**) and a strongly-typed DataAdapter class (**NorthwindTableAdapters.ProductsTableAdapter**) with a **GetProducts()** method.</span></span> <span data-ttu-id="03944-262">这些对象可用于从代码访问所有产品的列表，例如：</span><span class="sxs-lookup"><span data-stu-id="03944-262">These objects can be used to access a list of all products from code like:</span></span>

[!code-html[Main](creating-a-data-access-layer-cs/samples/sample1.html)]

<span data-ttu-id="03944-263">此代码不要求我们编写一位特定于数据访问的代码。</span><span class="sxs-lookup"><span data-stu-id="03944-263">This code did not require us to write one bit of data access-specific code.</span></span> <span data-ttu-id="03944-264">我们不必实例化任何 ADO.NET 类，我们也不必引用任何连接字符串、SQL 查询或存储过程。</span><span class="sxs-lookup"><span data-stu-id="03944-264">We did not have to instantiate any ADO.NET classes, we didn't have to refer to any connection strings, SQL queries, or stored procedures.</span></span> <span data-ttu-id="03944-265">而 TableAdapter 为我们提供低级别的数据访问代码。</span><span class="sxs-lookup"><span data-stu-id="03944-265">Instead, the TableAdapter provides the low-level data access code for us.</span></span>

<span data-ttu-id="03944-266">在此示例中使用的每个对象都是强类型的，允许 Visual Studio 提供 IntelliSense 和编译时类型检查。</span><span class="sxs-lookup"><span data-stu-id="03944-266">Each object used in this example is also strongly-typed, allowing Visual Studio to provide IntelliSense and compile-time type checking.</span></span> <span data-ttu-id="03944-267">并且最重要的是，TableAdapter 返回的所有数据表都可以绑定到 ASP.NET 数据 Web 控件，如 GridView、DetailsView、DropDownList、CheckBoxList 等。</span><span class="sxs-lookup"><span data-stu-id="03944-267">And best of all the DataTables returned by the TableAdapter can be bound to ASP.NET data Web controls, such as the GridView, DetailsView, DropDownList, CheckBoxList, and several others.</span></span> <span data-ttu-id="03944-268">下面的示例演示如何将**GetProducts （）** 方法返回的 DataTable 绑定到仅在**页面\_Load**事件处理程序中的扫描三行代码中。</span><span class="sxs-lookup"><span data-stu-id="03944-268">The following example illustrates binding the DataTable returned by the **GetProducts()** method to a GridView in just a scant three lines of code within the **Page\_Load** event handler.</span></span>

<span data-ttu-id="03944-269">AllProducts.aspx</span><span class="sxs-lookup"><span data-stu-id="03944-269">AllProducts.aspx</span></span>

[!code-aspx[Main](creating-a-data-access-layer-cs/samples/sample2.aspx)]

<span data-ttu-id="03944-270">AllProducts.aspx.cs</span><span class="sxs-lookup"><span data-stu-id="03944-270">AllProducts.aspx.cs</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample3.cs)]

<span data-ttu-id="03944-271">[![产品列表显示在 GridView 中](creating-a-data-access-layer-cs/_static/image36.png)](creating-a-data-access-layer-cs/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="03944-271">[![The List of Products is Displayed in a GridView](creating-a-data-access-layer-cs/_static/image36.png)](creating-a-data-access-layer-cs/_static/image35.png)</span></span>

<span data-ttu-id="03944-272">**图 13**：产品列表显示在 GridView 中（[单击以查看完全大小的图像](creating-a-data-access-layer-cs/_static/image37.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-272">**Figure 13**: The List of Products is Displayed in a GridView ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image37.png))</span></span>

<span data-ttu-id="03944-273">尽管此示例需要我们在 ASP.NET 页面的页面中编写三行代码 **\_Load**事件处理程序中，但在将来的教程中，我们将检查如何使用 ObjectDataSource 以声明方式从 DAL 检索数据。</span><span class="sxs-lookup"><span data-stu-id="03944-273">While this example required that we write three lines of code in our ASP.NET page's **Page\_Load** event handler, in future tutorials we'll examine how to use the ObjectDataSource to declaratively retrieve the data from the DAL.</span></span> <span data-ttu-id="03944-274">使用 ObjectDataSource 时，我们不需要编写任何代码，也会获得分页和排序支持！</span><span class="sxs-lookup"><span data-stu-id="03944-274">With the ObjectDataSource we'll not have to write any code and will get paging and sorting support as well!</span></span>

## <a name="step-3-adding-parameterized-methods-to-the-data-access-layer"></a><span data-ttu-id="03944-275">步骤3：将参数化方法添加到数据访问层</span><span class="sxs-lookup"><span data-stu-id="03944-275">Step 3: Adding Parameterized Methods to the Data Access Layer</span></span>

<span data-ttu-id="03944-276">此时，我们的**ProductsTableAdapter**类具有一个**GetProducts （）** 方法，该方法返回数据库中的所有产品。</span><span class="sxs-lookup"><span data-stu-id="03944-276">At this point our **ProductsTableAdapter** class has but one method, **GetProducts()**, which returns all of the products in the database.</span></span> <span data-ttu-id="03944-277">虽然能够使用所有产品都非常有用，但有时我们需要检索有关特定产品或属于特定类别的所有产品的信息。</span><span class="sxs-lookup"><span data-stu-id="03944-277">While being able to work with all products is definitely useful, there are times when we'll want to retrieve information about a specific product, or all products that belong to a particular category.</span></span> <span data-ttu-id="03944-278">若要将此类功能添加到数据访问层，可以将参数化方法添加到 TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="03944-278">To add such functionality to our Data Access Layer we can add parameterized methods to the TableAdapter.</span></span>

<span data-ttu-id="03944-279">我们来添加**GetProductsByCategoryID （*类别 id*）** 方法。</span><span class="sxs-lookup"><span data-stu-id="03944-279">Let's add the **GetProductsByCategoryID(*categoryID*)** method.</span></span> <span data-ttu-id="03944-280">若要将新方法添加到 DAL，请返回到 "数据集设计器"，右键单击 " **ProductsTableAdapter** " 部分，然后选择 "添加查询"。</span><span class="sxs-lookup"><span data-stu-id="03944-280">To add a new method to the DAL, return to the DataSet Designer, right-click in the **ProductsTableAdapter** section, and choose Add Query.</span></span>

![右键单击 TableAdapter，然后选择 "添加查询"](creating-a-data-access-layer-cs/_static/image38.png)

<span data-ttu-id="03944-282">**图 14**：右键单击 TableAdapter，然后选择 "添加查询"</span><span class="sxs-lookup"><span data-stu-id="03944-282">**Figure 14**: Right-Click on the TableAdapter and Choose Add Query</span></span>

<span data-ttu-id="03944-283">我们首先会提示你是否要使用即席 SQL 语句或新的或现有的存储过程来访问数据库。</span><span class="sxs-lookup"><span data-stu-id="03944-283">We are first prompted about whether we want to access the database using an ad-hoc SQL statement or a new or existing stored procedure.</span></span> <span data-ttu-id="03944-284">让我们再次选择使用即席 SQL 语句。</span><span class="sxs-lookup"><span data-stu-id="03944-284">Let's choose to use an ad-hoc SQL statement again.</span></span> <span data-ttu-id="03944-285">接下来，我们会询问我们要使用哪种类型的 SQL 查询。</span><span class="sxs-lookup"><span data-stu-id="03944-285">Next, we are asked what type of SQL query we'd like to use.</span></span> <span data-ttu-id="03944-286">由于我们希望返回属于指定类别的所有产品，因此我们希望编写一个返回行的**SELECT**语句。</span><span class="sxs-lookup"><span data-stu-id="03944-286">Since we want to return all products that belong to a specified category, we want to write a **SELECT** statement which returns rows.</span></span>

<span data-ttu-id="03944-287">[![选择创建返回行的 SELECT 语句](creating-a-data-access-layer-cs/_static/image40.png)](creating-a-data-access-layer-cs/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="03944-287">[![Choose to Create a SELECT Statement Which Returns Rows](creating-a-data-access-layer-cs/_static/image40.png)](creating-a-data-access-layer-cs/_static/image39.png)</span></span>

<span data-ttu-id="03944-288">**图 15**：选择创建返回行的**SELECT**语句（[单击以查看完全大小的图像](creating-a-data-access-layer-cs/_static/image41.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-288">**Figure 15**: Choose to Create a **SELECT** Statement Which Returns Rows ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image41.png))</span></span>

<span data-ttu-id="03944-289">下一步是定义用于访问数据的 SQL 查询。</span><span class="sxs-lookup"><span data-stu-id="03944-289">The next step is to define the SQL query used to access the data.</span></span> <span data-ttu-id="03944-290">由于我们只想返回属于特定类别的产品，因此我使用<strong>GetProducts （）</strong>中的相同<strong>SELECT</strong>语句，但添加以下<strong>WHERE</strong>子句：<strong>其中，类别 id = @CategoryID</strong>。</span><span class="sxs-lookup"><span data-stu-id="03944-290">Since we want to return only those products that belong to a particular category, I use the same <strong>SELECT</strong> statement from <strong>GetProducts()</strong>, but add the following <strong>WHERE</strong> clause: <strong>WHERE CategoryID = @CategoryID</strong>.</span></span> <span data-ttu-id="03944-291"><strong>@CategoryID</strong>参数向 TableAdapter 向导指示我们正在创建的方法将需要相应类型的输入参数（即，可以为 null 的整数）。</span><span class="sxs-lookup"><span data-stu-id="03944-291">The <strong>@CategoryID</strong> parameter indicates to the TableAdapter wizard that the method we're creating will require an input parameter of the corresponding type (namely, a nullable integer).</span></span>

<span data-ttu-id="03944-292">[![输入查询以仅返回指定类别中的产品](creating-a-data-access-layer-cs/_static/image43.png)](creating-a-data-access-layer-cs/_static/image42.png)</span><span class="sxs-lookup"><span data-stu-id="03944-292">[![Enter a Query to Only Return Products in a Specified Category](creating-a-data-access-layer-cs/_static/image43.png)](creating-a-data-access-layer-cs/_static/image42.png)</span></span>

<span data-ttu-id="03944-293">**图 16**：输入仅返回指定类别中的产品的查询（[单击以查看完全大小的图像](creating-a-data-access-layer-cs/_static/image44.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-293">**Figure 16**: Enter a Query to Only Return Products in a Specified Category ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image44.png))</span></span>

<span data-ttu-id="03944-294">在最后一步中，我们可以选择要使用的数据访问模式，还可以自定义生成的方法的名称。</span><span class="sxs-lookup"><span data-stu-id="03944-294">In the final step we can choose which data access patterns to use, as well as customize the names of the methods generated.</span></span> <span data-ttu-id="03944-295">对于填充模式，让我们将名称更改为<strong>FillByCategoryID</strong> ，并为返回 DataTable 返回模式（ <strong>Get*X</strong>* 方法），让我们使用<strong>GetProductsByCategoryID</strong>。</span><span class="sxs-lookup"><span data-stu-id="03944-295">For the Fill pattern, let's change the name to <strong>FillByCategoryID</strong> and for the return a DataTable return pattern (the <strong>Get*X</strong>* methods), let's use <strong>GetProductsByCategoryID</strong>.</span></span>

<span data-ttu-id="03944-296">[![选择 TableAdapter 方法的名称](creating-a-data-access-layer-cs/_static/image46.png)](creating-a-data-access-layer-cs/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="03944-296">[![Choose the Names for the TableAdapter Methods](creating-a-data-access-layer-cs/_static/image46.png)](creating-a-data-access-layer-cs/_static/image45.png)</span></span>

<span data-ttu-id="03944-297">**图 17**：选择 TableAdapter 方法的名称（[单击以查看完全大小的映像](creating-a-data-access-layer-cs/_static/image47.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-297">**Figure 17**: Choose the Names for the TableAdapter Methods ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image47.png))</span></span>

<span data-ttu-id="03944-298">完成向导后，数据集设计器会包括新的 TableAdapter 方法。</span><span class="sxs-lookup"><span data-stu-id="03944-298">After completing the wizard, the DataSet Designer includes the new TableAdapter methods.</span></span>

![现在可以按类别查询产品](creating-a-data-access-layer-cs/_static/image48.png)

<span data-ttu-id="03944-300">**图 18**：现在可以按类别查询产品</span><span class="sxs-lookup"><span data-stu-id="03944-300">**Figure 18**: The Products Can Now be Queried by Category</span></span>

<span data-ttu-id="03944-301">请花点时间使用相同的方法添加**GetProductByProductID （*productID*）** 方法。</span><span class="sxs-lookup"><span data-stu-id="03944-301">Take a moment to add a **GetProductByProductID(*productID*)** method using the same technique.</span></span>

<span data-ttu-id="03944-302">这些参数化查询可以直接从数据集设计器进行测试。</span><span class="sxs-lookup"><span data-stu-id="03944-302">These parameterized queries can be tested directly from the DataSet Designer.</span></span> <span data-ttu-id="03944-303">右键单击 TableAdapter 中的方法，然后选择 "预览数据"。</span><span class="sxs-lookup"><span data-stu-id="03944-303">Right-click on the method in the TableAdapter and choose Preview Data.</span></span> <span data-ttu-id="03944-304">接下来，输入要用于参数的值，然后单击 "预览"。</span><span class="sxs-lookup"><span data-stu-id="03944-304">Next, enter the values to use for the parameters and click Preview.</span></span>

<span data-ttu-id="03944-305">[![显示属于饮料类别的产品](creating-a-data-access-layer-cs/_static/image50.png)](creating-a-data-access-layer-cs/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="03944-305">[![Those Products Belonging to the Beverages Category are Shown](creating-a-data-access-layer-cs/_static/image50.png)](creating-a-data-access-layer-cs/_static/image49.png)</span></span>

<span data-ttu-id="03944-306">**图 19**：显示属于 "饮料" 类别的产品（[单击以查看完全尺寸的图像](creating-a-data-access-layer-cs/_static/image51.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-306">**Figure 19**: Those Products Belonging to the Beverages Category are Shown ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image51.png))</span></span>

<span data-ttu-id="03944-307">对于 DAL 中的**GetProductsByCategoryID （*类别 id*）** 方法，我们现在可以创建只显示指定类别中的产品的 ASP.NET 页面。</span><span class="sxs-lookup"><span data-stu-id="03944-307">With the **GetProductsByCategoryID(*categoryID*)** method in our DAL, we can now create an ASP.NET page that displays only those products in a specified category.</span></span> <span data-ttu-id="03944-308">下面的示例显示 "饮料" 类别中的所有产品，其类别**id**为 "1"。</span><span class="sxs-lookup"><span data-stu-id="03944-308">The following example shows all products that are in the Beverages category, which have a **CategoryID** of 1.</span></span>

<span data-ttu-id="03944-309">Beverages.asp</span><span class="sxs-lookup"><span data-stu-id="03944-309">Beverages.asp</span></span>

[!code-aspx[Main](creating-a-data-access-layer-cs/samples/sample4.aspx)]

<span data-ttu-id="03944-310">Beverages.aspx.cs</span><span class="sxs-lookup"><span data-stu-id="03944-310">Beverages.aspx.cs</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample5.cs)]

<span data-ttu-id="03944-311">[![显示 "饮料" 类别中的产品](creating-a-data-access-layer-cs/_static/image53.png)](creating-a-data-access-layer-cs/_static/image52.png)</span><span class="sxs-lookup"><span data-stu-id="03944-311">[![Those Products in the Beverages Category are Displayed](creating-a-data-access-layer-cs/_static/image53.png)](creating-a-data-access-layer-cs/_static/image52.png)</span></span>

<span data-ttu-id="03944-312">**图 20**：显示 "饮料" 类别中的产品（[单击以查看完全尺寸的图像](creating-a-data-access-layer-cs/_static/image54.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-312">**Figure 20**: Those Products in the Beverages Category are Displayed ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image54.png))</span></span>

## <a name="step-4-inserting-updating-and-deleting-data"></a><span data-ttu-id="03944-313">步骤4：插入、更新和删除数据</span><span class="sxs-lookup"><span data-stu-id="03944-313">Step 4: Inserting, Updating, and Deleting Data</span></span>

<span data-ttu-id="03944-314">通常有两种模式可用于插入、更新和删除数据。</span><span class="sxs-lookup"><span data-stu-id="03944-314">There are two patterns commonly used for inserting, updating, and deleting data.</span></span> <span data-ttu-id="03944-315">第一种模式是，我将调用数据库直接模式，这涉及到创建在调用时向处理单个数据库记录的数据库发出**INSERT**、 **UPDATE**或**DELETE**命令的方法。</span><span class="sxs-lookup"><span data-stu-id="03944-315">The first pattern, which I'll call the database direct pattern, involves creating methods that, when invoked, issue an **INSERT**, **UPDATE**, or **DELETE** command to the database that operates on a single database record.</span></span> <span data-ttu-id="03944-316">此类方法通常以与要插入、更新或删除的值对应的一系列标量值（整数、字符串、布尔值、Datetime 等）进行传递。</span><span class="sxs-lookup"><span data-stu-id="03944-316">Such methods are typically passed in a series of scalar values (integers, strings, Booleans, DateTimes, and so on) that correspond to the values to insert, update, or delete.</span></span> <span data-ttu-id="03944-317">例如，对于**Products**表，delete 方法将采用一个整数参数，指示要删除的记录的**ProductID** ，而 Insert 方法将接受**ProductName**的字符串，为**单价**使用一个小数，为**UnitsOnStock**提供一个整数，依此类推。</span><span class="sxs-lookup"><span data-stu-id="03944-317">For example, with this pattern for the **Products** table the delete method would take in an integer parameter, indicating the **ProductID** of the record to delete, while the insert method would take in a string for the **ProductName**, a decimal for the **UnitPrice**, an integer for the **UnitsOnStock**, and so on.</span></span>

<span data-ttu-id="03944-318">[![会立即向数据库发送每个 Insert、Update 和 Delete 请求](creating-a-data-access-layer-cs/_static/image56.png)](creating-a-data-access-layer-cs/_static/image55.png)</span><span class="sxs-lookup"><span data-stu-id="03944-318">[![Each Insert, Update, and Delete Request is Sent to the Database Immediately](creating-a-data-access-layer-cs/_static/image56.png)](creating-a-data-access-layer-cs/_static/image55.png)</span></span>

<span data-ttu-id="03944-319">**图 21**：每个插入、更新和删除请求都将立即发送到数据库（[单击查看完全大小的映像](creating-a-data-access-layer-cs/_static/image57.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-319">**Figure 21**: Each Insert, Update, and Delete Request is Sent to the Database Immediately ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image57.png))</span></span>

<span data-ttu-id="03944-320">另一种模式是将作为批处理更新模式，它是在一个方法调用中更新整个数据集、DataTable 或 Datarow 集合。</span><span class="sxs-lookup"><span data-stu-id="03944-320">The other pattern, which I'll refer to as the batch update pattern, is to update an entire DataSet, DataTable, or collection of DataRows in one method call.</span></span> <span data-ttu-id="03944-321">使用此模式，开发人员可以删除、插入和修改 DataTable 中的 Datarow，然后将这些 Datarow 或 DataTable 传递到 update 方法。</span><span class="sxs-lookup"><span data-stu-id="03944-321">With this pattern a developer deletes, inserts, and modifies the DataRows in a DataTable and then passes those DataRows or DataTable into an update method.</span></span> <span data-ttu-id="03944-322">然后，此方法枚举传入的 Datarow，确定是否已修改、添加或删除它们（通过 DataRow 的[RowState 属性](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx)值），并为每个记录发出适当的数据库请求。</span><span class="sxs-lookup"><span data-stu-id="03944-322">This method then enumerates the DataRows passed in, determines whether or not they've been modified, added, or deleted (via the DataRow's [RowState property](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx) value), and issues the appropriate database request for each record.</span></span>

<span data-ttu-id="03944-323">[在调用 Update 方法时，![所有更改均与数据库同步](creating-a-data-access-layer-cs/_static/image59.png)](creating-a-data-access-layer-cs/_static/image58.png)</span><span class="sxs-lookup"><span data-stu-id="03944-323">[![All Changes are Synchronized with the Database When the Update Method is Invoked](creating-a-data-access-layer-cs/_static/image59.png)](creating-a-data-access-layer-cs/_static/image58.png)</span></span>

<span data-ttu-id="03944-324">**图 22**：调用 Update 方法时，所有更改都将与数据库同步（[单击查看完全大小的映像](creating-a-data-access-layer-cs/_static/image60.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-324">**Figure 22**: All Changes are Synchronized with the Database When the Update Method is Invoked ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image60.png))</span></span>

<span data-ttu-id="03944-325">默认情况下，TableAdapter 使用批处理更新模式，但也支持 DB 直接模式。</span><span class="sxs-lookup"><span data-stu-id="03944-325">The TableAdapter uses the batch update pattern by default, but also supports the DB direct pattern.</span></span> <span data-ttu-id="03944-326">由于在创建 TableAdapter 时，我们从高级属性中选择了 "生成插入、更新和删除语句" 选项，因此**ProductsTableAdapter**包含用于实现批处理更新模式的**Update （）** 方法。</span><span class="sxs-lookup"><span data-stu-id="03944-326">Since we selected the "Generate Insert, Update, and Delete statements" option from the Advanced Properties when creating our TableAdapter, the **ProductsTableAdapter** contains an **Update()** method, which implements the batch update pattern.</span></span> <span data-ttu-id="03944-327">具体而言，TableAdapter 包含**Update （）** 方法，该方法可以传递类型化的数据集、强类型的 DataTable 或一个或多个 datarow。</span><span class="sxs-lookup"><span data-stu-id="03944-327">Specifically, the TableAdapter contains an **Update()** method that can be passed the Typed DataSet, a strongly-typed DataTable, or one or more DataRows.</span></span> <span data-ttu-id="03944-328">如果在首次创建 TableAdapter 时选中了 "GenerateDBDirectMethods" 复选框，则 DB 直接模式也将通过**Insert （）** 、 **Update （）** 和**Delete （）** 方法实现。</span><span class="sxs-lookup"><span data-stu-id="03944-328">If you left the "GenerateDBDirectMethods" checkbox checked when first creating the TableAdapter the DB direct pattern will also be implemented via **Insert()**, **Update()**, and **Delete()** methods.</span></span>

<span data-ttu-id="03944-329">这两种数据修改模式都使用 TableAdapter 的**InsertCommand**、 **UpdateCommand**和**DeleteCommand**属性向数据库发出**INSERT**、 **UPDATE**和**DELETE**命令。</span><span class="sxs-lookup"><span data-stu-id="03944-329">Both data modification patterns use the TableAdapter's **InsertCommand**, **UpdateCommand**, and **DeleteCommand** properties to issue their **INSERT**, **UPDATE**, and **DELETE** commands to the database.</span></span> <span data-ttu-id="03944-330">可以通过在数据集设计器中单击 TableAdapter，然后转到属性窗口来检查和修改**InsertCommand**、 **UpdateCommand**和**DeleteCommand**属性。</span><span class="sxs-lookup"><span data-stu-id="03944-330">You can inspect and modify the **InsertCommand**, **UpdateCommand**, and **DeleteCommand** properties by clicking on the TableAdapter in the DataSet Designer and then going to the Properties window.</span></span> <span data-ttu-id="03944-331">（请确保已选择 TableAdapter，并且**ProductsTableAdapter**对象是在属性窗口的下拉列表中选择的对象。）</span><span class="sxs-lookup"><span data-stu-id="03944-331">(Make sure you have selected the TableAdapter, and that the **ProductsTableAdapter** object is the one selected in the drop-down list in the Properties window.)</span></span>

<span data-ttu-id="03944-332">[![TableAdapter 具有 InsertCommand、UpdateCommand 和 DeleteCommand 属性](creating-a-data-access-layer-cs/_static/image62.png)](creating-a-data-access-layer-cs/_static/image61.png)</span><span class="sxs-lookup"><span data-stu-id="03944-332">[![The TableAdapter has InsertCommand, UpdateCommand, and DeleteCommand Properties](creating-a-data-access-layer-cs/_static/image62.png)](creating-a-data-access-layer-cs/_static/image61.png)</span></span>

<span data-ttu-id="03944-333">**图 23**： TableAdapter 具有**InsertCommand**、 **UpdateCommand**和**DeleteCommand**属性（[单击以查看完全大小的图像](creating-a-data-access-layer-cs/_static/image63.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-333">**Figure 23**: The TableAdapter has **InsertCommand**, **UpdateCommand**, and **DeleteCommand** Properties ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image63.png))</span></span>

<span data-ttu-id="03944-334">若要检查或修改这些数据库命令属性中的任何一个，请单击 " **CommandText** " 子属性，此时将显示查询生成器。</span><span class="sxs-lookup"><span data-stu-id="03944-334">To examine or modify any of these database command properties, click on the **CommandText** subproperty, which will bring up the Query Builder.</span></span>

<span data-ttu-id="03944-335">[![在查询生成器中配置 INSERT、UPDATE 和 DELETE 语句](creating-a-data-access-layer-cs/_static/image65.png)](creating-a-data-access-layer-cs/_static/image64.png)</span><span class="sxs-lookup"><span data-stu-id="03944-335">[![Configure the INSERT, UPDATE, and DELETE Statements in the Query Builder](creating-a-data-access-layer-cs/_static/image65.png)](creating-a-data-access-layer-cs/_static/image64.png)</span></span>

<span data-ttu-id="03944-336">**图 24**：在查询生成器中配置**INSERT**、 **UPDATE**和**DELETE**语句（[单击以查看完全大小的图像](creating-a-data-access-layer-cs/_static/image66.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-336">**Figure 24**: Configure the **INSERT**, **UPDATE**, and **DELETE** Statements in the Query Builder ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image66.png))</span></span>

<span data-ttu-id="03944-337">下面的代码示例演示如何使用批处理更新模式将所有未停用的产品的价格翻倍，并使其具有25个单位或更低的价格：</span><span class="sxs-lookup"><span data-stu-id="03944-337">The following code example shows how to use the batch update pattern to double the price of all products that are not discontinued and that have 25 units in stock or less:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample6.cs)]

<span data-ttu-id="03944-338">下面的代码演示了如何使用 DB 直接模式以编程方式删除特定产品，然后更新一个产品，然后添加一个新产品：</span><span class="sxs-lookup"><span data-stu-id="03944-338">The code below illustrates how to use the DB direct pattern to programmatically delete a particular product, then update one, and then add a new one:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample7.cs)]

## <a name="creating-custom-insert-update-and-delete-methods"></a><span data-ttu-id="03944-339">创建自定义插入、更新和删除方法</span><span class="sxs-lookup"><span data-stu-id="03944-339">Creating Custom Insert, Update, and Delete Methods</span></span>

<span data-ttu-id="03944-340">DB 直接方法创建的**Insert （）** 、 **Update （）** 和**Delete （）** 方法可能有点麻烦，特别是对于包含多个列的表。</span><span class="sxs-lookup"><span data-stu-id="03944-340">The **Insert()**, **Update()**, and **Delete()** methods created by the DB direct method can be a bit cumbersome, especially for tables with many columns.</span></span> <span data-ttu-id="03944-341">查看上面的代码示例，如果不包含 IntelliSense 的帮助，就不会特别清楚哪些**Products**表列将映射到**Update （）** 和**Insert （）** 方法的每个输入参数。</span><span class="sxs-lookup"><span data-stu-id="03944-341">Looking at the previous code example, without IntelliSense's help it's not particularly clear what **Products** table column maps to each input parameter to the **Update()** and **Insert()** methods.</span></span> <span data-ttu-id="03944-342">有时，我们可能只想要更新单个列或两个列，或者需要一个自定义的**Insert （）** 方法，该方法可能会返回新插入记录的**标识**（自动递增）字段的值。</span><span class="sxs-lookup"><span data-stu-id="03944-342">There may be times when we only want to update a single column or two, or want a customized **Insert()** method that will, perhaps, return the value of the newly inserted record's **IDENTITY** (auto-increment) field.</span></span>

<span data-ttu-id="03944-343">若要创建此类自定义方法，请返回到数据集设计器。</span><span class="sxs-lookup"><span data-stu-id="03944-343">To create such a custom method, return to the DataSet Designer.</span></span> <span data-ttu-id="03944-344">右键单击 TableAdapter，然后选择 "添加查询"，返回到 "TableAdapter 向导"。</span><span class="sxs-lookup"><span data-stu-id="03944-344">Right-click on the TableAdapter and choose Add Query, returning to the TableAdapter wizard.</span></span> <span data-ttu-id="03944-345">在第二个屏幕上，可以指示要创建的查询类型。</span><span class="sxs-lookup"><span data-stu-id="03944-345">On the second screen we can indicate the type of query to create.</span></span> <span data-ttu-id="03944-346">让我们创建一个方法，该方法添加一个新产品，然后返回新添加的记录的**ProductID**的值。</span><span class="sxs-lookup"><span data-stu-id="03944-346">Let's create a method that adds a new product and then returns the value of the newly added record's **ProductID**.</span></span> <span data-ttu-id="03944-347">因此，选择创建**插入**查询。</span><span class="sxs-lookup"><span data-stu-id="03944-347">Therefore, opt to create an **INSERT** query.</span></span>

<span data-ttu-id="03944-348">[![创建方法以便向 Products 表中添加新行](creating-a-data-access-layer-cs/_static/image68.png)](creating-a-data-access-layer-cs/_static/image67.png)</span><span class="sxs-lookup"><span data-stu-id="03944-348">[![Create a Method to Add a New Row to the Products Table](creating-a-data-access-layer-cs/_static/image68.png)](creating-a-data-access-layer-cs/_static/image67.png)</span></span>

<span data-ttu-id="03944-349">**图 25**：创建方法以便向**Products**表中添加新行（[单击以查看完全大小的图像](creating-a-data-access-layer-cs/_static/image69.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-349">**Figure 25**: Create a Method to Add a New Row to the **Products** Table ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image69.png))</span></span>

<span data-ttu-id="03944-350">在下一个屏幕上，将显示**InsertCommand**的**CommandText** 。</span><span class="sxs-lookup"><span data-stu-id="03944-350">On the next screen the **InsertCommand**'s **CommandText** appears.</span></span> <span data-ttu-id="03944-351">通过在查询的末尾添加**SELECT SCOPE\_IDENTITY （）** 来增加此查询，这将返回插入到同一范围内的**identity**列中的最后一个标识值。</span><span class="sxs-lookup"><span data-stu-id="03944-351">Augment this query by adding **SELECT SCOPE\_IDENTITY()** at the end of the query, which will return the last identity value inserted into an **IDENTITY** column in the same scope.</span></span> <span data-ttu-id="03944-352">（有关详细信息，请参阅[技术文档](https://msdn.microsoft.com/library/ms190315.aspx) **\_标识（）** ，以及为何要[使用范围\_identity （）代替 @@IDENTITY](http://weblogs.sqlteam.com/travisl/archive/2003/10/29/405.aspx)。）请确保在添加**SELECT**语句前用分号结束**INSERT**语句。</span><span class="sxs-lookup"><span data-stu-id="03944-352">(See the [technical documentation](https://msdn.microsoft.com/library/ms190315.aspx) for more information about **SCOPE\_IDENTITY()** and why you probably want to [use SCOPE\_IDENTITY() in lieu of @@IDENTITY](http://weblogs.sqlteam.com/travisl/archive/2003/10/29/405.aspx).) Make sure that you end the **INSERT** statement with a semi-colon before adding the **SELECT** statement.</span></span>

<span data-ttu-id="03944-353">[![增加查询以返回 SCOPE_IDENTITY （）值](creating-a-data-access-layer-cs/_static/image71.png)](creating-a-data-access-layer-cs/_static/image70.png)</span><span class="sxs-lookup"><span data-stu-id="03944-353">[![Augment the Query to Return the SCOPE_IDENTITY() Value](creating-a-data-access-layer-cs/_static/image71.png)](creating-a-data-access-layer-cs/_static/image70.png)</span></span>

<span data-ttu-id="03944-354">**图 26**：增加查询以返回**范围\_IDENTITY （）** 值（[单击查看完全大小的映像](creating-a-data-access-layer-cs/_static/image72.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-354">**Figure 26**: Augment the Query to Return the **SCOPE\_IDENTITY()** Value ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image72.png))</span></span>

<span data-ttu-id="03944-355">最后，将新方法命名为**InsertProduct**。</span><span class="sxs-lookup"><span data-stu-id="03944-355">Finally, name the new method **InsertProduct**.</span></span>

<span data-ttu-id="03944-356">[![将新方法名称设置为 InsertProduct](creating-a-data-access-layer-cs/_static/image74.png)](creating-a-data-access-layer-cs/_static/image73.png)</span><span class="sxs-lookup"><span data-stu-id="03944-356">[![Set the New Method Name to InsertProduct](creating-a-data-access-layer-cs/_static/image74.png)](creating-a-data-access-layer-cs/_static/image73.png)</span></span>

<span data-ttu-id="03944-357">**图 27**：将新方法名称设置为**InsertProduct** （[单击查看完全大小的图像](creating-a-data-access-layer-cs/_static/image75.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-357">**Figure 27**: Set the New Method Name to **InsertProduct** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image75.png))</span></span>

<span data-ttu-id="03944-358">当你返回到数据集设计器时，你将看到**ProductsTableAdapter**包含一个新的方法**InsertProduct**。</span><span class="sxs-lookup"><span data-stu-id="03944-358">When you return to the DataSet Designer you'll see that the **ProductsTableAdapter** contains a new method, **InsertProduct**.</span></span> <span data-ttu-id="03944-359">如果此新方法不具有**Products**表中每个列的参数，则可能是忘记使用分号终止**INSERT**语句。</span><span class="sxs-lookup"><span data-stu-id="03944-359">If this new method doesn't have a parameter for each column in the **Products** table, chances are you forgot to terminate the **INSERT** statement with a semi-colon.</span></span> <span data-ttu-id="03944-360">配置**InsertProduct**方法，并确保用分号分隔**INSERT**和**SELECT**语句。</span><span class="sxs-lookup"><span data-stu-id="03944-360">Configure the **InsertProduct** method and ensure you have a semi-colon delimiting the **INSERT** and **SELECT** statements.</span></span>

<span data-ttu-id="03944-361">默认情况下，插入方法发出非查询方法，这意味着它们会返回受影响的行数。</span><span class="sxs-lookup"><span data-stu-id="03944-361">By default, insert methods issue non-query methods, meaning that they return the number of affected rows.</span></span> <span data-ttu-id="03944-362">但是，我们希望**InsertProduct**方法返回查询返回的值，而不是受影响的行数。</span><span class="sxs-lookup"><span data-stu-id="03944-362">However, we want the **InsertProduct** method to return the value returned by the query, not the number of rows affected.</span></span> <span data-ttu-id="03944-363">若要实现此目的，请将**InsertProduct**方法的**ExecuteMode**属性调整为**标量**。</span><span class="sxs-lookup"><span data-stu-id="03944-363">To accomplish this, adjust the **InsertProduct** method's **ExecuteMode** property to **Scalar**.</span></span>

<span data-ttu-id="03944-364">[![将 ExecuteMode 属性更改为标量](creating-a-data-access-layer-cs/_static/image77.png)](creating-a-data-access-layer-cs/_static/image76.png)</span><span class="sxs-lookup"><span data-stu-id="03944-364">[![Change the ExecuteMode Property to Scalar](creating-a-data-access-layer-cs/_static/image77.png)](creating-a-data-access-layer-cs/_static/image76.png)</span></span>

<span data-ttu-id="03944-365">**图 28**：将**ExecuteMode**属性更改为**标量**（[单击以查看完全大小的图像](creating-a-data-access-layer-cs/_static/image78.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-365">**Figure 28**: Change the **ExecuteMode** Property to **Scalar** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image78.png))</span></span>

<span data-ttu-id="03944-366">下面的代码演示了此新的**InsertProduct**方法：</span><span class="sxs-lookup"><span data-stu-id="03944-366">The following code shows this new **InsertProduct** method in action:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample8.cs)]

## <a name="step-5-completing-the-data-access-layer"></a><span data-ttu-id="03944-367">步骤5：完成数据访问层</span><span class="sxs-lookup"><span data-stu-id="03944-367">Step 5: Completing the Data Access Layer</span></span>

<span data-ttu-id="03944-368">请注意， **ProductsTableAdapters**类从**Products**表中返回 "类别名称"**和 "** **供应商**" 值，但不包括 "类别" 表中的 "**类别** **名称**" 列或 "**供应商**" 表中的 "**公司名称**" 列，尽管这可能是我们在显示产品信息时要显示的列。</span><span class="sxs-lookup"><span data-stu-id="03944-368">Note that the **ProductsTableAdapters** class returns the **CategoryID** and **SupplierID** values from the **Products** table, but doesn't include the **CategoryName** column from the **Categories** table or the **CompanyName** column from the **Suppliers** table, although these are likely the columns we want to display when showing product information.</span></span> <span data-ttu-id="03944-369">我们可以扩充 TableAdapter 的初始方法**GetProducts （）** ，以同时包含 "**类别名称**" 和 "**公司名称**" 列值，这将更新强类型的 DataTable 以包含这些新列。</span><span class="sxs-lookup"><span data-stu-id="03944-369">We can augment the TableAdapter's initial method, **GetProducts()**, to include both the **CategoryName** and **CompanyName** column values, which will update the strongly-typed DataTable to include these new columns as well.</span></span>

<span data-ttu-id="03944-370">但这可能会出现问题，因为用于插入、更新和删除数据的 TableAdapter 方法基于此初始方法。</span><span class="sxs-lookup"><span data-stu-id="03944-370">This can present a problem, however, as the TableAdapter's methods for inserting, updating, and deleting data are based off of this initial method.</span></span> <span data-ttu-id="03944-371">幸运的是，用于插入、更新和删除的自动生成的方法不受**SELECT**子句中的子查询的影响。</span><span class="sxs-lookup"><span data-stu-id="03944-371">Fortunately, the auto-generated methods for inserting, updating, and deleting are not affected by subqueries in the **SELECT** clause.</span></span> <span data-ttu-id="03944-372">通过小心将查询添加到**类别**和**供应商**（而不是**联接**），我们将避免不得不改编这些方法来修改数据。</span><span class="sxs-lookup"><span data-stu-id="03944-372">By taking care to add our queries to **Categories** and **Suppliers** as subqueries, rather than **JOIN** s, we'll avoid having to rework those methods for modifying data.</span></span> <span data-ttu-id="03944-373">右键单击**ProductsTableAdapter**中的**GetProducts （）** 方法，然后选择 "配置"。</span><span class="sxs-lookup"><span data-stu-id="03944-373">Right-click on the **GetProducts()** method in the **ProductsTableAdapter** and choose Configure.</span></span> <span data-ttu-id="03944-374">然后，调整**SELECT**子句，使其类似于：</span><span class="sxs-lookup"><span data-stu-id="03944-374">Then, adjust the **SELECT** clause so that it looks like:</span></span>

[!code-sql[Main](creating-a-data-access-layer-cs/samples/sample9.sql)]

<span data-ttu-id="03944-375">[![为 GetProducts （）方法更新 SELECT 语句](creating-a-data-access-layer-cs/_static/image80.png)](creating-a-data-access-layer-cs/_static/image79.png)</span><span class="sxs-lookup"><span data-stu-id="03944-375">[![Update the SELECT Statement for the GetProducts() Method](creating-a-data-access-layer-cs/_static/image80.png)](creating-a-data-access-layer-cs/_static/image79.png)</span></span>

<span data-ttu-id="03944-376">**图 29**：更新**GetProducts （）** 方法的**SELECT**语句（[单击以查看完全大小的图像](creating-a-data-access-layer-cs/_static/image81.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-376">**Figure 29**: Update the **SELECT** Statement for the **GetProducts()** Method ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image81.png))</span></span>

<span data-ttu-id="03944-377">更新**GetProducts （）** 方法以使用此新查询后，DataTable 将包括两个新列：**类别名称**和**供应商**。</span><span class="sxs-lookup"><span data-stu-id="03944-377">After updating the **GetProducts()** method to use this new query the DataTable will include two new columns: **CategoryName** and **SupplierName**.</span></span>

![Products DataTable 有两个新列](creating-a-data-access-layer-cs/_static/image82.png)

<span data-ttu-id="03944-379">**图 30**： **Products** DataTable 有两个新列</span><span class="sxs-lookup"><span data-stu-id="03944-379">**Figure 30**: The **Products** DataTable has Two New Columns</span></span>

<span data-ttu-id="03944-380">请花点时间更新**GetProductsByCategoryID （*类别 id*）** 方法中的**SELECT**子句。</span><span class="sxs-lookup"><span data-stu-id="03944-380">Take a moment to update the **SELECT** clause in the **GetProductsByCategoryID(*categoryID*)** method as well.</span></span>

<span data-ttu-id="03944-381">如果使用**联接**语法更新**GetProducts （）** **选择**，则数据集设计器将无法自动生成用于使用 DB 直接模式插入、更新和删除数据库数据的方法。</span><span class="sxs-lookup"><span data-stu-id="03944-381">If you update the **GetProducts()** **SELECT** using **JOIN** syntax the DataSet Designer won't be able to auto-generate the methods for inserting, updating, and deleting database data using the DB direct pattern.</span></span> <span data-ttu-id="03944-382">相反，您必须手动创建它们，这与本教程前面的**InsertProduct**方法相同。</span><span class="sxs-lookup"><span data-stu-id="03944-382">Instead, you'll have to manually create them much like we did with the **InsertProduct** method earlier in this tutorial.</span></span> <span data-ttu-id="03944-383">而且，如果要使用批更新模式，则必须手动提供**InsertCommand**、 **UpdateCommand**和**DeleteCommand**属性值。</span><span class="sxs-lookup"><span data-stu-id="03944-383">Furthermore, you'll manually have to provide the **InsertCommand**, **UpdateCommand**, and **DeleteCommand** property values if you want to use the batch updating pattern.</span></span>

## <a name="adding-the-remaining-tableadapters"></a><span data-ttu-id="03944-384">添加剩余的 Tableadapter</span><span class="sxs-lookup"><span data-stu-id="03944-384">Adding the Remaining TableAdapters</span></span>

<span data-ttu-id="03944-385">到现在为止，我们只介绍了如何使用单个数据库表的一个 TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="03944-385">Up until now, we've only looked at working with a single TableAdapter for a single database table.</span></span> <span data-ttu-id="03944-386">但 Northwind 数据库包含多个相关表，我们需要在 web 应用程序中使用它们。</span><span class="sxs-lookup"><span data-stu-id="03944-386">However, the Northwind database contains several related tables that we'll need to work with in our web application.</span></span> <span data-ttu-id="03944-387">类型化数据集可以包含多个相关数据表。</span><span class="sxs-lookup"><span data-stu-id="03944-387">A Typed DataSet can contain multiple, related DataTables.</span></span> <span data-ttu-id="03944-388">因此，若要完成 DAL，需要为在这些教程中使用的其他表添加数据表。</span><span class="sxs-lookup"><span data-stu-id="03944-388">Therefore, to complete our DAL we need to add DataTables for the other tables we'll be using in these tutorials.</span></span> <span data-ttu-id="03944-389">若要将新的 TableAdapter 添加到类型化数据集，请打开数据集设计器，在设计器中右键单击，然后选择 "添加/TableAdapter"。</span><span class="sxs-lookup"><span data-stu-id="03944-389">To add a new TableAdapter to a Typed DataSet, open the DataSet Designer, right-click in the Designer, and choose Add / TableAdapter.</span></span> <span data-ttu-id="03944-390">这将创建一个新的 DataTable 和 TableAdapter，并引导你完成本教程前面所述的向导。</span><span class="sxs-lookup"><span data-stu-id="03944-390">This will create a new DataTable and TableAdapter and walk you through the wizard we examined earlier in this tutorial.</span></span>

<span data-ttu-id="03944-391">使用以下查询创建以下 Tableadapter 和方法需要几分钟时间。</span><span class="sxs-lookup"><span data-stu-id="03944-391">Take a few minutes to create the following TableAdapters and methods using the following queries.</span></span> <span data-ttu-id="03944-392">请注意， **ProductsTableAdapter**中的查询包含用于获取每个产品类别和供应商名称的子查询。</span><span class="sxs-lookup"><span data-stu-id="03944-392">Note that the queries in the **ProductsTableAdapter** include the subqueries to grab each product's category and supplier names.</span></span> <span data-ttu-id="03944-393">此外，如果已执行过后续工作，则已添加**ProductsTableAdapter**类的**GetProducts （）** 和**GetProductsByCategoryID （*类别 id*）** 方法。</span><span class="sxs-lookup"><span data-stu-id="03944-393">Additionally, if you've been following along, you've already added the **ProductsTableAdapter** class's **GetProducts()** and **GetProductsByCategoryID(*categoryID*)** methods.</span></span>

- <span data-ttu-id="03944-394">**ProductsTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="03944-394">**ProductsTableAdapter**</span></span>

  - <span data-ttu-id="03944-395">**GetProducts**：</span><span class="sxs-lookup"><span data-stu-id="03944-395">**GetProducts**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample10.sql)]
  - <span data-ttu-id="03944-396">**GetProductsByCategoryID**：</span><span class="sxs-lookup"><span data-stu-id="03944-396">**GetProductsByCategoryID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample11.sql)]
  - <span data-ttu-id="03944-397">**GetProductsBySupplierID**：</span><span class="sxs-lookup"><span data-stu-id="03944-397">**GetProductsBySupplierID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample12.sql)]
  - <span data-ttu-id="03944-398">**GetProductByProductID**：</span><span class="sxs-lookup"><span data-stu-id="03944-398">**GetProductByProductID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample13.sql)]
- <span data-ttu-id="03944-399">**CategoriesTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="03944-399">**CategoriesTableAdapter**</span></span>

  - <span data-ttu-id="03944-400">**GetCategories**：</span><span class="sxs-lookup"><span data-stu-id="03944-400">**GetCategories**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample14.sql)]
  - <span data-ttu-id="03944-401">**GetCategoryByCategoryID**：</span><span class="sxs-lookup"><span data-stu-id="03944-401">**GetCategoryByCategoryID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample15.sql)]
- <span data-ttu-id="03944-402">**SuppliersTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="03944-402">**SuppliersTableAdapter**</span></span>

  - <span data-ttu-id="03944-403">**GetSuppliers**：</span><span class="sxs-lookup"><span data-stu-id="03944-403">**GetSuppliers**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample16.sql)]
  - <span data-ttu-id="03944-404">**GetSuppliersByCountry**：</span><span class="sxs-lookup"><span data-stu-id="03944-404">**GetSuppliersByCountry**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample17.sql)]
  - <span data-ttu-id="03944-405">**GetSupplierBySupplierID**：</span><span class="sxs-lookup"><span data-stu-id="03944-405">**GetSupplierBySupplierID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample18.sql)]
- <span data-ttu-id="03944-406">**EmployeesTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="03944-406">**EmployeesTableAdapter**</span></span>

  - <span data-ttu-id="03944-407">**GetEmployees**：</span><span class="sxs-lookup"><span data-stu-id="03944-407">**GetEmployees**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample19.sql)]
  - <span data-ttu-id="03944-408">**GetEmployeesByManager**：</span><span class="sxs-lookup"><span data-stu-id="03944-408">**GetEmployeesByManager**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample20.sql)]
  - <span data-ttu-id="03944-409">**GetEmployeeByEmployeeID**：</span><span class="sxs-lookup"><span data-stu-id="03944-409">**GetEmployeeByEmployeeID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample21.sql)]

<span data-ttu-id="03944-410">[添加四个 Tableadapter 后，在数据集设计器 ![](creating-a-data-access-layer-cs/_static/image84.png)](creating-a-data-access-layer-cs/_static/image83.png)</span><span class="sxs-lookup"><span data-stu-id="03944-410">[![The DataSet Designer After the Four TableAdapters Have Been Added](creating-a-data-access-layer-cs/_static/image84.png)](creating-a-data-access-layer-cs/_static/image83.png)</span></span>

<span data-ttu-id="03944-411">**图 31**：添加四个 tableadapter 后的数据集设计器（[单击以查看完全大小的图像](creating-a-data-access-layer-cs/_static/image85.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-411">**Figure 31**: The DataSet Designer After the Four TableAdapters Have Been Added ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image85.png))</span></span>

## <a name="adding-custom-code-to-the-dal"></a><span data-ttu-id="03944-412">将自定义代码添加到 DAL</span><span class="sxs-lookup"><span data-stu-id="03944-412">Adding Custom Code to the DAL</span></span>

<span data-ttu-id="03944-413">添加到类型化数据集的 Tableadapter 和数据表以 XML 架构定义文件（**Northwind**）表示。</span><span class="sxs-lookup"><span data-stu-id="03944-413">The TableAdapters and DataTables added to the Typed DataSet are expressed as an XML Schema Definition file (**Northwind.xsd**).</span></span> <span data-ttu-id="03944-414">您可以通过右键单击 "解决方案资源管理器中的**Northwind .xsd**文件，然后选择" 查看代码 "来查看此架构信息。</span><span class="sxs-lookup"><span data-stu-id="03944-414">You can view this schema information by right-clicking on the **Northwind.xsd** file in the Solution Explorer and choosing View Code.</span></span>

<span data-ttu-id="03944-415">[![Northwinds 类型化数据集的 XML 架构定义（XSD）文件](creating-a-data-access-layer-cs/_static/image87.png)](creating-a-data-access-layer-cs/_static/image86.png)</span><span class="sxs-lookup"><span data-stu-id="03944-415">[![The XML Schema Definition (XSD) File for the Northwinds Typed DataSet](creating-a-data-access-layer-cs/_static/image87.png)](creating-a-data-access-layer-cs/_static/image86.png)</span></span>

<span data-ttu-id="03944-416">**图 32**： Northwinds 类型化数据集的 XML 架构定义（XSD）文件（[单击以查看完全大小的图像](creating-a-data-access-layer-cs/_static/image88.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-416">**Figure 32**: The XML Schema Definition (XSD) File for the Northwinds Typed DataSet ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image88.png))</span></span>

<span data-ttu-id="03944-417">此架构信息在编译时C#或运行时（如果需要）在设计时转换为或 Visual Basic 代码（如果需要），此时你可以使用调试器执行该操作。</span><span class="sxs-lookup"><span data-stu-id="03944-417">This schema information is translated into C# or Visual Basic code at design time when compiled or at runtime (if needed), at which point you can step through it with the debugger.</span></span> <span data-ttu-id="03944-418">若要查看自动生成的代码，请跳到类视图并向下钻取到 TableAdapter 或类型化数据集类。</span><span class="sxs-lookup"><span data-stu-id="03944-418">To view this auto-generated code go to the Class View and drill down to the TableAdapter or Typed DataSet classes.</span></span> <span data-ttu-id="03944-419">如果在屏幕上看不到 "类视图"，请转到 "视图" 菜单并从中选择，或按 Ctrl + Shift + C。</span><span class="sxs-lookup"><span data-stu-id="03944-419">If you don't see the Class View on your screen, go to the View menu and select it from there, or hit Ctrl+Shift+C.</span></span> <span data-ttu-id="03944-420">类视图可以查看类型化数据集和 TableAdapter 类的属性、方法和事件。</span><span class="sxs-lookup"><span data-stu-id="03944-420">From the Class View you can see the properties, methods, and events of the Typed DataSet and TableAdapter classes.</span></span> <span data-ttu-id="03944-421">若要查看特定方法的代码，请在类视图中双击方法名称，或右键单击该方法，然后选择 "转向定义"。</span><span class="sxs-lookup"><span data-stu-id="03944-421">To view the code for a particular method, double-click the method name in the Class View or right-click on it and choose Go To Definition.</span></span>

![通过从类视图中选择 "转向定义" 来检查自动生成的代码](creating-a-data-access-layer-cs/_static/image89.png)

<span data-ttu-id="03944-423">**图 33**：通过从类视图中选择 "转向定义" 来检查自动生成的代码</span><span class="sxs-lookup"><span data-stu-id="03944-423">**Figure 33**: Inspect the Auto-Generated Code by Selecting Go To Definition from the Class View</span></span>

<span data-ttu-id="03944-424">尽管自动生成的代码可能是很好的时间保护程序，但代码通常非常通用，需要对其进行自定义以满足应用程序的独特需求。</span><span class="sxs-lookup"><span data-stu-id="03944-424">While auto-generated code can be a great time saver, the code is often very generic and needs to be customized to meet the unique needs of an application.</span></span> <span data-ttu-id="03944-425">不过，扩展自动生成的代码的风险在于，生成代码的工具可能决定是时间 "重新生成" 并覆盖您的自定义项。</span><span class="sxs-lookup"><span data-stu-id="03944-425">The risk of extending auto-generated code, though, is that the tool that generated the code might decide it's time to "regenerate" and overwrite your customizations.</span></span> <span data-ttu-id="03944-426">使用 .NET 2.0 的新分部类概念，可以轻松地跨多个文件拆分一个类。</span><span class="sxs-lookup"><span data-stu-id="03944-426">With .NET 2.0's new partial class concept, it's easy to split a class across multiple files.</span></span> <span data-ttu-id="03944-427">这使我们能够将自己的方法、属性和事件添加到自动生成的类，而无需担心 Visual Studio 覆盖我们的自定义。</span><span class="sxs-lookup"><span data-stu-id="03944-427">This enables us to add our own methods, properties, and events to the auto-generated classes without having to worry about Visual Studio overwriting our customizations.</span></span>

<span data-ttu-id="03944-428">若要演示如何自定义 DAL，请将**GetProducts （）** 方法添加到**SuppliersRow**类。</span><span class="sxs-lookup"><span data-stu-id="03944-428">To demonstrate how to customize the DAL, let's add a **GetProducts()** method to the **SuppliersRow** class.</span></span> <span data-ttu-id="03944-429">**SuppliersRow**类表示**供应商**表中的单个记录;每个供应商可以向多个产品提供零个，因此**GetProducts （）** 将返回指定供应商的那些产品。</span><span class="sxs-lookup"><span data-stu-id="03944-429">The **SuppliersRow** class represents a single record in the **Suppliers** table; each supplier can provider zero to many products, so **GetProducts()** will return those products of the specified supplier.</span></span> <span data-ttu-id="03944-430">若要完成此操作，请在**应用\_程序**中创建一个名为**SuppliersRow.cs**的新类文件，并添加以下代码：</span><span class="sxs-lookup"><span data-stu-id="03944-430">To accomplish this create a new class file in the **App\_Code** folder named **SuppliersRow.cs** and add the following code:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample22.cs)]

<span data-ttu-id="03944-431">此分部类指示编译器在生成**SuppliersRow**类时，包括我们刚才定义的**GetProducts （）** 方法。</span><span class="sxs-lookup"><span data-stu-id="03944-431">This partial class instructs the compiler that when building the **Northwind.SuppliersRow** class to include the **GetProducts()** method we just defined.</span></span> <span data-ttu-id="03944-432">如果生成项目，然后返回到类视图你将看到**GetProducts （）** 现在作为**SuppliersRow**的方法列出。</span><span class="sxs-lookup"><span data-stu-id="03944-432">If you build your project and then return to the Class View you'll see **GetProducts()** now listed as a method of **Northwind.SuppliersRow**.</span></span>

![GetProducts （）方法现在是 SuppliersRow 类的一部分](creating-a-data-access-layer-cs/_static/image90.png)

<span data-ttu-id="03944-434">**图 34**： **GetProducts （）** 方法现在是**SuppliersRow**类的一部分</span><span class="sxs-lookup"><span data-stu-id="03944-434">**Figure 34**: The **GetProducts()** Method is Now Part of the **Northwind.SuppliersRow** Class</span></span>

<span data-ttu-id="03944-435">现在可以使用**GetProducts （）** 方法来枚举特定供应商的一组产品，如以下代码所示：</span><span class="sxs-lookup"><span data-stu-id="03944-435">The **GetProducts()** method can now be used to enumerate the set of products for a particular supplier, as the following code shows:</span></span>

[!code-html[Main](creating-a-data-access-layer-cs/samples/sample23.html)]

<span data-ttu-id="03944-436">此数据还可以显示在 ASP 的任何一个中。网络的数据 Web 控件。</span><span class="sxs-lookup"><span data-stu-id="03944-436">This data can also be displayed in any of ASP.NET's data Web controls.</span></span> <span data-ttu-id="03944-437">以下页面使用包含两个字段的 GridView 控件：</span><span class="sxs-lookup"><span data-stu-id="03944-437">The following page uses a GridView control with two fields:</span></span>

- <span data-ttu-id="03944-438">显示每个供应商名称的 BoundField，</span><span class="sxs-lookup"><span data-stu-id="03944-438">A BoundField that displays the name of each supplier, and</span></span>
- <span data-ttu-id="03944-439">一个 TemplateField，其中包含一个 BulletedList 控件，该控件绑定到每个供应商的**GetProducts （）** 方法返回的结果。</span><span class="sxs-lookup"><span data-stu-id="03944-439">A TemplateField that contains a BulletedList control that is bound to the results returned by the **GetProducts()** method for each supplier.</span></span>

<span data-ttu-id="03944-440">我们将在以后的教程中检查如何显示此类主/详细信息报表。</span><span class="sxs-lookup"><span data-stu-id="03944-440">We'll examine how to display such master-detail reports in future tutorials.</span></span> <span data-ttu-id="03944-441">现在，此示例旨在说明如何使用添加到**SuppliersRow**类的自定义方法。</span><span class="sxs-lookup"><span data-stu-id="03944-441">For now, this example is designed to illustrate using the custom method added to the **Northwind.SuppliersRow** class.</span></span>

<span data-ttu-id="03944-442">SuppliersAndProducts.aspx</span><span class="sxs-lookup"><span data-stu-id="03944-442">SuppliersAndProducts.aspx</span></span>

[!code-aspx[Main](creating-a-data-access-layer-cs/samples/sample24.aspx)]

<span data-ttu-id="03944-443">SuppliersAndProducts.aspx.cs</span><span class="sxs-lookup"><span data-stu-id="03944-443">SuppliersAndProducts.aspx.cs</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample25.cs)]

<span data-ttu-id="03944-444">[![供应商的公司名称列在左栏中，其产品显示在右侧](creating-a-data-access-layer-cs/_static/image92.png)](creating-a-data-access-layer-cs/_static/image91.png)</span><span class="sxs-lookup"><span data-stu-id="03944-444">[![The Supplier's Company Name is Listed in the Left Column, Their Products in the Right](creating-a-data-access-layer-cs/_static/image92.png)](creating-a-data-access-layer-cs/_static/image91.png)</span></span>

<span data-ttu-id="03944-445">**图 35**：在左列中列出了供应商的公司名称，他们的产品显示在右侧（[单击以查看完全大小的图像](creating-a-data-access-layer-cs/_static/image93.png)）</span><span class="sxs-lookup"><span data-stu-id="03944-445">**Figure 35**: The Supplier's Company Name is Listed in the Left Column, Their Products in the Right ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image93.png))</span></span>

## <a name="summary"></a><span data-ttu-id="03944-446">摘要</span><span class="sxs-lookup"><span data-stu-id="03944-446">Summary</span></span>

<span data-ttu-id="03944-447">构建 web 应用程序时，创建 DAL 的操作应该是您在开始创建表示层之前要执行的第一个步骤。</span><span class="sxs-lookup"><span data-stu-id="03944-447">When building a web application creating the DAL should be one of your first steps, occurring before you start creating your presentation layer.</span></span> <span data-ttu-id="03944-448">使用 Visual Studio 时，基于类型化数据集创建 DAL 是一项任务，可以在10-15 分钟内完成，而无需编写代码行。</span><span class="sxs-lookup"><span data-stu-id="03944-448">With Visual Studio, creating a DAL based on Typed DataSets is a task that can be accomplished in 10-15 minutes without writing a line of code.</span></span> <span data-ttu-id="03944-449">后续教程将在此 DAL 上构建。</span><span class="sxs-lookup"><span data-stu-id="03944-449">The tutorials moving forward will build upon this DAL.</span></span> <span data-ttu-id="03944-450">在[下一教程](creating-a-business-logic-layer-cs.md)中，我们将定义一些业务规则，并了解如何在单独的业务逻辑层中实现它们。</span><span class="sxs-lookup"><span data-stu-id="03944-450">In the [next tutorial](creating-a-business-logic-layer-cs.md) we'll define a number of business rules and see how to implement them in a separate Business Logic Layer.</span></span>

<span data-ttu-id="03944-451">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="03944-451">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="03944-452">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="03944-452">Further Reading</span></span>

<span data-ttu-id="03944-453">有关本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="03944-453">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="03944-454">使用 VS 2005 和 ASP.NET 2.0 中的强类型化 Tableadapter 和数据表构建 DAL</span><span class="sxs-lookup"><span data-stu-id="03944-454">Building a DAL using Strongly Typed TableAdapters and DataTables in VS 2005 and ASP.NET 2.0</span></span>](https://weblogs.asp.net/scottgu/435498)
- [<span data-ttu-id="03944-455">设计数据层组件，并通过层传递数据</span><span class="sxs-lookup"><span data-stu-id="03944-455">Designing Data Tier Components and Passing Data Through Tiers</span></span>](https://msdn.microsoft.com/library/ms978496.aspx)
- [<span data-ttu-id="03944-456">使用 Visual Studio 2005 数据集设计器生成数据访问层</span><span class="sxs-lookup"><span data-stu-id="03944-456">Build a Data Access Layer with the Visual Studio 2005 DataSet Designer</span></span>](http://www.theserverside.net/articles/showarticle.tss?id=DataSetDesigner)
- [<span data-ttu-id="03944-457">加密 ASP.NET 2.0 应用程序中的配置信息</span><span class="sxs-lookup"><span data-stu-id="03944-457">Encrypting Configuration Information in ASP.NET 2.0 Applications</span></span>](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx)
- [<span data-ttu-id="03944-458">TableAdapter 概述</span><span class="sxs-lookup"><span data-stu-id="03944-458">TableAdapter Overview</span></span>](https://msdn.microsoft.com/library/bz9tthwx.aspx)
- [<span data-ttu-id="03944-459">使用类型化数据集</span><span class="sxs-lookup"><span data-stu-id="03944-459">Working with a Typed DataSet</span></span>](https://msdn.microsoft.com/library/esbykkzb.aspx)
- [<span data-ttu-id="03944-460">在 Visual Studio 2005 和 ASP.NET 2.0 中使用强类型化数据访问</span><span class="sxs-lookup"><span data-stu-id="03944-460">Using Strongly-Typed Data Access in Visual Studio 2005 and ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/020806-1.aspx)
- [<span data-ttu-id="03944-461">如何扩展 TableAdapter 方法</span><span class="sxs-lookup"><span data-stu-id="03944-461">How to Extend TableAdapter Methods</span></span>](https://blogs.msdn.com/vbteam/archive/2005/05/04/ExtendingTableAdapters.aspx)
- [<span data-ttu-id="03944-462">从存储过程中检索标量数据</span><span class="sxs-lookup"><span data-stu-id="03944-462">Retrieving Scalar Data from a Stored Procedure</span></span>](http://aspnet.4guysfromrolla.com/articles/062905-1.aspx)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="03944-463">本教程中包含的主题的视频培训</span><span class="sxs-lookup"><span data-stu-id="03944-463">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="03944-464">ASP.NET 应用程序中的数据访问层</span><span class="sxs-lookup"><span data-stu-id="03944-464">Data Access Layers in ASP.NET Applications</span></span>](../../../videos/data-access/adonet-data-services/data-access-layers-in-aspnet-applications.md)
- [<span data-ttu-id="03944-465">如何手动将数据集绑定到 Datagrid</span><span class="sxs-lookup"><span data-stu-id="03944-465">How to Manually Bind a Dataset to a Datagrid</span></span>](../../../videos/data-access/adonet-data-services/how-to-manually-bind-a-dataset-to-a-datagrid.md)
- [<span data-ttu-id="03944-466">如何从 ASP 应用程序使用数据集和筛选器</span><span class="sxs-lookup"><span data-stu-id="03944-466">How to Work with Datasets and Filters from an ASP Application</span></span>](../../../videos/data-access/adonet-data-services/how-to-work-with-datasets-and-filters-from-an-asp-application.md)

## <a name="about-the-author"></a><span data-ttu-id="03944-467">关于作者</span><span class="sxs-lookup"><span data-stu-id="03944-467">About the Author</span></span>

<span data-ttu-id="03944-468">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，创始人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已在使用 Microsoft Web 技术，自1998开始。</span><span class="sxs-lookup"><span data-stu-id="03944-468">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="03944-469">Scott 的工作方式是独立的顾问、培训师和撰稿人。</span><span class="sxs-lookup"><span data-stu-id="03944-469">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="03944-470">他的最新书籍是，[*在24小时内，sam ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="03944-470">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="03944-471">可以[mitchell@4GuysFromRolla.com访问。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="03944-471">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="03944-472">或通过他的博客，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="03944-472">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="03944-473">特别感谢</span><span class="sxs-lookup"><span data-stu-id="03944-473">Special Thanks To</span></span>

<span data-ttu-id="03944-474">此教程系列由许多有用的审阅者查看。</span><span class="sxs-lookup"><span data-stu-id="03944-474">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="03944-475">本教程的主管评审者是 Ron 绿、Hilton Giesenow、Dennis Patterson 将、Liz Shulok、Abel Gomez 和 Carlos Santos。</span><span class="sxs-lookup"><span data-stu-id="03944-475">Lead reviewers for this tutorial were Ron Green, Hilton Giesenow, Dennis Patterson, Liz Shulok, Abel Gomez, and Carlos Santos.</span></span> <span data-ttu-id="03944-476">想要查看我即将发布的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="03944-476">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="03944-477">如果是这样，请在mitchell@4GuysFromRolla.com放置一行[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="03944-477">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="03944-478">下一部分</span><span class="sxs-lookup"><span data-stu-id="03944-478">Next</span></span>](creating-a-business-logic-layer-cs.md)
