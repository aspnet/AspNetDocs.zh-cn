---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb
title: 自定义数据修改接口（VB） |Microsoft Docs
author: rick-anderson
description: 在本教程中，我们将介绍如何通过将 "标准" 文本框和复选框控件替换为 alternati，来自定义可编辑 GridView 的界面。
ms.author: riande
ms.date: 07/17/2006
ms.assetid: 4830d984-bd2c-4a08-bfe5-2385599f1f7d
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb
msc.type: authoredcontent
ms.openlocfilehash: 85ec7bdde6b2bffbbda066b0441bbd36b7072197
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/06/2020
ms.locfileid: "78479252"
---
# <a name="customizing-the-data-modification-interface-vb"></a><span data-ttu-id="c8593-103">自定义数据修改界面 (VB)</span><span class="sxs-lookup"><span data-stu-id="c8593-103">Customizing the Data Modification Interface (VB)</span></span>

<span data-ttu-id="c8593-104">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="c8593-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="c8593-105">[下载示例应用](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_20_VB.exe)或[下载 PDF](customizing-the-data-modification-interface-vb/_static/datatutorial20vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="c8593-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_20_VB.exe) or [Download PDF](customizing-the-data-modification-interface-vb/_static/datatutorial20vb1.pdf)</span></span>

> <span data-ttu-id="c8593-106">在本教程中，我们将介绍如何通过将 "标准" 文本框和复选框控件替换为备用输入 Web 控件来自定义可编辑 GridView 的界面。</span><span class="sxs-lookup"><span data-stu-id="c8593-106">In this tutorial we'll look at how to customize the interface of an editable GridView, by replacing the standard TextBox and CheckBox controls with alternative input Web controls.</span></span>

## <a name="introduction"></a><span data-ttu-id="c8593-107">简介</span><span class="sxs-lookup"><span data-stu-id="c8593-107">Introduction</span></span>

<span data-ttu-id="c8593-108">GridView 和 DetailsView 控件使用的 BoundFields 和 CheckBoxFields 可简化修改数据的过程，因为它们能够呈现只读、可编辑和可插入的接口。</span><span class="sxs-lookup"><span data-stu-id="c8593-108">The BoundFields and CheckBoxFields used by the GridView and DetailsView controls simplify the process of modifying data due to their ability to render read-only, editable, and insertable interfaces.</span></span> <span data-ttu-id="c8593-109">可以呈现这些接口，而无需添加任何附加的声明性标记或代码。</span><span class="sxs-lookup"><span data-stu-id="c8593-109">These interfaces can be rendered without the need for adding any additional declarative markup or code.</span></span> <span data-ttu-id="c8593-110">但在实际情况下，BoundField 和 CheckBoxField 的接口缺乏可定制性。</span><span class="sxs-lookup"><span data-stu-id="c8593-110">However, the BoundField and CheckBoxField's interfaces lack the customizability often needed in real-world scenarios.</span></span> <span data-ttu-id="c8593-111">若要在 GridView 或 DetailsView 中自定义可编辑或可插入的界面，需改为使用 TemplateField。</span><span class="sxs-lookup"><span data-stu-id="c8593-111">In order to customize the editable or insertable interface in a GridView or DetailsView we need to instead use a TemplateField.</span></span>

<span data-ttu-id="c8593-112">在[前面的教程](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb.md)中，我们介绍了如何通过添加验证 Web 控件自定义数据修改接口。</span><span class="sxs-lookup"><span data-stu-id="c8593-112">In the [preceding tutorial](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb.md) we saw how to customize the data modification interfaces by adding validation Web controls.</span></span> <span data-ttu-id="c8593-113">在本教程中，我们将介绍如何自定义实际的数据收集 Web 控件，并将 BoundField 和 CheckBoxField 的标准 TextBox 和 CheckBox 控件替换为备用输入 Web 控件。</span><span class="sxs-lookup"><span data-stu-id="c8593-113">In this tutorial we'll look at how to customize the actual data collection Web controls, replacing the BoundField and CheckBoxField's standard TextBox and CheckBox controls with alternative input Web controls.</span></span> <span data-ttu-id="c8593-114">具体而言，我们将构建一个可编辑的 GridView，以允许更新产品的名称、类别、供应商和中止状态。</span><span class="sxs-lookup"><span data-stu-id="c8593-114">In particular, we'll build an editable GridView that allows a product's name, category, supplier, and discontinued status to be updated.</span></span> <span data-ttu-id="c8593-115">编辑特定行时，"类别" 和 "供应商" 字段将呈现为 DropDownLists，其中包含可供选择的可用类别和供应商组。</span><span class="sxs-lookup"><span data-stu-id="c8593-115">When editing a particular row, the category and supplier fields will render as DropDownLists, containing the set of available categories and suppliers to choose from.</span></span> <span data-ttu-id="c8593-116">此外，我们会将 CheckBoxField 的默认复选框替换为提供两个选项的 RadioButtonList 控件： "活动" 和 "已停用"。</span><span class="sxs-lookup"><span data-stu-id="c8593-116">Furthermore, we'll replace the CheckBoxField's default CheckBox with a RadioButtonList control that offers two options: "Active" and "Discontinued".</span></span>

<span data-ttu-id="c8593-117">[![GridView 的编辑界面包括 DropDownLists 和单选按钮](customizing-the-data-modification-interface-vb/_static/image2.png)](customizing-the-data-modification-interface-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="c8593-117">[![The GridView's Editing Interface Includes DropDownLists and RadioButtons](customizing-the-data-modification-interface-vb/_static/image2.png)](customizing-the-data-modification-interface-vb/_static/image1.png)</span></span>

<span data-ttu-id="c8593-118">**图 1**： GridView 的编辑界面包括 DropDownLists 和单选按钮（[单击以查看完全尺寸的图像](customizing-the-data-modification-interface-vb/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="c8593-118">**Figure 1**: The GridView's Editing Interface Includes DropDownLists and RadioButtons ([Click to view full-size image](customizing-the-data-modification-interface-vb/_static/image3.png))</span></span>

## <a name="step-1-creating-the-appropriateupdateproductoverload"></a><span data-ttu-id="c8593-119">步骤1：创建适当的`UpdateProduct`重载</span><span class="sxs-lookup"><span data-stu-id="c8593-119">Step 1: Creating the Appropriate`UpdateProduct`Overload</span></span>

<span data-ttu-id="c8593-120">在本教程中，我们将构建一个可编辑的 GridView，以允许编辑产品的名称、类别、供应商和废止状态。</span><span class="sxs-lookup"><span data-stu-id="c8593-120">In this tutorial we will build an editable GridView that permits editing of a product's name, category, supplier, and discontinued status.</span></span> <span data-ttu-id="c8593-121">因此，我们需要一个 `UpdateProduct` 重载，它接受这四个产品值加 `ProductID`这四个输入参数。</span><span class="sxs-lookup"><span data-stu-id="c8593-121">Therefore, we need an `UpdateProduct` overload that accepts five input parameters these four product values plus the `ProductID`.</span></span> <span data-ttu-id="c8593-122">与我们以前的重载一样，此操作将：</span><span class="sxs-lookup"><span data-stu-id="c8593-122">Like in our previous overloads, this one will:</span></span>

1. <span data-ttu-id="c8593-123">从数据库检索指定 `ProductID`的产品信息。</span><span class="sxs-lookup"><span data-stu-id="c8593-123">Retrieve the product information from the database for the specified `ProductID`,</span></span>
2. <span data-ttu-id="c8593-124">更新 `ProductName`、`CategoryID`、`SupplierID`和 `Discontinued` 字段，并</span><span class="sxs-lookup"><span data-stu-id="c8593-124">Update the `ProductName`, `CategoryID`, `SupplierID`, and `Discontinued` fields, and</span></span>
3. <span data-ttu-id="c8593-125">通过 TableAdapter 的 `Update()` 方法将更新请求发送到 DAL。</span><span class="sxs-lookup"><span data-stu-id="c8593-125">Send the update request to the DAL through the TableAdapter's `Update()` method.</span></span>

<span data-ttu-id="c8593-126">为简洁起见，对于此特定重载，我省略了业务规则检查，确保标记为 "已停用" 的产品不是其供应商提供的唯一产品。</span><span class="sxs-lookup"><span data-stu-id="c8593-126">For brevity, for this particular overload I've omitted the business rule check that ensures a product being marked as discontinued isn't the only product offered by its supplier.</span></span> <span data-ttu-id="c8593-127">如果愿意，或最好将逻辑重构为单独的方法，则可以随意将其添加到中。</span><span class="sxs-lookup"><span data-stu-id="c8593-127">Feel free to add it in if you prefer, or, ideally, refactor out the logic to a separate method.</span></span>

<span data-ttu-id="c8593-128">下面的代码演示了 `ProductsBLL` 类中的新 `UpdateProduct` 重载：</span><span class="sxs-lookup"><span data-stu-id="c8593-128">The following code shows the new `UpdateProduct` overload in the `ProductsBLL` class:</span></span>

[!code-vb[Main](customizing-the-data-modification-interface-vb/samples/sample1.vb)]

## <a name="step-2-crafting-the-editable-gridview"></a><span data-ttu-id="c8593-129">步骤2：编制可编辑的 GridView</span><span class="sxs-lookup"><span data-stu-id="c8593-129">Step 2: Crafting the Editable GridView</span></span>

<span data-ttu-id="c8593-130">添加 `UpdateProduct` 重载后，便可以创建可编辑的 GridView 了。</span><span class="sxs-lookup"><span data-stu-id="c8593-130">With the `UpdateProduct` overload added, we're ready to create our editable GridView.</span></span> <span data-ttu-id="c8593-131">打开 `EditInsertDelete` 文件夹中的 "`CustomizedUI.aspx`" 页，并向设计器添加一个 GridView 控件。</span><span class="sxs-lookup"><span data-stu-id="c8593-131">Open the `CustomizedUI.aspx` page in the `EditInsertDelete` folder and add a GridView control to the Designer.</span></span> <span data-ttu-id="c8593-132">接下来，从 GridView 的智能标记创建新的 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="c8593-132">Next, create a new ObjectDataSource from the GridView's smart tag.</span></span> <span data-ttu-id="c8593-133">将 ObjectDataSource 配置为通过 `ProductBLL` 类的 `GetProducts()` 方法检索产品信息，并使用刚刚创建的 `UpdateProduct` 重载更新产品数据。</span><span class="sxs-lookup"><span data-stu-id="c8593-133">Configure the ObjectDataSource to retrieve product information via the `ProductBLL` class's `GetProducts()` method and to update product data using the `UpdateProduct` overload we just created.</span></span> <span data-ttu-id="c8593-134">从 "插入" 和 "删除" 选项卡中，从下拉列表中选择 "（无）"。</span><span class="sxs-lookup"><span data-stu-id="c8593-134">From the INSERT and DELETE tabs, select (None) from the drop-down lists.</span></span>

<span data-ttu-id="c8593-135">[![将 ObjectDataSource 配置为使用刚创建的 UpdateProduct 重载](customizing-the-data-modification-interface-vb/_static/image5.png)](customizing-the-data-modification-interface-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="c8593-135">[![Configure the ObjectDataSource to Use the UpdateProduct Overload Just Created](customizing-the-data-modification-interface-vb/_static/image5.png)](customizing-the-data-modification-interface-vb/_static/image4.png)</span></span>

<span data-ttu-id="c8593-136">**图 2**：将 ObjectDataSource 配置为使用刚创建的 `UpdateProduct` 重载（[单击查看完全大小的映像](customizing-the-data-modification-interface-vb/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="c8593-136">**Figure 2**: Configure the ObjectDataSource to Use the `UpdateProduct` Overload Just Created ([Click to view full-size image](customizing-the-data-modification-interface-vb/_static/image6.png))</span></span>

<span data-ttu-id="c8593-137">正如我们在数据修改教程中看到的那样，Visual Studio 创建的 ObjectDataSource 的声明性语法将 `OldValuesParameterFormatString` 属性分配给 `original_{0}`。</span><span class="sxs-lookup"><span data-stu-id="c8593-137">As we've seen throughout the data modification tutorials, the declarative syntax for the ObjectDataSource created by Visual Studio assigns the `OldValuesParameterFormatString` property to `original_{0}`.</span></span> <span data-ttu-id="c8593-138">当然，这不能与我们的业务逻辑层一起使用，因为我们的方法不希望传入原始 `ProductID` 值。</span><span class="sxs-lookup"><span data-stu-id="c8593-138">This, of course, won't work with our Business Logic Layer since our methods don't expect the original `ProductID` value to be passed in.</span></span> <span data-ttu-id="c8593-139">因此，正如我们在上一教程中所做的那样，请花点时间从声明性语法中删除此属性分配，或将此属性的值设置为 `{0}`。</span><span class="sxs-lookup"><span data-stu-id="c8593-139">Therefore, as we've done in previous tutorials, take a moment to remove this property assignment from the declarative syntax or, instead, set this property's value to `{0}`.</span></span>

<span data-ttu-id="c8593-140">此更改之后，ObjectDataSource 的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="c8593-140">After this change, the ObjectDataSource's declarative markup should look like the following:</span></span>

[!code-aspx[Main](customizing-the-data-modification-interface-vb/samples/sample2.aspx)]

<span data-ttu-id="c8593-141">请注意，`OldValuesParameterFormatString` 属性已被移除，并且对于 `UpdateProduct` 重载所需的每个输入参数，`UpdateParameters` 集合中都有 `Parameter`。</span><span class="sxs-lookup"><span data-stu-id="c8593-141">Note that the `OldValuesParameterFormatString` property has been removed and that there is a `Parameter` in the `UpdateParameters` collection for each of the input parameters expected by our `UpdateProduct` overload.</span></span>

<span data-ttu-id="c8593-142">尽管 ObjectDataSource 配置为仅更新产品值的子集，但 GridView 当前显示的所有产品字段*均*为。</span><span class="sxs-lookup"><span data-stu-id="c8593-142">While the ObjectDataSource is configured to update only a subset of product values, the GridView currently shows *all* of the product fields.</span></span> <span data-ttu-id="c8593-143">花点时间编辑 GridView，使：</span><span class="sxs-lookup"><span data-stu-id="c8593-143">Take a moment to edit the GridView so that:</span></span>

- <span data-ttu-id="c8593-144">它仅包含 `ProductName`、`SupplierName``CategoryName` BoundFields 和 `Discontinued` CheckBoxField</span><span class="sxs-lookup"><span data-stu-id="c8593-144">It only includes the `ProductName`, `SupplierName`, `CategoryName` BoundFields and the `Discontinued` CheckBoxField</span></span>
- <span data-ttu-id="c8593-145">"`CategoryName`" 和 "`SupplierName`" 字段显示在 `Discontinued` CheckBoxField 之前（左侧）</span><span class="sxs-lookup"><span data-stu-id="c8593-145">The `CategoryName` and `SupplierName` fields to appear before (to the left of) the `Discontinued` CheckBoxField</span></span>
- <span data-ttu-id="c8593-146">`CategoryName` 和 `SupplierName` BoundFields ' `HeaderText` 属性分别设置为 "Category" 和 "供应商"。</span><span class="sxs-lookup"><span data-stu-id="c8593-146">The `CategoryName` and `SupplierName` BoundFields' `HeaderText` property is set to "Category" and "Supplier", respectively</span></span>
- <span data-ttu-id="c8593-147">启用编辑支持（选中 GridView 智能标记中的 "启用编辑" 复选框）</span><span class="sxs-lookup"><span data-stu-id="c8593-147">Editing support is enabled (check the Enable Editing checkbox in the GridView's smart tag)</span></span>

<span data-ttu-id="c8593-148">进行这些更改后，设计器将类似于图3，其中显示了 GridView 的声明性语法。</span><span class="sxs-lookup"><span data-stu-id="c8593-148">After these changes, the Designer will look similar to Figure 3, with the GridView's declarative syntax shown below.</span></span>

<span data-ttu-id="c8593-149">[![从 GridView 中删除不需要的字段](customizing-the-data-modification-interface-vb/_static/image8.png)](customizing-the-data-modification-interface-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c8593-149">[![Remove the Unneeded Fields from the GridView](customizing-the-data-modification-interface-vb/_static/image8.png)](customizing-the-data-modification-interface-vb/_static/image7.png)</span></span>

<span data-ttu-id="c8593-150">**图 3**：从 GridView 中删除不需要的字段（[单击以查看完全大小的图像](customizing-the-data-modification-interface-vb/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="c8593-150">**Figure 3**: Remove the Unneeded Fields from the GridView ([Click to view full-size image](customizing-the-data-modification-interface-vb/_static/image9.png))</span></span>

[!code-aspx[Main](customizing-the-data-modification-interface-vb/samples/sample3.aspx)]

<span data-ttu-id="c8593-151">此时，GridView 的只读行为已经完成。</span><span class="sxs-lookup"><span data-stu-id="c8593-151">At this point the GridView's read-only behavior is complete.</span></span> <span data-ttu-id="c8593-152">查看数据时，每个产品都呈现为 GridView 中的一行，显示产品的名称、类别、供应商和停止状态。</span><span class="sxs-lookup"><span data-stu-id="c8593-152">When viewing the data, each product is rendered as a row in the GridView, showing the product's name, category, supplier, and discontinued status.</span></span>

<span data-ttu-id="c8593-153">[![GridView 的只读接口已完成](customizing-the-data-modification-interface-vb/_static/image11.png)](customizing-the-data-modification-interface-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="c8593-153">[![The GridView's Read-Only Interface is Complete](customizing-the-data-modification-interface-vb/_static/image11.png)](customizing-the-data-modification-interface-vb/_static/image10.png)</span></span>

<span data-ttu-id="c8593-154">**图 4**： GridView 的只读接口已完成（[单击以查看完全大小的图像](customizing-the-data-modification-interface-vb/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="c8593-154">**Figure 4**: The GridView's Read-Only Interface is Complete ([Click to view full-size image](customizing-the-data-modification-interface-vb/_static/image12.png))</span></span>

> [!NOTE]
> <span data-ttu-id="c8593-155">如在[插入、更新和删除数据教程](an-overview-of-inserting-updating-and-deleting-data-cs.md)中所讨论的那样，启用 GridView 的视图状态（默认行为）至关重要。</span><span class="sxs-lookup"><span data-stu-id="c8593-155">As discussed in [An Overview of Inserting, Updating, and Deleting Data tutorial](an-overview-of-inserting-updating-and-deleting-data-cs.md), it is vitally important that the GridView s view state be enabled (the default behavior).</span></span> <span data-ttu-id="c8593-156">如果将 GridView `EnableViewState` 属性设置为 "`false`"，则可能会遇到使并发用户无意中删除或编辑记录的风险。</span><span class="sxs-lookup"><span data-stu-id="c8593-156">If you set the GridView s `EnableViewState` property to `false`, you run the risk of having concurrent users unintentionally deleting or editing records.</span></span> <span data-ttu-id="c8593-157">有关详细信息，请参阅[ASP.NET 2.0 GridViews/DetailsView/FormViews 的并发问题，其中支持编辑和/或删除并禁用了其视图状态](http://scottonwriting.net/sowblog/posts/10054.aspx)。</span><span class="sxs-lookup"><span data-stu-id="c8593-157">See [WARNING: Concurrency Issue with ASP.NET 2.0 GridViews/DetailsView/FormViews that Support Editing and/or Deleting and Whose View State is Disabled](http://scottonwriting.net/sowblog/posts/10054.aspx) for more information.</span></span>

## <a name="step-3-using-a-dropdownlist-for-the-category-and-supplier-editing-interfaces"></a><span data-ttu-id="c8593-158">步骤3：使用 DropDownList 作为类别和供应商编辑界面</span><span class="sxs-lookup"><span data-stu-id="c8593-158">Step 3: Using a DropDownList for the Category and Supplier Editing Interfaces</span></span>

<span data-ttu-id="c8593-159">请记住，`ProductsRow` 对象包含 `CategoryID`、`CategoryName`、`SupplierID`和 `SupplierName` 属性，这些属性提供 `Products` 数据库表中的实际外键 ID 值和 `Name` 和 `Categories` 表中的相应 `Suppliers` 值。</span><span class="sxs-lookup"><span data-stu-id="c8593-159">Recall that the `ProductsRow` object contains `CategoryID`, `CategoryName`, `SupplierID`, and `SupplierName` properties, which provide the actual foreign-key ID values in the `Products` database table and the corresponding `Name` values in the `Categories` and `Suppliers` tables.</span></span> <span data-ttu-id="c8593-160">`ProductRow`的 `CategoryID` 和 `SupplierID` 都可以从中读取和写入，而 `CategoryName` 和 `SupplierName` 属性被标记为只读。</span><span class="sxs-lookup"><span data-stu-id="c8593-160">The `ProductRow`'s `CategoryID` and `SupplierID` can both be read from and written to, while the `CategoryName` and `SupplierName` properties are marked read-only.</span></span>

<span data-ttu-id="c8593-161">由于 `CategoryName` 和 `SupplierName` 属性的只读状态，相应 BoundFields 的 `ReadOnly` 属性设置为 `True`，从而防止在编辑行时修改这些值。</span><span class="sxs-lookup"><span data-stu-id="c8593-161">Due to the read-only status of the `CategoryName` and `SupplierName` properties, the corresponding BoundFields have had their `ReadOnly` property set to `True`, preventing these values from being modified when a row is edited.</span></span> <span data-ttu-id="c8593-162">虽然我们可以将 `ReadOnly` 属性设置为 `False`，在编辑过程中将 `CategoryName` 和 `SupplierName` BoundFields 呈现为文本框，但当用户尝试更新产品时，这种方法将导致异常，因为没有 `UpdateProduct` 和 `CategoryName` 输入中采用 `SupplierName` 重载。</span><span class="sxs-lookup"><span data-stu-id="c8593-162">While we can set the `ReadOnly` property to `False`, rendering the `CategoryName` and `SupplierName` BoundFields as TextBoxes during editing, such an approach will result in an exception when the user attempts to update the product since there is no `UpdateProduct` overload that takes in `CategoryName` and `SupplierName` inputs.</span></span> <span data-ttu-id="c8593-163">事实上，我们不希望出于以下两个原因创建此类重载：</span><span class="sxs-lookup"><span data-stu-id="c8593-163">In fact, we don't want to create such an overload for two reasons:</span></span>

- <span data-ttu-id="c8593-164">`Products` 表没有 `SupplierName` 或 `CategoryName` 字段，但 `SupplierID` 和 `CategoryID`。</span><span class="sxs-lookup"><span data-stu-id="c8593-164">The `Products` table doesn't have `SupplierName` or `CategoryName` fields, but `SupplierID` and `CategoryID`.</span></span> <span data-ttu-id="c8593-165">因此，我们希望将这些特定 ID 值（而不是查找表的值）传递给方法。</span><span class="sxs-lookup"><span data-stu-id="c8593-165">Therefore, we want our method to be passed these particular ID values, not their lookup tables' values.</span></span>
- <span data-ttu-id="c8593-166">要求用户键入供应商或类别的名称小于理想的名称，因为它要求用户了解可用类别和供应商及其正确的拼写。</span><span class="sxs-lookup"><span data-stu-id="c8593-166">Requiring the user to type in the name of the supplier or category is less than ideal, as it requires the user to know the available categories and suppliers and their correct spellings.</span></span>

<span data-ttu-id="c8593-167">"供应商" 和 "类别" 字段应在处于只读模式时显示类别和供应商的名称（如同现在一样），并在编辑时提供适用选项的下拉列表。</span><span class="sxs-lookup"><span data-stu-id="c8593-167">The supplier and category fields should display the category and suppliers' names when in read-only mode (as it does now) and a drop-down list of applicable options when being edited.</span></span> <span data-ttu-id="c8593-168">使用下拉列表，最终用户可以快速查看哪些类别和供应商可供选择，并且可以更轻松地进行选择。</span><span class="sxs-lookup"><span data-stu-id="c8593-168">Using a drop-down list, the end user can quickly see what categories and suppliers are available to choose among and can more easily make their selection.</span></span>

<span data-ttu-id="c8593-169">为了提供此行为，我们需要将 `SupplierName` 和 `CategoryName` BoundFields 转换为 Templatefield，其 `ItemTemplate` 发出 `SupplierName` 和 `CategoryName` 值，其 `EditItemTemplate` 使用 DropDownList 控件列出可用类别和供应商。</span><span class="sxs-lookup"><span data-stu-id="c8593-169">To provide this behavior, we need to convert the `SupplierName` and `CategoryName` BoundFields into TemplateFields whose `ItemTemplate` emits the `SupplierName` and `CategoryName` values and whose `EditItemTemplate` uses a DropDownList control to list the available categories and suppliers.</span></span>

## <a name="adding-thecategoriesandsuppliersdropdownlists"></a><span data-ttu-id="c8593-170">添加`Categories`和`Suppliers`DropDownLists</span><span class="sxs-lookup"><span data-stu-id="c8593-170">Adding the`Categories`and`Suppliers`DropDownLists</span></span>

<span data-ttu-id="c8593-171">首先，将 "`SupplierName`" 和 "`CategoryName` BoundFields" 转换为 "Templatefield"，方法是单击 GridView 的智能标记上的 "编辑列" 链接;从左下方的列表中选择 BoundField;然后单击 "将此字段转换为 TemplateField" 链接。</span><span class="sxs-lookup"><span data-stu-id="c8593-171">Start by converting the `SupplierName` and `CategoryName` BoundFields into TemplateFields by: clicking on the Edit Columns link from the GridView's smart tag; selecting the BoundField from the list in the lower left; and clicking the "Convert this field into a TemplateField" link.</span></span> <span data-ttu-id="c8593-172">转换过程将创建具有 `ItemTemplate` 和 `EditItemTemplate`的 TemplateField，如下面的声明性语法所示：</span><span class="sxs-lookup"><span data-stu-id="c8593-172">The conversion process will create a TemplateField with both an `ItemTemplate` and an `EditItemTemplate`, as shown in the declarative syntax below:</span></span>

[!code-aspx[Main](customizing-the-data-modification-interface-vb/samples/sample4.aspx)]

<span data-ttu-id="c8593-173">由于 BoundField 被标记为只读，因此 `ItemTemplate` 和 `EditItemTemplate` 都包含一个标签 Web 控件，其 `Text` 属性绑定到相应的数据字段（在上述语法中为`CategoryName`）。</span><span class="sxs-lookup"><span data-stu-id="c8593-173">Since the BoundField was marked as read-only, both the `ItemTemplate` and `EditItemTemplate` contain a Label Web control whose `Text` property is bound to the applicable data field (`CategoryName`, in the syntax above).</span></span> <span data-ttu-id="c8593-174">需要修改 `EditItemTemplate`，并将标签 Web 控件替换为 DropDownList 控件。</span><span class="sxs-lookup"><span data-stu-id="c8593-174">We need to modify the `EditItemTemplate`, replacing the Label Web control with a DropDownList control.</span></span>

<span data-ttu-id="c8593-175">如前面的教程中所示，可以通过设计器或直接从声明性语法编辑模板。</span><span class="sxs-lookup"><span data-stu-id="c8593-175">As we've seen in previous tutorials, the template can be edited through the Designer or directly from the declarative syntax.</span></span> <span data-ttu-id="c8593-176">若要通过设计器对其进行编辑，请从 GridView 的智能标记中单击 "编辑模板" 链接，然后选择使用 "类别" 字段的 `EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="c8593-176">To edit it through the Designer, click on the Edit Templates link from the GridView's smart tag and choose to work with the Category field's `EditItemTemplate`.</span></span> <span data-ttu-id="c8593-177">删除标签 Web 控件，并将其替换为 DropDownList 控件，并将 DropDownList 的 ID 属性设置为 `Categories`。</span><span class="sxs-lookup"><span data-stu-id="c8593-177">Remove the Label Web control and replace it with a DropDownList control, setting the DropDownList's ID property to `Categories`.</span></span>

<span data-ttu-id="c8593-178">[![删除文本框并将 DropDownList 添加到 EditItemTemplate](customizing-the-data-modification-interface-vb/_static/image14.png)](customizing-the-data-modification-interface-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="c8593-178">[![Remove the TexBox and Add a DropDownList to the EditItemTemplate](customizing-the-data-modification-interface-vb/_static/image14.png)](customizing-the-data-modification-interface-vb/_static/image13.png)</span></span>

<span data-ttu-id="c8593-179">**图 5**：删除文本框并将 DropDownList 添加到 `EditItemTemplate` （[单击查看完全大小的图像](customizing-the-data-modification-interface-vb/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="c8593-179">**Figure 5**: Remove the TexBox and Add a DropDownList to the `EditItemTemplate` ([Click to view full-size image](customizing-the-data-modification-interface-vb/_static/image15.png))</span></span>

<span data-ttu-id="c8593-180">接下来，需要使用可用类别来填充 DropDownList。</span><span class="sxs-lookup"><span data-stu-id="c8593-180">We next need to populate the DropDownList with the available categories.</span></span> <span data-ttu-id="c8593-181">在 DropDownList 的智能标记中单击 "选择数据源" 链接，并选择创建名为 `CategoriesDataSource`的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="c8593-181">Click on the Choose Data Source link from the DropDownList's smart tag and opt to create a new ObjectDataSource named `CategoriesDataSource`.</span></span>

<span data-ttu-id="c8593-182">[![创建一个名为 CategoriesDataSource 的新 ObjectDataSource 控件](customizing-the-data-modification-interface-vb/_static/image17.png)](customizing-the-data-modification-interface-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="c8593-182">[![Create a New ObjectDataSource Control Named CategoriesDataSource](customizing-the-data-modification-interface-vb/_static/image17.png)](customizing-the-data-modification-interface-vb/_static/image16.png)</span></span>

<span data-ttu-id="c8593-183">**图 6**：创建名为 `CategoriesDataSource` 的新 ObjectDataSource 控件（[单击以查看完全大小的图像](customizing-the-data-modification-interface-vb/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="c8593-183">**Figure 6**: Create a New ObjectDataSource Control Named `CategoriesDataSource` ([Click to view full-size image](customizing-the-data-modification-interface-vb/_static/image18.png))</span></span>

<span data-ttu-id="c8593-184">若要让此 ObjectDataSource 返回所有类别，请将其绑定到 `CategoriesBLL` 类的 `GetCategories()` 方法。</span><span class="sxs-lookup"><span data-stu-id="c8593-184">To have this ObjectDataSource return all of the categories, bind it to the `CategoriesBLL` class's `GetCategories()` method.</span></span>

<span data-ttu-id="c8593-185">[![将 ObjectDataSource 绑定到 CategoriesBLL 的 GetCategories （）方法](customizing-the-data-modification-interface-vb/_static/image20.png)](customizing-the-data-modification-interface-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="c8593-185">[![Bind the ObjectDataSource to the CategoriesBLL's GetCategories() Method](customizing-the-data-modification-interface-vb/_static/image20.png)](customizing-the-data-modification-interface-vb/_static/image19.png)</span></span>

<span data-ttu-id="c8593-186">**图 7**：将 ObjectDataSource 绑定到 `CategoriesBLL`的 `GetCategories()` 方法（[单击以查看完全大小的映像](customizing-the-data-modification-interface-vb/_static/image21.png)）</span><span class="sxs-lookup"><span data-stu-id="c8593-186">**Figure 7**: Bind the ObjectDataSource to the `CategoriesBLL`'s `GetCategories()` Method ([Click to view full-size image](customizing-the-data-modification-interface-vb/_static/image21.png))</span></span>

<span data-ttu-id="c8593-187">最后，配置 DropDownList 的设置，使 "`CategoryName`" 字段显示在每个 DropDownList `ListItem` 中，并使用用作值 `CategoryID` 字段。</span><span class="sxs-lookup"><span data-stu-id="c8593-187">Finally, configure the DropDownList's settings such that the `CategoryName` field is displayed in each DropDownList `ListItem` with the `CategoryID` field used as the value.</span></span>

<span data-ttu-id="c8593-188">[![显示 "类别名称" 字段，并使用 "类别 Id" 作为值](customizing-the-data-modification-interface-vb/_static/image23.png)](customizing-the-data-modification-interface-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="c8593-188">[![Have the CategoryName Field Displayed and the CategoryID Used as the Value](customizing-the-data-modification-interface-vb/_static/image23.png)](customizing-the-data-modification-interface-vb/_static/image22.png)</span></span>

<span data-ttu-id="c8593-189">**图 8**：显示 "`CategoryName`" 字段并将 `CategoryID` 用作值（[单击以查看完全大小的图像](customizing-the-data-modification-interface-vb/_static/image24.png)）</span><span class="sxs-lookup"><span data-stu-id="c8593-189">**Figure 8**: Have the `CategoryName` Field Displayed and the `CategoryID` Used as the Value ([Click to view full-size image](customizing-the-data-modification-interface-vb/_static/image24.png))</span></span>

<span data-ttu-id="c8593-190">进行这些更改后，`CategoryName` TemplateField 中的 `EditItemTemplate` 的声明性标记将同时包含 DropDownList 和 ObjectDataSource：</span><span class="sxs-lookup"><span data-stu-id="c8593-190">After making these changes the declarative markup for the `EditItemTemplate` in the `CategoryName` TemplateField will include both a DropDownList and an ObjectDataSource:</span></span>

[!code-aspx[Main](customizing-the-data-modification-interface-vb/samples/sample5.aspx)]

> [!NOTE]
> <span data-ttu-id="c8593-191">`EditItemTemplate` 中的 DropDownList 必须启用其视图状态。</span><span class="sxs-lookup"><span data-stu-id="c8593-191">The DropDownList in the `EditItemTemplate` must have its view state enabled.</span></span> <span data-ttu-id="c8593-192">我们很快会将 databinding 语法添加到 DropDownList 的声明性语法和数据绑定命令，例如 `Eval()` 和 `Bind()` 只能出现在启用了视图状态的控件中。</span><span class="sxs-lookup"><span data-stu-id="c8593-192">We will soon add databinding syntax to the DropDownList's declarative syntax and databinding commands like `Eval()` and `Bind()` can only appear in controls whose view state is enabled.</span></span>

<span data-ttu-id="c8593-193">重复上述步骤，将名为 `Suppliers` 的 DropDownList 添加到 `SupplierName` TemplateField 的 `EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="c8593-193">Repeat these steps to add a DropDownList named `Suppliers` to the `SupplierName` TemplateField's `EditItemTemplate`.</span></span> <span data-ttu-id="c8593-194">这涉及到将 DropDownList 添加到 `EditItemTemplate` 并创建另一个 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="c8593-194">This will involve adding a DropDownList to the `EditItemTemplate` and creating another ObjectDataSource.</span></span> <span data-ttu-id="c8593-195">但 `Suppliers` DropDownList 的 ObjectDataSource 应配置为调用 `SuppliersBLL` 类的 `GetSuppliers()` 方法。</span><span class="sxs-lookup"><span data-stu-id="c8593-195">The `Suppliers` DropDownList's ObjectDataSource, however, should be configured to invoke the `SuppliersBLL` class's `GetSuppliers()` method.</span></span> <span data-ttu-id="c8593-196">此外，配置 `Suppliers` DropDownList 以显示 `CompanyName` 字段，并使用 `SupplierID` 字段作为其 `ListItem` 的值。</span><span class="sxs-lookup"><span data-stu-id="c8593-196">Additionally, configure the `Suppliers` DropDownList to display the `CompanyName` field and use the `SupplierID` field as the value for its `ListItem` s.</span></span>

<span data-ttu-id="c8593-197">将 DropDownLists 添加到两个 `EditItemTemplate` "后，在浏览器中加载页面，并单击 Chef Anton 的 Cajun Seasoning product 的" 编辑 "按钮。</span><span class="sxs-lookup"><span data-stu-id="c8593-197">After adding the DropDownLists to the two `EditItemTemplate` s, load the page in a browser and click the Edit button for the Chef Anton's Cajun Seasoning product.</span></span> <span data-ttu-id="c8593-198">如图9所示，该产品的类别和供应商列呈现为下拉列表，其中包含可供选择的可用类别和供应商。</span><span class="sxs-lookup"><span data-stu-id="c8593-198">As Figure 9 shows, the product's category and supplier columns are rendered as drop-down lists containing the available categories and suppliers to choose from.</span></span> <span data-ttu-id="c8593-199">但请注意，在默认情况下，这两个下拉列表中的*第一*项处于选中状态（类别的饮料和现 Liquids 作为供应商），尽管 Chef Anton 的 Cajun Seasoning 是由新奥尔良 Condiment Cajun 提供的乐趣。</span><span class="sxs-lookup"><span data-stu-id="c8593-199">However, note that the *first* items in both drop-down lists are selected by default (Beverages for the category and Exotic Liquids as the supplier), even though Chef Anton's Cajun Seasoning is a Condiment supplied by New Orleans Cajun Delights.</span></span>

<span data-ttu-id="c8593-200">[默认情况下，下拉列表中的第一项 ![处于选中状态](customizing-the-data-modification-interface-vb/_static/image26.png)](customizing-the-data-modification-interface-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="c8593-200">[![The First Item in the Drop-Down Lists is Selected by Default](customizing-the-data-modification-interface-vb/_static/image26.png)](customizing-the-data-modification-interface-vb/_static/image25.png)</span></span>

<span data-ttu-id="c8593-201">**图 9**：默认情况下，下拉列表中的第一项处于选中状态（[单击以查看完全大小的图像](customizing-the-data-modification-interface-vb/_static/image27.png)）</span><span class="sxs-lookup"><span data-stu-id="c8593-201">**Figure 9**: The First Item in the Drop-Down Lists is Selected by Default ([Click to view full-size image](customizing-the-data-modification-interface-vb/_static/image27.png))</span></span>

<span data-ttu-id="c8593-202">此外，如果单击 "更新"，会发现产品的 `CategoryID` 和 `SupplierID` 值设置为 "`NULL`"。</span><span class="sxs-lookup"><span data-stu-id="c8593-202">Furthermore, if you click Update, you'll find that the product's `CategoryID` and `SupplierID` values are set to `NULL`.</span></span> <span data-ttu-id="c8593-203">这两种不需要的行为都是因为 `EditItemTemplate` 中的 DropDownLists 未绑定到基础产品数据中的任何数据字段。</span><span class="sxs-lookup"><span data-stu-id="c8593-203">Both of these undesired behaviors are caused because the DropDownLists in the `EditItemTemplate` s are not bound to any data fields from the underlying product data.</span></span>

## <a name="binding-the-dropdownlists-to-thecategoryidandsupplieriddata-fields"></a><span data-ttu-id="c8593-204">将 DropDownLists 绑定到`CategoryID`和`SupplierID`数据字段</span><span class="sxs-lookup"><span data-stu-id="c8593-204">Binding the DropDownLists to the`CategoryID`and`SupplierID`Data Fields</span></span>

<span data-ttu-id="c8593-205">为了使已编辑的产品的类别和供应商下拉列表设置为适当的值，并在单击 "更新" 后将这些值发回到 BLL 的 `UpdateProduct` 方法，我们需要使用双向数据绑定将 DropDownLists 的 `SelectedValue` 属性绑定到 `CategoryID` 和 `SupplierID` 数据字段。</span><span class="sxs-lookup"><span data-stu-id="c8593-205">In order to have the edited product's category and supplier drop-down lists set to the appropriate values and to have these values sent back to the BLL's `UpdateProduct` method upon clicking Update, we need to bind the DropDownLists' `SelectedValue` properties to the `CategoryID` and `SupplierID` data fields using two-way databinding.</span></span> <span data-ttu-id="c8593-206">若要通过 `Categories` DropDownList 来实现此目的，可以直接将 `SelectedValue='<%# Bind("CategoryID") %>'` 添加到声明性语法。</span><span class="sxs-lookup"><span data-stu-id="c8593-206">To accomplish this with the `Categories` DropDownList, you can add `SelectedValue='<%# Bind("CategoryID") %>'` directly to the declarative syntax.</span></span>

<span data-ttu-id="c8593-207">或者，你可以通过在设计器中编辑模板并单击 DropDownList 的智能标记的 "编辑 databinding" 链接来设置 DropDownList 的绑定。</span><span class="sxs-lookup"><span data-stu-id="c8593-207">Alternatively, you can set the DropDownList's databindings by editing the template through the Designer and clicking the Edit DataBindings link from the DropDownList's smart tag.</span></span> <span data-ttu-id="c8593-208">接下来，指示应使用双向数据绑定将 `SelectedValue` 属性绑定到 `CategoryID` 字段（请参阅图10）。</span><span class="sxs-lookup"><span data-stu-id="c8593-208">Next, indicate that the `SelectedValue` property should be bound to the `CategoryID` field using two-way databinding (see Figure 10).</span></span> <span data-ttu-id="c8593-209">重复声明性或设计器过程以将 `SupplierID` 数据字段绑定到 `Suppliers` DropDownList。</span><span class="sxs-lookup"><span data-stu-id="c8593-209">Repeat either the declarative or Designer process to bind the `SupplierID` data field to the `Suppliers` DropDownList.</span></span>

<span data-ttu-id="c8593-210">[![使用双向数据绑定将类别 Id 绑定到 DropDownList 的 SelectedValue 属性](customizing-the-data-modification-interface-vb/_static/image29.png)](customizing-the-data-modification-interface-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="c8593-210">[![Bind the CategoryID to the DropDownList's SelectedValue Property Using Two-Way Databinding](customizing-the-data-modification-interface-vb/_static/image29.png)](customizing-the-data-modification-interface-vb/_static/image28.png)</span></span>

<span data-ttu-id="c8593-211">**图 10**：使用双向数据绑定将 `CategoryID` 绑定到 DropDownList 的 `SelectedValue` 属性（[单击以查看完全大小的图像](customizing-the-data-modification-interface-vb/_static/image30.png)）</span><span class="sxs-lookup"><span data-stu-id="c8593-211">**Figure 10**: Bind the `CategoryID` to the DropDownList's `SelectedValue` Property Using Two-Way Databinding ([Click to view full-size image](customizing-the-data-modification-interface-vb/_static/image30.png))</span></span>

<span data-ttu-id="c8593-212">将绑定应用于这两个 DropDownLists 的 `SelectedValue` 属性后，编辑后的产品的 "类别" 和 "供应商" 列将默认为当前产品的值。</span><span class="sxs-lookup"><span data-stu-id="c8593-212">Once the bindings have been applied to the `SelectedValue` properties of the two DropDownLists, the edited product's category and supplier columns will default to the current product's values.</span></span> <span data-ttu-id="c8593-213">单击 "更新" 后，所选下拉列表项的 `CategoryID` 和 `SupplierID` 值将传递给 `UpdateProduct` 方法。</span><span class="sxs-lookup"><span data-stu-id="c8593-213">Upon clicking Update, the `CategoryID` and `SupplierID` values of the selected drop-down list item will be passed to the `UpdateProduct` method.</span></span> <span data-ttu-id="c8593-214">图11显示了数据绑定语句添加后的教程;请注意，Chef Anton 的 Cajun Seasoning 的选定下拉列表项如何正确 Condiment Cajun 和新奥尔良乐趣。</span><span class="sxs-lookup"><span data-stu-id="c8593-214">Figure 11 shows the tutorial after the databinding statements have been added; note how the selected drop-down list items for Chef Anton's Cajun Seasoning are correctly Condiment and New Orleans Cajun Delights.</span></span>

<span data-ttu-id="c8593-215">[默认情况下，将选择所编辑的产品的当前类别和供应商值 ![](customizing-the-data-modification-interface-vb/_static/image32.png)](customizing-the-data-modification-interface-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="c8593-215">[![The Edited Product's Current Category and Supplier Values are Selected by Default](customizing-the-data-modification-interface-vb/_static/image32.png)](customizing-the-data-modification-interface-vb/_static/image31.png)</span></span>

<span data-ttu-id="c8593-216">**图 11**：默认情况下已编辑的产品的当前类别和供应商值处于选中状态（[单击以查看完全大小的图像](customizing-the-data-modification-interface-vb/_static/image33.png)）</span><span class="sxs-lookup"><span data-stu-id="c8593-216">**Figure 11**: The Edited Product's Current Category and Supplier Values are Selected by Default ([Click to view full-size image](customizing-the-data-modification-interface-vb/_static/image33.png))</span></span>

## <a name="handlingnullvalues"></a><span data-ttu-id="c8593-217">处理`NULL`值</span><span class="sxs-lookup"><span data-stu-id="c8593-217">Handling`NULL`Values</span></span>

<span data-ttu-id="c8593-218">`Products` 表中的 `CategoryID` 和 `SupplierID` 列可以 `NULL`，但 `EditItemTemplate` 中的 DropDownLists 不包含用于表示 `NULL` 值的列表项。</span><span class="sxs-lookup"><span data-stu-id="c8593-218">The `CategoryID` and `SupplierID` columns in the `Products` table can be `NULL`, yet the DropDownLists in the `EditItemTemplate` s don't include a list item to represent a `NULL` value.</span></span> <span data-ttu-id="c8593-219">这有两个后果：</span><span class="sxs-lookup"><span data-stu-id="c8593-219">This has two consequences:</span></span>

- <span data-ttu-id="c8593-220">用户无法使用我们的界面将产品的类别或供应商从非`NULL` 值更改为 `NULL` 一个</span><span class="sxs-lookup"><span data-stu-id="c8593-220">User cannot use our interface to change a product's category or supplier from a non-`NULL` value to a `NULL` one</span></span>
- <span data-ttu-id="c8593-221">如果产品有 `NULL` `CategoryID` 或 `SupplierID`，则单击 "编辑" 按钮将导致异常。</span><span class="sxs-lookup"><span data-stu-id="c8593-221">If a product has a `NULL` `CategoryID` or `SupplierID`, clicking the Edit button will result in an exception.</span></span> <span data-ttu-id="c8593-222">这是因为 `Bind()` 语句中 `CategoryID` （或 `SupplierID`）返回的 `NULL` 值未映射到 DropDownList 中的值（在其 `SelectedValue` 属性设置为*不*在其列表项集合中的值时，DropDownList 会引发异常）。</span><span class="sxs-lookup"><span data-stu-id="c8593-222">This is because the `NULL` value returned by `CategoryID` (or `SupplierID`) in the `Bind()` statement does not map to a value in the DropDownList (the DropDownList throws an exception when its `SelectedValue` property is set to a value *not* in its collection of list items).</span></span>

<span data-ttu-id="c8593-223">为了支持 `NULL` `CategoryID` 和 `SupplierID` 值，我们需要向每个 DropDownList 添加另一个 `ListItem` 来表示 `NULL` 值。</span><span class="sxs-lookup"><span data-stu-id="c8593-223">In order to support `NULL` `CategoryID` and `SupplierID` values, we need to add another `ListItem` to each DropDownList to represent the `NULL` value.</span></span> <span data-ttu-id="c8593-224">在[使用 DropDownList 教程进行主/详细筛选](../masterdetail/master-detail-filtering-with-a-dropdownlist-cs.md)的教程中，我们看到了如何将其他 `ListItem` 添加到数据绑定 DropDownList，这涉及到将 DropDownList 的 `AppendDataBoundItems` 属性设置为 `True`，并手动添加其他 `ListItem`。</span><span class="sxs-lookup"><span data-stu-id="c8593-224">In the [Master/Detail Filtering With a DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-cs.md) tutorial, we saw how to add an additional `ListItem` to a databound DropDownList, which involved setting the DropDownList's `AppendDataBoundItems` property to `True` and manually adding the additional `ListItem`.</span></span> <span data-ttu-id="c8593-225">但在之前的教程中，我们添加了一个 `Value` `-1`的 `ListItem`。</span><span class="sxs-lookup"><span data-stu-id="c8593-225">In that previous tutorial, however, we added a `ListItem` with a `Value` of `-1`.</span></span> <span data-ttu-id="c8593-226">但是，ASP.NET 中的数据绑定逻辑会自动将空字符串转换为 `NULL` 的值，反之亦然。</span><span class="sxs-lookup"><span data-stu-id="c8593-226">The databinding logic in ASP.NET, however, will automatically convert a blank string to a `NULL` value and vice-a-versa.</span></span> <span data-ttu-id="c8593-227">因此，在本教程中，我们希望 `ListItem`的 `Value` 为空字符串。</span><span class="sxs-lookup"><span data-stu-id="c8593-227">Therefore, for this tutorial we want the `ListItem`'s `Value` to be an empty string.</span></span>

<span data-ttu-id="c8593-228">首先，将 DropDownLists "`AppendDataBoundItems` 属性设置为" `True`"。</span><span class="sxs-lookup"><span data-stu-id="c8593-228">Start by setting both DropDownLists' `AppendDataBoundItems` property to `True`.</span></span> <span data-ttu-id="c8593-229">接下来，通过将以下 `<asp:ListItem>` 元素添加到每个 DropDownList 来添加 `NULL` `ListItem`，以便声明性标记如下所示：</span><span class="sxs-lookup"><span data-stu-id="c8593-229">Next, add the `NULL` `ListItem` by adding the following `<asp:ListItem>` element to each DropDownList so that the declarative markup looks like:</span></span>

[!code-aspx[Main](customizing-the-data-modification-interface-vb/samples/sample6.aspx)]

<span data-ttu-id="c8593-230">我已经选择使用 "（无）" 作为此 `ListItem`的文本值，但如果您愿意，也可以将其更改为空白字符串。</span><span class="sxs-lookup"><span data-stu-id="c8593-230">I've chosen to use "(None)" as the Text value for this `ListItem`, but you can change it to also be a blank string if you'd like.</span></span>

> [!NOTE]
> <span data-ttu-id="c8593-231">正如我们*使用 DropDownList 教程在主/详细信息筛选*中看到的那样，可以通过在 "属性窗口" 中单击 DropDownList 的 `Items` 属性（将显示 `ListItem` 集合编辑器），将 `ListItem` 添加到 DropDownList 中。</span><span class="sxs-lookup"><span data-stu-id="c8593-231">As we saw in the *Master/Detail Filtering With a DropDownList* tutorial, `ListItem` s can be added to a DropDownList through the Designer by clicking on the DropDownList's `Items` property in the Properties window (which will display the `ListItem` Collection Editor).</span></span> <span data-ttu-id="c8593-232">但是，请务必通过声明性语法将 `NULL` `ListItem` 添加到本教程。</span><span class="sxs-lookup"><span data-stu-id="c8593-232">However, be sure to add the `NULL` `ListItem` for this tutorial through the declarative syntax.</span></span> <span data-ttu-id="c8593-233">如果使用 `ListItem` 集合编辑器，则生成的声明性语法将在分配空字符串时完全省略 `Value` 设置，创建类似于以下内容的声明性标记： `<asp:ListItem>(None)</asp:ListItem>`。</span><span class="sxs-lookup"><span data-stu-id="c8593-233">If you use the `ListItem` Collection Editor, the generated declarative syntax will omit the `Value` setting altogether when assigned a blank string, creating declarative markup like: `<asp:ListItem>(None)</asp:ListItem>`.</span></span> <span data-ttu-id="c8593-234">虽然这看起来可能无害，但缺少值会导致 DropDownList 使用 `Text` 属性值。</span><span class="sxs-lookup"><span data-stu-id="c8593-234">While this may look harmless, the missing Value causes the DropDownList to use the `Text` property value in its place.</span></span> <span data-ttu-id="c8593-235">这意味着，如果选择此 `NULL` `ListItem`，则会将值 "（无）" 分配给 `CategoryID`，这将导致异常。</span><span class="sxs-lookup"><span data-stu-id="c8593-235">That means that if this `NULL` `ListItem` is selected, the value "(None)" will be attempted to be assigned to the `CategoryID`, which will result in an exception.</span></span> <span data-ttu-id="c8593-236">通过显式设置 `Value=""`，选择 `NULL` `ListItem` 时，`NULL` 值将分配给 `CategoryID`。</span><span class="sxs-lookup"><span data-stu-id="c8593-236">By explicitly setting `Value=""`, a `NULL` value will be assigned to `CategoryID` when the `NULL` `ListItem` is selected.</span></span>

<span data-ttu-id="c8593-237">为 "供应商 DropDownList" 重复这些步骤。</span><span class="sxs-lookup"><span data-stu-id="c8593-237">Repeat these steps for the Suppliers DropDownList.</span></span>

<span data-ttu-id="c8593-238">使用此附加 `ListItem`，编辑界面现在可以将 `NULL` 值分配给产品的 `CategoryID` 和 `SupplierID` 字段，如图12所示。</span><span class="sxs-lookup"><span data-stu-id="c8593-238">With this additional `ListItem`, the editing interface can now assign `NULL` values to a Product's `CategoryID` and `SupplierID` fields, as shown in Figure 12.</span></span>

<span data-ttu-id="c8593-239">[![选择 "（无）" 为产品的类别或供应商分配 NULL 值](customizing-the-data-modification-interface-vb/_static/image35.png)](customizing-the-data-modification-interface-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="c8593-239">[![Choose (None) to Assign a NULL Value for a Product's Category or Supplier](customizing-the-data-modification-interface-vb/_static/image35.png)](customizing-the-data-modification-interface-vb/_static/image34.png)</span></span>

<span data-ttu-id="c8593-240">**图 12**：选择 "（无）" 可为产品的类别或供应商分配 `NULL` 值（[单击查看全尺寸图像](customizing-the-data-modification-interface-vb/_static/image36.png)）</span><span class="sxs-lookup"><span data-stu-id="c8593-240">**Figure 12**: Choose (None) to Assign a `NULL` Value for a Product's Category or Supplier ([Click to view full-size image](customizing-the-data-modification-interface-vb/_static/image36.png))</span></span>

## <a name="step-4-using-radiobuttons-for-the-discontinued-status"></a><span data-ttu-id="c8593-241">步骤4：将单选按钮用于中止状态</span><span class="sxs-lookup"><span data-stu-id="c8593-241">Step 4: Using RadioButtons for the Discontinued Status</span></span>

<span data-ttu-id="c8593-242">当前，使用 CheckBoxField 表示产品的 `Discontinued` 数据字段，该字段为只读行呈现禁用的复选框，并为正在编辑的行呈现 "已启用" 复选框。</span><span class="sxs-lookup"><span data-stu-id="c8593-242">Currently the products' `Discontinued` data field is expressed using a CheckBoxField, which renders a disabled checkbox for the read-only rows and an enabled checkbox for the row being edited.</span></span> <span data-ttu-id="c8593-243">虽然此用户界面通常适用，但如果需要，可以使用 TemplateField 对其进行自定义。</span><span class="sxs-lookup"><span data-stu-id="c8593-243">While this user interface is often suitable, we can customize it if needed using a TemplateField.</span></span> <span data-ttu-id="c8593-244">对于本教程，让我们将 CheckBoxField 更改为使用 RadioButtonList 控件的 TemplateField，该控件具有两个选项 "活动" 和 "已停用"，用户可以从中指定产品的 `Discontinued` 值。</span><span class="sxs-lookup"><span data-stu-id="c8593-244">For this tutorial, let's change the CheckBoxField into a TemplateField that uses a RadioButtonList control with two options "Active" and "Discontinued" from which the user can specify the product's `Discontinued` value.</span></span>

<span data-ttu-id="c8593-245">首先将 `Discontinued` CheckBoxField 转换为 TemplateField，这将创建具有 `ItemTemplate` 和 `EditItemTemplate`的 TemplateField。</span><span class="sxs-lookup"><span data-stu-id="c8593-245">Start by converting the `Discontinued` CheckBoxField into a TemplateField, which will create a TemplateField with an `ItemTemplate` and `EditItemTemplate`.</span></span> <span data-ttu-id="c8593-246">这两个模板都包含一个复选框，其 `Checked` 属性绑定到 `Discontinued` 数据字段，两者的唯一区别在于 `ItemTemplate`的复选框的 `Enabled` 属性设置为 `False`。</span><span class="sxs-lookup"><span data-stu-id="c8593-246">Both templates include a CheckBox with its `Checked` property bound to the `Discontinued` data field, the only difference between the two being that the `ItemTemplate`'s CheckBox's `Enabled` property is set to `False`.</span></span>

<span data-ttu-id="c8593-247">用 RadioButtonList 控件替换 `ItemTemplate` 和 `EditItemTemplate` 中的复选框，同时将两个 RadioButtonLists 的 `ID` 属性都设置为 `DiscontinuedChoice`。</span><span class="sxs-lookup"><span data-stu-id="c8593-247">Replace the CheckBox in both the `ItemTemplate` and `EditItemTemplate` with a RadioButtonList control, setting both RadioButtonLists' `ID` properties to `DiscontinuedChoice`.</span></span> <span data-ttu-id="c8593-248">接下来，指示 RadioButtonLists 应包含两个单选按钮，其中一个标记为 "活动"，其值为 "False"，另一个标记为 "已停用"，值为 "True"。</span><span class="sxs-lookup"><span data-stu-id="c8593-248">Next, indicate that the RadioButtonLists should each contain two radio buttons, one labeled "Active" with a value of "False" and one labeled "Discontinued" with a value of "True".</span></span> <span data-ttu-id="c8593-249">若要实现此目的，可以直接通过声明性语法输入 `<asp:ListItem>` 元素，也可以使用设计器中的 "`ListItem` 集合编辑器"。</span><span class="sxs-lookup"><span data-stu-id="c8593-249">To accomplish this you can either enter the `<asp:ListItem>` elements in directly through the declarative syntax or use the `ListItem` Collection Editor from the Designer.</span></span> <span data-ttu-id="c8593-250">图13在指定了两个单选按钮选项后，显示了 "`ListItem` 集合编辑器"。</span><span class="sxs-lookup"><span data-stu-id="c8593-250">Figure 13 shows the `ListItem` Collection Editor after the two radio button options have been specified.</span></span>

<span data-ttu-id="c8593-251">[![向 RadioButtonList 添加主动和废止选项](customizing-the-data-modification-interface-vb/_static/image38.png)](customizing-the-data-modification-interface-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="c8593-251">[![Add Active and Discontinued Options to the RadioButtonList](customizing-the-data-modification-interface-vb/_static/image38.png)](customizing-the-data-modification-interface-vb/_static/image37.png)</span></span>

<span data-ttu-id="c8593-252">**图 13**：向 RadioButtonList 添加主动和废止选项（[单击以查看完全大小的映像](customizing-the-data-modification-interface-vb/_static/image39.png)）</span><span class="sxs-lookup"><span data-stu-id="c8593-252">**Figure 13**: Add Active and Discontinued Options to the RadioButtonList ([Click to view full-size image](customizing-the-data-modification-interface-vb/_static/image39.png))</span></span>

<span data-ttu-id="c8593-253">由于 `ItemTemplate` 中的 RadioButtonList 不能是可编辑的，因此请将其 `Enabled` 属性设置为 `False`，并将 `Enabled` 属性保留为 `True` （默认值），以 `EditItemTemplate`中的 RadioButtonList。</span><span class="sxs-lookup"><span data-stu-id="c8593-253">Since the RadioButtonList in the `ItemTemplate` shouldn't be editable, set its `Enabled` property to `False`, leaving the `Enabled` property to `True` (the default) for the RadioButtonList in the `EditItemTemplate`.</span></span> <span data-ttu-id="c8593-254">这会使未编辑的行中的单选按钮成为只读的，但允许用户更改已编辑行的单选按钮值。</span><span class="sxs-lookup"><span data-stu-id="c8593-254">This will make the radio buttons in the non-edited row as read-only, but will allow the user to change the RadioButton values for the edited row.</span></span>

<span data-ttu-id="c8593-255">我们仍需要分配 RadioButtonList 控件的 `SelectedValue` 属性，以便根据产品的 `Discontinued` 数据字段选择相应的单选按钮。</span><span class="sxs-lookup"><span data-stu-id="c8593-255">We still need to assign the RadioButtonList controls' `SelectedValue` properties so that the appropriate radio button is selected based upon the product's `Discontinued` data field.</span></span> <span data-ttu-id="c8593-256">与本教程前面所述的 DropDownLists 一样，此数据绑定语法可以直接添加到声明性标记中，也可以通过 RadioButtonLists 的智能标记中的 "编辑数据绑定" 链接添加。</span><span class="sxs-lookup"><span data-stu-id="c8593-256">As with the DropDownLists examined earlier in this tutorial, this databinding syntax can either be added directly into the declarative markup or through the Edit DataBindings link in the RadioButtonLists' smart tags.</span></span>

<span data-ttu-id="c8593-257">添加这两个 RadioButtonLists 并对其进行配置后，`Discontinued` TemplateField 的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="c8593-257">After adding the two RadioButtonLists and configuring them, the `Discontinued` TemplateField's declarative markup should look like:</span></span>

[!code-aspx[Main](customizing-the-data-modification-interface-vb/samples/sample7.aspx)]

<span data-ttu-id="c8593-258">进行这些更改后，`Discontinued` 列已从复选框列表转换为单选按钮对列表（参见图14）。</span><span class="sxs-lookup"><span data-stu-id="c8593-258">With these changes, the `Discontinued` column has been transformed from a list of checkboxes to a list of radio button pairs (see Figure 14).</span></span> <span data-ttu-id="c8593-259">编辑产品时，将选择相应的单选按钮，然后可以通过选择 "其他" 单选按钮并单击 "更新" 来更新产品的已中止状态。</span><span class="sxs-lookup"><span data-stu-id="c8593-259">When editing a product, the appropriate radio button is selected and the product's discontinued status can be updated by selecting the other radio button and clicking Update.</span></span>

<span data-ttu-id="c8593-260">[![中止的复选框已被单选按钮对替换](customizing-the-data-modification-interface-vb/_static/image41.png)](customizing-the-data-modification-interface-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="c8593-260">[![The Discontinued CheckBoxes Have Been Replaced by Radio Button Pairs](customizing-the-data-modification-interface-vb/_static/image41.png)](customizing-the-data-modification-interface-vb/_static/image40.png)</span></span>

<span data-ttu-id="c8593-261">**图 14**：停用的复选框已被单选按钮对替代（[单击以查看完全大小的图像](customizing-the-data-modification-interface-vb/_static/image42.png)）</span><span class="sxs-lookup"><span data-stu-id="c8593-261">**Figure 14**: The Discontinued CheckBoxes Have Been Replaced by Radio Button Pairs ([Click to view full-size image](customizing-the-data-modification-interface-vb/_static/image42.png))</span></span>

> [!NOTE]
> <span data-ttu-id="c8593-262">由于 `Products` 数据库中的 `Discontinued` 列不能具有 `NULL` 值，因此我们无需担心捕获接口中的 `NULL` 信息。</span><span class="sxs-lookup"><span data-stu-id="c8593-262">Since the `Discontinued` column in the `Products` database cannot have `NULL` values, we do not need to worry about capturing `NULL` information in the interface.</span></span> <span data-ttu-id="c8593-263">但是，如果 `Discontinued` 列可以包含 `NULL` 值，我们想要将第三个单选按钮添加到列表中，将其 `Value` 设置为空字符串（`Value=""`），就像类别和供应 DropDownLists 一样。</span><span class="sxs-lookup"><span data-stu-id="c8593-263">If, however, `Discontinued` column could contain `NULL` values we'd want to add a third radio button to the list with its `Value` set to an empty string (`Value=""`), just like with the category and supplier DropDownLists.</span></span>

## <a name="summary"></a><span data-ttu-id="c8593-264">摘要</span><span class="sxs-lookup"><span data-stu-id="c8593-264">Summary</span></span>

<span data-ttu-id="c8593-265">尽管 BoundField 和 CheckBoxField 会自动呈现只读、编辑和插入界面，但它们缺乏自定义功能。</span><span class="sxs-lookup"><span data-stu-id="c8593-265">While the BoundField and CheckBoxField automatically render read-only, editing, and inserting interfaces, they lack the ability for customization.</span></span> <span data-ttu-id="c8593-266">但通常，我们需要自定义编辑或插入界面，可能会添加验证控件（如前面教程中所述）或自定义数据收集用户界面（如本教程中所述）。</span><span class="sxs-lookup"><span data-stu-id="c8593-266">Often, though, we'll need to customize the editing or inserting interface, perhaps adding validation controls (as we saw in the preceding tutorial) or by customizing the data collection user interface (as we saw in this tutorial).</span></span> <span data-ttu-id="c8593-267">在以下步骤中，可以使用 TemplateField 自定义接口：</span><span class="sxs-lookup"><span data-stu-id="c8593-267">Customizing the interface with a TemplateField can be summed up in the following steps:</span></span>

1. <span data-ttu-id="c8593-268">添加 TemplateField 或将现有的 BoundField 或 CheckBoxField 转换为 TemplateField</span><span class="sxs-lookup"><span data-stu-id="c8593-268">Add a TemplateField or convert an existing BoundField or CheckBoxField into a TemplateField</span></span>
2. <span data-ttu-id="c8593-269">根据需要增加接口</span><span class="sxs-lookup"><span data-stu-id="c8593-269">Augment the interface as needed</span></span>
3. <span data-ttu-id="c8593-270">使用双向数据绑定将相应的数据字段绑定到新添加的 Web 控件</span><span class="sxs-lookup"><span data-stu-id="c8593-270">Bind the appropriate data fields to the newly added Web controls using two-way databinding</span></span>

<span data-ttu-id="c8593-271">除了使用内置的 ASP.NET Web 控件以外，还可以使用自定义的已编译服务器控件和用户控件自定义 TemplateField 的模板。</span><span class="sxs-lookup"><span data-stu-id="c8593-271">In addition to using the built-in ASP.NET Web controls, you can also customize the templates of a TemplateField with custom, compiled server controls and User Controls.</span></span>

<span data-ttu-id="c8593-272">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="c8593-272">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="c8593-273">关于作者</span><span class="sxs-lookup"><span data-stu-id="c8593-273">About the Author</span></span>

<span data-ttu-id="c8593-274">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，创始人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已在使用 Microsoft Web 技术，自1998开始。</span><span class="sxs-lookup"><span data-stu-id="c8593-274">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="c8593-275">Scott 的工作方式是独立的顾问、培训师和撰稿人。</span><span class="sxs-lookup"><span data-stu-id="c8593-275">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="c8593-276">他的最新书籍是，[*在24小时内，sam ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="c8593-276">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="c8593-277">可以[mitchell@4GuysFromRolla.com访问。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="c8593-277">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="c8593-278">或通过他的博客，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="c8593-278">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="c8593-279">[上一页](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb.md)
> [下一页](implementing-optimistic-concurrency-vb.md)</span><span class="sxs-lookup"><span data-stu-id="c8593-279">[Previous](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb.md)
[Next](implementing-optimistic-concurrency-vb.md)</span></span>
