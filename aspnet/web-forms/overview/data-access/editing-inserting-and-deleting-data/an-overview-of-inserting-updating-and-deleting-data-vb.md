---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb
title: 插入、更新和删除数据概述（VB） |Microsoft Docs
author: rick-anderson
description: 在本教程中，我们将了解如何将 ObjectDataSource 的 Insert （）、Update （）和 Delete （）方法映射到 BLL 类的方法，以及如何配置 。
ms.author: riande
ms.date: 07/17/2006
ms.assetid: 35b40b8f-2ca8-4ab3-9c19-f361a91a3647
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb
msc.type: authoredcontent
ms.openlocfilehash: 79491118ba1cbbc8c1b67ca9646a817d941f17ba
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/06/2020
ms.locfileid: "78493838"
---
# <a name="an-overview-of-inserting-updating-and-deleting-data-vb"></a><span data-ttu-id="74be7-103">插入、更新和删除数据概述（VB）</span><span class="sxs-lookup"><span data-stu-id="74be7-103">An Overview of Inserting, Updating, and Deleting Data (VB)</span></span>

<span data-ttu-id="74be7-104">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="74be7-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="74be7-105">[下载示例应用](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_16_VB.exe)或[下载 PDF](an-overview-of-inserting-updating-and-deleting-data-vb/_static/datatutorial16vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="74be7-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_16_VB.exe) or [Download PDF](an-overview-of-inserting-updating-and-deleting-data-vb/_static/datatutorial16vb1.pdf)</span></span>

> <span data-ttu-id="74be7-106">在本教程中，我们将了解如何将 ObjectDataSource 的 Insert （）、Update （）和 Delete （）方法映射到 BLL 类的方法，以及如何配置 GridView、DetailsView 和 FormView 控件以提供数据修改功能。</span><span class="sxs-lookup"><span data-stu-id="74be7-106">In this tutorial we'll see how to map an ObjectDataSource's Insert(), Update(), and Delete() methods to the methods of BLL classes, as well as how to configure the GridView, DetailsView, and FormView controls to provide data modification capabilities.</span></span>

## <a name="introduction"></a><span data-ttu-id="74be7-107">简介</span><span class="sxs-lookup"><span data-stu-id="74be7-107">Introduction</span></span>

<span data-ttu-id="74be7-108">在过去的几个教程中，我们已探讨了如何使用 GridView、DetailsView 和 FormView 控件在 ASP.NET 页中显示数据。</span><span class="sxs-lookup"><span data-stu-id="74be7-108">Over the past several tutorials we've examined how to display data in an ASP.NET page using the GridView, DetailsView, and FormView controls.</span></span> <span data-ttu-id="74be7-109">这些控件只使用提供给它们的数据。</span><span class="sxs-lookup"><span data-stu-id="74be7-109">These controls simply work with data supplied to them.</span></span> <span data-ttu-id="74be7-110">通常，这些控件通过使用数据源控件（如 ObjectDataSource）来访问数据。</span><span class="sxs-lookup"><span data-stu-id="74be7-110">Commonly, these controls access data through the use of a data source control, such as the ObjectDataSource.</span></span> <span data-ttu-id="74be7-111">我们已了解 ObjectDataSource 如何充当 ASP.NET 页与基础数据之间的代理。</span><span class="sxs-lookup"><span data-stu-id="74be7-111">We've seen how the ObjectDataSource acts as a proxy between the ASP.NET page and the underlying data.</span></span> <span data-ttu-id="74be7-112">当 GridView 需要显示数据时，它将调用其 ObjectDataSource `Select()` 方法，该方法反过来从我们的业务逻辑层（BLL）调用一个方法，该方法在相应的数据访问层（DAL） TableAdapter 中调用一个方法，后者反过来将 `SELECT` 查询发送到 Northwind 数据库。</span><span class="sxs-lookup"><span data-stu-id="74be7-112">When a GridView needs to display data, it invokes its ObjectDataSource's `Select()` method, which in turn invokes a method from our Business Logic Layer (BLL), which calls a method in the appropriate Data Access Layer's (DAL) TableAdapter, which in turn sends a `SELECT` query to the Northwind database.</span></span>

<span data-ttu-id="74be7-113">请记住，当我们在[第一个教程](../introduction/creating-a-data-access-layer-cs.md)中创建 DAL 中的 tableadapter 时，Visual Studio 会自动添加用于从基础数据库表中插入、更新和删除数据的方法。</span><span class="sxs-lookup"><span data-stu-id="74be7-113">Recall that when we created the TableAdapters in the DAL in [our first tutorial](../introduction/creating-a-data-access-layer-cs.md), Visual Studio automatically added methods for inserting, updating, and deleting data from the underlying database table.</span></span> <span data-ttu-id="74be7-114">此外，在[创建业务逻辑层](../introduction/creating-a-business-logic-layer-vb.md)时，我们在 BLL 中设计了一些方法，这些方法向下调用这些数据修改 DAL 方法。</span><span class="sxs-lookup"><span data-stu-id="74be7-114">Moreover, in [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-vb.md) we designed methods in the BLL that called down into these data modification DAL methods.</span></span>

<span data-ttu-id="74be7-115">除了其 `Select()` 方法，ObjectDataSource 还具有 `Insert()`、`Update()`和 `Delete()` 方法。</span><span class="sxs-lookup"><span data-stu-id="74be7-115">In addition to its `Select()` method, the ObjectDataSource also has `Insert()`, `Update()`, and `Delete()` methods.</span></span> <span data-ttu-id="74be7-116">与 `Select()` 方法一样，这三种方法都可以映射到基础对象中的方法。</span><span class="sxs-lookup"><span data-stu-id="74be7-116">Like the `Select()` method, these three methods can be mapped to methods in an underlying object.</span></span> <span data-ttu-id="74be7-117">配置为插入、更新或删除数据时，GridView、DetailsView 和 FormView 控件提供了一个用于修改基础数据的用户界面。</span><span class="sxs-lookup"><span data-stu-id="74be7-117">When configured to insert, update, or delete data, the GridView, DetailsView, and FormView controls provide a user interface for modifying the underlying data.</span></span> <span data-ttu-id="74be7-118">此用户界面调用 ObjectDataSource 的 `Insert()`、`Update()`和 `Delete()` 方法，然后调用基础对象的关联方法（请参阅图1）。</span><span class="sxs-lookup"><span data-stu-id="74be7-118">This user interface calls the `Insert()`, `Update()`, and `Delete()` methods of the ObjectDataSource, which then invoke the underlying object's associated methods (see Figure 1).</span></span>

<span data-ttu-id="74be7-119">[![ObjectDataSource 的 Insert （）、Update （）和 Delete （）方法在 BLL 中充当代理](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image2.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="74be7-119">[![The ObjectDataSource's Insert(), Update(), and Delete() Methods Serve as a Proxy into the BLL](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image2.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image1.png)</span></span>

<span data-ttu-id="74be7-120">**图 1**： ObjectDataSource 的 `Insert()`、`Update()`和 `Delete()` 方法充当 BLL 的代理（[单击以查看完全大小的映像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="74be7-120">**Figure 1**: The ObjectDataSource's `Insert()`, `Update()`, and `Delete()` Methods Serve as a Proxy into the BLL ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image3.png))</span></span>

<span data-ttu-id="74be7-121">在本教程中，我们将了解如何将 ObjectDataSource 的 `Insert()`、`Update()`和 `Delete()` 方法映射到 BLL 中的类的方法，以及如何配置 GridView、DetailsView 和 FormView 控件以提供数据修改功能。</span><span class="sxs-lookup"><span data-stu-id="74be7-121">In this tutorial we'll see how to map the ObjectDataSource's `Insert()`, `Update()`, and `Delete()` methods to methods of classes in the BLL, as well as how to configure the GridView, DetailsView, and FormView controls to provide data modification capabilities.</span></span>

## <a name="step-1-creating-the-insert-update-and-delete-tutorials-web-pages"></a><span data-ttu-id="74be7-122">步骤1：创建 Insert、Update 和 Delete 教程网页</span><span class="sxs-lookup"><span data-stu-id="74be7-122">Step 1: Creating the Insert, Update, and Delete Tutorials Web Pages</span></span>

<span data-ttu-id="74be7-123">在开始探索如何插入、更新和删除数据之前，首先请花点时间在我们的网站项目中创建 ASP.NET 页面，我们将在本教程和下几个页面中创建这些页面。</span><span class="sxs-lookup"><span data-stu-id="74be7-123">Before we start exploring how to insert, update, and delete data, let's first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial and the next several ones.</span></span> <span data-ttu-id="74be7-124">首先添加一个名为 `EditInsertDelete`的新文件夹。</span><span class="sxs-lookup"><span data-stu-id="74be7-124">Start by adding a new folder named `EditInsertDelete`.</span></span> <span data-ttu-id="74be7-125">接下来，将以下 ASP.NET 页面添加到该文件夹，并确保将每个页面与 `Site.master` 母版页关联：</span><span class="sxs-lookup"><span data-stu-id="74be7-125">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `Basics.aspx`
- `DataModificationEvents.aspx`
- `ErrorHandling.aspx`
- `UIValidation.aspx`
- `CustomizedUI.aspx`
- `OptimisticConcurrency.aspx`
- `ConfirmationOnDelete.aspx`
- `UserLevelAccess.aspx`

![为与数据修改相关的教程添加 ASP.NET 页](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image4.png)

<span data-ttu-id="74be7-127">**图 2**：为与数据修改相关的教程添加 ASP.NET 页</span><span class="sxs-lookup"><span data-stu-id="74be7-127">**Figure 2**: Add the ASP.NET Pages for the Data Modification-Related Tutorials</span></span>

<span data-ttu-id="74be7-128">与在其他文件夹中一样，`EditInsertDelete` 文件夹中的 `Default.aspx` 会在其部分列出教程。</span><span class="sxs-lookup"><span data-stu-id="74be7-128">Like in the other folders, `Default.aspx` in the `EditInsertDelete` folder will list the tutorials in its section.</span></span> <span data-ttu-id="74be7-129">请记住，`SectionLevelTutorialListing.ascx` 用户控件提供此功能。</span><span class="sxs-lookup"><span data-stu-id="74be7-129">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="74be7-130">因此，通过将此用户控件从解决方案资源管理器拖到页面的设计视图上，将其添加到 `Default.aspx`。</span><span class="sxs-lookup"><span data-stu-id="74be7-130">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page's Design view.</span></span>

<span data-ttu-id="74be7-131">[![将 SectionLevelTutorialListing 用户控件添加到 default.aspx](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image6.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="74be7-131">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image6.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image5.png)</span></span>

<span data-ttu-id="74be7-132">**图 3**：将 `SectionLevelTutorialListing.ascx` 用户控件添加到 `Default.aspx` （[单击以查看完全大小的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image7.png)）</span><span class="sxs-lookup"><span data-stu-id="74be7-132">**Figure 3**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image7.png))</span></span>

<span data-ttu-id="74be7-133">最后，将页面作为条目添加到 `Web.sitemap` 文件中。</span><span class="sxs-lookup"><span data-stu-id="74be7-133">Lastly, add the pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="74be7-134">具体而言，在自定义格式设置之后添加以下标记 `<siteMapNode>`：</span><span class="sxs-lookup"><span data-stu-id="74be7-134">Specifically, add the following markup after the Customized Formatting `<siteMapNode>`:</span></span>

[!code-xml[Main](an-overview-of-inserting-updating-and-deleting-data-vb/samples/sample1.xml)]

<span data-ttu-id="74be7-135">更新 `Web.sitemap`后，请花点时间通过浏览器查看教程网站。</span><span class="sxs-lookup"><span data-stu-id="74be7-135">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="74be7-136">左侧菜单现在包含用于编辑、插入和删除教程的项。</span><span class="sxs-lookup"><span data-stu-id="74be7-136">The menu on the left now includes items for the editing, inserting, and deleting tutorials.</span></span>

![站点映射现在包含用于编辑、插入和删除教程的条目](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image8.png)

<span data-ttu-id="74be7-138">**图 4**：站点地图现在包含用于编辑、插入和删除教程的条目</span><span class="sxs-lookup"><span data-stu-id="74be7-138">**Figure 4**: The Site Map Now Includes Entries for the Editing, Inserting, and Deleting Tutorials</span></span>

## <a name="step-2-adding-and-configuring-the-objectdatasource-control"></a><span data-ttu-id="74be7-139">步骤2：添加和配置 ObjectDataSource 控件</span><span class="sxs-lookup"><span data-stu-id="74be7-139">Step 2: Adding and Configuring the ObjectDataSource Control</span></span>

<span data-ttu-id="74be7-140">由于 GridView、DetailsView 和 FormView 各自的数据修改功能和布局不同，因此让我们单独检查每个项。</span><span class="sxs-lookup"><span data-stu-id="74be7-140">Since the GridView, DetailsView, and FormView each differ in their data modification capabilities and layout, let's examine each one individually.</span></span> <span data-ttu-id="74be7-141">不过，只需创建所有三个控件示例都可以共享的单个 ObjectDataSource，而不是让每个控件使用其自己的 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="74be7-141">Rather than have each control using its own ObjectDataSource, however, let's just create a single ObjectDataSource that all three control examples can share.</span></span>

<span data-ttu-id="74be7-142">打开 "`Basics.aspx`" 页，将 "ObjectDataSource" 从工具箱拖到设计器上，并单击其智能标记中的 "配置数据源" 链接。</span><span class="sxs-lookup"><span data-stu-id="74be7-142">Open the `Basics.aspx` page, drag an ObjectDataSource from the Toolbox onto the Designer, and click the Configure Data Source link from its smart tag.</span></span> <span data-ttu-id="74be7-143">由于 `ProductsBLL` 是唯一提供编辑、插入和删除方法的 BLL 类，因此请将 ObjectDataSource 配置为使用此类。</span><span class="sxs-lookup"><span data-stu-id="74be7-143">Since the `ProductsBLL` is the only BLL class that provides editing, inserting, and deleting methods, configure the ObjectDataSource to use this class.</span></span>

<span data-ttu-id="74be7-144">[![将 ObjectDataSource 配置为使用 ProductsBLL 类](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image10.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="74be7-144">[![Configure the ObjectDataSource to Use the ProductsBLL Class](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image10.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image9.png)</span></span>

<span data-ttu-id="74be7-145">**图 5**：将 ObjectDataSource 配置为使用 `ProductsBLL` 类（[单击以查看完全大小的映像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image11.png)）</span><span class="sxs-lookup"><span data-stu-id="74be7-145">**Figure 5**: Configure the ObjectDataSource to Use the `ProductsBLL` Class ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image11.png))</span></span>

<span data-ttu-id="74be7-146">在下一屏幕中，可以通过选择相应的选项卡，然后从下拉列表中选择方法，指定将 `ProductsBLL` 类的哪些方法映射到 ObjectDataSource 的 `Select()`、`Insert()`、`Update()`和 `Delete()`。</span><span class="sxs-lookup"><span data-stu-id="74be7-146">In the next screen we can specify what methods of the `ProductsBLL` class are mapped to the ObjectDataSource's `Select()`, `Insert()`, `Update()`, and `Delete()` by selecting the appropriate tab and choosing the method from the drop-down list.</span></span> <span data-ttu-id="74be7-147">图6（现在应熟悉）将 ObjectDataSource 的 `Select()` 方法映射到 `ProductsBLL` 类的 `GetProducts()` 方法。</span><span class="sxs-lookup"><span data-stu-id="74be7-147">Figure 6, which should look familiar by now, maps the ObjectDataSource's `Select()` method to the `ProductsBLL` class's `GetProducts()` method.</span></span> <span data-ttu-id="74be7-148">通过从顶部的列表中选择相应的选项卡，可以配置 `Insert()`、`Update()`和 `Delete()` 方法。</span><span class="sxs-lookup"><span data-stu-id="74be7-148">The `Insert()`, `Update()`, and `Delete()` methods can be configured by selecting the appropriate tab from the list along the top.</span></span>

<span data-ttu-id="74be7-149">[![让 ObjectDataSource 返回所有产品](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image13.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="74be7-149">[![Have the ObjectDataSource Return All of the Products](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image13.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image12.png)</span></span>

<span data-ttu-id="74be7-150">**图 6**： ObjectDataSource 返回所有产品（[单击以查看完全大小的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image14.png)）</span><span class="sxs-lookup"><span data-stu-id="74be7-150">**Figure 6**: Have the ObjectDataSource Return All of the Products ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image14.png))</span></span>

<span data-ttu-id="74be7-151">图7、8和9显示了 ObjectDataSource 的 "更新"、"插入" 和 "删除" 选项卡。</span><span class="sxs-lookup"><span data-stu-id="74be7-151">Figures 7, 8, and 9 show the ObjectDataSource's UPDATE, INSERT, and DELETE tabs.</span></span> <span data-ttu-id="74be7-152">配置这些选项卡，以便 `Insert()`、`Update()`和 `Delete()` 方法分别调用 `ProductsBLL` 类的 `UpdateProduct`、`AddProduct`和 `DeleteProduct` 方法。</span><span class="sxs-lookup"><span data-stu-id="74be7-152">Configure these tabs so that the `Insert()`, `Update()`, and `Delete()` methods invoke the `ProductsBLL` class's `UpdateProduct`, `AddProduct`, and `DeleteProduct` methods, respectively.</span></span>

<span data-ttu-id="74be7-153">[![将 ObjectDataSource 的 Update （）方法映射到 ProductBLL 类的 UpdateProduct 方法](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image16.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="74be7-153">[![Map the ObjectDataSource's Update() Method to the ProductBLL Class's UpdateProduct Method](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image16.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image15.png)</span></span>

<span data-ttu-id="74be7-154">**图 7**：将 ObjectDataSource 的 `Update()` 方法映射到 `ProductBLL` 类的 `UpdateProduct` 方法（[单击以查看完全大小的映像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image17.png)）</span><span class="sxs-lookup"><span data-stu-id="74be7-154">**Figure 7**: Map the ObjectDataSource's `Update()` Method to the `ProductBLL` Class's `UpdateProduct` Method ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image17.png))</span></span>

<span data-ttu-id="74be7-155">[![将 ObjectDataSource 的 Insert （）方法映射到 ProductBLL 类的 AddProduct 方法](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image19.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="74be7-155">[![Map the ObjectDataSource's Insert() Method to the ProductBLL Class's AddProduct Method](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image19.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image18.png)</span></span>

<span data-ttu-id="74be7-156">**图 8**：将 ObjectDataSource 的 `Insert()` 方法映射到 `ProductBLL` 类的添加 `Product` 方法（[单击以查看完全大小的映像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image20.png)）</span><span class="sxs-lookup"><span data-stu-id="74be7-156">**Figure 8**: Map the ObjectDataSource's `Insert()` Method to the `ProductBLL` Class's Add `Product` Method ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image20.png))</span></span>

<span data-ttu-id="74be7-157">[![将 ObjectDataSource 的 Delete （）方法映射到 ProductBLL 类的 DeleteProduct 方法](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image22.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="74be7-157">[![Map the ObjectDataSource's Delete() Method to the ProductBLL Class's DeleteProduct Method](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image22.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image21.png)</span></span>

<span data-ttu-id="74be7-158">**图 9**：将 ObjectDataSource 的 `Delete()` 方法映射到 `ProductBLL` 类的 `DeleteProduct` 方法（[单击以查看完全大小的映像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image23.png)）</span><span class="sxs-lookup"><span data-stu-id="74be7-158">**Figure 9**: Map the ObjectDataSource's `Delete()` Method to the `ProductBLL` Class's `DeleteProduct` Method ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image23.png))</span></span>

<span data-ttu-id="74be7-159">您可能已注意到，"更新"、"插入" 和 "删除" 选项卡中的下拉列表已经选择了这些方法。</span><span class="sxs-lookup"><span data-stu-id="74be7-159">You may have noticed that the drop-down lists in the UPDATE, INSERT, and DELETE tabs already had these methods selected.</span></span> <span data-ttu-id="74be7-160">这是因为我们使用 `DataObjectMethodAttribute` 来修饰 `ProductsBLL`的方法。</span><span class="sxs-lookup"><span data-stu-id="74be7-160">This is thanks to our use of the `DataObjectMethodAttribute` that decorates the methods of `ProductsBLL`.</span></span> <span data-ttu-id="74be7-161">例如，DeleteProduct 方法具有以下签名：</span><span class="sxs-lookup"><span data-stu-id="74be7-161">For example, the DeleteProduct method has the following signature:</span></span>

[!code-vb[Main](an-overview-of-inserting-updating-and-deleting-data-vb/samples/sample2.vb)]

<span data-ttu-id="74be7-162">`DataObjectMethodAttribute` 特性指示每个方法的用途，无论该方法是用于选择、插入、更新或删除，还是为默认值。</span><span class="sxs-lookup"><span data-stu-id="74be7-162">The `DataObjectMethodAttribute` attribute indicates the purpose of each method whether it is for selecting, inserting, updating, or deleting and whether or not it's the default value.</span></span> <span data-ttu-id="74be7-163">如果在创建 BLL 类时省略了这些属性，则需要从 "更新"、"插入" 和 "删除" 选项卡中手动选择方法。</span><span class="sxs-lookup"><span data-stu-id="74be7-163">If you omitted these attributes when creating your BLL classes, you'll need to manually select the methods from the UPDATE, INSERT, and DELETE tabs.</span></span>

<span data-ttu-id="74be7-164">在确保将适当的 `ProductsBLL` 方法映射到 ObjectDataSource 的 `Insert()`、`Update()`和 `Delete()` 方法之后，单击 "完成" 以完成向导。</span><span class="sxs-lookup"><span data-stu-id="74be7-164">After ensuring that the appropriate `ProductsBLL` methods are mapped to the ObjectDataSource's `Insert()`, `Update()`, and `Delete()` methods, click Finish to complete the wizard.</span></span>

## <a name="examining-the-objectdatasources-markup"></a><span data-ttu-id="74be7-165">检查 ObjectDataSource 的标记</span><span class="sxs-lookup"><span data-stu-id="74be7-165">Examining the ObjectDataSource's Markup</span></span>

<span data-ttu-id="74be7-166">通过其向导配置 ObjectDataSource 后，请切换到 "源" 视图以检查生成的声明性标记。</span><span class="sxs-lookup"><span data-stu-id="74be7-166">After configuring the ObjectDataSource through its wizard, go to the Source view to examine the generated declarative markup.</span></span> <span data-ttu-id="74be7-167">`<asp:ObjectDataSource>` 标记指定基础对象以及要调用的方法。</span><span class="sxs-lookup"><span data-stu-id="74be7-167">The `<asp:ObjectDataSource>` tag specifies the underlying object and the methods to invoke.</span></span> <span data-ttu-id="74be7-168">此外，还有 `DeleteParameters`、`UpdateParameters`和 `InsertParameters`，它们映射到 `ProductsBLL` 类的 `AddProduct`、`UpdateProduct`和 `DeleteProduct` 方法的输入参数：</span><span class="sxs-lookup"><span data-stu-id="74be7-168">Additionally, there are `DeleteParameters`, `UpdateParameters`, and `InsertParameters` that map to the input parameters for the `ProductsBLL` class's `AddProduct`, `UpdateProduct`, and `DeleteProduct` methods:</span></span>

[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-vb/samples/sample3.aspx)]

<span data-ttu-id="74be7-169">ObjectDataSource 为其关联的方法包含每个输入参数的参数，如同在 ObjectDataSource 配置为调用需要输入参数的 select 方法（如 `GetProductsByCategoryID(categoryID)`）时提供 `SelectParameter` 的列表。</span><span class="sxs-lookup"><span data-stu-id="74be7-169">The ObjectDataSource includes a parameter for each of the input parameters for its associated methods, just like a list of `SelectParameter` s is present when the ObjectDataSource is configured to call a select method that expects an input parameter (such as `GetProductsByCategoryID(categoryID)`).</span></span> <span data-ttu-id="74be7-170">我们很快就会看到，这些 `DeleteParameters`、`UpdateParameters`和 `InsertParameters` 的值是在调用 ObjectDataSource 的 `Insert()`、`Update()`或 `Delete()` 方法之前由 GridView、DetailsView 和 FormView 自动设置的。</span><span class="sxs-lookup"><span data-stu-id="74be7-170">As we'll see shortly, values for these `DeleteParameters`, `UpdateParameters`, and `InsertParameters` are set automatically by the GridView, DetailsView, and FormView prior to invoking the ObjectDataSource's `Insert()`, `Update()`, or `Delete()` method.</span></span> <span data-ttu-id="74be7-171">还可以根据需要以编程方式设置这些值，因为我们将在以后的教程中进行讨论。</span><span class="sxs-lookup"><span data-stu-id="74be7-171">These values can also be set programmatically as needed, as we'll discuss in a future tutorial.</span></span>

<span data-ttu-id="74be7-172">使用向导配置为 ObjectDataSource 的一个副作用是，Visual Studio 会将[OldValuesParameterFormatString 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.oldvaluesparameterformatstring(VS.80).aspx)设置为 `original_{0}`。</span><span class="sxs-lookup"><span data-stu-id="74be7-172">One side effect of using the wizard to configure to ObjectDataSource is that Visual Studio sets the [OldValuesParameterFormatString property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.oldvaluesparameterformatstring(VS.80).aspx) to `original_{0}`.</span></span> <span data-ttu-id="74be7-173">此属性值用于包括正在编辑的数据的原始值，在两种情况下非常有用：</span><span class="sxs-lookup"><span data-stu-id="74be7-173">This property value is used to include the original values of the data being edited and is useful in two scenarios:</span></span>

- <span data-ttu-id="74be7-174">如果编辑记录时，用户可以更改主键值。</span><span class="sxs-lookup"><span data-stu-id="74be7-174">If, when editing a record, users are able to change the primary key value.</span></span> <span data-ttu-id="74be7-175">在这种情况下，必须提供新的主键值和原始主键值，才能找到具有原始主键值的记录，并相应地更新其值。</span><span class="sxs-lookup"><span data-stu-id="74be7-175">In this case, both the new primary key value and the original primary key value must be provided so that the record with the original primary key value can be found and have its value updated accordingly.</span></span>
- <span data-ttu-id="74be7-176">使用乐观并发时。</span><span class="sxs-lookup"><span data-stu-id="74be7-176">When using optimistic concurrency.</span></span> <span data-ttu-id="74be7-177">乐观并发是一项技术，可确保两个同时进行的用户不会覆盖另一项更改，并在以后的教程中提供主题。</span><span class="sxs-lookup"><span data-stu-id="74be7-177">Optimistic concurrency is a technique to ensure that two simultaneous users don't overwrite one another's changes, and is the topic for a future tutorial.</span></span>

<span data-ttu-id="74be7-178">`OldValuesParameterFormatString` 属性指示基础对象的更新和删除方法中的输入参数的名称，这些值用于原始值。</span><span class="sxs-lookup"><span data-stu-id="74be7-178">The `OldValuesParameterFormatString` property indicates the name of the input parameters in the underlying object's update and delete methods for the original values.</span></span> <span data-ttu-id="74be7-179">当我们探索开放式并发时，我们将更详细地讨论此属性及其目的。</span><span class="sxs-lookup"><span data-stu-id="74be7-179">We'll discuss this property and its purpose in greater detail when we explore optimistic concurrency.</span></span> <span data-ttu-id="74be7-180">但现在我会将其引入，因为 BLL 的方法不需要原始值，因此我们必须删除此属性。</span><span class="sxs-lookup"><span data-stu-id="74be7-180">I bring it up now, however, because our BLL's methods do not expect the original values and therefore it's important that we remove this property.</span></span> <span data-ttu-id="74be7-181">如果将 `OldValuesParameterFormatString` 属性设置为默认值（`{0}`）以外的任何值，则当数据 Web 控件尝试调用 ObjectDataSource 的 `Update()` 或 `Delete()` 方法时，将会导致错误，因为 ObjectDataSource 尝试同时传入指定的 `UpdateParameters` 或 `DeleteParameters`，以及原始值参数。</span><span class="sxs-lookup"><span data-stu-id="74be7-181">Leaving the `OldValuesParameterFormatString` property set to anything other than the default (`{0}`) will cause an error when a data Web control attempts to invoke the ObjectDataSource's `Update()` or `Delete()` methods because the ObjectDataSource will attempt to pass in both the `UpdateParameters` or `DeleteParameters` specified as well as original value parameters.</span></span>

<span data-ttu-id="74be7-182">如果这不是很明显，别担心，我们会在以后的教程中检查此属性及其实用工具。</span><span class="sxs-lookup"><span data-stu-id="74be7-182">If this isn't terribly clear at this juncture, don't worry, we'll examine this property and its utility in a future tutorial.</span></span> <span data-ttu-id="74be7-183">现在，只需确保完全从声明性语法中删除此属性声明，或将该值设置为默认值（{0}）。</span><span class="sxs-lookup"><span data-stu-id="74be7-183">For now, just be certain to either remove this property declaration entirely from the declarative syntax or set the value to the default value ({0}).</span></span>

> [!NOTE]
> <span data-ttu-id="74be7-184">如果只是从设计视图的属性窗口中清除 `OldValuesParameterFormatString` 属性值，则该属性仍将在声明性语法中存在，但会设置为空字符串。</span><span class="sxs-lookup"><span data-stu-id="74be7-184">If you simply clear out the `OldValuesParameterFormatString` property value from the Properties window in the Design view, the property will still exist in the declarative syntax, but be set to an empty string.</span></span> <span data-ttu-id="74be7-185">遗憾的是，这仍会导致前面讨论相同的问题。</span><span class="sxs-lookup"><span data-stu-id="74be7-185">This, unfortunately, will still result in the same problem discussed above.</span></span> <span data-ttu-id="74be7-186">因此，从声明性语法中删除完全相同的属性，或者从属性窗口中，将该值设置为默认值，`{0}`。</span><span class="sxs-lookup"><span data-stu-id="74be7-186">Therefore, either remove the property altogether from the declarative syntax or, from the Properties window, set the value to the default, `{0}`.</span></span>

## <a name="step-3-adding-a-data-web-control-and-configuring-it-for-data-modification"></a><span data-ttu-id="74be7-187">步骤3：添加数据 Web 控件并对其进行配置以进行数据修改</span><span class="sxs-lookup"><span data-stu-id="74be7-187">Step 3: Adding a Data Web Control and Configuring It for Data Modification</span></span>

<span data-ttu-id="74be7-188">一旦将 ObjectDataSource 添加到页面并进行了配置，我们就可以将数据 Web 控件添加到页面以显示数据，并提供一种方法供最终用户修改。</span><span class="sxs-lookup"><span data-stu-id="74be7-188">Once the ObjectDataSource has been added to the page and configured, we're ready to add data Web controls to the page to both display the data and provide a means for the end user to modify it.</span></span> <span data-ttu-id="74be7-189">我们将单独探讨 GridView、DetailsView 和 FormView，因为这些数据 Web 控件的数据修改功能和配置不同。</span><span class="sxs-lookup"><span data-stu-id="74be7-189">We'll look at the GridView, DetailsView, and FormView separately, as these data Web controls differ in their data modification capabilities and configuration.</span></span>

<span data-ttu-id="74be7-190">正如我们将在本文的剩余部分中看到的那样，通过 GridView、DetailsView 和 FormView 控件添加非常基本的编辑、插入和删除支持实际上与选中几个复选框一样简单。</span><span class="sxs-lookup"><span data-stu-id="74be7-190">As we'll see in the remainder of this article, adding very basic editing, inserting, and deleting support through the GridView, DetailsView, and FormView controls is really as simple as checking a couple of checkboxes.</span></span> <span data-ttu-id="74be7-191">现实世界中有许多微妙之处和 edge 事例，这使得提供此类功能比只需点击和单击更多。</span><span class="sxs-lookup"><span data-stu-id="74be7-191">There are many subtleties and edge cases in the real-world that make providing such functionality more involved than just point and click.</span></span> <span data-ttu-id="74be7-192">不过，本教程只重点介绍如何证明简单的数据修改功能。</span><span class="sxs-lookup"><span data-stu-id="74be7-192">This tutorial, however, focuses solely on proving simplistic data modification capabilities.</span></span> <span data-ttu-id="74be7-193">未来的教程将探讨无疑会在实际设置中出现的问题。</span><span class="sxs-lookup"><span data-stu-id="74be7-193">Future tutorials will examine concerns that will undoubtedly arise in a real-world setting.</span></span>

## <a name="deleting-data-from-the-gridview"></a><span data-ttu-id="74be7-194">从 GridView 中删除数据</span><span class="sxs-lookup"><span data-stu-id="74be7-194">Deleting Data from the GridView</span></span>

<span data-ttu-id="74be7-195">首先，将 GridView 从工具箱拖到设计器上。</span><span class="sxs-lookup"><span data-stu-id="74be7-195">Start by dragging a GridView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="74be7-196">接下来，在 GridView 的智能标记的下拉列表中选择它，将其绑定到 GridView。</span><span class="sxs-lookup"><span data-stu-id="74be7-196">Next, bind the ObjectDataSource to the GridView by selecting it from the drop-down list in the GridView's smart tag.</span></span> <span data-ttu-id="74be7-197">此时，GridView 的声明性标记将为：</span><span class="sxs-lookup"><span data-stu-id="74be7-197">At this point the GridView's declarative markup will be:</span></span>

[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-vb/samples/sample4.aspx)]

<span data-ttu-id="74be7-198">通过其智能标记将 GridView 绑定到 ObjectDataSource 有两个优点：</span><span class="sxs-lookup"><span data-stu-id="74be7-198">Binding the GridView to the ObjectDataSource through its smart tag has two benefits:</span></span>

- <span data-ttu-id="74be7-199">为 ObjectDataSource 返回的每个字段自动创建 BoundFields 和 CheckBoxFields。</span><span class="sxs-lookup"><span data-stu-id="74be7-199">BoundFields and CheckBoxFields are automatically created for each of the fields returned by the ObjectDataSource.</span></span> <span data-ttu-id="74be7-200">此外，基于基础字段的元数据设置 BoundField 和 CheckBoxField 属性。</span><span class="sxs-lookup"><span data-stu-id="74be7-200">Moreover, the BoundField and CheckBoxField's properties are set based on the underlying field's metadata.</span></span> <span data-ttu-id="74be7-201">例如，`ProductID`、`CategoryName`和 `SupplierName` 字段在 `ProductsDataTable` 中被标记为只读，因此在编辑时不能更新。</span><span class="sxs-lookup"><span data-stu-id="74be7-201">For example, the `ProductID`, `CategoryName`, and `SupplierName` fields are marked as read-only in the `ProductsDataTable` and therefore shouldn't be updatable when editing.</span></span> <span data-ttu-id="74be7-202">为此，这些 BoundFields 的[ReadOnly 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.boundfield.readonly(VS.80).aspx)设置为 `True`。</span><span class="sxs-lookup"><span data-stu-id="74be7-202">To accommodate this, these BoundFields' [ReadOnly properties](https://msdn.microsoft.com/library/system.web.ui.webcontrols.boundfield.readonly(VS.80).aspx) are set to `True`.</span></span>
- <span data-ttu-id="74be7-203">[DataKeyNames 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.datakeynames(VS.80).aspx)将分配给基础对象的主键字段。</span><span class="sxs-lookup"><span data-stu-id="74be7-203">The [DataKeyNames property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.datakeynames(VS.80).aspx) is assigned to the primary key field(s) of the underlying object.</span></span> <span data-ttu-id="74be7-204">当使用 GridView 编辑或删除数据时，这一点非常重要，因为此属性指示唯一标识每条记录的一个或多个字段。</span><span class="sxs-lookup"><span data-stu-id="74be7-204">This is essential when using the GridView for editing or deleting data, as this property indicates the field (or set of fields) that unique identifies each record.</span></span> <span data-ttu-id="74be7-205">有关 `DataKeyNames` 属性的详细信息，请参阅有关详细信息，请参阅[使用可选的 Master GridView DetailView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md)教程。</span><span class="sxs-lookup"><span data-stu-id="74be7-205">For more information on the `DataKeyNames` property, refer back to the [Master/Detail Using a Selectable Master GridView with a Details DetailView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md) tutorial.</span></span>

<span data-ttu-id="74be7-206">尽管 GridView 可以通过属性窗口或声明性语法绑定到 ObjectDataSource，但这样做需要你手动添加适当的 BoundField 和 `DataKeyNames` 标记。</span><span class="sxs-lookup"><span data-stu-id="74be7-206">While the GridView can be bound to the ObjectDataSource through the Properties window or declarative syntax, doing so requires you to manually add the appropriate BoundField and `DataKeyNames` markup.</span></span>

<span data-ttu-id="74be7-207">GridView 控件为行级编辑和删除提供内置支持。</span><span class="sxs-lookup"><span data-stu-id="74be7-207">The GridView control provides built-in support for row-level editing and deleting.</span></span> <span data-ttu-id="74be7-208">将 GridView 配置为支持删除将添加 "删除" 按钮的列。</span><span class="sxs-lookup"><span data-stu-id="74be7-208">Configuring a GridView to support deleting adds a column of Delete buttons.</span></span> <span data-ttu-id="74be7-209">当最终用户单击特定行的 "删除" 按钮时，将执行以下步骤：</span><span class="sxs-lookup"><span data-stu-id="74be7-209">When the end user clicks the Delete button for a particular row, a postback ensues and the GridView performs the following steps:</span></span>

1. <span data-ttu-id="74be7-210">已分配 ObjectDataSource 的 `DeleteParameters` 值</span><span class="sxs-lookup"><span data-stu-id="74be7-210">The ObjectDataSource's `DeleteParameters` value(s) are assigned</span></span>
2. <span data-ttu-id="74be7-211">将调用 ObjectDataSource 的 `Delete()` 方法，并删除指定的记录</span><span class="sxs-lookup"><span data-stu-id="74be7-211">The ObjectDataSource's `Delete()` method is invoked, deleting the specified record</span></span>
3. <span data-ttu-id="74be7-212">GridView 通过调用其 `Select()` 方法将自身重新绑定到 ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="74be7-212">The GridView rebinds itself to the ObjectDataSource by invoking its `Select()` method</span></span>

<span data-ttu-id="74be7-213">分配给 `DeleteParameters` 的值是单击 "删除" 按钮的行的 `DataKeyNames` 字段的值。</span><span class="sxs-lookup"><span data-stu-id="74be7-213">The values assigned to the `DeleteParameters` are the values of the `DataKeyNames` field(s) for the row whose Delete button was clicked.</span></span> <span data-ttu-id="74be7-214">因此，必须正确设置 GridView 的 `DataKeyNames` 属性。</span><span class="sxs-lookup"><span data-stu-id="74be7-214">Therefore it's vital that a GridView's `DataKeyNames` property be correctly set.</span></span> <span data-ttu-id="74be7-215">如果缺少此值，则会在步骤1中为 `DeleteParameters` 分配 `Nothing` 值，而不会导致步骤2中的任何已删除的记录。</span><span class="sxs-lookup"><span data-stu-id="74be7-215">If it's missing, the `DeleteParameters` will be assigned a value of `Nothing` in Step 1, which in turn will not result in any deleted records in Step 2.</span></span>

> [!NOTE]
> <span data-ttu-id="74be7-216">`DataKeys` 集合存储在 GridView 的控件状态中，这意味着，即使已禁用 GridView 的视图状态，也会在回发时记住 `DataKeys` 值。</span><span class="sxs-lookup"><span data-stu-id="74be7-216">The `DataKeys` collection is stored in the GridView s control state, meaning that the `DataKeys` values will be remembered across postback even if the GridView s view state has been disabled.</span></span> <span data-ttu-id="74be7-217">但是，对于支持编辑或删除的 GridViews （默认行为），视图状态保持为启用状态是非常重要的。</span><span class="sxs-lookup"><span data-stu-id="74be7-217">However, it is very important that view state remains enabled for GridViews that support editing or deleting (the default behavior).</span></span> <span data-ttu-id="74be7-218">如果将 GridView `EnableViewState` 属性设置为 "`false`，则编辑和删除行为将适用于单个用户，但是，如果存在并发用户删除数据，则这些并发用户可能会意外删除或编辑他们不打算的记录。</span><span class="sxs-lookup"><span data-stu-id="74be7-218">If you set the GridView s `EnableViewState` property to `false`, the editing and deleting behavior will work fine for a single user, but if there are concurrent users deleting data, there exists the possibility that these concurrent users may accidentally delete or edit records that they didn't intend.</span></span> <span data-ttu-id="74be7-219">有关详细信息，请参阅我的博客文章[： ASP.NET 2.0 GridViews/DetailsView/FormViews 上支持编辑和/删除以及禁用了其视图状态的并发问题](http://scottonwriting.net/sowblog/posts/10054.aspx)。</span><span class="sxs-lookup"><span data-stu-id="74be7-219">See my blog entry, [WARNING: Concurrency Issue with ASP.NET 2.0 GridViews/DetailsView/FormViews that Support Editing and/or Deleting and Whose View State is Disabled](http://scottonwriting.net/sowblog/posts/10054.aspx), for more information.</span></span>

<span data-ttu-id="74be7-220">同样的警告同样适用于 DetailsViews 和 FormViews。</span><span class="sxs-lookup"><span data-stu-id="74be7-220">This same warning also applies to DetailsViews and FormViews.</span></span>

<span data-ttu-id="74be7-221">若要将删除功能添加到 GridView，只需切换到其智能标记，并选中 "启用删除" 复选框。</span><span class="sxs-lookup"><span data-stu-id="74be7-221">To add deleting capabilities to a GridView, simply go to its smart tag and check the Enable Deleting checkbox.</span></span>

![选中 "启用删除" 复选框](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image24.png)

<span data-ttu-id="74be7-223">**图 10**：选中 "启用删除" 复选框</span><span class="sxs-lookup"><span data-stu-id="74be7-223">**Figure 10**: Check the Enable Deleting Checkbox</span></span>

<span data-ttu-id="74be7-224">选中智能标记中的 "启用删除" 复选框会将 CommandField 添加到 GridView。</span><span class="sxs-lookup"><span data-stu-id="74be7-224">Checking the Enable Deleting checkbox from the smart tag adds a CommandField to the GridView.</span></span> <span data-ttu-id="74be7-225">CommandField 在 GridView 中呈现一列，其中包含用于执行以下一项或多项任务的按钮：选择记录、编辑记录和删除记录。</span><span class="sxs-lookup"><span data-stu-id="74be7-225">The CommandField renders a column in the GridView with buttons for performing one or more of the following tasks: selecting a record, editing a record, and deleting a record.</span></span> <span data-ttu-id="74be7-226">我们以前在[使用可选的 Master GridView 和详细信息 DetailView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md)教程中，通过使用可选的 master GridView 选择记录 CommandField 操作。</span><span class="sxs-lookup"><span data-stu-id="74be7-226">We previously saw the CommandField in action with selecting records in the [Master/Detail Using a Selectable Master GridView with a Details DetailView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md) tutorial.</span></span>

<span data-ttu-id="74be7-227">CommandField 包含许多 `ShowXButton` 属性，这些属性指示在 CommandField 中显示哪一系列按钮。</span><span class="sxs-lookup"><span data-stu-id="74be7-227">The CommandField contains a number of `ShowXButton` properties that indicate what series of buttons are displayed in the CommandField.</span></span> <span data-ttu-id="74be7-228">选中 "启用删除" 复选框，即已将 `ShowDeleteButton` 属性 `True` 的 CommandField 添加到 GridView 的列集合中。</span><span class="sxs-lookup"><span data-stu-id="74be7-228">By checking the Enable Deleting checkbox a CommandField whose `ShowDeleteButton` property is `True` has been added to the GridView's Columns collection.</span></span>

[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-vb/samples/sample5.aspx)]

<span data-ttu-id="74be7-229">此时，相信这一点，我们已将删除支持添加到 GridView 中！</span><span class="sxs-lookup"><span data-stu-id="74be7-229">At this point, believe it or not, we're done with adding deleting support to the GridView!</span></span> <span data-ttu-id="74be7-230">如图11所示，当通过浏览器访问此页时，将显示一列 "删除" 按钮。</span><span class="sxs-lookup"><span data-stu-id="74be7-230">As Figure 11 shows, when visiting this page through a browser a column of Delete buttons is present.</span></span>

<span data-ttu-id="74be7-231">[![CommandField 添加了 "删除" 按钮的列](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image26.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="74be7-231">[![The CommandField Adds a Column of Delete Buttons](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image26.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image25.png)</span></span>

<span data-ttu-id="74be7-232">**图 11**： CommandField 添加了 "删除" 按钮的列（[单击以查看完全大小的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image27.png)）</span><span class="sxs-lookup"><span data-stu-id="74be7-232">**Figure 11**: The CommandField Adds a Column of Delete Buttons ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image27.png))</span></span>

<span data-ttu-id="74be7-233">如果你是从头开始构建本教程，则在测试此页面时单击 "删除" 按钮将引发异常。</span><span class="sxs-lookup"><span data-stu-id="74be7-233">If you've been building this tutorial from the ground up on your own, when testing this page clicking the Delete button will raise an exception.</span></span> <span data-ttu-id="74be7-234">继续阅读以了解为何会引发这些异常以及如何修复它们。</span><span class="sxs-lookup"><span data-stu-id="74be7-234">Continue reading to learn as to why these exceptions were raised and how to fix them.</span></span>

> [!NOTE]
> <span data-ttu-id="74be7-235">如果使用本教程附带的下载内容，则这些问题已考虑到。</span><span class="sxs-lookup"><span data-stu-id="74be7-235">If you're following along using the download accompanying this tutorial, these problems have already been accounted for.</span></span> <span data-ttu-id="74be7-236">不过，我建议您通读下面列出的详细信息，以帮助确定可能出现的问题以及合适的解决方法。</span><span class="sxs-lookup"><span data-stu-id="74be7-236">However, I encourage you to read through the details listed below to help identify problems that may arise and suitable workarounds.</span></span>

<span data-ttu-id="74be7-237">如果尝试删除某个产品时收到一个异常，其消息类似于 "*ObjectDataSource" ObjectDataSource1 "找不到具有参数的非泛型方法 ' DeleteProduct '： productID，原始\_productID*"，则可能是忘记从 ObjectDataSource 中删除 `OldValuesParameterFormatString` 属性。</span><span class="sxs-lookup"><span data-stu-id="74be7-237">If, when attempting to delete a product, you get an exception whose message is similar to "*ObjectDataSource 'ObjectDataSource1' could not find a non-generic method 'DeleteProduct' that has parameters: productID, original\_ProductID*," you likely forgot to remove the `OldValuesParameterFormatString` property from the ObjectDataSource.</span></span> <span data-ttu-id="74be7-238">指定 `OldValuesParameterFormatString` 属性后，ObjectDataSource 尝试同时将 `productID` 和 `original_ProductID` 输入参数传入 `DeleteProduct` 方法。</span><span class="sxs-lookup"><span data-stu-id="74be7-238">With the `OldValuesParameterFormatString` property specified, the ObjectDataSource attempts to pass in both `productID` and `original_ProductID` input parameters to the `DeleteProduct` method.</span></span> <span data-ttu-id="74be7-239">但 `DeleteProduct`仅接受单个输入参数，从而引发异常。</span><span class="sxs-lookup"><span data-stu-id="74be7-239">`DeleteProduct`, however, only accepts a single input parameter, hence the exception.</span></span> <span data-ttu-id="74be7-240">如果删除 `OldValuesParameterFormatString` 属性（或将其设置为 `{0}`），则将指示 ObjectDataSource 不尝试传入原始输入参数。</span><span class="sxs-lookup"><span data-stu-id="74be7-240">Removing the `OldValuesParameterFormatString` property (or setting it to `{0}`) instructs the ObjectDataSource to not attempt to pass in the original input parameter.</span></span>

<span data-ttu-id="74be7-241">[![确保已清除 OldValuesParameterFormatString 属性](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image29.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="74be7-241">[![Ensure That the OldValuesParameterFormatString Property Has Been Cleared Out](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image29.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image28.png)</span></span>

<span data-ttu-id="74be7-242">**图 12**：确保已清除 `OldValuesParameterFormatString` 属性（[单击以查看完全大小的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image30.png)）</span><span class="sxs-lookup"><span data-stu-id="74be7-242">**Figure 12**: Ensure That the `OldValuesParameterFormatString` Property Has Been Cleared Out ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image30.png))</span></span>

<span data-ttu-id="74be7-243">即使您已删除 `OldValuesParameterFormatString` 属性，但在尝试删除包含以下消息的产品时仍会出现异常： "*delete 语句与引用约束的 FK\_Order\_详细信息\_产品"* 。Northwind 数据库包含 `Order Details` 和 `Products` 表之间的外键约束，这意味着，如果 `Order Details` 表中有一个或多个记录，则无法从系统中删除该产品。</span><span class="sxs-lookup"><span data-stu-id="74be7-243">Even if you had removed the `OldValuesParameterFormatString` property, you still will get an exception when trying to delete a product with the message: "*The DELETE statement conflicted with the REFERENCE constraint 'FK\_Order\_Details\_Products'*." The Northwind database contains a foreign key constraint between the `Order Details` and `Products` table, meaning that a product cannot be deleted from the system if there are one or more records for it in the `Order Details` table.</span></span> <span data-ttu-id="74be7-244">由于 Northwind 数据库中的每个产品在 `Order Details`中至少有一条记录，因此在我们首次删除该产品的关联订单详细信息记录之前，我们无法删除任何产品。</span><span class="sxs-lookup"><span data-stu-id="74be7-244">Since every product in the Northwind database has at least one record in `Order Details`, we cannot delete any products until we first delete the product's associated order details records.</span></span>

<span data-ttu-id="74be7-245">[![Foreign Key 约束禁止删除产品](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image32.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="74be7-245">[![A Foreign Key Constraint Prohibits the Deletion of Products](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image32.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image31.png)</span></span>

<span data-ttu-id="74be7-246">**图 13**：外键约束禁止删除产品（[单击查看完全尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image33.png)）</span><span class="sxs-lookup"><span data-stu-id="74be7-246">**Figure 13**: A Foreign Key Constraint Prohibits the Deletion of Products ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image33.png))</span></span>

<span data-ttu-id="74be7-247">对于本教程，我们只需删除 `Order Details` 表中的所有记录。</span><span class="sxs-lookup"><span data-stu-id="74be7-247">For our tutorial, let's just delete all of the records from the `Order Details` table.</span></span> <span data-ttu-id="74be7-248">在实际应用程序中，我们需要：</span><span class="sxs-lookup"><span data-stu-id="74be7-248">In a real-world application we'd need to either:</span></span>

- <span data-ttu-id="74be7-249">有另一个用于管理订单详细信息的屏幕</span><span class="sxs-lookup"><span data-stu-id="74be7-249">Have another screen to manage order details information</span></span>
- <span data-ttu-id="74be7-250">增加 `DeleteProduct` 方法，使其包含用于删除指定产品的订单详细信息的逻辑</span><span class="sxs-lookup"><span data-stu-id="74be7-250">Augment the `DeleteProduct` method to include logic to delete the specified product's order details</span></span>
- <span data-ttu-id="74be7-251">修改由 TableAdapter 使用的 SQL 查询，以包括删除指定产品的订单详细信息</span><span class="sxs-lookup"><span data-stu-id="74be7-251">Modify the SQL query used by the TableAdapter to include deletion of the specified product's order details</span></span>

<span data-ttu-id="74be7-252">只需从 `Order Details` 表中删除所有记录即可规避外键约束。</span><span class="sxs-lookup"><span data-stu-id="74be7-252">Let's just delete all of the records from the `Order Details` table to circumvent the foreign key constraint.</span></span> <span data-ttu-id="74be7-253">在 Visual Studio 中转到服务器资源管理器，右键单击 "`NORTHWND.MDF`" 节点，然后选择 "新建查询"。</span><span class="sxs-lookup"><span data-stu-id="74be7-253">Go to the Server Explorer in Visual Studio, right-click on the `NORTHWND.MDF` node, and choose New Query.</span></span> <span data-ttu-id="74be7-254">然后，在查询窗口中运行以下 SQL 语句： `DELETE FROM [Order Details]`</span><span class="sxs-lookup"><span data-stu-id="74be7-254">Then, in the query window, run the following SQL statement: `DELETE FROM [Order Details]`</span></span>

<span data-ttu-id="74be7-255">[![从订单详细信息表中删除所有记录](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image35.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="74be7-255">[![Delete All Records from the Order Details Table](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image35.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image34.png)</span></span>

<span data-ttu-id="74be7-256">**图 14**：从 `Order Details` 表中删除所有记录（[单击以查看完全大小的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image36.png)）</span><span class="sxs-lookup"><span data-stu-id="74be7-256">**Figure 14**: Delete All Records from the `Order Details` Table ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image36.png))</span></span>

<span data-ttu-id="74be7-257">清除 `Order Details` 表后，单击 "删除" 按钮将删除该产品而不发生错误。</span><span class="sxs-lookup"><span data-stu-id="74be7-257">After clearing out the `Order Details` table clicking on the Delete button will delete the product without error.</span></span> <span data-ttu-id="74be7-258">如果单击 "删除" 按钮不会删除该产品，请检查以确保 GridView 的 `DataKeyNames` 属性设置为主键字段（`ProductID`）。</span><span class="sxs-lookup"><span data-stu-id="74be7-258">If clicking on the Delete button does not delete the product, check to ensure that the GridView's `DataKeyNames` property is set to the primary key field (`ProductID`).</span></span>

> [!NOTE]
> <span data-ttu-id="74be7-259">单击 "删除" 按钮时，回发可以并删除记录。</span><span class="sxs-lookup"><span data-stu-id="74be7-259">When clicking on the Delete button a postback ensues and the record is deleted.</span></span> <span data-ttu-id="74be7-260">这可能很危险，因为很容易意外地单击错误行的 "删除" 按钮。</span><span class="sxs-lookup"><span data-stu-id="74be7-260">This can be dangerous since it is easy to accidentally click on the wrong row's Delete button.</span></span> <span data-ttu-id="74be7-261">在将来的教程中，我们将了解如何在删除记录时添加客户端确认。</span><span class="sxs-lookup"><span data-stu-id="74be7-261">In a future tutorial we'll see how to add a client-side confirmation when deleting a record.</span></span>

## <a name="editing-data-with-the-gridview"></a><span data-ttu-id="74be7-262">用 GridView 编辑数据</span><span class="sxs-lookup"><span data-stu-id="74be7-262">Editing Data with the GridView</span></span>

<span data-ttu-id="74be7-263">除了删除外，GridView 控件还提供内置的行级编辑支持。</span><span class="sxs-lookup"><span data-stu-id="74be7-263">Along with deleting, the GridView control also provides built-in row-level editing support.</span></span> <span data-ttu-id="74be7-264">将 GridView 配置为支持编辑会添加一个编辑按钮的列。</span><span class="sxs-lookup"><span data-stu-id="74be7-264">Configuring a GridView to support editing adds a column of Edit buttons.</span></span> <span data-ttu-id="74be7-265">从最终用户的角度来看，单击行的 "编辑" 按钮将使该行变为可编辑状态，将单元格转换为包含现有值的文本框，并将 "编辑" 按钮替换为 "更新" 和 "取消" 按钮。</span><span class="sxs-lookup"><span data-stu-id="74be7-265">From the end user's perspective, clicking a row's Edit button causes that row to become editable, turning the cells into textboxes containing the existing values and replacing the Edit button with Update and Cancel buttons.</span></span> <span data-ttu-id="74be7-266">进行所需的更改后，最终用户可以单击 "更新" 按钮以提交更改，或者单击 "取消" 按钮以放弃更改。</span><span class="sxs-lookup"><span data-stu-id="74be7-266">After making their desired changes, the end user can click the Update button to commit the changes or the Cancel button to discard them.</span></span> <span data-ttu-id="74be7-267">无论是哪种情况，在单击 "更新" 或 "取消" 后，GridView 都将恢复到其预编辑状态。</span><span class="sxs-lookup"><span data-stu-id="74be7-267">In either case, after clicking Update or Cancel the GridView returns to its pre-editing state.</span></span>

<span data-ttu-id="74be7-268">从我们的角度来看，当最终用户单击特定行的 "编辑" 按钮时，回发可以和 GridView 执行以下步骤：</span><span class="sxs-lookup"><span data-stu-id="74be7-268">From our perspective as the page developer, when the end user clicks the Edit button for a particular row, a postback ensues and the GridView performs the following steps:</span></span>

1. <span data-ttu-id="74be7-269">GridView 的 `EditItemIndex` 属性分配给单击了 "编辑" 按钮的行的索引</span><span class="sxs-lookup"><span data-stu-id="74be7-269">The GridView's `EditItemIndex` property is assigned to the index of the row whose Edit button was clicked</span></span>
2. <span data-ttu-id="74be7-270">GridView 通过调用其 `Select()` 方法将自身重新绑定到 ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="74be7-270">The GridView rebinds itself to the ObjectDataSource by invoking its `Select()` method</span></span>
3. <span data-ttu-id="74be7-271">与 `EditItemIndex` 匹配的行索引以 "编辑模式" 呈现。</span><span class="sxs-lookup"><span data-stu-id="74be7-271">The row index that matches the `EditItemIndex` is rendered in "edit mode."</span></span> <span data-ttu-id="74be7-272">在此模式下，"编辑" 按钮替换为 "更新" 和 "取消" 按钮，BoundFields，其 `ReadOnly` 属性为 False （默认值）呈现为 TextBox Web 控件，其 `Text` 属性分配给数据字段的值。</span><span class="sxs-lookup"><span data-stu-id="74be7-272">In this mode, the Edit button is replaced by Update and Cancel buttons and BoundFields whose `ReadOnly` properties are False (the default) are rendered as TextBox Web controls whose `Text` properties are assigned to the data fields' values.</span></span>

<span data-ttu-id="74be7-273">此时，标记将返回到浏览器，从而允许最终用户对该行的数据进行任何更改。</span><span class="sxs-lookup"><span data-stu-id="74be7-273">At this point the markup is returned to the browser, allowing the end user to make any changes to the row's data.</span></span> <span data-ttu-id="74be7-274">当用户单击 "更新" 按钮时，将发生回发，GridView 执行以下步骤：</span><span class="sxs-lookup"><span data-stu-id="74be7-274">When the user clicks the Update button, a postback occurs and the GridView performs the following steps:</span></span>

1. <span data-ttu-id="74be7-275">将由最终用户输入的值分配给该 ObjectDataSource 的 `UpdateParameters` 值到 GridView 的编辑界面中</span><span class="sxs-lookup"><span data-stu-id="74be7-275">The ObjectDataSource's `UpdateParameters` value(s) are assigned the values entered by the end user into the GridView's editing interface</span></span>
2. <span data-ttu-id="74be7-276">将调用 ObjectDataSource 的 `Update()` 方法，并更新指定的记录</span><span class="sxs-lookup"><span data-stu-id="74be7-276">The ObjectDataSource's `Update()` method is invoked, updating the specified record</span></span>
3. <span data-ttu-id="74be7-277">GridView 通过调用其 `Select()` 方法将自身重新绑定到 ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="74be7-277">The GridView rebinds itself to the ObjectDataSource by invoking its `Select()` method</span></span>

<span data-ttu-id="74be7-278">分配到步骤1中的 `UpdateParameters` 的主键值来自 `DataKeyNames` 属性中指定的值，而非主键值来自于所编辑的行的 TextBox Web 控件中的文本。</span><span class="sxs-lookup"><span data-stu-id="74be7-278">The primary key values assigned to the `UpdateParameters` in Step 1 come from the values specified in the `DataKeyNames` property, whereas the non-primary key values come from the text in the TextBox Web controls for the edited row.</span></span> <span data-ttu-id="74be7-279">与删除一样，必须正确设置 GridView 的 `DataKeyNames` 属性。</span><span class="sxs-lookup"><span data-stu-id="74be7-279">As with deleting, it is vital that a GridView's `DataKeyNames` property be correctly set.</span></span> <span data-ttu-id="74be7-280">如果缺少此参数，则会在步骤1中为 `UpdateParameters` 的主键值分配 `Nothing` 值，而不会导致步骤2中的任何更新记录。</span><span class="sxs-lookup"><span data-stu-id="74be7-280">If it's missing, the `UpdateParameters` primary key value will be assigned a value of `Nothing` in Step 1, which in turn will not result in any updated records in Step 2.</span></span>

<span data-ttu-id="74be7-281">只需选中 GridView 智能标记中的 "启用编辑" 复选框，即可激活编辑功能。</span><span class="sxs-lookup"><span data-stu-id="74be7-281">Editing functionality can be activated by simply checking the Enable Editing checkbox in the GridView's smart tag.</span></span>

![选中 "启用编辑" 复选框](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image37.png)

<span data-ttu-id="74be7-283">**图 15**：选中 "启用编辑" 复选框</span><span class="sxs-lookup"><span data-stu-id="74be7-283">**Figure 15**: Check the Enable Editing Checkbox</span></span>

<span data-ttu-id="74be7-284">选中 "启用编辑" 复选框将添加 CommandField （如果需要），并将其 `ShowEditButton` 属性设置为 `True`。</span><span class="sxs-lookup"><span data-stu-id="74be7-284">Checking the Enable Editing checkbox will add a CommandField (if needed) and set its `ShowEditButton` property to `True`.</span></span> <span data-ttu-id="74be7-285">如前文所述，CommandField 包含许多 `ShowXButton` 属性，这些属性指示 CommandField 中显示哪一系列按钮。</span><span class="sxs-lookup"><span data-stu-id="74be7-285">As we saw earlier, the CommandField contains a number of `ShowXButton` properties that indicate what series of buttons are displayed in the CommandField.</span></span> <span data-ttu-id="74be7-286">选中 "启用编辑" 复选框会将 `ShowEditButton` 属性添加到现有的 CommandField：</span><span class="sxs-lookup"><span data-stu-id="74be7-286">Checking the Enable Editing checkbox adds the `ShowEditButton` property to the existing CommandField:</span></span>

[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-vb/samples/sample6.aspx)]

<span data-ttu-id="74be7-287">这就是添加基本编辑支持的全部。</span><span class="sxs-lookup"><span data-stu-id="74be7-287">That's all there is to adding rudimentary editing support.</span></span> <span data-ttu-id="74be7-288">如 Figure16 所示，编辑界面相当于每个 BoundField，其 `ReadOnly` 属性设置为 `False` （默认值）呈现为一个文本框。</span><span class="sxs-lookup"><span data-stu-id="74be7-288">As Figure16 shows, the editing interface is rather crude each BoundField whose `ReadOnly` property is set to `False` (the default) is rendered as a TextBox.</span></span> <span data-ttu-id="74be7-289">这包括 `CategoryID` 和 `SupplierID`等字段，它们是其他表的键。</span><span class="sxs-lookup"><span data-stu-id="74be7-289">This includes fields like `CategoryID` and `SupplierID`, which are keys to other tables.</span></span>

<span data-ttu-id="74be7-290">[![单击 "编辑" 按钮时，将在编辑模式下显示该行](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image39.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image38.png)</span><span class="sxs-lookup"><span data-stu-id="74be7-290">[![Clicking Chai s Edit Button Displays the Row in Edit Mode](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image39.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image38.png)</span></span>

<span data-ttu-id="74be7-291">**图 16**：单击 "Chai s 编辑" 按钮以编辑模式显示行（[单击以查看完全大小的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image40.png)）</span><span class="sxs-lookup"><span data-stu-id="74be7-291">**Figure 16**: Clicking Chai s Edit Button Displays the Row in Edit Mode ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image40.png))</span></span>

<span data-ttu-id="74be7-292">除了要求用户直接编辑外键值外，还需要通过以下方式来实现编辑接口的接口：</span><span class="sxs-lookup"><span data-stu-id="74be7-292">In addition to asking users to edit foreign key values directly, the editing interface's interface is lacking in the following ways:</span></span>

- <span data-ttu-id="74be7-293">如果用户输入数据库中不存在的 `CategoryID` 或 `SupplierID`，则 `UPDATE` 将违反外键约束，导致引发异常。</span><span class="sxs-lookup"><span data-stu-id="74be7-293">If the user enters a `CategoryID` or `SupplierID` that does not exist in the database, the `UPDATE` will violate a foreign key constraint, causing an exception to be raised.</span></span>
- <span data-ttu-id="74be7-294">编辑界面不包括任何验证。</span><span class="sxs-lookup"><span data-stu-id="74be7-294">The editing interface doesn't include any validation.</span></span> <span data-ttu-id="74be7-295">如果未提供所需的值（如 `ProductName`），或输入需要数值的字符串值（例如，输入 "太多！"</span><span class="sxs-lookup"><span data-stu-id="74be7-295">If you don't provide a required value (such as `ProductName`), or enter a string value where a numeric value is expected (such as entering "Too much!"</span></span> <span data-ttu-id="74be7-296">在 "`UnitPrice`" 文本框中），将引发异常。</span><span class="sxs-lookup"><span data-stu-id="74be7-296">into the `UnitPrice` textbox), an exception will be thrown.</span></span> <span data-ttu-id="74be7-297">将来的教程将介绍如何向编辑用户界面添加验证控件。</span><span class="sxs-lookup"><span data-stu-id="74be7-297">A future tutorial will examine how to add validation controls to the editing user interface.</span></span>
- <span data-ttu-id="74be7-298">目前，*所有*不是只读的产品字段都必须包含在 GridView 中。</span><span class="sxs-lookup"><span data-stu-id="74be7-298">Currently, *all* product fields that are not read-only must be included in the GridView.</span></span> <span data-ttu-id="74be7-299">如果要从 GridView 中删除字段（例如 `UnitPrice`），则在更新数据时，GridView 不会将 `UnitPrice` `UpdateParameters` 值，这会将数据库记录的 `UnitPrice` 更改为 `NULL` 值。</span><span class="sxs-lookup"><span data-stu-id="74be7-299">If we were to remove a field from the GridView, say `UnitPrice`, when updating the data the GridView would not set the `UnitPrice` `UpdateParameters` value, which would change the database record's `UnitPrice` to a `NULL` value.</span></span> <span data-ttu-id="74be7-300">同样，如果将某个必填字段（如 `ProductName`）从 GridView 中删除，则更新将失败，并且会出现与上面提到的 "*列 ' ProductName ' 不允许空值*" 这一错误。</span><span class="sxs-lookup"><span data-stu-id="74be7-300">Similarly, if a required field, such as `ProductName`, is removed from the GridView, the update will fail with the same "*Column 'ProductName' does not allow nulls*" exception mentioned above.</span></span>
- <span data-ttu-id="74be7-301">编辑界面的格式设置不太必要。</span><span class="sxs-lookup"><span data-stu-id="74be7-301">The editing interface formatting leaves a lot to be desired.</span></span> <span data-ttu-id="74be7-302">`UnitPrice` 显示有四个小数点。</span><span class="sxs-lookup"><span data-stu-id="74be7-302">The `UnitPrice` is shown with four decimal points.</span></span> <span data-ttu-id="74be7-303">理想情况下，`CategoryID` 和 `SupplierID` 值将包含列出系统中的类别和供应商的 DropDownLists。</span><span class="sxs-lookup"><span data-stu-id="74be7-303">Ideally the `CategoryID` and `SupplierID` values would contain DropDownLists that list the categories and suppliers in the system.</span></span>

<span data-ttu-id="74be7-304">这些都是我们现在将需要使用的所有缺点，但会在以后的教程中解决。</span><span class="sxs-lookup"><span data-stu-id="74be7-304">These are all shortcomings that we'll have to live with for now, but will be addressed in future tutorials.</span></span>

## <a name="inserting-editing-and-deleting-data-with-the-detailsview"></a><span data-ttu-id="74be7-305">用 DetailsView 插入、编辑和删除数据</span><span class="sxs-lookup"><span data-stu-id="74be7-305">Inserting, Editing, and Deleting Data with the DetailsView</span></span>

<span data-ttu-id="74be7-306">如前文所述，DetailsView 控件一次显示一条记录，与 GridView 一样，允许编辑和删除当前显示的记录。</span><span class="sxs-lookup"><span data-stu-id="74be7-306">As we've seen in earlier tutorials, the DetailsView control displays one record at a time and, like the GridView, allows for editing and deleting of the currently displayed record.</span></span> <span data-ttu-id="74be7-307">最终用户在 DetailsView 中编辑和删除项以及 ASP.NET 端工作流的体验与 GridView 的工作方式相同。</span><span class="sxs-lookup"><span data-stu-id="74be7-307">Both the end user's experience with editing and deleting items from a DetailsView and the workflow from the ASP.NET side is identical to that of the GridView.</span></span> <span data-ttu-id="74be7-308">如果 DetailsView 不同于 GridView，则它还提供内置的插入支持。</span><span class="sxs-lookup"><span data-stu-id="74be7-308">Where the DetailsView differs from the GridView is that it also provides built-in inserting support.</span></span>

<span data-ttu-id="74be7-309">若要演示 GridView 的数据修改功能，请首先将 DetailsView 添加到现有 GridView 之上的 `Basics.aspx` 页面，并通过 DetailsView 的智能标记将其绑定到现有的 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="74be7-309">To demonstrate the data modification capabilities of the GridView, start by adding a DetailsView to the `Basics.aspx` page above the existing GridView and bind it to the existing ObjectDataSource through the DetailsView's smart tag.</span></span> <span data-ttu-id="74be7-310">接下来，清除 DetailsView 的 `Height` 和 `Width` 属性，然后从智能标记中选中 "启用分页" 选项。</span><span class="sxs-lookup"><span data-stu-id="74be7-310">Next, clear out the DetailsView's `Height` and `Width` properties, and check the Enable Paging option from the smart tag.</span></span> <span data-ttu-id="74be7-311">若要启用编辑、插入和删除支持，只需选中 "启用编辑"、"启用插入" 和 "启用删除" 复选框。</span><span class="sxs-lookup"><span data-stu-id="74be7-311">To enable editing, inserting, and deleting support, simply check the Enable Editing, Enable Inserting, and Enable Deleting checkboxes in the smart tag.</span></span>

![配置 DetailsView 以支持编辑、插入和删除](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image41.png)

<span data-ttu-id="74be7-313">**图 17**：配置 DetailsView 以支持编辑、插入和删除</span><span class="sxs-lookup"><span data-stu-id="74be7-313">**Figure 17**: Configure the DetailsView to Support Editing, Inserting, and Deleting</span></span>

<span data-ttu-id="74be7-314">对于 GridView，添加编辑、插入或删除支持会将 CommandField 添加到 DetailsView，如以下声明性语法所示：</span><span class="sxs-lookup"><span data-stu-id="74be7-314">As with the GridView, adding editing, inserting, or deleting support adds a CommandField to the DetailsView, as the following declarative syntax shows:</span></span>

[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-vb/samples/sample7.aspx)]

<span data-ttu-id="74be7-315">请注意，对于 DetailsView，默认情况下，CommandField 显示在列集合的末尾。</span><span class="sxs-lookup"><span data-stu-id="74be7-315">Note that for the DetailsView the CommandField appears at the end of the Columns collection by default.</span></span> <span data-ttu-id="74be7-316">由于 DetailsView 的字段呈现为行，CommandField 显示为行，其中显示了 DetailsView 底部的 "插入"、"编辑" 和 "删除" 按钮。</span><span class="sxs-lookup"><span data-stu-id="74be7-316">Since the DetailsView's fields are rendered as rows, the CommandField appears as a row with Insert, Edit, and Delete buttons at the bottom of the DetailsView.</span></span>

<span data-ttu-id="74be7-317">[![配置 DetailsView 以支持编辑、插入和删除](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image43.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image42.png)</span><span class="sxs-lookup"><span data-stu-id="74be7-317">[![Configure the DetailsView to Support Editing, Inserting, and Deleting](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image43.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image42.png)</span></span>

<span data-ttu-id="74be7-318">**图 18**：配置 DetailsView 以支持编辑、插入和删除（[单击查看完全尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image44.png)）</span><span class="sxs-lookup"><span data-stu-id="74be7-318">**Figure 18**: Configure the DetailsView to Support Editing, Inserting, and Deleting ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image44.png))</span></span>

<span data-ttu-id="74be7-319">单击 "删除" 按钮会启动与 GridView 相同的事件序列：回发;接下来，根据 `DataKeyNames` 值填充其 ObjectDataSource 的 `DeleteParameters`;并通过调用其 ObjectDataSource 的 `Delete()` 方法来完成，这会从数据库中实际删除产品。</span><span class="sxs-lookup"><span data-stu-id="74be7-319">Clicking on the Delete button starts the same sequence of events as with the GridView: a postback; followed by the DetailsView populating its ObjectDataSource's `DeleteParameters` based on the `DataKeyNames` values; and completed with a call its ObjectDataSource's `Delete()` method, which actually removes the product from the database.</span></span> <span data-ttu-id="74be7-320">在 DetailsView 中进行编辑时，其工作方式与 GridView 的工作方式相同。</span><span class="sxs-lookup"><span data-stu-id="74be7-320">Editing in the DetailsView also works in a fashion identical to that of the GridView.</span></span>

<span data-ttu-id="74be7-321">对于插入，最终用户会看到一个新按钮，单击该按钮时，将在 "插入模式" 下呈现 DetailsView。</span><span class="sxs-lookup"><span data-stu-id="74be7-321">For inserting, the end user is presented with a New button that, when clicked, renders the DetailsView in "insert mode."</span></span> <span data-ttu-id="74be7-322">使用 "插入模式" 时，"新建" 按钮将被 "插入" 和 "取消" 按钮替换，并且仅显示 `InsertVisible` 属性设置为 `True` （默认值）的 BoundFields。</span><span class="sxs-lookup"><span data-stu-id="74be7-322">With "insert mode" the New button is replaced by Insert and Cancel buttons and only those BoundFields whose `InsertVisible` property is set to `True` (the default) are displayed.</span></span> <span data-ttu-id="74be7-323">在通过智能标记将 DetailsView 绑定到数据源时，这些数据字段（如 `ProductID`）会将其[InsertVisible 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datacontrolfield.insertvisible(VS.80).aspx)设置为 `False`。</span><span class="sxs-lookup"><span data-stu-id="74be7-323">Those data fields identified as auto-increment fields, such as `ProductID`, have their [InsertVisible property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datacontrolfield.insertvisible(VS.80).aspx) set to `False` when binding the DetailsView to the data source through the smart tag.</span></span>

<span data-ttu-id="74be7-324">通过智能标记将数据源绑定到 DetailsView 时，Visual Studio 会将 `InsertVisible` 属性设置为仅 `False` 自动增量字段。</span><span class="sxs-lookup"><span data-stu-id="74be7-324">When binding a data source to a DetailsView through the smart tag, Visual Studio sets the `InsertVisible` property to `False` only for auto-increment fields.</span></span> <span data-ttu-id="74be7-325">只读字段（如 `CategoryName` 和 `SupplierName`）将显示在 "插入模式" 用户界面中，除非其 `InsertVisible` 属性显式设置为 `False`。</span><span class="sxs-lookup"><span data-stu-id="74be7-325">Read-only fields, like `CategoryName` and `SupplierName`, will be displayed in the "insert mode" user interface unless their `InsertVisible` property is explicitly set to `False`.</span></span> <span data-ttu-id="74be7-326">请花点时间将这两个字段的 `InsertVisible` 属性设置为 `False`，方法是通过 DetailsView 的声明性语法，或通过智能标记中的编辑字段链接。</span><span class="sxs-lookup"><span data-stu-id="74be7-326">Take a moment to set these two fields' `InsertVisible` properties to `False`, either through the DetailsView's declarative syntax or through the Edit Fields link in the smart tag.</span></span> <span data-ttu-id="74be7-327">图19显示了如何通过单击 "编辑字段" 链接将 `InsertVisible` 属性设置为 `False`。</span><span class="sxs-lookup"><span data-stu-id="74be7-327">Figure 19 shows setting the `InsertVisible` properties to `False` by clicking on the Edit Fields link.</span></span>

<span data-ttu-id="74be7-328">[![Northwind 商贸现在提供 Acme 茶](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image46.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="74be7-328">[![Northwind Traders Now Offers Acme Tea](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image46.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image45.png)</span></span>

<span data-ttu-id="74be7-329">**图 19**： Northwind 商贸现在提供 Acme 茶（[单击查看全尺寸图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image47.png)）</span><span class="sxs-lookup"><span data-stu-id="74be7-329">**Figure 19**: Northwind Traders Now Offers Acme Tea ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image47.png))</span></span>

<span data-ttu-id="74be7-330">设置 `InsertVisible` 属性后，请在浏览器中查看 `Basics.aspx` 页面，然后单击 "新建" 按钮。</span><span class="sxs-lookup"><span data-stu-id="74be7-330">After setting the `InsertVisible` properties, view the `Basics.aspx` page in a browser and click the New button.</span></span> <span data-ttu-id="74be7-331">图20显示了将新饮料（Acme 茶）添加到产品系列时的 DetailsView。</span><span class="sxs-lookup"><span data-stu-id="74be7-331">Figure 20 shows the DetailsView when adding a new beverage, Acme Tea, to our product line.</span></span>

<span data-ttu-id="74be7-332">[![Northwind 商贸现在提供 Acme 茶](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image49.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image48.png)</span><span class="sxs-lookup"><span data-stu-id="74be7-332">[![Northwind Traders Now Offers Acme Tea](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image49.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image48.png)</span></span>

<span data-ttu-id="74be7-333">**图 20**： Northwind 商贸现在提供 Acme 茶（[单击查看全尺寸图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image50.png)）</span><span class="sxs-lookup"><span data-stu-id="74be7-333">**Figure 20**: Northwind Traders Now Offers Acme Tea ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image50.png))</span></span>

<span data-ttu-id="74be7-334">输入 Acme 茶的详细信息并单击 "插入" 按钮后，将向 `Products` 数据库表添加回发可以和新记录。</span><span class="sxs-lookup"><span data-stu-id="74be7-334">After entering the details for Acme Tea and clicking the Insert button, a postback ensues and the new record is added to the `Products` database table.</span></span> <span data-ttu-id="74be7-335">由于此 DetailsView 列出了产品，这些产品的顺序与数据库表中的产品顺序相同，因此我们必须向上一产品进行页，以便查看新产品。</span><span class="sxs-lookup"><span data-stu-id="74be7-335">Since this DetailsView lists the products in order with which they exist in the database table, we must page to the last product in order to see the new product.</span></span>

<span data-ttu-id="74be7-336">[Acme 茶 ![详细信息](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image52.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image51.png)</span><span class="sxs-lookup"><span data-stu-id="74be7-336">[![Details for Acme Tea](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image52.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image51.png)</span></span>

<span data-ttu-id="74be7-337">**图 21**： Acme 茶的详细信息（[单击以查看完全大小的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image53.png)）</span><span class="sxs-lookup"><span data-stu-id="74be7-337">**Figure 21**: Details for Acme Tea ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image53.png))</span></span>

> [!NOTE]
> <span data-ttu-id="74be7-338">DetailsView 的[CurrentMode 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.currentmode(VS.80).aspx)指示要显示的接口，可以是以下值之一： `Edit`、`Insert`或 `ReadOnly`。</span><span class="sxs-lookup"><span data-stu-id="74be7-338">The DetailsView's [CurrentMode property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.currentmode(VS.80).aspx) indicates the interface being displayed and can be one of the following values: `Edit`, `Insert`, or `ReadOnly`.</span></span> <span data-ttu-id="74be7-339">[DefaultMode 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.defaultmode(VS.80).aspx)指示在编辑或插入完成后，detailsview 返回到的模式，适用于显示永久性处于编辑或插入模式的 detailsview。</span><span class="sxs-lookup"><span data-stu-id="74be7-339">The [DefaultMode property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.defaultmode(VS.80).aspx) indicates the mode the DetailsView returns to after an edit or insert has been completed and is useful for displaying a DetailsView that is permanently in edit or insert mode.</span></span>

<span data-ttu-id="74be7-340">对 DetailsView 的 "插入和编辑" 功能的点击和编辑功能受到与 GridView 相同的限制：用户必须通过文本框输入现有 `CategoryID` 和 `SupplierID` 值;接口缺少任何验证逻辑;不允许 `NULL` 值或没有在数据库级别指定默认值的所有产品字段都必须包含在插入接口中，依此类推。</span><span class="sxs-lookup"><span data-stu-id="74be7-340">The point and click inserting and editing capabilities of the DetailsView suffer from the same limitations as the GridView: the user must enter existing `CategoryID` and `SupplierID` values through a textbox; the interface lacks any validation logic; all product fields that do not allow `NULL` values or don't have a default value specified at the database level must be included in the inserting interface, and so on.</span></span>

<span data-ttu-id="74be7-341">在将来的文章中，我们将探讨的用于扩展和增强 GridView 编辑界面的技术也适用于 DetailsView 控件的编辑和插入界面。</span><span class="sxs-lookup"><span data-stu-id="74be7-341">The techniques we will examine for extending and enhancing the GridView's editing interface in future articles can be applied to the DetailsView control's editing and inserting interfaces as well.</span></span>

## <a name="using-the-formview-for-a-more-flexible-data-modification-user-interface"></a><span data-ttu-id="74be7-342">使用 FormView 实现更灵活的数据修改用户界面</span><span class="sxs-lookup"><span data-stu-id="74be7-342">Using the FormView for a More Flexible Data Modification User Interface</span></span>

<span data-ttu-id="74be7-343">FormView 提供对插入、编辑和删除数据的内置支持，但由于它使用的是模板而不是字段，因此不能添加 BoundFields 或由 GridView 和 DetailsView 控件使用的 CommandField 来提供数据。修改接口。</span><span class="sxs-lookup"><span data-stu-id="74be7-343">The FormView offers built-in support for inserting, editing, and deleting data, but because it uses templates instead of fields there's no place to add the BoundFields or the CommandField used by the GridView and DetailsView controls to provide the data modification interface.</span></span> <span data-ttu-id="74be7-344">相反，此接口用于收集用户输入的 Web 控件，以及在添加新项或编辑现有项时，还必须手动将新的、编辑、删除、插入、更新和取消按钮添加到相应的模板。</span><span class="sxs-lookup"><span data-stu-id="74be7-344">Instead, this interface the Web controls for collecting user input when adding a new item or editing an existing one along with the New, Edit, Delete, Insert, Update, and Cancel buttons must be added manually to the appropriate templates.</span></span> <span data-ttu-id="74be7-345">幸运的是，在通过其智能标记将 FormView 绑定到数据源时，Visual Studio 将自动创建所需的接口。</span><span class="sxs-lookup"><span data-stu-id="74be7-345">Fortunately, Visual Studio will automatically create the needed interface when binding the FormView to a data source through the drop-down list in its smart tag.</span></span>

<span data-ttu-id="74be7-346">若要演示这些技术，请先将 FormView 添加到 `Basics.aspx` 页，然后从 FormView 的智能标记将其绑定到已创建的 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="74be7-346">To illustrate these techniques, start by adding a FormView to the `Basics.aspx` page and, from the FormView's smart tag, bind it to the ObjectDataSource already created.</span></span> <span data-ttu-id="74be7-347">这将为带有 TextBox Web 控件的 FormView 生成 `EditItemTemplate`、`InsertItemTemplate`和 `ItemTemplate`，以便为新的、编辑、删除、插入、更新和取消按钮收集用户的输入和按钮 Web 控件。</span><span class="sxs-lookup"><span data-stu-id="74be7-347">This will generate an `EditItemTemplate`, `InsertItemTemplate`, and `ItemTemplate` for the FormView with TextBox Web controls for collecting the user's input and Button Web controls for the New, Edit, Delete, Insert, Update, and Cancel buttons.</span></span> <span data-ttu-id="74be7-348">此外，FormView 的 `DataKeyNames` 属性设置为 ObjectDataSource 返回的对象的主键字段（`ProductID`）。</span><span class="sxs-lookup"><span data-stu-id="74be7-348">Additionally, the FormView's `DataKeyNames` property is set to the primary key field (`ProductID`) of the object returned by the ObjectDataSource.</span></span> <span data-ttu-id="74be7-349">最后，选中 FormView 的智能标记中的 "启用分页" 选项。</span><span class="sxs-lookup"><span data-stu-id="74be7-349">Lastly, check the Enable Paging option in the FormView's smart tag.</span></span>

<span data-ttu-id="74be7-350">下面显示了在 FormView 绑定到 ObjectDataSource 后，FormView 的 `ItemTemplate` 的声明性标记。</span><span class="sxs-lookup"><span data-stu-id="74be7-350">The following shows the declarative markup for the FormView's `ItemTemplate` after the FormView has been bound to the ObjectDataSource.</span></span> <span data-ttu-id="74be7-351">默认情况下，每个非布尔值 product 字段都绑定到标签 Web 控件的 `Text` 属性，而每个布尔值字段（`Discontinued`）都绑定到已禁用 CheckBox Web 控件的 `Checked` 属性。</span><span class="sxs-lookup"><span data-stu-id="74be7-351">By default, each non-Boolean value product field is bound to the `Text` property of a Label Web control while each Boolean value field (`Discontinued`) is bound to the `Checked` property of a disabled CheckBox Web control.</span></span> <span data-ttu-id="74be7-352">要使 "新建"、"编辑" 和 "删除" 按钮在被单击时触发某些 FormView 行为，必须分别将其 `CommandName` 值设置为 `New`、`Edit`和 `Delete`。</span><span class="sxs-lookup"><span data-stu-id="74be7-352">In order for the New, Edit, and Delete buttons to trigger certain FormView behavior when clicked, it is imperative that their `CommandName` values be set to `New`, `Edit`, and `Delete`, respectively.</span></span>

[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-vb/samples/sample8.aspx)]

<span data-ttu-id="74be7-353">图22显示了通过浏览器查看 FormView 的 `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="74be7-353">Figure 22 shows the FormView's `ItemTemplate` when viewed through a browser.</span></span> <span data-ttu-id="74be7-354">列出的每个 "产品" 字段都带有底部的 "新建"、"编辑" 和 "删除" 按钮。</span><span class="sxs-lookup"><span data-stu-id="74be7-354">Each product field is listed with the New, Edit, and Delete buttons at the bottom.</span></span>

<span data-ttu-id="74be7-355">[![下 FormView ItemTemplate 列出了每个 "产品" 字段以及 "新建"、"编辑" 和 "删除" 按钮](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image55.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image54.png)</span><span class="sxs-lookup"><span data-stu-id="74be7-355">[![The Defaut FormView ItemTemplate Lists Each Product Field Along with New, Edit, and Delete Buttons](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image55.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image54.png)</span></span>

<span data-ttu-id="74be7-356">**图 22**：下 FormView `ItemTemplate` 列出了每个 "产品" 字段以及 "新建"、"编辑" 和 "删除" 按钮（[单击以查看完全大小的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image56.png)）</span><span class="sxs-lookup"><span data-stu-id="74be7-356">**Figure 22**: The Defaut FormView `ItemTemplate` Lists Each Product Field Along with New, Edit, and Delete Buttons ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image56.png))</span></span>

<span data-ttu-id="74be7-357">例如，在 GridView 和 DetailsView 中，单击 "删除" 按钮或任何 `CommandName` 属性设置为 "删除" 的按钮、LinkButton 或 ImageButton 将导致回发，根据 FormView 的 `DataKeyNames` 值填充 ObjectDataSource 的 `DeleteParameters`，并调用 ObjectDataSource 的 `Delete()` 方法。</span><span class="sxs-lookup"><span data-stu-id="74be7-357">Like with the GridView and DetailsView, clicking the Delete button or any Button, LinkButton, or ImageButton whose `CommandName` property is set to Delete causes a postback, populates the ObjectDataSource's `DeleteParameters` based on the FormView's `DataKeyNames` value, and invokes the ObjectDataSource's `Delete()` method.</span></span>

<span data-ttu-id="74be7-358">单击 "编辑" 按钮时，会将回发可以，并将数据重新绑定到负责呈现编辑界面的 `EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="74be7-358">When the Edit button is clicked a postback ensues and the data is rebound to the `EditItemTemplate`, which is responsible for rendering the editing interface.</span></span> <span data-ttu-id="74be7-359">此接口包括用于编辑数据的 Web 控件以及 "更新" 和 "取消" 按钮。</span><span class="sxs-lookup"><span data-stu-id="74be7-359">This interface includes the Web controls for editing data along with the Update and Cancel buttons.</span></span> <span data-ttu-id="74be7-360">Visual Studio 生成的默认 `EditItemTemplate` 包含任何自动增量字段（`ProductID`）的标签、每个非布尔值字段的文本框，以及每个布尔值字段的复选框。</span><span class="sxs-lookup"><span data-stu-id="74be7-360">The default `EditItemTemplate` generated by Visual Studio contains a Label for any auto-increment fields (`ProductID`), a TextBox for each non-Boolean value field, and a CheckBox for each Boolean value field.</span></span> <span data-ttu-id="74be7-361">此行为与在 GridView 和 DetailsView 控件中自动生成的 BoundFields 非常相似。</span><span class="sxs-lookup"><span data-stu-id="74be7-361">This behavior is very similar to the auto-generated BoundFields in the GridView and DetailsView controls.</span></span>

> [!NOTE]
> <span data-ttu-id="74be7-362">FormView 自动生成 `EditItemTemplate` 的一个小问题是，它会为只读字段呈现 TextBox Web 控件，如 `CategoryName` 和 `SupplierName`。</span><span class="sxs-lookup"><span data-stu-id="74be7-362">One small issue with the FormView's auto-generation of the `EditItemTemplate` is that it renders TextBox Web controls for those fields that are read-only, such as `CategoryName` and `SupplierName`.</span></span> <span data-ttu-id="74be7-363">稍后我们将了解如何对此进行说明。</span><span class="sxs-lookup"><span data-stu-id="74be7-363">We'll see how to account for this shortly.</span></span>

<span data-ttu-id="74be7-364">`EditItemTemplate` 中的 TextBox 控件使用*双向数据*绑定将其 `Text` 属性绑定到其对应数据字段的值。</span><span class="sxs-lookup"><span data-stu-id="74be7-364">The TextBox controls in the `EditItemTemplate` have their `Text` property bound to the value of their corresponding data field using *two-way databinding*.</span></span> <span data-ttu-id="74be7-365">在将数据绑定到模板时，以及在填充 ObjectDataSource 用于插入或编辑记录的参数时，由 `<%# Bind("dataField") %>`表示的双向数据绑定将执行数据绑定。</span><span class="sxs-lookup"><span data-stu-id="74be7-365">Two-way databinding, denoted by `<%# Bind("dataField") %>`, performs databinding both when binding data to the template and when populating the ObjectDataSource's parameters for inserting or editing records.</span></span> <span data-ttu-id="74be7-366">也就是说，当用户在 `ItemTemplate`单击 "编辑" 按钮时，`Bind()` 方法返回指定的数据字段值。</span><span class="sxs-lookup"><span data-stu-id="74be7-366">That is, when the user clicks the Edit button from the `ItemTemplate`, the `Bind()` method returns the specified data field value.</span></span> <span data-ttu-id="74be7-367">用户进行更改并单击 "更新" 后，将向 ObjectDataSource 的 `UpdateParameters`应用与使用 `Bind()` 指定的数据字段对应的回发值。</span><span class="sxs-lookup"><span data-stu-id="74be7-367">After the user makes their changes and clicks Update, the values posted back that correspond to the data fields specified using `Bind()` are applied to the ObjectDataSource's `UpdateParameters`.</span></span> <span data-ttu-id="74be7-368">或者，通过 `<%# Eval("dataField") %>`表示的单向数据绑定仅在将数据绑定到模板时检索数据字段值，并且*不*会在回发时将用户输入的值返回到数据源的参数。</span><span class="sxs-lookup"><span data-stu-id="74be7-368">Alternatively, one-way databinding, denoted by `<%# Eval("dataField") %>`, only retrieves the data field values when binding data to the template and does *not* return the user-entered values to the data source's parameters on postback.</span></span>

<span data-ttu-id="74be7-369">以下声明性标记显示了 FormView 的 `EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="74be7-369">The following declarative markup shows the FormView's `EditItemTemplate`.</span></span> <span data-ttu-id="74be7-370">请注意，此处的数据绑定语法中使用的是 `Bind()` 方法，并且 "更新" 和 "取消" 按钮 Web 控件将相应地设置其 `CommandName` 属性。</span><span class="sxs-lookup"><span data-stu-id="74be7-370">Note that the `Bind()` method is used in the databinding syntax here and that the Update and Cancel Button Web controls have their `CommandName` properties set accordingly.</span></span>

[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-vb/samples/sample9.aspx)]

<span data-ttu-id="74be7-371">此时，我们的 `EditItemTemplate`会在我们尝试使用异常时引发异常。</span><span class="sxs-lookup"><span data-stu-id="74be7-371">Our `EditItemTemplate`, at this point, will cause an exception to be thrown if we attempt to use it.</span></span> <span data-ttu-id="74be7-372">问题在于，"`CategoryName`" 和 "`SupplierName`" 字段在 `EditItemTemplate`中呈现为 TextBox Web 控件。</span><span class="sxs-lookup"><span data-stu-id="74be7-372">The problem is that the `CategoryName` and `SupplierName` fields are rendered as TextBox Web controls in the `EditItemTemplate`.</span></span> <span data-ttu-id="74be7-373">需要将这些文本框更改为标签，或将其全部删除。</span><span class="sxs-lookup"><span data-stu-id="74be7-373">We either need to change these TextBoxes to Labels or remove them altogether.</span></span> <span data-ttu-id="74be7-374">让我们从 `EditItemTemplate`完全删除它们。</span><span class="sxs-lookup"><span data-stu-id="74be7-374">Let's simply delete them entirely from the `EditItemTemplate`.</span></span>

<span data-ttu-id="74be7-375">图23在单击 Chai 的 "编辑" 按钮后，在浏览器中显示 FormView。</span><span class="sxs-lookup"><span data-stu-id="74be7-375">Figure 23 shows the FormView in a browser after the Edit button has been clicked for Chai.</span></span> <span data-ttu-id="74be7-376">请注意，`ItemTemplate` 中所示的 "`SupplierName`" 和 "`CategoryName`" 字段不再存在，因为我们只是将它们从 `EditItemTemplate`中删除。</span><span class="sxs-lookup"><span data-stu-id="74be7-376">Note that the `SupplierName` and `CategoryName` fields shown in the `ItemTemplate` are no longer present, as we just removed them from the `EditItemTemplate`.</span></span> <span data-ttu-id="74be7-377">单击 "更新" 按钮时，FormView 会经历与 GridView 和 DetailsView 控件相同的步骤顺序。</span><span class="sxs-lookup"><span data-stu-id="74be7-377">When the Update button is clicked the FormView proceeds through the same sequence of steps as the GridView and DetailsView controls.</span></span>

<span data-ttu-id="74be7-378">[默认情况下，EditItemTemplate 会将每个可编辑的产品字段显示为文本框或复选框 ![](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image58.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image57.png)</span><span class="sxs-lookup"><span data-stu-id="74be7-378">[![By Default the EditItemTemplate Shows Each Editable Product Field as a TextBox or CheckBox](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image58.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image57.png)</span></span>

<span data-ttu-id="74be7-379">**图 23**：默认情况下，`EditItemTemplate` 将每个可编辑的产品字段显示为文本框或复选框（[单击查看完全尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image59.png)）</span><span class="sxs-lookup"><span data-stu-id="74be7-379">**Figure 23**: By Default the `EditItemTemplate` Shows Each Editable Product Field as a TextBox or CheckBox ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image59.png))</span></span>

<span data-ttu-id="74be7-380">单击 "插入" 按钮时，FormView `ItemTemplate` 回发可以。</span><span class="sxs-lookup"><span data-stu-id="74be7-380">When the Insert button is clicked the FormView's `ItemTemplate` a postback ensues.</span></span> <span data-ttu-id="74be7-381">但是，由于正在添加新记录，因此不会将任何数据绑定到 FormView。</span><span class="sxs-lookup"><span data-stu-id="74be7-381">However, no data is bound to the FormView because a new record is being added.</span></span> <span data-ttu-id="74be7-382">`InsertItemTemplate` 接口包括用于添加新记录的 Web 控件以及 "插入" 和 "取消" 按钮。</span><span class="sxs-lookup"><span data-stu-id="74be7-382">The `InsertItemTemplate` interface includes the Web controls for adding a new record along with the Insert and Cancel buttons.</span></span> <span data-ttu-id="74be7-383">Visual Studio 生成的默认 `InsertItemTemplate` 包含一个文本框，其中包含每个非布尔值字段和每个布尔值字段对应的复选框，这与自动生成 `EditItemTemplate`的接口类似。</span><span class="sxs-lookup"><span data-stu-id="74be7-383">The default `InsertItemTemplate` generated by Visual Studio contains a TextBox for each non-Boolean value field and a CheckBox for each Boolean value field, similar to the auto-generated `EditItemTemplate`'s interface.</span></span> <span data-ttu-id="74be7-384">TextBox 控件将其 `Text` 属性绑定到使用双向数据绑定的相应数据字段的值。</span><span class="sxs-lookup"><span data-stu-id="74be7-384">The TextBox controls have their `Text` property bound to the value of their corresponding data field using two-way databinding.</span></span>

<span data-ttu-id="74be7-385">以下声明性标记显示了 FormView 的 `InsertItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="74be7-385">The following declarative markup shows the FormView's `InsertItemTemplate`.</span></span> <span data-ttu-id="74be7-386">请注意，此处的数据绑定语法中使用的是 `Bind()` 方法，"插入" 和 "取消" 按钮 Web 控件的 `CommandName` 属性设置相应。</span><span class="sxs-lookup"><span data-stu-id="74be7-386">Note that the `Bind()` method is used in the databinding syntax here and that the Insert and Cancel Button Web controls have their `CommandName` properties set accordingly.</span></span>

[!code-aspx[Main](an-overview-of-inserting-updating-and-deleting-data-vb/samples/sample10.aspx)]

<span data-ttu-id="74be7-387">`InsertItemTemplate`的 FormView 自动生成有个很微妙。</span><span class="sxs-lookup"><span data-stu-id="74be7-387">There's a subtlety with the FormView's auto-generation of the `InsertItemTemplate`.</span></span> <span data-ttu-id="74be7-388">具体来说，即使是只读字段（如 `CategoryName` 和 `SupplierName`），也会创建 TextBox Web 控件。</span><span class="sxs-lookup"><span data-stu-id="74be7-388">Specifically, the TextBox Web controls are created even for those fields that are read-only, such as `CategoryName` and `SupplierName`.</span></span> <span data-ttu-id="74be7-389">与 `EditItemTemplate`一样，我们需要从 `InsertItemTemplate`中删除这些文本框。</span><span class="sxs-lookup"><span data-stu-id="74be7-389">Like with the `EditItemTemplate`, we need to remove these TextBoxes from the `InsertItemTemplate`.</span></span>

<span data-ttu-id="74be7-390">图24在添加新产品时，在浏览器中显示 FormView，Acme 咖啡。</span><span class="sxs-lookup"><span data-stu-id="74be7-390">Figure 24 shows the FormView in a browser when adding a new product, Acme Coffee.</span></span> <span data-ttu-id="74be7-391">请注意，`ItemTemplate` 中所示的 "`SupplierName`" 和 "`CategoryName`" 字段不再存在，因为我们刚刚将它们删除。</span><span class="sxs-lookup"><span data-stu-id="74be7-391">Note that the `SupplierName` and `CategoryName` fields shown in the `ItemTemplate` are no longer present, as we just removed them.</span></span> <span data-ttu-id="74be7-392">单击 "插入" 按钮时，FormView 会按照 DetailsView 控件的相同步骤顺序进行，并向 `Products` 表中添加一条新记录。</span><span class="sxs-lookup"><span data-stu-id="74be7-392">When the Insert button is clicked the FormView proceeds through the same sequence of steps as the DetailsView control, adding a new record to the `Products` table.</span></span> <span data-ttu-id="74be7-393">图25在插入后，在 FormView 中显示 Acme 咖啡产品的详细信息。</span><span class="sxs-lookup"><span data-stu-id="74be7-393">Figure 25 shows Acme Coffee product's details in the FormView after it has been inserted.</span></span>

<span data-ttu-id="74be7-394">[![则指示 FormView 的插入界面](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image61.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image60.png)</span><span class="sxs-lookup"><span data-stu-id="74be7-394">[![The InsertItemTemplate Dictates the FormView's Inserting Interface](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image61.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image60.png)</span></span>

<span data-ttu-id="74be7-395">**图 24**： `InsertItemTemplate` 指示 FormView 的插入界面（[单击以查看完全尺寸的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image62.png)）</span><span class="sxs-lookup"><span data-stu-id="74be7-395">**Figure 24**: The `InsertItemTemplate` Dictates the FormView's Inserting Interface ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image62.png))</span></span>

<span data-ttu-id="74be7-396">[![新产品的详细信息，Acme 咖啡显示在 FormView](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image64.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image63.png)</span><span class="sxs-lookup"><span data-stu-id="74be7-396">[![The Details for New Product, Acme Coffee, are Displayed in the FormView](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image64.png)](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image63.png)</span></span>

<span data-ttu-id="74be7-397">**图 25**：新产品的详细信息，Acme 咖啡在 FormView 中显示（[单击查看完全大小的图像](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image65.png)）</span><span class="sxs-lookup"><span data-stu-id="74be7-397">**Figure 25**: The Details for New Product, Acme Coffee, are Displayed in the FormView ([Click to view full-size image](an-overview-of-inserting-updating-and-deleting-data-vb/_static/image65.png))</span></span>

<span data-ttu-id="74be7-398">通过将只读、编辑和插入界面分为三个单独的模板，FormView 允许比 DetailsView 和 GridView 更精细地控制这些接口。</span><span class="sxs-lookup"><span data-stu-id="74be7-398">By separating out the read-only, editing, and inserting interfaces into three separate templates, the FormView allows for a finer degree of control over these interfaces than the DetailsView and GridView.</span></span>

> [!NOTE]
> <span data-ttu-id="74be7-399">与 DetailsView 一样，FormView 的 `CurrentMode` 属性指示正在显示的接口，其 `DefaultMode` 属性指示在完成编辑或插入后，FormView 返回到的模式。</span><span class="sxs-lookup"><span data-stu-id="74be7-399">Like the DetailsView, the FormView's `CurrentMode` property indicates the interface being displayed and its `DefaultMode` property indicates the mode the FormView returns to after an edit or insert has been completed.</span></span>

## <a name="summary"></a><span data-ttu-id="74be7-400">摘要</span><span class="sxs-lookup"><span data-stu-id="74be7-400">Summary</span></span>

<span data-ttu-id="74be7-401">在本教程中，我们将介绍使用 GridView、DetailsView 和 FormView 插入、编辑和删除数据的基本知识。</span><span class="sxs-lookup"><span data-stu-id="74be7-401">In this tutorial we examined the basics of inserting, editing, and deleting data using the GridView, DetailsView, and FormView.</span></span> <span data-ttu-id="74be7-402">这三种控件都提供了一定程度的内置数据修改功能，无需在 ASP.NET 页中编写单行代码即可使用这些功能，这是因为数据 Web 控件和 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="74be7-402">All three of these controls provide some level of built-in data modification capabilities that can be utilized without writing a single line of code in the ASP.NET page thanks to the data Web controls and the ObjectDataSource.</span></span> <span data-ttu-id="74be7-403">然而，简单的点和单击技巧会呈现一个相当 frail 的数据修改用户界面。</span><span class="sxs-lookup"><span data-stu-id="74be7-403">However, the simple point and click techniques render a fairly frail and naïve data modification user interface.</span></span> <span data-ttu-id="74be7-404">为了提供验证、注入编程值、合理地处理异常、自定义用户界面等，我们需要依赖于将在接下来的几个教程中讨论的一系列技术。</span><span class="sxs-lookup"><span data-stu-id="74be7-404">To provide validation, inject programmatic values, gracefully handle exceptions, customize the user interface, and so on, we'll need to rely on a bevy of techniques that will be discussed over the next several tutorials.</span></span>

<span data-ttu-id="74be7-405">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="74be7-405">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="74be7-406">关于作者</span><span class="sxs-lookup"><span data-stu-id="74be7-406">About the Author</span></span>

<span data-ttu-id="74be7-407">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，创始人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已在使用 Microsoft Web 技术，自1998开始。</span><span class="sxs-lookup"><span data-stu-id="74be7-407">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="74be7-408">Scott 的工作方式是独立的顾问、培训师和撰稿人。</span><span class="sxs-lookup"><span data-stu-id="74be7-408">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="74be7-409">他的最新书籍是，[*在24小时内，sam ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="74be7-409">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="74be7-410">可以[mitchell@4GuysFromRolla.com访问。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="74be7-410">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="74be7-411">或通过他的博客，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="74be7-411">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="74be7-412">[上一页](limiting-data-modification-functionality-based-on-the-user-cs.md)
> [下一页](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md)</span><span class="sxs-lookup"><span data-stu-id="74be7-412">[Previous](limiting-data-modification-functionality-based-on-the-user-cs.md)
[Next](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md)</span></span>
