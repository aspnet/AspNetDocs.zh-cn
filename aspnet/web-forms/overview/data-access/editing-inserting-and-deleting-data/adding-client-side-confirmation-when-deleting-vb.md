---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/adding-client-side-confirmation-when-deleting-vb
title: 删除时添加客户端确认（VB） |Microsoft Docs
author: rick-anderson
description: 到目前为止创建的接口中，用户在要单击 "编辑" 按钮时，可以通过单击 "删除" 按钮来意外删除数据。 在此 t 。
ms.author: riande
ms.date: 07/17/2006
ms.assetid: 6331e02e-c465-4cdf-bd3f-f07680c289d6
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/adding-client-side-confirmation-when-deleting-vb
msc.type: authoredcontent
ms.openlocfilehash: addb5a1fdc5793309388c5f06b44fb3b145bc102
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/28/2019
ms.locfileid: "74589357"
---
# <a name="adding-client-side-confirmation-when-deleting-vb"></a><span data-ttu-id="8a4ca-104">删除时添加客户端确认 (VB)</span><span class="sxs-lookup"><span data-stu-id="8a4ca-104">Adding Client-Side Confirmation When Deleting (VB)</span></span>

<span data-ttu-id="8a4ca-105">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="8a4ca-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="8a4ca-106">[下载示例应用](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_22_VB.exe)或[下载 PDF](adding-client-side-confirmation-when-deleting-vb/_static/datatutorial22vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="8a4ca-106">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_22_VB.exe) or [Download PDF](adding-client-side-confirmation-when-deleting-vb/_static/datatutorial22vb1.pdf)</span></span>

> <span data-ttu-id="8a4ca-107">到目前为止创建的接口中，用户在要单击 "编辑" 按钮时，可以通过单击 "删除" 按钮来意外删除数据。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-107">In the interfaces we've created so far, a user can accidentally delete data by clicking the Delete button when they meant to click the Edit button.</span></span> <span data-ttu-id="8a4ca-108">在本教程中，我们将添加一个在单击 "删除" 按钮时显示的客户端确认对话框。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-108">In this tutorial we'll add a client-side confirmation dialog box that appears when the Delete button is clicked.</span></span>

## <a name="introduction"></a><span data-ttu-id="8a4ca-109">简介</span><span class="sxs-lookup"><span data-stu-id="8a4ca-109">Introduction</span></span>

<span data-ttu-id="8a4ca-110">在过去的几个教程中，我们已了解如何结合使用我们的应用程序体系结构、ObjectDataSource 和数据 Web 控件来提供插入、编辑和删除功能。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-110">Over the past several tutorials we ve seen how to use our application architecture, ObjectDataSource, and the data Web controls in concert to provide inserting, editing, and deleting capabilities.</span></span> <span data-ttu-id="8a4ca-111">到目前为止，我们已经检查过的删除接口由 "删除" 按钮组成，在单击该按钮时，将导致回发并调用 ObjectDataSource `Delete()` 方法。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-111">The deleting interfaces we ve examined thus far have been composed of a Delete button that, when clicked, causes a postback and invokes the ObjectDataSource s `Delete()` method.</span></span> <span data-ttu-id="8a4ca-112">然后，`Delete()` 方法从业务逻辑层调用配置的方法，该方法将调用向下传播到数据访问层，并向数据库发出实际的 `DELETE` 语句。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-112">The `Delete()` method then invokes the configured method from the Business Logic Layer, which propagates the call down to the Data Access Layer, issuing the actual `DELETE` statement to the database.</span></span>

<span data-ttu-id="8a4ca-113">虽然此用户界面允许访问者通过 GridView、DetailsView 或 FormView 控件删除记录，但当用户单击 "删除" 按钮时，它不会有任何类型的确认。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-113">While this user interface enables visitors to delete records through the GridView, DetailsView, or FormView controls, it lacks any sort of confirmation when the user clicks the Delete button.</span></span> <span data-ttu-id="8a4ca-114">如果用户想要单击 "编辑" 按钮时意外单击 "删除" 按钮，则会将其更新的记录改为删除。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-114">If a user accidentally clicks the Delete button when they meant to click Edit, the record they meant to update will instead be deleted.</span></span> <span data-ttu-id="8a4ca-115">为了帮助防止出现这种情况，在本教程中，我们将添加一个在单击 "删除" 按钮时显示的客户端确认对话框。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-115">To help prevent this, in this tutorial we'll add a client-side confirmation dialog box that appears when the Delete button is clicked.</span></span>

<span data-ttu-id="8a4ca-116">JavaScript `confirm(string)` 函数将其字符串输入参数显示为模式对话框内提供了两个按钮的文本（"确定" 和 "取消"）（请参阅图1）。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-116">The JavaScript `confirm(string)` function displays its string input parameter as the text inside a modal dialog box that comes equipped with two buttons - OK and Cancel (see Figure 1).</span></span> <span data-ttu-id="8a4ca-117">`confirm(string)` 函数根据单击的按钮（`true`，如果用户单击 "确定"，则返回布尔值; 如果用户单击 "取消"，则返回 `false`）。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-117">The `confirm(string)` function returns a Boolean value depending on what button is clicked (`true`, if the user clicks OK, and `false` if they click Cancel).</span></span>

![JavaScript confirm （string）方法显示模式的客户端 Messagebox](adding-client-side-confirmation-when-deleting-vb/_static/image1.png)

<span data-ttu-id="8a4ca-119">**图 1**： JavaScript `confirm(string)` 方法显示模式的客户端 Messagebox</span><span class="sxs-lookup"><span data-stu-id="8a4ca-119">**Figure 1**: The JavaScript `confirm(string)` Method Displays a Modal, Client-Side Messagebox</span></span>

<span data-ttu-id="8a4ca-120">提交表单时，如果从客户端事件处理程序返回 `false` 的值，则将取消窗体提交。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-120">During a form submission, if a value of `false` is returned from a client-side event handler then the form submission is cancelled.</span></span> <span data-ttu-id="8a4ca-121">使用此功能，可以使 "删除" 按钮的客户端 `onclick` 事件处理程序返回对 `confirm("Are you sure you want to delete this product?")`的调用值。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-121">Using this feature, we can have the Delete button s client-side `onclick` event handler return the value of a call to `confirm("Are you sure you want to delete this product?")`.</span></span> <span data-ttu-id="8a4ca-122">如果用户单击 "取消"，`confirm(string)` 将返回 false，从而导致窗体提交取消。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-122">If the user clicks Cancel, `confirm(string)` will return false, thereby causing the form submission to cancel.</span></span> <span data-ttu-id="8a4ca-123">如果没有回发，则单击 "删除" 按钮的产品不会被删除。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-123">With no postback, the product whose Delete button was clicked won't be deleted.</span></span> <span data-ttu-id="8a4ca-124">但是，如果用户在确认对话框中单击 "确定"，则回发将继续 unabated 并且将删除该产品。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-124">If, however, the user clicks OK in the confirmation dialog box, the postback will continue unabated and the product will be deleted.</span></span> <span data-ttu-id="8a4ca-125">有关此技术的详细信息，请参阅[使用 JavaScript s `confirm()` 方法控制窗体提交](http://www.webreference.com/programming/javascript/confirm/)。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-125">Consult [Using JavaScript s `confirm()` Method to Control Form Submission](http://www.webreference.com/programming/javascript/confirm/) for more information on this technique.</span></span>

<span data-ttu-id="8a4ca-126">如果使用模板，则添加所需的客户端脚本略有不同，因为使用 CommandField 时。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-126">Adding the necessary client-side script differs slightly if using templates than when using a CommandField.</span></span> <span data-ttu-id="8a4ca-127">因此，在本教程中，我们将查看 FormView 和 GridView 示例。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-127">Therefore, in this tutorial we will look at both a FormView and GridView example.</span></span>

> [!NOTE]
> <span data-ttu-id="8a4ca-128">使用客户端确认技术（如本教程中所述的方法），假设用户正在访问支持 JavaScript 且已启用 JavaScript 的浏览器。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-128">Using client-side confirmation techniques, like the ones discussed in this tutorial, assumes that your users are visiting with browsers that support JavaScript and that they have JavaScript enabled.</span></span> <span data-ttu-id="8a4ca-129">如果某个特定用户不满足上述任一假设，则单击 "删除" 按钮会立即导致回发（不显示 "确认" messagebox）。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-129">If either of these assumptions are not true for a particular user, clicking the Delete button will immediately cause a postback (not displaying a confirm messagebox).</span></span>

## <a name="step-1-creating-a-formview-that-supports-deletion"></a><span data-ttu-id="8a4ca-130">步骤1：创建支持删除的 FormView</span><span class="sxs-lookup"><span data-stu-id="8a4ca-130">Step 1: Creating a FormView That Supports Deletion</span></span>

<span data-ttu-id="8a4ca-131">首先将 FormView 添加到 `EditInsertDelete` 文件夹中的 `ConfirmationOnDelete.aspx` 页，将其绑定到新的 ObjectDataSource，该 ObjectDataSource 通过 `ProductsBLL` 类 `GetProducts()` 方法取回产品信息。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-131">Start by adding a FormView to the `ConfirmationOnDelete.aspx` page in the `EditInsertDelete` folder, binding it to a new ObjectDataSource that pulls back the product information via the `ProductsBLL` class s `GetProducts()` method.</span></span> <span data-ttu-id="8a4ca-132">还要配置 ObjectDataSource，使 `ProductsBLL` 类 `DeleteProduct(productID)` 方法映射到 ObjectDataSource s `Delete()` 方法;确保 "插入和更新选项卡" 下拉列表设置为 "（无）"。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-132">Also configure the ObjectDataSource so that the `ProductsBLL` class s `DeleteProduct(productID)` method is mapped to the ObjectDataSource s `Delete()` method; ensure that the INSERT and UPDATE tabs drop-down lists are set to (None).</span></span> <span data-ttu-id="8a4ca-133">最后，选中 FormView s 智能标记中的 "启用分页" 复选框。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-133">Finally, check the Enable Paging checkbox in the FormView s smart tag.</span></span>

<span data-ttu-id="8a4ca-134">完成这些步骤后，新的 ObjectDataSource 声明性标记将如下所示：</span><span class="sxs-lookup"><span data-stu-id="8a4ca-134">After these steps, the new ObjectDataSource s declarative markup will look like the following:</span></span>

[!code-aspx[Main](adding-client-side-confirmation-when-deleting-vb/samples/sample1.aspx)]

<span data-ttu-id="8a4ca-135">正如我们过去在不使用开放式并发的示例中一样，请花一些时间来清除 ObjectDataSource 的 `OldValuesParameterFormatString` 属性。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-135">As in our past examples that did not use optimistic concurrency, take a moment to clear out the ObjectDataSource s `OldValuesParameterFormatString` property.</span></span>

<span data-ttu-id="8a4ca-136">由于它已绑定到仅支持删除的 ObjectDataSource 控件，因此 FormView s `ItemTemplate` 仅提供 "删除" 按钮，缺少 "新建" 和 "更新" 按钮。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-136">Since it has been bound to an ObjectDataSource control that only supports deleting, the FormView s `ItemTemplate` offers only the Delete button, lacking the New and Update buttons.</span></span> <span data-ttu-id="8a4ca-137">不过，FormView 的声明性标记包含一个多余的 `EditItemTemplate` 和 `InsertItemTemplate`，可以将其删除。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-137">The FormView s declarative markup, however, includes a superfluous `EditItemTemplate` and `InsertItemTemplate`, which can be removed.</span></span> <span data-ttu-id="8a4ca-138">请花片刻时间自定义 `ItemTemplate`，以便仅显示部分产品数据字段。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-138">Take a moment to customize the `ItemTemplate` so that is shows only a subset of the product data fields.</span></span> <span data-ttu-id="8a4ca-139">我配置了 "地雷"，以在其供应商和类别名称（连同 "删除" 按钮）上方的 `<h3>` 标题中显示产品名称。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-139">I ve configured mine to show the product s name in an `<h3>` heading above its supplier and category names (along with the Delete button).</span></span>

[!code-aspx[Main](adding-client-side-confirmation-when-deleting-vb/samples/sample2.aspx)]

<span data-ttu-id="8a4ca-140">进行这些更改后，我们提供了一个功能完备的网页，使用户能够一次切换产品，只需单击 "删除" 按钮即可删除产品。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-140">With these changes, we have a fully functional web page that allows a user to toggle through the products one at a time, with the ability to delete a product by simply clicking the Delete button.</span></span> <span data-ttu-id="8a4ca-141">图2显示了在浏览器中查看进度的屏幕截图。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-141">Figure 2 shows a screen shot of our progress thus far when viewed through a browser.</span></span>

<span data-ttu-id="8a4ca-142">[![FormView 显示单个产品的相关信息](adding-client-side-confirmation-when-deleting-vb/_static/image3.png)](adding-client-side-confirmation-when-deleting-vb/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="8a4ca-142">[![The FormView Shows Information About a Single Product](adding-client-side-confirmation-when-deleting-vb/_static/image3.png)](adding-client-side-confirmation-when-deleting-vb/_static/image2.png)</span></span>

<span data-ttu-id="8a4ca-143">**图 2**： FormView 显示了有关单个产品的信息（[单击查看完全尺寸的图像](adding-client-side-confirmation-when-deleting-vb/_static/image4.png)）</span><span class="sxs-lookup"><span data-stu-id="8a4ca-143">**Figure 2**: The FormView Shows Information About a Single Product ([Click to view full-size image](adding-client-side-confirmation-when-deleting-vb/_static/image4.png))</span></span>

## <a name="step-2-calling-the-confirmstring-function-from-the-delete-buttons-client-side-onclick-event"></a><span data-ttu-id="8a4ca-144">步骤2：从 "删除" 按钮的客户端 onclick 事件调用确认（string）函数</span><span class="sxs-lookup"><span data-stu-id="8a4ca-144">Step 2: Calling the confirm(string) Function from the Delete Buttons Client-Side onclick Event</span></span>

<span data-ttu-id="8a4ca-145">创建 FormView 后，最后一步是配置 "删除" 按钮，以便在访问者单击此按钮时，将调用 JavaScript `confirm(string)` 函数。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-145">With the FormView created, the final step is to configure the Delete button such that when it s clicked by the visitor, the JavaScript `confirm(string)` function is invoked.</span></span> <span data-ttu-id="8a4ca-146">将客户端脚本添加到按钮、LinkButton 或 ImageButton s 客户端 `onclick` 事件可以通过使用 `OnClientClick property`（ASP.NET 2.0 的新增操作）来实现。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-146">Adding client-side script to a Button, LinkButton, or ImageButton s client-side `onclick` event can be accomplished through the use of the `OnClientClick property`, which is new to ASP.NET 2.0.</span></span> <span data-ttu-id="8a4ca-147">由于我们希望返回 `confirm(string)` 函数的值，因此只需将以下属性设置为： `return confirm('Are you certain that you want to delete this product?');`</span><span class="sxs-lookup"><span data-stu-id="8a4ca-147">Since we want to have the value of the `confirm(string)` function returned, simply set this property to: `return confirm('Are you certain that you want to delete this product?');`</span></span>

<span data-ttu-id="8a4ca-148">完成此更改后，删除 LinkButton 的声明性语法应类似于：</span><span class="sxs-lookup"><span data-stu-id="8a4ca-148">After this change the Delete LinkButton s declarative syntax should look something like:</span></span>

[!code-aspx[Main](adding-client-side-confirmation-when-deleting-vb/samples/sample3.aspx)]

<span data-ttu-id="8a4ca-149">就是这样！</span><span class="sxs-lookup"><span data-stu-id="8a4ca-149">That s all there is to it!</span></span> <span data-ttu-id="8a4ca-150">图3显示了此确认在操作中的屏幕截图。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-150">Figure 3 shows a screen shot of this confirmation in action.</span></span> <span data-ttu-id="8a4ca-151">单击 "删除" 按钮会打开 "确认" 对话框。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-151">Clicking the Delete button brings up the confirm dialog box.</span></span> <span data-ttu-id="8a4ca-152">如果用户单击 "取消"，则将取消回发并不删除产品。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-152">If the user clicks Cancel, the postback is cancelled and the product is not deleted.</span></span> <span data-ttu-id="8a4ca-153">不过，如果用户单击 "确定"，则回发将继续，并且会调用 ObjectDataSource `Delete()` 方法，将删除数据库记录中的 culminating。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-153">If, however, the user clicks OK, the postback continues and the ObjectDataSource s `Delete()` method is invoked, culminating in the database record being deleted.</span></span>

> [!NOTE]
> <span data-ttu-id="8a4ca-154">传递到 `confirm(string)` JavaScript 函数的字符串用撇号分隔（而不是引号）。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-154">The string passed into the `confirm(string)` JavaScript function is delimited with apostrophes (rather than quotation marks).</span></span> <span data-ttu-id="8a4ca-155">在 JavaScript 中，可以使用任意一个字符来分隔字符串。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-155">In JavaScript, strings can be delimited using either character.</span></span> <span data-ttu-id="8a4ca-156">此处使用了撇号，以便 `confirm(string)` 传递给中的字符串的分隔符不会对 `OnClientClick` 属性值使用分隔符引入歧义。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-156">We use apostrophes here so that the delimiters for the string passed into `confirm(string)` do not introduce an ambiguity with the delimiters used for the `OnClientClick` property value.</span></span>

<span data-ttu-id="8a4ca-157">[![在单击 "删除" 按钮时显示确认](adding-client-side-confirmation-when-deleting-vb/_static/image6.png)](adding-client-side-confirmation-when-deleting-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="8a4ca-157">[![A Confirmation is Now Displayed When Clicking the Delete Button](adding-client-side-confirmation-when-deleting-vb/_static/image6.png)](adding-client-side-confirmation-when-deleting-vb/_static/image5.png)</span></span>

<span data-ttu-id="8a4ca-158">**图 3**：当单击 "删除" 按钮时，现在会显示一个确认（[单击以查看完全大小的图像](adding-client-side-confirmation-when-deleting-vb/_static/image7.png)）</span><span class="sxs-lookup"><span data-stu-id="8a4ca-158">**Figure 3**: A Confirmation is Now Displayed When Clicking the Delete Button ([Click to view full-size image](adding-client-side-confirmation-when-deleting-vb/_static/image7.png))</span></span>

## <a name="step-3-configuring-the-onclientclick-property-for-the-delete-button-in-a-commandfield"></a><span data-ttu-id="8a4ca-159">步骤3：为 CommandField 中的 "删除" 按钮配置 OnClientClick 属性</span><span class="sxs-lookup"><span data-stu-id="8a4ca-159">Step 3: Configuring the OnClientClick Property for the Delete Button in a CommandField</span></span>

<span data-ttu-id="8a4ca-160">直接在模板中使用 Button、LinkButton 或 ImageButton 时，只需将确认对话框 `OnClientClick` 配置为返回 JavaScript `confirm(string)` 函数的结果，就可以将该对话框与关联。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-160">When working with a Button, LinkButton, or ImageButton directly in a template, a confirmation dialog box can be associated with it by simply configuring its `OnClientClick` property to return the results of the JavaScript `confirm(string)` function.</span></span> <span data-ttu-id="8a4ca-161">但是，CommandField-将 "删除" 按钮的字段添加到 GridView 或 DetailsView，没有可通过声明方式进行设置的 `OnClientClick` 属性。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-161">However, the CommandField - which adds a field of Delete buttons to a GridView or DetailsView - does not have an `OnClientClick` property that can be set declaratively.</span></span> <span data-ttu-id="8a4ca-162">相反，我们必须以编程方式引用 GridView 或 DetailsView 中适用 `DataBound` 事件处理程序的 "删除" 按钮，然后在此处设置其 `OnClientClick` 属性。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-162">Instead, we must programmatically reference the Delete button in the GridView or DetailsView s appropriate `DataBound` event handler, and then set its `OnClientClick` property there.</span></span>

> [!NOTE]
> <span data-ttu-id="8a4ca-163">在适当的 `DataBound` 事件处理程序中设置 "删除" 按钮 `OnClientClick` 属性时，我们有权访问数据并将其绑定到当前记录。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-163">When setting the Delete button s `OnClientClick` property in the appropriate `DataBound` event handler, we have access to the data was bound to the current record.</span></span> <span data-ttu-id="8a4ca-164">这意味着我们可以扩展确认消息以包含有关特定记录的详细信息，例如 "是否确实要删除 Chai 产品？"</span><span class="sxs-lookup"><span data-stu-id="8a4ca-164">This means we can extend the confirmation message to include details about the particular record, such as, "Are you sure you want to delete the Chai product?"</span></span> <span data-ttu-id="8a4ca-165">使用数据绑定语法，也可以在模板中进行此类自定义。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-165">Such customization is also possible in templates using databinding syntax.</span></span>

<span data-ttu-id="8a4ca-166">若要练习为 CommandField 中的 "删除" 按钮设置 `OnClientClick` 属性，请向页面中添加一个 GridView。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-166">To practice setting the `OnClientClick` property for the Delete button(s) in a CommandField, let s add a GridView to the page.</span></span> <span data-ttu-id="8a4ca-167">将此 GridView 配置为使用 FormView 使用的相同 ObjectDataSource 控件。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-167">Configure this GridView to use the same ObjectDataSource control that the FormView uses.</span></span> <span data-ttu-id="8a4ca-168">还将 BoundFields 限制为仅包括产品名称、类别和供应商。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-168">Also limit the GridView s BoundFields to only include the product s name, category, and supplier.</span></span> <span data-ttu-id="8a4ca-169">最后，选中 "启用" 复选框。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-169">Lastly, check the Enable Deleting checkbox from the GridView s smart tag.</span></span> <span data-ttu-id="8a4ca-170">这会将 CommandField 添加到 GridView `Columns` 集合，并将其 `ShowDeleteButton` 属性设置为 "`true`"。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-170">This will add a CommandField to the GridView s `Columns` collection with its `ShowDeleteButton` property set to `true`.</span></span>

<span data-ttu-id="8a4ca-171">进行这些更改后，GridView 的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="8a4ca-171">After making these changes, your GridView s declarative markup should look like the following:</span></span>

[!code-aspx[Main](adding-client-side-confirmation-when-deleting-vb/samples/sample4.aspx)]

<span data-ttu-id="8a4ca-172">CommandField 包含单个 Delete LinkButton 实例，该实例可通过 GridView `RowDataBound` 事件处理程序以编程方式进行访问。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-172">The CommandField contains a single Delete LinkButton instance that can be accessed programmatically from the GridView s `RowDataBound` event handler.</span></span> <span data-ttu-id="8a4ca-173">引用后，可以相应地设置其 `OnClientClick` 属性。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-173">Once referenced, we can set its `OnClientClick` property accordingly.</span></span> <span data-ttu-id="8a4ca-174">使用以下代码为 `RowDataBound` 事件创建事件处理程序：</span><span class="sxs-lookup"><span data-stu-id="8a4ca-174">Create an event handler for the `RowDataBound` event using the following code:</span></span>

[!code-vb[Main](adding-client-side-confirmation-when-deleting-vb/samples/sample5.vb)]

<span data-ttu-id="8a4ca-175">此事件处理程序可用于数据行（将具有 "删除" 按钮的行），并以编程方式引用 "删除" 按钮开始。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-175">This event handler works with data rows (those that will have the Delete button) and begins by programmatically referencing the Delete button.</span></span> <span data-ttu-id="8a4ca-176">通常使用以下模式：</span><span class="sxs-lookup"><span data-stu-id="8a4ca-176">In general use the following pattern:</span></span>

[!code-vb[Main](adding-client-side-confirmation-when-deleting-vb/samples/sample6.vb)]

<span data-ttu-id="8a4ca-177">*ButtonType*是 CommandField、LinkButton 或 ImageButton 使用的按钮类型。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-177">*ButtonType* is the type of button being used by the CommandField - Button, LinkButton, or ImageButton.</span></span> <span data-ttu-id="8a4ca-178">默认情况下，CommandField 使用 LinkButtons，但这可以通过 CommandField s `ButtonType property`进行自定义。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-178">By default, the CommandField uses LinkButtons, but this can be customized via the CommandField s `ButtonType property`.</span></span> <span data-ttu-id="8a4ca-179">*CommandFieldIndex*是 GridView `Columns` 集合中 CommandField 的序号索引，而*controlIndex*是 CommandField s `Controls` 集合内的 "删除" 按钮的索引。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-179">The *commandFieldIndex* is the ordinal index of the CommandField within the GridView s `Columns` collection, whereas the *controlIndex* is the index of the Delete button within the CommandField s `Controls` collection.</span></span> <span data-ttu-id="8a4ca-180">*ControlIndex*值取决于按钮相对于 CommandField 中的其他按钮的位置。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-180">The *controlIndex* value depends on the button s position relative to other buttons in the CommandField.</span></span> <span data-ttu-id="8a4ca-181">例如，如果 CommandField 中显示的唯一按钮是 "删除" 按钮，请使用的索引为0。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-181">For example, if the only button displayed in the CommandField is the Delete button, use an index of 0.</span></span> <span data-ttu-id="8a4ca-182">但是，如果在 "删除" 按钮之前有一个 "编辑" 按钮，请使用索引2。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-182">If, however, there s an Edit button that precedes the Delete button, use an index of 2.</span></span> <span data-ttu-id="8a4ca-183">使用索引2的原因是，"删除" 按钮之前的 CommandField 添加了两个控件： "编辑" 按钮和用于在 "编辑" 和 "删除" 按钮之间添加一些空间的 LiteralControl。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-183">The reason an index of 2 is used is because two controls are added by the CommandField before the Delete button: the Edit button and a LiteralControl that s used to add some space between the Edit and Delete buttons.</span></span>

<span data-ttu-id="8a4ca-184">对于我们的特定示例，CommandField 使用 LinkButtons，而是最左侧的字段，其*commandFieldIndex*为0。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-184">For our particular example, the CommandField uses LinkButtons and, being the left-most field, has a *commandFieldIndex* of 0.</span></span> <span data-ttu-id="8a4ca-185">由于 CommandField 中没有其他按钮，而删除按钮，我们使用的*controlIndex*为0。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-185">Since there are no other buttons but the Delete button in the CommandField, we use a *controlIndex* of 0.</span></span>

<span data-ttu-id="8a4ca-186">引用 CommandField 中的 "删除" 按钮后，接下来将获取与当前 GridView 行绑定的产品有关的信息。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-186">After referencing the Delete button in the CommandField, we next grab information about the product bound to the current GridView row.</span></span> <span data-ttu-id="8a4ca-187">最后，我们将 "删除" 按钮 `OnClientClick` 属性设置为相应的 JavaScript，其中包括产品名称。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-187">Finally, we set the Delete button s `OnClientClick` property to the appropriate JavaScript, which includes the product s name.</span></span> <span data-ttu-id="8a4ca-188">由于传递到 `confirm(string)` 函数的 JavaScript 字符串是使用撇号分隔的，因此，必须对出现在产品名内的任何撇号进行转义。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-188">Since the JavaScript string passed into the `confirm(string)` function is delimited using apostrophes we must escape any apostrophes that appear within the product s name.</span></span> <span data-ttu-id="8a4ca-189">特别是，产品名称中的任何撇号都用 "`\'`" 进行转义。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-189">In particular, any apostrophes in the product s name are escaped with "`\'`".</span></span>

<span data-ttu-id="8a4ca-190">完成这些更改后，在 GridView 中单击 "删除" 按钮将显示 "自定义确认" 对话框（请参阅图4）。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-190">With these changes complete, clicking on a Delete button in the GridView displays a customized confirmation dialog box (see Figure 4).</span></span> <span data-ttu-id="8a4ca-191">与 FormView 的确认消息一样，如果用户单击 "取消"，则会取消回发，从而阻止发生删除。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-191">As with the confirmation messagebox from the FormView, if the user clicks Cancel the postback is cancelled, thereby preventing the deletion from occurring.</span></span>

> [!NOTE]
> <span data-ttu-id="8a4ca-192">此方法还可用于以编程方式访问 DetailsView 中 CommandField 的 "删除" 按钮。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-192">This technique can also be used to programmatically access the Delete button in the CommandField in a DetailsView.</span></span> <span data-ttu-id="8a4ca-193">但对于 DetailsView，为 `DataBound` 事件创建事件处理程序，因为 DetailsView 没有 `RowDataBound` 事件。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-193">For the DetailsView, however, you d create an event handler for the `DataBound` event, since the DetailsView does not have a `RowDataBound` event.</span></span>

<span data-ttu-id="8a4ca-194">[![单击 GridView 的 "删除" 按钮将显示 "自定义确认" 对话框](adding-client-side-confirmation-when-deleting-vb/_static/image9.png)](adding-client-side-confirmation-when-deleting-vb/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="8a4ca-194">[![Clicking the GridView s Delete Button Displays a Customized Confirmation Dialog Box](adding-client-side-confirmation-when-deleting-vb/_static/image9.png)](adding-client-side-confirmation-when-deleting-vb/_static/image8.png)</span></span>

<span data-ttu-id="8a4ca-195">**图 4**：单击 GridView 的 "删除" 按钮将显示 "自定义确认" 对话框（[单击以查看完全大小的图像](adding-client-side-confirmation-when-deleting-vb/_static/image10.png)）</span><span class="sxs-lookup"><span data-stu-id="8a4ca-195">**Figure 4**: Clicking the GridView s Delete Button Displays a Customized Confirmation Dialog Box ([Click to view full-size image](adding-client-side-confirmation-when-deleting-vb/_static/image10.png))</span></span>

## <a name="using-templatefields"></a><span data-ttu-id="8a4ca-196">使用 Templatefield</span><span class="sxs-lookup"><span data-stu-id="8a4ca-196">Using TemplateFields</span></span>

<span data-ttu-id="8a4ca-197">CommandField 的缺点之一是必须通过索引访问其按钮，并且必须将生成的对象强制转换为相应的按钮类型（Button、LinkButton 或 ImageButton）。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-197">One of the disadvantages of the CommandField is that its buttons must be accessed through indexing and that the resulting object must be cast to the appropriate button type (Button, LinkButton, or ImageButton).</span></span> <span data-ttu-id="8a4ca-198">使用 "幻数" 和硬编码类型会导致在运行时之前无法发现的问题。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-198">Using "magic numbers" and hard-coded types invites problems that cannot be discovered until runtime.</span></span> <span data-ttu-id="8a4ca-199">例如，如果你或另一个开发人员在未来的某个时间（例如 "编辑" 按钮）向 CommandField 添加了新按钮，或更改了 `ButtonType` 属性，则现有代码仍将编译而不出错，但访问此页可能会导致异常或意外的行为，具体取决于代码的编写方式和所做的更改。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-199">For example, if you, or another developer, adds new buttons to the CommandField at some point in the future (such as an Edit button) or changes the `ButtonType` property, the existing code will still compile without error, but visiting the page may cause an exception or unexpected behavior, depending on how your code was written and what changes were made.</span></span>

<span data-ttu-id="8a4ca-200">另一种方法是将 GridView 和 DetailsView s CommandFields 转换为 Templatefield。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-200">An alternative approach is to convert the GridView and DetailsView s CommandFields into TemplateFields.</span></span> <span data-ttu-id="8a4ca-201">这将生成一个 TemplateField，其中包含一个 `ItemTemplate`，该具有 CommandField 中每个按钮的 LinkButton （或按钮或 ImageButton）。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-201">This will generate a TemplateField with an `ItemTemplate` that has a LinkButton (or Button or ImageButton) for each button in the CommandField.</span></span> <span data-ttu-id="8a4ca-202">可以通过声明方式分配这些按钮 `OnClientClick` 属性（如我们在 FormView 中看到的那样），也可以使用以下模式以编程方式在相应的 `DataBound` 事件处理程序中进行访问：</span><span class="sxs-lookup"><span data-stu-id="8a4ca-202">These buttons `OnClientClick` properties can be assigned declaratively, as we saw with the FormView, or can be programmatically accessed in the appropriate `DataBound` event handler using the following pattern:</span></span>

[!code-vb[Main](adding-client-side-confirmation-when-deleting-vb/samples/sample7.vb)]

<span data-ttu-id="8a4ca-203">其中， *controlID*是按钮 `ID` 属性的值。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-203">Where *controlID* is the value of the button s `ID` property.</span></span> <span data-ttu-id="8a4ca-204">虽然此模式仍需要强制转换的硬编码类型，但它无需对索引进行索引，因此布局可以更改，而不会导致运行时错误。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-204">While this pattern still requires a hard-coded type for the cast, it removes the need for indexing, allowing for the layout to change without resulting in a runtime error.</span></span>

## <a name="summary"></a><span data-ttu-id="8a4ca-205">总结</span><span class="sxs-lookup"><span data-stu-id="8a4ca-205">Summary</span></span>

<span data-ttu-id="8a4ca-206">JavaScript `confirm(string)` 函数是用于控制窗体提交工作流的常用方法。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-206">The JavaScript `confirm(string)` function is a commonly used technique for controlling form submission workflow.</span></span> <span data-ttu-id="8a4ca-207">执行时，该函数将显示一个模式客户端对话框，其中包含两个按钮，即 "确定" 和 "取消"。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-207">When executed, the function displays a modal, client-side dialog box that includes two buttons, OK and Cancel.</span></span> <span data-ttu-id="8a4ca-208">如果用户单击 "确定"，`confirm(string)` 函数将返回 `true`;单击 "取消" 将返回 `false`。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-208">If the user clicks OK, the `confirm(string)` function returns `true`; clicking Cancel returns `false`.</span></span> <span data-ttu-id="8a4ca-209">此功能与浏览器的行为相结合，如果提交过程中的事件处理程序返回 `false`，则可用于在删除记录时显示确认消息。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-209">This functionality, coupled with a browser s behavior to cancel a form submission if an event handler during the submission process returns `false`, can be used to display a confirmation messagebox when deleting a record.</span></span>

<span data-ttu-id="8a4ca-210">`confirm(string)` 函数可以通过 control s `OnClientClick` 属性与按钮 Web 控件 s 客户端 `onclick` 事件处理程序关联。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-210">The `confirm(string)` function can be associated with a Button Web control s client-side `onclick` event handler through the control s `OnClientClick` property.</span></span> <span data-ttu-id="8a4ca-211">在模板中使用 "删除" 按钮时-无论是在某个 FormView 的模板中，还是在 DetailsView 或 GridView 的 TemplateField 中使用，都可以通过声明方式或编程方式设置此属性，如本教程中所述。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-211">When working with a Delete button in a template - either in one of the FormView s templates or in a TemplateField in the DetailsView or GridView - this property can be set either declaratively or programmatically, as we saw in this tutorial.</span></span>

<span data-ttu-id="8a4ca-212">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="8a4ca-212">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="8a4ca-213">关于作者</span><span class="sxs-lookup"><span data-stu-id="8a4ca-213">About the Author</span></span>

<span data-ttu-id="8a4ca-214">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，创始人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已在使用 Microsoft Web 技术，自1998开始。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-214">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="8a4ca-215">Scott 的工作方式是独立的顾问、培训师和撰稿人。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-215">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="8a4ca-216">他的最新书籍是，[*在24小时内，sam ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-216">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="8a4ca-217">可以[mitchell@4GuysFromRolla.com访问。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="8a4ca-217">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="8a4ca-218">或通过他的博客，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="8a4ca-218">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="8a4ca-219">[上一页](implementing-optimistic-concurrency-vb.md)
> [下一页](limiting-data-modification-functionality-based-on-the-user-vb.md)</span><span class="sxs-lookup"><span data-stu-id="8a4ca-219">[Previous](implementing-optimistic-concurrency-vb.md)
[Next](limiting-data-modification-functionality-based-on-the-user-vb.md)</span></span>
