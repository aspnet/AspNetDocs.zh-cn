---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/adding-validation-controls-to-the-editing-and-inserting-interfaces-vb
title: 向编辑和插入界面添加验证控件（VB） |Microsoft Docs
author: rick-anderson
description: 在本教程中，我们将了解如何轻松地将验证控件添加到数据 Web 控件的 EditItemTemplate 和则中，以提供更多 。
ms.author: riande
ms.date: 07/17/2006
ms.assetid: e3d7028a-7a22-4a4f-babe-d53afc41c0e2
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/adding-validation-controls-to-the-editing-and-inserting-interfaces-vb
msc.type: authoredcontent
ms.openlocfilehash: 5c5ad110ee0836f0a464b02a2b29254e2e06381e
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/06/2020
ms.locfileid: "78479432"
---
# <a name="adding-validation-controls-to-the-editing-and-inserting-interfaces-vb"></a><span data-ttu-id="7359d-103">向编辑和插入界面添加验证控件 (VB)</span><span class="sxs-lookup"><span data-stu-id="7359d-103">Adding Validation Controls to the Editing and Inserting Interfaces (VB)</span></span>

<span data-ttu-id="7359d-104">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="7359d-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="7359d-105">[下载示例应用](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_19_VB.exe)或[下载 PDF](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/datatutorial19vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="7359d-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_19_VB.exe) or [Download PDF](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/datatutorial19vb1.pdf)</span></span>

> <span data-ttu-id="7359d-106">在本教程中，我们将了解如何轻松地将验证控件添加到数据 Web 控件的 EditItemTemplate 和则，以提供更可靠的用户界面。</span><span class="sxs-lookup"><span data-stu-id="7359d-106">In this tutorial we'll see how easy it is to add validation controls to the EditItemTemplate and InsertItemTemplate of a data Web control, to provide a more foolproof user interface.</span></span>

## <a name="introduction"></a><span data-ttu-id="7359d-107">简介</span><span class="sxs-lookup"><span data-stu-id="7359d-107">Introduction</span></span>

<span data-ttu-id="7359d-108">我们在过去三个教程中探讨过的示例中的 GridView 和 DetailsView 控件都包含 BoundFields 和 CheckBoxFields （在将 GridView 或 DetailsView 绑定到数据源时，Visual Studio 自动添加的字段类型）控制智能标记）。</span><span class="sxs-lookup"><span data-stu-id="7359d-108">The GridView and DetailsView controls in the examples we've explored over the past three tutorials have all been composed of BoundFields and CheckBoxFields (the field types automatically added by Visual Studio when binding a GridView or DetailsView to a data source control through the smart tag).</span></span> <span data-ttu-id="7359d-109">在 GridView 或 DetailsView 中编辑行时，那些不是只读的 BoundFields 将转换为文本框，最终用户可以从这些文本框中修改现有数据。</span><span class="sxs-lookup"><span data-stu-id="7359d-109">When editing a row in a GridView or DetailsView, those BoundFields that are not read-only are converted into textboxes, from which the end user can modify the existing data.</span></span> <span data-ttu-id="7359d-110">同样，在将新记录插入到 DetailsView 控件中时，`InsertVisible` 属性设置为 `True` （默认值）的那些 BoundFields 将呈现为空文本框，用户可以在其中提供新记录的字段值。</span><span class="sxs-lookup"><span data-stu-id="7359d-110">Similarly, when inserting a new record into a DetailsView control, those BoundFields whose `InsertVisible` property is set to `True` (the default) are rendered as empty textboxes, into which the user can provide the new record's field values.</span></span> <span data-ttu-id="7359d-111">同样，在标准只读接口中禁用的 CheckBoxFields 在编辑和插入界面中转换为启用的复选框。</span><span class="sxs-lookup"><span data-stu-id="7359d-111">Likewise, CheckBoxFields, which are disabled in the standard, read-only interface, are converted into enabled checkboxes in the editing and inserting interfaces.</span></span>

<span data-ttu-id="7359d-112">尽管 BoundField 和 CheckBoxField 的默认编辑和插入界面都很有用，但接口缺乏任何类型的验证。</span><span class="sxs-lookup"><span data-stu-id="7359d-112">While the default editing and inserting interfaces for the BoundField and CheckBoxField can be helpful, the interface lacks any sort of validation.</span></span> <span data-ttu-id="7359d-113">如果用户进行数据输入错误（例如省略 `ProductName` 字段或为 `UnitsInStock` 输入无效值（如-50），则将从应用程序体系结构的深度中引发异常。</span><span class="sxs-lookup"><span data-stu-id="7359d-113">If a user makes a data entry mistake - such as omitting the `ProductName` field or entering an invalid value for `UnitsInStock` (such as -50) an exception will be raised from within the depths of the application architecture.</span></span> <span data-ttu-id="7359d-114">尽管可以正常处理此异常，如[前一教程](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md)中所示，理想情况下，编辑或插入用户界面应包括验证控件，以防止用户首先输入这样的无效数据。</span><span class="sxs-lookup"><span data-stu-id="7359d-114">While this exception can be gracefully handled as demonstrated in the [previous tutorial](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md), ideally the editing or inserting user interface would include validation controls to prevent a user from entering such invalid data in the first place.</span></span>

<span data-ttu-id="7359d-115">为了提供自定义的编辑或插入界面，需要将 BoundField 或 CheckBoxField 替换为 TemplateField。</span><span class="sxs-lookup"><span data-stu-id="7359d-115">In order to provide a customized editing or inserting interface, we need to replace the BoundField or CheckBoxField with a TemplateField.</span></span> <span data-ttu-id="7359d-116">Templatefield 是在 GridView 控件中[使用 templatefield](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md)和在[DetailsView 控件教程中使用 templatefield](../custom-formatting/using-templatefields-in-the-detailsview-control-vb.md)中讨论的主题，可以包含多个模板，用于为不同的行状态定义单独的接口。</span><span class="sxs-lookup"><span data-stu-id="7359d-116">TemplateFields, which were the topic of discussion in the [Using TemplateFields in the GridView Control](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md) and [Using TemplateFields in the DetailsView Control](../custom-formatting/using-templatefields-in-the-detailsview-control-vb.md) tutorials, can consist of multiple templates defining separate interfaces for different row states.</span></span> <span data-ttu-id="7359d-117">TemplateField 的 `ItemTemplate` 用于在 DetailsView 或 GridView 控件中呈现只读字段或行，而 `EditItemTemplate` 和 `InsertItemTemplate` 分别指示用于编辑和插入模式的接口。</span><span class="sxs-lookup"><span data-stu-id="7359d-117">The TemplateField's `ItemTemplate` is used to when rendering read-only fields or rows in the DetailsView or GridView controls, whereas the `EditItemTemplate` and `InsertItemTemplate` indicate the interfaces to use for the editing and inserting modes, respectively.</span></span>

<span data-ttu-id="7359d-118">在本教程中，我们将了解如何轻松地将验证控件添加到 TemplateField 的 `EditItemTemplate` 和 `InsertItemTemplate` 以提供更加可靠的用户界面。</span><span class="sxs-lookup"><span data-stu-id="7359d-118">In this tutorial we'll see how easy it is to add validation controls to the TemplateField's `EditItemTemplate` and `InsertItemTemplate` to provide a more foolproof user interface.</span></span> <span data-ttu-id="7359d-119">具体而言，本教程采用在[检查与插入、更新和删除教程关联的事件](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md)中创建的示例，并补充编辑和插入界面以包括适当的验证。</span><span class="sxs-lookup"><span data-stu-id="7359d-119">Specifically, this tutorial takes the example created in the [Examining the Events Associated with Inserting, Updating, and Deleting](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md) tutorial and augments the editing and inserting interfaces to include appropriate validation.</span></span>

## <a name="step-1-replicating-the-example-fromexamining-the-events-associated-with-inserting-updating-and-deleting"></a><span data-ttu-id="7359d-120">步骤1：复制示例[以检查与插入、更新和删除相关的事件](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md)</span><span class="sxs-lookup"><span data-stu-id="7359d-120">Step 1: Replicating the Example from[Examining the Events Associated with Inserting, Updating, and Deleting](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md)</span></span>

<span data-ttu-id="7359d-121">在[检查与插入、更新和删除教程关联的事件](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md)中，我们创建了一个页面，其中列出了可编辑 GridView 中产品的名称和价格。</span><span class="sxs-lookup"><span data-stu-id="7359d-121">In the [Examining the Events Associated with Inserting, Updating, and Deleting](examining-the-events-associated-with-inserting-updating-and-deleting-vb.md) tutorial we created a page that listed the names and prices of the products in an editable GridView.</span></span> <span data-ttu-id="7359d-122">此外，此页还包括一个 DetailsView，其中 `DefaultMode` 属性设置为 `Insert`，因此始终以插入模式呈现。</span><span class="sxs-lookup"><span data-stu-id="7359d-122">Additionally, the page included a DetailsView whose `DefaultMode` property was set to `Insert`, thereby always rendering in insert mode.</span></span> <span data-ttu-id="7359d-123">从这一 DetailsView，用户可以输入新产品的名称和价格，单击 "插入"，然后将其添加到系统中（请参阅图1）。</span><span class="sxs-lookup"><span data-stu-id="7359d-123">From this DetailsView, the user could enter the name and price for a new product, click Insert, and have it added to the system (see Figure 1).</span></span>

<span data-ttu-id="7359d-124">[![前面的示例，用户可以添加新产品并编辑现有产品](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image2.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="7359d-124">[![The Previous Example Allows Users to Add New Products and Edit Existing Ones](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image2.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image1.png)</span></span>

<span data-ttu-id="7359d-125">**图 1**：前面的示例允许用户添加新产品并编辑现有产品（[单击以查看完全大小的图像](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="7359d-125">**Figure 1**: The Previous Example Allows Users to Add New Products and Edit Existing Ones ([Click to view full-size image](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image3.png))</span></span>

<span data-ttu-id="7359d-126">本教程的目标是增加 DetailsView 和 GridView 来提供验证控件。</span><span class="sxs-lookup"><span data-stu-id="7359d-126">Our goal for this tutorial is to augment the DetailsView and GridView to provide validation controls.</span></span> <span data-ttu-id="7359d-127">具体而言，我们的验证逻辑将：</span><span class="sxs-lookup"><span data-stu-id="7359d-127">In particular, our validation logic will:</span></span>

- <span data-ttu-id="7359d-128">要求在插入或编辑产品时提供名称</span><span class="sxs-lookup"><span data-stu-id="7359d-128">Require that the name be provided when inserting or editing a product</span></span>
- <span data-ttu-id="7359d-129">需要在插入记录时提供价格;编辑一条记录时，我们仍需要价格，但将使用在之前的教程中已经存在的 GridView `RowUpdating` 事件处理程序中的编程逻辑</span><span class="sxs-lookup"><span data-stu-id="7359d-129">Require that the price be provided when inserting a record; when editing a record, we will still require a price, but will use the programmatic logic in the GridView's `RowUpdating` event handler already present from the earlier tutorial</span></span>
- <span data-ttu-id="7359d-130">确保为 "价格" 输入的值是有效的货币格式</span><span class="sxs-lookup"><span data-stu-id="7359d-130">Ensure that the value entered for the price is a valid currency format</span></span>

<span data-ttu-id="7359d-131">首先，我们需要将示例从 `DataModificationEvents.aspx` 页复制到本教程的页面，`UIValidation.aspx`，然后才能了解如何增强前面的示例以包括验证。</span><span class="sxs-lookup"><span data-stu-id="7359d-131">Before we can look at augmenting the previous example to include validation, we first need to replicate the example from the `DataModificationEvents.aspx` page to the page for this tutorial, `UIValidation.aspx`.</span></span> <span data-ttu-id="7359d-132">若要实现此目的，我们需要同时复制 `DataModificationEvents.aspx` 页面的声明性标记及其源代码。</span><span class="sxs-lookup"><span data-stu-id="7359d-132">To accomplish this we need to copy over both the `DataModificationEvents.aspx` page's declarative markup and its source code.</span></span> <span data-ttu-id="7359d-133">首先，通过执行以下步骤，通过声明性标记进行复制：</span><span class="sxs-lookup"><span data-stu-id="7359d-133">First copy over the declarative markup by performing the following steps:</span></span>

1. <span data-ttu-id="7359d-134">在 Visual Studio 中打开 `DataModificationEvents.aspx` 页面</span><span class="sxs-lookup"><span data-stu-id="7359d-134">Open the `DataModificationEvents.aspx` page in Visual Studio</span></span>
2. <span data-ttu-id="7359d-135">中转到页面的声明性标记（单击页面底部的 "源" 按钮）</span><span class="sxs-lookup"><span data-stu-id="7359d-135">Go to the page's declarative markup (click on the Source button at the bottom of the page)</span></span>
3. <span data-ttu-id="7359d-136">复制 `<asp:Content>` 和 `</asp:Content>` 标记（第3行到第44行）中的文本，如图2所示。</span><span class="sxs-lookup"><span data-stu-id="7359d-136">Copy the text within the `<asp:Content>` and `</asp:Content>` tags (lines 3 through 44), as shown in Figure 2.</span></span>

<span data-ttu-id="7359d-137">[![复制 &lt;asp： Content&gt; 控件中的文本](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image5.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="7359d-137">[![Copy the Text Within the &lt;asp:Content&gt; Control](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image5.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image4.png)</span></span>

<span data-ttu-id="7359d-138">**图 2**：复制 `<asp:Content>` 控件中的文本（[单击查看完全尺寸的图像](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="7359d-138">**Figure 2**: Copy the Text Within the `<asp:Content>` Control ([Click to view full-size image](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image6.png))</span></span>

1. <span data-ttu-id="7359d-139">打开 `UIValidation.aspx` 页面</span><span class="sxs-lookup"><span data-stu-id="7359d-139">Open the `UIValidation.aspx` page</span></span>
2. <span data-ttu-id="7359d-140">中转到页面的声明性标记</span><span class="sxs-lookup"><span data-stu-id="7359d-140">Go to the page's declarative markup</span></span>
3. <span data-ttu-id="7359d-141">将文本粘贴到 `<asp:Content>` 控件中。</span><span class="sxs-lookup"><span data-stu-id="7359d-141">Paste the text within the `<asp:Content>` control.</span></span>

<span data-ttu-id="7359d-142">若要复制源代码，请打开 `DataModificationEvents.aspx.vb` 页面并只复制 `EditInsertDelete_DataModificationEvents` 类*中*的文本。</span><span class="sxs-lookup"><span data-stu-id="7359d-142">To copy over the source code, open the `DataModificationEvents.aspx.vb` page and copy just the text *within* the `EditInsertDelete_DataModificationEvents` class.</span></span> <span data-ttu-id="7359d-143">复制三个事件处理程序（`Page_Load`、`GridView1_RowUpdating`和 `ObjectDataSource1_Inserting`），但不要**复制类**声明。</span><span class="sxs-lookup"><span data-stu-id="7359d-143">Copy the three event handlers (`Page_Load`, `GridView1_RowUpdating`, and `ObjectDataSource1_Inserting`), but do **not** copy the class declaration.</span></span> <span data-ttu-id="7359d-144">将复制*的文本粘贴到 `UIValidation.aspx.vb`* 中的 `EditInsertDelete_UIValidation` 类中。</span><span class="sxs-lookup"><span data-stu-id="7359d-144">Paste the copied text *within* the `EditInsertDelete_UIValidation` class in `UIValidation.aspx.vb`.</span></span>

<span data-ttu-id="7359d-145">将内容和代码移到 `DataModificationEvents.aspx` 到 `UIValidation.aspx`后，请花点时间在浏览器中测试进度。</span><span class="sxs-lookup"><span data-stu-id="7359d-145">After moving over the content and code from `DataModificationEvents.aspx` to `UIValidation.aspx`, take a moment to test out your progress in a browser.</span></span> <span data-ttu-id="7359d-146">在这两个页面中，你应看到相同的输出和体验相同的功能（请参阅图1，了解 `DataModificationEvents.aspx` 操作中的屏幕截图）。</span><span class="sxs-lookup"><span data-stu-id="7359d-146">You should see the same output and experience the same functionality in each of these two pages (refer back to Figure 1 for a screen shot of `DataModificationEvents.aspx` in action).</span></span>

## <a name="step-2-converting-the-boundfields-into-templatefields"></a><span data-ttu-id="7359d-147">步骤2：将 BoundFields 转换为 Templatefield</span><span class="sxs-lookup"><span data-stu-id="7359d-147">Step 2: Converting the BoundFields Into TemplateFields</span></span>

<span data-ttu-id="7359d-148">若要向编辑和插入界面添加验证控件，需要将 DetailsView 和 GridView 控件使用的 BoundFields 转换为 Templatefield。</span><span class="sxs-lookup"><span data-stu-id="7359d-148">To add validation controls to the editing and inserting interfaces, the BoundFields used by the DetailsView and GridView controls need to be converted into TemplateFields.</span></span> <span data-ttu-id="7359d-149">若要实现此目的，请分别单击 "编辑列" 和 "编辑字段" 链接。</span><span class="sxs-lookup"><span data-stu-id="7359d-149">To achieve this, click on the Edit Columns and Edit Fields links in the GridView and DetailsView's smart tags, respectively.</span></span> <span data-ttu-id="7359d-150">在该字段中，选择每个 BoundFields，并单击 "将此字段转换为 TemplateField" 链接。</span><span class="sxs-lookup"><span data-stu-id="7359d-150">There, select each of the BoundFields and click the "Convert this field into a TemplateField" link.</span></span>

<span data-ttu-id="7359d-151">[![将每个 DetailsView 和 GridView 的 BoundFields 转换为 Templatefield](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image8.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="7359d-151">[![Convert Each of the DetailsView's and GridView's BoundFields Into TemplateFields](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image8.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image7.png)</span></span>

<span data-ttu-id="7359d-152">**图 3**：将每个 DetailsView 和 GridView 的 BoundFields 转换为 Templatefield （[单击以查看完全大小的图像](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="7359d-152">**Figure 3**: Convert Each of the DetailsView's and GridView's BoundFields Into TemplateFields ([Click to view full-size image](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image9.png))</span></span>

<span data-ttu-id="7359d-153">通过 "字段" 对话框将 BoundField 转换为 TemplateField 时，将生成一个 TemplateField，该显示与 BoundField 本身相同的只读、编辑和插入接口。</span><span class="sxs-lookup"><span data-stu-id="7359d-153">Converting a BoundField into a TemplateField through the Fields dialog box generates a TemplateField that exhibits the same read-only, editing, and inserting interfaces as the BoundField itself.</span></span> <span data-ttu-id="7359d-154">下面的标记显示了在 DetailsView 转换为 TemplateField 后，DetailsView 中的 `ProductName` 字段的声明性语法：</span><span class="sxs-lookup"><span data-stu-id="7359d-154">The following markup shows the declarative syntax for the `ProductName` field in the DetailsView after it has been converted into a TemplateField:</span></span>

[!code-aspx[Main](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/samples/sample1.aspx)]

<span data-ttu-id="7359d-155">请注意，此 TemplateField 会自动创建三个模板 `ItemTemplate`、`EditItemTemplate`和 `InsertItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="7359d-155">Note that this TemplateField had three templates automatically created `ItemTemplate`, `EditItemTemplate`, and `InsertItemTemplate`.</span></span> <span data-ttu-id="7359d-156">`ItemTemplate` 使用标签 Web 控件显示单个数据字段值（`ProductName`），而 `EditItemTemplate` 和 `InsertItemTemplate` 在 TextBox Web 控件中显示数据字段值，该控件会使用双向数据绑定将数据字段与文本框的 `Text` 属性相关联。</span><span class="sxs-lookup"><span data-stu-id="7359d-156">The `ItemTemplate` displays a single data field value (`ProductName`) using a Label Web control, while the `EditItemTemplate` and `InsertItemTemplate` present the data field value in a TextBox Web control that associates the data field with the TextBox's `Text` property using two-way databinding.</span></span> <span data-ttu-id="7359d-157">由于我们仅在此页中使用 DetailsView 来插入，因此你可以从两个 Templatefield 中删除 `ItemTemplate` 和 `EditItemTemplate`，不过，这并不会对保留它们有任何损害。</span><span class="sxs-lookup"><span data-stu-id="7359d-157">Since we are only using the DetailsView in this page for inserting, you may remove the `ItemTemplate` and `EditItemTemplate` from the two TemplateFields, although there's no harm in leaving them.</span></span>

<span data-ttu-id="7359d-158">由于 GridView 不支持 DetailsView 的内置插入功能，因此将 GridView 的 `ProductName` 字段转换为 TemplateField 将仅生成 `ItemTemplate` 并 `EditItemTemplate`：</span><span class="sxs-lookup"><span data-stu-id="7359d-158">Since the GridView does not support the built-in inserting features of the DetailsView, converting the GridView's `ProductName` field into a TemplateField results in only an `ItemTemplate` and `EditItemTemplate`:</span></span>

[!code-aspx[Main](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/samples/sample2.aspx)]

<span data-ttu-id="7359d-159">单击 "将此字段转换为 TemplateField" 后，Visual Studio 将创建一个 TemplateField，其模板模拟已转换 BoundField 的用户界面。</span><span class="sxs-lookup"><span data-stu-id="7359d-159">By clicking the "Convert this field into a TemplateField," Visual Studio has created a TemplateField whose templates mimic the user interface of the converted BoundField.</span></span> <span data-ttu-id="7359d-160">可以通过浏览器访问此页来验证这一点。</span><span class="sxs-lookup"><span data-stu-id="7359d-160">You can verify this by visiting this page through a browser.</span></span> <span data-ttu-id="7359d-161">你会发现，Templatefield 的外观和行为与改用 BoundFields 时的体验相同。</span><span class="sxs-lookup"><span data-stu-id="7359d-161">You'll find that the appearance and behavior of the TemplateFields is identical to the experience when BoundFields were used instead.</span></span>

> [!NOTE]
> <span data-ttu-id="7359d-162">根据需要随意自定义模板中的编辑界面。</span><span class="sxs-lookup"><span data-stu-id="7359d-162">Feel free to customize the editing interfaces in the templates as needed.</span></span> <span data-ttu-id="7359d-163">例如，我们可能希望 `UnitPrice` Templatefield 中的文本框呈现为小于 `ProductName` 文本框的文本框。</span><span class="sxs-lookup"><span data-stu-id="7359d-163">For example, we may want to have the TextBox in the `UnitPrice` TemplateFields rendered as a smaller textbox than the `ProductName` textbox.</span></span> <span data-ttu-id="7359d-164">若要实现此目的，可以将文本框的 `Columns` 属性设置为适当的值，或通过 `Width` 属性提供绝对宽度。</span><span class="sxs-lookup"><span data-stu-id="7359d-164">To accomplish this you can set the TextBox's `Columns` property to an appropriate value or provide an absolute width via the `Width` property.</span></span> <span data-ttu-id="7359d-165">在下一教程中，我们将了解如何通过将文本框替换为备用数据输入 Web 控件来完全自定义编辑界面。</span><span class="sxs-lookup"><span data-stu-id="7359d-165">In the next tutorial we'll see how to completely customize the editing interface by replacing the TextBox with an alternate data entry Web control.</span></span>

## <a name="step-3-adding-the-validation-controls-to-the-gridviewsedititemtemplate-s"></a><span data-ttu-id="7359d-166">步骤3：将验证控件添加到 GridView 的`EditItemTemplate`</span><span class="sxs-lookup"><span data-stu-id="7359d-166">Step 3: Adding the Validation Controls to the GridView's`EditItemTemplate` s</span></span>

<span data-ttu-id="7359d-167">构造数据输入窗体时，用户必须输入必填字段，并且提供的所有输入都是合法的格式正确的值，这一点非常重要。</span><span class="sxs-lookup"><span data-stu-id="7359d-167">When constructing data entry forms, it is important that users enter any required fields and that all provided inputs are legal, properly-formatted values.</span></span> <span data-ttu-id="7359d-168">为了帮助确保用户的输入有效，ASP.NET 提供了五个内置的验证控件，这些控件旨在用于验证单个输入控件的值：</span><span class="sxs-lookup"><span data-stu-id="7359d-168">To help ensure that a user's inputs are valid, ASP.NET provides five built-in validation controls that are designed to be used to validate the value of a single input control:</span></span>

- <span data-ttu-id="7359d-169">[RequiredFieldValidator](https://msdn.microsoft.com/library/5hbw267h(VS.80).aspx)确保已提供值</span><span class="sxs-lookup"><span data-stu-id="7359d-169">[RequiredFieldValidator](https://msdn.microsoft.com/library/5hbw267h(VS.80).aspx) ensures that a value has been provided</span></span>
- <span data-ttu-id="7359d-170">[CompareValidator](https://msdn.microsoft.com/library/db330ayw(VS.80).aspx)根据另一个 Web 控件值或常数值验证值，或确保该值的格式对于指定的数据类型是合法的</span><span class="sxs-lookup"><span data-stu-id="7359d-170">[CompareValidator](https://msdn.microsoft.com/library/db330ayw(VS.80).aspx) validates a value against another Web control value or a constant value, or ensures that the value's format is legal for a specified data type</span></span>
- <span data-ttu-id="7359d-171">[RangeValidator](https://msdn.microsoft.com/library/f70d09xt.aspx)可确保值在值范围内</span><span class="sxs-lookup"><span data-stu-id="7359d-171">[RangeValidator](https://msdn.microsoft.com/library/f70d09xt.aspx) ensures that a value is within a range of values</span></span>
- <span data-ttu-id="7359d-172">[RegularExpressionValidator](https://msdn.microsoft.com/library/eahwtc9e.aspx)根据[正则表达式](http://en.wikipedia.org/wiki/Regular_expression)验证值</span><span class="sxs-lookup"><span data-stu-id="7359d-172">[RegularExpressionValidator](https://msdn.microsoft.com/library/eahwtc9e.aspx) validates a value against a [regular expression](http://en.wikipedia.org/wiki/Regular_expression)</span></span>
- <span data-ttu-id="7359d-173">[CustomValidator](https://msdn.microsoft.com/library/9eee01cx(VS.80).aspx)根据自定义的用户定义方法验证值</span><span class="sxs-lookup"><span data-stu-id="7359d-173">[CustomValidator](https://msdn.microsoft.com/library/9eee01cx(VS.80).aspx) validates a value against a custom, user-defined method</span></span>

<span data-ttu-id="7359d-174">有关这五个控件的详细信息，请参阅[ASP.NET 快速入门教程](https://asp.net/QuickStart/aspnet/)中的 "[验证控件" 部分](https://quickstarts.asp.net/quickstartv20/aspnet/doc/ctrlref/validation/default.aspx)。</span><span class="sxs-lookup"><span data-stu-id="7359d-174">For more information on these five controls, check out the [Validation Controls section](https://quickstarts.asp.net/quickstartv20/aspnet/doc/ctrlref/validation/default.aspx) of the [ASP.NET Quickstart Tutorials](https://asp.net/QuickStart/aspnet/).</span></span>

<span data-ttu-id="7359d-175">对于本教程，我们将需要在 detailsview 和 GridView `ProductName` Templatefield 中使用 RequiredFieldValidator，并在 DetailsView 的 `UnitPrice` TemplateField 中使用 RequiredFieldValidator。</span><span class="sxs-lookup"><span data-stu-id="7359d-175">For our tutorial we'll need to use a RequiredFieldValidator in both the DetailsView and GridView's `ProductName` TemplateFields and a RequiredFieldValidator in the DetailsView's `UnitPrice` TemplateField.</span></span> <span data-ttu-id="7359d-176">此外，我们还需要将 CompareValidator 添加到这两个控件的 `UnitPrice` Templatefield，以确保输入的价格的值大于或等于0，并且以有效的货币格式呈现。</span><span class="sxs-lookup"><span data-stu-id="7359d-176">Furthermore, we'll need to add a CompareValidator to both controls' `UnitPrice` TemplateFields that ensures that the entered price has a value greater than or equal to 0 and is presented in a valid currency format.</span></span>

> [!NOTE]
> <span data-ttu-id="7359d-177">尽管 ASP.NET 1.x 具有这些相同的五个验证控件，但 ASP.NET 2.0 已增加了许多改进，主要两个是 Internet Explorer 之外的浏览器的客户端脚本支持，并能够将页面上的验证控件分区到验证组。</span><span class="sxs-lookup"><span data-stu-id="7359d-177">While ASP.NET 1.x had these same five validation controls, ASP.NET 2.0 has added a number of improvements, the main two being client-side script support for browsers other than Internet Explorer and the ability to partition validation controls on a page into validation groups.</span></span> <span data-ttu-id="7359d-178">有关2.0 中的新验证控制功能的详细信息，请参阅[二级 the ASP.NET 2.0 中的验证控件](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx)。</span><span class="sxs-lookup"><span data-stu-id="7359d-178">For more information on the new validation control features in 2.0, refer to [Dissecting the Validation Controls in ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx).</span></span>

<span data-ttu-id="7359d-179">首先，将必要的验证控件添加到 GridView Templatefield 中的 `EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="7359d-179">Let's start by adding the necessary validation controls to the `EditItemTemplate` s in the GridView's TemplateFields.</span></span> <span data-ttu-id="7359d-180">若要实现此目的，请在 GridView 的智能标记中单击 "编辑模板" 链接，以打开模板编辑界面。</span><span class="sxs-lookup"><span data-stu-id="7359d-180">To accomplish this, click on the Edit Templates link from the GridView's smart tag to bring up the template editing interface.</span></span> <span data-ttu-id="7359d-181">从这里，你可以从下拉列表中选择要编辑的模板。</span><span class="sxs-lookup"><span data-stu-id="7359d-181">From here, you can select which template to edit from the drop-down list.</span></span> <span data-ttu-id="7359d-182">由于我们要增加编辑界面，因此我们需要将验证控件添加到 `ProductName`，并 `UnitPrice`的 `EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="7359d-182">Since we want to augment the editing interface, we need to add validation controls to the `ProductName` and `UnitPrice`'s `EditItemTemplate` s.</span></span>

<span data-ttu-id="7359d-183">[![我们需要扩展 ProductName 和 EditItemTemplates 的](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image11.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="7359d-183">[![We Need to Extend the ProductName and UnitPrice's EditItemTemplates](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image11.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image10.png)</span></span>

<span data-ttu-id="7359d-184">**图 4**：需要扩展 `ProductName` 和 `UnitPrice`的 `EditItemTemplate` （[单击以查看完全大小的图像](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="7359d-184">**Figure 4**: We Need to Extend the `ProductName` and `UnitPrice`'s `EditItemTemplate` s ([Click to view full-size image](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image12.png))</span></span>

<span data-ttu-id="7359d-185">在 "`ProductName`" `EditItemTemplate`中，通过将 RequiredFieldValidator 拖放到模板编辑界面中来添加一个，并将其放置在文本框后面。</span><span class="sxs-lookup"><span data-stu-id="7359d-185">In the `ProductName` `EditItemTemplate`, add a RequiredFieldValidator by dragging it from the Toolbox into the template editing interface, placing after the TextBox.</span></span>

<span data-ttu-id="7359d-186">[![将 RequiredFieldValidator 添加到 ProductName EditItemTemplate](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image14.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="7359d-186">[![Add a RequiredFieldValidator to the ProductName EditItemTemplate](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image14.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image13.png)</span></span>

<span data-ttu-id="7359d-187">**图 5**：将 RequiredFieldValidator 添加到 `ProductName` `EditItemTemplate` （[单击查看完全大小的图像](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="7359d-187">**Figure 5**: Add a RequiredFieldValidator to the `ProductName` `EditItemTemplate` ([Click to view full-size image](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image15.png))</span></span>

<span data-ttu-id="7359d-188">所有验证控件都是通过验证单个 ASP.NET Web 控件的输入来完成的。</span><span class="sxs-lookup"><span data-stu-id="7359d-188">All validation controls work by validating the input of a single ASP.NET Web control.</span></span> <span data-ttu-id="7359d-189">因此，我们需要指出，我们刚刚添加的 RequiredFieldValidator 应根据 `EditItemTemplate`中的文本框进行验证;这是通过将验证控件的[ControlToValidate 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.controltovalidate(VS.80).aspx)设置为相应 Web 控件的 `ID` 来完成的。</span><span class="sxs-lookup"><span data-stu-id="7359d-189">Therefore, we need to indicate that the RequiredFieldValidator we just added should validate against the TextBox in the `EditItemTemplate`; this is accomplished by setting the validation control's [ControlToValidate property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.controltovalidate(VS.80).aspx) to the `ID` of the appropriate Web control.</span></span> <span data-ttu-id="7359d-190">文本框当前具有 `TextBox1`的 nondescript `ID`，但我们将其更改为更合适的内容。</span><span class="sxs-lookup"><span data-stu-id="7359d-190">The TextBox currently has the rather nondescript `ID` of `TextBox1`, but let's change it to something more appropriate.</span></span> <span data-ttu-id="7359d-191">单击模板中的文本框，然后从属性窗口将 `ID` 从 `TextBox1` 更改为 `EditProductName`。</span><span class="sxs-lookup"><span data-stu-id="7359d-191">Click on the TextBox in the template and then, from the Properties window, change the `ID` from `TextBox1` to `EditProductName`.</span></span>

<span data-ttu-id="7359d-192">[![将文本框的 ID 改为 EditProductName](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image17.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="7359d-192">[![Change the TextBox's ID to EditProductName](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image17.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image16.png)</span></span>

<span data-ttu-id="7359d-193">**图 6**：将文本框的 `ID` 更改为 `EditProductName` （[单击以查看完全大小的图像](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="7359d-193">**Figure 6**: Change the TextBox's `ID` to `EditProductName` ([Click to view full-size image](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image18.png))</span></span>

<span data-ttu-id="7359d-194">接下来，将 RequiredFieldValidator 的 `ControlToValidate` 属性设置为 `EditProductName`。</span><span class="sxs-lookup"><span data-stu-id="7359d-194">Next, set the RequiredFieldValidator's `ControlToValidate` property to `EditProductName`.</span></span> <span data-ttu-id="7359d-195">最后，将[ErrorMessage 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.errormessage(VS.80).aspx)设置为 "必须提供产品名称"，将[Text 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.text(VS.80).aspx)设置为 "\*"。</span><span class="sxs-lookup"><span data-stu-id="7359d-195">Finally, set the [ErrorMessage property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.errormessage(VS.80).aspx) to "You must provide the product's name" and the [Text property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.text(VS.80).aspx) to "\*".</span></span> <span data-ttu-id="7359d-196">如果验证失败，则 `Text` 属性值（如果提供）是验证控件显示的文本。</span><span class="sxs-lookup"><span data-stu-id="7359d-196">The `Text` property value, if provided, is the text that is displayed by the validation control if the validation fails.</span></span> <span data-ttu-id="7359d-197">ValidationSummary 控件使用所需的 `ErrorMessage` 属性值;如果省略 `Text` 属性值，则 `ErrorMessage` 属性值也是验证控件在无效输入上显示的文本。</span><span class="sxs-lookup"><span data-stu-id="7359d-197">The `ErrorMessage` property value, which is required, is used by the ValidationSummary control; if the `Text` property value is omitted, the `ErrorMessage` property value is also the text displayed by the validation control on invalid input.</span></span>

<span data-ttu-id="7359d-198">设置 RequiredFieldValidator 的这三个属性后，屏幕应类似于图7所示。</span><span class="sxs-lookup"><span data-stu-id="7359d-198">After setting these three properties of the RequiredFieldValidator, your screen should look similar to Figure 7.</span></span>

<span data-ttu-id="7359d-199">[![设置 RequiredFieldValidator 的 ControlToValidate、ErrorMessage 和 Text 属性](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image20.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="7359d-199">[![Set the RequiredFieldValidator's ControlToValidate, ErrorMessage, and Text Properties](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image20.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image19.png)</span></span>

<span data-ttu-id="7359d-200">**图 7**：设置 RequiredFieldValidator 的 `ControlToValidate`、`ErrorMessage`和 `Text` 属性（[单击以查看完全大小的图像](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image21.png)）</span><span class="sxs-lookup"><span data-stu-id="7359d-200">**Figure 7**: Set the RequiredFieldValidator's `ControlToValidate`, `ErrorMessage`, and `Text` Properties ([Click to view full-size image](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image21.png))</span></span>

<span data-ttu-id="7359d-201">将 RequiredFieldValidator 添加到 `ProductName` `EditItemTemplate`后，剩下的就是将必要的验证添加到 `UnitPrice` `EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="7359d-201">With the RequiredFieldValidator added to the `ProductName` `EditItemTemplate`, all that remains is to add the necessary validation to the `UnitPrice` `EditItemTemplate`.</span></span> <span data-ttu-id="7359d-202">由于我们决定，在编辑记录时，`UnitPrice` 是可选的，因此，不需要添加 RequiredFieldValidator。</span><span class="sxs-lookup"><span data-stu-id="7359d-202">Since we've decided that, for this page, the `UnitPrice` is optional when editing a record, we don't need to add a RequiredFieldValidator.</span></span> <span data-ttu-id="7359d-203">但是，我们需要添加一个 CompareValidator，以确保 `UnitPrice`（如提供）的格式正确设置为货币，并且大于或等于0。</span><span class="sxs-lookup"><span data-stu-id="7359d-203">We do, however, need to add a CompareValidator to ensure that the `UnitPrice`, if supplied, is properly formatted as a currency and is greater than or equal to 0.</span></span>

<span data-ttu-id="7359d-204">将 CompareValidator 添加到 `UnitPrice` `EditItemTemplate`之前，让我们先将 TextBox Web 控件的 ID 从 `TextBox2` 更改为 `EditUnitPrice`。</span><span class="sxs-lookup"><span data-stu-id="7359d-204">Before we add the CompareValidator to the `UnitPrice` `EditItemTemplate`, let's first change the TextBox Web control's ID from `TextBox2` to `EditUnitPrice`.</span></span> <span data-ttu-id="7359d-205">做出此更改后，添加 CompareValidator，将其 `ControlToValidate` 属性设置为 `EditUnitPrice`，其 `ErrorMessage` 属性设置为 "该价格必须大于或等于零，并且不能包含货币符号"，并将其 `Text` 属性设置为 "\*"。</span><span class="sxs-lookup"><span data-stu-id="7359d-205">After making this change, add the CompareValidator, setting its `ControlToValidate` property to `EditUnitPrice`, its `ErrorMessage` property to "The price must be greater than or equal to zero and cannot include the currency symbol", and its `Text` property to "\*".</span></span>

<span data-ttu-id="7359d-206">若要指示 `UnitPrice` 值必须大于或等于0，请将 CompareValidator 的[Operator 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.comparevalidator.operator(VS.80).aspx)设置为 "`GreaterThanEqual`，将其[ValueToCompare 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.comparevalidator.valuetocompare(VS.80).aspx)设置为" 0 "，并将其[Type 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basecomparevalidator.type.aspx)设置为" `Currency`"。</span><span class="sxs-lookup"><span data-stu-id="7359d-206">To indicate that the `UnitPrice` value must be greater than or equal to 0, set the CompareValidator's [Operator property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.comparevalidator.operator(VS.80).aspx) to `GreaterThanEqual`, its [ValueToCompare property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.comparevalidator.valuetocompare(VS.80).aspx) to "0", and its [Type property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basecomparevalidator.type.aspx) to `Currency`.</span></span> <span data-ttu-id="7359d-207">以下声明性语法显示了进行这些更改之后 `UnitPrice` TemplateField 的 `EditItemTemplate`：</span><span class="sxs-lookup"><span data-stu-id="7359d-207">The following declarative syntax shows the `UnitPrice` TemplateField's `EditItemTemplate` after these changes have been made:</span></span>

[!code-aspx[Main](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/samples/sample3.aspx)]

<span data-ttu-id="7359d-208">进行这些更改后，在浏览器中打开该页。</span><span class="sxs-lookup"><span data-stu-id="7359d-208">After making these changes, open the page in a browser.</span></span> <span data-ttu-id="7359d-209">如果在编辑产品时尝试省略名称或输入无效价格值，则文本框的旁边会出现一个星号。</span><span class="sxs-lookup"><span data-stu-id="7359d-209">If you attempt to omit the name or enter an invalid price value when editing a product, an asterisk appears next to the textbox.</span></span> <span data-ttu-id="7359d-210">如图8所示，包含货币符号（如 $19.95）的价格值被视为无效。</span><span class="sxs-lookup"><span data-stu-id="7359d-210">As Figure 8 shows, a price value that includes the currency symbol such as $19.95 is considered invalid.</span></span> <span data-ttu-id="7359d-211">CompareValidator 的 `Currency` `Type` 允许使用数字分隔符（如逗号或句点）和前导加号或减号，但*不允许货币*符号。</span><span class="sxs-lookup"><span data-stu-id="7359d-211">The CompareValidator's `Currency` `Type` allows for digit separators (such as commas or periods, depending on the culture settings) and a leading plus or minus sign, but does *not* permit a currency symbol.</span></span> <span data-ttu-id="7359d-212">此行为可能会 perplex 用户，因为编辑界面当前使用货币格式呈现 `UnitPrice`。</span><span class="sxs-lookup"><span data-stu-id="7359d-212">This behavior may perplex users as the editing interface currently renders the `UnitPrice` using the currency format.</span></span>

> [!NOTE]
> <span data-ttu-id="7359d-213">请记住，在*与插入、更新和删除教程关联的事件*中，我们将 BoundField 的 `DataFormatString` 属性设置为 `{0:c}`，以便将其设置为货币格式。</span><span class="sxs-lookup"><span data-stu-id="7359d-213">Recall that in the *Events Associated with Inserting, Updating, and Deleting* tutorial we set the BoundField's `DataFormatString` property to `{0:c}` in order to format it as a currency.</span></span> <span data-ttu-id="7359d-214">而且，我们将 `ApplyFormatInEditMode` 属性设置为 "true"，这会导致 GridView 的编辑界面将 `UnitPrice` 的格式设置为货币。</span><span class="sxs-lookup"><span data-stu-id="7359d-214">Furthermore, we set the `ApplyFormatInEditMode` property to true, causing the GridView's editing interface to format the `UnitPrice` as a currency.</span></span> <span data-ttu-id="7359d-215">将 BoundField 转换为 TemplateField 时，Visual Studio 会记下这些设置，并使用数据绑定语法 `<%# Bind("UnitPrice", "{0:c}") %>`将文本框的 `Text` 属性的格式设置为货币。</span><span class="sxs-lookup"><span data-stu-id="7359d-215">When converting the BoundField into a TemplateField, Visual Studio noted these settings and formatted the TextBox's `Text` property as a currency using the databinding syntax `<%# Bind("UnitPrice", "{0:c}") %>`.</span></span>

<span data-ttu-id="7359d-216">[![带有无效输入的文本框旁边显示星号](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image23.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="7359d-216">[![An Asterisk Appears Next to the Textboxes with Invalid Input](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image23.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image22.png)</span></span>

<span data-ttu-id="7359d-217">**图 8**：包含无效输入的文本框旁边显示一个星号（[单击以查看完全大小的图像](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image24.png)）</span><span class="sxs-lookup"><span data-stu-id="7359d-217">**Figure 8**: An Asterisk Appears Next to the Textboxes with Invalid Input ([Click to view full-size image](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image24.png))</span></span>

<span data-ttu-id="7359d-218">当验证按原样工作时，用户必须在编辑记录时手动删除货币符号，这是不可接受的。</span><span class="sxs-lookup"><span data-stu-id="7359d-218">While the validation works as-is, the user has to manually remove the currency symbol when editing a record, which is not acceptable.</span></span> <span data-ttu-id="7359d-219">为此，我们有三个选项：</span><span class="sxs-lookup"><span data-stu-id="7359d-219">To remedy this, we have three options:</span></span>

1. <span data-ttu-id="7359d-220">将 `EditItemTemplate` 配置为将 `UnitPrice` 值设置为货币格式。</span><span class="sxs-lookup"><span data-stu-id="7359d-220">Configure the `EditItemTemplate` so that the `UnitPrice` value is not formatted as a currency.</span></span>
2. <span data-ttu-id="7359d-221">允许用户通过删除 CompareValidator 来输入货币符号，并将其替换为正确检查正确格式货币值的 RegularExpressionValidator。</span><span class="sxs-lookup"><span data-stu-id="7359d-221">Allow the user to enter a currency symbol by removing the CompareValidator and replacing it with a RegularExpressionValidator that properly checks for a properly formatted currency value.</span></span> <span data-ttu-id="7359d-222">此处的问题在于，用于验证货币值的正则表达式并不是很好，如果我们想要合并区域性设置，则需要编写代码。</span><span class="sxs-lookup"><span data-stu-id="7359d-222">The problem here is that the regular expression to validate a currency value is not pretty and would require writing code if we wanted to incorporate culture settings.</span></span>
3. <span data-ttu-id="7359d-223">完全移除验证控件，并依赖于 GridView `RowUpdating` 事件处理程序中的服务器端验证逻辑。</span><span class="sxs-lookup"><span data-stu-id="7359d-223">Remove the validation control altogether and rely on server-side validation logic in the GridView's `RowUpdating` event handler.</span></span>

<span data-ttu-id="7359d-224">对于本练习，我们将提供选项 #1。</span><span class="sxs-lookup"><span data-stu-id="7359d-224">Let's go with option #1 for this exercise.</span></span> <span data-ttu-id="7359d-225">由于 `EditItemTemplate`： `<%# Bind("UnitPrice", "{0:c}") %>`中文本框的数据绑定表达式，当前 `UnitPrice` 被设置为货币格式。</span><span class="sxs-lookup"><span data-stu-id="7359d-225">Currently the `UnitPrice` is formatted as a currency due to the databinding expression for the TextBox in the `EditItemTemplate`: `<%# Bind("UnitPrice", "{0:c}") %>`.</span></span> <span data-ttu-id="7359d-226">将 Bind 语句更改为 `Bind("UnitPrice", "{0:n2}")`，该语句将结果的格式设置为具有两位数精度的数字。</span><span class="sxs-lookup"><span data-stu-id="7359d-226">Change the Bind statement to `Bind("UnitPrice", "{0:n2}")`, which formats the result as a number with two digits of precision.</span></span> <span data-ttu-id="7359d-227">这可以直接通过声明性语法或从 `UnitPrice` TemplateField 的 `EditItemTemplate` 中的 `EditUnitPrice` 文本框中单击 "编辑数据绑定" 链接来完成（请参阅图9和10）。</span><span class="sxs-lookup"><span data-stu-id="7359d-227">This can be done directly through the declarative syntax or by clicking on the Edit DataBindings link from the `EditUnitPrice` TextBox in the `UnitPrice` TemplateField's `EditItemTemplate` (see Figures 9 and 10).</span></span>

<span data-ttu-id="7359d-228">[![单击文本框的 "编辑 databinding" 链接](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image26.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="7359d-228">[![Click on the TextBox's Edit DataBindings link](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image26.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image25.png)</span></span>

<span data-ttu-id="7359d-229">**图 9**：单击文本框的 "编辑 databinding" 链接（[单击以查看完全大小的图像](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image27.png)）</span><span class="sxs-lookup"><span data-stu-id="7359d-229">**Figure 9**: Click on the TextBox's Edit DataBindings link ([Click to view full-size image](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image27.png))</span></span>

<span data-ttu-id="7359d-230">[![在 Bind 语句中指定格式说明符](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image29.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="7359d-230">[![Specify the Format Specifier in the Bind Statement](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image29.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image28.png)</span></span>

<span data-ttu-id="7359d-231">**图 10**：在 `Bind` 语句中指定格式说明符（[单击以查看完全大小的图像](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image30.png)）</span><span class="sxs-lookup"><span data-stu-id="7359d-231">**Figure 10**: Specify the Format Specifier in the `Bind` Statement ([Click to view full-size image](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image30.png))</span></span>

<span data-ttu-id="7359d-232">进行此更改后，编辑界面中的格式化价格以逗号作为组分隔符，将句点作为小数点分隔符，但保留货币符号。</span><span class="sxs-lookup"><span data-stu-id="7359d-232">With this change, the formatted price in the editing interface includes commas as the group separator and a period as the decimal separator, but leaves off the currency symbol.</span></span>

> [!NOTE]
> <span data-ttu-id="7359d-233">`UnitPrice` `EditItemTemplate` 不包含 RequiredFieldValidator，允许回发到不幸和更新逻辑来开始。</span><span class="sxs-lookup"><span data-stu-id="7359d-233">The `UnitPrice` `EditItemTemplate` doesn't include a RequiredFieldValidator, allowing the postback to ensue and the updating logic to commence.</span></span> <span data-ttu-id="7359d-234">但是，从*检查与插入、更新和删除教程关联的事件*中复制的 `RowUpdating` 事件处理程序包括以编程方式进行检查，以确保提供 `UnitPrice`。</span><span class="sxs-lookup"><span data-stu-id="7359d-234">However, the `RowUpdating` event handler copied over from the *Examining the Events Associated with Inserting, Updating, and Deleting* tutorial includes a programmatic check that ensures that the `UnitPrice` is provided.</span></span> <span data-ttu-id="7359d-235">随意删除此逻辑，按原样保留，或将 RequiredFieldValidator 添加到 `UnitPrice` `EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="7359d-235">Feel free to remove this logic, leave it in as-is, or add a RequiredFieldValidator to the `UnitPrice` `EditItemTemplate`.</span></span>

## <a name="step-4-summarizing-data-entry-problems"></a><span data-ttu-id="7359d-236">步骤4：汇总数据输入问题</span><span class="sxs-lookup"><span data-stu-id="7359d-236">Step 4: Summarizing Data Entry Problems</span></span>

<span data-ttu-id="7359d-237">除了五个验证控件外，ASP.NET 还包含[ValidationSummary 控件](https://msdn.microsoft.com/library/f9h59855(VS.80).aspx)，该控件显示检测到无效数据的那些验证控件的 `ErrorMessage`。</span><span class="sxs-lookup"><span data-stu-id="7359d-237">In addition to the five validation controls, ASP.NET includes the [ValidationSummary control](https://msdn.microsoft.com/library/f9h59855(VS.80).aspx), which displays the `ErrorMessage` s of those validation controls that detected invalid data.</span></span> <span data-ttu-id="7359d-238">此摘要数据可以在网页上或通过模式的客户端 messagebox 显示为文本。</span><span class="sxs-lookup"><span data-stu-id="7359d-238">This summary data can be displayed as text on the web page or through a modal, client-side messagebox.</span></span> <span data-ttu-id="7359d-239">让我们来增强本教程，使其包括客户端 messagebox，其中汇总了所有验证问题。</span><span class="sxs-lookup"><span data-stu-id="7359d-239">Let's enhance this tutorial to include a client-side messagebox summarizing any validation problems.</span></span>

<span data-ttu-id="7359d-240">若要实现此目的，请将 ValidationSummary 控件从工具箱拖到设计器上。</span><span class="sxs-lookup"><span data-stu-id="7359d-240">To accomplish this, drag a ValidationSummary control from the Toolbox onto the Designer.</span></span> <span data-ttu-id="7359d-241">验证控件的位置并不重要，因为我们要将它配置为仅将摘要显示为 messagebox。</span><span class="sxs-lookup"><span data-stu-id="7359d-241">The location of the Validation control doesn't really matter, since we're going to configure it to only display the summary as a messagebox.</span></span> <span data-ttu-id="7359d-242">添加控件后，将其[ShowSummary 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.validationsummary.showsummary(VS.80).aspx)设置为 "`False`"，并将其[ShowMessageBox 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.validationsummary.showmessagebox(VS.80).aspx)设置为 "`True`"。</span><span class="sxs-lookup"><span data-stu-id="7359d-242">After adding the control, set its [ShowSummary property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.validationsummary.showsummary(VS.80).aspx) to `False` and its [ShowMessageBox property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.validationsummary.showmessagebox(VS.80).aspx) to `True`.</span></span> <span data-ttu-id="7359d-243">添加此项后，会在客户端 messagebox 中汇总任何验证错误。</span><span class="sxs-lookup"><span data-stu-id="7359d-243">With this addition, any validation errors are summarized in a client-side messagebox.</span></span>

<span data-ttu-id="7359d-244">[![在客户端 Messagebox 中汇总验证错误](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image32.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="7359d-244">[![The Validation Errors are Summarized in a Client-Side Messagebox](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image32.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image31.png)</span></span>

<span data-ttu-id="7359d-245">**图 11**：在客户端 Messagebox 中汇总验证错误（[单击以查看完全大小的映像](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image33.png)）</span><span class="sxs-lookup"><span data-stu-id="7359d-245">**Figure 11**: The Validation Errors are Summarized in a Client-Side Messagebox ([Click to view full-size image](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image33.png))</span></span>

## <a name="step-5-adding-the-validation-controls-to-the-detailsviewsinsertitemtemplate"></a><span data-ttu-id="7359d-246">步骤5：将验证控件添加到 DetailsView 的`InsertItemTemplate`</span><span class="sxs-lookup"><span data-stu-id="7359d-246">Step 5: Adding the Validation Controls to the DetailsView's`InsertItemTemplate`</span></span>

<span data-ttu-id="7359d-247">本教程剩下的所有工作就是将验证控件添加到 DetailsView 的插入界面。</span><span class="sxs-lookup"><span data-stu-id="7359d-247">All that remains for this tutorial is to add the validation controls to the DetailsView's inserting interface.</span></span> <span data-ttu-id="7359d-248">将验证控件添加到 DetailsView 的模板的过程与步骤3中所述的过程相同。因此，在此步骤中，我们将逐步完成该任务。</span><span class="sxs-lookup"><span data-stu-id="7359d-248">The process of adding validation controls to the DetailsView's templates is identical to that examined in Step 3; therefore, we'll breeze through the task in this step.</span></span> <span data-ttu-id="7359d-249">正如我们在 GridView 的 `EditItemTemplate` 中所做的那样，我建议您将 nondescript `TextBox1` 和 `TextBox2` 中的文本框 `ID` 重命名为 `InsertProductName` 和 `InsertUnitPrice`。</span><span class="sxs-lookup"><span data-stu-id="7359d-249">As we did with the GridView's `EditItemTemplate` s, I encourage you to rename the `ID` s of the TextBoxes from the nondescript `TextBox1` and `TextBox2` to `InsertProductName` and `InsertUnitPrice`.</span></span>

<span data-ttu-id="7359d-250">将 RequiredFieldValidator 添加到 `ProductName` `InsertItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="7359d-250">Add a RequiredFieldValidator to the `ProductName` `InsertItemTemplate`.</span></span> <span data-ttu-id="7359d-251">将 `ControlToValidate` 设置为模板中文本框的 `ID`，其 `Text` 属性设置为 "\*"，将其 `ErrorMessage` 属性设置为 "必须提供产品名称"。</span><span class="sxs-lookup"><span data-stu-id="7359d-251">Set the `ControlToValidate` to the `ID` of the TextBox in the template, its `Text` property to "\*" and its `ErrorMessage` property to "You must provide the product's name".</span></span>

<span data-ttu-id="7359d-252">由于在添加新记录时此页需要 `UnitPrice`，因此请将 RequiredFieldValidator 添加到 `UnitPrice` `InsertItemTemplate`，并相应地设置其 `ControlToValidate`、`Text`和 `ErrorMessage` 属性。</span><span class="sxs-lookup"><span data-stu-id="7359d-252">Since the `UnitPrice` is required for this page when adding a new record, add a RequiredFieldValidator to the `UnitPrice` `InsertItemTemplate`, setting its `ControlToValidate`, `Text`, and `ErrorMessage` properties appropriately.</span></span> <span data-ttu-id="7359d-253">最后，将 CompareValidator 添加到 `UnitPrice` `InsertItemTemplate`，同时配置其 `ControlToValidate`、`Text`、`ErrorMessage`、`Type`、`Operator`和 `ValueToCompare` 属性，就像我们在 GridView 的 `UnitPrice`中使用 `EditItemTemplate`的 CompareValidator 一样。</span><span class="sxs-lookup"><span data-stu-id="7359d-253">Finally, add a CompareValidator to the `UnitPrice` `InsertItemTemplate` as well, configuring its `ControlToValidate`, `Text`, `ErrorMessage`, `Type`, `Operator`, and `ValueToCompare` properties just like we did with the `UnitPrice`'s CompareValidator in the GridView's `EditItemTemplate`.</span></span>

<span data-ttu-id="7359d-254">添加这些验证控件后，如果未提供其名称或者其价格为负数或非法格式，则不能将新产品添加到系统中。</span><span class="sxs-lookup"><span data-stu-id="7359d-254">After adding these validation controls, a new product cannot be added to the system if its name is not supplied or if its price is a negative number or illegally formatted.</span></span>

<span data-ttu-id="7359d-255">[已将 ![验证逻辑添加到 DetailsView 的插入界面](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image35.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="7359d-255">[![Validation Logic has been Added to the DetailsView's Inserting Interface](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image35.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image34.png)</span></span>

<span data-ttu-id="7359d-256">**图 12**：已将验证逻辑添加到 DetailsView 的插入界面（[单击以查看完全大小的图像](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image36.png)）</span><span class="sxs-lookup"><span data-stu-id="7359d-256">**Figure 12**: Validation Logic has been Added to the DetailsView's Inserting Interface ([Click to view full-size image](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image36.png))</span></span>

## <a name="step-6-partitioning-the-validation-controls-into-validation-groups"></a><span data-ttu-id="7359d-257">步骤6：将验证控件分区为验证组</span><span class="sxs-lookup"><span data-stu-id="7359d-257">Step 6: Partitioning the Validation Controls Into Validation Groups</span></span>

<span data-ttu-id="7359d-258">我们的页面包含两个逻辑上不同的验证控件集：它们对应于 GridView 的编辑界面，后者对应于 DetailsView 的插入界面。</span><span class="sxs-lookup"><span data-stu-id="7359d-258">Our page consists of two logically disparate sets of validation controls: those that correspond to the GridView's editing interface and those that correspond to the DetailsView's inserting interface.</span></span> <span data-ttu-id="7359d-259">默认情况下，当发生回发时，将检查页上的*所有*验证控件。</span><span class="sxs-lookup"><span data-stu-id="7359d-259">By default, when a postback occurs *all* validation controls on the page are checked.</span></span> <span data-ttu-id="7359d-260">但是，在编辑记录时，我们不想要验证 DetailsView 的插入界面的验证控件。</span><span class="sxs-lookup"><span data-stu-id="7359d-260">However, when editing a record we don't want the DetailsView's inserting interface's validation controls to validate.</span></span> <span data-ttu-id="7359d-261">图13说明了当用户使用完全合法的值编辑产品时的当前难题，单击 "更新" 将导致验证错误，因为插入界面中的名称和价格值为空。</span><span class="sxs-lookup"><span data-stu-id="7359d-261">Figure 13 illustrates our current dilemma when a user is editing a product with perfectly legal values, clicking Update causes a validation error because the name and price values in the inserting interface are blank.</span></span>

<span data-ttu-id="7359d-262">[更新产品 ![会导致插入接口的验证控件激发](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image38.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="7359d-262">[![Updating a Product Causes the Inserting Interface's Validation Controls to Fire](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image38.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image37.png)</span></span>

<span data-ttu-id="7359d-263">**图 13**：更新产品会导致插入接口的验证控件激发（[单击查看完全大小的图像](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image39.png)）</span><span class="sxs-lookup"><span data-stu-id="7359d-263">**Figure 13**: Updating a Product Causes the Inserting Interface's Validation Controls to Fire ([Click to view full-size image](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image39.png))</span></span>

<span data-ttu-id="7359d-264">可以通过 `ValidationGroup` 属性将 ASP.NET 2.0 中的验证控件分区为验证组。</span><span class="sxs-lookup"><span data-stu-id="7359d-264">The validation controls in ASP.NET 2.0 can be partitioned into validation groups through their `ValidationGroup` property.</span></span> <span data-ttu-id="7359d-265">若要将组中的一组验证控件关联起来，只需将其 `ValidationGroup` 属性设置为相同的值。</span><span class="sxs-lookup"><span data-stu-id="7359d-265">To associate a set of validation controls in a group, simply set their `ValidationGroup` property to the same value.</span></span> <span data-ttu-id="7359d-266">对于本教程，请将 GridView Templatefield 中验证控件的 `ValidationGroup` 属性设置为 "`EditValidationControls`，并将 DetailsView 的 Templatefield 的 `ValidationGroup` 属性设置为" `InsertValidationControls`"。</span><span class="sxs-lookup"><span data-stu-id="7359d-266">For our tutorial, set the `ValidationGroup` properties of the validation controls in the GridView's TemplateFields to `EditValidationControls` and the `ValidationGroup` properties of the DetailsView's TemplateFields to `InsertValidationControls`.</span></span> <span data-ttu-id="7359d-267">使用设计器的编辑模板界面时，可以直接在声明性标记中或通过属性窗口来完成这些更改。</span><span class="sxs-lookup"><span data-stu-id="7359d-267">These changes can be done directly in the declarative markup or through the Properties window when using the Designer's edit template interface.</span></span>

<span data-ttu-id="7359d-268">除了验证控件外，ASP.NET 2.0 中与按钮和按钮相关的控件也包含 `ValidationGroup` 属性。</span><span class="sxs-lookup"><span data-stu-id="7359d-268">In addition to the validation controls, the Button and Button-related controls in ASP.NET 2.0 also include a `ValidationGroup` property.</span></span> <span data-ttu-id="7359d-269">仅当回发由具有相同 `ValidationGroup` 属性设置的按钮引发时，才检查验证组的验证程序的有效性。</span><span class="sxs-lookup"><span data-stu-id="7359d-269">A validation group's validators are checked for validity only when a postback is induced by a Button that has the same `ValidationGroup` property setting.</span></span> <span data-ttu-id="7359d-270">例如，为了使 DetailsView 的 "插入" 按钮触发 `InsertValidationControls` 验证组，我们需要将 CommandField 的 `ValidationGroup` 属性设置为 "`InsertValidationControls`" （参见图14）。</span><span class="sxs-lookup"><span data-stu-id="7359d-270">For example, in order for the DetailsView's Insert button to trigger the `InsertValidationControls` validation group we need to set the CommandField's `ValidationGroup` property to `InsertValidationControls` (see Figure 14).</span></span> <span data-ttu-id="7359d-271">此外，将 GridView 的 CommandField's `ValidationGroup` 属性设置为 `EditValidationControls`。</span><span class="sxs-lookup"><span data-stu-id="7359d-271">Additionally, set the GridView's CommandField's `ValidationGroup` property to `EditValidationControls`.</span></span>

<span data-ttu-id="7359d-272">[![将 DetailsView 的 CommandField's ValidationGroup 属性设置为 InsertValidationControls](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image41.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="7359d-272">[![Set the DetailsView's CommandField's ValidationGroup property to InsertValidationControls](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image41.png)](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image40.png)</span></span>

<span data-ttu-id="7359d-273">**图 14**：将 DetailsView 的 CommandField's `ValidationGroup` 属性设置为 "`InsertValidationControls`[" （单击查看完全大小的图像](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image42.png)）</span><span class="sxs-lookup"><span data-stu-id="7359d-273">**Figure 14**: Set the DetailsView's CommandField's `ValidationGroup` property to `InsertValidationControls` ([Click to view full-size image](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/_static/image42.png))</span></span>

<span data-ttu-id="7359d-274">进行这些更改后，DetailsView 和 GridView 的 Templatefield 和 CommandFields 应类似于以下内容：</span><span class="sxs-lookup"><span data-stu-id="7359d-274">After these changes, the DetailsView and GridView's TemplateFields and CommandFields should look similar to the following:</span></span>

<span data-ttu-id="7359d-275">DetailsView 的 Templatefield 和 CommandField</span><span class="sxs-lookup"><span data-stu-id="7359d-275">The DetailsView's TemplateFields and CommandField</span></span>

[!code-aspx[Main](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/samples/sample4.aspx)]

<span data-ttu-id="7359d-276">GridView 的 CommandField 和 Templatefield</span><span class="sxs-lookup"><span data-stu-id="7359d-276">The GridView's CommandField and TemplateFields</span></span>

[!code-aspx[Main](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/samples/sample5.aspx)]

<span data-ttu-id="7359d-277">此时，仅当单击了 GridView 的 "更新" 按钮并且特定于插入的验证控件仅在单击 DetailsView 的 "插入" 按钮时才会触发特定于编辑的验证控件，解决图13突出显示的问题。</span><span class="sxs-lookup"><span data-stu-id="7359d-277">At this point the edit-specific validation controls fire only when the GridView's Update button is clicked and the insert-specific validation controls fire only when the DetailsView's Insert button is clicked, resolving the problem highlighted by Figure 13.</span></span> <span data-ttu-id="7359d-278">但是，在这种情况下，当输入无效数据时，ValidationSummary 控件将不再显示。</span><span class="sxs-lookup"><span data-stu-id="7359d-278">However, with this change our ValidationSummary control no longer displays when entering invalid data.</span></span> <span data-ttu-id="7359d-279">ValidationSummary 控件还包含 `ValidationGroup` 属性，并且仅在其验证组中显示这些验证控件的摘要信息。</span><span class="sxs-lookup"><span data-stu-id="7359d-279">The ValidationSummary control also contains a `ValidationGroup` property and only shows summary information for those validation controls in its validation group.</span></span> <span data-ttu-id="7359d-280">因此，在此页中需要有两个验证控件，一个用于 `InsertValidationControls` 验证组，另一个用于 `EditValidationControls`。</span><span class="sxs-lookup"><span data-stu-id="7359d-280">Therefore, we need to have two validation controls in this page, one for the `InsertValidationControls` validation group and one for `EditValidationControls`.</span></span>

[!code-aspx[Main](adding-validation-controls-to-the-editing-and-inserting-interfaces-vb/samples/sample6.aspx)]

<span data-ttu-id="7359d-281">完成本教程后，我们的教程已完成！</span><span class="sxs-lookup"><span data-stu-id="7359d-281">With this addition our tutorial is complete!</span></span>

## <a name="summary"></a><span data-ttu-id="7359d-282">摘要</span><span class="sxs-lookup"><span data-stu-id="7359d-282">Summary</span></span>

<span data-ttu-id="7359d-283">尽管 BoundFields 可以提供插入和编辑接口，但接口不可自定义。</span><span class="sxs-lookup"><span data-stu-id="7359d-283">While BoundFields can provide both an inserting and editing interface, the interface is not customizable.</span></span> <span data-ttu-id="7359d-284">通常，我们想要向编辑和插入界面添加验证控件，以确保用户以合法格式输入所需的输入。</span><span class="sxs-lookup"><span data-stu-id="7359d-284">Commonly, we want to add validation controls to the editing and inserting interface to ensure that the user enters required inputs in a legal format.</span></span> <span data-ttu-id="7359d-285">若要实现此目的，必须将 BoundFields 转换为 Templatefield，并将验证控件添加到相应的模板。</span><span class="sxs-lookup"><span data-stu-id="7359d-285">To accomplish this we must convert the BoundFields into TemplateFields and add the validation controls to the appropriate template(s).</span></span> <span data-ttu-id="7359d-286">在本教程中，我们扩展了*检查与插入、更新和删除教程相关的事件*的示例，同时向 DetailsView 的插入界面和 GridView 的编辑界面添加验证控件。</span><span class="sxs-lookup"><span data-stu-id="7359d-286">In this tutorial we extended the example from the *Examining the Events Associated with Inserting, Updating, and Deleting* tutorial, adding validation controls to both the DetailsView's inserting interface and the GridView's editing interface.</span></span> <span data-ttu-id="7359d-287">此外，我们还了解了如何使用 ValidationSummary 控件显示摘要验证信息，以及如何将页面上的验证控件分为不同的验证组。</span><span class="sxs-lookup"><span data-stu-id="7359d-287">Moreover, we saw how to display summary validation information using the ValidationSummary control and how to partition the validation controls on the page into distinct validation groups.</span></span>

<span data-ttu-id="7359d-288">正如我们在本教程中看到的那样，Templatefield 允许对编辑和插入界面进行扩展，以包括验证控件。</span><span class="sxs-lookup"><span data-stu-id="7359d-288">As we saw in this tutorial, TemplateFields allow the editing and inserting interfaces to be augmented to include validation controls.</span></span> <span data-ttu-id="7359d-289">还可以对 Templatefield 进行扩展以包含其他输入 Web 控件，使文本框替换为更适合的 Web 控件。</span><span class="sxs-lookup"><span data-stu-id="7359d-289">TemplateFields can also be extended to include additional input Web controls, enabling the TextBox to be replaced by a more suitable Web control.</span></span> <span data-ttu-id="7359d-290">在下一教程中，我们将了解如何使用数据绑定 DropDownList 控件替换 TextBox 控件，这是编辑外键（如 `Products` 表中的 `CategoryID` 或 `SupplierID`）的理想选择。</span><span class="sxs-lookup"><span data-stu-id="7359d-290">In our next tutorial we'll see how to replace the TextBox control with a data-bound DropDownList control, which is ideal when editing a foreign key (such as `CategoryID` or `SupplierID` in the `Products` table).</span></span>

<span data-ttu-id="7359d-291">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="7359d-291">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="7359d-292">关于作者</span><span class="sxs-lookup"><span data-stu-id="7359d-292">About the Author</span></span>

<span data-ttu-id="7359d-293">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，创始人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已在使用 Microsoft Web 技术，自1998开始。</span><span class="sxs-lookup"><span data-stu-id="7359d-293">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="7359d-294">Scott 的工作方式是独立的顾问、培训师和撰稿人。</span><span class="sxs-lookup"><span data-stu-id="7359d-294">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="7359d-295">他的最新书籍是，[*在24小时内，sam ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="7359d-295">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="7359d-296">可以[mitchell@4GuysFromRolla.com访问。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="7359d-296">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="7359d-297">或通过他的博客，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="7359d-297">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="7359d-298">特别感谢</span><span class="sxs-lookup"><span data-stu-id="7359d-298">Special Thanks To</span></span>

<span data-ttu-id="7359d-299">此教程系列由许多有用的审阅者查看。</span><span class="sxs-lookup"><span data-stu-id="7359d-299">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="7359d-300">本教程的领导评审者是 Liz Shulok 和 Zack。</span><span class="sxs-lookup"><span data-stu-id="7359d-300">Lead reviewers for this tutorial were Liz Shulok and Zack Jones.</span></span> <span data-ttu-id="7359d-301">想要查看我即将发布的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="7359d-301">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="7359d-302">如果是这样，请在mitchell@4GuysFromRolla.com放置一行[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="7359d-302">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="7359d-303">[上一页](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md)
> [下一页](customizing-the-data-modification-interface-vb.md)</span><span class="sxs-lookup"><span data-stu-id="7359d-303">[Previous](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md)
[Next](customizing-the-data-modification-interface-vb.md)</span></span>
