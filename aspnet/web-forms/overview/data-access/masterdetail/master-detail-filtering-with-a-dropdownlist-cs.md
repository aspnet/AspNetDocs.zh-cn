---
uid: web-forms/overview/data-access/masterdetail/master-detail-filtering-with-a-dropdownlist-cs
title: 使用 DropDownList （C#）进行主/详细信息筛选 |Microsoft Docs
author: rick-anderson
description: 在本教程中，我们将了解如何在 DropDownList 控件中显示主记录，并了解 GridView 中选定列表项的详细信息。
ms.author: riande
ms.date: 03/31/2010
ms.assetid: 53e659cc-eefb-40c1-a1dc-559481c99443
msc.legacyurl: /web-forms/overview/data-access/masterdetail/master-detail-filtering-with-a-dropdownlist-cs
msc.type: authoredcontent
ms.openlocfilehash: 3ec549f9da7a2b3a021e77827f0039e6ae60b5c5
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/06/2020
ms.locfileid: "78424568"
---
# <a name="masterdetail-filtering-with-a-dropdownlist-c"></a><span data-ttu-id="14bef-103">使用一个 DropDownList 实现母版/详细信息筛选 (C#)</span><span class="sxs-lookup"><span data-stu-id="14bef-103">Master/Detail Filtering With a DropDownList (C#)</span></span>

<span data-ttu-id="14bef-104">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="14bef-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="14bef-105">[下载示例应用](https://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_7_CS.exe)或[下载 PDF](master-detail-filtering-with-a-dropdownlist-cs/_static/datatutorial07cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="14bef-105">[Download Sample App](https://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_7_CS.exe) or [Download PDF](master-detail-filtering-with-a-dropdownlist-cs/_static/datatutorial07cs1.pdf)</span></span>

> <span data-ttu-id="14bef-106">在本教程中，我们将了解如何在 DropDownList 控件中显示主记录，并了解 GridView 中选定列表项的详细信息。</span><span class="sxs-lookup"><span data-stu-id="14bef-106">In this tutorial we'll see how to display the master records in a DropDownList control and the details of the selected list item in a GridView.</span></span>

## <a name="introduction"></a><span data-ttu-id="14bef-107">简介</span><span class="sxs-lookup"><span data-stu-id="14bef-107">Introduction</span></span>

<span data-ttu-id="14bef-108">常见的报表类型为 "*主/详细信息报表*"，其中报表从显示一组 "主" 记录开始。</span><span class="sxs-lookup"><span data-stu-id="14bef-108">A common type of report is the *master/detail report*, in which the report begins by showing some set of "master" records.</span></span> <span data-ttu-id="14bef-109">然后，用户可以向下钻取到其中一个主记录，从而查看该主记录的 "详细信息"。</span><span class="sxs-lookup"><span data-stu-id="14bef-109">The user can then drill down into one of the master records, thereby viewing that master record's "details."</span></span> <span data-ttu-id="14bef-110">主/详细信息报表是直观显示一对多关系的理想选择，例如显示所有类别的报表，然后允许用户选择特定类别并显示其关联的产品。</span><span class="sxs-lookup"><span data-stu-id="14bef-110">Master/detail reports are an ideal choice for visualizing one-to-many relationships, such as a report showing all of the categories and then allowing a user to select a particular category and display its associated products.</span></span> <span data-ttu-id="14bef-111">此外，主/详细信息报表适用于显示特别 "宽" 表（包含大量列）的详细信息。</span><span class="sxs-lookup"><span data-stu-id="14bef-111">Additionally, master/detail reports are useful for displaying detailed information from particularly "wide" tables (ones that have a lot of columns).</span></span> <span data-ttu-id="14bef-112">例如，主/详细信息报表的 "主" 级别可能只显示数据库中产品的产品名和单价，并向下钻取到特定产品会显示其他产品字段（类别、供应商、每个单位的数量，等等）。</span><span class="sxs-lookup"><span data-stu-id="14bef-112">For example, the "master" level of a master/detail report might show just the product name and unit price of the products in the database, and drilling down into a particular product would show the additional product fields (category, supplier, quantity per unit, and so on).</span></span>

<span data-ttu-id="14bef-113">可以通过多种方式来实现主/详细信息报表。</span><span class="sxs-lookup"><span data-stu-id="14bef-113">There are many ways with which a master/detail report can be implemented.</span></span> <span data-ttu-id="14bef-114">在本教程中，我们将介绍几个大纲/详细信息报表。</span><span class="sxs-lookup"><span data-stu-id="14bef-114">Over this and the next three tutorials we'll look at a variety of master/detail reports.</span></span> <span data-ttu-id="14bef-115">在本教程中，我们将了解如何在[DropDownList 控件](https://msdn.microsoft.com/library/dtx91y0z.aspx)中显示主记录，并了解 GridView 中选定列表项的详细信息。</span><span class="sxs-lookup"><span data-stu-id="14bef-115">In this tutorial we'll see how to display the master records in a [DropDownList control](https://msdn.microsoft.com/library/dtx91y0z.aspx) and the details of the selected list item in a GridView.</span></span> <span data-ttu-id="14bef-116">具体而言，本教程的大纲/详细信息报表将列出类别和产品信息。</span><span class="sxs-lookup"><span data-stu-id="14bef-116">In particular, this tutorial's master/detail report will list category and product information.</span></span>

## <a name="step-1-displaying-the-categories-in-a-dropdownlist"></a><span data-ttu-id="14bef-117">步骤1：在 DropDownList 中显示类别</span><span class="sxs-lookup"><span data-stu-id="14bef-117">Step 1: Displaying the Categories in a DropDownList</span></span>

<span data-ttu-id="14bef-118">我们的主/详细信息报表将列出 DropDownList 中的类别，其中选定列表项的产品在 GridView 的页面中向下显示。</span><span class="sxs-lookup"><span data-stu-id="14bef-118">Our master/detail report will list the categories in a DropDownList, with the selected list item's products displayed further down in the page in a GridView.</span></span> <span data-ttu-id="14bef-119">接下来，第一个任务是在 DropDownList 中显示类别。</span><span class="sxs-lookup"><span data-stu-id="14bef-119">The first task ahead of us, then, is to have the categories displayed in a DropDownList.</span></span> <span data-ttu-id="14bef-120">打开 `Filtering` 文件夹中的 "`FilterByDropDownList.aspx`" 页，将 "DropDownList" 从 "工具箱" 拖到页面的设计器上，并将其 `ID` 属性设置为 "`Categories`"。</span><span class="sxs-lookup"><span data-stu-id="14bef-120">Open the `FilterByDropDownList.aspx` page in the `Filtering` folder, drag on a DropDownList from the Toolbox onto the page's designer, and set its `ID` property to `Categories`.</span></span> <span data-ttu-id="14bef-121">接下来，单击 DropDownList 的智能标记中的 "选择数据源" 链接。</span><span class="sxs-lookup"><span data-stu-id="14bef-121">Next, click on the Choose Data Source link from the DropDownList's smart tag.</span></span> <span data-ttu-id="14bef-122">这将显示 "数据源配置向导"。</span><span class="sxs-lookup"><span data-stu-id="14bef-122">This will display the Data Source Configuration wizard.</span></span>

<span data-ttu-id="14bef-123">[![指定 DropDownList 的数据源](master-detail-filtering-with-a-dropdownlist-cs/_static/image2.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="14bef-123">[![Specify the DropDownList's Data Source](master-detail-filtering-with-a-dropdownlist-cs/_static/image2.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image1.png)</span></span>

<span data-ttu-id="14bef-124">**图 1**：指定 DropDownList 的数据源（[单击查看完全大小的图像](master-detail-filtering-with-a-dropdownlist-cs/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="14bef-124">**Figure 1**: Specify the DropDownList's Data Source ([Click to view full-size image](master-detail-filtering-with-a-dropdownlist-cs/_static/image3.png))</span></span>

<span data-ttu-id="14bef-125">选择添加一个名为 `CategoriesDataSource` 的新 ObjectDataSource，用于调用 `CategoriesBLL` 类的 `GetCategories()` 方法。</span><span class="sxs-lookup"><span data-stu-id="14bef-125">Choose to add a new ObjectDataSource named `CategoriesDataSource` that invokes the `CategoriesBLL` class's `GetCategories()` method.</span></span>

<span data-ttu-id="14bef-126">[![添加名为 CategoriesDataSource 的新 ObjectDataSource](master-detail-filtering-with-a-dropdownlist-cs/_static/image5.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="14bef-126">[![Add a New ObjectDataSource Named CategoriesDataSource](master-detail-filtering-with-a-dropdownlist-cs/_static/image5.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image4.png)</span></span>

<span data-ttu-id="14bef-127">**图 2**：添加名为 `CategoriesDataSource` 的新 ObjectDataSource （[单击以查看完全大小的映像](master-detail-filtering-with-a-dropdownlist-cs/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="14bef-127">**Figure 2**: Add a New ObjectDataSource Named `CategoriesDataSource` ([Click to view full-size image](master-detail-filtering-with-a-dropdownlist-cs/_static/image6.png))</span></span>

<span data-ttu-id="14bef-128">[![选择使用 CategoriesBLL 类](master-detail-filtering-with-a-dropdownlist-cs/_static/image8.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="14bef-128">[![Choose to Use the CategoriesBLL Class](master-detail-filtering-with-a-dropdownlist-cs/_static/image8.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image7.png)</span></span>

<span data-ttu-id="14bef-129">**图 3**：选择使用 `CategoriesBLL` 类（[单击以查看完全大小的图像](master-detail-filtering-with-a-dropdownlist-cs/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="14bef-129">**Figure 3**: Choose to Use the `CategoriesBLL` Class ([Click to view full-size image](master-detail-filtering-with-a-dropdownlist-cs/_static/image9.png))</span></span>

<span data-ttu-id="14bef-130">[![将 ObjectDataSource 配置为使用 GetCategories （）方法](master-detail-filtering-with-a-dropdownlist-cs/_static/image11.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="14bef-130">[![Configure the ObjectDataSource to Use the GetCategories() Method](master-detail-filtering-with-a-dropdownlist-cs/_static/image11.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image10.png)</span></span>

<span data-ttu-id="14bef-131">**图 4**：将 ObjectDataSource 配置为使用 `GetCategories()` 方法（[单击查看完全大小的映像](master-detail-filtering-with-a-dropdownlist-cs/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="14bef-131">**Figure 4**: Configure the ObjectDataSource to Use the `GetCategories()` Method ([Click to view full-size image](master-detail-filtering-with-a-dropdownlist-cs/_static/image12.png))</span></span>

<span data-ttu-id="14bef-132">配置 ObjectDataSource 后，我们仍然需要指定应在 DropDownList 中显示的数据源字段，以及哪一字段应与列表项的值相关联。</span><span class="sxs-lookup"><span data-stu-id="14bef-132">After configuring the ObjectDataSource we still need to specify what data source field should be displayed in DropDownList and which one should be associated as the value for the list item.</span></span> <span data-ttu-id="14bef-133">将 `CategoryName` 字段作为显示，并将 `CategoryID` 为每个列表项的值。</span><span class="sxs-lookup"><span data-stu-id="14bef-133">Have the `CategoryName` field as the display and `CategoryID` as the value for each list item.</span></span>

<span data-ttu-id="14bef-134">[![DropDownList 显示 "类别名称" 字段，并使用 "类别 Id" 作为值](master-detail-filtering-with-a-dropdownlist-cs/_static/image14.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="14bef-134">[![Have the DropDownList Display the CategoryName Field and Use CategoryID as the Value](master-detail-filtering-with-a-dropdownlist-cs/_static/image14.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image13.png)</span></span>

<span data-ttu-id="14bef-135">**图 5**：使 DropDownList 显示 "`CategoryName`" 字段并使用 "`CategoryID`" 作为值（[单击以查看完全大小的图像](master-detail-filtering-with-a-dropdownlist-cs/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="14bef-135">**Figure 5**: Have the DropDownList Display the `CategoryName` Field and Use `CategoryID` as the Value ([Click to view full-size image](master-detail-filtering-with-a-dropdownlist-cs/_static/image15.png))</span></span>

<span data-ttu-id="14bef-136">此时，我们有一个 DropDownList 控件，其中填充了 `Categories` 表中的记录（已在大约六秒钟内完成）。</span><span class="sxs-lookup"><span data-stu-id="14bef-136">At this point we have a DropDownList control that's populated with the records from the `Categories` table (all accomplished in about six seconds).</span></span> <span data-ttu-id="14bef-137">图6显示了在浏览器中查看时的进度。</span><span class="sxs-lookup"><span data-stu-id="14bef-137">Figure 6 shows our progress thus far when viewed through a browser.</span></span>

<span data-ttu-id="14bef-138">[![下拉列表中列出了当前类别](master-detail-filtering-with-a-dropdownlist-cs/_static/image17.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="14bef-138">[![A Drop-Down Lists the Current Categories](master-detail-filtering-with-a-dropdownlist-cs/_static/image17.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image16.png)</span></span>

<span data-ttu-id="14bef-139">**图 6**：下拉列表列出了当前类别（[单击以查看完全大小的图像](master-detail-filtering-with-a-dropdownlist-cs/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="14bef-139">**Figure 6**: A Drop-Down Lists the Current Categories ([Click to view full-size image](master-detail-filtering-with-a-dropdownlist-cs/_static/image18.png))</span></span>

## <a name="step-2-adding-the-products-gridview"></a><span data-ttu-id="14bef-140">步骤2：添加产品 GridView</span><span class="sxs-lookup"><span data-stu-id="14bef-140">Step 2: Adding the Products GridView</span></span>

<span data-ttu-id="14bef-141">主/详细信息报表中的最后一步是列出与所选类别关联的产品。</span><span class="sxs-lookup"><span data-stu-id="14bef-141">That last step in our master/detail report is to list the products associated with the selected category.</span></span> <span data-ttu-id="14bef-142">若要实现此目的，请向页面添加一个 GridView，并创建名为 `productsDataSource`的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="14bef-142">To accomplish this, add a GridView to the page and create a new ObjectDataSource named `productsDataSource`.</span></span> <span data-ttu-id="14bef-143">让 `productsDataSource` 控件从 `ProductsBLL` 类的 `GetProductsByCategoryID(categoryID)` 方法中剔除其数据。</span><span class="sxs-lookup"><span data-stu-id="14bef-143">Have the `productsDataSource` control cull its data from the `ProductsBLL` class's `GetProductsByCategoryID(categoryID)` method.</span></span>

<span data-ttu-id="14bef-144">[![选择 GetProductsByCategoryID （类别 Id）方法](master-detail-filtering-with-a-dropdownlist-cs/_static/image20.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="14bef-144">[![Select the GetProductsByCategoryID(categoryID) Method](master-detail-filtering-with-a-dropdownlist-cs/_static/image20.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image19.png)</span></span>

<span data-ttu-id="14bef-145">**图 7**：选择 `GetProductsByCategoryID(categoryID)` 方法（[单击以查看完全大小的图像](master-detail-filtering-with-a-dropdownlist-cs/_static/image21.png)）</span><span class="sxs-lookup"><span data-stu-id="14bef-145">**Figure 7**: Select the `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](master-detail-filtering-with-a-dropdownlist-cs/_static/image21.png))</span></span>

<span data-ttu-id="14bef-146">选择此方法之后，ObjectDataSource 向导会提示我们输入方法的 *`categoryID`* 参数的值。</span><span class="sxs-lookup"><span data-stu-id="14bef-146">After choosing this method, the ObjectDataSource wizard prompts us for the value for the method's *`categoryID`* parameter.</span></span> <span data-ttu-id="14bef-147">若要使用所选 `categories` DropDownList 项的值，请将参数源设置为 Control，并将 ControlID 设置为 `Categories`。</span><span class="sxs-lookup"><span data-stu-id="14bef-147">To use the value of the selected `categories` DropDownList item set the Parameter source to Control and the ControlID to `Categories`.</span></span>

<span data-ttu-id="14bef-148">[![将 "类别 Id" 参数设置为 "类别 DropDownList" 的值。](master-detail-filtering-with-a-dropdownlist-cs/_static/image23.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="14bef-148">[![Set the categoryID Parameter to the Value of the Categories DropDownList](master-detail-filtering-with-a-dropdownlist-cs/_static/image23.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image22.png)</span></span>

<span data-ttu-id="14bef-149">**图 8**：将 *`categoryID`* 参数设置为 `Categories` DropDownList 的值（[单击以查看完全大小的图像](master-detail-filtering-with-a-dropdownlist-cs/_static/image24.png)）</span><span class="sxs-lookup"><span data-stu-id="14bef-149">**Figure 8**: Set the *`categoryID`* Parameter to the Value of the `Categories` DropDownList ([Click to view full-size image](master-detail-filtering-with-a-dropdownlist-cs/_static/image24.png))</span></span>

<span data-ttu-id="14bef-150">请花点时间查看浏览器中的进度。</span><span class="sxs-lookup"><span data-stu-id="14bef-150">Take a moment to check out our progress in a browser.</span></span> <span data-ttu-id="14bef-151">首次访问页面时，将显示属于所选类别（饮料）的产品（如图9所示），但更改 DropDownList 不会更新数据。</span><span class="sxs-lookup"><span data-stu-id="14bef-151">When first visiting the page, those products belong to the selected category (Beverages) are displayed (as shown in Figure 9), but changing the DropDownList doesn't update the data.</span></span> <span data-ttu-id="14bef-152">这是因为必须发生回发以便 GridView 更新。</span><span class="sxs-lookup"><span data-stu-id="14bef-152">This is because a postback must occur for the GridView to update.</span></span> <span data-ttu-id="14bef-153">若要实现此目的，我们有两个选项（这两者都不需要编写任何代码）：</span><span class="sxs-lookup"><span data-stu-id="14bef-153">To accomplish this we have two options (neither of which requires writing any code):</span></span>

- <span data-ttu-id="14bef-154">**将 DropDownList 的**[AutoPostBack 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.listcontrol.autopostback%28VS.80%29.aspx)设置**为 True。**</span><span class="sxs-lookup"><span data-stu-id="14bef-154">**Set the categories DropDownList's**[AutoPostBack property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.listcontrol.autopostback%28VS.80%29.aspx)**to True.**</span></span> <span data-ttu-id="14bef-155">（可以通过选中 DropDownList 的智能标记中的 Enable AutoPostBack 选项来实现此目的。）这会在用户更改 DropDownList 的选定项时触发回发。</span><span class="sxs-lookup"><span data-stu-id="14bef-155">(You can accomplish this by checking the Enable AutoPostBack option in the DropDownList's smart tag.) This will trigger a postback whenever the DropDownList's selected item is changed by the user.</span></span> <span data-ttu-id="14bef-156">因此，当用户从 DropDownList 中选择一个新类别时，回发将不幸，并将使用新选定类别的产品更新 GridView。</span><span class="sxs-lookup"><span data-stu-id="14bef-156">Therefore, when the user selects a new category from the DropDownList a postback will ensue and the GridView will be updated with the products for the newly selected category.</span></span> <span data-ttu-id="14bef-157">（这是我在本教程中使用的方法。）</span><span class="sxs-lookup"><span data-stu-id="14bef-157">(This is the approach I've used in this tutorial.)</span></span>
- <span data-ttu-id="14bef-158">**将按钮 Web 控件添加到 DropDownList 旁边。**</span><span class="sxs-lookup"><span data-stu-id="14bef-158">**Add a Button Web control next to the DropDownList.**</span></span> <span data-ttu-id="14bef-159">将其 `Text` 属性设置为 Refresh 或类似的内容。</span><span class="sxs-lookup"><span data-stu-id="14bef-159">Set its `Text` property to Refresh or something similar.</span></span> <span data-ttu-id="14bef-160">使用此方法时，用户需要选择一个新类别，然后单击 "" 按钮。</span><span class="sxs-lookup"><span data-stu-id="14bef-160">With this approach, the user will need to select a new category and then click the Button.</span></span> <span data-ttu-id="14bef-161">单击该按钮将导致回发并更新 GridView 以列出所选类别的产品。</span><span class="sxs-lookup"><span data-stu-id="14bef-161">Clicking the Button will cause a postback and update the GridView to list those products of the selected category.</span></span>

<span data-ttu-id="14bef-162">图9和10说明了操作中的主/详细信息报表。</span><span class="sxs-lookup"><span data-stu-id="14bef-162">Figures 9 and 10 illustrate the master/detail report in action.</span></span>

<span data-ttu-id="14bef-163">[首次访问页面时 ![，将显示饮料产品](master-detail-filtering-with-a-dropdownlist-cs/_static/image26.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="14bef-163">[![When First Visiting the Page, the Beverage Products are Displayed](master-detail-filtering-with-a-dropdownlist-cs/_static/image26.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image25.png)</span></span>

<span data-ttu-id="14bef-164">**图 9**：首次访问页面时，会显示饮料产品（[单击查看全尺寸图像](master-detail-filtering-with-a-dropdownlist-cs/_static/image27.png)）</span><span class="sxs-lookup"><span data-stu-id="14bef-164">**Figure 9**: When First Visiting the Page, the Beverage Products are Displayed ([Click to view full-size image](master-detail-filtering-with-a-dropdownlist-cs/_static/image27.png))</span></span>

<span data-ttu-id="14bef-165">[![选择新产品（生成）会自动导致回发，并更新 GridView](master-detail-filtering-with-a-dropdownlist-cs/_static/image29.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="14bef-165">[![Selecting a New Product (Produce) Automatically Causes a PostBack, Updating the GridView](master-detail-filtering-with-a-dropdownlist-cs/_static/image29.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image28.png)</span></span>

<span data-ttu-id="14bef-166">**图 10**：选择新产品（"生成"）会自动导致回发，并更新 GridView （[单击查看完全大小的图像](master-detail-filtering-with-a-dropdownlist-cs/_static/image30.png)）</span><span class="sxs-lookup"><span data-stu-id="14bef-166">**Figure 10**: Selecting a New Product (Produce) Automatically Causes a PostBack, Updating the GridView ([Click to view full-size image](master-detail-filtering-with-a-dropdownlist-cs/_static/image30.png))</span></span>

## <a name="adding-a----choose-a-category----list-item"></a><span data-ttu-id="14bef-167">添加 "--选择类别--" 列表项</span><span class="sxs-lookup"><span data-stu-id="14bef-167">Adding a "-- Choose a Category --" List Item</span></span>

<span data-ttu-id="14bef-168">第一次访问 "`FilterByDropDownList.aspx`" 页面时，默认情况下会选择类别 DropDownList 的第一个列表项（饮料），其中显示 GridView 中的饮料产品。</span><span class="sxs-lookup"><span data-stu-id="14bef-168">When first visiting the `FilterByDropDownList.aspx` page the categories DropDownList's first list item (Beverages) is selected by default, showing the beverage products in the GridView.</span></span> <span data-ttu-id="14bef-169">我们可能不想显示第一个类别的产品，而是选择一个 DropDownList 项，其中显示了类似于 "--选择一个类别--" 的内容。</span><span class="sxs-lookup"><span data-stu-id="14bef-169">Rather than showing the first category's products, we may want to instead have a DropDownList item selected that says something like, "-- Choose a Category --".</span></span>

<span data-ttu-id="14bef-170">若要向 DropDownList 添加新的列表项，请切换到属性窗口并单击 `Items` 属性中的省略号。</span><span class="sxs-lookup"><span data-stu-id="14bef-170">To add a new list item to the DropDownList, go to the Properties window and click on the ellipses in the `Items` property.</span></span> <span data-ttu-id="14bef-171">添加一个新列表项，其中包含 `Text` "--选择类别--" 和 `Value` `-1`。</span><span class="sxs-lookup"><span data-stu-id="14bef-171">Add a new list item with the `Text` "-- Choose a Category --" and the `Value` `-1`.</span></span>

<span data-ttu-id="14bef-172">[![添加--选择类别--列表项](master-detail-filtering-with-a-dropdownlist-cs/_static/image32.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="14bef-172">[![Add a -- Choose a Category -- List Item](master-detail-filtering-with-a-dropdownlist-cs/_static/image32.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image31.png)</span></span>

<span data-ttu-id="14bef-173">**图 11**：添加--选择类别--列表项（[单击以查看完全大小的图像](master-detail-filtering-with-a-dropdownlist-cs/_static/image33.png)）</span><span class="sxs-lookup"><span data-stu-id="14bef-173">**Figure 11**: Add a -- Choose a Category -- List Item ([Click to view full-size image](master-detail-filtering-with-a-dropdownlist-cs/_static/image33.png))</span></span>

<span data-ttu-id="14bef-174">或者，你可以通过将以下标记添加到 DropDownList 来添加列表项：</span><span class="sxs-lookup"><span data-stu-id="14bef-174">Alternatively, you can add the list item by adding the following markup to the DropDownList:</span></span>

[!code-aspx[Main](master-detail-filtering-with-a-dropdownlist-cs/samples/sample1.aspx)]

<span data-ttu-id="14bef-175">此外，我们需要将 DropDownList 控件的 `AppendDataBoundItems` 设置为 True，因为当类别从 ObjectDataSource 绑定到 DropDownList 时，如果 `AppendDataBoundItems` 不为 True，则会覆盖所有手动添加的列表项。</span><span class="sxs-lookup"><span data-stu-id="14bef-175">Additionally, we need to set the DropDownList control's `AppendDataBoundItems` to True because when the categories are bound to the DropDownList from the ObjectDataSource they'll overwrite any manually-added list items if `AppendDataBoundItems` isn't True.</span></span>

![将 AppendDataBoundItems 属性设置为 True](master-detail-filtering-with-a-dropdownlist-cs/_static/image34.png)

<span data-ttu-id="14bef-177">**图 12**：将 `AppendDataBoundItems` 属性设置为 True</span><span class="sxs-lookup"><span data-stu-id="14bef-177">**Figure 12**: Set the `AppendDataBoundItems` Property to True</span></span>

<span data-ttu-id="14bef-178">完成这些更改后，在首次访问该页面时，将选择 "--选择类别--" 选项，并且不会显示任何产品。</span><span class="sxs-lookup"><span data-stu-id="14bef-178">After these changes, when first visiting the page the "-- Choose a Category --" option is selected and no products are displayed.</span></span>

<span data-ttu-id="14bef-179">[初始页面加载上的 ![未显示任何产品](master-detail-filtering-with-a-dropdownlist-cs/_static/image36.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="14bef-179">[![On the Initial Page Load No Products are Displayed](master-detail-filtering-with-a-dropdownlist-cs/_static/image36.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image35.png)</span></span>

<span data-ttu-id="14bef-180">**图 13**：初始页面加载时未显示任何产品（[单击以查看完全大小的图像](master-detail-filtering-with-a-dropdownlist-cs/_static/image37.png)）</span><span class="sxs-lookup"><span data-stu-id="14bef-180">**Figure 13**: On the Initial Page Load No Products are Displayed ([Click to view full-size image](master-detail-filtering-with-a-dropdownlist-cs/_static/image37.png))</span></span>

<span data-ttu-id="14bef-181">由于选择了 "--选择类别--" 列表项，因此不会显示任何产品，因为其值是 `-1` 的，并且数据库中没有 `-1``CategoryID` 的产品。</span><span class="sxs-lookup"><span data-stu-id="14bef-181">The reason no products are displayed when because the "-- Choose a Category --" list item is selected is because its value is `-1` and there are no products in the database with a `CategoryID` of `-1`.</span></span> <span data-ttu-id="14bef-182">如果这是你想要的行为，此时已经完成了！</span><span class="sxs-lookup"><span data-stu-id="14bef-182">If this is the behavior you want then you're done at this point!</span></span> <span data-ttu-id="14bef-183">但是，如果您想要在 "--选择类别--" 列表项处于选中状态时显示*所有*类别，则返回到 `ProductsBLL` 类并自定义 `GetProductsByCategoryID(categoryID)` 方法，以便在 *`categoryID`* 参数中传递的值小于零时调用 `GetProducts()` 方法：</span><span class="sxs-lookup"><span data-stu-id="14bef-183">If, however, you want to display *all* of the categories when the "-- Choose a Category --" list item is selected, return to the `ProductsBLL` class and customize the `GetProductsByCategoryID(categoryID)` method so that it invokes the `GetProducts()` method if the passed in *`categoryID`* parameter is less than zero:</span></span>

[!code-csharp[Main](master-detail-filtering-with-a-dropdownlist-cs/samples/sample2.cs)]

<span data-ttu-id="14bef-184">此处使用的方法类似于我们用于在[声明性参数](../basic-reporting/declarative-parameters-cs.md)教程中显示所有供应商的方法，但在本示例中，我们使用值 `-1` 来指示应检索所有记录，而不是 `null`。</span><span class="sxs-lookup"><span data-stu-id="14bef-184">The technique used here is similar to the approach we used to display all suppliers back in the [Declarative Parameters](../basic-reporting/declarative-parameters-cs.md) tutorial, although for this example we're using a value of `-1` to indicate that all records should be retrieved as opposed to `null`.</span></span> <span data-ttu-id="14bef-185">这是因为 `GetProductsByCategoryID(categoryID)` 方法的 *`categoryID`* 参数需要使用传入的整数值，而在声明性参数教程中，我们传入了字符串输入参数。</span><span class="sxs-lookup"><span data-stu-id="14bef-185">This is because the *`categoryID`* parameter of the `GetProductsByCategoryID(categoryID)` method expects as integer value passed in, whereas in the Declarative Parameters tutorial we were passing in a string input parameter.</span></span>

<span data-ttu-id="14bef-186">图14显示了选择 "--选择类别--" 选项时的 `FilterByDropDownList.aspx` 屏幕截图。</span><span class="sxs-lookup"><span data-stu-id="14bef-186">Figure 14 shows a screen shot of `FilterByDropDownList.aspx` when the "-- Choose a Category --" option is selected.</span></span> <span data-ttu-id="14bef-187">此时，默认情况下会显示所有产品，用户可以通过选择特定类别来缩小显示范围。</span><span class="sxs-lookup"><span data-stu-id="14bef-187">Here, all of the products are displayed by default, and the user can narrow the display by choosing a specific category.</span></span>

<span data-ttu-id="14bef-188">[默认情况下，![所有产品都已列出](master-detail-filtering-with-a-dropdownlist-cs/_static/image39.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image38.png)</span><span class="sxs-lookup"><span data-stu-id="14bef-188">[![All of the Products are Now Listed By Default](master-detail-filtering-with-a-dropdownlist-cs/_static/image39.png)](master-detail-filtering-with-a-dropdownlist-cs/_static/image38.png)</span></span>

<span data-ttu-id="14bef-189">**图 14**：默认情况下，所有产品均已列出（[单击以查看完全大小的图像](master-detail-filtering-with-a-dropdownlist-cs/_static/image40.png)）</span><span class="sxs-lookup"><span data-stu-id="14bef-189">**Figure 14**: All of the Products are Now Listed By Default ([Click to view full-size image](master-detail-filtering-with-a-dropdownlist-cs/_static/image40.png))</span></span>

## <a name="summary"></a><span data-ttu-id="14bef-190">摘要</span><span class="sxs-lookup"><span data-stu-id="14bef-190">Summary</span></span>

<span data-ttu-id="14bef-191">显示分层相关的数据时，通常可以使用主/详细信息报表来显示数据，用户可以从层次结构顶部开始浏览数据，并向下钻取详细信息。</span><span class="sxs-lookup"><span data-stu-id="14bef-191">When displaying hierarchically-related data, it often helps to present the data using master/detail reports, from which the user can start perusing the data from the top of the hierarchy and drill down into details.</span></span> <span data-ttu-id="14bef-192">在本教程中，我们将介绍如何生成一个简单的大纲/详细信息报告，其中显示了所选类别的产品。</span><span class="sxs-lookup"><span data-stu-id="14bef-192">In this tutorial we examined building a simple master/detail report showing a selected category's products.</span></span> <span data-ttu-id="14bef-193">为此，可以使用 DropDownList 作为类别列表，并将 GridView 用于属于所选类别的产品。</span><span class="sxs-lookup"><span data-stu-id="14bef-193">This was accomplished by using a DropDownList for the list of categories and a GridView for the products belonging to the selected category.</span></span>

<span data-ttu-id="14bef-194">在[下一教程](master-detail-filtering-with-two-dropdownlists-cs.md)中，我们将使用两个 DropDownLists 进一步 DropDownList 接口。</span><span class="sxs-lookup"><span data-stu-id="14bef-194">In the [next tutorial](master-detail-filtering-with-two-dropdownlists-cs.md) we'll take the DropDownList interface one step further, using two DropDownLists.</span></span>

<span data-ttu-id="14bef-195">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="14bef-195">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="14bef-196">关于作者</span><span class="sxs-lookup"><span data-stu-id="14bef-196">About the Author</span></span>

<span data-ttu-id="14bef-197">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，创始人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已在使用 Microsoft Web 技术，自1998开始。</span><span class="sxs-lookup"><span data-stu-id="14bef-197">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="14bef-198">Scott 的工作方式是独立的顾问、培训师和撰稿人。</span><span class="sxs-lookup"><span data-stu-id="14bef-198">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="14bef-199">他的最新书籍是，[*在24小时内，sam ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="14bef-199">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="14bef-200">可以[mitchell@4GuysFromRolla.com访问。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="14bef-200">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="14bef-201">或通过他的博客，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="14bef-201">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="14bef-202">下一部分</span><span class="sxs-lookup"><span data-stu-id="14bef-202">Next</span></span>](master-detail-filtering-with-two-dropdownlists-cs.md)
