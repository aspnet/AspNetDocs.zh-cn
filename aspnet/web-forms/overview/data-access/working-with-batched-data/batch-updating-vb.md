---
uid: web-forms/overview/data-access/working-with-batched-data/batch-updating-vb
title: 批量更新（VB） |Microsoft Docs
author: rick-anderson
description: 了解如何在一个操作中更新多个数据库记录。 在用户界面层，我们构建了一个 GridView，其中每行都是可编辑的。 在 "数据 ..."
ms.author: riande
ms.date: 06/26/2007
ms.assetid: d191a204-d7ea-458d-b81c-0b9049ecb55f
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-updating-vb
msc.type: authoredcontent
ms.openlocfilehash: f0bb83b17585876dd6d28a5893a223cce15da31d
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/28/2019
ms.locfileid: "74591239"
---
# <a name="batch-updating-vb"></a><span data-ttu-id="b0d11-105">批量更新 (VB)</span><span class="sxs-lookup"><span data-stu-id="b0d11-105">Batch Updating (VB)</span></span>

<span data-ttu-id="b0d11-106">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="b0d11-106">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="b0d11-107">[下载代码](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_64_VB.zip)或[下载 PDF](batch-updating-vb/_static/datatutorial64vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="b0d11-107">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_64_VB.zip) or [Download PDF](batch-updating-vb/_static/datatutorial64vb1.pdf)</span></span>

> <span data-ttu-id="b0d11-108">了解如何在一个操作中更新多个数据库记录。</span><span class="sxs-lookup"><span data-stu-id="b0d11-108">Learn how to update multiple database records in a single operation.</span></span> <span data-ttu-id="b0d11-109">在用户界面层，我们构建了一个 GridView，其中每行都是可编辑的。</span><span class="sxs-lookup"><span data-stu-id="b0d11-109">In the User Interface Layer we build a GridView where each row is editable.</span></span> <span data-ttu-id="b0d11-110">在数据访问层中，我们在事务中包装多个更新操作，以确保所有更新成功或回滚所有更新。</span><span class="sxs-lookup"><span data-stu-id="b0d11-110">In the Data Access Layer we wrap the multiple Update operations within a transaction to ensure that all updates succeed or all updates are rolled back.</span></span>

## <a name="introduction"></a><span data-ttu-id="b0d11-111">简介</span><span class="sxs-lookup"><span data-stu-id="b0d11-111">Introduction</span></span>

<span data-ttu-id="b0d11-112">在[前面的教程](wrapping-database-modifications-within-a-transaction-vb.md)中，我们介绍了如何扩展数据访问层以添加对数据库事务的支持。</span><span class="sxs-lookup"><span data-stu-id="b0d11-112">In the [preceding tutorial](wrapping-database-modifications-within-a-transaction-vb.md) we saw how to extend the Data Access Layer to add support for database transactions.</span></span> <span data-ttu-id="b0d11-113">数据库事务可确保将一系列数据修改语句视为一个原子操作，这可确保所有修改都将失败或全部成功。</span><span class="sxs-lookup"><span data-stu-id="b0d11-113">Database transactions guarantee that a series of data modification statements will be treated as one atomic operation, which ensures that all modifications will fail or all will succeed.</span></span> <span data-ttu-id="b0d11-114">通过这种低级别 DAL 功能，我们可以随时将注意力转换为创建批处理数据修改接口。</span><span class="sxs-lookup"><span data-stu-id="b0d11-114">With this low-level DAL functionality out of the way, we re ready to turn our attention to creating batch data modification interfaces.</span></span>

<span data-ttu-id="b0d11-115">在本教程中，我们将构建一个 GridView，其中每行都是可编辑的（请参阅图1）。</span><span class="sxs-lookup"><span data-stu-id="b0d11-115">In this tutorial we'll build a GridView where each row is editable (see Figure 1).</span></span> <span data-ttu-id="b0d11-116">由于每行都是在其编辑界面中呈现的，因此无需使用 "编辑"、"更新" 和 "取消" 按钮的列。</span><span class="sxs-lookup"><span data-stu-id="b0d11-116">Since each row is rendered in its editing interface, there s no need for a column of Edit, Update, and Cancel buttons.</span></span> <span data-ttu-id="b0d11-117">相反，页面上有两个 "更新产品" 按钮，在单击此按钮时，会枚举 GridView 行并更新数据库。</span><span class="sxs-lookup"><span data-stu-id="b0d11-117">Instead, there are two Update Products buttons on the page that, when clicked, enumerate the GridView rows and update the database.</span></span>

<span data-ttu-id="b0d11-118">[GridView 中的每行都是可编辑的 ![](batch-updating-vb/_static/image1.gif)](batch-updating-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="b0d11-118">[![Each Row in the GridView is Editable](batch-updating-vb/_static/image1.gif)](batch-updating-vb/_static/image1.png)</span></span>

<span data-ttu-id="b0d11-119">**图 1**： GridView 中的每一行都是可编辑的（[单击以查看完全大小的图像](batch-updating-vb/_static/image2.png)）</span><span class="sxs-lookup"><span data-stu-id="b0d11-119">**Figure 1**: Each Row in the GridView is Editable ([Click to view full-size image](batch-updating-vb/_static/image2.png))</span></span>

<span data-ttu-id="b0d11-120">让我们开始吧！</span><span class="sxs-lookup"><span data-stu-id="b0d11-120">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="b0d11-121">在[执行批更新](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md)教程中，我们使用 DataList 控件创建了批处理编辑界面。</span><span class="sxs-lookup"><span data-stu-id="b0d11-121">In the [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md) tutorial we created a batch editing interface using the DataList control.</span></span> <span data-ttu-id="b0d11-122">本教程不同于中的上一个教程，其中使用的是 GridView，批处理更新在事务范围内执行。</span><span class="sxs-lookup"><span data-stu-id="b0d11-122">This tutorial differs from the previous one in that is uses a GridView and the batch update is performed within the scope of a transaction.</span></span> <span data-ttu-id="b0d11-123">完成本教程后，我建议您返回到前面的教程，并将其更新为使用上一教程中添加的与数据库事务相关的功能。</span><span class="sxs-lookup"><span data-stu-id="b0d11-123">After completing this tutorial I encourage you to return to the earlier tutorial and update it to use the database transaction-related functionality added in the preceding tutorial.</span></span>

## <a name="examining-the-steps-for-making-all-gridview-rows-editable"></a><span data-ttu-id="b0d11-124">检查使所有 GridView 行可编辑的步骤</span><span class="sxs-lookup"><span data-stu-id="b0d11-124">Examining the Steps for Making All GridView Rows Editable</span></span>

<span data-ttu-id="b0d11-125">如在[插入、更新和删除数据](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md)教程中所述，GridView 提供了针对每行编辑其基础数据的内置支持。</span><span class="sxs-lookup"><span data-stu-id="b0d11-125">As discussed in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md) tutorial, the GridView offers built-in support for editing its underlying data on a per-row basis.</span></span> <span data-ttu-id="b0d11-126">在内部，GridView 说明哪些行可通过其[`EditIndex` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.editindex(VS.80).aspx)进行编辑。</span><span class="sxs-lookup"><span data-stu-id="b0d11-126">Internally, the GridView notes what row is editable through its [`EditIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.editindex(VS.80).aspx).</span></span> <span data-ttu-id="b0d11-127">当 GridView 绑定到其数据源时，它会检查每一行以查看行的索引是否等于 `EditIndex`的值。</span><span class="sxs-lookup"><span data-stu-id="b0d11-127">As the GridView is being bound to its data source, it checks each row to see if the index of the row equals the value of `EditIndex`.</span></span> <span data-ttu-id="b0d11-128">如果是这样，则使用其编辑界面呈现行字段。</span><span class="sxs-lookup"><span data-stu-id="b0d11-128">If so, that row s fields are rendered using their editing interfaces.</span></span> <span data-ttu-id="b0d11-129">对于 BoundFields，编辑界面是一个文本框，其 `Text` 属性分配有 BoundField s `DataField` 属性指定的数据字段的值。</span><span class="sxs-lookup"><span data-stu-id="b0d11-129">For BoundFields, the editing interface is a TextBox whose `Text` property is assigned the value of the data field specified by the BoundField s `DataField` property.</span></span> <span data-ttu-id="b0d11-130">对于 Templatefield，使用 `EditItemTemplate` 代替 `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="b0d11-130">For TemplateFields, the `EditItemTemplate` is used in place of the `ItemTemplate`.</span></span>

<span data-ttu-id="b0d11-131">请记住，当用户单击 "编辑" 按钮时，编辑工作流将启动。</span><span class="sxs-lookup"><span data-stu-id="b0d11-131">Recall that the editing workflow starts when a user clicks a row s Edit button.</span></span> <span data-ttu-id="b0d11-132">这会导致回发，将 GridView `EditIndex` 属性设置为单击的行的索引，并将数据重新绑定到网格。</span><span class="sxs-lookup"><span data-stu-id="b0d11-132">This causes a postback, sets the GridView s `EditIndex` property to the clicked row s index, and rebinds the data to the grid.</span></span> <span data-ttu-id="b0d11-133">单击 "取消" 按钮时，在回发时，`EditIndex` 设置为 `-1` 值，然后将数据重新绑定到网格。</span><span class="sxs-lookup"><span data-stu-id="b0d11-133">When a row s Cancel button is clicked, on postback the `EditIndex` is set to a value of `-1` before rebinding the data to the grid.</span></span> <span data-ttu-id="b0d11-134">由于 GridView 的行开始索引为零，因此，将 `EditIndex` 设置为 `-1` 会影响在只读模式下显示 GridView。</span><span class="sxs-lookup"><span data-stu-id="b0d11-134">Since the GridView s rows start indexing at zero, setting `EditIndex` to `-1` has the effect of displaying the GridView in read-only mode.</span></span>

<span data-ttu-id="b0d11-135">`EditIndex` 属性适用于每行编辑，但不适用于批量编辑。</span><span class="sxs-lookup"><span data-stu-id="b0d11-135">The `EditIndex` property works well for per-row editing, but is not designed for batch editing.</span></span> <span data-ttu-id="b0d11-136">若要使整个 GridView 可编辑，需要使用其编辑界面呈现每个行。</span><span class="sxs-lookup"><span data-stu-id="b0d11-136">To make the entire GridView editable, we need to have each row render using its editing interface.</span></span> <span data-ttu-id="b0d11-137">实现此目的的最简单方法是创建，其中每个可编辑字段的实现方式均为 TemplateField，并在 `ItemTemplate`中定义其编辑界面。</span><span class="sxs-lookup"><span data-stu-id="b0d11-137">The easiest way to accomplish this is to create where each editable field is implemented as a TemplateField with its editing interface defined in the `ItemTemplate`.</span></span>

<span data-ttu-id="b0d11-138">在接下来的几个步骤中，我们将创建一个完全可编辑的 GridView。</span><span class="sxs-lookup"><span data-stu-id="b0d11-138">Over the next several steps we'll create a completely editable GridView.</span></span> <span data-ttu-id="b0d11-139">在步骤1中，我们首先创建 GridView 及其 ObjectDataSource，并将其 BoundFields 和 CheckBoxField 转换为 Templatefield。</span><span class="sxs-lookup"><span data-stu-id="b0d11-139">In Step 1 we'll start by creating the GridView and its ObjectDataSource and convert its BoundFields and CheckBoxField into TemplateFields.</span></span> <span data-ttu-id="b0d11-140">在步骤2和步骤3中，我们会将编辑界面从 Templatefield `EditItemTemplate` s 移至其 `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="b0d11-140">In Steps 2 and 3 we'll move the editing interfaces from the TemplateFields `EditItemTemplate` s to their `ItemTemplate` s.</span></span>

## <a name="step-1-displaying-product-information"></a><span data-ttu-id="b0d11-141">步骤1：显示产品信息</span><span class="sxs-lookup"><span data-stu-id="b0d11-141">Step 1: Displaying Product Information</span></span>

<span data-ttu-id="b0d11-142">在考虑如何创建可编辑行的 GridView 之前，只需显示产品信息即可开始。</span><span class="sxs-lookup"><span data-stu-id="b0d11-142">Before we worry about creating a GridView where are rows are editable, let s start by simply displaying the product information.</span></span> <span data-ttu-id="b0d11-143">打开 `BatchData` 文件夹中的 "`BatchUpdate.aspx`" 页，并将 GridView 从工具箱拖到设计器上。</span><span class="sxs-lookup"><span data-stu-id="b0d11-143">Open the `BatchUpdate.aspx` page in the `BatchData` folder and drag a GridView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="b0d11-144">将 GridView `ID` 设置为 `ProductsGrid`，并从其智能标记中，选择将其绑定到名为 `ProductsDataSource`的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="b0d11-144">Set the GridView s `ID` to `ProductsGrid` and, from its smart tag, choose to bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="b0d11-145">配置 ObjectDataSource 以便从 `ProductsBLL` 类 `GetProducts` 方法检索其数据。</span><span class="sxs-lookup"><span data-stu-id="b0d11-145">Configure the ObjectDataSource to retrieve its data from the `ProductsBLL` class s `GetProducts` method.</span></span>

<span data-ttu-id="b0d11-146">[![将 ObjectDataSource 配置为使用 ProductsBLL 类](batch-updating-vb/_static/image2.gif)](batch-updating-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="b0d11-146">[![Configure the ObjectDataSource to Use the ProductsBLL Class](batch-updating-vb/_static/image2.gif)](batch-updating-vb/_static/image3.png)</span></span>

<span data-ttu-id="b0d11-147">**图 2**：将 ObjectDataSource 配置为使用 `ProductsBLL` 类（[单击以查看完全大小的映像](batch-updating-vb/_static/image4.png)）</span><span class="sxs-lookup"><span data-stu-id="b0d11-147">**Figure 2**: Configure the ObjectDataSource to Use the `ProductsBLL` Class ([Click to view full-size image](batch-updating-vb/_static/image4.png))</span></span>

<span data-ttu-id="b0d11-148">[![使用 GetProducts 方法检索产品数据](batch-updating-vb/_static/image3.gif)](batch-updating-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="b0d11-148">[![Retrieve the Product Data Using the GetProducts Method](batch-updating-vb/_static/image3.gif)](batch-updating-vb/_static/image5.png)</span></span>

<span data-ttu-id="b0d11-149">**图 3**：使用 `GetProducts` 方法检索产品数据（[单击以查看完全大小的图像](batch-updating-vb/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="b0d11-149">**Figure 3**: Retrieve the Product Data Using the `GetProducts` Method ([Click to view full-size image](batch-updating-vb/_static/image6.png))</span></span>

<span data-ttu-id="b0d11-150">与 GridView 一样，ObjectDataSource 的修改功能旨在使每行工作。</span><span class="sxs-lookup"><span data-stu-id="b0d11-150">Like the GridView, the ObjectDataSource s modification features are designed to work on a per-row basis.</span></span> <span data-ttu-id="b0d11-151">若要更新一组记录，我们需要在 ASP.NET 页 s 代码隐藏类中编写一些代码，以便对数据进行批处理，并将其传递给 BLL。</span><span class="sxs-lookup"><span data-stu-id="b0d11-151">In order to update a set of records, we'll need to write a bit of code in the ASP.NET page s code-behind class that batches the data and passes it to the BLL.</span></span> <span data-ttu-id="b0d11-152">因此，请在 "更新"、"插入" 和 "删除" 选项卡中将下拉列表设置为 "（无）"。</span><span class="sxs-lookup"><span data-stu-id="b0d11-152">Therefore, set the drop-down lists in the ObjectDataSource s UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="b0d11-153">单击“完成”按钮以完成向导。</span><span class="sxs-lookup"><span data-stu-id="b0d11-153">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="b0d11-154">[![在 "更新"、"插入" 和 "删除" 选项卡中将下拉列表设置为 "（无）"](batch-updating-vb/_static/image4.gif)](batch-updating-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="b0d11-154">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-updating-vb/_static/image4.gif)](batch-updating-vb/_static/image7.png)</span></span>

<span data-ttu-id="b0d11-155">**图 4**：将 "更新"、"插入" 和 "删除" 选项卡中的下拉列表设置为 "（无）" （[单击查看完全大小的映像](batch-updating-vb/_static/image8.png)）</span><span class="sxs-lookup"><span data-stu-id="b0d11-155">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-updating-vb/_static/image8.png))</span></span>

<span data-ttu-id="b0d11-156">完成 "配置数据源" 向导后，ObjectDataSource 的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="b0d11-156">After completing the Configure Data Source wizard, the ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](batch-updating-vb/samples/sample1.aspx)]

<span data-ttu-id="b0d11-157">完成 "配置数据源" 向导还会导致 Visual Studio 为 GridView 中的 "产品" 数据字段创建 BoundFields 和一个 CheckBoxField。</span><span class="sxs-lookup"><span data-stu-id="b0d11-157">Completing the Configure Data Source wizard also causes Visual Studio to create BoundFields and a CheckBoxField for the product data fields in the GridView.</span></span> <span data-ttu-id="b0d11-158">对于本教程，让我们只允许用户查看和编辑产品的名称、类别、价格和废止状态。</span><span class="sxs-lookup"><span data-stu-id="b0d11-158">For this tutorial, let s only allow the user to view and edit the product s name, category, price, and discontinued status.</span></span> <span data-ttu-id="b0d11-159">删除除 `ProductName`、`CategoryName`、`UnitPrice`和 `Discontinued` 字段之外的所有字段，并分别将前三个字段的 `HeaderText` 属性重命名为 "产品"、"类别" 和 "价格"。</span><span class="sxs-lookup"><span data-stu-id="b0d11-159">Remove all but the `ProductName`, `CategoryName`, `UnitPrice`, and `Discontinued` fields and rename the `HeaderText` properties of the first three fields to Product, Category, and Price, respectively.</span></span> <span data-ttu-id="b0d11-160">最后，选中 "GridView s 智能" 标记中的 "启用分页并启用排序" 复选框。</span><span class="sxs-lookup"><span data-stu-id="b0d11-160">Lastly, check the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="b0d11-161">此时，GridView 有三个 BoundFields （`ProductName`、`CategoryName`和 `UnitPrice`）和 CheckBoxField （`Discontinued`）。</span><span class="sxs-lookup"><span data-stu-id="b0d11-161">At this point the GridView has three BoundFields (`ProductName`, `CategoryName`, and `UnitPrice`) and a CheckBoxField (`Discontinued`).</span></span> <span data-ttu-id="b0d11-162">需要将这四个字段转换为 Templatefield，然后将编辑界面从 `ItemTemplate``EditItemTemplate` 移动到其。</span><span class="sxs-lookup"><span data-stu-id="b0d11-162">We need to convert these four fields into TemplateFields and then move the editing interface from the TemplateField s `EditItemTemplate` to its `ItemTemplate`.</span></span>

> [!NOTE]
> <span data-ttu-id="b0d11-163">本文探讨了如何在[自定义数据修改界面](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md)教程中创建和自定义 templatefield。</span><span class="sxs-lookup"><span data-stu-id="b0d11-163">We explored creating and customizing TemplateFields in the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial.</span></span> <span data-ttu-id="b0d11-164">我们将逐步介绍将 BoundFields 和 CheckBoxField 转换为 Templatefield 并在其 `ItemTemplate` 中定义其编辑界面的步骤，但如果你停滞或需要刷新器，请不要担心，请参阅前面的教程。</span><span class="sxs-lookup"><span data-stu-id="b0d11-164">We'll walk through the steps of converting the BoundFields and CheckBoxField into TemplateFields and defining their editing interfaces in their `ItemTemplate` s, but if you get stuck or need a refresher, don t hesitate to refer back to this earlier tutorial.</span></span>

<span data-ttu-id="b0d11-165">从 GridView s 智能标记中，单击 "编辑列" 链接，打开 "字段" 对话框。</span><span class="sxs-lookup"><span data-stu-id="b0d11-165">From the GridView s smart tag, click the Edit Columns link to open the Fields dialog box.</span></span> <span data-ttu-id="b0d11-166">接下来，选择每个字段，然后单击 "将此字段转换为 TemplateField" 链接。</span><span class="sxs-lookup"><span data-stu-id="b0d11-166">Next, select each field and click the Convert this field into a TemplateField link.</span></span>

![将现有的 BoundFields 和 CheckBoxField 转换为 Templatefield](batch-updating-vb/_static/image5.gif)

<span data-ttu-id="b0d11-168">**图 5**：将现有的 BoundFields 和 CheckBoxField 转换为 templatefield</span><span class="sxs-lookup"><span data-stu-id="b0d11-168">**Figure 5**: Convert the Existing BoundFields and CheckBoxField Into TemplateFields</span></span>

<span data-ttu-id="b0d11-169">由于每个字段都是 TemplateField，因此我们可以将编辑界面从 `EditItemTemplate` 移动到 `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="b0d11-169">Now that each field is a TemplateField, we re ready to move the editing interface from the `EditItemTemplate` s to the `ItemTemplate` s.</span></span>

## <a name="step-2-creating-theproductnameunitprice-anddiscontinuedediting-interfaces"></a><span data-ttu-id="b0d11-170">步骤2：创建`ProductName`、`UnitPrice`和`Discontinued`编辑接口</span><span class="sxs-lookup"><span data-stu-id="b0d11-170">Step 2: Creating the`ProductName`,`UnitPrice`, and`Discontinued`Editing Interfaces</span></span>

<span data-ttu-id="b0d11-171">创建 `ProductName`、`UnitPrice`和 `Discontinued` 编辑界面是此步骤的主题，并且非常简单，因为每个接口都已在 TemplateField s `EditItemTemplate`中定义。</span><span class="sxs-lookup"><span data-stu-id="b0d11-171">Creating the `ProductName`, `UnitPrice`, and `Discontinued` editing interfaces are the topic of this step and are pretty straightforward, as each interface is already defined in the TemplateField s `EditItemTemplate`.</span></span> <span data-ttu-id="b0d11-172">创建 `CategoryName` 编辑界面有点多，因为我们需要创建适用类别的 DropDownList。</span><span class="sxs-lookup"><span data-stu-id="b0d11-172">Creating the `CategoryName` editing interface is a bit more involved since we need to create a DropDownList of the applicable categories.</span></span> <span data-ttu-id="b0d11-173">此 `CategoryName` 编辑接口在步骤3处理。</span><span class="sxs-lookup"><span data-stu-id="b0d11-173">This `CategoryName` editing interface is tackled in Step 3.</span></span>

<span data-ttu-id="b0d11-174">让我们从 `ProductName` TemplateField 开始。</span><span class="sxs-lookup"><span data-stu-id="b0d11-174">Let s start with the `ProductName` TemplateField.</span></span> <span data-ttu-id="b0d11-175">单击 GridView s 智能标记的 "编辑模板" 链接，并向下钻取到 `ProductName` TemplateField s `EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="b0d11-175">Click on the Edit Templates link from the GridView s smart tag and drill down to the `ProductName` TemplateField s `EditItemTemplate`.</span></span> <span data-ttu-id="b0d11-176">选择文本框，将其复制到剪贴板，然后将其粘贴到 `ProductName` TemplateField s `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="b0d11-176">Select the TextBox, copy it to the clipboard, and then paste it to the `ProductName` TemplateField s `ItemTemplate`.</span></span> <span data-ttu-id="b0d11-177">将 TextBox `ID` 属性更改为 "`ProductName`"。</span><span class="sxs-lookup"><span data-stu-id="b0d11-177">Change the TextBox s `ID` property to `ProductName`.</span></span>

<span data-ttu-id="b0d11-178">接下来，将 RequiredFieldValidator 添加到 `ItemTemplate`，以确保用户为每个产品名称提供一个值。</span><span class="sxs-lookup"><span data-stu-id="b0d11-178">Next, add a RequiredFieldValidator to the `ItemTemplate` to ensure that the user provides a value for each product s name.</span></span> <span data-ttu-id="b0d11-179">将 `ControlToValidate` 属性设置为 ProductName `ErrorMessage`，则必须提供产品名称。</span><span class="sxs-lookup"><span data-stu-id="b0d11-179">Set the `ControlToValidate` property to ProductName, the `ErrorMessage` property to You must provide the product's name.</span></span> <span data-ttu-id="b0d11-180">要 \*的 `Text` 属性。</span><span class="sxs-lookup"><span data-stu-id="b0d11-180">and the `Text` property to \*.</span></span> <span data-ttu-id="b0d11-181">对 `ItemTemplate`进行这些添加后，屏幕应类似于图6。</span><span class="sxs-lookup"><span data-stu-id="b0d11-181">After making these additions to the `ItemTemplate`, your screen should look similar to Figure 6.</span></span>

<span data-ttu-id="b0d11-182">[![ProductName TemplateField 现在包括 TextBox 和 RequiredFieldValidator](batch-updating-vb/_static/image6.gif)](batch-updating-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="b0d11-182">[![The ProductName TemplateField Now Includes a TextBox and a RequiredFieldValidator](batch-updating-vb/_static/image6.gif)](batch-updating-vb/_static/image9.png)</span></span>

<span data-ttu-id="b0d11-183">**图 6**： `ProductName` TemplateField 现在包含一个文本框和一个 RequiredFieldValidator （[单击以查看完全大小的图像](batch-updating-vb/_static/image10.png)）</span><span class="sxs-lookup"><span data-stu-id="b0d11-183">**Figure 6**: The `ProductName` TemplateField Now Includes a TextBox and a RequiredFieldValidator ([Click to view full-size image](batch-updating-vb/_static/image10.png))</span></span>

<span data-ttu-id="b0d11-184">对于 `UnitPrice` 编辑界面，请从 `EditItemTemplate` 将文本框复制到 `ItemTemplate`开始。</span><span class="sxs-lookup"><span data-stu-id="b0d11-184">For the `UnitPrice` editing interface, start by copying the TextBox from the `EditItemTemplate` to the `ItemTemplate`.</span></span> <span data-ttu-id="b0d11-185">接下来，在文本框的前面放置一个 $，并将其 `ID` 属性设置为单价，并将其 `Columns` 属性设置为8。</span><span class="sxs-lookup"><span data-stu-id="b0d11-185">Next, place a $ in front of the TextBox and set its `ID` property to UnitPrice and its `Columns` property to 8 .</span></span>

<span data-ttu-id="b0d11-186">同时，将 CompareValidator 添加到 `UnitPrice` 的 `ItemTemplate`，以确保用户输入的值是大于或等于 $0.00 的有效货币值。</span><span class="sxs-lookup"><span data-stu-id="b0d11-186">Also add a CompareValidator to the `UnitPrice` s `ItemTemplate` to ensure that the value entered by the user is a valid currency value greater than or equal to $0.00.</span></span> <span data-ttu-id="b0d11-187">将验证程序 `ControlToValidate` 属性设置为 "单价 `ErrorMessage`"，则必须输入有效的货币值。</span><span class="sxs-lookup"><span data-stu-id="b0d11-187">Set the validator s `ControlToValidate` property to UnitPrice, its `ErrorMessage` property to You must enter a valid currency value.</span></span> <span data-ttu-id="b0d11-188">请省略任何货币符号。、其 `Text` 属性可以 \*，其 `Type` 属性 `Currency`，其 `Operator` 属性为 `GreaterThanEqual`，其 `ValueToCompare` 属性为0。</span><span class="sxs-lookup"><span data-stu-id="b0d11-188">Please omit any currency symbols., its `Text` property to \*, its `Type` property to `Currency`, its `Operator` property to `GreaterThanEqual`, and its `ValueToCompare` property to 0 .</span></span>

<span data-ttu-id="b0d11-189">[![添加 CompareValidator 以确保输入的价格是非负值货币值](batch-updating-vb/_static/image7.gif)](batch-updating-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="b0d11-189">[![Add a CompareValidator to Ensure the Price Entered is a Non-Negative Currency Value](batch-updating-vb/_static/image7.gif)](batch-updating-vb/_static/image11.png)</span></span>

<span data-ttu-id="b0d11-190">**图 7**：添加 CompareValidator 以确保输入的价格为非负货币值（[单击以查看完全大小的图像](batch-updating-vb/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="b0d11-190">**Figure 7**: Add a CompareValidator to Ensure the Price Entered is a Non-Negative Currency Value ([Click to view full-size image](batch-updating-vb/_static/image12.png))</span></span>

<span data-ttu-id="b0d11-191">对于 `Discontinued` TemplateField，您可以使用已在 `ItemTemplate`中定义的复选框。</span><span class="sxs-lookup"><span data-stu-id="b0d11-191">For the `Discontinued` TemplateField you can use the CheckBox already defined in the `ItemTemplate`.</span></span> <span data-ttu-id="b0d11-192">只需将其 `ID` 设置为废止，并将其 `Enabled` 属性设置为 "`True`"。</span><span class="sxs-lookup"><span data-stu-id="b0d11-192">Simply set its `ID` to Discontinued and its `Enabled` property to `True`.</span></span>

## <a name="step-3-creating-thecategorynameediting-interface"></a><span data-ttu-id="b0d11-193">步骤3：创建`CategoryName`编辑界面</span><span class="sxs-lookup"><span data-stu-id="b0d11-193">Step 3: Creating the`CategoryName`Editing Interface</span></span>

<span data-ttu-id="b0d11-194">`CategoryName` TemplateField s `EditItemTemplate` 中的编辑界面包含一个文本框，其中显示 `CategoryName` 数据字段的值。</span><span class="sxs-lookup"><span data-stu-id="b0d11-194">The editing interface in the `CategoryName` TemplateField s `EditItemTemplate` contains a TextBox that displays the value of the `CategoryName` data field.</span></span> <span data-ttu-id="b0d11-195">需要将其替换为一个 DropDownList，其中列出了可能的类别。</span><span class="sxs-lookup"><span data-stu-id="b0d11-195">We need to replace this with a DropDownList that lists the possible categories.</span></span>

> [!NOTE]
> <span data-ttu-id="b0d11-196">[自定义数据修改界面](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md)教程包含有关自定义模板以包含相对于文本框的 DropDownList 的更全面和完整讨论。</span><span class="sxs-lookup"><span data-stu-id="b0d11-196">The [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial contains a more thorough and complete discussion on customizing a template to include a DropDownList as opposed to a TextBox.</span></span> <span data-ttu-id="b0d11-197">尽管步骤已完成，但会显示 tersely。</span><span class="sxs-lookup"><span data-stu-id="b0d11-197">While the steps here are complete, they are presented tersely.</span></span> <span data-ttu-id="b0d11-198">若要深入了解如何创建和配置类别 DropDownList，请参阅[自定义数据修改界面](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md)教程。</span><span class="sxs-lookup"><span data-stu-id="b0d11-198">For a more in-depth look at creating and configuring the categories DropDownList, refer back to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial.</span></span>

<span data-ttu-id="b0d11-199">将 "DropDownList" 从 "工具箱" 拖动到 `CategoryName` TemplateField s `ItemTemplate`上，将其 `ID` 设置为 "`Categories`"。</span><span class="sxs-lookup"><span data-stu-id="b0d11-199">Drag a DropDownList from the Toolbox onto the `CategoryName` TemplateField s `ItemTemplate`, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="b0d11-200">此时，我们通常会通过其智能标记定义 DropDownLists 的数据源，从而创建新的 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="b0d11-200">At this point we would usually define the DropDownLists s data source through its smart tag, creating a new ObjectDataSource.</span></span> <span data-ttu-id="b0d11-201">但是，这会将 ObjectDataSource 添加到 `ItemTemplate`中，这将导致为每个 GridView 行创建一个 ObjectDataSource 实例。</span><span class="sxs-lookup"><span data-stu-id="b0d11-201">However, this will add the ObjectDataSource within the `ItemTemplate`, which will result in an ObjectDataSource instance created for each GridView row.</span></span> <span data-ttu-id="b0d11-202">相反，在 GridView s Templatefield 之外创建 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="b0d11-202">Instead, let s create the ObjectDataSource outside of the GridView s TemplateFields.</span></span> <span data-ttu-id="b0d11-203">结束模板编辑，并将 ObjectDataSource 从工具箱拖动到 `ProductsDataSource` ObjectDataSource 下的设计器。</span><span class="sxs-lookup"><span data-stu-id="b0d11-203">End the template editing and drag an ObjectDataSource from the Toolbox onto the Designer beneath the `ProductsDataSource` ObjectDataSource.</span></span> <span data-ttu-id="b0d11-204">为新的 ObjectDataSource `CategoriesDataSource` 命名，并将其配置为使用 `CategoriesBLL` 类 `GetCategories` 方法。</span><span class="sxs-lookup"><span data-stu-id="b0d11-204">Name the new ObjectDataSource `CategoriesDataSource` and configure it to use the `CategoriesBLL` class s `GetCategories` method.</span></span>

<span data-ttu-id="b0d11-205">[![将 ObjectDataSource 配置为使用 CategoriesBLL 类](batch-updating-vb/_static/image8.gif)](batch-updating-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="b0d11-205">[![Configure the ObjectDataSource to Use the CategoriesBLL Class](batch-updating-vb/_static/image8.gif)](batch-updating-vb/_static/image13.png)</span></span>

<span data-ttu-id="b0d11-206">**图 8**：将 ObjectDataSource 配置为使用 `CategoriesBLL` 类（[单击以查看完全大小的映像](batch-updating-vb/_static/image14.png)）</span><span class="sxs-lookup"><span data-stu-id="b0d11-206">**Figure 8**: Configure the ObjectDataSource to Use the `CategoriesBLL` Class ([Click to view full-size image](batch-updating-vb/_static/image14.png))</span></span>

<span data-ttu-id="b0d11-207">[![使用 GetCategories 方法检索类别数据](batch-updating-vb/_static/image9.gif)](batch-updating-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="b0d11-207">[![Retrieve the Category Data Using the GetCategories Method](batch-updating-vb/_static/image9.gif)](batch-updating-vb/_static/image15.png)</span></span>

<span data-ttu-id="b0d11-208">**图 9**：使用 `GetCategories` 方法检索类别数据（[单击以查看完全大小的图像](batch-updating-vb/_static/image16.png)）</span><span class="sxs-lookup"><span data-stu-id="b0d11-208">**Figure 9**: Retrieve the Category Data Using the `GetCategories` Method ([Click to view full-size image](batch-updating-vb/_static/image16.png))</span></span>

<span data-ttu-id="b0d11-209">由于此 ObjectDataSource 仅用于检索数据，因此请将 "更新" 和 "删除" 选项卡中的下拉列表设置为 "（无）"。</span><span class="sxs-lookup"><span data-stu-id="b0d11-209">Since this ObjectDataSource is used merely to retrieve data, set the drop-down lists in the UPDATE and DELETE tabs to (None).</span></span> <span data-ttu-id="b0d11-210">单击“完成”按钮以完成向导。</span><span class="sxs-lookup"><span data-stu-id="b0d11-210">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="b0d11-211">[![将 "更新" 和 "删除" 选项卡中的下拉列表设置为 "（无）"](batch-updating-vb/_static/image10.gif)](batch-updating-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="b0d11-211">[![Set the Drop-Down Lists in the UPDATE and DELETE Tabs to (None)](batch-updating-vb/_static/image10.gif)](batch-updating-vb/_static/image17.png)</span></span>

<span data-ttu-id="b0d11-212">**图 10**：将 "更新" 和 "删除" 选项卡中的下拉列表设置为 "（无）" （[单击查看完全大小的图像](batch-updating-vb/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="b0d11-212">**Figure 10**: Set the Drop-Down Lists in the UPDATE and DELETE Tabs to (None) ([Click to view full-size image](batch-updating-vb/_static/image18.png))</span></span>

<span data-ttu-id="b0d11-213">完成向导后，`CategoriesDataSource` 的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="b0d11-213">After completing the wizard, the `CategoriesDataSource` s declarative markup should look like the following:</span></span>

[!code-aspx[Main](batch-updating-vb/samples/sample2.aspx)]

<span data-ttu-id="b0d11-214">创建并配置 `CategoriesDataSource` 后，返回到 `CategoryName` TemplateField s `ItemTemplate`，并从 DropDownList s 智能标记中，单击 "选择数据源" 链接。</span><span class="sxs-lookup"><span data-stu-id="b0d11-214">With the `CategoriesDataSource` created and configured, return to the `CategoryName` TemplateField s `ItemTemplate` and, from the DropDownList s smart tag, click on the Choose Data Source link.</span></span> <span data-ttu-id="b0d11-215">在 "数据源配置向导" 中，从第一个下拉列表中选择 "`CategoriesDataSource`" 选项，然后 `CategoryName` 选择 "显示" 和 "`CategoryID`" 作为值。</span><span class="sxs-lookup"><span data-stu-id="b0d11-215">In the Data Source Configuration wizard, select the `CategoriesDataSource` option from the first drop-down list and choose to have `CategoryName` used for the display and `CategoryID` as the value.</span></span>

<span data-ttu-id="b0d11-216">[![将 DropDownList 绑定到 CategoriesDataSource](batch-updating-vb/_static/image11.gif)](batch-updating-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="b0d11-216">[![Bind the DropDownList to the CategoriesDataSource](batch-updating-vb/_static/image11.gif)](batch-updating-vb/_static/image19.png)</span></span>

<span data-ttu-id="b0d11-217">**图 11**：将 DropDownList 绑定到 `CategoriesDataSource` （[单击查看完全大小的图像](batch-updating-vb/_static/image20.png)）</span><span class="sxs-lookup"><span data-stu-id="b0d11-217">**Figure 11**: Bind the DropDownList to the `CategoriesDataSource` ([Click to view full-size image](batch-updating-vb/_static/image20.png))</span></span>

<span data-ttu-id="b0d11-218">此时，`Categories` DropDownList 将列出所有类别，但它尚不会自动为绑定到 GridView 行的产品选择适当的类别。</span><span class="sxs-lookup"><span data-stu-id="b0d11-218">At this point the `Categories` DropDownList lists all of the categories, but it does not yet automatically select the appropriate category for the product bound to the GridView row.</span></span> <span data-ttu-id="b0d11-219">为实现此目的，我们需要将 `Categories` DropDownList s `SelectedValue` 设置为产品的 `CategoryID` 值。</span><span class="sxs-lookup"><span data-stu-id="b0d11-219">To accomplish this we need to set the `Categories` DropDownList s `SelectedValue` to the product s `CategoryID` value.</span></span> <span data-ttu-id="b0d11-220">在 DropDownList s 智能标记中单击 "编辑数据绑定" 链接，并将 `SelectedValue` 属性与 `CategoryID` 数据字段相关联，如图12所示。</span><span class="sxs-lookup"><span data-stu-id="b0d11-220">Click on the Edit DataBindings link from the DropDownList s smart tag and associate the `SelectedValue` property with the `CategoryID` data field as shown in Figure 12.</span></span>

![将产品 s 类别 Id 值绑定到 DropDownList s SelectedValue 属性](batch-updating-vb/_static/image12.gif)

<span data-ttu-id="b0d11-222">**图 12**：将产品 s `CategoryID` 值绑定到 DropDownList s `SelectedValue` 属性</span><span class="sxs-lookup"><span data-stu-id="b0d11-222">**Figure 12**: Bind the Product s `CategoryID` Value to the DropDownList s `SelectedValue` Property</span></span>

<span data-ttu-id="b0d11-223">最后一个问题仍存在：如果产品没有指定 `CategoryID` 值，则 `SelectedValue` 上的数据绑定语句将导致异常。</span><span class="sxs-lookup"><span data-stu-id="b0d11-223">One last problem remains: if the product doesn t have a `CategoryID` value specified then the databinding statement on `SelectedValue` will result in an exception.</span></span> <span data-ttu-id="b0d11-224">这是因为，DropDownList 仅包含类别的项目，并且不为具有 `CategoryID``NULL` 数据库值的产品提供选项。</span><span class="sxs-lookup"><span data-stu-id="b0d11-224">This is because the DropDownList contains only items for the categories and does not offer an option for those products that have a `NULL` database value for `CategoryID`.</span></span> <span data-ttu-id="b0d11-225">若要解决此情况，请将 DropDownList `AppendDataBoundItems` 属性设置为 `True` 并将新项添加到 DropDownList，并从声明性语法中省略 `Value` 属性。</span><span class="sxs-lookup"><span data-stu-id="b0d11-225">To remedy this, set the DropDownList s `AppendDataBoundItems` property to `True` and add a new item to the DropDownList, omitting the `Value` property from the declarative syntax.</span></span> <span data-ttu-id="b0d11-226">也就是说，请确保 `Categories` DropDownList s 声明性语法如下所示：</span><span class="sxs-lookup"><span data-stu-id="b0d11-226">That is, make sure that the `Categories` DropDownList s declarative syntax looks like the following:</span></span>

[!code-aspx[Main](batch-updating-vb/samples/sample3.aspx)]

<span data-ttu-id="b0d11-227">请注意，`<asp:ListItem Value="">` 如何将其 `Value` 属性显式设置为空字符串。</span><span class="sxs-lookup"><span data-stu-id="b0d11-227">Note how the `<asp:ListItem Value="">` -- Select One -- has its `Value` attribute explicitly set to an empty string.</span></span> <span data-ttu-id="b0d11-228">请参阅[自定义数据修改界面](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md)教程，详细了解为什么需要此额外的 DropDownList 项来处理 `NULL` 案例，以及为什么将 `Value` 属性分配给空字符串是必不可少的。</span><span class="sxs-lookup"><span data-stu-id="b0d11-228">Refer back to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) tutorial for a more thorough discussion on why this additional DropDownList item is needed to handle the `NULL` case and why assignment of the `Value` property to an empty string is essential.</span></span>

> [!NOTE]
> <span data-ttu-id="b0d11-229">此处有一种潜在的性能和可伸缩性问题值得一提。</span><span class="sxs-lookup"><span data-stu-id="b0d11-229">There is a potential performance and scalability issue here that is worth mentioning.</span></span> <span data-ttu-id="b0d11-230">由于每一行都有一个使用 `CategoriesDataSource` 作为其数据源的 DropDownList，因此 `CategoriesBLL` 类 s `GetCategories` 方法将在每次访问页时调用*n*次，其中*n*是 GridView 中的行数。</span><span class="sxs-lookup"><span data-stu-id="b0d11-230">Since each row has a DropDownList that uses the `CategoriesDataSource` as its data source, the `CategoriesBLL` class s `GetCategories` method will be called *n* times per page visit, where *n* is the number of rows in the GridView.</span></span> <span data-ttu-id="b0d11-231">这*n*对的调用 `GetCategories` 会导致对数据库进行*n*次查询。</span><span class="sxs-lookup"><span data-stu-id="b0d11-231">These *n* calls to `GetCategories` result in *n* queries to the database.</span></span> <span data-ttu-id="b0d11-232">可以通过使用 SQL 缓存依赖关系或基于时间的较短的过期缓存返回的类别，在每个请求缓存中或通过缓存层缓存返回的类别，从而减少对数据库的影响。</span><span class="sxs-lookup"><span data-stu-id="b0d11-232">This impact on the database could be lessened by caching the returned categories either in a per-request cache or through the Caching Layer using a SQL caching dependency or a very short time-based expiry.</span></span> <span data-ttu-id="b0d11-233">有关每请求缓存选项的详细信息，请参阅[`HttpContext.Items` 每个请求的缓存存储](http://aspnet.4guysfromrolla.com/articles/060904-1.aspx)。</span><span class="sxs-lookup"><span data-stu-id="b0d11-233">For more information on the per-request caching option, see [`HttpContext.Items` a Per-Request Cache Store](http://aspnet.4guysfromrolla.com/articles/060904-1.aspx).</span></span>

## <a name="step-4-completing-the-editing-interface"></a><span data-ttu-id="b0d11-234">步骤4：完成编辑界面</span><span class="sxs-lookup"><span data-stu-id="b0d11-234">Step 4: Completing the Editing Interface</span></span>

<span data-ttu-id="b0d11-235">在不暂停的情况下，我们已对 GridView 模板进行了大量更改，无法查看进度。</span><span class="sxs-lookup"><span data-stu-id="b0d11-235">We ve made a number of changes to the GridView s templates without pausing to view our progress.</span></span> <span data-ttu-id="b0d11-236">花点时间通过浏览器查看进度。</span><span class="sxs-lookup"><span data-stu-id="b0d11-236">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="b0d11-237">如图13所示，每行都使用其 `ItemTemplate`进行呈现，其中包含单元格编辑界面。</span><span class="sxs-lookup"><span data-stu-id="b0d11-237">As Figure 13 shows, each row is rendered using its `ItemTemplate`, which contains the cell s editing interface.</span></span>

<span data-ttu-id="b0d11-238">[每个 GridView 行 ![都是可编辑的](batch-updating-vb/_static/image13.gif)](batch-updating-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="b0d11-238">[![Each GridView Row is Editable](batch-updating-vb/_static/image13.gif)](batch-updating-vb/_static/image21.png)</span></span>

<span data-ttu-id="b0d11-239">**图 13**：每个 GridView 行都是可编辑的（[单击查看完全大小的图像](batch-updating-vb/_static/image22.png)）</span><span class="sxs-lookup"><span data-stu-id="b0d11-239">**Figure 13**: Each GridView Row is Editable ([Click to view full-size image](batch-updating-vb/_static/image22.png))</span></span>

<span data-ttu-id="b0d11-240">此时，我们应该注意一些次要的格式问题。</span><span class="sxs-lookup"><span data-stu-id="b0d11-240">There are a few minor formatting issues that we should take care of at this point.</span></span> <span data-ttu-id="b0d11-241">首先，请注意，`UnitPrice` 值包含四个小数点。</span><span class="sxs-lookup"><span data-stu-id="b0d11-241">First, note that the `UnitPrice` value contains four decimal points.</span></span> <span data-ttu-id="b0d11-242">若要解决此问题，请返回到 `UnitPrice` TemplateField s `ItemTemplate` 并在 "TextBox" 智能标记中单击 "编辑 databinding" 链接。</span><span class="sxs-lookup"><span data-stu-id="b0d11-242">To fix this, return to the `UnitPrice` TemplateField s `ItemTemplate` and, from the TextBox s smart tag, click on the Edit DataBindings link.</span></span> <span data-ttu-id="b0d11-243">接下来，指定应将 `Text` 属性设置为数字格式。</span><span class="sxs-lookup"><span data-stu-id="b0d11-243">Next, specify that the `Text` property should be formatted as a number.</span></span>

![将 Text 属性设置为数字格式](batch-updating-vb/_static/image14.gif)

<span data-ttu-id="b0d11-245">**图 14**：将 `Text` 属性设置为数字格式</span><span class="sxs-lookup"><span data-stu-id="b0d11-245">**Figure 14**: Format the `Text` Property as a Number</span></span>

<span data-ttu-id="b0d11-246">其次，让我们将 `Discontinued` 列中的复选框居中（而不是左对齐）。</span><span class="sxs-lookup"><span data-stu-id="b0d11-246">Second, let s center the checkbox in the `Discontinued` column (rather than having it left-aligned).</span></span> <span data-ttu-id="b0d11-247">单击 "GridView s 智能" 标记中的 "编辑列"，然后从左下角的字段列表中选择 "`Discontinued` TemplateField"。</span><span class="sxs-lookup"><span data-stu-id="b0d11-247">Click on Edit Columns from the GridView s smart tag and select the `Discontinued` TemplateField from the list of fields in the bottom left corner.</span></span> <span data-ttu-id="b0d11-248">向下钻取到 `ItemStyle`，并将 `HorizontalAlign` 属性设置为 "居中"，如图15所示。</span><span class="sxs-lookup"><span data-stu-id="b0d11-248">Drill down into `ItemStyle` and set the `HorizontalAlign` property to Center as shown in Figure 15.</span></span>

![停用复选框](batch-updating-vb/_static/image15.gif)

<span data-ttu-id="b0d11-250">**图 15**：将 `Discontinued` 复选框居中</span><span class="sxs-lookup"><span data-stu-id="b0d11-250">**Figure 15**: Center the `Discontinued` CheckBox</span></span>

<span data-ttu-id="b0d11-251">接下来，将 ValidationSummary 控件添加到页面，并将其 `ShowMessageBox` 属性设置为 "`True`"，并将其 `ShowSummary` 属性设置为 "`False`"。</span><span class="sxs-lookup"><span data-stu-id="b0d11-251">Next, add a ValidationSummary control to the page and set its `ShowMessageBox` property to `True` and its `ShowSummary` property to `False`.</span></span> <span data-ttu-id="b0d11-252">另外，添加按钮 Web 控件，单击该按钮将更新用户的更改。</span><span class="sxs-lookup"><span data-stu-id="b0d11-252">Also add the Button Web controls that, when clicked, will update the user s changes.</span></span> <span data-ttu-id="b0d11-253">具体而言，添加两个按钮 Web 控件，一个位于 GridView 上方，另一个位于其下面，同时将两个控件 `Text` 属性设置为更新产品。</span><span class="sxs-lookup"><span data-stu-id="b0d11-253">Specifically, add two Button Web controls, one above the GridView and one below it, setting both controls `Text` properties to Update Products .</span></span>

<span data-ttu-id="b0d11-254">由于在 Templatefield `ItemTemplate` s 中定义了 GridView s 编辑界面，因此 `EditItemTemplate` 为多余，可能会被删除。</span><span class="sxs-lookup"><span data-stu-id="b0d11-254">Since the GridView s editing interface is defined in its TemplateFields `ItemTemplate` s, the `EditItemTemplate` s are superfluous and may be deleted.</span></span>

<span data-ttu-id="b0d11-255">进行上述格式更改后，添加按钮控件并删除不必要的 `EditItemTemplate` 后，页的声明性语法应该如下所示：</span><span class="sxs-lookup"><span data-stu-id="b0d11-255">After making the above mentioned formatting changes, adding the Button controls, and removing the unnecessary `EditItemTemplate` s, your page s declarative syntax should look like the following:</span></span>

[!code-aspx[Main](batch-updating-vb/samples/sample4.aspx)]

<span data-ttu-id="b0d11-256">图16显示了在添加按钮 Web 控件和进行格式更改后通过浏览器查看的此页。</span><span class="sxs-lookup"><span data-stu-id="b0d11-256">Figure 16 shows this page when viewed through a browser after the Button Web controls have been added and the formatting changes made.</span></span>

<span data-ttu-id="b0d11-257">[![该页现在包括两个 "更新产品" 按钮](batch-updating-vb/_static/image16.gif)](batch-updating-vb/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="b0d11-257">[![The Page Now Includes Two Update Products Buttons](batch-updating-vb/_static/image16.gif)](batch-updating-vb/_static/image23.png)</span></span>

<span data-ttu-id="b0d11-258">**图 16**：该页现在包含两个更新产品按钮（[单击以查看完全大小的图像](batch-updating-vb/_static/image24.png)）</span><span class="sxs-lookup"><span data-stu-id="b0d11-258">**Figure 16**: The Page Now Includes Two Update Products Buttons ([Click to view full-size image](batch-updating-vb/_static/image24.png))</span></span>

## <a name="step-5-updating-the-products"></a><span data-ttu-id="b0d11-259">步骤5：更新产品</span><span class="sxs-lookup"><span data-stu-id="b0d11-259">Step 5: Updating the Products</span></span>

<span data-ttu-id="b0d11-260">当用户访问此页面时，他们将进行修改，然后单击两个 "更新产品" 按钮之一。</span><span class="sxs-lookup"><span data-stu-id="b0d11-260">When a user visits this page they will make their modifications and then click one of the two Update Products buttons.</span></span> <span data-ttu-id="b0d11-261">此时，我们需要以某种方式将每个行的用户输入的值保存到 `ProductsDataTable` 实例，然后将其传递给 BLL 方法，然后将该 `ProductsDataTable` 实例传递到 DAL s `UpdateWithTransaction` 方法。</span><span class="sxs-lookup"><span data-stu-id="b0d11-261">At that point we need to somehow save the user-entered values for each row into a `ProductsDataTable` instance and then pass that to a BLL method that will then pass that `ProductsDataTable` instance to the DAL s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="b0d11-262">在[上一教程](wrapping-database-modifications-within-a-transaction-vb.md)中创建的 `UpdateWithTransaction` 方法可确保将更改批更新为原子操作。</span><span class="sxs-lookup"><span data-stu-id="b0d11-262">The `UpdateWithTransaction` method, which we created in the [preceding tutorial](wrapping-database-modifications-within-a-transaction-vb.md), ensures that the batch of changes will be updated as an atomic operation.</span></span>

<span data-ttu-id="b0d11-263">在 `BatchUpdate.aspx.vb` 中创建名为 `BatchUpdate` 的方法，并添加以下代码：</span><span class="sxs-lookup"><span data-stu-id="b0d11-263">Create a method named `BatchUpdate` in `BatchUpdate.aspx.vb` and add the following code:</span></span>

[!code-vb[Main](batch-updating-vb/samples/sample5.vb)]

<span data-ttu-id="b0d11-264">此方法的开始方式是通过调用 BLL 的 `GetProducts` 方法，将所有产品恢复到 `ProductsDataTable` 中。</span><span class="sxs-lookup"><span data-stu-id="b0d11-264">This method starts out by getting all of the products back in a `ProductsDataTable` via a call to the BLL s `GetProducts` method.</span></span> <span data-ttu-id="b0d11-265">然后枚举 `ProductGrid` GridView s [`Rows` 集合](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rows(VS.80).aspx)。</span><span class="sxs-lookup"><span data-stu-id="b0d11-265">It then enumerates the `ProductGrid` GridView s [`Rows` collection](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rows(VS.80).aspx).</span></span> <span data-ttu-id="b0d11-266">`Rows` 集合包含 GridView 中显示的每一行的[`GridViewRow` 实例](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewrow.aspx)。</span><span class="sxs-lookup"><span data-stu-id="b0d11-266">The `Rows` collection contains a [`GridViewRow` instance](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewrow.aspx) for each row displayed in the GridView.</span></span> <span data-ttu-id="b0d11-267">由于我们在每页上显示的行数最多为10，因此 GridView `Rows` 集合中的项不会超过10个。</span><span class="sxs-lookup"><span data-stu-id="b0d11-267">Since we are showing at most ten rows per page, the GridView s `Rows` collection will have no more than ten items.</span></span>

<span data-ttu-id="b0d11-268">对于每一行，`ProductID` 都从 `DataKeys` 集合中获取，并从 `ProductsDataTable`中选择相应的 `ProductsRow`。</span><span class="sxs-lookup"><span data-stu-id="b0d11-268">For each row the `ProductID` is grabbed from the `DataKeys` collection and the appropriate `ProductsRow` is selected from the `ProductsDataTable`.</span></span> <span data-ttu-id="b0d11-269">以编程方式引用四个 TemplateField 输入控件，并将它们的值分配给 `ProductsRow` 实例的属性。</span><span class="sxs-lookup"><span data-stu-id="b0d11-269">The four TemplateField input controls are programmatically referenced and their values assigned to the `ProductsRow` instance s properties.</span></span> <span data-ttu-id="b0d11-270">使用每个 GridView 行的值更新 `ProductsDataTable`后，它将传递给 BLL s `UpdateWithTransaction` 方法，如前面的教程中所示，只需向下调用 DAL s `UpdateWithTransaction` 方法。</span><span class="sxs-lookup"><span data-stu-id="b0d11-270">After each GridView row s values have been used to update the `ProductsDataTable`, it s passed to the BLL s `UpdateWithTransaction` method which, as we saw in the preceding tutorial, simply calls down into the DAL s `UpdateWithTransaction` method.</span></span>

<span data-ttu-id="b0d11-271">本教程中使用的批更新算法将更新与 GridView 中的行相对应的 `ProductsDataTable` 中的每一行，而不管产品的信息是否已更改。</span><span class="sxs-lookup"><span data-stu-id="b0d11-271">The batch update algorithm used for this tutorial updates each row in the `ProductsDataTable` that corresponds to a row in the GridView, regardless of whether the product s information has been changed.</span></span> <span data-ttu-id="b0d11-272">尽管此类直接更新并不是性能问题，但如果您对数据库表进行了审核更改，它们可能会导致不需要的记录。</span><span class="sxs-lookup"><span data-stu-id="b0d11-272">While such blind updates aren't usually a performance issue, they can lead to superfluous records if you re auditing changes to the database table.</span></span> <span data-ttu-id="b0d11-273">回到[执行批更新](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md)教程，我们探索了包含 DataList 的批处理更新接口，并添加了只更新用户实际修改的记录的代码。</span><span class="sxs-lookup"><span data-stu-id="b0d11-273">Back in the [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md) tutorial we explored a batch updating interface with the DataList and added code that would only update those records that were actually modified by the user.</span></span> <span data-ttu-id="b0d11-274">如果需要，可以根据需要使用此方法来[执行批量更新](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md)，以便更新本教程中的代码。</span><span class="sxs-lookup"><span data-stu-id="b0d11-274">Feel free to use the techniques from [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-vb.md) to update the code in this tutorial, if desired.</span></span>

> [!NOTE]
> <span data-ttu-id="b0d11-275">当通过其智能标记将数据源绑定到 GridView 时，Visual Studio 会自动将数据源的主键值分配给 GridView 的 `DataKeyNames` 属性。</span><span class="sxs-lookup"><span data-stu-id="b0d11-275">When binding the data source to the GridView through its smart tag, Visual Studio automatically assigns the data source s primary key value(s) to the GridView s `DataKeyNames` property.</span></span> <span data-ttu-id="b0d11-276">如果未通过步骤1中所述的 GridView s 智能标记将 ObjectDataSource 绑定到 GridView，则需要手动将 GridView `DataKeyNames` 属性设置为 ProductID，以便通过 `DataKeys` 集合访问每一行的 `ProductID` 值。</span><span class="sxs-lookup"><span data-stu-id="b0d11-276">If you did not bind the ObjectDataSource to the GridView through the GridView s smart tag as outlined in Step 1, then you will need to manually set the GridView s `DataKeyNames` property to ProductID in order to access the `ProductID` value for each row through the `DataKeys` collection.</span></span>

<span data-ttu-id="b0d11-277">`BatchUpdate` 中使用的代码与 BLL `UpdateProduct` 方法中使用的代码相似，主要区别在于，`UpdateProduct` 方法仅从体系结构检索单个 `ProductRow` 实例。</span><span class="sxs-lookup"><span data-stu-id="b0d11-277">The code used in `BatchUpdate` is similar to that used in the BLL s `UpdateProduct` methods, the main difference being that in the `UpdateProduct` methods only a single `ProductRow` instance is retrieved from the architecture.</span></span> <span data-ttu-id="b0d11-278">指定 `ProductRow` 的属性的代码在 `BatchUpdate`中的 `For Each` 循环内的 `UpdateProducts` 方法和代码之间是相同的，就像总体模式一样。</span><span class="sxs-lookup"><span data-stu-id="b0d11-278">The code that assigns the properties of the `ProductRow` is the same between the `UpdateProducts` methods and the code within the `For Each` loop in `BatchUpdate`, as is the overall pattern.</span></span>

<span data-ttu-id="b0d11-279">若要完成本教程，需要在单击 "更新产品" 按钮时调用 `BatchUpdate` 方法。</span><span class="sxs-lookup"><span data-stu-id="b0d11-279">To complete this tutorial, we need to have the `BatchUpdate` method invoked when either of the Update Products buttons is clicked.</span></span> <span data-ttu-id="b0d11-280">为这两个按钮控件的 `Click` 事件创建事件处理程序，并在事件处理程序中添加以下代码：</span><span class="sxs-lookup"><span data-stu-id="b0d11-280">Create event handlers for the `Click` events of these two Button controls and add the following code in the event handlers:</span></span>

[!code-vb[Main](batch-updating-vb/samples/sample6.vb)]

<span data-ttu-id="b0d11-281">首先调用 `BatchUpdate`。</span><span class="sxs-lookup"><span data-stu-id="b0d11-281">First a call is made to `BatchUpdate`.</span></span> <span data-ttu-id="b0d11-282">接下来， [`ClientScript` 属性](https://msdn.microsoft.com/library/system.web.ui.page.clientscript(VS.80).aspx)用于注入 JavaScript，该 JavaScript 将显示读取产品已更新的 messagebox。</span><span class="sxs-lookup"><span data-stu-id="b0d11-282">Next, the [`ClientScript` property](https://msdn.microsoft.com/library/system.web.ui.page.clientscript(VS.80).aspx) is used to inject JavaScript that will display a messagebox that reads The products have been updated.</span></span>

<span data-ttu-id="b0d11-283">花点时间对此代码进行测试。</span><span class="sxs-lookup"><span data-stu-id="b0d11-283">Take a minute to test out this code.</span></span> <span data-ttu-id="b0d11-284">通过浏览器访问 `BatchUpdate.aspx`、编辑多个行，然后单击其中一个 "更新产品" 按钮。</span><span class="sxs-lookup"><span data-stu-id="b0d11-284">Visit `BatchUpdate.aspx` through a browser, edit a number of rows, and click one of the Update Products buttons.</span></span> <span data-ttu-id="b0d11-285">假设没有输入验证错误，你应该会看到一个 messagebox，其中包含已更新的产品。</span><span class="sxs-lookup"><span data-stu-id="b0d11-285">Assuming there are no input validation errors, you should see a messagebox that reads The products have been updated.</span></span> <span data-ttu-id="b0d11-286">若要验证更新的原子性，请考虑添加一个随机 `CHECK` 约束，如不允许 `UnitPrice` 值1234.56 的值。</span><span class="sxs-lookup"><span data-stu-id="b0d11-286">To verify the atomicity of the update, consider adding a random `CHECK` constraint, like one that disallows `UnitPrice` values of 1234.56.</span></span> <span data-ttu-id="b0d11-287">然后，在 `BatchUpdate.aspx`中，编辑多条记录，确保将产品的 `UnitPrice` 值之一设置为禁止值（1234.56）。</span><span class="sxs-lookup"><span data-stu-id="b0d11-287">Then from `BatchUpdate.aspx`, edit a number of records, making sure to set one of the product s `UnitPrice` value to the forbidden value ( 1234.56 ).</span></span> <span data-ttu-id="b0d11-288">这会导致在此批处理操作出现时，单击 "更新产品" 时出现错误。</span><span class="sxs-lookup"><span data-stu-id="b0d11-288">This should result in an error when clicking Update Products with the other changes during that batch operation rolled back to their original values.</span></span>

## <a name="an-alternativebatchupdatemethod"></a><span data-ttu-id="b0d11-289">备用`BatchUpdate`方法</span><span class="sxs-lookup"><span data-stu-id="b0d11-289">An Alternative`BatchUpdate`Method</span></span>

<span data-ttu-id="b0d11-290">我们刚才检查的 `BatchUpdate` 方法从 BLL s `GetProducts` 方法中检索*所有*产品，然后仅更新在 GridView 中显示的那些记录。</span><span class="sxs-lookup"><span data-stu-id="b0d11-290">The `BatchUpdate` method we just examined retrieves *all* of the products from the BLL s `GetProducts` method and then updates just those records that appear in the GridView.</span></span> <span data-ttu-id="b0d11-291">如果 GridView 不使用分页，则此方法非常理想，但如果有，则可能有成百上千的产品，但在 GridView 中只能有10行。</span><span class="sxs-lookup"><span data-stu-id="b0d11-291">This approach is ideal if the GridView does not use paging, but if it does, there may be hundreds, thousands, or tens of thousands of products, but only ten rows in the GridView.</span></span> <span data-ttu-id="b0d11-292">在这种情况下，只是从数据库中获取所有产品，只是修改其中的10个。</span><span class="sxs-lookup"><span data-stu-id="b0d11-292">In such a case, getting all of the products from the database only to modify 10 of them is less than ideal.</span></span>

<span data-ttu-id="b0d11-293">对于这些类型的情况，请考虑改用以下 `BatchUpdateAlternate` 方法：</span><span class="sxs-lookup"><span data-stu-id="b0d11-293">For those types of situations, consider using the following `BatchUpdateAlternate` method instead:</span></span>

[!code-vb[Main](batch-updating-vb/samples/sample7.vb)]

<span data-ttu-id="b0d11-294">`BatchMethodAlternate` 首先创建名为 `products`的新的空 `ProductsDataTable`。</span><span class="sxs-lookup"><span data-stu-id="b0d11-294">`BatchMethodAlternate` starts by creating a new empty `ProductsDataTable` named `products`.</span></span> <span data-ttu-id="b0d11-295">然后，依次执行 GridView 的 `Rows` 集合，每一行都将使用 BLL s `GetProductByProductID(productID)` 方法获取特定的产品信息。</span><span class="sxs-lookup"><span data-stu-id="b0d11-295">It then steps through the GridView s `Rows` collection and for each row gets the particular product information using the BLL s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="b0d11-296">检索的 `ProductsRow` 实例的属性以与 `BatchUpdate`相同的方式进行更新，但在更新行后，将通过 DataTable [`ImportRow(DataRow)` 方法](https://msdn.microsoft.com/library/system.data.datatable.importrow(VS.80).aspx)将其导入到 `products` `ProductsDataTable` 中。</span><span class="sxs-lookup"><span data-stu-id="b0d11-296">The retrieved `ProductsRow` instance has its properties updated in the same fashion as `BatchUpdate`, but after updating the row it is imported into the `products` `ProductsDataTable` via the DataTable s [`ImportRow(DataRow)` method](https://msdn.microsoft.com/library/system.data.datatable.importrow(VS.80).aspx).</span></span>

<span data-ttu-id="b0d11-297">`For Each` 循环完成后，`products` 为 GridView 中的每一行包含一个 `ProductsRow` 实例。</span><span class="sxs-lookup"><span data-stu-id="b0d11-297">After the `For Each` loop completes, `products` contains one `ProductsRow` instance for each row in the GridView.</span></span> <span data-ttu-id="b0d11-298">由于每个 `ProductsRow` 实例都已添加到 `products` （而不是更新），因此，如果我们盲目地将其传递到 `UpdateWithTransaction` 方法，`ProductsTableAdapter` 会尝试将每个记录插入到数据库中。</span><span class="sxs-lookup"><span data-stu-id="b0d11-298">Since each of the `ProductsRow` instances have been added to the `products` (instead of updated), if we blindly pass it to the `UpdateWithTransaction` method the `ProductsTableAdapter` will try to insert each of the records into the database.</span></span> <span data-ttu-id="b0d11-299">相反，我们需要指定每个行都已修改（不添加）。</span><span class="sxs-lookup"><span data-stu-id="b0d11-299">Instead, we need to specify that each of these rows has been modified (not added).</span></span>

<span data-ttu-id="b0d11-300">这可以通过将新方法添加到名为 `UpdateProductsWithTransaction`的 BLL 来完成。</span><span class="sxs-lookup"><span data-stu-id="b0d11-300">This can be accomplished by adding a new method to the BLL named `UpdateProductsWithTransaction`.</span></span> <span data-ttu-id="b0d11-301">`UpdateProductsWithTransaction`，如下所示，将 `ProductsDataTable` 中每个 `ProductsRow` 实例的 `RowState` 设置为 `Modified`，然后将 `ProductsDataTable` 传递到 DAL s `UpdateWithTransaction` 方法。</span><span class="sxs-lookup"><span data-stu-id="b0d11-301">`UpdateProductsWithTransaction`, shown below, sets the `RowState` of each of the `ProductsRow` instances in the `ProductsDataTable` to `Modified` and then passes the `ProductsDataTable` to the DAL s `UpdateWithTransaction` method.</span></span>

[!code-vb[Main](batch-updating-vb/samples/sample8.vb)]

## <a name="summary"></a><span data-ttu-id="b0d11-302">总结</span><span class="sxs-lookup"><span data-stu-id="b0d11-302">Summary</span></span>

<span data-ttu-id="b0d11-303">GridView 提供内置的按行编辑功能，但缺少创建完全可编辑的接口的支持。</span><span class="sxs-lookup"><span data-stu-id="b0d11-303">The GridView provides built-in per-row editing capabilities, but lacks support for creating fully editable interfaces.</span></span> <span data-ttu-id="b0d11-304">正如我们在本教程中看到的那样，这些接口是可能的，但需要一些工作。</span><span class="sxs-lookup"><span data-stu-id="b0d11-304">As we saw in this tutorial, such interfaces are possible, but require a bit of work.</span></span> <span data-ttu-id="b0d11-305">若要创建每个行都可编辑的 GridView，需要将 GridView 的字段转换为 Templatefield，并在 `ItemTemplate` 中定义编辑界面。</span><span class="sxs-lookup"><span data-stu-id="b0d11-305">To create a GridView where every row is editable, we need to convert the GridView s fields into TemplateFields and define the editing interface within the `ItemTemplate` s.</span></span> <span data-ttu-id="b0d11-306">此外，必须将 "更新所有类型" 按钮 Web 控件添加到页面中，与 GridView 分离。</span><span class="sxs-lookup"><span data-stu-id="b0d11-306">Additionally, Update All -type Button Web controls must be added to the page, separate from the GridView.</span></span> <span data-ttu-id="b0d11-307">这些按钮 `Click` 事件处理程序需要枚举 GridView `Rows` 集合、将更改存储在 `ProductsDataTable`中，并将更新的信息传递到适当的 BLL 方法。</span><span class="sxs-lookup"><span data-stu-id="b0d11-307">These Buttons `Click` event handlers need to enumerate the GridView s `Rows` collection, store the changes in a `ProductsDataTable`, and pass the updated information into the appropriate BLL method.</span></span>

<span data-ttu-id="b0d11-308">在下一教程中，我们将了解如何创建用于批量删除的接口。</span><span class="sxs-lookup"><span data-stu-id="b0d11-308">In the next tutorial we'll see how to create an interface for batch deleting.</span></span> <span data-ttu-id="b0d11-309">具体而言，每个 GridView 行将包含一个复选框，而不是 "更新所有类型" 按钮，我们将删除选定的行按钮。</span><span class="sxs-lookup"><span data-stu-id="b0d11-309">In particular, each GridView row will include a checkbox and instead of Update All -type buttons, we'll have Delete Selected Rows buttons.</span></span>

<span data-ttu-id="b0d11-310">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="b0d11-310">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="b0d11-311">关于作者</span><span class="sxs-lookup"><span data-stu-id="b0d11-311">About the Author</span></span>

<span data-ttu-id="b0d11-312">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，创始人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已在使用 Microsoft Web 技术，自1998开始。</span><span class="sxs-lookup"><span data-stu-id="b0d11-312">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="b0d11-313">Scott 的工作方式是独立的顾问、培训师和撰稿人。</span><span class="sxs-lookup"><span data-stu-id="b0d11-313">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="b0d11-314">他的最新书籍是，[*在24小时内，sam ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="b0d11-314">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="b0d11-315">可以[mitchell@4GuysFromRolla.com访问。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="b0d11-315">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="b0d11-316">或通过他的博客，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="b0d11-316">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="b0d11-317">特别感谢</span><span class="sxs-lookup"><span data-stu-id="b0d11-317">Special Thanks To</span></span>

<span data-ttu-id="b0d11-318">此教程系列由许多有用的审阅者查看。</span><span class="sxs-lookup"><span data-stu-id="b0d11-318">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="b0d11-319">本教程的领导评审者是 Teresa Murphy 和 David Suru。</span><span class="sxs-lookup"><span data-stu-id="b0d11-319">Lead reviewers for this tutorial were Teresa Murphy and David Suru.</span></span> <span data-ttu-id="b0d11-320">想要查看我即将发布的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="b0d11-320">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="b0d11-321">如果是这样，请在mitchell@4GuysFromRolla.com放置一行[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="b0d11-321">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="b0d11-322">[上一页](wrapping-database-modifications-within-a-transaction-vb.md)
> [下一页](batch-deleting-vb.md)</span><span class="sxs-lookup"><span data-stu-id="b0d11-322">[Previous](wrapping-database-modifications-within-a-transaction-vb.md)
[Next](batch-deleting-vb.md)</span></span>
