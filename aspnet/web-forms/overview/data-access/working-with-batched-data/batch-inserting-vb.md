---
uid: web-forms/overview/data-access/working-with-batched-data/batch-inserting-vb
title: 批处理插入（VB） |Microsoft Docs
author: rick-anderson
description: 了解如何在一个操作中插入多个数据库记录。 在用户界面层，我们扩展了 GridView，以允许用户输入多个 n 。
ms.author: riande
ms.date: 06/26/2007
ms.assetid: 48e2a4ae-77ca-4208-a204-c38c690ffb59
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-inserting-vb
msc.type: authoredcontent
ms.openlocfilehash: 413a0e209b1899414eaab70aff07ee0d3223f28f
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/28/2019
ms.locfileid: "74643126"
---
# <a name="batch-inserting-vb"></a><span data-ttu-id="1de45-104">批量插入 (VB)</span><span class="sxs-lookup"><span data-stu-id="1de45-104">Batch Inserting (VB)</span></span>

<span data-ttu-id="1de45-105">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="1de45-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="1de45-106">[下载代码](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_VB.zip)或[下载 PDF](batch-inserting-vb/_static/datatutorial66vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="1de45-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_VB.zip) or [Download PDF](batch-inserting-vb/_static/datatutorial66vb1.pdf)</span></span>

> <span data-ttu-id="1de45-107">了解如何在一个操作中插入多个数据库记录。</span><span class="sxs-lookup"><span data-stu-id="1de45-107">Learn how to insert multiple database records in a single operation.</span></span> <span data-ttu-id="1de45-108">在用户界面层，我们扩展了 GridView，以允许用户输入多个新记录。</span><span class="sxs-lookup"><span data-stu-id="1de45-108">In the User Interface Layer we extend the GridView to allow the user to enter multiple new records.</span></span> <span data-ttu-id="1de45-109">在数据访问层中，我们将多个 Insert 操作打包到一个事务中，以确保所有插入操作成功或回滚所有插入操作。</span><span class="sxs-lookup"><span data-stu-id="1de45-109">In the Data Access Layer we wrap the multiple Insert operations within a transaction to ensure that all insertions succeed or all insertions are rolled back.</span></span>

## <a name="introduction"></a><span data-ttu-id="1de45-110">简介</span><span class="sxs-lookup"><span data-stu-id="1de45-110">Introduction</span></span>

<span data-ttu-id="1de45-111">在[批处理更新](batch-updating-vb.md)教程中，我们将介绍如何自定义 GridView 控件以显示可编辑多个记录的接口。</span><span class="sxs-lookup"><span data-stu-id="1de45-111">In the [Batch Updating](batch-updating-vb.md) tutorial we looked at customizing the GridView control to present an interface where multiple records were editable.</span></span> <span data-ttu-id="1de45-112">访问此页的用户可能会进行一系列更改，然后单击一个按钮即可执行批更新。</span><span class="sxs-lookup"><span data-stu-id="1de45-112">The user visiting the page could make a series of changes and then, with a single button click, perform a batch update.</span></span> <span data-ttu-id="1de45-113">对于用户经常在一步中更新多条记录的情况，这种情况下，与在[插入、更新和删除数据](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md)教程的概述中首次查看的默认每行编辑功能相比，此类接口可以节省无数次单击和键盘到鼠标的上下文切换。</span><span class="sxs-lookup"><span data-stu-id="1de45-113">For situations where users commonly update many records in one go, such an interface can save countless clicks and keyboard-to-mouse context switches when compared to the default per-row editing features that were first explored back in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md) tutorial.</span></span>

<span data-ttu-id="1de45-114">此概念还可在添加记录时应用。</span><span class="sxs-lookup"><span data-stu-id="1de45-114">This concept can also be applied when adding records.</span></span> <span data-ttu-id="1de45-115">假设在 Northwind 商贸这里，我们通常会收到来自供应商的装运，其中包含一系列特定类别的产品。</span><span class="sxs-lookup"><span data-stu-id="1de45-115">Imagine that here at Northwind Traders we commonly receive shipments from suppliers that contain a number of products for a particular category.</span></span> <span data-ttu-id="1de45-116">例如，我们可能会从东京商贸接收六个不同的茶和咖啡产品。</span><span class="sxs-lookup"><span data-stu-id="1de45-116">As an example, we might receive a shipment of six different tea and coffee products from Tokyo Traders.</span></span> <span data-ttu-id="1de45-117">如果用户一次通过 DetailsView 控件输入了六个产品，则他们将需要反复选择多个相同的值：他们需要选择相同的类别（饮料）、相同的供应商（东京商贸），这是一个相同的废止值（False）和按顺序值（0）相同的单位。</span><span class="sxs-lookup"><span data-stu-id="1de45-117">If a user enters the six products one at a time through a DetailsView control, they will have to choose many of the same values over and over again: they will need to choose the same category (Beverages), the same supplier (Tokyo Traders), the same discontinued value (False), and the same units on order value (0).</span></span> <span data-ttu-id="1de45-118">此重复数据输入不仅费时，而且容易出错。</span><span class="sxs-lookup"><span data-stu-id="1de45-118">This repetitive data entry is not only time consuming, but is prone to errors.</span></span>

<span data-ttu-id="1de45-119">使用少许工作，我们可以创建一个批插入界面，使用户能够选择供应商和类别一次，输入一系列产品名称和单价，然后单击按钮将新产品添加到数据库中（请参阅图1）。</span><span class="sxs-lookup"><span data-stu-id="1de45-119">With a little work we can create a batch inserting interface that enables the user to choose the supplier and category once, enter a series of product names and unit prices, and then click a button to add the new products to the database (see Figure 1).</span></span> <span data-ttu-id="1de45-120">添加每个产品后，其 `ProductName` 和 `UnitPrice` 数据字段将被分配在文本框中输入的值，而其 `CategoryID` 和 `SupplierID` 值将从窗体顶部的 DropDownLists 中分配值。</span><span class="sxs-lookup"><span data-stu-id="1de45-120">As each product is added, its `ProductName` and `UnitPrice` data fields are assigned the values entered in the TextBoxes, while its `CategoryID` and `SupplierID` values are assigned the values from the DropDownLists at the top fo the form.</span></span> <span data-ttu-id="1de45-121">`Discontinued` 和 `UnitsOnOrder` 值分别设置为 `False` 和0的硬编码值。</span><span class="sxs-lookup"><span data-stu-id="1de45-121">The `Discontinued` and `UnitsOnOrder` values are set to the hard-coded values of `False` and 0, respectively.</span></span>

<span data-ttu-id="1de45-122">[![批插入接口](batch-inserting-vb/_static/image2.png)](batch-inserting-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="1de45-122">[![The Batch Inserting Interface](batch-inserting-vb/_static/image2.png)](batch-inserting-vb/_static/image1.png)</span></span>

<span data-ttu-id="1de45-123">**图 1**：批插入接口（[单击以查看完全大小的图像](batch-inserting-vb/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="1de45-123">**Figure 1**: The Batch Inserting Interface ([Click to view full-size image](batch-inserting-vb/_static/image3.png))</span></span>

<span data-ttu-id="1de45-124">在本教程中，我们将创建一个页面，用于实现图1所示的批插入接口。</span><span class="sxs-lookup"><span data-stu-id="1de45-124">In this tutorial we will create a page that implements the batch inserting interface shown in Figure 1.</span></span> <span data-ttu-id="1de45-125">与前两个教程一样，我们将在事务范围内包装插入内容，以确保原子性。</span><span class="sxs-lookup"><span data-stu-id="1de45-125">As with the previous two tutorials, we will wrap the insertions within the scope of a transaction to ensure atomicity.</span></span> <span data-ttu-id="1de45-126">让我们开始吧！</span><span class="sxs-lookup"><span data-stu-id="1de45-126">Let s get started!</span></span>

## <a name="step-1-creating-the-display-interface"></a><span data-ttu-id="1de45-127">步骤1：创建显示界面</span><span class="sxs-lookup"><span data-stu-id="1de45-127">Step 1: Creating the Display Interface</span></span>

<span data-ttu-id="1de45-128">本教程将包含一个分为两个区域的页面：一个显示区域和一个插入区域。</span><span class="sxs-lookup"><span data-stu-id="1de45-128">This tutorial will consist of a single page that is divided into two regions: a display region and an inserting region.</span></span> <span data-ttu-id="1de45-129">将在此步骤中创建的显示界面显示 GridView 中的产品并包含一个标题为 "处理产品发货" 的按钮。</span><span class="sxs-lookup"><span data-stu-id="1de45-129">The display interface, which we'll create in this step, shows the products in a GridView and includes a button titled Process Product Shipment.</span></span> <span data-ttu-id="1de45-130">单击此按钮时，显示界面将替换为插入界面，如图1所示。</span><span class="sxs-lookup"><span data-stu-id="1de45-130">When this button is clicked, the display interface is replaced with the inserting interface, which is shown in Figure 1.</span></span> <span data-ttu-id="1de45-131">单击 "从发货中添加产品" 或 "取消" 按钮后返回显示界面。</span><span class="sxs-lookup"><span data-stu-id="1de45-131">The display interface returns after the Add Products from Shipment or Cancel buttons are clicked.</span></span> <span data-ttu-id="1de45-132">我们将在步骤2中创建插入接口。</span><span class="sxs-lookup"><span data-stu-id="1de45-132">We'll create the inserting interface in Step 2.</span></span>

<span data-ttu-id="1de45-133">当创建一个具有两个接口的页时，每次只显示其中一个接口，每个接口通常放置在一个[面板 Web 控件](http://www.w3schools.com/aspnet/control_panel.asp)中，后者用作其他控件的容器。</span><span class="sxs-lookup"><span data-stu-id="1de45-133">When creating a page that has two interfaces, only one of which is visible at a time, each interface typically is placed within a [Panel Web control](http://www.w3schools.com/aspnet/control_panel.asp), which serves as a container for other controls.</span></span> <span data-ttu-id="1de45-134">因此，我们的页面将有两个面板控件用于每个接口。</span><span class="sxs-lookup"><span data-stu-id="1de45-134">Therefore, our page will have two Panel controls one for each interface.</span></span>

<span data-ttu-id="1de45-135">首先打开 `BatchData` 文件夹中的 "`BatchInsert.aspx`" 页，然后将面板从工具箱拖到设计器上（参见图2）。</span><span class="sxs-lookup"><span data-stu-id="1de45-135">Start by opening the `BatchInsert.aspx` page in the `BatchData` folder and drag a Panel from the Toolbox onto the Designer (see Figure 2).</span></span> <span data-ttu-id="1de45-136">将 Panel `ID` 属性设置为 `DisplayInterface`。</span><span class="sxs-lookup"><span data-stu-id="1de45-136">Set the Panel s `ID` property to `DisplayInterface`.</span></span> <span data-ttu-id="1de45-137">将面板添加到设计器中时，其 `Height` 和 `Width` 属性分别设置为50px 和125px。</span><span class="sxs-lookup"><span data-stu-id="1de45-137">When adding the Panel to the Designer, its `Height` and `Width` properties are set to 50px and 125px, respectively.</span></span> <span data-ttu-id="1de45-138">从属性窗口中清除这些属性值。</span><span class="sxs-lookup"><span data-stu-id="1de45-138">Clear out these property values from the Properties window.</span></span>

<span data-ttu-id="1de45-139">[![将面板从工具箱拖到设计器上](batch-inserting-vb/_static/image5.png)](batch-inserting-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="1de45-139">[![Drag a Panel from the Toolbox onto the Designer](batch-inserting-vb/_static/image5.png)](batch-inserting-vb/_static/image4.png)</span></span>

<span data-ttu-id="1de45-140">**图 2**：将面板从工具箱拖到设计器上（[单击以查看完全大小的图像](batch-inserting-vb/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="1de45-140">**Figure 2**: Drag a Panel from the Toolbox onto the Designer ([Click to view full-size image](batch-inserting-vb/_static/image6.png))</span></span>

<span data-ttu-id="1de45-141">接下来，将按钮和 GridView 控件拖动到面板中。</span><span class="sxs-lookup"><span data-stu-id="1de45-141">Next, drag a Button and GridView control into the Panel.</span></span> <span data-ttu-id="1de45-142">将 "`ID`" 按钮设置为 "`ProcessShipment`"，并将其 "`Text`" 属性设置为 "处理产品发货"。</span><span class="sxs-lookup"><span data-stu-id="1de45-142">Set the Button s `ID` property to `ProcessShipment` and its `Text` property to Process Product Shipment.</span></span> <span data-ttu-id="1de45-143">将 GridView `ID` 属性设置为 `ProductsGrid`，并从其智能标记将其绑定到名为 `ProductsDataSource`的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="1de45-143">Set the GridView s `ID` property to `ProductsGrid` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="1de45-144">将 ObjectDataSource 配置为从 `ProductsBLL` 类 `GetProducts` 方法拉取其数据。</span><span class="sxs-lookup"><span data-stu-id="1de45-144">Configure the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="1de45-145">由于此 GridView 仅用于显示数据，因此请将 "更新"、"插入" 和 "删除" 选项卡中的下拉列表设置为 "（无）"。</span><span class="sxs-lookup"><span data-stu-id="1de45-145">Since this GridView is used only to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="1de45-146">单击 "完成" 以完成 "配置数据源" 向导。</span><span class="sxs-lookup"><span data-stu-id="1de45-146">Click Finish to complete the Configure Data Source wizard.</span></span>

<span data-ttu-id="1de45-147">[![显示从 ProductsBLL 类 s GetProducts 方法返回的数据](batch-inserting-vb/_static/image8.png)](batch-inserting-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="1de45-147">[![Display the Data Returned from the ProductsBLL Class s GetProducts Method](batch-inserting-vb/_static/image8.png)](batch-inserting-vb/_static/image7.png)</span></span>

<span data-ttu-id="1de45-148">**图 3**：显示从 `ProductsBLL` 类 `GetProducts` 方法返回的数据（[单击查看完全大小的图像](batch-inserting-vb/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="1de45-148">**Figure 3**: Display the Data Returned from the `ProductsBLL` Class s `GetProducts` Method ([Click to view full-size image](batch-inserting-vb/_static/image9.png))</span></span>

<span data-ttu-id="1de45-149">[![在 "更新"、"插入" 和 "删除" 选项卡中将下拉列表设置为 "（无）"](batch-inserting-vb/_static/image11.png)](batch-inserting-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="1de45-149">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-inserting-vb/_static/image11.png)](batch-inserting-vb/_static/image10.png)</span></span>

<span data-ttu-id="1de45-150">**图 4**：将 "更新"、"插入" 和 "删除" 选项卡中的下拉列表设置为 "（无）" （[单击查看完全大小的映像](batch-inserting-vb/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="1de45-150">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-inserting-vb/_static/image12.png))</span></span>

<span data-ttu-id="1de45-151">完成 ObjectDataSource 向导后，Visual Studio 将为产品数据字段添加 BoundFields 和 CheckBoxField。</span><span class="sxs-lookup"><span data-stu-id="1de45-151">After completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for the product data fields.</span></span> <span data-ttu-id="1de45-152">删除除 `ProductName`、`CategoryName`、`SupplierName`、`UnitPrice`和 `Discontinued` 字段之外的所有字段。</span><span class="sxs-lookup"><span data-stu-id="1de45-152">Remove all but the `ProductName`, `CategoryName`, `SupplierName`, `UnitPrice`, and `Discontinued` fields.</span></span> <span data-ttu-id="1de45-153">随意进行任何美观自定义。</span><span class="sxs-lookup"><span data-stu-id="1de45-153">Feel free to make any aesthetic customizations.</span></span> <span data-ttu-id="1de45-154">我决定将 `UnitPrice` 字段的格式设置为货币值，对字段重新排序，然后将多个字段重命名为 `HeaderText` 值。</span><span class="sxs-lookup"><span data-stu-id="1de45-154">I decided to format the `UnitPrice` field as a currency value, reordered the fields, and renamed several of the fields `HeaderText` values.</span></span> <span data-ttu-id="1de45-155">此外，通过选中 GridView s 智能标记中的 "启用分页" 和 "启用排序" 复选框，将 GridView 配置为包含分页和排序支持。</span><span class="sxs-lookup"><span data-stu-id="1de45-155">Also configure the GridView to include paging and sorting support by checking the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="1de45-156">添加面板、按钮、GridView 和 ObjectDataSource 控件并自定义 GridView 字段之后，页面的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="1de45-156">After adding the Panel, Button, GridView, and ObjectDataSource controls and customizing the GridView s fields, your page s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](batch-inserting-vb/samples/sample1.aspx)]

<span data-ttu-id="1de45-157">请注意，按钮和 GridView 的标记出现在开始标记和结束标记 `<asp:Panel>` 中。</span><span class="sxs-lookup"><span data-stu-id="1de45-157">Note that the markup for the Button and GridView appear within the opening and closing `<asp:Panel>` tags.</span></span> <span data-ttu-id="1de45-158">由于这些控件位于 `DisplayInterface` 面板内，因此，只需将面板的 `Visible` 属性设置为 `False`即可隐藏它们。</span><span class="sxs-lookup"><span data-stu-id="1de45-158">Since these controls are within the `DisplayInterface` Panel, we can hide them by simply setting the Panel s `Visible` property to `False`.</span></span> <span data-ttu-id="1de45-159">步骤3查看以编程方式更改面板的 `Visible` 属性，以响应按钮单击以显示一个接口，同时隐藏另一个接口。</span><span class="sxs-lookup"><span data-stu-id="1de45-159">Step 3 looks at programmatically changing the Panel s `Visible` property in response to a button click to show one interface while hiding the other.</span></span>

<span data-ttu-id="1de45-160">花点时间通过浏览器查看进度。</span><span class="sxs-lookup"><span data-stu-id="1de45-160">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="1de45-161">如图5所示，你应该会看到一个 GridView 之上的 "处理产品发货" 按钮，该按钮每次列出产品10个。</span><span class="sxs-lookup"><span data-stu-id="1de45-161">As Figure 5 shows, you should see a Process Product Shipment button above a GridView that lists the products ten at a time.</span></span>

<span data-ttu-id="1de45-162">[![GridView 列出产品并提供排序和分页功能](batch-inserting-vb/_static/image14.png)](batch-inserting-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="1de45-162">[![The GridView Lists the Products and Offers Sorting and Paging Capabilities](batch-inserting-vb/_static/image14.png)](batch-inserting-vb/_static/image13.png)</span></span>

<span data-ttu-id="1de45-163">**图 5**： GridView 列出了产品并提供排序和分页功能（[单击查看完全尺寸的图像](batch-inserting-vb/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="1de45-163">**Figure 5**: The GridView Lists the Products and Offers Sorting and Paging Capabilities ([Click to view full-size image](batch-inserting-vb/_static/image15.png))</span></span>

## <a name="step-2-creating-the-inserting-interface"></a><span data-ttu-id="1de45-164">步骤2：创建插入接口</span><span class="sxs-lookup"><span data-stu-id="1de45-164">Step 2: Creating the Inserting Interface</span></span>

<span data-ttu-id="1de45-165">显示界面完成后，便可以开始创建插入界面了。</span><span class="sxs-lookup"><span data-stu-id="1de45-165">With the display interface complete, we re ready to create the inserting interface.</span></span> <span data-ttu-id="1de45-166">对于本教程，让我们创建一个提示输入单个供应商和类别值的插入界面，然后允许用户输入最多五个产品名称和单位价格值。</span><span class="sxs-lookup"><span data-stu-id="1de45-166">For this tutorial, let s create an inserting interface that prompts for a single supplier and category value and then allows the user to enter up to five product names and unit price values.</span></span> <span data-ttu-id="1de45-167">使用此界面，用户可以添加一个到五个新产品，它们都共享同一类别和供应商，但具有唯一的产品名称和价格。</span><span class="sxs-lookup"><span data-stu-id="1de45-167">With this interface, the user can add one to five new products that all share the same category and supplier, but have unique product names and prices.</span></span>

<span data-ttu-id="1de45-168">首先，将面板从工具箱拖到设计器上，将其放在现有 `DisplayInterface` 面板下。</span><span class="sxs-lookup"><span data-stu-id="1de45-168">Start by dragging a Panel from the Toolbox onto the Designer, placing it beneath the existing `DisplayInterface` Panel.</span></span> <span data-ttu-id="1de45-169">将此新添加的面板的 `ID` 属性设置为 "`InsertingInterface`，并将其 `Visible` 属性设置为" `False`"。</span><span class="sxs-lookup"><span data-stu-id="1de45-169">Set the `ID` property of this newly added Panel to `InsertingInterface` and set its `Visible` property to `False`.</span></span> <span data-ttu-id="1de45-170">我们将添加代码，用于将 `InsertingInterface` Panel s `Visible` 属性设置为步骤3中的 `True`。</span><span class="sxs-lookup"><span data-stu-id="1de45-170">We'll add code that sets the `InsertingInterface` Panel s `Visible` property to `True` in Step 3.</span></span> <span data-ttu-id="1de45-171">同时，请清除面板 `Height` 和 `Width` 属性值。</span><span class="sxs-lookup"><span data-stu-id="1de45-171">Also clear out the Panel s `Height` and `Width` property values.</span></span>

<span data-ttu-id="1de45-172">接下来，我们需要创建图1中显示的插入接口。</span><span class="sxs-lookup"><span data-stu-id="1de45-172">Next, we need to create the inserting interface that was shown back in Figure 1.</span></span> <span data-ttu-id="1de45-173">此接口可通过各种 HTML 技术来创建，但我们将使用相当简单的一种方法：四列七行的表。</span><span class="sxs-lookup"><span data-stu-id="1de45-173">This interface can be created through a variety of HTML techniques, but we will use a fairly straightforward one: a four-column, seven-row table.</span></span>

> [!NOTE]
> <span data-ttu-id="1de45-174">为 HTML `<table>` 元素输入标记时，我更喜欢使用源视图。</span><span class="sxs-lookup"><span data-stu-id="1de45-174">When entering markup for HTML `<table>` elements, I prefer to use the Source view.</span></span> <span data-ttu-id="1de45-175">尽管 Visual Studio 确实包含用于通过设计器添加 `<table>` 元素的工具，但设计器似乎都不愿意向标记中注入 `style` 设置的 unasked。</span><span class="sxs-lookup"><span data-stu-id="1de45-175">While Visual Studio does have tools for adding `<table>` elements through the Designer, the Designer seems all too willing to inject unasked for `style` settings into the markup.</span></span> <span data-ttu-id="1de45-176">创建 `<table>` 标记后，通常会返回到设计器来添加 Web 控件并设置其属性。</span><span class="sxs-lookup"><span data-stu-id="1de45-176">Once I have created the `<table>` markup, I usually return to the Designer to add the Web controls and set their properties.</span></span> <span data-ttu-id="1de45-177">使用预先确定的列和行创建表时，我喜欢使用静态 HTML 而不是[表 web 控件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx)，因为位于表 web 控件中的任何 Web 控件都只能通过 `FindControl("controlID")` 模式进行访问。</span><span class="sxs-lookup"><span data-stu-id="1de45-177">When creating tables with pre-determined columns and rows I prefer using static HTML rather than the [Table Web control](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx) because any Web controls placed within a Table Web control can only be accessed using the `FindControl("controlID")` pattern.</span></span> <span data-ttu-id="1de45-178">不过，我确实要对动态大小的表（其行或列基于某些数据库或用户指定的条件）使用表 Web 控件，因为表 Web 控件可以通过编程方式构造。</span><span class="sxs-lookup"><span data-stu-id="1de45-178">I do, however, use Table Web controls for dynamically-sized tables (ones whose rows or columns are based on some database or user-specified criteria), since the Table Web control can be constructed programmatically.</span></span>

<span data-ttu-id="1de45-179">在 "`InsertingInterface`" 面板的 `<asp:Panel>` 标记中输入以下标记：</span><span class="sxs-lookup"><span data-stu-id="1de45-179">Enter the following markup within the `<asp:Panel>` tags of the `InsertingInterface` Panel:</span></span>

[!code-html[Main](batch-inserting-vb/samples/sample2.html)]

<span data-ttu-id="1de45-180">此 `<table>` 标记尚未包含任何 Web 控件，我们将稍后添加这些控件。</span><span class="sxs-lookup"><span data-stu-id="1de45-180">This `<table>` markup does not include any Web controls yet, we'll add those momentarily.</span></span> <span data-ttu-id="1de45-181">请注意，每个 `<tr>` 元素都包含一个特定 CSS 类设置： `BatchInsertHeaderRow` 用于供应商和类别 DropDownLists 的标题行;`BatchInsertFooterRow`，用于将 "从发货中添加产品" 和 "取消" 按钮的页脚行。和将包含 "产品" 和 "单价" 文本框控件的行的替换 `BatchInsertRow` 和 `BatchInsertAlternatingRow` 值。</span><span class="sxs-lookup"><span data-stu-id="1de45-181">Note that each `<tr>` element contains a particular CSS class setting: `BatchInsertHeaderRow` for the header row where the supplier and category DropDownLists will go; `BatchInsertFooterRow` for the footer row where the Add Products from Shipment and Cancel Buttons will go; and alternating `BatchInsertRow` and `BatchInsertAlternatingRow` values for the rows that will contain the product and unit price TextBox controls.</span></span> <span data-ttu-id="1de45-182">我在 `Styles.css` 文件中创建了相应的 CSS 类，使插入界面的外观类似于我们在本教程中使用的 GridView 和 DetailsView 控件。</span><span class="sxs-lookup"><span data-stu-id="1de45-182">I ve created corresponding CSS classes in the `Styles.css` file to give the inserting interface an appearance similar to the GridView and DetailsView controls we ve used throughout these tutorials.</span></span> <span data-ttu-id="1de45-183">下面显示了这些 CSS 类。</span><span class="sxs-lookup"><span data-stu-id="1de45-183">These CSS classes are shown below.</span></span>

[!code-css[Main](batch-inserting-vb/samples/sample3.css)]

<span data-ttu-id="1de45-184">输入此标记后，返回到设计视图。</span><span class="sxs-lookup"><span data-stu-id="1de45-184">With this markup entered, return to the Design view.</span></span> <span data-ttu-id="1de45-185">此 `<table>` 应在设计器中显示为四列七行的表，如图6所示。</span><span class="sxs-lookup"><span data-stu-id="1de45-185">This `<table>` should show as a four-column, seven-row table in the Designer, as Figure 6 illustrates.</span></span>

<span data-ttu-id="1de45-186">[![插入接口由四列七行的表组成](batch-inserting-vb/_static/image17.png)](batch-inserting-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="1de45-186">[![The Inserting Interface is Composed of a Four-Column, Seven-Row Table](batch-inserting-vb/_static/image17.png)](batch-inserting-vb/_static/image16.png)</span></span>

<span data-ttu-id="1de45-187">**图 6**：插入界面由四列七行表格组成（[单击以查看完全尺寸的图像](batch-inserting-vb/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="1de45-187">**Figure 6**: The Inserting Interface is Composed of a Four-Column, Seven-Row Table ([Click to view full-size image](batch-inserting-vb/_static/image18.png))</span></span>

<span data-ttu-id="1de45-188">现在，我们已准备好将 Web 控件添加到插入接口。</span><span class="sxs-lookup"><span data-stu-id="1de45-188">We re now ready to add the Web controls to the inserting interface.</span></span> <span data-ttu-id="1de45-189">将两个 "DropDownLists" 从 "工具箱" 拖动到表中的相应单元格，一个用于供应商，另一个用于类别。</span><span class="sxs-lookup"><span data-stu-id="1de45-189">Drag two DropDownLists from the Toolbox into the appropriate cells in the table one for the supplier and one for the category.</span></span>

<span data-ttu-id="1de45-190">将 "供应 DropDownList" `ID` 属性设置为 "`Suppliers` 并将其绑定到名为 `SuppliersDataSource`的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="1de45-190">Set the supplier DropDownList s `ID` property to `Suppliers` and bind it to a new ObjectDataSource named `SuppliersDataSource`.</span></span> <span data-ttu-id="1de45-191">配置新 ObjectDataSource 以便从 `SuppliersBLL` 类 `GetSuppliers` 方法检索其数据，并将 "更新" 选项卡 s 下拉列表设置为 "（无）"。</span><span class="sxs-lookup"><span data-stu-id="1de45-191">Configure the new ObjectDataSource to retrieve its data from the `SuppliersBLL` class s `GetSuppliers` method and set the UPDATE tab s drop-down list to (None).</span></span> <span data-ttu-id="1de45-192">单击“完成”按钮以完成向导。</span><span class="sxs-lookup"><span data-stu-id="1de45-192">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="1de45-193">[![将 ObjectDataSource 配置为使用 SuppliersBLL Class s GetSuppliers 方法](batch-inserting-vb/_static/image20.png)](batch-inserting-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="1de45-193">[![Configure the ObjectDataSource to Use the SuppliersBLL Class s GetSuppliers Method](batch-inserting-vb/_static/image20.png)](batch-inserting-vb/_static/image19.png)</span></span>

<span data-ttu-id="1de45-194">**图 7**：将 ObjectDataSource 配置为使用 `SuppliersBLL` 类 `GetSuppliers` 方法（[单击以查看完全大小的映像](batch-inserting-vb/_static/image21.png)）</span><span class="sxs-lookup"><span data-stu-id="1de45-194">**Figure 7**: Configure the ObjectDataSource to Use the `SuppliersBLL` Class s `GetSuppliers` Method ([Click to view full-size image](batch-inserting-vb/_static/image21.png))</span></span>

<span data-ttu-id="1de45-195">让 `Suppliers` DropDownList 显示 `CompanyName` 数据字段，并使用 `SupplierID` 数据字段作为其 `ListItem` 值。</span><span class="sxs-lookup"><span data-stu-id="1de45-195">Have the `Suppliers` DropDownList display the `CompanyName` data field and use the `SupplierID` data field as its `ListItem` s values.</span></span>

<span data-ttu-id="1de45-196">[![显示 "公司名称" 数据字段，并使用供应商作为值](batch-inserting-vb/_static/image23.png)](batch-inserting-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="1de45-196">[![Display the CompanyName Data Field and Use SupplierID as the Value](batch-inserting-vb/_static/image23.png)](batch-inserting-vb/_static/image22.png)</span></span>

<span data-ttu-id="1de45-197">**图 8**：显示 "`CompanyName` 数据" 字段并使用 "`SupplierID`" 作为值（[单击以查看完全大小的图像](batch-inserting-vb/_static/image24.png)）</span><span class="sxs-lookup"><span data-stu-id="1de45-197">**Figure 8**: Display the `CompanyName` Data Field and Use `SupplierID` as the Value ([Click to view full-size image](batch-inserting-vb/_static/image24.png))</span></span>

<span data-ttu-id="1de45-198">将第二个 DropDownList `Categories` 命名为，并将其绑定到名为 `CategoriesDataSource`的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="1de45-198">Name the second DropDownList `Categories` and bind it to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="1de45-199">将 `CategoriesDataSource` ObjectDataSource 配置为使用 `CategoriesBLL` 类 `GetCategories` 方法;将 "更新" 和 "删除" 选项卡中的下拉列表设置为 "（无）"，然后单击 "完成" 以完成向导。</span><span class="sxs-lookup"><span data-stu-id="1de45-199">Configure the `CategoriesDataSource` ObjectDataSource to use the `CategoriesBLL` class s `GetCategories` method; set the drop-down lists in the UPDATE and DELETE tabs to (None) and click Finish to complete the wizard.</span></span> <span data-ttu-id="1de45-200">最后，使 DropDownList 显示 `CategoryName` 数据字段并使用 `CategoryID` 作为值。</span><span class="sxs-lookup"><span data-stu-id="1de45-200">Finally, have the DropDownList display the `CategoryName` data field and use the `CategoryID` as the value.</span></span>

<span data-ttu-id="1de45-201">添加这两个 DropDownLists 并将其绑定到正确配置的 Objectdatasource 后，屏幕应类似于图9。</span><span class="sxs-lookup"><span data-stu-id="1de45-201">After these two DropDownLists have been added and bound to appropriately configured ObjectDataSources, your screen should look similar to Figure 9.</span></span>

<span data-ttu-id="1de45-202">[![标题行现在包含供应商和类别 DropDownLists](batch-inserting-vb/_static/image26.png)](batch-inserting-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="1de45-202">[![The Header Row Now Contains the Suppliers and Categories DropDownLists](batch-inserting-vb/_static/image26.png)](batch-inserting-vb/_static/image25.png)</span></span>

<span data-ttu-id="1de45-203">**图 9**：标题行现在包含 `Suppliers` 和 `Categories` DropDownLists （[单击查看完全大小的图像](batch-inserting-vb/_static/image27.png)）</span><span class="sxs-lookup"><span data-stu-id="1de45-203">**Figure 9**: The Header Row Now Contains the `Suppliers` and `Categories` DropDownLists ([Click to view full-size image](batch-inserting-vb/_static/image27.png))</span></span>

<span data-ttu-id="1de45-204">现在，我们需要创建文本框来收集每个新产品的名称和价格。</span><span class="sxs-lookup"><span data-stu-id="1de45-204">We now need to create the TextBoxes to collect the name and price for each new product.</span></span> <span data-ttu-id="1de45-205">将 "TextBox" 控件从工具箱拖动到五个产品名称和价格行的设计器中。</span><span class="sxs-lookup"><span data-stu-id="1de45-205">Drag a TextBox control from the Toolbox onto the Designer for each of the five product name and price rows.</span></span> <span data-ttu-id="1de45-206">将文本框的 "`ID` 属性设置为 `ProductName1`、`UnitPrice1`、`ProductName2`、`UnitPrice2`、`ProductName3`、`UnitPrice3`等。</span><span class="sxs-lookup"><span data-stu-id="1de45-206">Set the `ID` properties of the TextBoxes to `ProductName1`, `UnitPrice1`, `ProductName2`, `UnitPrice2`, `ProductName3`, `UnitPrice3`, and so on.</span></span>

<span data-ttu-id="1de45-207">在每个 "单价" 文本框后面添加一个 CompareValidator，将 `ControlToValidate` 属性设置为相应的 `ID`。</span><span class="sxs-lookup"><span data-stu-id="1de45-207">Add a CompareValidator after each of the unit price TextBoxes, setting the `ControlToValidate` property to the appropriate `ID`.</span></span> <span data-ttu-id="1de45-208">还将 `Operator` 属性设置为 `GreaterThanEqual`，将 `ValueToCompare` 设置为0，并将 `Type` 设置为 `Currency`。</span><span class="sxs-lookup"><span data-stu-id="1de45-208">Also set the `Operator` property to `GreaterThanEqual`, `ValueToCompare` to 0, and `Type` to `Currency`.</span></span> <span data-ttu-id="1de45-209">这些设置指示 CompareValidator 确保价格（如果输入）是大于或等于零的有效货币值。</span><span class="sxs-lookup"><span data-stu-id="1de45-209">These settings instruct the CompareValidator to ensure that the price, if entered, is a valid currency value that is greater than or equal to zero.</span></span> <span data-ttu-id="1de45-210">将 `Text` 属性设置为 \*，并将 `ErrorMessage` 为价格必须大于或等于零。</span><span class="sxs-lookup"><span data-stu-id="1de45-210">Set the `Text` property to \*, and `ErrorMessage` to The price must be greater than or equal to zero.</span></span> <span data-ttu-id="1de45-211">此外，请省略任何货币符号。</span><span class="sxs-lookup"><span data-stu-id="1de45-211">Also, please omit any currency symbols.</span></span>

> [!NOTE]
> <span data-ttu-id="1de45-212">即使 `Products` 数据库表中的 `ProductName` 字段不允许 `NULL` 值，插入接口也不包含任何 RequiredFieldValidator 控件。</span><span class="sxs-lookup"><span data-stu-id="1de45-212">The inserting interface does not include any RequiredFieldValidator controls, even though the `ProductName` field in the `Products` database table does not allow `NULL` values.</span></span> <span data-ttu-id="1de45-213">这是因为我们希望让用户输入最多五个产品。</span><span class="sxs-lookup"><span data-stu-id="1de45-213">This is because we want to let the user enter up to five products.</span></span> <span data-ttu-id="1de45-214">例如，如果用户要为前三行提供产品名称和单价，将最后两行保留为空白，则 d 只需将三个新产品添加到系统。</span><span class="sxs-lookup"><span data-stu-id="1de45-214">For example, if the user were to provide the product name and unit price for the first three rows, leaving the last two rows blank, we d just add three new products to the system.</span></span> <span data-ttu-id="1de45-215">由于 `ProductName` 是必需的，因此，我们需要以编程方式进行检查，以确保在输入单价时是否提供了相应的产品名称值。</span><span class="sxs-lookup"><span data-stu-id="1de45-215">Since `ProductName` is required, however, we will need to programmatically check to ensure that if a unit price is entered that a corresponding product name value is provided.</span></span> <span data-ttu-id="1de45-216">我们将在步骤4中解决此项检查。</span><span class="sxs-lookup"><span data-stu-id="1de45-216">We'll tackle this check in Step 4.</span></span>

<span data-ttu-id="1de45-217">当验证用户的输入时，如果值包含货币符号，CompareValidator 将报告无效数据。</span><span class="sxs-lookup"><span data-stu-id="1de45-217">When validating the user s input, the CompareValidator reports invalid data if the value contains a currency symbol.</span></span> <span data-ttu-id="1de45-218">在每个单位价格文本框的前面添加一个 $，作为视觉提示，指示用户在输入价格时省略货币符号。</span><span class="sxs-lookup"><span data-stu-id="1de45-218">Add a $ in front of each of the unit price TextBoxes to serve as a visual cue that instructs the user to omit the currency symbol when entering the price.</span></span>

<span data-ttu-id="1de45-219">最后，在 `InsertingInterface` 面板中添加 ValidationSummary 控件，将其 `ShowMessageBox` 属性设置为 `True`，并将其 `ShowSummary` 属性设置为 `False`。</span><span class="sxs-lookup"><span data-stu-id="1de45-219">Lastly, add a ValidationSummary control within the `InsertingInterface` Panel, settings its `ShowMessageBox` property to `True` and its `ShowSummary` property to `False`.</span></span> <span data-ttu-id="1de45-220">使用这些设置时，如果用户输入的单位价格值无效，则会在有问题的 TextBox 控件旁显示一个星号，ValidationSummary 将显示一个客户端 messagebox，其中显示了我们前面指定的错误消息。</span><span class="sxs-lookup"><span data-stu-id="1de45-220">With these settings, if the user enters an invalid unit price value, an asterisk will appear next to the offending TextBox controls and the ValidationSummary will display a client-side messagebox that shows the error message we specified earlier.</span></span>

<span data-ttu-id="1de45-221">此时，屏幕应类似于图10所示。</span><span class="sxs-lookup"><span data-stu-id="1de45-221">At this point, your screen should look similar to Figure 10.</span></span>

<span data-ttu-id="1de45-222">[![插入接口现在包含产品名称和价格的文本框](batch-inserting-vb/_static/image29.png)](batch-inserting-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="1de45-222">[![The Inserting Interface Now Includes TextBoxes for the Products Names and Prices](batch-inserting-vb/_static/image29.png)](batch-inserting-vb/_static/image28.png)</span></span>

<span data-ttu-id="1de45-223">**图 10**：插入接口现在包含产品名称和价格的文本框（[单击查看全尺寸图像](batch-inserting-vb/_static/image30.png)）</span><span class="sxs-lookup"><span data-stu-id="1de45-223">**Figure 10**: The Inserting Interface Now Includes TextBoxes for the Products Names and Prices ([Click to view full-size image](batch-inserting-vb/_static/image30.png))</span></span>

<span data-ttu-id="1de45-224">接下来，我们需要将 "从发货中添加产品" 和 "取消" 按钮添加到 "页脚" 行。</span><span class="sxs-lookup"><span data-stu-id="1de45-224">Next we need to add the Add Products from Shipment and Cancel buttons to the footer row.</span></span> <span data-ttu-id="1de45-225">将两个按钮控件从工具箱拖放到插入界面的页脚中，将按钮 `ID` 属性设置为 `AddProducts` 并 `CancelButton` 和 `Text` 属性分别添加产品和取消。</span><span class="sxs-lookup"><span data-stu-id="1de45-225">Drag two Button controls from the Toolbox into the footer of the inserting interface, setting the Buttons `ID` properties to `AddProducts` and `CancelButton` and `Text` properties to Add Products from Shipment and Cancel, respectively.</span></span> <span data-ttu-id="1de45-226">此外，将 `CancelButton` 控件 `CausesValidation` 属性设置为 "`false`"。</span><span class="sxs-lookup"><span data-stu-id="1de45-226">In addition, set the `CancelButton` control s `CausesValidation` property to `false`.</span></span>

<span data-ttu-id="1de45-227">最后，我们需要添加一个标签 Web 控件，该控件将显示这两个接口的状态消息。</span><span class="sxs-lookup"><span data-stu-id="1de45-227">Finally, we need to add a Label Web control that will display status messages for the two interfaces.</span></span> <span data-ttu-id="1de45-228">例如，当用户成功添加产品的新发货时，我们希望返回到显示界面并显示一条确认消息。</span><span class="sxs-lookup"><span data-stu-id="1de45-228">For example, when a user successfully adds a new shipment of products, we want to return to the display interface and display a confirmation message.</span></span> <span data-ttu-id="1de45-229">但是，如果用户为新产品提供价格，但保留产品名称，则需要显示一条警告消息，因为 "`ProductName`" 字段是必填字段。</span><span class="sxs-lookup"><span data-stu-id="1de45-229">If, however, the user provides a price for a new product but leaves off the product name, we need to display a warning message since the `ProductName` field is required.</span></span> <span data-ttu-id="1de45-230">由于我们需要为这两个接口显示此消息，因此将其放置在面板外的页面顶部。</span><span class="sxs-lookup"><span data-stu-id="1de45-230">Since we need this message to display for both interfaces, place it at the top of the page outside of the Panels.</span></span>

<span data-ttu-id="1de45-231">将 "标签" Web 控件从工具箱拖动到设计器中页面的顶部。</span><span class="sxs-lookup"><span data-stu-id="1de45-231">Drag a Label Web control from the Toolbox to the top of the page in the Designer.</span></span> <span data-ttu-id="1de45-232">将 `ID` 属性设置为 `StatusLabel`，清除 `Text` 属性，并将 `Visible` 和 `EnableViewState` 属性设置为 `False`。</span><span class="sxs-lookup"><span data-stu-id="1de45-232">Set the `ID` property to `StatusLabel`, clear out the `Text` property, and set the `Visible` and `EnableViewState` properties to `False`.</span></span> <span data-ttu-id="1de45-233">如前面的教程中所示，将 `EnableViewState` 属性设置为 "`False` 使我们能够以编程方式更改标签的属性值并使其在后续回发中自动还原为默认值。</span><span class="sxs-lookup"><span data-stu-id="1de45-233">As we have seen in previous tutorials, setting the `EnableViewState` property to `False` allows us to programmatically change the Label s property values and have them automatically revert back to their defaults on the subsequent postback.</span></span> <span data-ttu-id="1de45-234">这样可以简化显示状态消息的代码，以响应在后续回发中消失的某些用户操作。</span><span class="sxs-lookup"><span data-stu-id="1de45-234">This simplifies the code for showing a status message in response to some user action that disappears on the subsequent postback.</span></span> <span data-ttu-id="1de45-235">最后，将 `StatusLabel` 控件 `CssClass` 属性设置为 "警告"，这是在 `Styles.css` 中定义的 CSS 类的名称，以大、斜体、粗体、红色字体显示文本。</span><span class="sxs-lookup"><span data-stu-id="1de45-235">Finally, set the `StatusLabel` control s `CssClass` property to Warning, which is the name of a CSS class defined in `Styles.css` that displays text in a large, italic, bold, red font.</span></span>

<span data-ttu-id="1de45-236">图11显示了在添加和配置标签之后的 Visual Studio 设计器。</span><span class="sxs-lookup"><span data-stu-id="1de45-236">Figure 11 shows the Visual Studio Designer after the Label has been added and configured.</span></span>

<span data-ttu-id="1de45-237">[![将 Statuslabel 设置控件放在两个面板控件上](batch-inserting-vb/_static/image32.png)](batch-inserting-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="1de45-237">[![Place the StatusLabel Control Above the Two Panel Controls](batch-inserting-vb/_static/image32.png)](batch-inserting-vb/_static/image31.png)</span></span>

<span data-ttu-id="1de45-238">**图 11**：将 `StatusLabel` 控件放在两个面板控件上（[单击以查看完全大小的图像](batch-inserting-vb/_static/image33.png)）</span><span class="sxs-lookup"><span data-stu-id="1de45-238">**Figure 11**: Place the `StatusLabel` Control Above the Two Panel Controls ([Click to view full-size image](batch-inserting-vb/_static/image33.png))</span></span>

## <a name="step-3-switching-between-the-display-and-inserting-interfaces"></a><span data-ttu-id="1de45-239">步骤3：在显示和插入接口之间切换</span><span class="sxs-lookup"><span data-stu-id="1de45-239">Step 3: Switching Between the Display and Inserting Interfaces</span></span>

<span data-ttu-id="1de45-240">此时，我们已经完成了显示和插入界面的标记，但仍保留了两个任务：</span><span class="sxs-lookup"><span data-stu-id="1de45-240">At this point we have completed the markup for our display and inserting interfaces, but we re still left with two tasks:</span></span>

- <span data-ttu-id="1de45-241">在显示和插入接口之间切换</span><span class="sxs-lookup"><span data-stu-id="1de45-241">Switching between the display and inserting interfaces</span></span>
- <span data-ttu-id="1de45-242">将装运中的产品添加到数据库</span><span class="sxs-lookup"><span data-stu-id="1de45-242">Adding the products in the shipment to the database</span></span>

<span data-ttu-id="1de45-243">当前，显示界面可见，但插入界面处于隐藏状态。</span><span class="sxs-lookup"><span data-stu-id="1de45-243">Currently, the display interface is visible but the inserting interface is hidden.</span></span> <span data-ttu-id="1de45-244">这是因为 `DisplayInterface` 面板 s `Visible` 属性设置为 `True` （默认值），而 `InsertingInterface` Panel `Visible` 属性设置为 `False`。</span><span class="sxs-lookup"><span data-stu-id="1de45-244">This is because the `DisplayInterface` Panel s `Visible` property is set to `True` (the default value), while the `InsertingInterface` Panel s `Visible` property is set to `False`.</span></span> <span data-ttu-id="1de45-245">若要在两个接口之间切换，只需将每个控件 `Visible` 属性值。</span><span class="sxs-lookup"><span data-stu-id="1de45-245">To switch between the two interfaces we simply need to toggle each control s `Visible` property value.</span></span>

<span data-ttu-id="1de45-246">当单击 "处理产品发货" 按钮时，我们希望从显示界面移到插入接口。</span><span class="sxs-lookup"><span data-stu-id="1de45-246">We want to move from the display interface to the inserting interface when the Process Product Shipment button is clicked.</span></span> <span data-ttu-id="1de45-247">因此，请为此按钮 `Click` 包含以下代码的事件创建一个事件处理程序：</span><span class="sxs-lookup"><span data-stu-id="1de45-247">Therefore, create an event handler for this Button s `Click` event that contains the following code:</span></span>

[!code-vb[Main](batch-inserting-vb/samples/sample4.vb)]

<span data-ttu-id="1de45-248">此代码只需隐藏 `DisplayInterface` 面板并显示 `InsertingInterface` 面板。</span><span class="sxs-lookup"><span data-stu-id="1de45-248">This code simply hides the `DisplayInterface` Panel and shows the `InsertingInterface` Panel.</span></span>

<span data-ttu-id="1de45-249">接下来，为 "从发货中添加产品" 和 "取消" 按钮控件创建事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="1de45-249">Next, create event handlers for the Add Products from Shipment and Cancel Button controls in the inserting interface.</span></span> <span data-ttu-id="1de45-250">单击其中任一按钮时，需要恢复到显示界面。</span><span class="sxs-lookup"><span data-stu-id="1de45-250">When either of these Buttons is clicked, we need to revert back to the display interface.</span></span> <span data-ttu-id="1de45-251">为这两个按钮控件创建 `Click` 事件处理程序，以便它们调用 `ReturnToDisplayInterface`，这是一种暂时要添加的方法。</span><span class="sxs-lookup"><span data-stu-id="1de45-251">Create `Click` event handlers for both Button controls so that they call `ReturnToDisplayInterface`, a method we will add momentarily.</span></span> <span data-ttu-id="1de45-252">除了隐藏 `InsertingInterface` 面板并显示 `DisplayInterface` 面板外，`ReturnToDisplayInterface` 方法还需要将 Web 控件返回到其预编辑状态。</span><span class="sxs-lookup"><span data-stu-id="1de45-252">In addition to hiding the `InsertingInterface` Panel and showing the `DisplayInterface` Panel, the `ReturnToDisplayInterface` method needs to return the Web controls to their pre-editing state.</span></span> <span data-ttu-id="1de45-253">这涉及到将 DropDownLists `SelectedIndex` 属性设置为0并清除 TextBox 控件的 `Text` 属性。</span><span class="sxs-lookup"><span data-stu-id="1de45-253">This involves setting the DropDownLists `SelectedIndex` properties to 0 and clearing out the `Text` properties of the TextBox controls.</span></span>

> [!NOTE]
> <span data-ttu-id="1de45-254">如果在返回到显示界面之前未将控件返回到其预编辑状态，请考虑可能会发生的情况。</span><span class="sxs-lookup"><span data-stu-id="1de45-254">Consider what might happen if we didn't return the controls to their pre-editing state before returning to the display interface.</span></span> <span data-ttu-id="1de45-255">用户可以单击 "处理产品发货" 按钮，输入装运中的产品，然后单击 "从发货中添加产品"。</span><span class="sxs-lookup"><span data-stu-id="1de45-255">A user might click the Process Product Shipment button, enter the products from the shipment, and then click Add Products from Shipment.</span></span> <span data-ttu-id="1de45-256">这会添加产品并将用户返回到显示界面。</span><span class="sxs-lookup"><span data-stu-id="1de45-256">This would add the products and return the user to the display interface.</span></span> <span data-ttu-id="1de45-257">此时，用户可能想要添加另一个发货。</span><span class="sxs-lookup"><span data-stu-id="1de45-257">At this point the user might want to add another shipment.</span></span> <span data-ttu-id="1de45-258">单击 "处理产品发货" 按钮后，它们将返回到插入界面，但 DropDownList 选择和文本框值仍将填充其以前的值。</span><span class="sxs-lookup"><span data-stu-id="1de45-258">Upon clicking the Process Product Shipment button they would return to the inserting interface but the DropDownList selections and TextBox values would still be populated with their previous values.</span></span>

[!code-vb[Main](batch-inserting-vb/samples/sample5.vb)]

<span data-ttu-id="1de45-259">`Click` 事件处理程序只需调用 `ReturnToDisplayInterface` 方法，但我们将返回到步骤4中的 "从发货中添加产品" `Click` 事件处理程序并添加代码以保存产品。</span><span class="sxs-lookup"><span data-stu-id="1de45-259">Both `Click` event handlers simply call the `ReturnToDisplayInterface` method, although we'll return to the Add Products from Shipment `Click` event handler in Step 4 and add code to save the products.</span></span> <span data-ttu-id="1de45-260">`ReturnToDisplayInterface` 首先将 `Suppliers` 并 `Categories` DropDownLists 返回到它们的第一个选项。</span><span class="sxs-lookup"><span data-stu-id="1de45-260">`ReturnToDisplayInterface` starts by returning the `Suppliers` and `Categories` DropDownLists to their first options.</span></span> <span data-ttu-id="1de45-261">这两个常量 `firstControlID` 和 `lastControlID` 标记插入界面中的 "产品名称" 和 "单价" 文本框中使用的起始和结束控件索引值，并用于将 TextBox 控件的 `Text` 属性设置回空字符串的 `For` 循环的界限。</span><span class="sxs-lookup"><span data-stu-id="1de45-261">The two constants `firstControlID` and `lastControlID` mark the starting and ending control index values used in naming the product name and unit price TextBoxes in the inserting interface and are used in the bounds of the `For` loop that sets the `Text` properties of the TextBox controls back to an empty string.</span></span> <span data-ttu-id="1de45-262">最后，将重置面板 `Visible` 属性，以便隐藏插入界面并显示显示界面。</span><span class="sxs-lookup"><span data-stu-id="1de45-262">Finally, the Panels `Visible` properties are reset so that the inserting interface is hidden and the display interface shown.</span></span>

<span data-ttu-id="1de45-263">请花点时间在浏览器中测试此页。</span><span class="sxs-lookup"><span data-stu-id="1de45-263">Take a moment to test out this page in a browser.</span></span> <span data-ttu-id="1de45-264">第一次访问该页面时，应会看到显示界面，如图5所示。</span><span class="sxs-lookup"><span data-stu-id="1de45-264">When first visiting the page you should see the display interface as was shown in Figure 5.</span></span> <span data-ttu-id="1de45-265">单击 "处理产品发货" 按钮。</span><span class="sxs-lookup"><span data-stu-id="1de45-265">Click the Process Product Shipment button.</span></span> <span data-ttu-id="1de45-266">页面将回发，此时应会看到插入界面，如图12所示。</span><span class="sxs-lookup"><span data-stu-id="1de45-266">The page will postback and you should now see the inserting interface as shown in Figure 12.</span></span> <span data-ttu-id="1de45-267">单击 "从发货中添加产品" 或 "取消" 按钮会将您返回到显示界面。</span><span class="sxs-lookup"><span data-stu-id="1de45-267">Clicking either the Add Products from Shipment or Cancel buttons returns you to the display interface.</span></span>

> [!NOTE]
> <span data-ttu-id="1de45-268">查看插入界面时，请花点时间来测试 "单价" 文本框中的 CompareValidators。</span><span class="sxs-lookup"><span data-stu-id="1de45-268">While viewing the inserting interface, take a moment to test out the CompareValidators on the unit price TextBoxes.</span></span> <span data-ttu-id="1de45-269">单击 "从发货中添加产品" 按钮时，如果货币值无效或价格值小于零，你应该会看到客户端 messagebox 警告。</span><span class="sxs-lookup"><span data-stu-id="1de45-269">You should see a client-side messagebox warning when clicking the Add Products from Shipment button with invalid currency values or prices with a value less than zero.</span></span>

<span data-ttu-id="1de45-270">[单击 "处理产品发货" 按钮后，将显示插入界面 ![](batch-inserting-vb/_static/image35.png)](batch-inserting-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="1de45-270">[![The Inserting Interface is Displayed After Clicking the Process Product Shipment Button](batch-inserting-vb/_static/image35.png)](batch-inserting-vb/_static/image34.png)</span></span>

<span data-ttu-id="1de45-271">**图 12**：单击 "处理产品发货" 按钮后显示插入界面（[单击以查看完全尺寸的图像](batch-inserting-vb/_static/image36.png)）</span><span class="sxs-lookup"><span data-stu-id="1de45-271">**Figure 12**: The Inserting Interface is Displayed After Clicking the Process Product Shipment Button ([Click to view full-size image](batch-inserting-vb/_static/image36.png))</span></span>

## <a name="step-4-adding-the-products"></a><span data-ttu-id="1de45-272">步骤4：添加产品</span><span class="sxs-lookup"><span data-stu-id="1de45-272">Step 4: Adding the Products</span></span>

<span data-ttu-id="1de45-273">本教程剩下的全部工作就是在 "从发货中添加产品" 按钮 `Click` 事件处理程序将产品保存到数据库。</span><span class="sxs-lookup"><span data-stu-id="1de45-273">All that remains for this tutorial is to save the products to the database in the Add Products from Shipment Button s `Click` event handler.</span></span> <span data-ttu-id="1de45-274">为此，可以创建 `ProductsDataTable`，并为提供的每个产品名称添加 `ProductsRow` 实例。</span><span class="sxs-lookup"><span data-stu-id="1de45-274">This can be accomplished by creating a `ProductsDataTable` and adding a `ProductsRow` instance for each of the product names supplied.</span></span> <span data-ttu-id="1de45-275">添加这些 `ProductsRow` 后，我们将在 `ProductsDataTable`中调用 `ProductsBLL` 类 `UpdateWithTransaction` 方法。</span><span class="sxs-lookup"><span data-stu-id="1de45-275">Once these `ProductsRow` s have been added we will make a call to the `ProductsBLL` class s `UpdateWithTransaction` method passing in the `ProductsDataTable`.</span></span> <span data-ttu-id="1de45-276">回忆一下，在[事务教程内的包装数据库修改](wrapping-database-modifications-within-a-transaction-vb.md)中创建的 `UpdateWithTransaction` 方法将 `ProductsDataTable` 传递到 `ProductsTableAdapter`的 `UpdateWithTransaction` 方法。</span><span class="sxs-lookup"><span data-stu-id="1de45-276">Recall that the `UpdateWithTransaction` method, which was created back in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-vb.md) tutorial, passes the `ProductsDataTable` to the `ProductsTableAdapter`'s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="1de45-277">在该数据库中，将启动 ADO.NET 事务，并且对于 DataTable 中添加的每个 `ProductsRow`，TableAdapter 向数据库发出 `INSERT` 语句。</span><span class="sxs-lookup"><span data-stu-id="1de45-277">From there, an ADO.NET transaction is started and the TableAdapter issues an `INSERT` statement to the database for each added `ProductsRow` in the DataTable.</span></span> <span data-ttu-id="1de45-278">假设所有产品都已添加但未发生错误，则提交事务，否则回滚事务。</span><span class="sxs-lookup"><span data-stu-id="1de45-278">Assuming all products are added without error, the transaction is committed, otherwise it is rolled back.</span></span>

<span data-ttu-id="1de45-279">"从发货中添加产品" 按钮的代码 `Click` 事件处理程序还需要执行一些错误检查。</span><span class="sxs-lookup"><span data-stu-id="1de45-279">The code for the Add Products from Shipment Button s `Click` event handler also needs to perform a bit of error checking.</span></span> <span data-ttu-id="1de45-280">由于插入界面中没有使用 RequiredFieldValidators，用户可以输入产品的价格，同时省略其名称。</span><span class="sxs-lookup"><span data-stu-id="1de45-280">Since there are no RequiredFieldValidators used in the inserting interface, a user could enter a price for a product while omitting its name.</span></span> <span data-ttu-id="1de45-281">由于产品名称是必需的，因此，如果这种情况将，我们需要提醒用户，而不是继续插入操作。</span><span class="sxs-lookup"><span data-stu-id="1de45-281">Since the product s name is required, if such a condition unfolds we need to alert the user and not proceed with the inserts.</span></span> <span data-ttu-id="1de45-282">完整的 `Click` 事件处理程序代码如下：</span><span class="sxs-lookup"><span data-stu-id="1de45-282">The complete `Click` event handler code follows:</span></span>

[!code-vb[Main](batch-inserting-vb/samples/sample6.vb)]

<span data-ttu-id="1de45-283">此事件处理程序首先确保 `Page.IsValid` 属性返回值为 `True`。</span><span class="sxs-lookup"><span data-stu-id="1de45-283">The event handler starts by ensuring that the `Page.IsValid` property returns a value of `True`.</span></span> <span data-ttu-id="1de45-284">如果它返回 `False`，则表示一个或多个 CompareValidators 报告的数据无效;在这种情况下，我们不想尝试插入输入的产品，或者我们在尝试将用户输入的单位价格值分配到 `ProductsRow` s `UnitPrice` 属性时，将会出现异常。</span><span class="sxs-lookup"><span data-stu-id="1de45-284">If it returns `False`, then that means one or more of the CompareValidators are reporting invalid data; in such a case we do not want to attempt to insert the entered products or we'll end up with an exception when attempting to assign the user-entered unit price value to the `ProductsRow` s `UnitPrice` property.</span></span>

<span data-ttu-id="1de45-285">接下来，将创建一个新的 `ProductsDataTable` 实例（`products`）。</span><span class="sxs-lookup"><span data-stu-id="1de45-285">Next, a new `ProductsDataTable` instance is created (`products`).</span></span> <span data-ttu-id="1de45-286">`For` 循环用于循环访问 "产品名称" 和 "单价" 文本框，`Text` 属性读入本地变量 `productName` 和 `unitPrice`。</span><span class="sxs-lookup"><span data-stu-id="1de45-286">A `For` loop is used to iterate through the product name and unit price TextBoxes and the `Text` properties are read into the local variables `productName` and `unitPrice`.</span></span> <span data-ttu-id="1de45-287">如果用户输入了单位价格的值而不是对应的产品名称，则 `StatusLabel` 将显示该消息。如果你提供单位价格，还必须包含产品的名称，并且事件处理程序将退出。</span><span class="sxs-lookup"><span data-stu-id="1de45-287">If the user has entered a value for the unit price but not for the corresponding product name, the `StatusLabel` displays the message If you provide a unit price you must also include the name of the product and the event handler is exited.</span></span>

<span data-ttu-id="1de45-288">如果提供了产品名称，则会使用 `ProductsDataTable` s `NewProductsRow` 方法创建新的 `ProductsRow` 实例。</span><span class="sxs-lookup"><span data-stu-id="1de45-288">If a product name has been provided, a new `ProductsRow` instance is created using the `ProductsDataTable` s `NewProductsRow` method.</span></span> <span data-ttu-id="1de45-289">此新 `ProductsRow` 实例 s `ProductName` 属性设置为 "当前产品名称" 文本框，同时 `SupplierID` 和 `CategoryID` 属性分配给插入接口 "标头中 DropDownLists 的" `SelectedValue` 属性 "。</span><span class="sxs-lookup"><span data-stu-id="1de45-289">This new `ProductsRow` instance s `ProductName` property is set to the current product name TextBox while the `SupplierID` and `CategoryID` properties are assigned to the `SelectedValue` properties of the DropDownLists in the inserting interface s header.</span></span> <span data-ttu-id="1de45-290">如果用户为产品价格输入了值，则会将其分配给 `ProductsRow` 实例的 `UnitPrice` 属性;否则，该属性将为空，这将导致数据库中的 `UnitPrice` `NULL` 值。</span><span class="sxs-lookup"><span data-stu-id="1de45-290">If the user entered a value for the product s price, it is assigned to the `ProductsRow` instance s `UnitPrice` property; otherwise, the property is left unassigned, which will result in a `NULL` value for `UnitPrice` in the database.</span></span> <span data-ttu-id="1de45-291">最后，`Discontinued` 和 `UnitsOnOrder` 属性分别分配给硬编码值 `False` 和0。</span><span class="sxs-lookup"><span data-stu-id="1de45-291">Finally, the `Discontinued` and `UnitsOnOrder` properties are assigned to the hard-coded values `False` and 0, respectively.</span></span>

<span data-ttu-id="1de45-292">将属性分配到 `ProductsRow` 实例后，将其添加到 `ProductsDataTable`中。</span><span class="sxs-lookup"><span data-stu-id="1de45-292">After the properties have been assigned to the `ProductsRow` instance it is added to the `ProductsDataTable`.</span></span>

<span data-ttu-id="1de45-293">完成 `For` 循环后，我们将检查是否添加了任何产品。</span><span class="sxs-lookup"><span data-stu-id="1de45-293">At the completion of the `For` loop, we check whether any products have been added.</span></span> <span data-ttu-id="1de45-294">毕竟，用户可能在输入任何产品名称或价格之前单击了 "从发货中添加产品"。</span><span class="sxs-lookup"><span data-stu-id="1de45-294">The user may, after all, have clicked the Add Products from Shipment before entering any product names or prices.</span></span> <span data-ttu-id="1de45-295">如果 `ProductsDataTable`中至少有一个产品，将调用 `ProductsBLL` 类 `UpdateWithTransaction` 方法。</span><span class="sxs-lookup"><span data-stu-id="1de45-295">If there is at least one product in the `ProductsDataTable`, the `ProductsBLL` class s `UpdateWithTransaction` method is called.</span></span> <span data-ttu-id="1de45-296">接下来，将数据重新绑定到 `ProductsGrid` GridView，以便新添加的产品将显示在显示界面中。</span><span class="sxs-lookup"><span data-stu-id="1de45-296">Next, the data is rebound to the `ProductsGrid` GridView so that the newly added products will appear in the display interface.</span></span> <span data-ttu-id="1de45-297">更新 `StatusLabel` 以显示确认消息，并调用 `ReturnToDisplayInterface`，隐藏插入界面并显示显示界面。</span><span class="sxs-lookup"><span data-stu-id="1de45-297">The `StatusLabel` is updated to display a confirmation message and the `ReturnToDisplayInterface` is invoked, hiding the inserting interface and showing the display interface.</span></span>

<span data-ttu-id="1de45-298">如果未输入任何产品，插入界面会保持显示，但不会添加消息。</span><span class="sxs-lookup"><span data-stu-id="1de45-298">If no products were entered, the inserting interface remains displayed but the message No products were added.</span></span> <span data-ttu-id="1de45-299">请在显示的文本框中输入产品名称和单价。</span><span class="sxs-lookup"><span data-stu-id="1de45-299">Please enter the product names and unit prices in the textboxes is displayed.</span></span>

<span data-ttu-id="1de45-300">图 s 13、14和15显示了操作中的插入和显示接口。</span><span class="sxs-lookup"><span data-stu-id="1de45-300">Figure s 13, 14, and 15 show the inserting and display interfaces in action.</span></span> <span data-ttu-id="1de45-301">在图13中，用户输入的单位价格值没有相应的产品名称。</span><span class="sxs-lookup"><span data-stu-id="1de45-301">In Figure 13, the user has entered a unit price value without a corresponding product name.</span></span> <span data-ttu-id="1de45-302">图14显示了三个新产品成功添加后的显示界面，而图15显示了 GridView 中新添加的两个产品（第三个产品在上一页上）。</span><span class="sxs-lookup"><span data-stu-id="1de45-302">Figure 14 shows the display interface after three new products have been added successfully, while Figure 15 shows two of the newly added products in the GridView (the third one is on the previous page).</span></span>

<span data-ttu-id="1de45-303">[输入单位价格时，需要 ![产品名称](batch-inserting-vb/_static/image38.png)](batch-inserting-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="1de45-303">[![A Product Name is Required When Entering a Unit Price](batch-inserting-vb/_static/image38.png)](batch-inserting-vb/_static/image37.png)</span></span>

<span data-ttu-id="1de45-304">**图 13**：输入单位价格时需要产品名称（[单击查看全尺寸图像](batch-inserting-vb/_static/image39.png)）</span><span class="sxs-lookup"><span data-stu-id="1de45-304">**Figure 13**: A Product Name is Required When Entering a Unit Price ([Click to view full-size image](batch-inserting-vb/_static/image39.png))</span></span>

<span data-ttu-id="1de45-305">[已为供应商 Mayumi 添加了 ![三个新的 Veggies](batch-inserting-vb/_static/image41.png)](batch-inserting-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="1de45-305">[![Three New Veggies Have Been Added for the Supplier Mayumi s](batch-inserting-vb/_static/image41.png)](batch-inserting-vb/_static/image40.png)</span></span>

<span data-ttu-id="1de45-306">**图 14**：为供应商 Mayumi 添加了三个新的 Veggies （[单击查看完全尺寸的图像](batch-inserting-vb/_static/image42.png)）</span><span class="sxs-lookup"><span data-stu-id="1de45-306">**Figure 14**: Three New Veggies Have Been Added for the Supplier Mayumi s ([Click to view full-size image](batch-inserting-vb/_static/image42.png))</span></span>

<span data-ttu-id="1de45-307">[![可以在 GridView 的最后一页中找到新的产品](batch-inserting-vb/_static/image44.png)](batch-inserting-vb/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="1de45-307">[![The New Products Can Be Found in the Last Page of the GridView](batch-inserting-vb/_static/image44.png)](batch-inserting-vb/_static/image43.png)</span></span>

<span data-ttu-id="1de45-308">**图 15**：新产品可在 GridView 的最后一页中找到（[单击以查看完全大小的图像](batch-inserting-vb/_static/image45.png)）</span><span class="sxs-lookup"><span data-stu-id="1de45-308">**Figure 15**: The New Products Can Be Found in the Last Page of the GridView ([Click to view full-size image](batch-inserting-vb/_static/image45.png))</span></span>

> [!NOTE]
> <span data-ttu-id="1de45-309">本教程中使用的批插入逻辑将在事务范围内进行插入。</span><span class="sxs-lookup"><span data-stu-id="1de45-309">The batch inserting logic used in this tutorial wraps the inserts within the scope of transaction.</span></span> <span data-ttu-id="1de45-310">若要验证这一点，有意会引入数据库级别的错误。</span><span class="sxs-lookup"><span data-stu-id="1de45-310">To verify this, purposefully introduce a database-level error.</span></span> <span data-ttu-id="1de45-311">例如，不是将新的 `ProductsRow` 实例的 `CategoryID` 属性分配到 `Categories` DropDownList 中的选定值，而是将其分配给 `i * 5`之类的值。</span><span class="sxs-lookup"><span data-stu-id="1de45-311">For example, rather than assigning the new `ProductsRow` instance s `CategoryID` property to the selected value in the `Categories` DropDownList, assign it to a value like `i * 5`.</span></span> <span data-ttu-id="1de45-312">此处 `i` 为循环索引器，其值范围从1到5。</span><span class="sxs-lookup"><span data-stu-id="1de45-312">Here `i` is the loop indexer and has values ranging from 1 to 5.</span></span> <span data-ttu-id="1de45-313">因此，在批插入中添加两个或更多产品时，第一个产品将具有有效的 `CategoryID` 值（5），但后面的产品将具有与 `Categories` 表中的 `CategoryID` 值不匹配的 `CategoryID` 值。</span><span class="sxs-lookup"><span data-stu-id="1de45-313">Therefore, when adding two or more products in batch insert the first product will have a valid `CategoryID` value (5), but subsequent products will have `CategoryID` values that do not match up to `CategoryID` values in the `Categories` table.</span></span> <span data-ttu-id="1de45-314">实际效果是，在第一次 `INSERT` 成功后，后续的将失败，并出现外键约束冲突。</span><span class="sxs-lookup"><span data-stu-id="1de45-314">The net effect is that while the first `INSERT` will succeed, subsequent ones will fail with a foreign key constraint violation.</span></span> <span data-ttu-id="1de45-315">由于批处理插入是原子的，因此第一个 `INSERT` 会回滚，并将数据库返回到批处理插入进程开始之前的状态。</span><span class="sxs-lookup"><span data-stu-id="1de45-315">Since the batch insert is atomic, the first `INSERT` will be rolled back, returning the database to its state before the batch insert process began.</span></span>

## <a name="summary"></a><span data-ttu-id="1de45-316">总结</span><span class="sxs-lookup"><span data-stu-id="1de45-316">Summary</span></span>

<span data-ttu-id="1de45-317">在此过程中，我们创建了允许更新、删除和插入批处理数据的接口，所有这些数据都使用我们在事务教程中的[包装数据库修改](wrapping-database-modifications-within-a-transaction-vb.md)中添加到数据访问层的事务支持。</span><span class="sxs-lookup"><span data-stu-id="1de45-317">Over this and the previous two tutorials we have created interfaces that allow for updating, deleting, and inserting batches of data, all of which used the transaction support we added to the Data Access Layer in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-vb.md) tutorial.</span></span> <span data-ttu-id="1de45-318">在某些情况下，此类批处理用户界面可通过减少点击次数、回发和键盘到鼠标的上下文切换，同时保持基础数据的完整性，从而极大地提高最终用户的工作效率。</span><span class="sxs-lookup"><span data-stu-id="1de45-318">For certain scenarios, such batch processing user interfaces greatly improve end user efficiency by cutting down on the number of clicks, postbacks, and keyboard-to-mouse context switches, while also maintaining the integrity of the underlying data.</span></span>

<span data-ttu-id="1de45-319">本教程将介绍如何使用批处理数据。</span><span class="sxs-lookup"><span data-stu-id="1de45-319">This tutorial completes our look at working with batched data.</span></span> <span data-ttu-id="1de45-320">下一组教程将探讨各种高级的数据访问层方案，包括使用 TableAdapter 方法中的存储过程、配置 DAL 中的连接和命令级设置、加密连接字符串，等等！</span><span class="sxs-lookup"><span data-stu-id="1de45-320">The next set of tutorials explores a variety of advanced Data Access Layer scenarios, including using stored procedures in the TableAdapter s methods, configuring connection- and command-level settings in the DAL, encrypting connection strings, and more!</span></span>

<span data-ttu-id="1de45-321">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="1de45-321">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="1de45-322">关于作者</span><span class="sxs-lookup"><span data-stu-id="1de45-322">About the Author</span></span>

<span data-ttu-id="1de45-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，创始人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已在使用 Microsoft Web 技术，自1998开始。</span><span class="sxs-lookup"><span data-stu-id="1de45-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="1de45-324">Scott 的工作方式是独立的顾问、培训师和撰稿人。</span><span class="sxs-lookup"><span data-stu-id="1de45-324">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="1de45-325">他的最新书籍是，[*在24小时内，sam ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="1de45-325">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="1de45-326">可以[mitchell@4GuysFromRolla.com访问。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="1de45-326">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="1de45-327">或通过他的博客，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="1de45-327">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="1de45-328">特别感谢</span><span class="sxs-lookup"><span data-stu-id="1de45-328">Special Thanks To</span></span>

<span data-ttu-id="1de45-329">此教程系列由许多有用的审阅者查看。</span><span class="sxs-lookup"><span data-stu-id="1de45-329">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="1de45-330">本教程的主管评审者是 Hilton Giesenow 和 Jacob Lauritsen。</span><span class="sxs-lookup"><span data-stu-id="1de45-330">Lead reviewers for this tutorial were Hilton Giesenow and S ren Jacob Lauritsen.</span></span> <span data-ttu-id="1de45-331">想要查看我即将发布的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="1de45-331">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="1de45-332">如果是这样，请在mitchell@4GuysFromRolla.com放置一行[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="1de45-332">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="1de45-333">上一部分</span><span class="sxs-lookup"><span data-stu-id="1de45-333">Previous</span></span>](batch-deleting-vb.md)
