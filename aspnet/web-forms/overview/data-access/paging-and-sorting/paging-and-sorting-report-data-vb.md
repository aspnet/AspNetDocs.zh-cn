---
uid: web-forms/overview/data-access/paging-and-sorting/paging-and-sorting-report-data-vb
title: 分页和排序报表数据（VB） |Microsoft Docs
author: rick-anderson
description: 在联机应用程序中显示数据时，分页和排序是两种非常常见的功能。 在本教程中，我们将首先了解如何添加排序和 。
ms.author: riande
ms.date: 08/15/2006
ms.assetid: b895e37e-0e69-45cc-a7e4-17ddd2e1b38d
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting/paging-and-sorting-report-data-vb
msc.type: authoredcontent
ms.openlocfilehash: 6785b5cd2d4d3a2c2e7f2c2fea93f5cd5e2fdf24
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/28/2019
ms.locfileid: "74619130"
---
# <a name="paging-and-sorting-report-data-vb"></a><span data-ttu-id="b46a5-104">分页和排序报表数据 (VB)</span><span class="sxs-lookup"><span data-stu-id="b46a5-104">Paging and Sorting Report Data (VB)</span></span>

<span data-ttu-id="b46a5-105">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="b46a5-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="b46a5-106">[下载示例应用](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_24_VB.exe)或[下载 PDF](paging-and-sorting-report-data-vb/_static/datatutorial24vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="b46a5-106">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_24_VB.exe) or [Download PDF](paging-and-sorting-report-data-vb/_static/datatutorial24vb1.pdf)</span></span>

> <span data-ttu-id="b46a5-107">在联机应用程序中显示数据时，分页和排序是两种非常常见的功能。</span><span class="sxs-lookup"><span data-stu-id="b46a5-107">Paging and sorting are two very common features when displaying data in an online application.</span></span> <span data-ttu-id="b46a5-108">在本教程中，我们将首先了解如何向我们的报表添加排序和分页，然后我们将在以后的教程中进行构建。</span><span class="sxs-lookup"><span data-stu-id="b46a5-108">In this tutorial we'll take a first look at adding sorting and paging to our reports, which we will then build upon in future tutorials.</span></span>

## <a name="introduction"></a><span data-ttu-id="b46a5-109">简介</span><span class="sxs-lookup"><span data-stu-id="b46a5-109">Introduction</span></span>

<span data-ttu-id="b46a5-110">在联机应用程序中显示数据时，分页和排序是两种非常常见的功能。</span><span class="sxs-lookup"><span data-stu-id="b46a5-110">Paging and sorting are two very common features when displaying data in an online application.</span></span> <span data-ttu-id="b46a5-111">例如，在在线书店搜索 ASP.NET 书籍时，可能会有数百个这类书籍，但是列出搜索结果的报告只列出每页的十个匹配项。</span><span class="sxs-lookup"><span data-stu-id="b46a5-111">For example, when searching for ASP.NET books at an online bookstore, there may be hundreds of such books, but the report listing the search results lists only ten matches per page.</span></span> <span data-ttu-id="b46a5-112">而且，结果可以按标题、价格、页计数、作者姓名等进行排序。</span><span class="sxs-lookup"><span data-stu-id="b46a5-112">Moreover, the results can be sorted by title, price, page count, author name, and so on.</span></span> <span data-ttu-id="b46a5-113">虽然过去的23个教程已经检查了如何构建各种报表（包括允许添加、编辑和删除数据的接口），但我们并未介绍如何对数据进行排序，并且仅在 DetailsView 和 FormView 上查看到的唯一分页示例控件.</span><span class="sxs-lookup"><span data-stu-id="b46a5-113">While the past 23 tutorials have examined how to build a variety of reports, including interfaces that permit adding, editing, and deleting data, we ve not looked at how to sort data and the only paging examples we ve seen have been with the DetailsView and FormView controls.</span></span>

<span data-ttu-id="b46a5-114">在本教程中，我们将了解如何向报表添加排序和分页，只需选中几个复选框即可完成此操作。</span><span class="sxs-lookup"><span data-stu-id="b46a5-114">In this tutorial we'll see how to add sorting and paging to our reports, which can be accomplished by simply checking a few checkboxes.</span></span> <span data-ttu-id="b46a5-115">遗憾的是，这一简单的实现有其缺点，即排序接口离开了所需的位，而分页例程却不是为高效地通过大型结果集进行分页而设计的。</span><span class="sxs-lookup"><span data-stu-id="b46a5-115">Unfortunately, this simplistic implementation has its drawbacks the sorting interface leaves a bit to be desired and the paging routines are not designed for efficiently paging through large result sets.</span></span> <span data-ttu-id="b46a5-116">将来的教程将探讨如何克服现成的分页和排序解决方案的限制。</span><span class="sxs-lookup"><span data-stu-id="b46a5-116">Future tutorials will explore how to overcome the limitations of the out-of-the-box paging and sorting solutions.</span></span>

## <a name="step-1-adding-the-paging-and-sorting-tutorial-web-pages"></a><span data-ttu-id="b46a5-117">步骤1：添加分页和排序教程网页</span><span class="sxs-lookup"><span data-stu-id="b46a5-117">Step 1: Adding the Paging and Sorting Tutorial Web Pages</span></span>

<span data-ttu-id="b46a5-118">在开始本教程之前，首先请花点时间来添加本教程和接下来的三个 ASP.NET 所需的页面。</span><span class="sxs-lookup"><span data-stu-id="b46a5-118">Before we start this tutorial, let s first take a moment to add the ASP.NET pages we'll need for this tutorial and the next three.</span></span> <span data-ttu-id="b46a5-119">首先，在项目中创建一个名为 `PagingAndSorting`的新文件夹。</span><span class="sxs-lookup"><span data-stu-id="b46a5-119">Start by creating a new folder in the project named `PagingAndSorting`.</span></span> <span data-ttu-id="b46a5-120">接下来，将以下五个 ASP.NET 页面添加到此文件夹，所有这些页面都配置为使用母版页 `Site.master`：</span><span class="sxs-lookup"><span data-stu-id="b46a5-120">Next, add the following five ASP.NET pages to this folder, having all of them configured to use the master page `Site.master`:</span></span>

- `Default.aspx`
- `SimplePagingSorting.aspx`
- `EfficientPaging.aspx`
- `SortParameter.aspx`
- `CustomSortingUI.aspx`

![创建 PagingAndSorting 文件夹并添加教程 ASP.NET 页面](paging-and-sorting-report-data-vb/_static/image1.png)

<span data-ttu-id="b46a5-122">**图 1**：创建 PagingAndSorting 文件夹并添加教程 ASP.NET 页面</span><span class="sxs-lookup"><span data-stu-id="b46a5-122">**Figure 1**: Create a PagingAndSorting Folder and Add the Tutorial ASP.NET Pages</span></span>

<span data-ttu-id="b46a5-123">接下来，打开 `Default.aspx` 页面，并将 `SectionLevelTutorialListing.ascx` 用户控件从 `UserControls` 文件夹拖到设计图面上。</span><span class="sxs-lookup"><span data-stu-id="b46a5-123">Next, open the `Default.aspx` page and drag the `SectionLevelTutorialListing.ascx` User Control from the `UserControls` folder onto the Design surface.</span></span> <span data-ttu-id="b46a5-124">此用户控件（我们在[母版页和站点导航](../introduction/master-pages-and-site-navigation-vb.md)教程中创建）枚举站点地图，并在项目符号列表中的当前部分显示这些教程。</span><span class="sxs-lookup"><span data-stu-id="b46a5-124">This User Control, which we created in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-vb.md) tutorial, enumerates the site map and displays those tutorials in the current section in a bulleted list.</span></span>

![将 SectionLevelTutorialListing 用户控件添加到 default.aspx](paging-and-sorting-report-data-vb/_static/image2.png)

<span data-ttu-id="b46a5-126">**图 2**：将 SectionLevelTutorialListing 用户控件添加到 default.aspx</span><span class="sxs-lookup"><span data-stu-id="b46a5-126">**Figure 2**: Add the SectionLevelTutorialListing.ascx User Control to Default.aspx</span></span>

<span data-ttu-id="b46a5-127">为了使项目符号列表显示我们要创建的分页和排序教程，我们需要将它们添加到站点地图。</span><span class="sxs-lookup"><span data-stu-id="b46a5-127">In order to have the bulleted list display the paging and sorting tutorials we'll be creating, we need to add them to the site map.</span></span> <span data-ttu-id="b46a5-128">打开 `Web.sitemap` 文件并在编辑、插入和删除站点地图节点标记之后添加以下标记：</span><span class="sxs-lookup"><span data-stu-id="b46a5-128">Open the `Web.sitemap` file and add the following markup after the Editing, Inserting, and Deleting site map node markup:</span></span>

[!code-xml[Main](paging-and-sorting-report-data-vb/samples/sample1.xml)]

![更新站点映射以包括新的 ASP.NET 页面](paging-and-sorting-report-data-vb/_static/image3.png)

<span data-ttu-id="b46a5-130">**图 3**：更新站点映射以包括新的 ASP.NET 页面</span><span class="sxs-lookup"><span data-stu-id="b46a5-130">**Figure 3**: Update the Site Map to Include the New ASP.NET Pages</span></span>

## <a name="step-2-displaying-product-information-in-a-gridview"></a><span data-ttu-id="b46a5-131">步骤2：在 GridView 中显示产品信息</span><span class="sxs-lookup"><span data-stu-id="b46a5-131">Step 2: Displaying Product Information in a GridView</span></span>

<span data-ttu-id="b46a5-132">在实际实现分页和排序功能之前，首先让我们创建一个列出产品信息的标准不可排序、不可分页的 GridView。</span><span class="sxs-lookup"><span data-stu-id="b46a5-132">Before we actually implement paging and sorting capabilities, let s first create a standard non-sortable, non-pageable GridView that lists the product information.</span></span> <span data-ttu-id="b46a5-133">这是我们以前在本系列教程中执行多次的任务，因此应熟悉这些步骤。</span><span class="sxs-lookup"><span data-stu-id="b46a5-133">This is a task we ve done many times before throughout this tutorial series so these steps should be familiar.</span></span> <span data-ttu-id="b46a5-134">首先打开 "`SimplePagingSorting.aspx`" 页，然后将 "GridView" 控件从 "工具箱" 拖到设计器上，将其 `ID` 属性设置为 "`Products`"。</span><span class="sxs-lookup"><span data-stu-id="b46a5-134">Start by opening the `SimplePagingSorting.aspx` page and drag a GridView control from the Toolbox onto the Designer, setting its `ID` property to `Products`.</span></span> <span data-ttu-id="b46a5-135">接下来，创建一个使用 ProductsBLL 类 `GetProducts()` 方法的新 ObjectDataSource 来返回所有产品信息。</span><span class="sxs-lookup"><span data-stu-id="b46a5-135">Next, create a new ObjectDataSource that uses the ProductsBLL class s `GetProducts()` method to return all of the product information.</span></span>

![使用 GetProducts （）方法检索有关所有产品的信息](paging-and-sorting-report-data-vb/_static/image4.png)

<span data-ttu-id="b46a5-137">**图 4**：使用 GetProducts （）方法检索有关所有产品的信息</span><span class="sxs-lookup"><span data-stu-id="b46a5-137">**Figure 4**: Retrieve Information About All of the Products Using the GetProducts() Method</span></span>

<span data-ttu-id="b46a5-138">由于此报表是只读报表，因此不需要将 ObjectDataSource `Insert()`、`Update()`或 `Delete()` 方法映射到相应的 `ProductsBLL` 方法;因此，从 "更新"、"插入" 和 "删除" 选项卡的下拉列表中选择 "（无）"。</span><span class="sxs-lookup"><span data-stu-id="b46a5-138">Since this report is a read-only report, there s no need to map the ObjectDataSource s `Insert()`, `Update()`, or `Delete()` methods to corresponding `ProductsBLL` methods; therefore, choose (None) from the drop-down list for the UPDATE, INSERT, and DELETE tabs.</span></span>

![在 "更新"、"插入" 和 "删除" 选项卡的下拉列表中选择 "（无）" 选项](paging-and-sorting-report-data-vb/_static/image5.png)

<span data-ttu-id="b46a5-140">**图 5**：在 "更新"、"插入" 和 "删除" 选项卡的下拉列表中选择 "（无）" 选项</span><span class="sxs-lookup"><span data-stu-id="b46a5-140">**Figure 5**: Choose the (None) Option in the Drop-Down List in the UPDATE, INSERT, and DELETE Tabs</span></span>

<span data-ttu-id="b46a5-141">接下来，让我们自定义 GridView 字段，以便仅显示产品名称、供应商、类别、价格和中止状态。</span><span class="sxs-lookup"><span data-stu-id="b46a5-141">Next, let s customize the GridView s fields so that only the products names, suppliers, categories, prices, and discontinued statuses are displayed.</span></span> <span data-ttu-id="b46a5-142">而且，可以随意进行任何字段级格式设置更改，例如调整 `HeaderText` 属性或将价格设置为货币格式。</span><span class="sxs-lookup"><span data-stu-id="b46a5-142">Furthermore, feel free to make any field-level formatting changes, such as adjusting the `HeaderText` properties or formatting the price as a currency.</span></span> <span data-ttu-id="b46a5-143">完成这些更改后，GridView 的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="b46a5-143">After these changes, your GridView s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](paging-and-sorting-report-data-vb/samples/sample2.aspx)]

<span data-ttu-id="b46a5-144">图6显示了在浏览器中查看时的进度。</span><span class="sxs-lookup"><span data-stu-id="b46a5-144">Figure 6 shows our progress thus far when viewed through a browser.</span></span> <span data-ttu-id="b46a5-145">请注意，此页在一个屏幕中列出了所有产品，其中显示了每个产品的名称、类别、供应商、价格和废止状态。</span><span class="sxs-lookup"><span data-stu-id="b46a5-145">Note that the page lists all of the products in one screen, showing each product s name, category, supplier, price, and discontinued status.</span></span>

<span data-ttu-id="b46a5-146">[列出了每个产品 ![](paging-and-sorting-report-data-vb/_static/image7.png)](paging-and-sorting-report-data-vb/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="b46a5-146">[![Each of the Products are Listed](paging-and-sorting-report-data-vb/_static/image7.png)](paging-and-sorting-report-data-vb/_static/image6.png)</span></span>

<span data-ttu-id="b46a5-147">**图 6**：列出了每个产品（[单击以查看完全大小的图像](paging-and-sorting-report-data-vb/_static/image8.png)）</span><span class="sxs-lookup"><span data-stu-id="b46a5-147">**Figure 6**: Each of the Products are Listed ([Click to view full-size image](paging-and-sorting-report-data-vb/_static/image8.png))</span></span>

## <a name="step-3-adding-paging-support"></a><span data-ttu-id="b46a5-148">步骤3：添加分页支持</span><span class="sxs-lookup"><span data-stu-id="b46a5-148">Step 3: Adding Paging Support</span></span>

<span data-ttu-id="b46a5-149">在一个屏幕上列出*所有*产品可能导致用户浏览数据的信息过载。</span><span class="sxs-lookup"><span data-stu-id="b46a5-149">Listing *all* of the products on one screen can lead to information overload for the user perusing the data.</span></span> <span data-ttu-id="b46a5-150">为了使结果更易于管理，我们可以将数据分解为较小的数据页，并允许用户一次一页地单步执行数据。</span><span class="sxs-lookup"><span data-stu-id="b46a5-150">To help make the results more manageable, we can break up the data into smaller pages of data and allow the user to step through the data one page at a time.</span></span> <span data-ttu-id="b46a5-151">若要实现此目的，只需选中 GridView s 智能标记的 "启用分页" 复选框（这会将 GridView [`AllowPaging` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.allowpaging.aspx)设置为 `true`）。</span><span class="sxs-lookup"><span data-stu-id="b46a5-151">To accomplish this simply check the Enable Paging checkbox from the GridView s smart tag (this sets the GridView s [`AllowPaging` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.allowpaging.aspx) to `true`).</span></span>

<span data-ttu-id="b46a5-152">[![选中 "启用分页" 复选框以添加分页支持](paging-and-sorting-report-data-vb/_static/image10.png)](paging-and-sorting-report-data-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="b46a5-152">[![Check the Enable Paging Checkbox to Add Paging Support](paging-and-sorting-report-data-vb/_static/image10.png)](paging-and-sorting-report-data-vb/_static/image9.png)</span></span>

<span data-ttu-id="b46a5-153">**图 7**：选中 "启用分页" 复选框以添加分页支持（[单击以查看完全大小的图像](paging-and-sorting-report-data-vb/_static/image11.png)）</span><span class="sxs-lookup"><span data-stu-id="b46a5-153">**Figure 7**: Check the Enable Paging Checkbox to Add Paging Support ([Click to view full-size image](paging-and-sorting-report-data-vb/_static/image11.png))</span></span>

<span data-ttu-id="b46a5-154">启用分页将限制每页显示的记录数，并向 GridView 添加*分页接口*。</span><span class="sxs-lookup"><span data-stu-id="b46a5-154">Enabling paging limits the number of records shown per page and adds a *paging interface* to the GridView.</span></span> <span data-ttu-id="b46a5-155">图7中所示的默认寻呼接口是一系列页码，允许用户从一页数据快速导航到另一页。</span><span class="sxs-lookup"><span data-stu-id="b46a5-155">The default paging interface, shown in Figure 7, is a series of page numbers, allowing the user to quickly navigate from one page of data to another.</span></span> <span data-ttu-id="b46a5-156">此分页接口应熟悉，因为在过去的教程中向 DetailsView 和 FormView 控件添加分页支持时，将会看到它。</span><span class="sxs-lookup"><span data-stu-id="b46a5-156">This paging interface should look familiar, as we ve seen it when adding paging support to the DetailsView and FormView controls in past tutorials.</span></span>

<span data-ttu-id="b46a5-157">DetailsView 和 FormView 控件都只显示每页一条记录。</span><span class="sxs-lookup"><span data-stu-id="b46a5-157">Both the DetailsView and FormView controls only show a single record per page.</span></span> <span data-ttu-id="b46a5-158">但 GridView 会咨询其[`PageSize` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.pagesize.aspx)，以确定每页显示多少条记录（此属性默认值为10）。</span><span class="sxs-lookup"><span data-stu-id="b46a5-158">The GridView, however, consults its [`PageSize` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.pagesize.aspx) to determine how many records to show per page (this property defaults to a value of 10).</span></span>

<span data-ttu-id="b46a5-159">可以使用以下属性自定义此 GridView、DetailsView 和 FormView s 分页接口：</span><span class="sxs-lookup"><span data-stu-id="b46a5-159">This GridView, DetailsView, and FormView s paging interface can be customized using the following properties:</span></span>

- <span data-ttu-id="b46a5-160">`PagerStyle` 指示分页接口的样式信息;可以指定 `BackColor`、`ForeColor`、`CssClass`、`HorizontalAlign`等设置。</span><span class="sxs-lookup"><span data-stu-id="b46a5-160">`PagerStyle` indicates the style information for the paging interface; can specify settings like `BackColor`, `ForeColor`, `CssClass`, `HorizontalAlign`, and so on.</span></span>
- <span data-ttu-id="b46a5-161">`PagerSettings` 包含可自定义分页接口功能的属性的一系列;`PageButtonCount` 指示分页界面中显示的数字页码的最大数目（默认值为10）;[`Mode` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pagersettings.mode.aspx)指示分页接口的运行方式，并可将其设置为：</span><span class="sxs-lookup"><span data-stu-id="b46a5-161">`PagerSettings` contains a bevy of properties that can customize the functionality of the paging interface; `PageButtonCount` indicates the maximum number of numeric page numbers displayed in the paging interface (the default is 10); the [`Mode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pagersettings.mode.aspx) indicates how the paging interface operates and can be set to:</span></span> 

    - <span data-ttu-id="b46a5-162">`NextPrevious` 显示 "下一步" 和 "上一个" 按钮，允许用户一次向前或向后一页</span><span class="sxs-lookup"><span data-stu-id="b46a5-162">`NextPrevious` shows a Next and Previous buttons, allowing the user to step forwards or backwards one page at a time</span></span>
    - <span data-ttu-id="b46a5-163">除了 "下一步" 和 "上一步" 按钮外，还包括 "第一个" 和 "最后一个" 按钮，使用户能够快速移动到第一个或最后一个数据页 `NextPreviousFirstLast`</span><span class="sxs-lookup"><span data-stu-id="b46a5-163">`NextPreviousFirstLast` in addition to Next and Previous buttons, First and Last buttons are also included, allowing the user to quickly move to the first or last page of data</span></span>
    - <span data-ttu-id="b46a5-164">`Numeric` 显示一系列页码，使用户能够立即跳转到任何页面</span><span class="sxs-lookup"><span data-stu-id="b46a5-164">`Numeric` shows a series of page numbers, allowing the user to immediately jump to any page</span></span>
    - <span data-ttu-id="b46a5-165">除了页码外，`NumericFirstLast` 还包括第一个和最后一个按钮，使用户能够快速移动到第一个或最后一个数据页;仅当所有数字页码无法调整时才显示第一个/最后一个按钮</span><span class="sxs-lookup"><span data-stu-id="b46a5-165">`NumericFirstLast` in addition to the page numbers, includes First and Last buttons, allowing the user to quickly move to the first or last page of data; the First/Last buttons are only shown if all of the numeric page numbers cannot fit</span></span>

<span data-ttu-id="b46a5-166">此外，GridView、DetailsView 和 FormView 都提供 `PageIndex` 和 `PageCount` 属性，分别指示正在查看的当前页面和数据的总页数。</span><span class="sxs-lookup"><span data-stu-id="b46a5-166">Moreover, the GridView, DetailsView, and FormView all offer the `PageIndex` and `PageCount` properties, which indicate the current page being viewed and the total number of pages of data, respectively.</span></span> <span data-ttu-id="b46a5-167">`PageIndex` 属性的索引从0开始，这意味着查看数据的第一页时 `PageIndex` 将等于0。</span><span class="sxs-lookup"><span data-stu-id="b46a5-167">The `PageIndex` property is indexed starting at 0, meaning that when viewing the first page of data `PageIndex` will equal 0.</span></span> <span data-ttu-id="b46a5-168">另一方面，`PageCount`开始计数为1，这意味着 `PageIndex` 限制为0到 `PageCount - 1`之间的值。</span><span class="sxs-lookup"><span data-stu-id="b46a5-168">`PageCount`, on the other hand, starts counting at 1, meaning that `PageIndex` is limited to the values between 0 and `PageCount - 1`.</span></span>

<span data-ttu-id="b46a5-169">让我们花点时间来改进 GridView 的分页界面的默认外观。</span><span class="sxs-lookup"><span data-stu-id="b46a5-169">Let s take a moment to improve the default appearance of our GridView s paging interface.</span></span> <span data-ttu-id="b46a5-170">具体来说，让我们以浅灰色背景向右对齐分页界面。</span><span class="sxs-lookup"><span data-stu-id="b46a5-170">Specifically, let s have the paging interface right-aligned with a light gray background.</span></span> <span data-ttu-id="b46a5-171">不是直接通过 GridView `PagerStyle` 属性来设置这些属性，而是在名为 `PagerRowStyle` 的 `Styles.css` 中创建一个 CSS 类，然后通过我们的主题分配 `PagerStyle` 的 `CssClass` 属性。</span><span class="sxs-lookup"><span data-stu-id="b46a5-171">Rather than setting these properties directly through the GridView s `PagerStyle` property, let s create a CSS class in `Styles.css` named `PagerRowStyle` and then assign the `PagerStyle` s `CssClass` property through our Theme.</span></span> <span data-ttu-id="b46a5-172">首先打开 `Styles.css` 并添加以下 CSS 类定义：</span><span class="sxs-lookup"><span data-stu-id="b46a5-172">Start by opening `Styles.css` and adding the following CSS class definition:</span></span>

[!code-css[Main](paging-and-sorting-report-data-vb/samples/sample3.css)]

<span data-ttu-id="b46a5-173">接下来，打开 `App_Themes` 文件夹内 `DataWebControls` 文件夹中的 `GridView.skin` 文件。</span><span class="sxs-lookup"><span data-stu-id="b46a5-173">Next, open the `GridView.skin` file in the `DataWebControls` folder within the `App_Themes` folder.</span></span> <span data-ttu-id="b46a5-174">如我们在*母版页和站点导航*教程中所述，可以使用皮肤文件指定 Web 控件的默认属性值。</span><span class="sxs-lookup"><span data-stu-id="b46a5-174">As we discussed in the *Master Pages and Site Navigation* tutorial, Skin files can be used to specify the default property values for a Web control.</span></span> <span data-ttu-id="b46a5-175">因此，增加现有设置以包括将 `PagerStyle` 的 `CssClass` 属性设置为 `PagerRowStyle`。</span><span class="sxs-lookup"><span data-stu-id="b46a5-175">Therefore, augment the existing settings to include setting the `PagerStyle` s `CssClass` property to `PagerRowStyle`.</span></span> <span data-ttu-id="b46a5-176">同时，让我们使用 `NumericFirstLast` 寻呼接口将寻呼接口配置为最多显示五个数值页面按钮。</span><span class="sxs-lookup"><span data-stu-id="b46a5-176">Also, let s configure the paging interface to show at most five numeric page buttons using the `NumericFirstLast` paging interface.</span></span>

[!code-aspx[Main](paging-and-sorting-report-data-vb/samples/sample4.aspx)]

## <a name="the-paging-user-experience"></a><span data-ttu-id="b46a5-177">寻呼用户体验</span><span class="sxs-lookup"><span data-stu-id="b46a5-177">The Paging User Experience</span></span>

<span data-ttu-id="b46a5-178">图8显示了在选择了 GridView "启用分页" 复选框后通过浏览器访问的网页，并通过 `GridView.skin` 文件进行了 `PagerStyle` 和 `PagerSettings` 配置。</span><span class="sxs-lookup"><span data-stu-id="b46a5-178">Figure 8 shows the web page when visited through a browser after the GridView s Enable Paging checkbox has been checked and the `PagerStyle` and `PagerSettings` configurations have been made through the `GridView.skin` file.</span></span> <span data-ttu-id="b46a5-179">请注意，只显示了十条记录，分页接口指示我们正在查看数据的第一页。</span><span class="sxs-lookup"><span data-stu-id="b46a5-179">Note how only ten records are shown, and the paging interface indicates that we are viewing the first page of data.</span></span>

<span data-ttu-id="b46a5-180">[启用分页 ![，一次只显示部分记录](paging-and-sorting-report-data-vb/_static/image13.png)](paging-and-sorting-report-data-vb/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="b46a5-180">[![With Paging Enabled, Only a Subset of the Records are Displayed at a Time](paging-and-sorting-report-data-vb/_static/image13.png)](paging-and-sorting-report-data-vb/_static/image12.png)</span></span>

<span data-ttu-id="b46a5-181">**图 8**：启用分页后，一次仅显示一小部分记录（[单击查看完全大小的图像](paging-and-sorting-report-data-vb/_static/image14.png)）</span><span class="sxs-lookup"><span data-stu-id="b46a5-181">**Figure 8**: With Paging Enabled, Only a Subset of the Records are Displayed at a Time ([Click to view full-size image](paging-and-sorting-report-data-vb/_static/image14.png))</span></span>

<span data-ttu-id="b46a5-182">当用户单击分页界面中的某个页码时，回发可以和页面重新加载，其中显示了请求的页面记录。</span><span class="sxs-lookup"><span data-stu-id="b46a5-182">When the user clicks on one of the page numbers in the paging interface, a postback ensues and the page reloads showing that requested page s records.</span></span> <span data-ttu-id="b46a5-183">图9显示了选择查看最后一个数据页后的结果。</span><span class="sxs-lookup"><span data-stu-id="b46a5-183">Figure 9 shows the results after opting to view the final page of data.</span></span> <span data-ttu-id="b46a5-184">请注意，最后一页只有一条记录;这是因为存在81个记录，这将导致每页有8个页面，加上一个包含单独记录的页面。</span><span class="sxs-lookup"><span data-stu-id="b46a5-184">Notice that the final page only has one record; this is because there are 81 records in total, resulting in eight pages of 10 records per page plus one page with a lone record.</span></span>

<span data-ttu-id="b46a5-185">[单击页码 ![会导致回发并显示相应的记录子集](paging-and-sorting-report-data-vb/_static/image16.png)](paging-and-sorting-report-data-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="b46a5-185">[![Clicking On a Page Number Causes a Postback and Shows the Appropriate Subset of Records](paging-and-sorting-report-data-vb/_static/image16.png)](paging-and-sorting-report-data-vb/_static/image15.png)</span></span>

<span data-ttu-id="b46a5-186">**图 9**：单击页码将导致回发并显示相应的记录子集（[单击查看完全大小的图像](paging-and-sorting-report-data-vb/_static/image17.png)）</span><span class="sxs-lookup"><span data-stu-id="b46a5-186">**Figure 9**: Clicking On a Page Number Causes a Postback and Shows the Appropriate Subset of Records ([Click to view full-size image](paging-and-sorting-report-data-vb/_static/image17.png))</span></span>

## <a name="paging-s-server-side-workflow"></a><span data-ttu-id="b46a5-187">分页 s 服务器端工作流</span><span class="sxs-lookup"><span data-stu-id="b46a5-187">Paging s Server-Side Workflow</span></span>

<span data-ttu-id="b46a5-188">当最终用户单击寻呼界面中的按钮时，将开始回发可以和以下服务器端工作流：</span><span class="sxs-lookup"><span data-stu-id="b46a5-188">When the end user clicks on a button in the paging interface, a postback ensues and the following server-side workflow begins:</span></span>

1. <span data-ttu-id="b46a5-189">激发 `PageIndexChanging` 事件的 GridView （或 DetailsView 或 FormView）</span><span class="sxs-lookup"><span data-stu-id="b46a5-189">The GridView s (or DetailsView or FormView) `PageIndexChanging` event fires</span></span>
2. <span data-ttu-id="b46a5-190">ObjectDataSource 重新请求 BLL 中的*所有*数据;GridView `PageIndex` 和 `PageSize` 属性值用于确定需要在 GridView 中显示从 BLL 返回的记录</span><span class="sxs-lookup"><span data-stu-id="b46a5-190">The ObjectDataSource re-requests *all* of the data from the BLL; the GridView s `PageIndex` and `PageSize` property values are used to determine what records returned from the BLL need to be displayed in the GridView</span></span>
3. <span data-ttu-id="b46a5-191">激发了 GridView `PageIndexChanged` 事件</span><span class="sxs-lookup"><span data-stu-id="b46a5-191">The GridView s `PageIndexChanged` event fires</span></span>

<span data-ttu-id="b46a5-192">在步骤2中，ObjectDataSource 重新请求其数据源中的所有数据。</span><span class="sxs-lookup"><span data-stu-id="b46a5-192">In Step 2, the ObjectDataSource re-requests all of the data from its data source.</span></span> <span data-ttu-id="b46a5-193">这种形式的分页通常称为 "*默认分页*"，因为它在将 `AllowPaging` 属性设置为 `true`时默认使用分页行为。</span><span class="sxs-lookup"><span data-stu-id="b46a5-193">This style of paging is commonly referred to as *default paging*, as it s the paging behavior used by default when setting the `AllowPaging` property to `true`.</span></span> <span data-ttu-id="b46a5-194">使用默认分页时，数据 Web 控件 naively 将检索每个数据页的所有记录，即使只将部分记录呈现到发送到浏览器的 HTML 中。</span><span class="sxs-lookup"><span data-stu-id="b46a5-194">With default paging the data Web control naively retrieves all records for each page of data, even though only a subset of records are actually rendered into the HTML that s sent to the browser.</span></span> <span data-ttu-id="b46a5-195">除非通过 BLL 或 ObjectDataSource 来缓存数据库数据，否则对于具有很多并发用户的足够大的结果集或 web 应用程序，默认分页是不能使用的。</span><span class="sxs-lookup"><span data-stu-id="b46a5-195">Unless the database data is cached by the BLL or ObjectDataSource, default paging is unworkable for sufficiently large result sets or for web applications with many concurrent users.</span></span>

<span data-ttu-id="b46a5-196">在下一教程中，我们将检查如何实现*自定义分页*。</span><span class="sxs-lookup"><span data-stu-id="b46a5-196">In the next tutorial we'll examine how to implement *custom paging*.</span></span> <span data-ttu-id="b46a5-197">通过自定义分页，可以专门指示 ObjectDataSource 仅检索请求的数据页所需的精确记录集。</span><span class="sxs-lookup"><span data-stu-id="b46a5-197">With custom paging you can specifically instruct the ObjectDataSource to only retrieve the precise set of records needed for the requested page of data.</span></span> <span data-ttu-id="b46a5-198">如您所料，自定义分页极大地提高了通过大型结果集进行分页的效率。</span><span class="sxs-lookup"><span data-stu-id="b46a5-198">As you can imagine, custom paging greatly improves the efficiency of paging through large result sets.</span></span>

> [!NOTE]
> <span data-ttu-id="b46a5-199">尽管在通过足够大的结果集或具有多个同时用户的站点进行分页时不适合使用默认分页，但请注意，自定义分页需要进行更多的更改和工作量来实现，但并不像选中复选框那样简单（默认情况下）分页）。</span><span class="sxs-lookup"><span data-stu-id="b46a5-199">While default paging is not suitable when paging through sufficiently large result sets or for sites with many simultaneous users, realize that custom paging requires more changes and effort to implement and is not as simple as checking a checkbox (as is default paging).</span></span> <span data-ttu-id="b46a5-200">因此，对于小型和低流量网站，或在对相对较小的结果集进行分页时，默认分页可能是理想的选择，因为它的实现速度要快得多。</span><span class="sxs-lookup"><span data-stu-id="b46a5-200">Therefore, default paging may be the ideal choice for small, low-traffic websites or when paging through relatively small result sets, as it s much easier and quicker to implement.</span></span>

<span data-ttu-id="b46a5-201">例如，如果我们知道，在我们的数据库中将永远不会超过100的产品，自定义分页所能获得的最小性能提升可能会抵消实现它所需的工作量。</span><span class="sxs-lookup"><span data-stu-id="b46a5-201">For example, if we know that we'll never have more than 100 products in our database, the minimal performance gain enjoyed by custom paging is likely offset by the effort required to implement it.</span></span> <span data-ttu-id="b46a5-202">然而，如果一天可能有数千或数十个产品，则*不*实现自定义分页会极大地影响应用程序的可伸缩性。</span><span class="sxs-lookup"><span data-stu-id="b46a5-202">If, however, we may one day have thousands or tens of thousands of products, *not* implementing custom paging would greatly hamper the scalability of our application.</span></span>

## <a name="step-4-customizing-the-paging-experience"></a><span data-ttu-id="b46a5-203">步骤4：自定义分页体验</span><span class="sxs-lookup"><span data-stu-id="b46a5-203">Step 4: Customizing the Paging Experience</span></span>

<span data-ttu-id="b46a5-204">数据 Web 控件提供了许多可用于增强用户分页体验的属性。</span><span class="sxs-lookup"><span data-stu-id="b46a5-204">The data Web controls provide a number of properties that can be used to enhance the user s paging experience.</span></span> <span data-ttu-id="b46a5-205">例如，`PageCount` 属性表示有多少页总数，而 `PageIndex` 属性指示当前访问的页，并且可以将其设置为快速将用户移动到特定页。</span><span class="sxs-lookup"><span data-stu-id="b46a5-205">The `PageCount` property, for example, indicates how many total pages there are, while the `PageIndex` property indicates the current page being visited and can be set to quickly move a user to a specific page.</span></span> <span data-ttu-id="b46a5-206">为了说明如何使用这些属性来改善用户的分页体验，让我们向页面中添加一个 "标签 Web 控件"，向用户通知他们当前正在访问的页面，以及允许用户快速跳转到任何给定页面的 DropDownList 控件.</span><span class="sxs-lookup"><span data-stu-id="b46a5-206">To illustrate how to use these properties to improve upon the user s paging experience, let s add a Label Web control to our page that informs the user what page they re currently visiting, along with a DropDownList control that allows them to quickly jump to any given page.</span></span>

<span data-ttu-id="b46a5-207">首先，将 "标签" Web 控件添加到页面，将其 `ID` 属性设置为 "`PagingInformation`"，并清除其 `Text` 属性。</span><span class="sxs-lookup"><span data-stu-id="b46a5-207">First, add a Label Web control to your page, set its `ID` property to `PagingInformation`, and clear out its `Text` property.</span></span> <span data-ttu-id="b46a5-208">接下来，为 GridView `DataBound` 事件创建事件处理程序并添加以下代码：</span><span class="sxs-lookup"><span data-stu-id="b46a5-208">Next, create an event handler for the GridView s `DataBound` event and add the following code:</span></span>

[!code-vb[Main](paging-and-sorting-report-data-vb/samples/sample5.vb)]

<span data-ttu-id="b46a5-209">此事件处理程序将 `PagingInformation` 标签的 `Text` 属性分配给一条消息，告知用户其当前正在访问的页面 `Products.PageIndex + 1` 的总页数 `Products.PageCount` （我们将1添加到 `Products.PageIndex` 属性，因为 `PageIndex` 从0开始索引。）</span><span class="sxs-lookup"><span data-stu-id="b46a5-209">This event handler assigns the `PagingInformation` Label s `Text` property to a message informing the user the page they are currently visiting `Products.PageIndex + 1` out of how many total pages `Products.PageCount` (we add 1 to the `Products.PageIndex` property because `PageIndex` is indexed starting at 0).</span></span> <span data-ttu-id="b46a5-210">我在 `DataBound` 事件处理程序中选择了 "分配此标签" `Text` 属性，而不是 `PageIndexChanged` 事件处理程序，因为每次将数据绑定到 GridView 时都会触发 `DataBound` 事件，而 `PageIndexChanged` 事件处理程序仅在页索引更改时激发。</span><span class="sxs-lookup"><span data-stu-id="b46a5-210">I chose the assign this Label s `Text` property in the `DataBound` event handler as opposed to the `PageIndexChanged` event handler because the `DataBound` event fires every time data is bound to the GridView whereas the `PageIndexChanged` event handler only fires when the page index is changed.</span></span> <span data-ttu-id="b46a5-211">如果 GridView 最初在第一页上绑定数据，则不会激发 `PageIndexChanging` 事件（而 `DataBound` 事件）。</span><span class="sxs-lookup"><span data-stu-id="b46a5-211">When the GridView is initially data bound on the first page visit, the `PageIndexChanging` event doesn t fire (whereas the `DataBound` event does).</span></span>

<span data-ttu-id="b46a5-212">使用此添加方法时，用户现在会显示一条消息，指示用户访问的页面以及数据的总页数。</span><span class="sxs-lookup"><span data-stu-id="b46a5-212">With this addition, the user is now shown a message indicating what page they are visiting and how many total pages of data there are.</span></span>

<span data-ttu-id="b46a5-213">[![显示当前页码和总页数](paging-and-sorting-report-data-vb/_static/image19.png)](paging-and-sorting-report-data-vb/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="b46a5-213">[![The Current Page Number and Total Number of Pages are Displayed](paging-and-sorting-report-data-vb/_static/image19.png)](paging-and-sorting-report-data-vb/_static/image18.png)</span></span>

<span data-ttu-id="b46a5-214">**图 10**：显示当前页码和总页数（[单击查看完全大小的图像](paging-and-sorting-report-data-vb/_static/image20.png)）</span><span class="sxs-lookup"><span data-stu-id="b46a5-214">**Figure 10**: The Current Page Number and Total Number of Pages are Displayed ([Click to view full-size image](paging-and-sorting-report-data-vb/_static/image20.png))</span></span>

<span data-ttu-id="b46a5-215">除了 "标签" 控件外，还可以添加一个 DropDownList 控件，该控件在选定的当前已查看页中列出 GridView 中的页码。</span><span class="sxs-lookup"><span data-stu-id="b46a5-215">In addition to the Label control, let s also add a DropDownList control that lists the page numbers in the GridView with the currently viewed page selected.</span></span> <span data-ttu-id="b46a5-216">这里的思路是，用户只需从 DropDownList 中选择新的页面索引，就可以从当前页面快速跳转到另一个页面。</span><span class="sxs-lookup"><span data-stu-id="b46a5-216">The idea here is that the user can quickly jump from the current page to another by simply selecting the new page index from the DropDownList.</span></span> <span data-ttu-id="b46a5-217">首先向设计器添加 DropDownList，将其 `ID` 属性设置为 `PageList` 并从其智能标记中检查 Enable AutoPostBack 选项。</span><span class="sxs-lookup"><span data-stu-id="b46a5-217">Start by adding a DropDownList to the Designer, setting its `ID` property to `PageList` and checking the Enable AutoPostBack option from its smart tag.</span></span>

<span data-ttu-id="b46a5-218">接下来，返回 `DataBound` 事件处理程序并添加以下代码：</span><span class="sxs-lookup"><span data-stu-id="b46a5-218">Next, return to the `DataBound` event handler and add the following code:</span></span>

[!code-vb[Main](paging-and-sorting-report-data-vb/samples/sample6.vb)]

<span data-ttu-id="b46a5-219">此代码首先清除 `PageList` DropDownList 中的项。</span><span class="sxs-lookup"><span data-stu-id="b46a5-219">This code begins by clearing out the items in the `PageList` DropDownList.</span></span> <span data-ttu-id="b46a5-220">这可能看起来是多余的，因为其中一项不会有要更改的页数，而其他用户可能同时使用系统、添加或删除 `Products` 表中的记录。</span><span class="sxs-lookup"><span data-stu-id="b46a5-220">This may seem superfluous, since one wouldn't expect the number of pages to change, but other users may be using the system simultaneously, adding or removing records from the `Products` table.</span></span> <span data-ttu-id="b46a5-221">此类插入或删除操作可能会改变数据页的数目。</span><span class="sxs-lookup"><span data-stu-id="b46a5-221">Such insertions or deletions could alter the number of pages of data.</span></span>

<span data-ttu-id="b46a5-222">接下来，我们需要再次创建页码，并将映射到当前 GridView `PageIndex` 默认情况下处于选中状态。</span><span class="sxs-lookup"><span data-stu-id="b46a5-222">Next, we need to create the page numbers again and have the one that maps to the current GridView `PageIndex` selected by default.</span></span> <span data-ttu-id="b46a5-223">我们使用从0到 `PageCount - 1`的循环来完成此项工作，在每次迭代中添加新 `ListItem`，并将其 `Selected` 属性设置为 true （如果当前迭代索引等于 GridView 的 `PageIndex` 属性）。</span><span class="sxs-lookup"><span data-stu-id="b46a5-223">We accomplish this with a loop from 0 to `PageCount - 1`, adding a new `ListItem` in each iteration and setting its `Selected` property to true if the current iteration index equals the GridView s `PageIndex` property.</span></span>

<span data-ttu-id="b46a5-224">最后，我们需要为 DropDownList s `SelectedIndexChanged` 事件创建事件处理程序，每次用户从列表中选取不同项时都会触发此事件。</span><span class="sxs-lookup"><span data-stu-id="b46a5-224">Finally, we need to create an event handler for the DropDownList s `SelectedIndexChanged` event, which fires each time the user pick a different item from the list.</span></span> <span data-ttu-id="b46a5-225">若要创建此事件处理程序，只需在设计器中双击 DropDownList，然后添加以下代码：</span><span class="sxs-lookup"><span data-stu-id="b46a5-225">To create this event handler, simply double-click the DropDownList in the Designer, then add the following code:</span></span>

[!code-vb[Main](paging-and-sorting-report-data-vb/samples/sample7.vb)]

<span data-ttu-id="b46a5-226">如图11所示，仅更改 GridView `PageIndex` 属性会导致将数据重新绑定到 GridView。</span><span class="sxs-lookup"><span data-stu-id="b46a5-226">As Figure 11 shows, merely changing the GridView s `PageIndex` property causes the data to be rebound to the GridView.</span></span> <span data-ttu-id="b46a5-227">在 GridView `DataBound` 事件处理程序中，选择相应的 DropDownList `ListItem`。</span><span class="sxs-lookup"><span data-stu-id="b46a5-227">In the GridView s `DataBound` event handler, the appropriate DropDownList `ListItem` is selected.</span></span>

<span data-ttu-id="b46a5-228">[选择页面6下拉列表项时，![会自动将用户转到第六页](paging-and-sorting-report-data-vb/_static/image22.png)](paging-and-sorting-report-data-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="b46a5-228">[![The User is Automatically Taken to the Sixth Page When Selecting the Page 6 Drop-Down List Item](paging-and-sorting-report-data-vb/_static/image22.png)](paging-and-sorting-report-data-vb/_static/image21.png)</span></span>

<span data-ttu-id="b46a5-229">**图 11**：选择页面6下拉列表项时，自动将用户转到第六页（[单击以查看完全大小的图像](paging-and-sorting-report-data-vb/_static/image23.png)）</span><span class="sxs-lookup"><span data-stu-id="b46a5-229">**Figure 11**: The User is Automatically Taken to the Sixth Page When Selecting the Page 6 Drop-Down List Item ([Click to view full-size image](paging-and-sorting-report-data-vb/_static/image23.png))</span></span>

## <a name="step-5-adding-bi-directional-sorting-support"></a><span data-ttu-id="b46a5-230">步骤5：添加双向排序支持</span><span class="sxs-lookup"><span data-stu-id="b46a5-230">Step 5: Adding Bi-Directional Sorting Support</span></span>

<span data-ttu-id="b46a5-231">添加双向排序支持非常简单，只需在 "GridView s" 智能标记中检查 "启用排序" 选项（这会将 GridView [`AllowSorting` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.allowsorting.aspx)设置为 `true`）即可。</span><span class="sxs-lookup"><span data-stu-id="b46a5-231">Adding bi-directional sorting support is as simple as adding paging support simply check the Enable Sorting option from the GridView s smart tag (which sets the GridView s [`AllowSorting` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.allowsorting.aspx) to `true`).</span></span> <span data-ttu-id="b46a5-232">这会以 LinkButtons 的形式呈现 GridView 字段的每个标头，在单击时，将导致回发，并按升序返回按被单击的列排序的数据。</span><span class="sxs-lookup"><span data-stu-id="b46a5-232">This renders each of the headers of the GridView s fields as LinkButtons that, when clicked, cause a postback and return the data sorted by the clicked column in ascending order.</span></span> <span data-ttu-id="b46a5-233">再次单击相同的标头 LinkButton 会按降序对数据重新排序。</span><span class="sxs-lookup"><span data-stu-id="b46a5-233">Clicking the same header LinkButton again re-sorts the data in descending order.</span></span>

> [!NOTE]
> <span data-ttu-id="b46a5-234">如果使用的是自定义的数据访问层而不是类型化的数据集，则在 GridView s 智能标记中可能没有启用排序选项。</span><span class="sxs-lookup"><span data-stu-id="b46a5-234">If you are using a custom Data Access Layer rather than a Typed DataSet, you may not have an Enable Sorting option in the GridView s smart tag.</span></span> <span data-ttu-id="b46a5-235">只有绑定到本机支持排序的数据源的 GridViews 才能使用此复选框。</span><span class="sxs-lookup"><span data-stu-id="b46a5-235">Only GridViews bound to data sources that natively support sorting have this checkbox available.</span></span> <span data-ttu-id="b46a5-236">类型化数据集提供了现成的排序支持，因为 ADO.NET DataTable 提供了一个 `Sort` 方法，在调用该方法时，会使用指定的条件对 DataTable s Datarow 进行排序。</span><span class="sxs-lookup"><span data-stu-id="b46a5-236">The Typed DataSet provides out-of-the-box sorting support since the ADO.NET DataTable provides a `Sort` method that, when invoked, sorts the DataTable s DataRows using the criteria specified.</span></span>

<span data-ttu-id="b46a5-237">如果 DAL 未返回本机支持排序的对象，则需要将 ObjectDataSource 配置为将排序信息传递给业务逻辑层，以便对数据进行排序或将数据按 DAL 排序。</span><span class="sxs-lookup"><span data-stu-id="b46a5-237">If your DAL does not return objects that natively support sorting you will need to configure the ObjectDataSource to pass sorting information to the Business Logic Layer, which can either sort the data or have the data sorted by the DAL.</span></span> <span data-ttu-id="b46a5-238">在将来的教程中，我们将探讨如何在业务逻辑和数据访问层对数据进行排序。</span><span class="sxs-lookup"><span data-stu-id="b46a5-238">We'll explore how to sort data at the Business Logic and Data Access Layers in a future tutorial.</span></span>

<span data-ttu-id="b46a5-239">排序 LinkButtons 呈现为 HTML 超链接，其当前颜色（对于已访问链接为蓝色，已访问链接为深红色）与标题行的背景色冲突。</span><span class="sxs-lookup"><span data-stu-id="b46a5-239">The sorting LinkButtons are rendered as HTML hyperlinks, whose current colors (blue for an unvisited link and a dark red for a visited link) clash with the background color of the header row.</span></span> <span data-ttu-id="b46a5-240">而是使所有标题行链接都以白色显示，而不考虑它们是否已被访问。</span><span class="sxs-lookup"><span data-stu-id="b46a5-240">Instead, let s have all header row links displayed in white, regardless of whether they ve been visited or not.</span></span> <span data-ttu-id="b46a5-241">这可以通过将以下内容添加到 `Styles.css` 类来实现：</span><span class="sxs-lookup"><span data-stu-id="b46a5-241">This can be accomplished by adding the following to the `Styles.css` class:</span></span>

[!code-css[Main](paging-and-sorting-report-data-vb/samples/sample8.css)]

<span data-ttu-id="b46a5-242">此语法指示在使用 HeaderStyle 类的元素内显示这些超链接时，使用白色文本。</span><span class="sxs-lookup"><span data-stu-id="b46a5-242">This syntax indicates to use white text when displaying those hyperlinks within an element that uses the HeaderStyle class.</span></span>

<span data-ttu-id="b46a5-243">完成此 CSS 添加后，当通过浏览器访问页面时，屏幕应类似于图12。</span><span class="sxs-lookup"><span data-stu-id="b46a5-243">After this CSS addition, when visiting the page through a browser your screen should look similar to Figure 12.</span></span> <span data-ttu-id="b46a5-244">具体而言，图12显示了在单击 "价格字段" 标题链接后的结果。</span><span class="sxs-lookup"><span data-stu-id="b46a5-244">In particular, Figure 12 shows the results after the Price field s header link has been clicked.</span></span>

<span data-ttu-id="b46a5-245">[![结果已按单价升序排序](paging-and-sorting-report-data-vb/_static/image25.png)](paging-and-sorting-report-data-vb/_static/image24.png)</span><span class="sxs-lookup"><span data-stu-id="b46a5-245">[![The Results Have Been Sorted by the UnitPrice in Ascending Order](paging-and-sorting-report-data-vb/_static/image25.png)](paging-and-sorting-report-data-vb/_static/image24.png)</span></span>

<span data-ttu-id="b46a5-246">**图 12**：按单价升序对结果进行排序（[单击以查看完全大小的图像](paging-and-sorting-report-data-vb/_static/image26.png)）</span><span class="sxs-lookup"><span data-stu-id="b46a5-246">**Figure 12**: The Results Have Been Sorted by the UnitPrice in Ascending Order ([Click to view full-size image](paging-and-sorting-report-data-vb/_static/image26.png))</span></span>

## <a name="examining-the-sorting-workflow"></a><span data-ttu-id="b46a5-247">检查排序工作流</span><span class="sxs-lookup"><span data-stu-id="b46a5-247">Examining the Sorting Workflow</span></span>

<span data-ttu-id="b46a5-248">BoundField、CheckBoxField、TemplateField 等所有 GridView 字段都有一个 `SortExpression` 属性，该属性指示在单击该字段的排序标头链接时，应用于对数据进行排序的表达式。</span><span class="sxs-lookup"><span data-stu-id="b46a5-248">All GridView fields the BoundField, CheckBoxField, TemplateField, and so on have a `SortExpression` property that indicates the expression that should be used to sort the data when that field s sorting header link is clicked.</span></span> <span data-ttu-id="b46a5-249">GridView 还具有一个 `SortExpression` 属性。</span><span class="sxs-lookup"><span data-stu-id="b46a5-249">The GridView also has a `SortExpression` property.</span></span> <span data-ttu-id="b46a5-250">单击排序标头 LinkButton 时，GridView 将 `SortExpression` 值分配给该字段的 `SortExpression` 属性。</span><span class="sxs-lookup"><span data-stu-id="b46a5-250">When a sorting header LinkButton is clicked, the GridView assigns that field s `SortExpression` value to its `SortExpression` property.</span></span> <span data-ttu-id="b46a5-251">接下来，将从 ObjectDataSource 重新检索数据并根据 GridView 的 `SortExpression` 属性对数据进行排序。</span><span class="sxs-lookup"><span data-stu-id="b46a5-251">Next, the data is re-retrieved from the ObjectDataSource and sorted according to the GridView s `SortExpression` property.</span></span> <span data-ttu-id="b46a5-252">以下列表详细说明了当最终用户在 GridView 中对数据进行排序时发生的步骤顺序：</span><span class="sxs-lookup"><span data-stu-id="b46a5-252">The following list details the sequence of steps that transpires when an end user sorts the data in a GridView:</span></span>

1. <span data-ttu-id="b46a5-253">激发 GridView s[排序事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.sorting(VS.80).aspx)</span><span class="sxs-lookup"><span data-stu-id="b46a5-253">The GridView s [Sorting event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.sorting(VS.80).aspx) fires</span></span>
2. <span data-ttu-id="b46a5-254">GridView s [`SortExpression` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.sortexpression.aspx)设置为单击排序头 LinkButton 的字段的 `SortExpression`</span><span class="sxs-lookup"><span data-stu-id="b46a5-254">The GridView s [`SortExpression` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.sortexpression.aspx) is set to the `SortExpression` of the field whose sorting header LinkButton was clicked</span></span>
3. <span data-ttu-id="b46a5-255">ObjectDataSource 从 BLL 重新检索所有数据，然后使用 GridView `SortExpression` 来对数据进行排序。</span><span class="sxs-lookup"><span data-stu-id="b46a5-255">The ObjectDataSource re-retrieves all of the data from the BLL and then sorts the data using the GridView s `SortExpression`</span></span>
4. <span data-ttu-id="b46a5-256">GridView `PageIndex` 属性重置为0，这意味着在排序时，用户将返回到第一页数据（假设已实现分页支持）</span><span class="sxs-lookup"><span data-stu-id="b46a5-256">The GridView s `PageIndex` property is reset to 0, meaning that when sorting the user is returned to the first page of data (assuming paging support has been implemented)</span></span>
5. <span data-ttu-id="b46a5-257">激发了 GridView [`Sorted` 事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.sorted(VS.80).aspx)</span><span class="sxs-lookup"><span data-stu-id="b46a5-257">The GridView s [`Sorted` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.sorted(VS.80).aspx) fires</span></span>

<span data-ttu-id="b46a5-258">与默认分页一样，默认排序选项会重新从 BLL 中检索*所有*记录。</span><span class="sxs-lookup"><span data-stu-id="b46a5-258">Like with default paging, the default sorting option re-retrieves *all* of the records from the BLL.</span></span> <span data-ttu-id="b46a5-259">如果在没有分页的情况下使用排序或对默认分页使用排序，则没有办法避免此性能下降（数据库数据的缓存较短）。</span><span class="sxs-lookup"><span data-stu-id="b46a5-259">When using sorting without paging or when using sorting with default paging, there s no way to circumvent this performance hit (short of caching the database data).</span></span> <span data-ttu-id="b46a5-260">不过，正如我们将在将来的教程中看到的那样，可以在使用自定义分页时有效地对数据进行排序。</span><span class="sxs-lookup"><span data-stu-id="b46a5-260">However, as we'll see in a future tutorial, it s possible to efficiently sort data when using custom paging.</span></span>

<span data-ttu-id="b46a5-261">当通过 GridView s 智能标记的下拉列表将 ObjectDataSource 绑定到 GridView 时，每个 GridView 字段都会自动将其 `SortExpression` 属性分配给 `ProductsRow` 类中的数据字段的名称。</span><span class="sxs-lookup"><span data-stu-id="b46a5-261">When binding an ObjectDataSource to the GridView through the drop-down list in the GridView s smart tag, each GridView field automatically has its `SortExpression` property assigned to the name of the data field in the `ProductsRow` class.</span></span> <span data-ttu-id="b46a5-262">例如，`ProductName` BoundField s `SortExpression` 设置为 `ProductName`，如以下声明性标记中所示：</span><span class="sxs-lookup"><span data-stu-id="b46a5-262">For example, the `ProductName` BoundField s `SortExpression` is set to `ProductName`, as shown in the following declarative markup:</span></span>

[!code-aspx[Main](paging-and-sorting-report-data-vb/samples/sample9.aspx)]

<span data-ttu-id="b46a5-263">可以配置字段，以便无法通过清除其 `SortExpression` 属性（将其分配给空字符串）来对其进行排序。</span><span class="sxs-lookup"><span data-stu-id="b46a5-263">A field can be configured so that it s not sortable by clearing out its `SortExpression` property (assigning it to an empty string).</span></span> <span data-ttu-id="b46a5-264">为了说明这一点，假设我们不想让客户按价格对产品进行排序。</span><span class="sxs-lookup"><span data-stu-id="b46a5-264">To illustrate this, imagine that we didn't want to let our customers sort our products by price.</span></span> <span data-ttu-id="b46a5-265">`UnitPrice` BoundField s `SortExpression` 属性可以从声明性标记中删除，也可以通过 "字段" 对话框（可通过单击 GridView s 智能标记中的 "编辑列" 链接来访问）。</span><span class="sxs-lookup"><span data-stu-id="b46a5-265">The `UnitPrice` BoundField s `SortExpression` property can be removed either from the declarative markup or through the Fields dialog box (which is accessible by clicking on the Edit Columns link in the GridView s smart tag).</span></span>

![结果已按单价升序排序](paging-and-sorting-report-data-vb/_static/image27.png)

<span data-ttu-id="b46a5-267">**图 13**：按单价升序对结果进行排序</span><span class="sxs-lookup"><span data-stu-id="b46a5-267">**Figure 13**: The Results Have Been Sorted by the UnitPrice in Ascending Order</span></span>

<span data-ttu-id="b46a5-268">为 `UnitPrice` BoundField 删除 `SortExpression` 属性后，标头将呈现为文本而不是链接，从而阻止用户按价格对数据进行排序。</span><span class="sxs-lookup"><span data-stu-id="b46a5-268">Once the `SortExpression` property has been removed for the `UnitPrice` BoundField, the header is rendered as text rather than as a link, thereby preventing users from sorting the data by price.</span></span>

<span data-ttu-id="b46a5-269">[![通过删除 SortExpression 属性，用户将不再能够按价格对产品进行排序](paging-and-sorting-report-data-vb/_static/image29.png)](paging-and-sorting-report-data-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="b46a5-269">[![By Removing the SortExpression Property, Users Can No Longer Sort the Products By Price](paging-and-sorting-report-data-vb/_static/image29.png)](paging-and-sorting-report-data-vb/_static/image28.png)</span></span>

<span data-ttu-id="b46a5-270">**图 14**：删除 SortExpression 属性后，用户就不能再按价格对产品进行排序（[单击查看完全大小的图像](paging-and-sorting-report-data-vb/_static/image30.png)）</span><span class="sxs-lookup"><span data-stu-id="b46a5-270">**Figure 14**: By Removing the SortExpression Property, Users Can No Longer Sort the Products By Price ([Click to view full-size image](paging-and-sorting-report-data-vb/_static/image30.png))</span></span>

## <a name="programmatically-sorting-the-gridview"></a><span data-ttu-id="b46a5-271">以编程方式对 GridView 排序</span><span class="sxs-lookup"><span data-stu-id="b46a5-271">Programmatically Sorting the GridView</span></span>

<span data-ttu-id="b46a5-272">还可以使用 GridView [`Sort` 方法](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.sort.aspx)以编程方式对 gridview 的内容进行排序。</span><span class="sxs-lookup"><span data-stu-id="b46a5-272">You can also sort the contents of the GridView programmatically by using the GridView s [`Sort` method](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.sort.aspx).</span></span> <span data-ttu-id="b46a5-273">只需传入 `SortExpression` 值以便按[`SortDirection`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sortdirection.aspx) （`Ascending` 或 `Descending`）进行排序，并且将对 GridView 的数据进行重新排序。</span><span class="sxs-lookup"><span data-stu-id="b46a5-273">Simply pass in the `SortExpression` value to sort by along with the [`SortDirection`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sortdirection.aspx) (`Ascending` or `Descending`), and the GridView s data will be re-sorted.</span></span>

<span data-ttu-id="b46a5-274">假设我们关闭了 `UnitPrice` 排序的原因，因为我们担心我们的客户只需购买价格最低的产品。</span><span class="sxs-lookup"><span data-stu-id="b46a5-274">Imagine that the reason we turned off sorting by the `UnitPrice` was because we were worried that our customers would simply buy only the lowest-priced products.</span></span> <span data-ttu-id="b46a5-275">但是，我们想要鼓励他们购买最昂贵的产品，因此，我们希望他们能够按价格对产品进行排序，而只需从最昂贵的价格对产品进行排序。</span><span class="sxs-lookup"><span data-stu-id="b46a5-275">However, we want to encourage them to buy the most expensive products, so we d like them to be able to sort the products by price, but only from the most expensive price to the least.</span></span>

<span data-ttu-id="b46a5-276">若要实现此目的，请将按钮 Web 控件添加到页，将其 `ID` 属性设置为 `SortPriceDescending`，并将其 `Text` 属性设置为按价格排序。</span><span class="sxs-lookup"><span data-stu-id="b46a5-276">To accomplish this add a Button Web control to the page, set its `ID` property to `SortPriceDescending`, and its `Text` property to Sort by Price.</span></span> <span data-ttu-id="b46a5-277">接下来，通过双击设计器中的 "按钮" 控件，为按钮 s `Click` 事件创建事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="b46a5-277">Next, create an event handler for the Button s `Click` event by double-clicking the Button control in the Designer.</span></span> <span data-ttu-id="b46a5-278">将以下代码添加到此事件处理程序：</span><span class="sxs-lookup"><span data-stu-id="b46a5-278">Add the following code to this event handler:</span></span>

[!code-vb[Main](paging-and-sorting-report-data-vb/samples/sample10.vb)]

<span data-ttu-id="b46a5-279">单击此按钮会将用户返回到第一页，其中包含按价格排序的产品，从最昂贵到最昂贵的产品（见图15）。</span><span class="sxs-lookup"><span data-stu-id="b46a5-279">Clicking this Button returns the user to the first page with the products sorted by price, from most expensive to least expensive (see Figure 15).</span></span>

<span data-ttu-id="b46a5-280">[单击按钮 ![按最昂贵到最小](paging-and-sorting-report-data-vb/_static/image32.png)](paging-and-sorting-report-data-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="b46a5-280">[![Clicking the Button Orders the Products From the Most Expensive to the Least](paging-and-sorting-report-data-vb/_static/image32.png)](paging-and-sorting-report-data-vb/_static/image31.png)</span></span>

<span data-ttu-id="b46a5-281">**图 15**：单击按钮按最高到最低的顺序排列产品（[单击以查看完全尺寸的图像](paging-and-sorting-report-data-vb/_static/image33.png)）</span><span class="sxs-lookup"><span data-stu-id="b46a5-281">**Figure 15**: Clicking the Button Orders the Products From the Most Expensive to the Least ([Click to view full-size image](paging-and-sorting-report-data-vb/_static/image33.png))</span></span>

## <a name="summary"></a><span data-ttu-id="b46a5-282">总结</span><span class="sxs-lookup"><span data-stu-id="b46a5-282">Summary</span></span>

<span data-ttu-id="b46a5-283">在本教程中，我们介绍了如何实现默认分页和排序功能，这两者都与选中复选框一样简单！</span><span class="sxs-lookup"><span data-stu-id="b46a5-283">In this tutorial we saw how to implement default paging and sorting capabilities, both of which were as easy as checking a checkbox!</span></span> <span data-ttu-id="b46a5-284">当用户通过数据对数据进行排序时，类似的工作流将：</span><span class="sxs-lookup"><span data-stu-id="b46a5-284">When a user sorts or pages through data, a similar workflow unfolds:</span></span>

1. <span data-ttu-id="b46a5-285">回发可以</span><span class="sxs-lookup"><span data-stu-id="b46a5-285">A postback ensues</span></span>
2. <span data-ttu-id="b46a5-286">引发数据 Web 控件的预级别事件（`PageIndexChanging` 或 `Sorting`）</span><span class="sxs-lookup"><span data-stu-id="b46a5-286">The data Web control s pre-level event fires (`PageIndexChanging` or `Sorting`)</span></span>
3. <span data-ttu-id="b46a5-287">所有数据都由 ObjectDataSource 重新检索</span><span class="sxs-lookup"><span data-stu-id="b46a5-287">All of the data is re-retrieved by the ObjectDataSource</span></span>
4. <span data-ttu-id="b46a5-288">引发级别的数据 Web 控件后期事件（`PageIndexChanged` 或 `Sorted`）</span><span class="sxs-lookup"><span data-stu-id="b46a5-288">The data Web control s post-level event fires (`PageIndexChanged` or `Sorted`)</span></span>

<span data-ttu-id="b46a5-289">虽然实现基本分页和排序非常简单，但必须显然，才能利用更有效的自定义分页或进一步增强分页或排序接口。</span><span class="sxs-lookup"><span data-stu-id="b46a5-289">While implementing basic paging and sorting is a breeze, more effort must be exerted to utilize the more efficient custom paging or to further enhance the paging or sorting interface.</span></span> <span data-ttu-id="b46a5-290">将来的教程将探讨这些主题。</span><span class="sxs-lookup"><span data-stu-id="b46a5-290">Future tutorials will explore these topics.</span></span>

<span data-ttu-id="b46a5-291">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="b46a5-291">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="b46a5-292">关于作者</span><span class="sxs-lookup"><span data-stu-id="b46a5-292">About the Author</span></span>

<span data-ttu-id="b46a5-293">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，创始人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已在使用 Microsoft Web 技术，自1998开始。</span><span class="sxs-lookup"><span data-stu-id="b46a5-293">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="b46a5-294">Scott 的工作方式是独立的顾问、培训师和撰稿人。</span><span class="sxs-lookup"><span data-stu-id="b46a5-294">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="b46a5-295">他的最新书籍是，[*在24小时内，sam ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="b46a5-295">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="b46a5-296">可以[mitchell@4GuysFromRolla.com访问。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="b46a5-296">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="b46a5-297">或通过他的博客，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="b46a5-297">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="b46a5-298">[上一页](creating-a-customized-sorting-user-interface-cs.md)
> [下一页](efficiently-paging-through-large-amounts-of-data-vb.md)</span><span class="sxs-lookup"><span data-stu-id="b46a5-298">[Previous](creating-a-customized-sorting-user-interface-cs.md)
[Next](efficiently-paging-through-large-amounts-of-data-vb.md)</span></span>
