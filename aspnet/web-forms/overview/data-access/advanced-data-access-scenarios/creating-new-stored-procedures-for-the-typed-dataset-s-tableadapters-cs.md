---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs
title: 创建新存储过程的类型化数据集的 Tableadapter (C#) |Microsoft Docs
author: rick-anderson
description: 在之前的教程中，我们有在我们的代码中创建 SQL 语句，并传递到数据库后，要执行的语句。 另一种方法是使用 s...
ms.author: riande
ms.date: 07/18/2007
ms.assetid: 751282ca-5870-4d66-84e4-6cefae23eb4a
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs
msc.type: authoredcontent
ms.openlocfilehash: 8ede51ea943fc7e2a3bb4e0c96a526648e4b8687
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/09/2019
ms.locfileid: "59422039"
---
# <a name="creating-new-stored-procedures-for-the-typed-datasets-tableadapters-c"></a><span data-ttu-id="04766-104">新建适用于类型化数据集的 TableAdapter 的存储过程 (C#)</span><span class="sxs-lookup"><span data-stu-id="04766-104">Creating New Stored Procedures for the Typed DataSet's TableAdapters (C#)</span></span>

<span data-ttu-id="04766-105">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="04766-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="04766-106">[下载代码](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_67_CS.zip)或[下载 PDF](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/datatutorial67cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="04766-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_67_CS.zip) or [Download PDF](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/datatutorial67cs1.pdf)</span></span>

> <span data-ttu-id="04766-107">在之前的教程中，我们有在我们的代码中创建 SQL 语句，并传递到数据库后，要执行的语句。</span><span class="sxs-lookup"><span data-stu-id="04766-107">In earlier tutorials we have created SQL statements in our code and passed the statements to the database to be executed.</span></span> <span data-ttu-id="04766-108">另一种方法是使用存储的过程的 SQL 语句都是在数据库中预定义。</span><span class="sxs-lookup"><span data-stu-id="04766-108">An alternative approach is to use stored procedures, where the SQL statements are pre-defined at the database.</span></span> <span data-ttu-id="04766-109">在本教程中我们将了解如何使用 TableAdapter 向导为我们生成新的存储的过程。</span><span class="sxs-lookup"><span data-stu-id="04766-109">In this tutorial we learn how to have the TableAdapter Wizard generate new stored procedures for us.</span></span>


## <a name="introduction"></a><span data-ttu-id="04766-110">介绍</span><span class="sxs-lookup"><span data-stu-id="04766-110">Introduction</span></span>

<span data-ttu-id="04766-111">这些教程中的数据访问层 (DAL) 使用类型化数据集。</span><span class="sxs-lookup"><span data-stu-id="04766-111">The Data Access Layer (DAL) for these tutorials uses Typed DataSets.</span></span> <span data-ttu-id="04766-112">如中所述[创建数据访问层](../introduction/creating-a-data-access-layer-cs.md)教程中，类型化数据集包含强类型化 Datatable 和 Tableadapter。</span><span class="sxs-lookup"><span data-stu-id="04766-112">As discussed in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-cs.md) tutorial, Typed DataSets consist of strongly-typed DataTables and TableAdapters.</span></span> <span data-ttu-id="04766-113">DataTables 时要执行数据访问工作单位的基础数据库的 Tableadapter 接口在系统中表示的逻辑实体。</span><span class="sxs-lookup"><span data-stu-id="04766-113">The DataTables represent the logical entities in the system while the TableAdapters interface with the underlying database to perform the data access work.</span></span> <span data-ttu-id="04766-114">这包括填充数据表的数据、 执行返回标量数据的查询和插入、 更新和删除数据库中的记录。</span><span class="sxs-lookup"><span data-stu-id="04766-114">This includes populating the DataTables with data, executing queries that return scalar data, and inserting, updating, and deleting records from the database.</span></span>

<span data-ttu-id="04766-115">Tableadapter 所执行的 SQL 命令可以是任一临时 SQL 语句，如`SELECT columnList FROM TableName`，或存储过程。</span><span class="sxs-lookup"><span data-stu-id="04766-115">The SQL commands executed by the TableAdapters can be either ad-hoc SQL statements, such as `SELECT columnList FROM TableName`, or stored procedures.</span></span> <span data-ttu-id="04766-116">我们的体系结构中对 Tableadapter 使用临时 SQL 语句。</span><span class="sxs-lookup"><span data-stu-id="04766-116">The TableAdapters in our architecture use ad-hoc SQL statements.</span></span> <span data-ttu-id="04766-117">许多开发人员和数据库管理员，但是，首选的存储的过程而不是临时 SQL 语句的安全性、 可维护性和可更新性的原因。</span><span class="sxs-lookup"><span data-stu-id="04766-117">Many developers and database administrators, however, prefer stored procedures over ad-hoc SQL statements for security, maintainability, and updatability reasons.</span></span> <span data-ttu-id="04766-118">有些用户则 ardently 选择其灵活性的临时 SQL 语句。</span><span class="sxs-lookup"><span data-stu-id="04766-118">Others ardently prefer ad-hoc SQL statements for their flexibility.</span></span> <span data-ttu-id="04766-119">在我自己的工作中我优先通过临时 SQL 语句的存储的过程，但选择使用临时 SQL 语句来简化之前的教程。</span><span class="sxs-lookup"><span data-stu-id="04766-119">In my own work I favor stored procedures over ad-hoc SQL statements, but chose to use ad-hoc SQL statements to simplify the earlier tutorials.</span></span>

<span data-ttu-id="04766-120">当定义 TableAdapter，或添加新方法，TableAdapter 的向导，可以就像可以轻松地创建新的存储的过程或使用现有存储的过程一样，使用临时 SQL 语句。</span><span class="sxs-lookup"><span data-stu-id="04766-120">When defining a TableAdapter or adding new methods, the TableAdapter s wizard makes it just as easy to create new stored procedures or use existing stored procedures as it does to use ad-hoc SQL statements.</span></span> <span data-ttu-id="04766-121">在本教程中我们将介绍如何让 TableAdapter 的向导自动生成的存储的过程。</span><span class="sxs-lookup"><span data-stu-id="04766-121">In this tutorial we'll examine how to have the TableAdapter s wizard auto-generate stored procedures.</span></span> <span data-ttu-id="04766-122">在下一教程中我们将探讨如何配置 TableAdapter 的方法以使用现有的或手动创建的存储的过程。</span><span class="sxs-lookup"><span data-stu-id="04766-122">In the next tutorial we will look at how to configure the TableAdapter s methods to use existing or manually-created stored procedures.</span></span>

> [!NOTE]
> <span data-ttu-id="04766-123">请参阅 Rob Howard 的博客文章[尚不使用存储过程？](http://grokable.com/2003/11/dont-use-stored-procedures-yet-must-be-suffering-from-nihs-not-invented-here-syndrome/)并[Frans Bouma](https://weblogs.asp.net/fbouma/) s 博客文章[存储过程是坏，M Kay？](https://weblogs.asp.net/fbouma/archive/2003/11/18/38178.aspx)的优、 缺点的热烈争论存储的过程和即席 SQL。</span><span class="sxs-lookup"><span data-stu-id="04766-123">See Rob Howard's blog entry [Don't Use Stored Procedures Yet?](http://grokable.com/2003/11/dont-use-stored-procedures-yet-must-be-suffering-from-nihs-not-invented-here-syndrome/) and [Frans Bouma](https://weblogs.asp.net/fbouma/) s blog entry [Stored Procedures are Bad, M Kay?](https://weblogs.asp.net/fbouma/archive/2003/11/18/38178.aspx) for a lively debate on the pros and cons of stored procedures and ad-hoc SQL.</span></span>


## <a name="stored-procedure-basics"></a><span data-ttu-id="04766-124">存储的过程的基础知识</span><span class="sxs-lookup"><span data-stu-id="04766-124">Stored Procedure Basics</span></span>

<span data-ttu-id="04766-125">函数是普遍适用于所有的编程语言的构造。</span><span class="sxs-lookup"><span data-stu-id="04766-125">Functions are a construct common to all programming languages.</span></span> <span data-ttu-id="04766-126">函数是函数调用时执行的语句的集合。</span><span class="sxs-lookup"><span data-stu-id="04766-126">A function is a collection of statements that are executed when the function is called.</span></span> <span data-ttu-id="04766-127">函数可以接受输入的参数，并可能会选择性地返回一个值。</span><span class="sxs-lookup"><span data-stu-id="04766-127">Functions can accept input parameters and may optionally return a value.</span></span> <span data-ttu-id="04766-128">*[存储过程](http://en.wikipedia.org/wiki/Stored_procedure)* 是数据库构造，它们与编程语言中的函数共享许多相似之处。</span><span class="sxs-lookup"><span data-stu-id="04766-128">*[Stored procedures](http://en.wikipedia.org/wiki/Stored_procedure)* are database constructs that share many similarities with functions in programming languages.</span></span> <span data-ttu-id="04766-129">存储的过程由一组时调用该存储的过程执行的 T-SQL 的语句组成。</span><span class="sxs-lookup"><span data-stu-id="04766-129">A stored procedure is made up of a set of T-SQL statements that are executed when the stored procedure is called.</span></span> <span data-ttu-id="04766-130">存储的过程可以接受零到多个输入参数和可以返回标量值，输出参数，或者是，大多数情况下，结果集从`SELECT`查询。</span><span class="sxs-lookup"><span data-stu-id="04766-130">A stored procedure may accept zero to many input parameters and can return scalar values, output parameters, or, most commonly, result sets from `SELECT` queries.</span></span>

> [!NOTE]
> <span data-ttu-id="04766-131">存储的过程通常称为存储过程或 SPs。</span><span class="sxs-lookup"><span data-stu-id="04766-131">Stored procedures are oftentimes referred to as sprocs or SPs .</span></span>


<span data-ttu-id="04766-132">使用创建的存储的过程[ `CREATE PROCEDURE` ](https://msdn.microsoft.com/library/aa258259(SQL.80).aspx) T-SQL 的语句。</span><span class="sxs-lookup"><span data-stu-id="04766-132">Stored procedures are created using the [`CREATE PROCEDURE`](https://msdn.microsoft.com/library/aa258259(SQL.80).aspx) T-SQL statement.</span></span> <span data-ttu-id="04766-133">例如，以下 T-SQL 脚本创建一个名为的存储的过程`GetProductsByCategoryID`中名为的单个参数采用`@CategoryID`，并返回`ProductID`， `ProductName`， `UnitPrice`，并`Discontinued`中列的字段`Products`表具有匹配的`CategoryID`值：</span><span class="sxs-lookup"><span data-stu-id="04766-133">For example, the following T-SQL script creates a stored procedure named `GetProductsByCategoryID` that takes in a single parameter named `@CategoryID` and returns the `ProductID`, `ProductName`, `UnitPrice`, and `Discontinued` fields of those columns in the `Products` table that have a matching `CategoryID` value:</span></span>


[!code-sql[Main](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample1.sql)]

<span data-ttu-id="04766-134">一旦创建此存储的过程后，它可以使用以下语法进行调用：</span><span class="sxs-lookup"><span data-stu-id="04766-134">Once this stored procedure has been created, it can be called using the following syntax:</span></span>


[!code-sql[Main](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample2.sql)]

> [!NOTE]
> <span data-ttu-id="04766-135">在下一教程中，我们将说明创建存储的过程通过 Visual Studio IDE。</span><span class="sxs-lookup"><span data-stu-id="04766-135">In the next tutorial we will examine creating stored procedures through the Visual Studio IDE.</span></span> <span data-ttu-id="04766-136">对于本教程中，但是，我们将让 TableAdapter 向导自动为我们生成的存储的过程。</span><span class="sxs-lookup"><span data-stu-id="04766-136">For this tutorial, however, we are going to let the TableAdapter wizard automatically generate the stored procedures for us.</span></span>


<span data-ttu-id="04766-137">除了简单地返回数据，存储的过程通常用于执行单个事务的作用域内的多个数据库命令。</span><span class="sxs-lookup"><span data-stu-id="04766-137">In addition to simply returning data, stored procedures are often used to perform multiple database commands within the scope of a single transaction.</span></span> <span data-ttu-id="04766-138">一个名为的存储的过程`DeleteCategory`，例如，可能需要`@CategoryID`参数，并执行两个`DELETE`语句： 第，一个删除相关的产品和第二个删除指定的类别。</span><span class="sxs-lookup"><span data-stu-id="04766-138">A stored procedure named `DeleteCategory`, for example, might take in a `@CategoryID` parameter and perform two `DELETE` statements: first, one to delete the related products and a second one deleting the specified category.</span></span> <span data-ttu-id="04766-139">存储过程中的多个语句都*不*自动包装在事务中。</span><span class="sxs-lookup"><span data-stu-id="04766-139">Multiple statements within a stored procedure are *not* automatically wrapped within a transaction.</span></span> <span data-ttu-id="04766-140">其他的 T-SQL 命令需要发出消息，以确保存储的过程的多个命令将被视为原子操作的 s。</span><span class="sxs-lookup"><span data-stu-id="04766-140">Additional T-SQL commands need to be issued to ensure the stored procedure s multiple commands are treated as an atomic operation.</span></span> <span data-ttu-id="04766-141">我们将了解如何在后续教程中的事务的作用域内换行的存储的过程的命令。</span><span class="sxs-lookup"><span data-stu-id="04766-141">We'll see how to wrap a stored procedure s commands within the scope of a transaction in the subsequent tutorial.</span></span>

<span data-ttu-id="04766-142">在体系结构中使用存储的过程，数据访问层的方法将调用特定的存储的过程，而不是发出的临时 SQL 语句。</span><span class="sxs-lookup"><span data-stu-id="04766-142">When using stored procedures within an architecture, the Data Access Layer s methods invoke a particular stored procedure rather than issuing an ad-hoc SQL statement.</span></span> <span data-ttu-id="04766-143">而不是让它在应用程序 s 体系结构内定义，可集中管理 （数据库） 上执行的 SQL 语句的位置。</span><span class="sxs-lookup"><span data-stu-id="04766-143">This centralizes the location of the SQL statements executed (on the database) rather than having it defined within the application s architecture.</span></span> <span data-ttu-id="04766-144">此集中管理可以说是可更轻松地查找、 分析和优化查询，并可清楚地了解有关在何处以及如何使用的数据库。</span><span class="sxs-lookup"><span data-stu-id="04766-144">This centralization arguably makes it easier to find, analyze, and tune the queries and provides a much clearer picture as to where and how the database is being used.</span></span>

<span data-ttu-id="04766-145">有关存储的过程的基础知识的详细信息，请在本教程末尾查阅更多参考资料部分中的资源。</span><span class="sxs-lookup"><span data-stu-id="04766-145">For more information on stored procedure fundamentals, consult the resources in the Further Reading section at the end of this tutorial.</span></span>

## <a name="step-1-creating-the-advanced-data-access-layer-scenarios-web-pages"></a><span data-ttu-id="04766-146">步骤 1：创建高级的数据访问层方案网页</span><span class="sxs-lookup"><span data-stu-id="04766-146">Step 1: Creating the Advanced Data Access Layer Scenarios Web Pages</span></span>

<span data-ttu-id="04766-147">我们开始讨论创建使用存储的过程的 DAL 之前，让我们来先花点时间在我们的网站项目，我们将需要为它和下一步的多个教程中创建的 ASP.NET 页面。</span><span class="sxs-lookup"><span data-stu-id="04766-147">Before we start our discussion on creating a DAL using stored procedures, let s first take a moment to create the ASP.NET pages in our website project that we will need for this and the next several tutorials.</span></span> <span data-ttu-id="04766-148">首先，通过添加一个名为的新文件夹`AdvancedDAL`。</span><span class="sxs-lookup"><span data-stu-id="04766-148">Start by adding a new folder named `AdvancedDAL`.</span></span> <span data-ttu-id="04766-149">接下来，将以下 ASP.NET 页面添加到该文件夹，并确保将与每个页面相关联`Site.master`母版页：</span><span class="sxs-lookup"><span data-stu-id="04766-149">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `NewSprocs.aspx`
- `ExistingSprocs.aspx`
- `JOINs.aspx`
- `AddingColumns.aspx`
- `ComputedColumns.aspx`
- `EncryptingConfigSections.aspx`
- `ManagedFunctionsAndSprocs.aspx`


![添加 ASP.NET 页的高级的数据访问层方案教程](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image1.png)

<span data-ttu-id="04766-151">**图 1**:添加 ASP.NET 页的高级的数据访问层方案教程</span><span class="sxs-lookup"><span data-stu-id="04766-151">**Figure 1**: Add the ASP.NET Pages for the Advanced Data Access Layer Scenarios Tutorials</span></span>


<span data-ttu-id="04766-152">在其他文件夹中，喜欢`Default.aspx`在`AdvancedDAL`文件夹将在其部分中列出的教程。</span><span class="sxs-lookup"><span data-stu-id="04766-152">Like in the other folders, `Default.aspx` in the `AdvancedDAL` folder will list the tutorials in its section.</span></span> <span data-ttu-id="04766-153">请记住，`SectionLevelTutorialListing.ascx`用户控件提供了此功能。</span><span class="sxs-lookup"><span data-stu-id="04766-153">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="04766-154">因此，此用户控件添加到`Default.aspx`通过从解决方案资源管理器中拖到页面上的设计视图中拖动。</span><span class="sxs-lookup"><span data-stu-id="04766-154">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>


[![A<span data-ttu-id="04766-155">dd SectionLevelTutorialListing.ascx 用户控件到 Default.aspx]</span><span class="sxs-lookup"><span data-stu-id="04766-155">dd the SectionLevelTutorialListing.ascx User Control to Default.aspx]</span></span>(creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image3.png)](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image2.png)

<span data-ttu-id="04766-156">**图 2**:添加`SectionLevelTutorialListing.ascx`到用户控件`Default.aspx`([单击以查看实际尺寸的图像](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="04766-156">**Figure 2**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image4.png))</span></span>


<span data-ttu-id="04766-157">最后，将这些页面添加到条目为`Web.sitemap`文件。</span><span class="sxs-lookup"><span data-stu-id="04766-157">Lastly, add these pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="04766-158">具体而言，在处理批处理数据后添加以下标记`<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="04766-158">Specifically, add the following markup after the Working with Batched Data `<siteMapNode>`:</span></span>


[!code-xml[Main](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample3.xml)]

<span data-ttu-id="04766-159">更新后`Web.sitemap`，花点时间查看通过浏览器网站的教程。</span><span class="sxs-lookup"><span data-stu-id="04766-159">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="04766-160">在左侧菜单现在为高级 DAL 方案教程包括的项。</span><span class="sxs-lookup"><span data-stu-id="04766-160">The menu on the left now includes items for the advanced DAL scenarios tutorials.</span></span>


![站点图现在包括项的高级的 DAL 方案教程](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image5.png)

<span data-ttu-id="04766-162">**图 3**:站点图现在包括项的高级的 DAL 方案教程</span><span class="sxs-lookup"><span data-stu-id="04766-162">**Figure 3**: The Site Map Now Includes Entries for the Advanced DAL Scenarios Tutorials</span></span>


## <a name="step-2-configuring-a-tableadapter-to-create-new-stored-procedures"></a><span data-ttu-id="04766-163">步骤 2：配置 TableAdapter 创建新存储过程</span><span class="sxs-lookup"><span data-stu-id="04766-163">Step 2: Configuring a TableAdapter to Create New Stored Procedures</span></span>

<span data-ttu-id="04766-164">若要演示如何创建数据访问层，而不是临时 SQL 语句中使用存储的过程，让 s 创建新类型中的数据集`~/App_Code/DAL`文件夹名为`NorthwindWithSprocs.xsd`。</span><span class="sxs-lookup"><span data-stu-id="04766-164">To demonstrate creating a Data Access Layer that uses stored procedures instead of ad-hoc SQL statements, let s create a new Typed DataSet in the `~/App_Code/DAL` folder named `NorthwindWithSprocs.xsd`.</span></span> <span data-ttu-id="04766-165">由于我们已在前面的教程中逐步完成此过程的详细信息，我们将继续快速完成此处的步骤。</span><span class="sxs-lookup"><span data-stu-id="04766-165">Since we have stepped through this process in detail in previous tutorials, we will proceed quickly through the steps here.</span></span> <span data-ttu-id="04766-166">如果你有疑问或需要进一步中创建和配置类型的数据集的分步说明，请返回到[创建数据访问层](../introduction/creating-a-data-access-layer-cs.md)教程。</span><span class="sxs-lookup"><span data-stu-id="04766-166">If you get stuck or need further step-by-step instructions in creating and configuring a Typed DataSet, refer back to the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-cs.md) tutorial.</span></span>

<span data-ttu-id="04766-167">向项目添加新的数据集，通过右键单击`DAL`文件夹中，选择添加新项，然后选择数据集模板，如图 4 中所示。</span><span class="sxs-lookup"><span data-stu-id="04766-167">Add a new DataSet to the project by right-clicking on the `DAL` folder, choosing Add New Item, and selecting the DataSet template as shown in Figure 4.</span></span>


[![A<span data-ttu-id="04766-168">dd 新类型化数据集，以便项目名为 NorthwindWithSprocs.xsd]</span><span class="sxs-lookup"><span data-stu-id="04766-168">dd a New Typed DataSet to the Project Named NorthwindWithSprocs.xsd]</span></span>(creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image7.png)](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image6.png)

<span data-ttu-id="04766-169">**图 4**:将新的类型化数据集添加到项目名为`NorthwindWithSprocs.xsd`([单击以查看实际尺寸的图像](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="04766-169">**Figure 4**: Add a New Typed DataSet to the Project Named `NorthwindWithSprocs.xsd` ([Click to view full-size image](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image8.png))</span></span>


<span data-ttu-id="04766-170">这会创建新的类型化数据集、 打开其设计器中，创建新的 TableAdapter，并启动 TableAdapter 配置向导。</span><span class="sxs-lookup"><span data-stu-id="04766-170">This will create the new Typed DataSet, open its Designer, create a new TableAdapter, and launch the TableAdapter Configuration Wizard.</span></span> <span data-ttu-id="04766-171">TableAdapter 配置向导 s 第一步让我们选择要使用的数据库。</span><span class="sxs-lookup"><span data-stu-id="04766-171">The TableAdapter Configuration Wizard s first step asks us to select the database to work with.</span></span> <span data-ttu-id="04766-172">Northwind 数据库的连接字符串应在下拉列表中列出。</span><span class="sxs-lookup"><span data-stu-id="04766-172">The connection string to the Northwind database should be listed in the drop-down list.</span></span> <span data-ttu-id="04766-173">选择此选项，然后单击下一步。</span><span class="sxs-lookup"><span data-stu-id="04766-173">Select this and click Next.</span></span>

<span data-ttu-id="04766-174">此下一屏幕中，我们可以选择 TableAdapter 应如何访问数据库。</span><span class="sxs-lookup"><span data-stu-id="04766-174">From this next screen we can choose how the TableAdapter should access the database.</span></span> <span data-ttu-id="04766-175">在前面的教程中，我们选择了第一个选项，使用 SQL 语句。</span><span class="sxs-lookup"><span data-stu-id="04766-175">In previous tutorials, we selected the first option, Use SQL statements.</span></span> <span data-ttu-id="04766-176">对于本教程，选择第二个选项、 创建新的存储的过程，并单击下一步。</span><span class="sxs-lookup"><span data-stu-id="04766-176">For this tutorial, select the second option, Create new stored procedures, and click Next.</span></span>


[![I<span data-ttu-id="04766-177">nstruct 到创建新存储过程的 TableAdapter]</span><span class="sxs-lookup"><span data-stu-id="04766-177">nstruct the TableAdapter to Create New Stored Procedures]</span></span>(creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image10.png)](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image9.png)

<span data-ttu-id="04766-178">**图 5**:指示 TableAdapter 创建新存储过程 ([单击此项可查看原尺寸图像](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image11.png))</span><span class="sxs-lookup"><span data-stu-id="04766-178">**Figure 5**: Instruct the TableAdapter to Create New Stored Procedures ([Click to view full-size image](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image11.png))</span></span>


<span data-ttu-id="04766-179">就像使用临时 SQL 语句，在下一步我们会要求提供`SELECT`TableAdapter s 主查询的语句。</span><span class="sxs-lookup"><span data-stu-id="04766-179">Just like with using ad-hoc SQL statements, in the following step we are asked to provide the `SELECT` statement for the TableAdapter s main query.</span></span> <span data-ttu-id="04766-180">但而不是使用`SELECT`在此处输入直接执行即席查询的语句，TableAdapter 的向导将创建包含此存储的过程`SELECT`查询。</span><span class="sxs-lookup"><span data-stu-id="04766-180">But instead of using the `SELECT` statement entered here to perform an ad-hoc query directly, the TableAdapter s wizard will create a stored procedure that contains this `SELECT` query.</span></span>

<span data-ttu-id="04766-181">使用以下`SELECT`此 TableAdapter 的查询：</span><span class="sxs-lookup"><span data-stu-id="04766-181">Use the following `SELECT` query for this TableAdapter:</span></span>


[!code-sql[Main](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample4.sql)]


[![E<span data-ttu-id="04766-182">nter SELECT 查询]</span><span class="sxs-lookup"><span data-stu-id="04766-182">nter the SELECT Query]</span></span>(creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image13.png)](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image12.png)

<span data-ttu-id="04766-183">**图 6**:输入`SELECT`查询 ([单击以查看实际尺寸的图像](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="04766-183">**Figure 6**: Enter the `SELECT` Query ([Click to view full-size image](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image14.png))</span></span>


> [!NOTE]
> <span data-ttu-id="04766-184">上述查询稍有不同的主查询`ProductsTableAdapter`在`Northwind`类型化数据集。</span><span class="sxs-lookup"><span data-stu-id="04766-184">The query above differs slightly from the main query of the `ProductsTableAdapter` in the `Northwind` Typed DataSet.</span></span> <span data-ttu-id="04766-185">请记住，`ProductsTableAdapter`在`Northwind`类型化数据集包含两个相关的子查询，以使重新类别名称和每个产品的类别和供应商的公司名称。</span><span class="sxs-lookup"><span data-stu-id="04766-185">Recall that the `ProductsTableAdapter` in the `Northwind` Typed DataSet includes two correlated subqueries to bring back the category name and company name for each product s category and supplier.</span></span> <span data-ttu-id="04766-186">在即将推出[使用联接到更新 TableAdapter](updating-the-tableadapter-to-use-joins-cs.md)教程中我们将查看添加到此 TableAdapter 相关数据。</span><span class="sxs-lookup"><span data-stu-id="04766-186">In the upcoming [Updating the TableAdapter to Use JOINs](updating-the-tableadapter-to-use-joins-cs.md) tutorial we will look at adding this related data to this TableAdapter.</span></span>


<span data-ttu-id="04766-187">花点时间单击高级选项按钮。</span><span class="sxs-lookup"><span data-stu-id="04766-187">Take a moment to click the Advanced Options button.</span></span> <span data-ttu-id="04766-188">在此处，我们可以指定是否在向导应还生成 insert、 update 和 delete 语句的 TableAdapter，是否使用乐观并发，以及是否应在插入和更新后刷新数据表。</span><span class="sxs-lookup"><span data-stu-id="04766-188">From here we can specify whether the wizard should also generate insert, update, and delete statements for the TableAdapter, whether to use optimistic concurrency, and whether the data table should be refreshed after inserts and updates.</span></span> <span data-ttu-id="04766-189">默认情况下检查生成 Insert、 Update 和 Delete 语句选项。</span><span class="sxs-lookup"><span data-stu-id="04766-189">The Generate Insert, Update and Delete statements option is checked by default.</span></span> <span data-ttu-id="04766-190">将其选中。</span><span class="sxs-lookup"><span data-stu-id="04766-190">Leave it checked.</span></span> <span data-ttu-id="04766-191">对于本教程，请取消选中使用开放式并发选项。</span><span class="sxs-lookup"><span data-stu-id="04766-191">For this tutorial, leave the Use optimistic concurrency options unchecked.</span></span>

<span data-ttu-id="04766-192">当遇到 TableAdapter 向导会自动创建的存储的过程，它将显示，刷新数据的表选项将被忽略。</span><span class="sxs-lookup"><span data-stu-id="04766-192">When having the stored procedures automatically created by the TableAdapter wizard, it appears that the Refresh the data table option is ignored.</span></span> <span data-ttu-id="04766-193">无论是否选中此复选框、 生成 insert 和 update 存储的过程检索只需插入或只是更新的记录，正如我们将在步骤 3 中看到。</span><span class="sxs-lookup"><span data-stu-id="04766-193">Regardless of whether this checkbox is checked, the resulting insert and update stored procedures retrieve the just-inserted or just-updated record, as we will see in Step 3.</span></span>


![保留选中选项生成 Insert、 Update 和 Delete 语句](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image15.png)

<span data-ttu-id="04766-195">**图 7**:保留选中选项生成 Insert、 Update 和 Delete 语句</span><span class="sxs-lookup"><span data-stu-id="04766-195">**Figure 7**: Leave the Generate Insert, Update and Delete statements Option Checked</span></span>


> [!NOTE]
> <span data-ttu-id="04766-196">如果选中使用开放式并发选项，则该向导将添加到其他条件`WHERE`阻止中如果存在其他字段中的更改更新数据的子句。</span><span class="sxs-lookup"><span data-stu-id="04766-196">If the Use optimistic concurrency option is checked, the wizard will add additional conditions to the `WHERE` clause that prevent data from being updated if there were changes in other fields.</span></span> <span data-ttu-id="04766-197">回头[实现乐观并发](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-cs.md)教程，以使用 TableAdapter s 内置乐观并发控制功能的详细信息。</span><span class="sxs-lookup"><span data-stu-id="04766-197">Refer back to the [Implementing Optimistic Concurrency](../editing-inserting-and-deleting-data/implementing-optimistic-concurrency-cs.md) tutorial for more information on using the TableAdapter s built-in optimistic concurrency control feature.</span></span>


<span data-ttu-id="04766-198">输入后`SELECT`查询并确认，生成 Insert、 Update 和 Delete 语句选项处于选中状态，单击下一步。</span><span class="sxs-lookup"><span data-stu-id="04766-198">After entering the `SELECT` query and confirming that the Generate Insert, Update and Delete statements option is checked, click Next.</span></span> <span data-ttu-id="04766-199">此图 8 所示的下一个屏幕会提示选择、 插入、 更新和删除数据的向导将创建的存储过程的名称。</span><span class="sxs-lookup"><span data-stu-id="04766-199">This next screen, shown in Figure 8, prompts for the names of the stored procedures the wizard will create for selecting, inserting, updating, and deleting data.</span></span> <span data-ttu-id="04766-200">更改这些存储过程名称传递给`Products_Select`， `Products_Insert`， `Products_Update`，和`Products_Delete`。</span><span class="sxs-lookup"><span data-stu-id="04766-200">Change these stored procedures names to `Products_Select`, `Products_Insert`, `Products_Update`, and `Products_Delete`.</span></span>


[![R<span data-ttu-id="04766-201">ename 存储过程]</span><span class="sxs-lookup"><span data-stu-id="04766-201">ename the Stored Procedures]</span></span>(creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image17.png)](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image16.png)

<span data-ttu-id="04766-202">**图 8**:重命名存储过程 ([单击此项可查看原尺寸图像](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="04766-202">**Figure 8**: Rename the Stored Procedures ([Click to view full-size image](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image18.png))</span></span>


<span data-ttu-id="04766-203">若要查看 T-SQL 使用 TableAdapter 向导将创建四个存储的过程，请单击预览 SQL 脚本按钮。</span><span class="sxs-lookup"><span data-stu-id="04766-203">To see the T-SQL the TableAdapter wizard will use to create the four stored procedures, click the Preview SQL Script button.</span></span> <span data-ttu-id="04766-204">从预览 SQL 脚本对话框中可能会将脚本保存到文件或将其复制到剪贴板。</span><span class="sxs-lookup"><span data-stu-id="04766-204">From the Preview SQL Script dialog box you may save the script to a file or copy it to the clipboard.</span></span>


![预览用于生成存储的过程的 SQL 脚本](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image19.png)

<span data-ttu-id="04766-206">**图 9**:预览用于生成存储的过程的 SQL 脚本</span><span class="sxs-lookup"><span data-stu-id="04766-206">**Figure 9**: Preview the SQL Script Used to Generate the Stored Procedures</span></span>


<span data-ttu-id="04766-207">命名存储的过程之后, 单击旁边名为 TableAdapter s 对应的方法。</span><span class="sxs-lookup"><span data-stu-id="04766-207">After naming the stored procedures, click Next to name the TableAdapter s corresponding methods.</span></span> <span data-ttu-id="04766-208">就像时使用的临时 SQL 语句，我们可以创建填充现有数据表或返回一个新的方法。</span><span class="sxs-lookup"><span data-stu-id="04766-208">Just like when using ad-hoc SQL statements, we can create methods that fill an existing DataTable or return a new one.</span></span> <span data-ttu-id="04766-209">我们还可以指定是否 TableAdapter 应包括插入、 更新和删除记录的 DB 直接模式。</span><span class="sxs-lookup"><span data-stu-id="04766-209">We can also specify whether the TableAdapter should include the DB-Direct pattern for inserting, updating, and deleting records.</span></span> <span data-ttu-id="04766-210">保留选中状态，所有三个复选框，但重命名返回的 DataTable 方法`GetProducts`（如图 10 中所示）。</span><span class="sxs-lookup"><span data-stu-id="04766-210">Leave all three checkboxes checked, but rename the Return a DataTable method to `GetProducts` (as shown in Figure 10).</span></span>


[![N<span data-ttu-id="04766-211">名 （） 方法填充和 GetProducts]</span><span class="sxs-lookup"><span data-stu-id="04766-211">ame the Methods Fill and GetProducts]</span></span>(creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image21.png)](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image20.png)

<span data-ttu-id="04766-212">**图 10**:命名方法`Fill`并`GetProducts`([单击以查看实际尺寸的图像](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="04766-212">**Figure 10**: Name the Methods `Fill` and `GetProducts` ([Click to view full-size image](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image22.png))</span></span>


<span data-ttu-id="04766-213">单击下一步以查看向导将执行的步骤的摘要。</span><span class="sxs-lookup"><span data-stu-id="04766-213">Click Next to see a summary of the steps the wizard will perform.</span></span> <span data-ttu-id="04766-214">单击完成按钮完成该向导。</span><span class="sxs-lookup"><span data-stu-id="04766-214">Complete the wizard by clicking the Finish button.</span></span> <span data-ttu-id="04766-215">在向导完成时，您将返回到设计器，现在应包含的数据集 s `ProductsDataTable`。</span><span class="sxs-lookup"><span data-stu-id="04766-215">Once the wizard completes, you will be returned to the DataSet s Designer, which should now include the `ProductsDataTable`.</span></span>


[![T<span data-ttu-id="04766-216">他 s 数据集设计器会显示新添加 ProductsDataTable]</span><span class="sxs-lookup"><span data-stu-id="04766-216">he DataSet s Designer Shows the Newly Added ProductsDataTable]</span></span>(creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image24.png)](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image23.png)

<span data-ttu-id="04766-217">**图 11**:S 的数据集设计器显示新添加`ProductsDataTable`([单击以查看实际尺寸的图像](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="04766-217">**Figure 11**: The DataSet s Designer Shows the Newly Added `ProductsDataTable` ([Click to view full-size image](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image25.png))</span></span>


## <a name="step-3-examining-the-newly-created-stored-procedures"></a><span data-ttu-id="04766-218">步骤 3：检查新创建的存储的过程</span><span class="sxs-lookup"><span data-stu-id="04766-218">Step 3: Examining the Newly Created Stored Procedures</span></span>

<span data-ttu-id="04766-219">TableAdapter 向导会自动使用在步骤 2 中创建用于选择、 插入、 更新和删除数据的存储的过程。</span><span class="sxs-lookup"><span data-stu-id="04766-219">The TableAdapter wizard used in Step 2 automatically created the stored procedures for selecting, inserting, updating, and deleting data.</span></span> <span data-ttu-id="04766-220">这些存储的过程可以查看或修改通过 Visual Studio 通过转到服务器资源管理器并向下钻取到数据库 s 存储过程文件夹。</span><span class="sxs-lookup"><span data-stu-id="04766-220">These stored procedures can be viewed or modified through Visual Studio by going to the Server Explorer and drilling down into the database s Stored Procedures folder.</span></span> <span data-ttu-id="04766-221">如图 12 所示，Northwind 数据库包含四个新的存储的过程： `Products_Delete`， `Products_Insert`， `Products_Select`，和`Products_Update`。</span><span class="sxs-lookup"><span data-stu-id="04766-221">As Figure 12 shows, the Northwind database contains four new stored procedures: `Products_Delete`, `Products_Insert`, `Products_Select`, and `Products_Update`.</span></span>


![在步骤 2 中创建的四个存储的过程可以找到数据库 s 存储的过程文件夹中](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image26.png)

<span data-ttu-id="04766-223">**图 12**:在步骤 2 中创建的四个存储的过程可以找到数据库 s 存储的过程文件夹中</span><span class="sxs-lookup"><span data-stu-id="04766-223">**Figure 12**: The Four Stored Procedures Created in Step 2 Can Be Found in the Database s Stored Procedures Folder</span></span>


> [!NOTE]
> <span data-ttu-id="04766-224">如果看不到服务器资源管理器，转到视图菜单并选择服务器资源管理器选项。</span><span class="sxs-lookup"><span data-stu-id="04766-224">If you do not see the Server Explorer, go to the View menu and choose the Server Explorer option.</span></span> <span data-ttu-id="04766-225">如果看不到步骤 2 中添加的与产品相关的存储的过程，请尝试在存储过程文件夹上右键单击并选择刷新。</span><span class="sxs-lookup"><span data-stu-id="04766-225">If you do not see the product-related stored procedures added from Step 2, try right-clicking on the Stored Procedures folder and choosing Refresh.</span></span>


<span data-ttu-id="04766-226">若要查看或修改存储的过程，请双击其名称在服务器资源管理器或，或者，右键单击存储过程，并选择打开。</span><span class="sxs-lookup"><span data-stu-id="04766-226">To view or modify a stored procedure, double-click its name in the Server Explorer or, alternatively, right-click on the stored procedure and choose Open.</span></span> <span data-ttu-id="04766-227">图 13 显示了`Products_Delete`打开时的存储过程。</span><span class="sxs-lookup"><span data-stu-id="04766-227">Figure 13 shows the `Products_Delete` stored procedure, when opened.</span></span>


[![S<span data-ttu-id="04766-228">tored 过程可以打开和修改从在 Visual Studio]</span><span class="sxs-lookup"><span data-stu-id="04766-228">tored Procedures Can Be Opened and Modified From Within Visual Studio]</span></span>(creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image28.png)](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image27.png)

<span data-ttu-id="04766-229">**图 13**:存储过程可以打开和修改从在 Visual Studio ([单击此项可查看原尺寸图像](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image29.png))</span><span class="sxs-lookup"><span data-stu-id="04766-229">**Figure 13**: Stored Procedures Can Be Opened and Modified From Within Visual Studio ([Click to view full-size image](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image29.png))</span></span>


<span data-ttu-id="04766-230">二者的内容`Products_Delete`和`Products_Select`存储的过程都相当直截了当。</span><span class="sxs-lookup"><span data-stu-id="04766-230">The contents of both the `Products_Delete` and `Products_Select` stored procedures are quite straightforward.</span></span> <span data-ttu-id="04766-231">`Products_Insert`并`Products_Update`存储的过程，但是，值得仔细观察它们都执行`SELECT`后的语句及其`INSERT`和`UPDATE`语句。</span><span class="sxs-lookup"><span data-stu-id="04766-231">The `Products_Insert` and `Products_Update` stored procedures, on the other hand, warrant a closer inspection as they both perform a `SELECT` statement after their `INSERT` and `UPDATE` statements.</span></span> <span data-ttu-id="04766-232">例如，下面的 SQL 构成`Products_Insert`存储过程：</span><span class="sxs-lookup"><span data-stu-id="04766-232">For example, the following SQL makes up the `Products_Insert` stored procedure:</span></span>


[!code-sql[Main](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample5.sql)]

<span data-ttu-id="04766-233">存储的过程接受作为输入参数`Products`返回的列`SELECT`TableAdapter 的向导和这些值中指定的查询中使用`INSERT`语句。</span><span class="sxs-lookup"><span data-stu-id="04766-233">The stored procedure accepts as input parameters the `Products` columns that were returned by the `SELECT` query specified in the TableAdapter s wizard and these values are used in an `INSERT` statement.</span></span> <span data-ttu-id="04766-234">遵循`INSERT`语句中，`SELECT`查询用于返回`Products`列的值 (包括`ProductID`) 的新添加的记录。</span><span class="sxs-lookup"><span data-stu-id="04766-234">Following the `INSERT` statement, a `SELECT` query is used to return the `Products` column values (including the `ProductID`) of the newly added record.</span></span> <span data-ttu-id="04766-235">此刷新功能时，可以添加新记录，因为它使用批更新模式自动更新新添加`ProductRow`实例`ProductID`具有分配的数据库的自动递增的值的属性。</span><span class="sxs-lookup"><span data-stu-id="04766-235">This refresh capability is useful when adding a new record using the Batch Update pattern as it automatically updates the newly added `ProductRow` instances `ProductID` properties with the auto-incremented values assigned by the database.</span></span>

<span data-ttu-id="04766-236">下面的代码演示此功能。</span><span class="sxs-lookup"><span data-stu-id="04766-236">The following code illustrates this feature.</span></span> <span data-ttu-id="04766-237">它包含`ProductsTableAdapter`并`ProductsDataTable`为创建`NorthwindWithSprocs`类型化数据集。</span><span class="sxs-lookup"><span data-stu-id="04766-237">It contains a `ProductsTableAdapter` and `ProductsDataTable` created for the `NorthwindWithSprocs` Typed DataSet.</span></span> <span data-ttu-id="04766-238">通过创建一个新的产品添加到数据库`ProductsRow`实例，提供它的值，并调用 TableAdapter s`Update`方法，传入`ProductsDataTable`。</span><span class="sxs-lookup"><span data-stu-id="04766-238">A new product is added to the database by creating a `ProductsRow` instance, supplying its values, and calling the TableAdapter s `Update` method, passing in the `ProductsDataTable`.</span></span> <span data-ttu-id="04766-239">在内部，TableAdapter s`Update`方法枚举`ProductsRow`传入的 DataTable 中的实例 （在此示例中没有只有一个-我们只需添加），并执行相应的插入、 更新或删除命令。</span><span class="sxs-lookup"><span data-stu-id="04766-239">Internally, the TableAdapter s `Update` method enumerates the `ProductsRow` instances in the passed-in DataTable (in this example there is only one - the one we just added), and performs the appropriate insert, update, or delete command.</span></span> <span data-ttu-id="04766-240">在这种情况下，`Products_Insert`执行存储的过程时，将添加到新的记录`Products`表，并返回新添加的记录的详细信息。</span><span class="sxs-lookup"><span data-stu-id="04766-240">In this case, the `Products_Insert` stored procedure is executed, which adds a new record to the `Products` table and returns the details of the newly-added record.</span></span> <span data-ttu-id="04766-241">`ProductsRow`实例的`ProductID`然后更新值。</span><span class="sxs-lookup"><span data-stu-id="04766-241">The `ProductsRow` instance s `ProductID` value is then updated.</span></span> <span data-ttu-id="04766-242">之后`Update`方法后，我们就可以访问的新添加的记录 s`ProductID`值通过`ProductsRow`s`ProductID`属性。</span><span class="sxs-lookup"><span data-stu-id="04766-242">After the `Update` method has completed, we can access the newly-added record s `ProductID` value through the `ProductsRow` s `ProductID` property.</span></span>


[!code-csharp[Main](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample6.cs)]

<span data-ttu-id="04766-243">`Products_Update`存储的过程同样包括`SELECT`语句后的其`UPDATE`语句。</span><span class="sxs-lookup"><span data-stu-id="04766-243">The `Products_Update` stored procedure similarly includes a `SELECT` statement after its `UPDATE` statement.</span></span>


[!code-sql[Main](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample7.sql)]

<span data-ttu-id="04766-244">请注意，此存储过程包含两个输入的参数`ProductID`:`@Original_ProductID`和`@ProductID`。</span><span class="sxs-lookup"><span data-stu-id="04766-244">Note that this stored procedure includes two input parameters for `ProductID`: `@Original_ProductID` and `@ProductID`.</span></span> <span data-ttu-id="04766-245">此功能支持的方案可能已更改的主键。</span><span class="sxs-lookup"><span data-stu-id="04766-245">This functionality allows for scenarios where the primary key might be changed.</span></span> <span data-ttu-id="04766-246">例如，在员工数据库中，每个员工记录可能会使用员工的社会安全号码作为其主键。</span><span class="sxs-lookup"><span data-stu-id="04766-246">For example, in an employee database, each employee record might use the employee s social security number as their primary key.</span></span> <span data-ttu-id="04766-247">若要更改现有员工的社会安全号码，必须提供新的社会保障号和原始。</span><span class="sxs-lookup"><span data-stu-id="04766-247">In order to change an existing employee s social security number, both the new social security number and the original one must be supplied.</span></span> <span data-ttu-id="04766-248">有关`Products`无需执行表，此类功能，因为`ProductID`列为`IDENTITY`列，应永远不会更改。</span><span class="sxs-lookup"><span data-stu-id="04766-248">For the `Products` table, such functionality is not needed because the `ProductID` column is an `IDENTITY` column and should never be changed.</span></span> <span data-ttu-id="04766-249">事实上，`UPDATE`中的语句`Products_Update`存储的过程不包括`ProductID`其列列表中的列。</span><span class="sxs-lookup"><span data-stu-id="04766-249">In fact, the `UPDATE` statement in the `Products_Update` stored procedure doesn t include the `ProductID` column in its column list.</span></span> <span data-ttu-id="04766-250">因此，尽管`@Original_ProductID`中使用`UPDATE`语句 s`WHERE`子句，它是多余的`Products`表，并可通过替换`@ProductID`参数。</span><span class="sxs-lookup"><span data-stu-id="04766-250">So, while `@Original_ProductID` is used in the `UPDATE` statement s `WHERE` clause, it is superfluous for the `Products` table and could be replaced by the `@ProductID` parameter.</span></span> <span data-ttu-id="04766-251">修改存储的过程的参数时务必使用该存储的过程的 TableAdapter 方法也会更新。</span><span class="sxs-lookup"><span data-stu-id="04766-251">When modifying a stored procedure s parameters it is important that the TableAdapter method(s) that use that stored procedure are also updated.</span></span>

## <a name="step-4-modifying-a-stored-procedure-s-parameters-and-updating-the-tableadapter"></a><span data-ttu-id="04766-252">步骤 4：修改存储的过程的参数和更新 TableAdapter</span><span class="sxs-lookup"><span data-stu-id="04766-252">Step 4: Modifying a Stored Procedure s Parameters and Updating the TableAdapter</span></span>

<span data-ttu-id="04766-253">由于`@Original_ProductID`参数是多余，let s 删除从`Products_Update`完全存储过程。</span><span class="sxs-lookup"><span data-stu-id="04766-253">Since the `@Original_ProductID` parameter is superfluous, let s remove it from the `Products_Update` stored procedure altogether.</span></span> <span data-ttu-id="04766-254">打开`Products_Update`存储过程，删除`@Original_ProductID`参数，然后在`WHERE`子句`UPDATE`语句中，将更改从使用参数名称`@Original_ProductID`到`@ProductID`。</span><span class="sxs-lookup"><span data-stu-id="04766-254">Open the `Products_Update` stored procedure, delete the `@Original_ProductID` parameter, and, in the `WHERE` clause of the `UPDATE` statement, change the parameter name used from `@Original_ProductID` to `@ProductID`.</span></span> <span data-ttu-id="04766-255">进行这些更改后，T-SQL 存储过程中应如以下所示：</span><span class="sxs-lookup"><span data-stu-id="04766-255">After making these changes, the T-SQL within the stored procedure should look like the following:</span></span>


[!code-sql[Main](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample8.sql)]

<span data-ttu-id="04766-256">若要将这些更改保存到数据库中，单击工具栏中的保存图标或按 Ctrl + S。</span><span class="sxs-lookup"><span data-stu-id="04766-256">To save these changes to the database, click the Save icon in the toolbar or hit Ctrl+S.</span></span> <span data-ttu-id="04766-257">在此情况下，`Products_Update`存储的过程不需要`@Original_ProductID`输入的参数，但 TableAdapter 配置为通过此类参数。</span><span class="sxs-lookup"><span data-stu-id="04766-257">At this point, the `Products_Update` stored procedure does not expect an `@Original_ProductID` input parameter, but the TableAdapter is configured to pass such a parameter.</span></span> <span data-ttu-id="04766-258">您可以看到 TableAdapter 将发送到的参数`Products_Update`存储过程的 TableAdapter 选择数据集设计器中，转到属性窗口中，并单击中的省略号`UpdateCommand`s`Parameters`集合。</span><span class="sxs-lookup"><span data-stu-id="04766-258">You can see the parameters the TableAdapter will send to the `Products_Update` stored procedure by selecting the TableAdapter in the DataSet Designer, going to the Properties window, and clicking the ellipses in the `UpdateCommand` s `Parameters` collection.</span></span> <span data-ttu-id="04766-259">此时将显示图 14 中所示的参数集合编辑器对话框。</span><span class="sxs-lookup"><span data-stu-id="04766-259">This brings up the Parameters Collection Editor dialog box shown in Figure 14.</span></span>


![参数集合编辑器列表使用的参数传递给 Products_Update 存储过程](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image30.png)

<span data-ttu-id="04766-261">**图 14**:参数集合编辑器列表使用的参数传递给`Products_Update`存储过程</span><span class="sxs-lookup"><span data-stu-id="04766-261">**Figure 14**: The Parameters Collection Editor Lists the Parameters Used Passed to the `Products_Update` Stored Procedure</span></span>


<span data-ttu-id="04766-262">您可以从此处删除此参数，只需选择`@Original_ProductID`成员和单击删除按钮的列表中的参数。</span><span class="sxs-lookup"><span data-stu-id="04766-262">You can remove this parameter from here by simply selecting the `@Original_ProductID` parameter from the list of members and clicking the Remove button.</span></span>

<span data-ttu-id="04766-263">或者，可以刷新设计器中的 TableAdapter 上右键单击并选择配置用于所有方法的参数。</span><span class="sxs-lookup"><span data-stu-id="04766-263">Alternatively, you can refresh the parameters used for all of the methods by right-clicking on the TableAdapter in the Designer and choosing Configure.</span></span> <span data-ttu-id="04766-264">此时会弹出 TableAdapter 配置向导列出存储的过程用于选择、 插入、 更新和删除，以及参数的存储的过程，预计可以收到。</span><span class="sxs-lookup"><span data-stu-id="04766-264">This will bring up the TableAdapter Configuration wizard, listing the stored procedures used for selecting, inserting, updating, and deleting, along with the parameters the stored procedures expect to receive.</span></span> <span data-ttu-id="04766-265">如果在更新下拉列表中单击您所见`Products_Update`存储的过程预期的输入的参数，现在不再包括`@Original_ProductID`（请参阅图 15）。</span><span class="sxs-lookup"><span data-stu-id="04766-265">If you click on the Update drop-down list you can see the `Products_Update` stored procedures expected input parameters, which now no longer includes `@Original_ProductID` (see Figure 15).</span></span> <span data-ttu-id="04766-266">只需单击完成以自动更新使用 TableAdapter 的参数集合。</span><span class="sxs-lookup"><span data-stu-id="04766-266">Simply click Finish to automatically update the parameter collection used by the TableAdapter.</span></span>


[![Y<span data-ttu-id="04766-267">ou 可以使用配置向导来刷新其方法的参数集合中的 TableAdapter s]</span><span class="sxs-lookup"><span data-stu-id="04766-267">ou Can Alternatively Use the TableAdapter s Configuration Wizard to Refresh Its Methods Parameter Collections]</span></span>(creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image32.png)](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image31.png)

<span data-ttu-id="04766-268">**图 15**:也可以选择使用 TableAdapter s 配置向导来刷新其方法的参数集合 ([单击此项可查看原尺寸图像](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="04766-268">**Figure 15**: You Can Alternatively Use the TableAdapter s Configuration Wizard to Refresh Its Methods Parameter Collections ([Click to view full-size image](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image33.png))</span></span>


## <a name="step-5-adding-additional-tableadapter-methods"></a><span data-ttu-id="04766-269">步骤 5：添加更多 TableAdapter 方法</span><span class="sxs-lookup"><span data-stu-id="04766-269">Step 5: Adding Additional TableAdapter Methods</span></span>

<span data-ttu-id="04766-270">步骤 2 中所示，作为创建新的 TableAdapter 时很容易地具有自动生成的相应存储的过程。</span><span class="sxs-lookup"><span data-stu-id="04766-270">As Step 2 illustrated, when creating a new TableAdapter it is easy to have the corresponding stored procedures automatically generated.</span></span> <span data-ttu-id="04766-271">这同样适用向 TableAdapter 添加其他方法。</span><span class="sxs-lookup"><span data-stu-id="04766-271">The same is true when adding additional methods to a TableAdapter.</span></span> <span data-ttu-id="04766-272">为了说明这一点，让我们来添加`GetProductByProductID(productID)`方法`ProductsTableAdapter`步骤 2 中创建。</span><span class="sxs-lookup"><span data-stu-id="04766-272">To illustrate this, let s add a `GetProductByProductID(productID)` method to the `ProductsTableAdapter` created in Step 2.</span></span> <span data-ttu-id="04766-273">此方法将作为输入`ProductID`值并返回有关指定的产品的详细信息。</span><span class="sxs-lookup"><span data-stu-id="04766-273">This method will take as input a `ProductID` value and return details about the specified product.</span></span>

<span data-ttu-id="04766-274">首先在 TableAdapter 上右键单击并从上下文菜单中选择添加查询。</span><span class="sxs-lookup"><span data-stu-id="04766-274">Start by right-clicking on the TableAdapter and choosing Add Query from the context menu.</span></span>


![向 TableAdapter 添加一个新的查询](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image34.png)

<span data-ttu-id="04766-276">**图 16**:向 TableAdapter 添加一个新的查询</span><span class="sxs-lookup"><span data-stu-id="04766-276">**Figure 16**: Add a New Query to the TableAdapter</span></span>


<span data-ttu-id="04766-277">这将启动 TableAdapter 查询配置向导中，首先会提示输入 TableAdapter 应如何访问数据库。</span><span class="sxs-lookup"><span data-stu-id="04766-277">This will start the TableAdapter Query Configuration wizard, which first prompts for how the TableAdapter should access the database.</span></span> <span data-ttu-id="04766-278">若要创建的新存储的过程，选择创建新的存储的过程选项，然后单击下一步。</span><span class="sxs-lookup"><span data-stu-id="04766-278">To have a new stored procedure created, choose the Create a new stored procedure option and click Next.</span></span>


[![C<span data-ttu-id="04766-279">选择创建新的存储过程选项]</span><span class="sxs-lookup"><span data-stu-id="04766-279">hoose the Create a new stored procedure Option]</span></span>(creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image36.png)](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image35.png)

<span data-ttu-id="04766-280">**图 17**:选择创建新的存储的过程选项 ([单击此项可查看原尺寸图像](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image37.png))</span><span class="sxs-lookup"><span data-stu-id="04766-280">**Figure 17**: Choose the Create a new stored procedure Option ([Click to view full-size image](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image37.png))</span></span>


<span data-ttu-id="04766-281">下一个屏幕询问我们能够标识执行，它将返回一组行或单个标量值，或执行查询的类型`UPDATE`， `INSERT`，或`DELETE`语句。</span><span class="sxs-lookup"><span data-stu-id="04766-281">The next screen asks us to identify the type of query to execute, whether it will return a set of rows or a single scalar value, or perform an `UPDATE`, `INSERT`, or `DELETE` statement.</span></span> <span data-ttu-id="04766-282">由于`GetProductByProductID(productID)`方法将返回一行，将返回行选项选择并按下一步选择。</span><span class="sxs-lookup"><span data-stu-id="04766-282">Since the `GetProductByProductID(productID)` method will return a row, leave the SELECT which returns row option selected and hit Next.</span></span>


[![C<span data-ttu-id="04766-283">选择返回一行选项选择]</span><span class="sxs-lookup"><span data-stu-id="04766-283">hoose the SELECT which returns row Option]</span></span>(creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image39.png)](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image38.png)

<span data-ttu-id="04766-284">**图 18**:选择它将返回行选项 ([单击此项可查看原尺寸图像](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image40.png))</span><span class="sxs-lookup"><span data-stu-id="04766-284">**Figure 18**: Choose the SELECT which returns row Option ([Click to view full-size image](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image40.png))</span></span>


<span data-ttu-id="04766-285">下一屏幕中显示的 TableAdapter s 主查询，其中只列出了存储过程的名称 (`dbo.Products_Select`)。</span><span class="sxs-lookup"><span data-stu-id="04766-285">The next screen displays the TableAdapter s main query, which just lists the name of the stored procedure (`dbo.Products_Select`).</span></span> <span data-ttu-id="04766-286">存储的过程的名称替换为以下`SELECT`语句，返回所有指定的产品的产品字段：</span><span class="sxs-lookup"><span data-stu-id="04766-286">Replace the stored procedure name with the following `SELECT` statement, which returns all of the product fields for a specified product:</span></span>


[!code-sql[Main](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample9.sql)]


[![R<span data-ttu-id="04766-287">替换存储过程名称与一个 SELECT 查询]</span><span class="sxs-lookup"><span data-stu-id="04766-287">eplace the Stored Procedure Name with a SELECT Query]</span></span>(creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image42.png)](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image41.png)

<span data-ttu-id="04766-288">**图 19**:替换存储过程名称`SELECT`查询 ([单击以查看实际尺寸的图像](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image43.png))</span><span class="sxs-lookup"><span data-stu-id="04766-288">**Figure 19**: Replace the Stored Procedure Name with a `SELECT` Query ([Click to view full-size image](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image43.png))</span></span>


<span data-ttu-id="04766-289">后续屏幕要求您将创建的存储的过程的名称。</span><span class="sxs-lookup"><span data-stu-id="04766-289">The subsequent screen asks you to name the stored procedure that will be created.</span></span> <span data-ttu-id="04766-290">输入名称`Products_SelectByProductID`单击下一步。</span><span class="sxs-lookup"><span data-stu-id="04766-290">Enter the name `Products_SelectByProductID` and click Next.</span></span>


[![N<span data-ttu-id="04766-291">新的存储过程 Products_SelectByProductID \ 名称]</span><span class="sxs-lookup"><span data-stu-id="04766-291">ame the New Stored Procedure Products_SelectByProductID]</span></span>(creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image45.png)](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image44.png)

<span data-ttu-id="04766-292">**图 20**:命名新的存储过程`Products_SelectByProductID`([单击以查看实际尺寸的图像](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image46.png))</span><span class="sxs-lookup"><span data-stu-id="04766-292">**Figure 20**: Name the New Stored Procedure `Products_SelectByProductID` ([Click to view full-size image](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image46.png))</span></span>


<span data-ttu-id="04766-293">在向导的最后一步，我们可以更改的方法名称生成以及指示是否使用填充 DataTable 模式，则返回的 DataTable 模式，或两者。</span><span class="sxs-lookup"><span data-stu-id="04766-293">The final step of the wizard allows us to change the method names generated as well as indicate whether to use the Fill a DataTable pattern, Return a DataTable pattern, or both.</span></span> <span data-ttu-id="04766-294">此方法中，将保留选中状态，这两个选项，但重命名的方法`FillByProductID`和`GetProductByProductID`。</span><span class="sxs-lookup"><span data-stu-id="04766-294">For this method, leave both options checked, but rename the methods to `FillByProductID` and `GetProductByProductID`.</span></span> <span data-ttu-id="04766-295">单击下一步以查看该向导将执行，并单击完成以完成向导步骤的摘要。</span><span class="sxs-lookup"><span data-stu-id="04766-295">Click Next to view a summary of the steps the wizard will perform and then click Finish to complete the wizard.</span></span>


[![R<span data-ttu-id="04766-296">ename FillByProductID 和 GetProductByProductID TableAdapter 的方法]</span><span class="sxs-lookup"><span data-stu-id="04766-296">ename the TableAdapter s Methods to FillByProductID and GetProductByProductID]</span></span>(creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image48.png)](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image47.png)

<span data-ttu-id="04766-297">**图 21**:重命名的 TableAdapter 的方法`FillByProductID`并`GetProductByProductID`([单击以查看实际尺寸的图像](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image49.png))</span><span class="sxs-lookup"><span data-stu-id="04766-297">**Figure 21**: Rename the TableAdapter s Methods to `FillByProductID` and `GetProductByProductID` ([Click to view full-size image](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image49.png))</span></span>


<span data-ttu-id="04766-298">完成向导后，TableAdapter 具有可用的新方法`GetProductByProductID(productID)`，在调用时，将执行`Products_SelectByProductID`存储刚刚创建的过程。</span><span class="sxs-lookup"><span data-stu-id="04766-298">After completing the wizard, the TableAdapter has a new method available, `GetProductByProductID(productID)` that, when invoked, will execute the `Products_SelectByProductID` stored procedure that was just created.</span></span> <span data-ttu-id="04766-299">花点时间查看这个新的存储的过程从服务器资源管理器通过钻取到存储过程文件夹并打开`Products_SelectByProductID`（如果未看到它，在存储过程文件夹上右键单击并选择刷新）。</span><span class="sxs-lookup"><span data-stu-id="04766-299">Take a moment to view this new stored procedure from the Server Explorer by drilling into the Stored Procedures folder and opening `Products_SelectByProductID` (if you do not see it, right-click on the Stored Procedures folder and choose Refresh).</span></span>

<span data-ttu-id="04766-300">请注意，`SelectByProductID`存储过程采用`@ProductID`作为输入参数并执行`SELECT`我们在向导中输入的语句。</span><span class="sxs-lookup"><span data-stu-id="04766-300">Note that the `SelectByProductID` stored procedure takes `@ProductID` as an input parameter and executes the `SELECT` statement that we entered in the wizard.</span></span>


[!code-sql[Main](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample10.sql)]

## <a name="step-6-creating-a-business-logic-layer-class"></a><span data-ttu-id="04766-301">步骤 6：创建业务逻辑层类</span><span class="sxs-lookup"><span data-stu-id="04766-301">Step 6: Creating a Business Logic Layer Class</span></span>

<span data-ttu-id="04766-302">整个系列教程，我们有努力保持表示层进行的所有业务逻辑层 (BLL) 对其调用分层式体系结构。</span><span class="sxs-lookup"><span data-stu-id="04766-302">Throughout the tutorial series we have strived to maintain a layered architecture in which the Presentation Layer made all of its calls to the Business Logic Layer (BLL).</span></span> <span data-ttu-id="04766-303">为了遵循这种设计决策，我们首先需要创建 BLL 类的新类型化数据集，我们可以从表示层访问产品数据之前。</span><span class="sxs-lookup"><span data-stu-id="04766-303">In order to adhere to this design decision, we first need to create a BLL class for the new Typed DataSet before we can access product data from the Presentation Layer.</span></span>

<span data-ttu-id="04766-304">创建名为的新类文件`ProductsBLLWithSprocs.cs`在`~/App_Code/BLL`文件夹并向其添加以下代码：</span><span class="sxs-lookup"><span data-stu-id="04766-304">Create a new class file named `ProductsBLLWithSprocs.cs` in the `~/App_Code/BLL` folder and add to it the following code:</span></span>


[!code-csharp[Main](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample11.cs)]

<span data-ttu-id="04766-305">此类模仿`ProductsBLL`类从之前的教程，但使用的语义`ProductsTableAdapter`并`ProductsDataTable`对象从`NorthwindWithSprocs`数据集。</span><span class="sxs-lookup"><span data-stu-id="04766-305">This class mimics the `ProductsBLL` class semantics from earlier tutorials, but uses the `ProductsTableAdapter` and `ProductsDataTable` objects from the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="04766-306">例如，而不是让`using NorthwindTableAdapters`的类文件作为开头的语句`ProductsBLL`确实`ProductsBLLWithSprocs`类使用`using NorthwindWithSprocsTableAdapters`。</span><span class="sxs-lookup"><span data-stu-id="04766-306">For example, rather than having a `using NorthwindTableAdapters` statement at the start of the class file as `ProductsBLL` does, the `ProductsBLLWithSprocs` class uses `using NorthwindWithSprocsTableAdapters`.</span></span> <span data-ttu-id="04766-307">同样，`ProductsDataTable`并`ProductsRow`使用此类中的对象都带有前缀`NorthwindWithSprocs`命名空间。</span><span class="sxs-lookup"><span data-stu-id="04766-307">Likewise, the `ProductsDataTable` and `ProductsRow` objects used in this class are prefixed with the `NorthwindWithSprocs` namespace.</span></span> <span data-ttu-id="04766-308">`ProductsBLLWithSprocs`类提供了两个数据访问方法，`GetProducts`和`GetProductByProductID`，和方法来添加、 更新和删除单个产品实例。</span><span class="sxs-lookup"><span data-stu-id="04766-308">The `ProductsBLLWithSprocs` class provides two data access methods, `GetProducts` and `GetProductByProductID`, and methods to add, update, and delete a single product instance.</span></span>

## <a name="step-7-working-with-thenorthwindwithsprocsdataset-from-the-presentation-layer"></a><span data-ttu-id="04766-309">步骤 7：使用`NorthwindWithSprocs`从表示层的数据集</span><span class="sxs-lookup"><span data-stu-id="04766-309">Step 7: Working with the`NorthwindWithSprocs`DataSet from the Presentation Layer</span></span>

<span data-ttu-id="04766-310">此时，我们创建了使用存储的过程来访问和修改基础数据库数据的 DAL。</span><span class="sxs-lookup"><span data-stu-id="04766-310">At this point we have created a DAL that uses stored procedures to access and modify the underlying database data.</span></span> <span data-ttu-id="04766-311">我们还构建了基本的 BLL 与方法来检索所有产品或添加、 更新的方法以及某一特定产品和删除产品。</span><span class="sxs-lookup"><span data-stu-id="04766-311">We have also built a rudimentary BLL with methods to retrieve all products or a particular product along with methods for adding, updating, and deleting products.</span></span> <span data-ttu-id="04766-312">表示圆润本教程中，let s 创建 ASP.NET 页使用的 BLL s`ProductsBLLWithSprocs`类用于显示、 更新和删除记录。</span><span class="sxs-lookup"><span data-stu-id="04766-312">To round off this tutorial, let s create an ASP.NET page that uses the BLL s `ProductsBLLWithSprocs` class for displaying, updating, and deleting records.</span></span>

<span data-ttu-id="04766-313">打开`NewSprocs.aspx`页中`AdvancedDAL`文件夹，然后从工具箱拖到设计器中，其命名为拖动的 GridView `Products`。</span><span class="sxs-lookup"><span data-stu-id="04766-313">Open the `NewSprocs.aspx` page in the `AdvancedDAL` folder and drag a GridView from the Toolbox onto the Designer, naming it `Products`.</span></span> <span data-ttu-id="04766-314">从 GridView s 智能标记选择将其绑定到名为新 ObjectDataSource `ProductsDataSource`。</span><span class="sxs-lookup"><span data-stu-id="04766-314">From the GridView s smart tag choose to bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="04766-315">配置要使用 ObjectDataSource`ProductsBLLWithSprocs`类，如图 22 所示。</span><span class="sxs-lookup"><span data-stu-id="04766-315">Configure the ObjectDataSource to use the `ProductsBLLWithSprocs` class, as shown in Figure 22.</span></span>


[![C<span data-ttu-id="04766-316">配置对象数据源以使用 ProductsBLLWithSprocs 类]</span><span class="sxs-lookup"><span data-stu-id="04766-316">onfigure the ObjectDataSource to Use the ProductsBLLWithSprocs Class]</span></span>(creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image51.png)](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image50.png)

<span data-ttu-id="04766-317">**图 22**:配置为使用 ObjectDataSource`ProductsBLLWithSprocs`类 ([单击以查看实际尺寸的图像](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image52.png))</span><span class="sxs-lookup"><span data-stu-id="04766-317">**Figure 22**: Configure the ObjectDataSource to Use the `ProductsBLLWithSprocs` Class ([Click to view full-size image](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image52.png))</span></span>


<span data-ttu-id="04766-318">下拉列表中选择的选项卡有两个选项，`GetProducts`和`GetProductByProductID`。</span><span class="sxs-lookup"><span data-stu-id="04766-318">The drop-down list in the SELECT tab has two options, `GetProducts` and `GetProductByProductID`.</span></span> <span data-ttu-id="04766-319">由于我们想要在 GridView 中显示所有产品，因此选择`GetProducts`方法。</span><span class="sxs-lookup"><span data-stu-id="04766-319">Since we want to display all products in the GridView, choose the `GetProducts` method.</span></span> <span data-ttu-id="04766-320">在更新、 插入和删除选项卡中每个下拉列表中只能有一种方法。</span><span class="sxs-lookup"><span data-stu-id="04766-320">The drop-down lists in the UPDATE, INSERT, and DELETE tabs each only have one method.</span></span> <span data-ttu-id="04766-321">确保每个下拉列表，包含选中其相应方法，然后单击完成。</span><span class="sxs-lookup"><span data-stu-id="04766-321">Ensure that each of these drop-down lists has its appropriate method selected and then click Finish.</span></span>

<span data-ttu-id="04766-322">ObjectDataSource 向导运行完毕后，Visual Studio 将添加 BoundFields 和 CheckBoxField 到 GridView 的产品数据字段上。</span><span class="sxs-lookup"><span data-stu-id="04766-322">After the ObjectDataSource wizard has completed, Visual Studio will add BoundFields and a CheckBoxField to the GridView for the product data fields.</span></span> <span data-ttu-id="04766-323">通过选中启用编辑和智能标记中存在的启用删除选项启用的 GridView s 内置编辑和删除功能。</span><span class="sxs-lookup"><span data-stu-id="04766-323">Turn on the GridView s built-in editing and deleting features by checking the Enable Editing and Enable Deleting options present in the smart tag.</span></span>


[![T<span data-ttu-id="04766-324">他页包含一个 GridView 编辑和删除启用支持]</span><span class="sxs-lookup"><span data-stu-id="04766-324">he Page Contains a GridView with Editing and Deleting Support Enabled]</span></span>(creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image54.png)](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image53.png)

<span data-ttu-id="04766-325">**图 23**:页包含一个 GridView 编辑和删除启用支持 ([单击此项可查看原尺寸图像](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image55.png))</span><span class="sxs-lookup"><span data-stu-id="04766-325">**Figure 23**: The Page Contains a GridView with Editing and Deleting Support Enabled ([Click to view full-size image](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image55.png))</span></span>


<span data-ttu-id="04766-326">正如我们已讨论在上一教程中，在向导完成后 ObjectDataSource s，Visual Studio 设置`OldValuesParameterFormatString`属性设置为原始\_{0}。</span><span class="sxs-lookup"><span data-stu-id="04766-326">As we ve discussed in previous tutorials, at the completion of the ObjectDataSource s wizard, Visual Studio sets the `OldValuesParameterFormatString` property to original\_{0}.</span></span> <span data-ttu-id="04766-327">这需要将还原为其默认值为{0}中的数据修改功能才能正常工作的顺序给出我们 BLL 中的方法所需的参数。</span><span class="sxs-lookup"><span data-stu-id="04766-327">This needs to be reverted to its default value of {0} in order for the data modification features to work properly given the parameters expected by the methods in our BLL.</span></span> <span data-ttu-id="04766-328">因此，请务必设置`OldValuesParameterFormatString`属性设置为{0}或从声明性语法中完全删除属性。</span><span class="sxs-lookup"><span data-stu-id="04766-328">Therefore, be sure to set the `OldValuesParameterFormatString` property to {0} or remove the property altogether from the declarative syntax.</span></span>

<span data-ttu-id="04766-329">完成配置数据源向导，开启编辑和删除支持在 GridView 中，并返回 ObjectDataSource s 后`OldValuesParameterFormatString`为其默认值的属性，您的页面 + s 声明性标记应类似于下面：</span><span class="sxs-lookup"><span data-stu-id="04766-329">After completing the Configure Data Source wizard, turning on editing and deleting support in the GridView, and returning the ObjectDataSource s `OldValuesParameterFormatString` property to its default value, your page s declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample12.aspx)]

<span data-ttu-id="04766-330">此时我们无法整理 GridView 通过自定义编辑界面以包括验证、 具有`CategoryID`和`SupplierID`列呈现为 Dropdownlist，以此类推。</span><span class="sxs-lookup"><span data-stu-id="04766-330">At this point we could tidy up the GridView by customizing the editing interface to include validation, having the `CategoryID` and `SupplierID` columns render as DropDownLists, and so on.</span></span> <span data-ttu-id="04766-331">我们还可以将客户端确认添加到删除按钮，并建议您花时间来实现这些增强功能。</span><span class="sxs-lookup"><span data-stu-id="04766-331">We could also add a client-side confirmation to the Delete button, and I encourage you to take the time to implement these enhancements.</span></span> <span data-ttu-id="04766-332">由于已在前面的教程讨论这些主题，但是，我们将不包含它们再次此处。</span><span class="sxs-lookup"><span data-stu-id="04766-332">Since these topics have been covered in previous tutorials, however, we will not cover them again here.</span></span>

<span data-ttu-id="04766-333">无论是否增强 GridView 或不，测试在浏览器中的页面 + s 核心功能。</span><span class="sxs-lookup"><span data-stu-id="04766-333">Regardless of whether you enhance the GridView or not, test out the page s core features in a browser.</span></span> <span data-ttu-id="04766-334">如图 24 所示，页将列出提供每个行编辑和删除功能的 GridView 中的产品。</span><span class="sxs-lookup"><span data-stu-id="04766-334">As Figure 24 shows, the page lists the products in a GridView that provides per-row editing and deleting capabilities.</span></span>


[![T<span data-ttu-id="04766-335">他产品可以查看、 编辑和 GridView 从已删除]</span><span class="sxs-lookup"><span data-stu-id="04766-335">he Products Can Be Viewed, Edited, and Deleted from the GridView]</span></span>(creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image57.png)](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image56.png)

<span data-ttu-id="04766-336">**图 24**:可以查看产品、 编辑，和已删除从 GridView ([单击此项可查看原尺寸图像](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image58.png))</span><span class="sxs-lookup"><span data-stu-id="04766-336">**Figure 24**: The Products Can Be Viewed, Edited, and Deleted from the GridView ([Click to view full-size image](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image58.png))</span></span>


## <a name="summary"></a><span data-ttu-id="04766-337">总结</span><span class="sxs-lookup"><span data-stu-id="04766-337">Summary</span></span>

<span data-ttu-id="04766-338">使用临时 SQL 语句从数据库或通过存储过程，Tableadapter 中类型的数据集可以访问数据。</span><span class="sxs-lookup"><span data-stu-id="04766-338">The TableAdapters in a Typed DataSet can access data from the database using ad-hoc SQL statements or through stored procedures.</span></span> <span data-ttu-id="04766-339">当使用存储过程时，就可以使用任一现有的存储的过程或 TableAdapter 向导可以指导你创建新存储过程根据`SELECT`查询。</span><span class="sxs-lookup"><span data-stu-id="04766-339">When working with stored procedures, either existing stored procedures can be used or the TableAdapter wizard can be instructed to create new stored procedures based on a `SELECT` query.</span></span> <span data-ttu-id="04766-340">在本教程中我们探讨了如何为我们自动创建的存储的过程。</span><span class="sxs-lookup"><span data-stu-id="04766-340">In this tutorial we explored how to have the stored procedures automatically created for us.</span></span>

<span data-ttu-id="04766-341">具有自动生成可帮助节省时间的存储的过程，有某些情况下，存储的过程创建的向导不对齐具有什么我们将创建我们自己的位置。</span><span class="sxs-lookup"><span data-stu-id="04766-341">While having the stored procedures auto-generated helps save time, there are certain cases where the stored procedure created by the wizard doesn t align with what we would have created on our own.</span></span> <span data-ttu-id="04766-342">是一个例子`Products_Update`存储过程，应同时`@Original_ProductID`并`@ProductID`即使输入参数`@Original_ProductID`是多余的参数。</span><span class="sxs-lookup"><span data-stu-id="04766-342">One example is the `Products_Update` stored procedure, which expected both `@Original_ProductID` and `@ProductID` input parameters even though the `@Original_ProductID` parameter was superfluous.</span></span>

<span data-ttu-id="04766-343">在许多情况下，可能已创建的存储的过程，或我们可能想要生成这些手动以便具有更精确地控制存储的过程的 s 命令。</span><span class="sxs-lookup"><span data-stu-id="04766-343">In many scenarios, the stored procedures may already have been created, or we may want to build them manually so as to have a finer degree of control over the stored procedure s commands.</span></span> <span data-ttu-id="04766-344">在任一情况下，我们想要指示 TableAdapter 以使用现有的存储的过程的方法。</span><span class="sxs-lookup"><span data-stu-id="04766-344">In either case, we would want to instruct the TableAdapter to use existing stored procedures for its methods.</span></span> <span data-ttu-id="04766-345">我们应了解如何完成此操作在下一步的教程。</span><span class="sxs-lookup"><span data-stu-id="04766-345">We shall see how to accomplish this in the next tutorial.</span></span>

<span data-ttu-id="04766-346">快乐编程 ！</span><span class="sxs-lookup"><span data-stu-id="04766-346">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="04766-347">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="04766-347">Further Reading</span></span>

<span data-ttu-id="04766-348">在本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="04766-348">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="04766-349">创建和维护的存储的过程</span><span class="sxs-lookup"><span data-stu-id="04766-349">Creating and Maintaining Stored Procedures</span></span>](https://msdn.microsoft.com/library/aa214299(SQL.80).aspx)
- [<span data-ttu-id="04766-350">从存储过程中检索标量数据</span><span class="sxs-lookup"><span data-stu-id="04766-350">Retrieving Scalar Data from a Stored Procedure</span></span>](http://aspnet.4guysfromrolla.com/articles/062905-1.aspx)
- [<span data-ttu-id="04766-351">SQL Server 存储过程基本知识</span><span class="sxs-lookup"><span data-stu-id="04766-351">SQL Server Stored Procedure Basics</span></span>](http://www.awprofessional.com/articles/article.asp?p=25288&amp;rl=1)
- [<span data-ttu-id="04766-352">存储过程：概述</span><span class="sxs-lookup"><span data-stu-id="04766-352">Stored Procedures: An Overview</span></span>](http://www.sqlteam.com/item.asp?ItemID=563)
- [<span data-ttu-id="04766-353">编写存储的过程</span><span class="sxs-lookup"><span data-stu-id="04766-353">Writing a Stored Procedure</span></span>](http://www.4guysfromrolla.com/webtech/111499-1.shtml)

## <a name="about-the-author"></a><span data-ttu-id="04766-354">关于作者</span><span class="sxs-lookup"><span data-stu-id="04766-354">About the Author</span></span>

<span data-ttu-id="04766-355">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)的七个部 asp/ASP.NET 书籍并创办了作者[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年以来一直致力于 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="04766-355">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="04766-356">Scott 是独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="04766-356">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="04766-357">他最新著作是[ *Sams Teach 自己 ASP.NET 2.0 24 小时内*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="04766-357">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="04766-358">他可以到达[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="04766-358">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="04766-359">或通过他的博客，其中，请参阅[ http://ScottOnWriting.NET ](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="04766-359">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="04766-360">特别感谢</span><span class="sxs-lookup"><span data-stu-id="04766-360">Special Thanks To</span></span>

<span data-ttu-id="04766-361">很多有用的审阅者已评审本系列教程。</span><span class="sxs-lookup"><span data-stu-id="04766-361">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="04766-362">本教程中的潜在顾客审阅者已 Hilton Geisenow。</span><span class="sxs-lookup"><span data-stu-id="04766-362">Lead reviewer for this tutorial was Hilton Geisenow.</span></span> <span data-ttu-id="04766-363">是否有兴趣查看我即将推出的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="04766-363">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="04766-364">如果是这样，给我在行[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="04766-364">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="04766-365">下一步</span><span class="sxs-lookup"><span data-stu-id="04766-365">Next</span></span>](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md)
