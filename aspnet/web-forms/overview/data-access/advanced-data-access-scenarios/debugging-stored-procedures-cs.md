---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/debugging-stored-procedures-cs
title: 调试存储的过程 (C#) |Microsoft Docs
author: rick-anderson
description: Visual Studio Professional 和 Team System 版本允许您设置断点并参与到 SQL Server 中的存储过程使调试存储...
ms.author: riande
ms.date: 08/03/2007
ms.assetid: c655c324-2ffa-4c21-8265-a254d79a693d
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/debugging-stored-procedures-cs
msc.type: authoredcontent
ms.openlocfilehash: 9ac206edee58542ced24ce89adc3393d7a3c1c37
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/17/2019
ms.locfileid: "59392165"
---
# <a name="debugging-stored-procedures-c"></a><span data-ttu-id="3b9d3-103">调试存储过程 (C#)</span><span class="sxs-lookup"><span data-stu-id="3b9d3-103">Debugging Stored Procedures (C#)</span></span>

<span data-ttu-id="3b9d3-104">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="3b9d3-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="3b9d3-105">[下载代码](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_74_CS.zip)或[下载 PDF](debugging-stored-procedures-cs/_static/datatutorial74cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="3b9d3-105">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_74_CS.zip) or [Download PDF](debugging-stored-procedures-cs/_static/datatutorial74cs1.pdf)</span></span>

> <span data-ttu-id="3b9d3-106">Visual Studio Professional 和 Team System 版本允许您设置断点并参与到 SQL Server 中的存储过程进行调试存储的过程与调试应用程序代码一样容易。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-106">Visual Studio Professional and Team System editions allow you to set breakpoints and step in to stored procedures within SQL Server, making debugging stored procedures as easy as debugging application code.</span></span> <span data-ttu-id="3b9d3-107">本教程演示了直接数据库调试和应用程序调试存储过程。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-107">This tutorial demonstrates direct database debugging and application debugging of stored procedures.</span></span>


## <a name="introduction"></a><span data-ttu-id="3b9d3-108">介绍</span><span class="sxs-lookup"><span data-stu-id="3b9d3-108">Introduction</span></span>

<span data-ttu-id="3b9d3-109">Visual Studio 提供了丰富的调试体验。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-109">Visual Studio provides a rich debugging experience.</span></span> <span data-ttu-id="3b9d3-110">使用几个击键或鼠标，单击它可以使用断点停止执行程序，并检查其状态和控制流。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-110">With a few keystrokes or clicks of the mouse, it s possible to use breakpoints to stop execution of a program and examine its state and control flow.</span></span> <span data-ttu-id="3b9d3-111">调试应用程序代码，以及 Visual Studio 提供了对调试存储的过程从 SQL Server 中的支持。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-111">Along with debugging application code, Visual Studio offers support for debugging stored procedures from within SQL Server.</span></span> <span data-ttu-id="3b9d3-112">就像在 ASP.NET 代码隐藏类或业务逻辑层类的代码中设置断点以便也可以将它们放在存储过程。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-112">Just like breakpoints can be set within the code of an ASP.NET code-behind class or Business Logic Layer class, so too can they be placed within stored procedures.</span></span>

<span data-ttu-id="3b9d3-113">在本教程中我们将查看单步执行存储过程从 Visual Studio 中的服务器资源管理器以及如何设置，则会命中断点时调用该存储的过程是从正在运行的 ASP.NET 应用程序。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-113">In this tutorial we will look at stepping into stored procedures from the Server Explorer within Visual Studio as well as how to set breakpoints that are hit when the stored procedure is called from the running ASP.NET application.</span></span>

> [!NOTE]
> <span data-ttu-id="3b9d3-114">遗憾的是，只能将单步执行和调试通过 Visual Studio Professional 和 Team 系统版本的存储的过程。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-114">Unfortunately, stored procedures can only be stepped into and debugged through the Professional and Team Systems versions of Visual Studio.</span></span> <span data-ttu-id="3b9d3-115">如果使用 Visual Web Developer 或标准版本的 Visual Studio，你也可以阅读此过程，因为我们逐步调试存储的过程所需的步骤，但您将不能复制你的计算机上的这些步骤。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-115">If you are using Visual Web Developer or the standard version of Visual Studio, you are welcome to read along as we walk through the steps necessary to debug stored procedures, but you will not be able to replicate these steps on your machine.</span></span>


## <a name="sql-server-debugging-concepts"></a><span data-ttu-id="3b9d3-116">SQL Server 调试概念</span><span class="sxs-lookup"><span data-stu-id="3b9d3-116">SQL Server Debugging Concepts</span></span>

<span data-ttu-id="3b9d3-117">Microsoft SQL Server 2005 旨在提供与集成[公共语言运行时 (CLR)](https://msdn.microsoft.com/netframework/aa497266.aspx)，这是所有.NET 程序集都使用的运行时。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-117">Microsoft SQL Server 2005 was designed to provide integration with the [Common Language Runtime (CLR)](https://msdn.microsoft.com/netframework/aa497266.aspx), which is the runtime used by all .NET assemblies.</span></span> <span data-ttu-id="3b9d3-118">因此，SQL Server 2005 支持托管的数据库对象。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-118">Consequently, SQL Server 2005 supports managed database objects.</span></span> <span data-ttu-id="3b9d3-119">也就是说，可以为 C# 类中的方法来创建数据库对象，如存储的过程和用户定义函数 (Udf)。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-119">That is, you can create database objects like stored procedures and User-Defined Functions (UDFs) as methods in a C# class.</span></span> <span data-ttu-id="3b9d3-120">这样，这些存储的过程和 Udf 以利用.NET Framework 中并从您自己的自定义类的功能。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-120">This enables these stored procedures and UDFs to utilize functionality in the .NET Framework and from your own custom classes.</span></span> <span data-ttu-id="3b9d3-121">当然，SQL Server 2005 还提供支持的 T-SQL 的数据库对象。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-121">Of course, SQL Server 2005 also provides support for T-SQL database objects.</span></span>

<span data-ttu-id="3b9d3-122">SQL Server 2005 提供 T-SQL 和托管的数据库对象调试支持。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-122">SQL Server 2005 offers debugging support for both T-SQL and managed database objects.</span></span> <span data-ttu-id="3b9d3-123">但是，这些对象，仅通过 Visual Studio 2005 专业版和团队系统版本进行调试。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-123">However, these objects can only be debugged through Visual Studio 2005 Professional and Team Systems editions.</span></span> <span data-ttu-id="3b9d3-124">在本教程中我们将检查调试 T-SQL 的数据库对象。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-124">In this tutorial we will examine debugging T-SQL database objects.</span></span> <span data-ttu-id="3b9d3-125">后续教程讨论调试托管的数据库对象。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-125">The subsequent tutorial looks at debugging managed database objects.</span></span>

<span data-ttu-id="3b9d3-126">[概述的 T-SQL 和 CLR 调试在 SQL Server 2005](https://blogs.msdn.com/sqlclr/archive/2006/06/29/651644.aspx)中的博客条目[SQL Server 2005 CLR 集成团队](https://blogs.msdn.com/sqlclr/default.aspx)突出显示要调试 Visual Studio 中的 SQL Server 2005 对象的三种方法：</span><span class="sxs-lookup"><span data-stu-id="3b9d3-126">The [Overview of T-SQL and CLR Debugging in SQL Server 2005](https://blogs.msdn.com/sqlclr/archive/2006/06/29/651644.aspx) blog entry from the [SQL Server 2005 CLR Integration team](https://blogs.msdn.com/sqlclr/default.aspx) highlights the three ways to debug SQL Server 2005 objects from Visual Studio:</span></span>

- <span data-ttu-id="3b9d3-127">**直接数据库调试 (DDD)** -从服务器资源管理器中我们可以单步执行任何 T-SQL 的数据库对象，如存储的过程和 Udf。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-127">**Direct Database Debugging (DDD)** - from Server Explorer we can step into any T-SQL database object, such as stored procedures and UDFs.</span></span> <span data-ttu-id="3b9d3-128">我们将检查在步骤 1 中的 DDD。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-128">We will examine DDD in Step 1.</span></span>
- <span data-ttu-id="3b9d3-129">**应用程序调试**-我们可以设置的数据库对象中的断点，然后运行我们的 ASP.NET 应用程序。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-129">**Application Debugging** - we can set breakpoints within a database object and then run our ASP.NET application.</span></span> <span data-ttu-id="3b9d3-130">执行数据库对象时，将会命中断点和控制移交到调试器。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-130">When the database object is executed, the breakpoint will be hit and control turned over to the debugger.</span></span> <span data-ttu-id="3b9d3-131">请注意，与应用程序调试我们无法单步执行数据库对象从应用程序代码。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-131">Note that with application debugging we cannot step into a database object from application code.</span></span> <span data-ttu-id="3b9d3-132">我们必须显式设置断点在这些存储的过程或 Udf 中想要停止调试器。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-132">We must explicitly set breakpoints in those stored procedures or UDFs where we want the debugger to stop.</span></span> <span data-ttu-id="3b9d3-133">在步骤 2 中启动检查应用程序调试。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-133">Application debugging is examined starting in Step 2.</span></span>
- <span data-ttu-id="3b9d3-134">**从 SQL Server 项目调试**-Visual Studio Professional 和 Team 系统版本包括一个 SQL Server 项目类型，通常用于创建托管的数据库对象。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-134">**Debugging from a SQL Server Project** - Visual Studio Professional and Team Systems editions include a SQL Server Project type that is commonly used to create managed database objects.</span></span> <span data-ttu-id="3b9d3-135">我们将探究如何使用 SQL Server 项目并在下一教程中进行调试其内容。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-135">We will examine using SQL Server Projects and debugging their contents in the next tutorial.</span></span>

<span data-ttu-id="3b9d3-136">Visual Studio 可以调试在本地和远程 SQL Server 实例上的存储的过程。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-136">Visual Studio can debug stored procedures on local and remote SQL Server instances.</span></span> <span data-ttu-id="3b9d3-137">本地 SQL Server 实例是安装在 Visual Studio 的同一台计算机上。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-137">A local SQL Server instance is one that is installed on the same machine as Visual Studio.</span></span> <span data-ttu-id="3b9d3-138">如果你使用的 SQL Server 数据库不在你的开发计算机上，它被视为远程实例。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-138">If the SQL Server database you are using is not located on your development machine, then it is considered a remote instance.</span></span> <span data-ttu-id="3b9d3-139">这些教程中我们一直在使用本地 SQL Server 实例。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-139">For these tutorials we have been using local SQL Server instances.</span></span> <span data-ttu-id="3b9d3-140">调试远程的 SQL server 实例上的存储的过程需要比时调试的本地实例上的存储的过程的详细配置步骤。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-140">Debugging stored procedures on a remote SQL server instance requires more configuration steps than when debugging stored procedures on a local instance.</span></span>

<span data-ttu-id="3b9d3-141">如果使用本地 SQL Server 实例，可以从步骤 1 开始，并在学习本教程末尾。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-141">If you are using a local SQL Server instance, you can start with Step 1 and work through this tutorial to the end.</span></span> <span data-ttu-id="3b9d3-142">如果使用远程 SQL Server 实例，但是，您将首先需要确保您在调试时将记录到开发计算机与远程实例具有 SQL Server 登录名的 Windows 用户帐户。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-142">If you are using a remote SQL Server instance, however, you will first need to ensure that when debugging you are logged to your development machine with a Windows user account that has a SQL Server login on the remote instance.</span></span> <span data-ttu-id="3b9d3-143">此外，此数据库登录名和用于从正在运行的 ASP.NET 应用程序连接到数据库的数据库登录名必须是成员的`sysadmin`角色。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-143">Moreover, both this database login and the database login used to connect to the database from the running ASP.NET application must be members of the `sysadmin` role.</span></span> <span data-ttu-id="3b9d3-144">配置 Visual Studio 和 SQL Server，若要调试的远程实例的详细信息本教程结束时，在远程实例部分看到调试 T-SQL 的数据库对象。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-144">See the Debugging T-SQL Database Objects on Remote Instances section at the end of this tutorial for more information on configuring Visual Studio and SQL Server to debug a remote instance.</span></span>

<span data-ttu-id="3b9d3-145">最后，了解调试支持 T-SQL 的数据库对象都不为调试.NET 应用程序的支持丰富的功能。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-145">Finally, understand that debugging support for T-SQL database objects is not as feature rich as debugging support for .NET applications.</span></span> <span data-ttu-id="3b9d3-146">例如，断点条件和筛选器不支持，只能使用调试窗口中的一个子集，不能使用编辑并继续、 即时窗口呈现毫无意义，等等。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-146">For example, breakpoint conditions and filters are not supported, only a subset of the debugging windows are available, you cannot use Edit and Continue, the Immediate window is rendered useless, and so forth.</span></span> <span data-ttu-id="3b9d3-147">请参阅[调试器命令和功能的限制](https://msdn.microsoft.com/library/ms165035(VS.80).aspx)有关详细信息。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-147">See [Limitations on Debugger Commands and Features](https://msdn.microsoft.com/library/ms165035(VS.80).aspx) for more information.</span></span>

## <a name="step-1-directly-stepping-into-a-stored-procedure"></a><span data-ttu-id="3b9d3-148">步骤 1：直接单步执行存储过程</span><span class="sxs-lookup"><span data-stu-id="3b9d3-148">Step 1: Directly Stepping Into a Stored Procedure</span></span>

<span data-ttu-id="3b9d3-149">Visual Studio 就可轻松进行直接调试数据库对象。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-149">Visual Studio makes it easy to directly debug a database object.</span></span> <span data-ttu-id="3b9d3-150">让我们来看看如何使用直接数据库调试 (DDD) 功能来单步执行`Products_SelectByCategoryID`Northwind 数据库中存储过程。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-150">Let s look at how to use the Direct Database Debugging (DDD) feature to step into the `Products_SelectByCategoryID` stored procedure in the Northwind database.</span></span> <span data-ttu-id="3b9d3-151">正如其名，`Products_SelectByCategoryID`返回特定类别; 的产品信息在其中创建它[使用现有存储过程的类型化数据集 s Tableadapter](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md)教程。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-151">As its name implies, `Products_SelectByCategoryID` returns product information for a particular category; it was created in the [Using Existing Stored Procedures for the Typed DataSet s TableAdapters](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) tutorial.</span></span> <span data-ttu-id="3b9d3-152">首先，转到服务器资源管理器并展开 Northwind 数据库节点。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-152">Start by going to the Server Explorer and expand the Northwind database node.</span></span> <span data-ttu-id="3b9d3-153">接下来，向下钻取到存储过程文件夹，右键单击`Products_SelectByCategoryID`存储过程，然后从上下文菜单中选择到存储过程的步骤选项。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-153">Next, drill down into the Stored Procedures folder, right-click on the `Products_SelectByCategoryID` stored procedure, and choose the Step Into Stored Procedure option from the context menu.</span></span> <span data-ttu-id="3b9d3-154">这将启动调试器。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-154">This will start the debugger.</span></span>

<span data-ttu-id="3b9d3-155">由于`Products_SelectByCategoryID`存储的过程需要`@CategoryID`输入的参数，我们会要求提供此值。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-155">Since the `Products_SelectByCategoryID` stored procedure expects a `@CategoryID` input parameter, we are asked to provide this value.</span></span> <span data-ttu-id="3b9d3-156">输入 1，这将返回有关饮料的信息。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-156">Enter 1, which will return information about the beverages.</span></span>


![使用值 1 为@CategoryID参数](debugging-stored-procedures-cs/_static/image1.png)

<span data-ttu-id="3b9d3-158">**图 1**:使用值 1 为`@CategoryID`参数</span><span class="sxs-lookup"><span data-stu-id="3b9d3-158">**Figure 1**: Use the Value 1 for the `@CategoryID` Parameter</span></span>


<span data-ttu-id="3b9d3-159">提供的值后`@CategoryID`参数，该存储过程执行。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-159">After supplying the value for the `@CategoryID` parameter, the stored procedure is executed.</span></span> <span data-ttu-id="3b9d3-160">不过，而不是运行完成，调试器暂停执行第一个语句。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-160">Rather than running to completion, though, the debugger halts execution on the first statement.</span></span> <span data-ttu-id="3b9d3-161">请注意，该值指示当前存储过程中的位置边距的黄色箭头。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-161">Note the yellow arrow in the margin, indicating the current location in the stored procedure.</span></span> <span data-ttu-id="3b9d3-162">您可以查看和编辑参数值通过监视窗口或悬停在该存储过程中的参数名称。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-162">You can view and edit parameter values through the Watch window or by hovering over the parameter name in the stored procedure.</span></span>


<span data-ttu-id="3b9d3-163">[![调试器已停止的存储过程的第一个语句](debugging-stored-procedures-cs/_static/image3.png)](debugging-stored-procedures-cs/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="3b9d3-163">[![The Debugger has Halted on the First Statement of the Stored Procedure](debugging-stored-procedures-cs/_static/image3.png)](debugging-stored-procedures-cs/_static/image2.png)</span></span>

<span data-ttu-id="3b9d3-164">**图 2**:调试器已停止的存储过程的第一个语句 ([单击此项可查看原尺寸图像](debugging-stored-procedures-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="3b9d3-164">**Figure 2**: The Debugger has Halted on the First Statement of the Stored Procedure ([Click to view full-size image](debugging-stored-procedures-cs/_static/image4.png))</span></span>


<span data-ttu-id="3b9d3-165">若要单步执行存储的过程一次的一个语句，请单击工具栏中的单步跳过按钮或按 F10 键。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-165">To step through the stored procedure one statement at a time, click the Step Over button in the Toolbar or hit the F10 key.</span></span> <span data-ttu-id="3b9d3-166">`Products_SelectByCategoryID`存储的过程包含单个`SELECT`语句，以便按 F10 将逐过程执行单个语句，并完成存储过程的执行。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-166">The `Products_SelectByCategoryID` stored procedure contains a single `SELECT` statement, so hitting F10 will Step over the single statement and complete the execution of the stored procedure.</span></span> <span data-ttu-id="3b9d3-167">存储的过程完成后，其输出将显示在输出窗口中，调试器将终止。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-167">After the stored procedure has completed, its output will appear in the Output window and the debugger will terminate.</span></span>

> [!NOTE]
> <span data-ttu-id="3b9d3-168">T-SQL 调试发生在语句级别;不能单步执行`SELECT`语句。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-168">T-SQL debugging occurs at the statement level; you cannot Step into a `SELECT` statement.</span></span>


## <a name="step-2-configuring-the-website-for-application-debugging"></a><span data-ttu-id="3b9d3-169">步骤 2：配置应用程序调试的网站</span><span class="sxs-lookup"><span data-stu-id="3b9d3-169">Step 2: Configuring the Website for Application Debugging</span></span>

<span data-ttu-id="3b9d3-170">调试存储的过程直接从服务器资源管理器非常方便，而在许多情况下的多类调用从我们的 ASP.NET 应用程序时调试存储的过程。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-170">While debugging a stored procedure directly from the Server Explorer is handy, in many scenarios we are more interested in debugging the stored procedure when it is called from our ASP.NET application.</span></span> <span data-ttu-id="3b9d3-171">我们可以将断点添加到 Visual Studio 中的存储过程的然后开始调试 ASP.NET 应用程序。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-171">We can add breakpoints to a stored procedure from within Visual Studio and then start debugging the ASP.NET application.</span></span> <span data-ttu-id="3b9d3-172">从应用程序调用具有断点的存储的过程时，执行将在断点处暂停和我们可以查看和更改存储的过程的参数值，就像我们在步骤 1 中单步执行其语句。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-172">When a stored procedure with breakpoints is invoked from the application, execution will halt at the breakpoint and we can view and change the stored procedure s parameter values and step through its statements, just like we did in Step 1.</span></span>

<span data-ttu-id="3b9d3-173">我们可以开始调试应用程序中调用存储的过程之前，我们需要指示 ASP.NET web 应用程序将与 SQL Server 调试器进行集成。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-173">Before we can start debugging stored procedures called from the application, we need to instruct the ASP.NET web application to integrate with the SQL Server debugger.</span></span> <span data-ttu-id="3b9d3-174">通过右键单击解决方案资源管理器中的网站名称启动 (`ASPNET_Data_Tutorial_74_CS`)。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-174">Start by right-clicking on the website name in the Solution Explorer (`ASPNET_Data_Tutorial_74_CS`).</span></span> <span data-ttu-id="3b9d3-175">从上下文菜单中选择属性页选项，选择在左侧的启动选项项并检查调试器部分中的 SQL Server 复选框 （请参见图 3）。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-175">Choose the Property Pages option from the context menu, select the Start Options item on the left, and check the SQL Server checkbox in the Debuggers section (see Figure 3).</span></span>


<span data-ttu-id="3b9d3-176">[![检查应用程序的属性页中的 SQL Server 复选框](debugging-stored-procedures-cs/_static/image6.png)](debugging-stored-procedures-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="3b9d3-176">[![Check the SQL Server Checkbox in the Application s Property Pages](debugging-stored-procedures-cs/_static/image6.png)](debugging-stored-procedures-cs/_static/image5.png)</span></span>

<span data-ttu-id="3b9d3-177">**图 3**:检查应用程序的属性页中的 SQL Server 复选框 ([单击此项可查看原尺寸图像](debugging-stored-procedures-cs/_static/image7.png))</span><span class="sxs-lookup"><span data-stu-id="3b9d3-177">**Figure 3**: Check the SQL Server Checkbox in the Application s Property Pages ([Click to view full-size image](debugging-stored-procedures-cs/_static/image7.png))</span></span>


<span data-ttu-id="3b9d3-178">此外，我们需要更新应用程序，以便禁用连接池时使用的数据库连接字符串。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-178">Additionally, we need to update the database connection string used by the application so that connection pooling is disabled.</span></span> <span data-ttu-id="3b9d3-179">关闭与数据库的连接时，相应`SqlConnection`对象放在池中的可用连接。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-179">When a connection to a database is closed, the corresponding `SqlConnection` object is placed in a pool of available connections.</span></span> <span data-ttu-id="3b9d3-180">建立连接到数据库时，可用的连接对象可以检索从这个池而不会创建并建立新连接。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-180">When establishing a connection to a database, an available connection object can be retrieved from this pool rather than having to create and establish a new connection.</span></span> <span data-ttu-id="3b9d3-181">此池的连接对象是一种性能增强和默认情况下启用。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-181">This pooling of connection objects is a performance enhancement and is enabled by default.</span></span> <span data-ttu-id="3b9d3-182">但是，在调试时我们想要关闭连接池，因为调试基础结构不正确地重新建立使用从相应池中获取的连接时。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-182">However, when debugging we want to turn off connection pooling because the debugging infrastructure is not correctly reestablished when working with a connection that was taken from the pool.</span></span>

<span data-ttu-id="3b9d3-183">为已禁用的连接池，更新`NORTHWNDConnectionString`中`Web.config`以使其包括设置`Pooling=false`。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-183">To disabled connection pooling, update the `NORTHWNDConnectionString` in `Web.config` so that it includes the setting `Pooling=false` .</span></span>


[!code-xml[Main](debugging-stored-procedures-cs/samples/sample1.xml)]

> [!NOTE]
> <span data-ttu-id="3b9d3-184">完成后通过 ASP.NET 应用程序调试 SQL Server 会确保恢复连接池通过删除`Pooling`从连接字符串设置 (或将其设置为`Pooling=true`)。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-184">Once you have finished debugging SQL Server through the ASP.NET application be sure to reinstate connection pooling by removing the `Pooling` setting from the connection string (or by setting it to `Pooling=true` ).</span></span>


<span data-ttu-id="3b9d3-185">此时配置 ASP.NET 应用程序以允许 Visual Studio 以调试 SQL Server 数据库对象时通过 web 应用程序调用。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-185">At this point the ASP.NET application has been configured to allow Visual Studio to debug SQL Server database objects when invoked through the web application.</span></span> <span data-ttu-id="3b9d3-186">现在剩下的工作是对存储过程来添加断点并开始调试 ！</span><span class="sxs-lookup"><span data-stu-id="3b9d3-186">All that remains now is to add a breakpoint to a stored procedure and start debugging!</span></span>

## <a name="step-3-adding-a-breakpoint-and-debugging"></a><span data-ttu-id="3b9d3-187">步骤 3：添加一个断点和调试</span><span class="sxs-lookup"><span data-stu-id="3b9d3-187">Step 3: Adding a Breakpoint and Debugging</span></span>

<span data-ttu-id="3b9d3-188">打开`Products_SelectByCategoryID`存储过程，并在开头设置断点`SELECT`语句通过在适当的位置的边距中单击或将光标放在开头`SELECT`语句并按 F9。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-188">Open the `Products_SelectByCategoryID` stored procedure and set a breakpoint at the start of the `SELECT` statement by clicking in the margin at the appropriate place or by placing your cursor at the start of the `SELECT` statement and hitting F9.</span></span> <span data-ttu-id="3b9d3-189">如图 4 所示，该断点显示为距中的红色圆圈。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-189">As Figure 4 illustrates, the breakpoint appears as a red circle in the margin.</span></span>


<span data-ttu-id="3b9d3-190">[![Products_SelectByCategoryID 中设置断点存储过程](debugging-stored-procedures-cs/_static/image9.png)](debugging-stored-procedures-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="3b9d3-190">[![Set a Breakpoint in the Products_SelectByCategoryID Stored Procedure](debugging-stored-procedures-cs/_static/image9.png)](debugging-stored-procedures-cs/_static/image8.png)</span></span>

<span data-ttu-id="3b9d3-191">**图 4**:中设置断点`Products_SelectByCategoryID`存储过程 ([单击以查看实际尺寸的图像](debugging-stored-procedures-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="3b9d3-191">**Figure 4**: Set a Breakpoint in the `Products_SelectByCategoryID` Stored Procedure ([Click to view full-size image](debugging-stored-procedures-cs/_static/image10.png))</span></span>


<span data-ttu-id="3b9d3-192">为了使 SQL 数据库对象调试通过客户端应用程序，则必须将数据库配置为支持应用程序进行调试。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-192">In order for a SQL database object to be debugged through a client application, it is imperative that the database be configured to support application debugging.</span></span> <span data-ttu-id="3b9d3-193">当首次设置断点时，此设置应会自动切换，但谨慎仔细检查。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-193">When you first set a breakpoint, this setting should automatically be switched on, but it is prudent to double-check.</span></span> <span data-ttu-id="3b9d3-194">右键单击`NORTHWND.MDF`服务器资源管理器中的节点。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-194">Right-click on the `NORTHWND.MDF` node in the Server Explorer.</span></span> <span data-ttu-id="3b9d3-195">上下文菜单应包括选中的菜单项名为应用程序调试。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-195">The context menu should include a checked menu item named Application Debugging .</span></span>


![请确保启用了应用程序调试选项](debugging-stored-procedures-cs/_static/image11.png)

<span data-ttu-id="3b9d3-197">**图 5**:请确保启用了应用程序调试选项</span><span class="sxs-lookup"><span data-stu-id="3b9d3-197">**Figure 5**: Ensure that the Application Debugging Option is Enabled</span></span>


<span data-ttu-id="3b9d3-198">设置断点和支持的应用程序调试选项，我们已准备好调试存储的过程时从 ASP.NET 应用程序调用。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-198">With the breakpoint set and the Application Debugging option enabled, we are ready to debug the stored procedure when called from the ASP.NET application.</span></span> <span data-ttu-id="3b9d3-199">通过转到调试菜单启动调试器并在工具栏中选择开始调试，通过按 F5，或通过单击绿色播放图标。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-199">Start the debugger by going to the Debug menu and choosing Start Debugging, by hitting F5, or by clicking the green play icon in the Toolbar.</span></span> <span data-ttu-id="3b9d3-200">这将启动调试器并启动该网站。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-200">This will start the debugger and launch the website.</span></span>

<span data-ttu-id="3b9d3-201">`Products_SelectByCategoryID`中创建存储的过程[使用现有存储过程的类型化数据集 s Tableadapter](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md)教程。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-201">The `Products_SelectByCategoryID` stored procedure was created in the [Using Existing Stored Procedures for the Typed DataSet s TableAdapters](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) tutorial.</span></span> <span data-ttu-id="3b9d3-202">其相应的 web 页面 (`~/AdvancedDAL/ExistingSprocs.aspx`) 包含一个 GridView，显示此存储过程返回的结果。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-202">Its corresponding web page (`~/AdvancedDAL/ExistingSprocs.aspx`) contains a GridView that displays the results returned by this stored procedure.</span></span> <span data-ttu-id="3b9d3-203">访问本页可通过浏览器。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-203">Visit this page through the browser.</span></span> <span data-ttu-id="3b9d3-204">一旦达到页上，在断点`Products_SelectByCategoryID`将达到存储的过程，并且控制返回到 Visual Studio。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-204">Upon reaching the page, the breakpoint in the `Products_SelectByCategoryID` stored procedure will be hit and control returned to Visual Studio.</span></span> <span data-ttu-id="3b9d3-205">就像在步骤 1 中，您可以单步执行该存储的过程的语句并查看和修改参数值。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-205">Just like in Step 1, you can step through the stored procedure s statements and view and modify the parameter values.</span></span>


<span data-ttu-id="3b9d3-206">[![ExistingSprocs.aspx 页最初显示饮料](debugging-stored-procedures-cs/_static/image13.png)](debugging-stored-procedures-cs/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="3b9d3-206">[![The ExistingSprocs.aspx Page Initially Displays the Beverages](debugging-stored-procedures-cs/_static/image13.png)](debugging-stored-procedures-cs/_static/image12.png)</span></span>

<span data-ttu-id="3b9d3-207">**图 6**:`ExistingSprocs.aspx`页上最初显示饮料 ([单击以查看实际尺寸的图像](debugging-stored-procedures-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="3b9d3-207">**Figure 6**: The `ExistingSprocs.aspx` Page Initially Displays the Beverages ([Click to view full-size image](debugging-stored-procedures-cs/_static/image14.png))</span></span>


<span data-ttu-id="3b9d3-208">[![存储过程 s 已到达断点](debugging-stored-procedures-cs/_static/image16.png)](debugging-stored-procedures-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="3b9d3-208">[![The Stored Procedure s Breakpoint has been Reached](debugging-stored-procedures-cs/_static/image16.png)](debugging-stored-procedures-cs/_static/image15.png)</span></span>

<span data-ttu-id="3b9d3-209">**图 7**:到达断点的存储过程 s ([单击此项可查看原尺寸图像](debugging-stored-procedures-cs/_static/image17.png))</span><span class="sxs-lookup"><span data-stu-id="3b9d3-209">**Figure 7**: The Stored Procedure s Breakpoint has been Reached ([Click to view full-size image](debugging-stored-procedures-cs/_static/image17.png))</span></span>


<span data-ttu-id="3b9d3-210">图 7 所示的值中的监视窗口为`@CategoryID`参数为 1。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-210">As the Watch window in Figure 7 shows, the value of the `@CategoryID` parameter is 1.</span></span> <span data-ttu-id="3b9d3-211">这是因为`ExistingSprocs.aspx`页上最初显示产品的饮料类别中，具有`CategoryID`值为 1。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-211">This is because the `ExistingSprocs.aspx` page initially displays products in the beverages category, which has a `CategoryID` value of 1.</span></span> <span data-ttu-id="3b9d3-212">从下拉列表中选择一个不同的类别。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-212">Choose a different category from the drop-down list.</span></span> <span data-ttu-id="3b9d3-213">执行此操作导致回发和重新执行`Products_SelectByCategoryID`存储过程。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-213">Doing so causes a postback and re-executes the `Products_SelectByCategoryID` stored procedure.</span></span> <span data-ttu-id="3b9d3-214">同样，但这次命中断点`@CategoryID`参数的值反映了所选的下拉列表项的`CategoryID`。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-214">The breakpoint is hit again, but this time the `@CategoryID` parameter s value reflects the selected drop-down list item s `CategoryID`.</span></span>


<span data-ttu-id="3b9d3-215">[![从下拉列表中选择一个不同的类别](debugging-stored-procedures-cs/_static/image19.png)](debugging-stored-procedures-cs/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="3b9d3-215">[![Choose a Different Category from the Drop-Down List](debugging-stored-procedures-cs/_static/image19.png)](debugging-stored-procedures-cs/_static/image18.png)</span></span>

<span data-ttu-id="3b9d3-216">**图 8**:从下拉列表中选择一个不同的类别 ([单击此项可查看原尺寸图像](debugging-stored-procedures-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="3b9d3-216">**Figure 8**: Choose a Different Category from the Drop-Down List ([Click to view full-size image](debugging-stored-procedures-cs/_static/image20.png))</span></span>


<span data-ttu-id="3b9d3-217">[![@CategoryID参数反映了在 Web 页上选择的类别](debugging-stored-procedures-cs/_static/image22.png)](debugging-stored-procedures-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="3b9d3-217">[![The @CategoryID Parameter Reflects the Category Selected from the Web Page](debugging-stored-procedures-cs/_static/image22.png)](debugging-stored-procedures-cs/_static/image21.png)</span></span>

<span data-ttu-id="3b9d3-218">**图 9**:`@CategoryID`参数反映了在 Web 页中选择类别 ([单击以查看实际尺寸的图像](debugging-stored-procedures-cs/_static/image23.png))</span><span class="sxs-lookup"><span data-stu-id="3b9d3-218">**Figure 9**: The `@CategoryID` Parameter Reflects the Category Selected from the Web Page ([Click to view full-size image](debugging-stored-procedures-cs/_static/image23.png))</span></span>


> [!NOTE]
> <span data-ttu-id="3b9d3-219">如果中的断点`Products_SelectByCategoryID`存储的过程时不会发生时访问`ExistingSprocs.aspx`页上，请确保已在 ASP.NET 应用程序的属性页的调试器部分中选中的 SQL Server 复选框，确保连接池已禁用和启用数据库 s 应用程序调试选项。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-219">If the breakpoint in the `Products_SelectByCategoryID` stored procedure is not hit when visiting the `ExistingSprocs.aspx` page, make sure that the SQL Server checkbox has been checked in the Debuggers section of the ASP.NET application s Properties Page, that connection pooling has been disabled, and that the database s Application Debugging option is enabled.</span></span> <span data-ttu-id="3b9d3-220">如果重新仍遇到问题，重新启动 Visual Studio，然后重试。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-220">If you re still having problems, restart Visual Studio and try again.</span></span>


## <a name="debugging-t-sql-database-objects-on-remote-instances"></a><span data-ttu-id="3b9d3-221">调试远程实例上的 T-SQL 的数据库对象</span><span class="sxs-lookup"><span data-stu-id="3b9d3-221">Debugging T-SQL Database Objects on Remote Instances</span></span>

<span data-ttu-id="3b9d3-222">在 Visual Studio 的同一台计算机上的 SQL Server 数据库实例时，调试数据库对象，通过 Visual Studio 其实非常简单。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-222">Debugging database objects through Visual Studio is fairly straightforward when the SQL Server database instance is on the same machine as Visual Studio.</span></span> <span data-ttu-id="3b9d3-223">但是，如果 SQL Server 和 Visual Studio 位于不同的计算机然后一些经过慎重的配置是所需一切都正常工作。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-223">However, if SQL Server and Visual Studio reside on different machines then some careful configuration is required to get everything working properly.</span></span> <span data-ttu-id="3b9d3-224">有两个我们面对的核心任务：</span><span class="sxs-lookup"><span data-stu-id="3b9d3-224">There are two core tasks we are faced with:</span></span>

- <span data-ttu-id="3b9d3-225">确保用于连接到通过 ADO.NET 的数据库的登录名属于`sysadmin`角色。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-225">Ensure that the login used to connect to the database via ADO.NET belongs to the `sysadmin` role.</span></span>
- <span data-ttu-id="3b9d3-226">确保在开发计算机上使用的 Visual Studio 的 Windows 用户帐户是有效的 SQL Server 登录帐户属于`sysadmin`角色。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-226">Ensure that the Windows user account used by Visual Studio on the development machine is a valid SQL Server login account that belongs to the `sysadmin` role.</span></span>

<span data-ttu-id="3b9d3-227">第一步是相对来说比较简单。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-227">The first step is relatively straightforward.</span></span> <span data-ttu-id="3b9d3-228">首先，标识用于从 ASP.NET 应用程序连接到数据库，然后，从 SQL Server Management Studio 中，添加到该登录帐户的用户帐户`sysadmin`角色。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-228">First, identify the user account used to connect to the database from the ASP.NET application and then, from SQL Server Management Studio, add that login account to the `sysadmin` role.</span></span>

<span data-ttu-id="3b9d3-229">第二个任务需要用于调试应用程序的 Windows 用户帐户是远程数据库上的有效登录名。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-229">The second task requires that the Windows user account you use to debug the application be a valid login on the remote database.</span></span> <span data-ttu-id="3b9d3-230">但是，很可能您登录到你工作站的 Windows 帐户不是有效的 SQL Server 上的登录名。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-230">However, chances are the Windows account you logged on to your workstation with is not a valid login on SQL Server.</span></span> <span data-ttu-id="3b9d3-231">而不是将您的特定登录帐户添加到 SQL Server，更好的选择是将某个 Windows 用户帐户指定为 SQL Server 调试帐户。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-231">Rather than adding your particular login account to SQL Server, a better choice would be to designate some Windows user account as the SQL Server debugging account.</span></span> <span data-ttu-id="3b9d3-232">然后，若要调试的远程 SQL Server 实例的数据库对象，将运行 Visual Studio 中使用的 Windows 登录帐户的凭据。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-232">Then, to debug the database objects of a remote SQL Server instance, you would run Visual Studio using that Windows login account s credentials.</span></span>

<span data-ttu-id="3b9d3-233">示例可以帮助阐明事项。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-233">An example should help clarify things.</span></span> <span data-ttu-id="3b9d3-234">假设有一个名为的 Windows 帐户`SQLDebug`Windows 域中。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-234">Imagine that there is a Windows account named `SQLDebug` within the Windows domain.</span></span> <span data-ttu-id="3b9d3-235">此帐户需要添加到远程 SQL Server 实例作为有效的登录名的成员以及`sysadmin`角色。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-235">This account would need to be added to the remote SQL Server instance as a valid login and as a member of the `sysadmin` role.</span></span> <span data-ttu-id="3b9d3-236">然后，若要调试 Visual Studio 中的远程 SQL Server 实例，我们将需要运行 Visual Studio 作为`SQLDebug`用户。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-236">Then, to debug the remote SQL Server instance from Visual Studio, we would need to run Visual Studio as the `SQLDebug` user.</span></span> <span data-ttu-id="3b9d3-237">这可以通过返回以登录我们的工作站，超出的日志记录`SQLDebug`，然后启动 Visual Studio 中，但更简单的方法会登录到我们的工作站使用我们自己的凭据，然后使用`runas.exe`以启动 Visual Studio`SQLDebug`用户。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-237">This could be done by logging out of our workstation, logging back in as `SQLDebug`, and then launching Visual Studio, but a simpler approach would be to login to our workstation using our own credentials and then use `runas.exe` to launch Visual Studio as the `SQLDebug` user.</span></span> <span data-ttu-id="3b9d3-238">`runas.exe` 允许特定的应用程序执行假借不同的用户帐户。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-238">`runas.exe` allows a particular application to be executed under the guise of a different user account.</span></span> <span data-ttu-id="3b9d3-239">若要启动 Visual Studio 作为`SQLDebug`，可以输入以下语句在命令行：</span><span class="sxs-lookup"><span data-stu-id="3b9d3-239">To launch Visual Studio as `SQLDebug`, you could enter the following statement at the command line:</span></span>


[!code-console[Main](debugging-stored-procedures-cs/samples/sample2.cmd)]

<span data-ttu-id="3b9d3-240">有关此过程的更多详细说明，请参阅[William R.Vaughn](http://betav.com/BLOG/billva/) s *Hitchhiker 到 Visual Studio 和 SQL Server，第七版指南*，以及[How To:设置 SQL Server 权限以进行调试](https://msdn.microsoft.com/library/w1bhybwz(VS.80).aspx)。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-240">For a more detailed explanation on this process, see [William R. Vaughn](http://betav.com/BLOG/billva/) s *Hitchhiker s Guide to Visual Studio and SQL Server, Seventh Edition* as well as [How To: Set SQL Server Permissions for Debugging](https://msdn.microsoft.com/library/w1bhybwz(VS.80).aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="3b9d3-241">如果你的开发计算机正在运行 Windows XP Service Pack 2 将需要 Internet 连接防火墙配置为允许远程调试。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-241">If your development machine is running Windows XP Service Pack 2 you will need to configure the Internet Connection Firewall to allow remote debugging.</span></span> <span data-ttu-id="3b9d3-242">[如何：启用 SQL Server 2005 调试](https://msdn.microsoft.com/library/s0fk6z6e(VS.80).aspx)一文说明这涉及到两个步骤: （a） 在 Visual Studio 主机计算机，则必须添加`Devenv.exe`到例外列表并打开 TCP 135 端口; 以及 （b） 的远程的 (SQL) 计算机上，则必须打开 TCP 135端口和添加`sqlservr.exe`到例外列表。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-242">[The How To: Enable SQL Server 2005 Debugging](https://msdn.microsoft.com/library/s0fk6z6e(VS.80).aspx) article notes that this involves two steps: (a) On the Visual Studio host machine, you must add `Devenv.exe` to the Exceptions list and open the TCP 135 port; and (b) On the remote (SQL) machine, you must open the TCP 135 port and add `sqlservr.exe` to the Exceptions list.</span></span> <span data-ttu-id="3b9d3-243">如果您的域策略要求通过 IPSec 进行网络通信，则必须打开 UDP 4500 和 UDP 500 端口。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-243">If your domain policy requires network communication to be done through IPSec, you must open the UDP 4500 and UDP 500 ports.</span></span>


## <a name="summary"></a><span data-ttu-id="3b9d3-244">总结</span><span class="sxs-lookup"><span data-stu-id="3b9d3-244">Summary</span></span>

<span data-ttu-id="3b9d3-245">除了为.NET 应用程序代码提供调试支持，Visual Studio 还提供各种 SQL Server 2005 的调试选项。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-245">In addition to providing debugging support for .NET application code, Visual Studio also provides a variety of debugging options for SQL Server 2005.</span></span> <span data-ttu-id="3b9d3-246">在本教程中我们介绍了这些选项的两个：直接数据库调试和应用程序调试。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-246">In this tutorial we looked at two of those options: Direct Database Debugging and application debugging.</span></span> <span data-ttu-id="3b9d3-247">若要直接调试 T-SQL 的数据库对象，找到通过服务器资源管理器对象然后右键单击它，并选择单步执行。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-247">To directly debug a T-SQL database object, locate the object through the Server Explorer then right-click on it and choose Step Into.</span></span> <span data-ttu-id="3b9d3-248">这将启动调试器并在数据库对象，此时可以单步执行该对象的语句并查看和修改参数值中的第一个语句上暂停。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-248">This starts the debugger and halts on the first statement in the database object, at which point you can step through the object s statements and view and modify parameter values.</span></span> <span data-ttu-id="3b9d3-249">在步骤 1 中我们使用这种方法来单步执行`Products_SelectByCategoryID`存储过程。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-249">In Step 1 we used this approach to step into the `Products_SelectByCategoryID` stored procedure.</span></span>

<span data-ttu-id="3b9d3-250">应用程序调试，直接在数据库对象中设置的断点。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-250">Application debugging allows breakpoints to be set directly within the database objects.</span></span> <span data-ttu-id="3b9d3-251">从客户端应用程序 （如 ASP.NET web 应用程序） 调用具有断点的数据库对象时，程序将停止调试器时。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-251">When a database object with breakpoints is invoked from a client application (such as an ASP.NET web application), the program halts as the debugger takes over.</span></span> <span data-ttu-id="3b9d3-252">应用程序调试很有用，因为它更清楚地显示应用程序的操作会导致要调用的特定数据库对象。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-252">Application debugging is useful because it more clearly shows what application action causes a particular database object to be invoked.</span></span> <span data-ttu-id="3b9d3-253">但是，它需要更多的配置和设置比直接数据库调试。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-253">However, it requires a bit more configuration and setup than Direct Database Debugging.</span></span>

<span data-ttu-id="3b9d3-254">此外可以通过 SQL Server 项目调试数据库对象。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-254">Database objects can also be debugged through SQL Server Projects.</span></span> <span data-ttu-id="3b9d3-255">我们将介绍如何使用 SQL Server 项目，并在下一教程中，如何使用它们来创建和调试托管数据库对象。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-255">We will look at using SQL Server Projects and how to use them to create and debug managed database objects in the next tutorial.</span></span>

<span data-ttu-id="3b9d3-256">快乐编程 ！</span><span class="sxs-lookup"><span data-stu-id="3b9d3-256">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="3b9d3-257">关于作者</span><span class="sxs-lookup"><span data-stu-id="3b9d3-257">About the Author</span></span>

<span data-ttu-id="3b9d3-258">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)的七个部 asp/ASP.NET 书籍并创办了作者[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年以来一直致力于 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-258">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="3b9d3-259">Scott 是独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-259">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="3b9d3-260">他最新著作是[ *Sams Teach 自己 ASP.NET 2.0 24 小时内*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-260">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="3b9d3-261">他可以到达[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="3b9d3-261">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="3b9d3-262">或通过他的博客，其中，请参阅[ http://ScottOnWriting.NET ](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="3b9d3-262">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="3b9d3-263">[上一页](protecting-connection-strings-and-other-configuration-information-cs.md)
> [下一页](creating-stored-procedures-and-user-defined-functions-with-managed-code-cs.md)</span><span class="sxs-lookup"><span data-stu-id="3b9d3-263">[Previous](protecting-connection-strings-and-other-configuration-information-cs.md)
[Next](creating-stored-procedures-and-user-defined-functions-with-managed-code-cs.md)</span></span>
