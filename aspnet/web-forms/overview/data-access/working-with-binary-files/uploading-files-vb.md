---
uid: web-forms/overview/data-access/working-with-binary-files/uploading-files-vb
title: 上传文件 (VB) |Microsoft Docs
author: rick-anderson
description: 了解如何允许用户上传二进制文件 （如 Word 或 PDF 文档） 到其中可能会将它们存储在服务器的文件系统网站...
ms.author: riande
ms.date: 03/27/2007
ms.assetid: f7c00fbd-652c-433d-8ed3-0e5168a4d4df
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/uploading-files-vb
msc.type: authoredcontent
ms.openlocfilehash: 03c64f839d11249f912b534476d02607d0c2b7d5
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/06/2019
ms.locfileid: "65133846"
---
# <a name="uploading-files-vb"></a><span data-ttu-id="3d3bb-103">上载文件 (VB)</span><span class="sxs-lookup"><span data-stu-id="3d3bb-103">Uploading Files (VB)</span></span>

<span data-ttu-id="3d3bb-104">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="3d3bb-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="3d3bb-105">[下载示例应用程序](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_54_VB.exe)或[下载 PDF](uploading-files-vb/_static/datatutorial54vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="3d3bb-105">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_54_VB.exe) or [Download PDF](uploading-files-vb/_static/datatutorial54vb1.pdf)</span></span>

> <span data-ttu-id="3d3bb-106">了解如何允许用户上传二进制文件 （如 Word 或 PDF 文档），其中它们可能会在服务器的文件系统或数据库中存储您的网站。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-106">Learn how to allow users to upload binary files (such as Word or PDF documents) to your Web site where they may be stored in either the server's file system or the database.</span></span>

## <a name="introduction"></a><span data-ttu-id="3d3bb-107">介绍</span><span class="sxs-lookup"><span data-stu-id="3d3bb-107">Introduction</span></span>

<span data-ttu-id="3d3bb-108">所有这些教程我们 ve 检查到目前为止已以独占方式使用文本数据。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-108">All of the tutorials we ve examined so far have worked exclusively with text data.</span></span> <span data-ttu-id="3d3bb-109">但是，许多应用程序必须捕获文本和二进制数据的数据模型。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-109">However, many applications have data models that capture both text and binary data.</span></span> <span data-ttu-id="3d3bb-110">联机的约会站点可能会允许用户上传图片将其配置文件相关联。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-110">An online dating site might allow users to upload a picture to associate with their profile.</span></span> <span data-ttu-id="3d3bb-111">招聘网站可能会让用户将其恢复为 Microsoft Word 或 PDF 文档上传。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-111">A recruiting website might let users upload their resume as a Microsoft Word or PDF document.</span></span>

<span data-ttu-id="3d3bb-112">处理二进制数据将添加一组新的挑战。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-112">Working with binary data adds a new set of challenges.</span></span> <span data-ttu-id="3d3bb-113">我们必须决定如何在应用程序中存储二进制数据。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-113">We must decide how the binary data is stored in the application.</span></span> <span data-ttu-id="3d3bb-114">用于插入新记录的接口必须更新，以允许用户上传其计算机中的文件，并且必须采取额外步骤来显示或提供一个使下载记录 s 关联的二进制数据。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-114">The interface used for inserting new records has to be updated to allow the user to upload a file from their computer and extra steps must be taken to display or provide a means for downloading a record s associated binary data.</span></span> <span data-ttu-id="3d3bb-115">在本教程中下, 一步 3 中，我们将探讨如何难这些挑战。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-115">In this tutorial and the next three we'll explore how to hurdle these challenges.</span></span> <span data-ttu-id="3d3bb-116">在这些教程末尾我们将构建一个完全正常运行的应用程序，将图片和 PDF 小册子与每个类别相关联。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-116">At the end of these tutorials we'll have built a fully functional application that associates a picture and PDF brochure with each category.</span></span> <span data-ttu-id="3d3bb-117">在本特定教程中我们将看看不同的技术来存储二进制数据，并探讨如何使用户能够从他们的计算机文件上传和已保存在 web 服务器文件系统上。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-117">In this particular tutorial we'll look at different techniques for storing binary data and explore how to enable users to upload a file from their computer and have it saved on the web server s file system.</span></span>

> [!NOTE]
> <span data-ttu-id="3d3bb-118">是应用程序的数据模型的一部分的二进制数据有时称为[BLOB](http://en.wikipedia.org/wiki/Binary_large_object)，二进制大型对象的首字母缩写。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-118">Binary data that is part of an application s data model is sometimes referred to as a [BLOB](http://en.wikipedia.org/wiki/Binary_large_object), an acronym for Binary Large OBject.</span></span> <span data-ttu-id="3d3bb-119">在这些教程中我已选择要使用的术语的二进制数据，虽然此术语 BLOB 为同义词。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-119">In these tutorials I have chosen to use the terminology binary data, although the term BLOB is synonymous.</span></span>

## <a name="step-1-creating-the-working-with-binary-data-web-pages"></a><span data-ttu-id="3d3bb-120">步骤 1：使用二进制数据 Web 页创建工作</span><span class="sxs-lookup"><span data-stu-id="3d3bb-120">Step 1: Creating the Working with Binary Data Web Pages</span></span>

<span data-ttu-id="3d3bb-121">我们开始浏览与添加对二进制数据的支持的难题之前，让 s 先花点时间在我们的网站项目，我们需要为本教程中下, 一步 3 中创建 ASP.NET 页面。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-121">Before we begin to explore the challenges associated with adding support for binary data, let s first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial and the next three.</span></span> <span data-ttu-id="3d3bb-122">首先，通过添加一个名为的新文件夹`BinaryData`。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-122">Start by adding a new folder named `BinaryData`.</span></span> <span data-ttu-id="3d3bb-123">接下来，将以下 ASP.NET 页面添加到该文件夹，并确保将与每个页面相关联`Site.master`母版页：</span><span class="sxs-lookup"><span data-stu-id="3d3bb-123">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `FileUpload.aspx`
- `DisplayOrDownloadData.aspx`
- `UploadInDetailsView.aspx`
- `UpdatingAndDeleting.aspx`

![将 ASP.NET 页面添加二进制与数据相关的教程](uploading-files-vb/_static/image1.gif)

<span data-ttu-id="3d3bb-125">**图 1**:将 ASP.NET 页面添加二进制与数据相关的教程</span><span class="sxs-lookup"><span data-stu-id="3d3bb-125">**Figure 1**: Add the ASP.NET Pages for the Binary Data-Related Tutorials</span></span>

<span data-ttu-id="3d3bb-126">在其他文件夹中，喜欢`Default.aspx`在`BinaryData`文件夹将在其部分中列出的教程。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-126">Like in the other folders, `Default.aspx` in the `BinaryData` folder will list the tutorials in its section.</span></span> <span data-ttu-id="3d3bb-127">请记住，`SectionLevelTutorialListing.ascx`用户控件提供了此功能。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-127">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="3d3bb-128">因此，此用户控件添加到`Default.aspx`通过从解决方案资源管理器中拖到页面上的设计视图中拖动。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-128">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>

<span data-ttu-id="3d3bb-129">[![将 SectionLevelTutorialListing.ascx 用户控件添加到 Default.aspx](uploading-files-vb/_static/image2.gif)](uploading-files-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="3d3bb-129">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](uploading-files-vb/_static/image2.gif)](uploading-files-vb/_static/image1.png)</span></span>

<span data-ttu-id="3d3bb-130">**图 2**:添加`SectionLevelTutorialListing.ascx`到用户控件`Default.aspx`([单击以查看实际尺寸的图像](uploading-files-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="3d3bb-130">**Figure 2**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](uploading-files-vb/_static/image2.png))</span></span>

<span data-ttu-id="3d3bb-131">最后，将这些页面添加到条目为`Web.sitemap`文件。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-131">Lastly, add these pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="3d3bb-132">具体而言，在提高后添加以下标记 GridView `<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="3d3bb-132">Specifically, add the following markup after the Enhancing the GridView `<siteMapNode>`:</span></span>

[!code-xml[Main](uploading-files-vb/samples/sample1.xml)]

<span data-ttu-id="3d3bb-133">更新后`Web.sitemap`，花点时间查看通过浏览器网站的教程。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-133">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="3d3bb-134">在左侧菜单现在包含二进制数据教程使用的项。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-134">The menu on the left now includes items for the Working with Binary Data tutorials.</span></span>

![站点图现在包括二进制数据教程使用的条目](uploading-files-vb/_static/image3.gif)

<span data-ttu-id="3d3bb-136">**图 3**:站点图现在包括二进制数据教程使用的条目</span><span class="sxs-lookup"><span data-stu-id="3d3bb-136">**Figure 3**: The Site Map Now Includes Entries for the Working with Binary Data Tutorials</span></span>

## <a name="step-2-deciding-where-to-store-the-binary-data"></a><span data-ttu-id="3d3bb-137">步骤 2：确定在何处存储二进制数据</span><span class="sxs-lookup"><span data-stu-id="3d3bb-137">Step 2: Deciding Where to Store the Binary Data</span></span>

<span data-ttu-id="3d3bb-138">与应用程序的数据模型关联的二进制数据可以存储在两个位置之一： 具有对该数据库; 中存储的文件的引用的 web 服务器的文件系统上或直接在数据库本身中 （请参阅图 4）。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-138">Binary data that is associated with the application s data model can be stored in one of two places: on the web server s file system with a reference to the file stored in the database; or directly within the database itself (see Figure 4).</span></span> <span data-ttu-id="3d3bb-139">每种方法有其自己的优点和缺点集，并需要更多详细的讨论。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-139">Each approach has its own set of pros and cons and merits a more detailed discussion.</span></span>

<span data-ttu-id="3d3bb-140">[![可以存储二进制数据，在文件系统或直接在数据库中](uploading-files-vb/_static/image4.gif)](uploading-files-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="3d3bb-140">[![Binary Data Can Be Stored On the File System or Directly in the Database](uploading-files-vb/_static/image4.gif)](uploading-files-vb/_static/image3.png)</span></span>

<span data-ttu-id="3d3bb-141">**图 4**:可以存储二进制数据，在文件系统或直接在数据库中 ([单击此项可查看原尺寸图像](uploading-files-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="3d3bb-141">**Figure 4**: Binary Data Can Be Stored On the File System or Directly in the Database ([Click to view full-size image](uploading-files-vb/_static/image4.png))</span></span>

<span data-ttu-id="3d3bb-142">假设我们想要扩展 Northwind 数据库，以将图片与每个产品相关联。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-142">Imagine that we wanted to extend the Northwind database to associate a picture with each product.</span></span> <span data-ttu-id="3d3bb-143">是一种方法存储这些 web 服务器的文件系统上的图像文件，并记录中的路径`Products`表。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-143">One option would be to store these image files on the web server s file system and record the path in the `Products` table.</span></span> <span data-ttu-id="3d3bb-144">使用此方法时，我们 d 添加`ImagePath`列添加到`Products`类型的表`varchar(200)`，可能是。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-144">With this approach, we d add an `ImagePath` column to the `Products` table of type `varchar(200)`, perhaps.</span></span> <span data-ttu-id="3d3bb-145">当用户上传牛奶的图片时，可能会在 web 服务器的文件系统上存储该图片`~/Images/Tea.jpg`，其中`~`表示应用程序的物理路径。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-145">When a user uploaded a picture for Chai, that picture might be stored on the web server s file system at `~/Images/Tea.jpg`, where `~` represents the application s physical path.</span></span> <span data-ttu-id="3d3bb-146">也就是说，如果网站已取得 root 权限的物理路径处`C:\Websites\Northwind\`，`~/Images/Tea.jpg`等同于`C:\Websites\Northwind\Images\Tea.jpg`。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-146">That is, if the web site is rooted at the physical path `C:\Websites\Northwind\`, `~/Images/Tea.jpg` would be equivalent to `C:\Websites\Northwind\Images\Tea.jpg`.</span></span> <span data-ttu-id="3d3bb-147">上传的图像文件以后, 我们 d 更新中的 Chai 记录`Products`表，以便其`ImagePath`引用列的新图像的路径。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-147">After uploading the image file, we d update the Chai record in the `Products` table so that its `ImagePath` column referenced the path of the new image.</span></span> <span data-ttu-id="3d3bb-148">我们可以使用`~/Images/Tea.jpg`或仅`Tea.jpg`如果产品的所有映像，将都放置在应用程序，我们决定`Images`文件夹。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-148">We could use `~/Images/Tea.jpg` or just `Tea.jpg` if we decided that all product images would be placed in the application s `Images` folder.</span></span>

<span data-ttu-id="3d3bb-149">将二进制数据存储在文件系统上的主要优点是：</span><span class="sxs-lookup"><span data-stu-id="3d3bb-149">The main advantages of storing the binary data on the file system are:</span></span>

- <span data-ttu-id="3d3bb-150">**简易的实施**我们稍后将看到的如存储和检索直接在数据库中存储的二进制数据涉及相比时使用的数据通过文件系统的更多代码。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-150">**Ease of implementation** as we'll see shortly, storing and retrieving binary data stored directly within the database involves a bit more code than when working with data through the file system.</span></span> <span data-ttu-id="3d3bb-151">此外，为了使用户可以查看或下载的二进制数据中它们必须显示指向该数据的 url。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-151">Additionally, in order for a user to view or download binary data they must be presented with a URL to that data.</span></span> <span data-ttu-id="3d3bb-152">如果数据驻留在 web 服务器文件系统上，该 URL 非常简单。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-152">If the data resides on the web server s file system, the URL is straightforward.</span></span> <span data-ttu-id="3d3bb-153">如果数据存储在数据库中，但是，web 页需要创建将检索，并从数据库中返回数据。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-153">If the data is stored in the database, however, a web page needs to be created that will retrieve and return the data from the database.</span></span>
- <span data-ttu-id="3d3bb-154">**二进制数据的更广泛访问**二进制数据可能需要可供其他服务或应用程序，不能提取数据库中的数据的访问。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-154">**Wider access to the binary data** the binary data may need to be accessible to other services or applications, ones that cannot pull the data from the database.</span></span> <span data-ttu-id="3d3bb-155">例如，与每个产品相关联的映像可能还需要可供用户通过[FTP](http://en.wikipedia.org/wiki/File_Transfer_Protocol)，在这种情况下 d 我们想要将二进制数据存储在文件系统。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-155">For example, the images associated with each product might also need to be available to users through [FTP](http://en.wikipedia.org/wiki/File_Transfer_Protocol), in which case we d want to store the binary data on the file system.</span></span>
- <span data-ttu-id="3d3bb-156">**性能**二进制数据存储在文件系统上，如果数据库服务器和 web 服务器之间按需和网络阻塞将少于如果直接在数据库中存储二进制数据。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-156">**Performance** if the binary data is stored on the file system, the demand and network congestion between the database server and web server will be less than if the binary data is stored directly within the database.</span></span>

<span data-ttu-id="3d3bb-157">将二进制数据存储在文件系统上的主要缺点是它分离了数据库中的数据。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-157">The main disadvantage of storing binary data on the file system is that it decouples the data from the database.</span></span> <span data-ttu-id="3d3bb-158">如果从删除了记录`Products`表中，web 服务器的文件系统上关联的文件不会自动删除。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-158">If a record is deleted from the `Products` table, the associated file on the web server s file system is not automatically deleted.</span></span> <span data-ttu-id="3d3bb-159">我们必须编写额外代码以删除该文件或文件系统将会变得杂乱的未使用的、 孤立的文件。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-159">We must write extra code to delete the file or the file system will become cluttered with unused, orphaned files.</span></span> <span data-ttu-id="3d3bb-160">此外，当将数据库备份，我们必须确保文件系统上进行关联的二进制数据的备份。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-160">Furthermore, when backing up the database, we must make sure to make backups of the associated binary data on the file system, as well.</span></span> <span data-ttu-id="3d3bb-161">将数据库移动到另一个站点或服务器会产生类似问题。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-161">Moving the database to another site or server poses similar challenges.</span></span>

<span data-ttu-id="3d3bb-162">或者，二进制数据可以存储在 Microsoft SQL Server 2005 数据库中直接通过创建类型的列的`varbinary`。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-162">Alternatively, binary data can be stored directly in a Microsoft SQL Server 2005 database by creating a column of type `varbinary`.</span></span> <span data-ttu-id="3d3bb-163">像其他可变长度数据类型，您可以指定二进制数据可占用的最大长度此列中。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-163">Like with other variable length data types, you can specify a maximum length of the binary data that can be held in this column.</span></span> <span data-ttu-id="3d3bb-164">例如，若要保留最多 5,000 个字节使用`varbinary(5000)`;`varbinary(MAX)`允许的最大存储大小，大约 2 GB。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-164">For example, to reserve at most 5,000 bytes use `varbinary(5000)`; `varbinary(MAX)` allows for the maximum storage size, about 2 GB.</span></span>

<span data-ttu-id="3d3bb-165">直接在数据库中存储二进制数据的主要优点是二进制数据和数据库记录之间的紧密耦合。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-165">The main advantage of storing binary data directly in the database is the tight coupling between the binary data and the database record.</span></span> <span data-ttu-id="3d3bb-166">这极大地简化了数据库管理任务，如备份或将数据库移到另一个站点或服务器。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-166">This greatly simplifies database administration tasks, like backups or moving the database to a different site or server.</span></span> <span data-ttu-id="3d3bb-167">此外，自动删除一条记录会删除相应的二进制数据。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-167">Also, deleting a record automatically deletes the corresponding binary data.</span></span> <span data-ttu-id="3d3bb-168">还有更多的在数据库中存储二进制数据的细微优势。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-168">There are also more subtle benefits of storing the binary data in the database.</span></span> <span data-ttu-id="3d3bb-169">请参阅[存储二进制文件直接在数据库使用 ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/120606-1.aspx)有关更深入讨论。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-169">See [Storing Binary Files Directly in the Database Using ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/120606-1.aspx) for a more in-depth discussion.</span></span>

> [!NOTE]
> <span data-ttu-id="3d3bb-170">在 Microsoft SQL Server 2000 和早期版本中，`varbinary`数据类型有最大限制为 8000 个字节。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-170">In Microsoft SQL Server 2000 and earlier versions, the `varbinary` data type had a maximum limit of 8,000 bytes.</span></span> <span data-ttu-id="3d3bb-171">用于存储二进制数据的最多为 2 GB [ `image`数据类型](https://msdn.microsoft.com/library/ms187993.aspx)需要改为使用。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-171">To store up to 2 GB of binary data the [`image` data type](https://msdn.microsoft.com/library/ms187993.aspx) needs to be used instead.</span></span> <span data-ttu-id="3d3bb-172">通过添加`MAX`在 SQL Server 2005，但是，`image`推荐使用的数据类型。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-172">With the addition of `MAX` in SQL Server 2005, however, the `image` data type has been deprecated.</span></span> <span data-ttu-id="3d3bb-173">它 s 仍支持向后兼容性，但 Microsoft 宣布`image`将 SQL Server 的未来版本中删除数据类型。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-173">It s still supported for backwards compatibility, but Microsoft has announced that the `image` data type will be removed in a future version of SQL Server.</span></span>

<span data-ttu-id="3d3bb-174">如果你正在使用较旧的数据模型可能会看到`image`数据类型。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-174">If you are working with an older data model you may see the `image` data type.</span></span> <span data-ttu-id="3d3bb-175">Northwind 数据库 s`Categories`表具有`Picture`可以用于存储二进制数据的类别的图像文件的列。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-175">The Northwind database s `Categories` table has a `Picture` column that can be used to store the binary data of an image file for the category.</span></span> <span data-ttu-id="3d3bb-176">Northwind 数据库起源于 Microsoft Access 和 SQL Server 的早期版本，因为此列的类型是`image`。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-176">Since the Northwind database has its roots in Microsoft Access and earlier versions of SQL Server, this column is of type `image`.</span></span>

<span data-ttu-id="3d3bb-177">对于本教程的下一步的三个，我们将使用这两种方法。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-177">For this tutorial and the next three, we'll use both approaches.</span></span> <span data-ttu-id="3d3bb-178">`Categories`表中已包含`Picture`列用于存储二进制内容的类别的图像。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-178">The `Categories` table already has a `Picture` column for storing the binary content of an image for the category.</span></span> <span data-ttu-id="3d3bb-179">我们将添加一个额外的列`BrochurePath`，以 pdf 格式的路径存储在 web 服务器的文件系统，可用于打印质量、 可媲美的类别概述。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-179">We'll add an additional column, `BrochurePath`, to store a path to a PDF on the web server s file system that can be used to provide a print-quality, polished overview of the category.</span></span>

## <a name="step-3-adding-thebrochurepathcolumn-to-thecategoriestable"></a><span data-ttu-id="3d3bb-180">步骤 3：添加`BrochurePath`列添加到`Categories`表</span><span class="sxs-lookup"><span data-stu-id="3d3bb-180">Step 3: Adding the`BrochurePath`Column to the`Categories`Table</span></span>

<span data-ttu-id="3d3bb-181">当前类别表中的只有四个列： `CategoryID`， `CategoryName`， `Description`，和`Picture`。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-181">Currently the Categories table has only four columns: `CategoryID`, `CategoryName`, `Description`, and `Picture`.</span></span> <span data-ttu-id="3d3bb-182">除了这些字段中，我们需要添加一个将指向类别的手册 （如果存在） 的新。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-182">In addition to these fields, we need to add a new one that will point to the category s brochure (if one exists).</span></span> <span data-ttu-id="3d3bb-183">若要添加此列，请转到服务器资源管理器，向下钻取到表，右键单击`Categories`表，并选择打开表定义 （请参见图 5）。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-183">To add this column, go to the Server Explorer, drill down into the Tables, right-click on the `Categories` table and choose Open Table Definition (see Figure 5).</span></span> <span data-ttu-id="3d3bb-184">如果看不到服务器资源管理器，使其通过从视图菜单中选择服务器资源管理器选项或按 Ctrl + Alt + S。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-184">If you do not see the Server Explorer, bring it up by selecting the Server Explorer option from the View menu, or hit Ctrl+Alt+S.</span></span>

<span data-ttu-id="3d3bb-185">添加一个新`varchar(200)`列添加到`Categories`名为表`BrochurePath`，并允许`NULL`s 并单击保存图标 （或按 Ctrl + S）。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-185">Add a new `varchar(200)` column to the `Categories` table that is named `BrochurePath` and allows `NULL` s and click the Save icon (or hit Ctrl+S).</span></span>

<span data-ttu-id="3d3bb-186">[![将 BrochurePath 列添加到类别表](uploading-files-vb/_static/image5.gif)](uploading-files-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="3d3bb-186">[![Add a BrochurePath Column to the Categories Table](uploading-files-vb/_static/image5.gif)](uploading-files-vb/_static/image5.png)</span></span>

<span data-ttu-id="3d3bb-187">**图 5**:添加`BrochurePath`列添加到`Categories`表 ([单击以查看实际尺寸的图像](uploading-files-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="3d3bb-187">**Figure 5**: Add a `BrochurePath` Column to the `Categories` Table ([Click to view full-size image](uploading-files-vb/_static/image6.png))</span></span>

## <a name="step-4-updating-the-architecture-to-use-thepictureandbrochurepathcolumns"></a><span data-ttu-id="3d3bb-188">步骤 4：更新以使用体系结构`Picture`和`BrochurePath`列</span><span class="sxs-lookup"><span data-stu-id="3d3bb-188">Step 4: Updating the Architecture to Use the`Picture`and`BrochurePath`Columns</span></span>

<span data-ttu-id="3d3bb-189">`CategoriesDataTable`数据访问层 (DAL) 中当前具有四个`DataColumn`定义的 s: `CategoryID`， `CategoryName`， `Description`，并`NumberOfProducts`。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-189">The `CategoriesDataTable` in the Data Access Layer (DAL) currently has four `DataColumn` s defined: `CategoryID`, `CategoryName`, `Description`, and `NumberOfProducts`.</span></span> <span data-ttu-id="3d3bb-190">我们最初设计中的此 DataTable[创建数据访问层](../introduction/creating-a-data-access-layer-vb.md)教程中，`CategoriesDataTable`只有前三个列;`NumberOfProducts`列中添加[母版/详细信息使用项目符号列表的详细信息 DataList 使用母版记录](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-vb.md)教程。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-190">When we originally designed this DataTable in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial, the `CategoriesDataTable` only had the first three columns; the `NumberOfProducts` column was added in the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-vb.md) tutorial.</span></span>

<span data-ttu-id="3d3bb-191">如中所述*创建数据访问层*，在类型化数据集中数据表组成业务对象。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-191">As discussed in *Creating a Data Access Layer*, the DataTables in the Typed DataSet make up the business objects.</span></span> <span data-ttu-id="3d3bb-192">Tableadapter 是负责与数据库通信和填充查询结果与业务对象。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-192">The TableAdapters are responsible for communicating with the database and populating the business objects with the query results.</span></span> <span data-ttu-id="3d3bb-193">`CategoriesDataTable`由填充`CategoriesTableAdapter`，其中包含三个数据检索方法：</span><span class="sxs-lookup"><span data-stu-id="3d3bb-193">The `CategoriesDataTable` is populated by the `CategoriesTableAdapter`, which has three data retrieval methods:</span></span>

- <span data-ttu-id="3d3bb-194">`GetCategories()` 执行 TableAdapter s 主查询并返回`CategoryID`， `CategoryName`，并`Description`字段中的所有记录`Categories`表。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-194">`GetCategories()` executes the TableAdapter s main query and returns the `CategoryID`, `CategoryName`, and `Description` fields of all records in the `Categories` table.</span></span> <span data-ttu-id="3d3bb-195">主查询是使用自动生成的`Insert`和`Update`方法。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-195">The main query is what is used by the auto-generated `Insert` and `Update` methods.</span></span>
- <span data-ttu-id="3d3bb-196">`GetCategoryByCategoryID(categoryID)` 返回`CategoryID`， `CategoryName`，并`Description`类别的字段的`CategoryID`等于*categoryID*。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-196">`GetCategoryByCategoryID(categoryID)` returns the `CategoryID`, `CategoryName`, and `Description` fields of the category whose `CategoryID` equals *categoryID*.</span></span>
- <span data-ttu-id="3d3bb-197">`GetCategoriesAndNumberOfProducts()` -返回`CategoryID`， `CategoryName`，并`Description`中的所有记录的字段`Categories`表。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-197">`GetCategoriesAndNumberOfProducts()` - returns the `CategoryID`, `CategoryName`, and `Description` fields for all records in the `Categories` table.</span></span> <span data-ttu-id="3d3bb-198">此外可以使用子查询来返回与每个类别相关联的产品数量。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-198">Also uses a subquery to return the number of products associated with each category.</span></span>

<span data-ttu-id="3d3bb-199">请注意，不能提供的查询返回`Categories`表 s`Picture`或`BrochurePath`列; 也不会`CategoriesDataTable`提供`DataColumn`s 为这些字段。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-199">Notice that none of these queries return the `Categories` table s `Picture` or `BrochurePath` columns; nor does the `CategoriesDataTable` provide `DataColumn` s for these fields.</span></span> <span data-ttu-id="3d3bb-200">若要使用的图片和`BrochurePath`属性，我们需要首先将其添加到`CategoriesDataTable`，然后更新`CategoriesTableAdapter`类以返回这些列。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-200">In order to work with the Picture and `BrochurePath` properties, we need to first add them to the `CategoriesDataTable` and then update the `CategoriesTableAdapter` class to return these columns.</span></span>

## <a name="adding-thepictureandbrochurepathdatacolumn-s"></a><span data-ttu-id="3d3bb-201">添加`Picture`和`BrochurePath``DataColumn`s</span><span class="sxs-lookup"><span data-stu-id="3d3bb-201">Adding the`Picture`and`BrochurePath``DataColumn` s</span></span>

<span data-ttu-id="3d3bb-202">首先，通过添加到这两个列`CategoriesDataTable`。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-202">Start by adding these two columns to the `CategoriesDataTable`.</span></span> <span data-ttu-id="3d3bb-203">右键单击`CategoriesDataTable`s 标头，从上下文菜单中选择添加，然后选择列选项。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-203">Right-click on the `CategoriesDataTable` s header, select Add from the context menu and then choose the Column option.</span></span> <span data-ttu-id="3d3bb-204">这将创建一个新`DataColumn`中名为的 DataTable `Column1`。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-204">This will create a new `DataColumn` in the DataTable named `Column1`.</span></span> <span data-ttu-id="3d3bb-205">为此列重命名`Picture`。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-205">Rename this column to `Picture`.</span></span> <span data-ttu-id="3d3bb-206">从属性窗口中，设置`DataColumn`s`DataType`属性设置为`System.Byte[]`（这不是下拉列表中的一个选项; 你需要键入中）。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-206">From the Properties window, set the `DataColumn` s `DataType` property to `System.Byte[]` (this is not an option in the drop-down list; you need to type it in).</span></span>

<span data-ttu-id="3d3bb-207">[![创建 DataColumn 名为图片数据类型与 System.Byte](uploading-files-vb/_static/image6.gif)](uploading-files-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="3d3bb-207">[![Create a DataColumn Named Picture whose DataType is System.Byte[]](uploading-files-vb/_static/image6.gif)](uploading-files-vb/_static/image7.png)</span></span>

<span data-ttu-id="3d3bb-208">**图 6**:创建`DataColumn`Named`Picture`其`DataType`是`System.Byte[]`([单击以查看实际尺寸的图像](uploading-files-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="3d3bb-208">**Figure 6**: Create a `DataColumn` Named `Picture` whose `DataType` is `System.Byte[]` ([Click to view full-size image](uploading-files-vb/_static/image8.png))</span></span>

<span data-ttu-id="3d3bb-209">添加另一个`DataColumn`到 DataTable，其命名为`BrochurePath`使用默认`DataType`值 (`System.String`)。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-209">Add another `DataColumn` to the DataTable, naming it `BrochurePath` using the default `DataType` value (`System.String`).</span></span>

## <a name="returning-thepictureandbrochurepathvalues-from-the-tableadapter"></a><span data-ttu-id="3d3bb-210">返回`Picture`和`BrochurePath`TableAdapter 中的值</span><span class="sxs-lookup"><span data-stu-id="3d3bb-210">Returning the`Picture`and`BrochurePath`Values from the TableAdapter</span></span>

<span data-ttu-id="3d3bb-211">使用这两个`DataColumn`添加到的 s `CategoriesDataTable`，我们已准备好更新重新`CategoriesTableAdapter`。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-211">With these two `DataColumn` s added to the `CategoriesDataTable`, we re ready to update the `CategoriesTableAdapter`.</span></span> <span data-ttu-id="3d3bb-212">我们可以有两个主要的 TableAdapter 查询中返回这些列的值，但此时会显示返回的二进制数据每次`GetCategories()`调用方法。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-212">We could have both of these column values returned in the main TableAdapter query, but this would bring back the binary data every time the `GetCategories()` method was invoked.</span></span> <span data-ttu-id="3d3bb-213">相反，let s 更新主的 TableAdapter 查询，以使重新`BrochurePath`并创建返回特定类别 s 的其他数据检索方法`Picture`列。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-213">Instead, let s update the main TableAdapter query to bring back `BrochurePath` and create an additional data retrieval method that returns a particular category s `Picture` column.</span></span>

<span data-ttu-id="3d3bb-214">若要更新主 TableAdapter 查询，请右键单击`CategoriesTableAdapter`s 标头，然后从上下文菜单中选择配置选项。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-214">To update the main TableAdapter query, right-click on the `CategoriesTableAdapter` s header and choose the Configure option from the context menu.</span></span> <span data-ttu-id="3d3bb-215">这将显示表的适配器配置向导的我们 ve 许多过去的教程中所示。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-215">This brings up the Table Adapter Configuration Wizard, which we ve seen in a number of past tutorials.</span></span> <span data-ttu-id="3d3bb-216">更新查询，以使重新`BrochurePath`并单击完成。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-216">Update the query to bring back the `BrochurePath` and click Finish.</span></span>

<span data-ttu-id="3d3bb-217">[![更新也会返回 BrochurePath 的 SELECT 语句中的列列表](uploading-files-vb/_static/image7.gif)](uploading-files-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="3d3bb-217">[![Update the Column List in the SELECT Statement to Also Return BrochurePath](uploading-files-vb/_static/image7.gif)](uploading-files-vb/_static/image9.png)</span></span>

<span data-ttu-id="3d3bb-218">**图 7**:更新中的列列表`SELECT`语句也会返回`BrochurePath`([单击以查看实际尺寸的图像](uploading-files-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="3d3bb-218">**Figure 7**: Update the Column List in the `SELECT` Statement to Also Return `BrochurePath` ([Click to view full-size image](uploading-files-vb/_static/image10.png))</span></span>

<span data-ttu-id="3d3bb-219">当使用 TableAdapter 临时 SQL 语句，更新主查询中的列列表的所有更新列列表`SELECT`查询 TableAdapter 中的方法。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-219">When using ad-hoc SQL statements for the TableAdapter, updating the column list in the main query updates the column list for all of the `SELECT` query methods in the TableAdapter.</span></span> <span data-ttu-id="3d3bb-220">这意味着`GetCategoryByCategoryID(categoryID)`方法已更新，以返回`BrochurePath`列中，这可能是我们的预期。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-220">That means the `GetCategoryByCategoryID(categoryID)` method has been updated to return the `BrochurePath` column, which might be what we intended.</span></span> <span data-ttu-id="3d3bb-221">但是，它还更新中的列列表`GetCategoriesAndNumberOfProducts()`方法，删除子查询返回的每个类别的产品数量 ！</span><span class="sxs-lookup"><span data-stu-id="3d3bb-221">However, it also updated the column list in the `GetCategoriesAndNumberOfProducts()` method, removing the subquery that returns the number of products for each category!</span></span> <span data-ttu-id="3d3bb-222">因此，我们需要更新此方法，s`SELECT`查询。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-222">Therefore, we need to update this method s `SELECT` query.</span></span> <span data-ttu-id="3d3bb-223">右键单击`GetCategoriesAndNumberOfProducts()`方法中，选择配置，并还原`SELECT`回其原始值的查询：</span><span class="sxs-lookup"><span data-stu-id="3d3bb-223">Right-click on the `GetCategoriesAndNumberOfProducts()` method, choose Configure, and revert the `SELECT` query back to its original value:</span></span>

[!code-sql[Main](uploading-files-vb/samples/sample2.sql)]

<span data-ttu-id="3d3bb-224">接下来，创建新的 TableAdapter 方法返回特定类别的`Picture`列的值。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-224">Next, create a new TableAdapter method that returns a particular category s `Picture` column value.</span></span> <span data-ttu-id="3d3bb-225">右键单击`CategoriesTableAdapter`s 标头，并选择添加查询选项以启动 TableAdapter 查询配置向导。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-225">Right-click on the `CategoriesTableAdapter` s header and choose the Add Query option to launch the TableAdapter Query Configuration Wizard.</span></span> <span data-ttu-id="3d3bb-226">此向导的第一步会要求我们是否我们要使用的临时 SQL 语句查询数据，一个新存储过程或一个现有。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-226">The first step of this wizard asks us if we want to query data using an ad-hoc SQL statement, a new stored procedure, or an existing one.</span></span> <span data-ttu-id="3d3bb-227">选择使用 SQL 语句，然后单击下一步。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-227">Select Use SQL statements and click Next.</span></span> <span data-ttu-id="3d3bb-228">由于我们将返回行，选择选择第二个步骤中返回的行选项。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-228">Since we will be returning a row, choose the SELECT which returns rows option from the second step.</span></span>

<span data-ttu-id="3d3bb-229">[![选择使用 SQL 语句选项](uploading-files-vb/_static/image8.gif)](uploading-files-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="3d3bb-229">[![Select the Use SQL statements Option](uploading-files-vb/_static/image8.gif)](uploading-files-vb/_static/image11.png)</span></span>

<span data-ttu-id="3d3bb-230">**图 8**:选择使用 SQL 语句选项 ([单击此项可查看原尺寸图像](uploading-files-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="3d3bb-230">**Figure 8**: Select the Use SQL statements Option ([Click to view full-size image](uploading-files-vb/_static/image12.png))</span></span>

<span data-ttu-id="3d3bb-231">[![由于从类别表，则查询将返回一条记录，选择选择其返回的行](uploading-files-vb/_static/image9.gif)](uploading-files-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="3d3bb-231">[![Since the Query Will Return a Record from the Categories Table, Choose SELECT which returns rows](uploading-files-vb/_static/image9.gif)](uploading-files-vb/_static/image13.png)</span></span>

<span data-ttu-id="3d3bb-232">**图 9**:因为查询会从类别表中，选择选择返回的行返回一条记录 ([单击此项可查看原尺寸图像](uploading-files-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="3d3bb-232">**Figure 9**: Since the Query Will Return a Record from the Categories Table, Choose SELECT which returns rows ([Click to view full-size image](uploading-files-vb/_static/image14.png))</span></span>

<span data-ttu-id="3d3bb-233">在第三个步骤中，输入以下 SQL 查询，然后单击下一步:</span><span class="sxs-lookup"><span data-stu-id="3d3bb-233">In the third step, enter the following SQL query and click Next:</span></span>

[!code-sql[Main](uploading-files-vb/samples/sample3.sql)]

<span data-ttu-id="3d3bb-234">最后一步是选择新的方法的名称。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-234">The last step is to choose the name for the new method.</span></span> <span data-ttu-id="3d3bb-235">使用`FillCategoryWithBinaryDataByCategoryID`和`GetCategoryWithBinaryDataByCategoryID`填充 DataTable 并返回数据表模式，分别。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-235">Use `FillCategoryWithBinaryDataByCategoryID` and `GetCategoryWithBinaryDataByCategoryID` for the Fill a DataTable and Return a DataTable patterns, respectively.</span></span> <span data-ttu-id="3d3bb-236">单击完成以完成向导。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-236">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="3d3bb-237">[![选择 TableAdapter 的方法的名称](uploading-files-vb/_static/image10.gif)](uploading-files-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="3d3bb-237">[![Choose the Names for the TableAdapter s Methods](uploading-files-vb/_static/image10.gif)](uploading-files-vb/_static/image15.png)</span></span>

<span data-ttu-id="3d3bb-238">**图 10**:选择 TableAdapter 的方法的名称 ([单击此项可查看原尺寸图像](uploading-files-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="3d3bb-238">**Figure 10**: Choose the Names for the TableAdapter s Methods ([Click to view full-size image](uploading-files-vb/_static/image16.png))</span></span>

> [!NOTE]
> <span data-ttu-id="3d3bb-239">表适配器查询配置向导完成后可能会看到一个对话框，通知您，新的命令文本返回具有架构的数据不同于主查询的架构。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-239">After completing the Table Adapter Query Configuration Wizard you may see a dialog box informing you that the new command text returns data with schema different from the schema of the main query.</span></span> <span data-ttu-id="3d3bb-240">简单地说，该向导注意的是，TableAdapter s 主查询`GetCategories()`返回比我们刚刚创建的一个不同的架构。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-240">In short, the wizard is noting that the TableAdapter s main query `GetCategories()` returns a different schema than the one we just created.</span></span> <span data-ttu-id="3d3bb-241">但这是我们希望的因此可以忽略此消息。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-241">But this is what we want, so you can disregard this message.</span></span>

<span data-ttu-id="3d3bb-242">此外，请记住，如果使用临时 SQL 语句并且使用向导更改 TableAdapter s 有时更高版本的主查询中时，它将修改`GetCategoryWithBinaryDataByCategoryID`s 方法`SELECT`语句的列列表，以包括从仅对这些列主查询 (即，它将删除`Picture`查询中的列)。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-242">Also, keep in mind that if you are using ad-hoc SQL statements and use the wizard to change the TableAdapter s main query at some later point in time, it will modify the `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement s column list to include just those columns from the main query (that is, it will remove the `Picture` column from the query).</span></span> <span data-ttu-id="3d3bb-243">您将必须手动更新要返回的列列表`Picture`列中，类似于我们所做的与`GetCategoriesAndNumberOfProducts()`之前在此步骤中的方法。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-243">You will have to manually update the column list to return the `Picture` column, similar to what we did with the `GetCategoriesAndNumberOfProducts()` method earlier in this step.</span></span>

<span data-ttu-id="3d3bb-244">添加两个后`DataColumn`向`CategoriesDataTable`并`GetCategoryWithBinaryDataByCategoryID`方法`CategoriesTableAdapter`，类型化数据集设计器中的这些类应如图 11 所示的屏幕截图所示。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-244">After adding the two `DataColumn` s to the `CategoriesDataTable` and the `GetCategoryWithBinaryDataByCategoryID` method to the `CategoriesTableAdapter`, these classes in the Typed DataSet Designer should look like the screenshot in Figure 11.</span></span>

![数据集设计器包括新的列和方法](uploading-files-vb/_static/image11.gif)

<span data-ttu-id="3d3bb-246">**图 11**:数据集设计器包括新的列和方法</span><span class="sxs-lookup"><span data-stu-id="3d3bb-246">**Figure 11**: The DataSet Designer Includes the New Columns and Method</span></span>

## <a name="updating-the-business-logic-layer-bll"></a><span data-ttu-id="3d3bb-247">正在更新业务逻辑层 (BLL)</span><span class="sxs-lookup"><span data-stu-id="3d3bb-247">Updating the Business Logic Layer (BLL)</span></span>

<span data-ttu-id="3d3bb-248">与更新 DAL，剩下的就是来加强业务逻辑层 (BLL) 以囊括新方法`CategoriesTableAdapter`方法。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-248">With the DAL updated, all that remains is to augment the Business Logic Layer (BLL) to include a method for the new `CategoriesTableAdapter` method.</span></span> <span data-ttu-id="3d3bb-249">添加以下方法`CategoriesBLL`类：</span><span class="sxs-lookup"><span data-stu-id="3d3bb-249">Add the following method to the `CategoriesBLL` class:</span></span>

[!code-vb[Main](uploading-files-vb/samples/sample4.vb)]

## <a name="step-5-uploading-a-file-from-the-client-to-the-web-server"></a><span data-ttu-id="3d3bb-250">步骤 5：上传到 Web 服务器从客户端文件</span><span class="sxs-lookup"><span data-stu-id="3d3bb-250">Step 5: Uploading a File From the Client to the Web Server</span></span>

<span data-ttu-id="3d3bb-251">当收集的二进制数据，通常由最终用户提供此数据。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-251">When collecting binary data, oftentimes this data is supplied by an end user.</span></span> <span data-ttu-id="3d3bb-252">若要捕获此信息，用户需要能够上传到 web 服务器从其计算机的文件。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-252">To capture this information, the user needs to be able to upload a file from their computer to the web server.</span></span> <span data-ttu-id="3d3bb-253">上传的数据则需要与数据模型中，这可能意味着将文件保存到 web 服务器文件系统和将路径添加到数据库中的文件或二进制内容写入到数据库直接集成。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-253">The uploaded data then needs to be integrated with the data model, which may mean saving the file to the web server s file system and adding a path to the file in the database, or writing the binary contents directly into the database.</span></span> <span data-ttu-id="3d3bb-254">在此步骤中我们将探讨如何允许用户从他们的计算机到服务器的文件上传。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-254">In this step we'll look at how to allow a user to upload files from their computer to the server.</span></span> <span data-ttu-id="3d3bb-255">在下一教程中我们要将注意力转移到将上传的文件与数据模型相集成。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-255">In the next tutorial we'll turn our attention to integrating the uploaded file with data model.</span></span>

<span data-ttu-id="3d3bb-256">ASP.NET 2.0 新 s [FileUpload Web 控件](https://msdn.microsoft.com/library/ms227677(VS.80).aspx)提供了用户可以将文件从其计算机发送到 web 服务器的机制。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-256">ASP.NET 2.0 s new [FileUpload Web control](https://msdn.microsoft.com/library/ms227677(VS.80).aspx) provides a mechanism for users to send a file from their computer to the web server.</span></span> <span data-ttu-id="3d3bb-257">FileUpload 控件呈现为`<input>`元素的`type`属性设置为文件，浏览器将显示为文本框使用浏览按钮。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-257">The FileUpload control renders as an `<input>` element whose `type` attribute is set to file, which browsers display as a textbox with a Browse button.</span></span> <span data-ttu-id="3d3bb-258">单击浏览按钮将显示一个对话框，用户可以从中选择一个文件。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-258">Clicking the Browse button brings up a dialog box from which the user can select a file.</span></span> <span data-ttu-id="3d3bb-259">当窗体回发时，所选的文件的内容与回发一起发送。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-259">When the form is posted back, the selected file s contents are sent along with the postback.</span></span> <span data-ttu-id="3d3bb-260">在服务器端上传的文件有关的信息是可通过 FileUpload 控件的属性访问。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-260">On the server-side, information about the uploaded file is accessible through the FileUpload control s properties.</span></span>

<span data-ttu-id="3d3bb-261">若要演示上传文件，打开`FileUpload.aspx`页中`BinaryData`文件夹中，将一个 FileUpload 控件从工具箱拖到设计器中，并设置控制 s`ID`属性设置为`UploadTest`。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-261">To demonstrate uploading files, open the `FileUpload.aspx` page in the `BinaryData` folder, drag a FileUpload control from the Toolbox onto the Designer, and set the control s `ID` property to `UploadTest`.</span></span> <span data-ttu-id="3d3bb-262">接下来，添加一个按钮 Web 控件，设置其`ID`并`Text`属性设置为`UploadButton`并分别将所选文件上传。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-262">Next, add a Button Web control setting its `ID` and `Text` properties to `UploadButton` and Upload Selected File, respectively.</span></span> <span data-ttu-id="3d3bb-263">最后，将在按钮下方的标签 Web 控件放清除其`Text`属性并设置其`ID`属性设置为`UploadDetails`。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-263">Finally, place a Label Web control beneath the Button, clear out its `Text` property and set its `ID` property to `UploadDetails`.</span></span>

<span data-ttu-id="3d3bb-264">[![向 ASP.NET 页面添加 FileUpload 控件](uploading-files-vb/_static/image12.gif)](uploading-files-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="3d3bb-264">[![Add a FileUpload Control to the ASP.NET Page](uploading-files-vb/_static/image12.gif)](uploading-files-vb/_static/image17.png)</span></span>

<span data-ttu-id="3d3bb-265">**图 12**:将 FileUpload 控件添加到 ASP.NET 页 ([单击此项可查看原尺寸图像](uploading-files-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="3d3bb-265">**Figure 12**: Add a FileUpload Control to the ASP.NET Page ([Click to view full-size image](uploading-files-vb/_static/image18.png))</span></span>

<span data-ttu-id="3d3bb-266">图 13 显示了此页时的浏览器查看。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-266">Figure 13 shows this page when viewed through a browser.</span></span> <span data-ttu-id="3d3bb-267">请注意，单击浏览按钮将显示文件选择对话框中，这样就允许用户选择其计算机中的文件。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-267">Note that clicking the Browse button brings up a file selection dialog box, allowing the user to pick a file from their computer.</span></span> <span data-ttu-id="3d3bb-268">一旦选择了一个文件，单击上传所选文件按钮会将所选的文件 s 二进制内容发送到 web 服务器的回发。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-268">Once a file has been selected, clicking the Upload Selected File button causes a postback that sends the selected file s binary content to the web server.</span></span>

<span data-ttu-id="3d3bb-269">[![用户可以选择要从其计算机上传到服务器的文件](uploading-files-vb/_static/image13.gif)](uploading-files-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="3d3bb-269">[![The User Can Select a File to Upload from their Computer to the Server](uploading-files-vb/_static/image13.gif)](uploading-files-vb/_static/image19.png)</span></span>

<span data-ttu-id="3d3bb-270">**图 13**:用户可以从服务器到其计算机上传到选择一个文件 ([单击此项可查看原尺寸图像](uploading-files-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="3d3bb-270">**Figure 13**: The User Can Select a File to Upload from their Computer to the Server ([Click to view full-size image](uploading-files-vb/_static/image20.png))</span></span>

<span data-ttu-id="3d3bb-271">在回发时上, 传的文件可以保存到文件系统或其二进制数据可以直接通过 Stream 得到使用。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-271">On postback, the uploaded file can be saved to the file system or its binary data can be worked with directly through a Stream.</span></span> <span data-ttu-id="3d3bb-272">对于此示例，让我们来创建`~/Brochures`文件夹和保存那里上传的文件。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-272">For this example, let s create a `~/Brochures` folder and save the uploaded file there.</span></span> <span data-ttu-id="3d3bb-273">首先，通过添加`Brochures`到站点作为子文件夹的根目录的文件夹。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-273">Start by adding the `Brochures` folder to the site as a subfolder of the root directory.</span></span> <span data-ttu-id="3d3bb-274">接下来，创建的事件处理程序`UploadButton`s`Click`事件，并添加以下代码：</span><span class="sxs-lookup"><span data-stu-id="3d3bb-274">Next, create an event handler for the `UploadButton` s `Click` event and add the following code:</span></span>

[!code-vb[Main](uploading-files-vb/samples/sample5.vb)]

<span data-ttu-id="3d3bb-275">FileUpload 控件提供了各种用于处理上传的数据的属性。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-275">The FileUpload control provides a variety of properties for working with the uploaded data.</span></span> <span data-ttu-id="3d3bb-276">例如， [ `HasFile`属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.hasfile.aspx)指示文件是否已上传用户，而[`FileBytes`属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.filebytes.aspx)的字节数组形式提供对上传的二进制数据的访问。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-276">For instance, the [`HasFile` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.hasfile.aspx) indicates whether a file was uploaded by the user, while the [`FileBytes` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.filebytes.aspx) provides access to the uploaded binary data as an array of bytes.</span></span> <span data-ttu-id="3d3bb-277">`Click`事件处理程序首先确保已上传一个文件。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-277">The `Click` event handler starts by ensuring that a file has been uploaded.</span></span> <span data-ttu-id="3d3bb-278">如果已上传一个文件，则标签将显示上传的文件，以字节为单位，其大小和内容类型的名称。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-278">If a file has been uploaded, the Label shows the name of the uploaded file, its size in bytes, and its content-type.</span></span>

> [!NOTE]
> <span data-ttu-id="3d3bb-279">若要确保用户将可以检查文件上传`HasFile`属性，并显示一条警告，如果它 s `False`，或者也可以使用[RequiredFieldValidator 控件](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/validation/default.aspx)改为。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-279">To ensure that the user uploads a file you can check the `HasFile` property and display a warning if it s `False`, or you may use the [RequiredFieldValidator control](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/validation/default.aspx) instead.</span></span>

<span data-ttu-id="3d3bb-280">FileUpload s`SaveAs(filePath)`上传的文件保存到指定*filePath*。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-280">The FileUpload s `SaveAs(filePath)` saves the uploaded file to the specified *filePath*.</span></span> <span data-ttu-id="3d3bb-281">*filePath*必须是*物理路径*(`C:\Websites\Brochures\SomeFile.pdf`) 而非*虚拟* *路径*(`/Brochures/SomeFile.pdf`)。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-281">*filePath* must be a *physical path* (`C:\Websites\Brochures\SomeFile.pdf`) rather than a *virtual* *path* (`/Brochures/SomeFile.pdf`).</span></span> <span data-ttu-id="3d3bb-282">[ `Server.MapPath(virtPath)`方法](https://msdn.microsoft.com/library/system.web.httpserverutility.mappath.aspx)将虚拟路径，并返回其对应的物理路径。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-282">The [`Server.MapPath(virtPath)` method](https://msdn.microsoft.com/library/system.web.httpserverutility.mappath.aspx) takes a virtual path and returns its corresponding physical path.</span></span> <span data-ttu-id="3d3bb-283">在这里的虚拟路径是`~/Brochures/fileName`，其中*文件名*是上传的文件的名称。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-283">Here, the virtual path is `~/Brochures/fileName`, where *fileName* is the name of the uploaded file.</span></span> <span data-ttu-id="3d3bb-284">请参阅[使用 Server.MapPath](http://www.4guysfromrolla.com/webtech/121799-1.shtml)有关详细信息，在虚拟和物理路径和使用`Server.MapPath`。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-284">See [Using Server.MapPath](http://www.4guysfromrolla.com/webtech/121799-1.shtml) for more information on virtual and physical paths and using `Server.MapPath`.</span></span>

<span data-ttu-id="3d3bb-285">完成后`Click`事件处理程序，请花费片刻时间来测试浏览器中的页。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-285">After completing the `Click` event handler, take a moment to test out the page in a browser.</span></span> <span data-ttu-id="3d3bb-286">单击浏览按钮并从您的硬盘中选择文件，然后单击上传所选文件按钮。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-286">Click the Browse button and select a file from your hard drive and then click the Upload Selected File button.</span></span> <span data-ttu-id="3d3bb-287">在回发会将所选文件的内容发送到 web 服务器，然后将显示有关文件的信息，然后将它保存到`~/Brochures`文件夹。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-287">The postback will send the contents of the selected file to the web server, which will then display information about the file before saving it to the `~/Brochures` folder.</span></span> <span data-ttu-id="3d3bb-288">上传文件后, 返回到 Visual Studio 并单击解决方案资源管理器中的刷新按钮。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-288">After uploading the file, return to Visual Studio and click the Refresh button in the Solution Explorer.</span></span> <span data-ttu-id="3d3bb-289">你应看到您只需上传 ~/Brochures 文件夹中的文件 ！</span><span class="sxs-lookup"><span data-stu-id="3d3bb-289">You should see the file you just uploaded in the ~/Brochures folder!</span></span>

<span data-ttu-id="3d3bb-290">[![文件 EvolutionValley.jpg 已上载到 Web 服务器](uploading-files-vb/_static/image14.gif)](uploading-files-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="3d3bb-290">[![The File EvolutionValley.jpg Has Been Uploaded to the Web Server](uploading-files-vb/_static/image14.gif)](uploading-files-vb/_static/image21.png)</span></span>

<span data-ttu-id="3d3bb-291">**图 14**:该文件`EvolutionValley.jpg`已上传到 Web 服务器 ([单击以查看实际尺寸的图像](uploading-files-vb/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="3d3bb-291">**Figure 14**: The File `EvolutionValley.jpg` Has Been Uploaded to the Web Server ([Click to view full-size image](uploading-files-vb/_static/image22.png))</span></span>

![EvolutionValley.jpg 已保存到 ~/Brochures 文件夹](uploading-files-vb/_static/image15.gif)

<span data-ttu-id="3d3bb-293">**图 15**:`EvolutionValley.jpg` 已保存到`~/Brochures`文件夹</span><span class="sxs-lookup"><span data-stu-id="3d3bb-293">**Figure 15**: `EvolutionValley.jpg` Was Saved to the `~/Brochures` Folder</span></span>

## <a name="subtleties-with-saving-uploaded-files-to-the-file-system"></a><span data-ttu-id="3d3bb-294">与将上传的文件保存到文件系统的微妙之处</span><span class="sxs-lookup"><span data-stu-id="3d3bb-294">Subtleties with Saving Uploaded Files to the File System</span></span>

<span data-ttu-id="3d3bb-295">有几个保存文件上传到 web 服务器文件系统时必须解决的微妙之处。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-295">There are several subtleties that must be addressed when saving uploading files to the web server s file system.</span></span> <span data-ttu-id="3d3bb-296">安全的第一个，此处问题。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-296">First, there s the issue of security.</span></span> <span data-ttu-id="3d3bb-297">若要将文件保存到文件系统，在其下执行 ASP.NET 页的安全上下文必须具有写入权限。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-297">To save a file to the file system, the security context under which the ASP.NET page is executing must have Write permissions.</span></span> <span data-ttu-id="3d3bb-298">将当前的用户帐户的上下文中运行 ASP.NET 开发 Web 服务器。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-298">The ASP.NET Development Web Server runs under the context of your current user account.</span></span> <span data-ttu-id="3d3bb-299">如果使用的 Microsoft 的 Internet 信息服务 (IIS) 作为 web 服务器，安全上下文取决于 IIS 及其配置的版本。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-299">If you are using Microsoft s Internet Information Services (IIS) as the web server, the security context depends on the version of IIS and its configuration.</span></span>

<span data-ttu-id="3d3bb-300">将文件保存到文件系统的另一个挑战是围绕的文件命名。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-300">Another challenge of saving files to the file system revolves around naming the files.</span></span> <span data-ttu-id="3d3bb-301">目前，我们的页面将保存到已上载的文件的所有`~/Brochures`使用相同的名称作为客户端的计算机上的文件的目录。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-301">Currently, our page saves all of the uploaded files to the `~/Brochures` directory using the same name as the file on the client s computer.</span></span> <span data-ttu-id="3d3bb-302">如果用户 A 将上传具有名称手册`Brochure.pdf`，该文件将保存为`~/Brochure/Brochure.pdf`。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-302">If User A uploads a brochure with the name `Brochure.pdf`, the file will be saved as `~/Brochure/Brochure.pdf`.</span></span> <span data-ttu-id="3d3bb-303">但如果一段时间更高版本用户 B 不同手册将文件上传的恰好具有相同的文件名 (`Brochure.pdf`)？</span><span class="sxs-lookup"><span data-stu-id="3d3bb-303">But what if sometime later User B uploads a different brochure file that happens to have the same filename (`Brochure.pdf`)?</span></span> <span data-ttu-id="3d3bb-304">使用代码我们现在，让的用户的文件将被覆盖用户 B s 上传。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-304">With the code we have now, User A s file will be overwritten with User B s upload.</span></span>

<span data-ttu-id="3d3bb-305">有多种方法来解决文件名称冲突。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-305">There are a number of techniques for resolving file name conflicts.</span></span> <span data-ttu-id="3d3bb-306">一种方法是禁止上传文件，如果已存在一个具有相同的名称。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-306">One option is to prohibit uploading a file if there already exists one with the same name.</span></span> <span data-ttu-id="3d3bb-307">使用此方法，当尝试将名为的文件上传用户 B `Brochure.pdf`，系统将不保存其文件，而是显示消息，告知用户 B，若要重命名该文件，然后重试。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-307">With this approach, when User B attempts to upload a file named `Brochure.pdf`, the system would not save their file and instead display a message informing User B to rename the file and try again.</span></span> <span data-ttu-id="3d3bb-308">另一种方法是使用唯一的文件名，这可能是保存该文件[全局唯一标识符 (GUID)](http://en.wikipedia.org/wiki/Globally_Unique_Identifier)或数据库记录 s 主键列中相应的值 (假定与关联上传中特定行的数据模型）。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-308">Another approach is to save the file using a unique file name, which could be a [globally unique identifier (GUID)](http://en.wikipedia.org/wiki/Globally_Unique_Identifier) or the value from the corresponding database record s primary key column(s) (assuming that the upload is associated with a particular row in the data model).</span></span> <span data-ttu-id="3d3bb-309">在下一教程中，我们将探讨更多详细信息中的这些选项。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-309">In the next tutorial we'll explore these options in more detail.</span></span>

## <a name="challenges-involved-with-very-large-amounts-of-binary-data"></a><span data-ttu-id="3d3bb-310">所涉及的二进制数据量非常大的挑战</span><span class="sxs-lookup"><span data-stu-id="3d3bb-310">Challenges Involved with Very Large Amounts of Binary Data</span></span>

<span data-ttu-id="3d3bb-311">这些教程假定适度大小中捕获的二进制数据。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-311">These tutorials assume that the binary data captured is modest in size.</span></span> <span data-ttu-id="3d3bb-312">使用的是几兆字节的二进制数据文件的数量非常大或更大引入了新的挑战已超出这些教程的范围。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-312">Working with very large amounts of binary data files that are several megabytes or larger introduces new challenges that are beyond the scope of these tutorials.</span></span> <span data-ttu-id="3d3bb-313">例如，默认情况下 ASP.NET 将拒绝上的传超过 4 mb，尽管这可以通过配置[`<httpRuntime>`元素](https://msdn.microsoft.com/library/e1f13641.aspx)中`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-313">For example, by default ASP.NET will reject uploads of more than 4 MB, although this can be configured through the [`<httpRuntime>` element](https://msdn.microsoft.com/library/e1f13641.aspx) in `Web.config`.</span></span> <span data-ttu-id="3d3bb-314">IIS 太施加其自身的文件上传大小限制。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-314">IIS imposes its own file upload size limitations, too.</span></span> <span data-ttu-id="3d3bb-315">请参阅[IIS 上传文件大小](http://vandamme.typepad.com/development/2005/09/iis_upload_file.html)有关详细信息。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-315">See [IIS Upload File Size](http://vandamme.typepad.com/development/2005/09/iis_upload_file.html) for more information.</span></span> <span data-ttu-id="3d3bb-316">此外，将大型文件上传所花的时间可能会超过默认值 110 秒，ASP.NET 将等待的请求。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-316">Furthermore, the time taken to upload large files might exceed the default 110 seconds ASP.NET will wait for a request.</span></span> <span data-ttu-id="3d3bb-317">也有处理大型文件时出现的内存和性能问题。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-317">There are also memory and performance issues that arise when working with large files.</span></span>

<span data-ttu-id="3d3bb-318">FileUpload 控件不适用于大型文件上传。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-318">The FileUpload control is impractical for large file uploads.</span></span> <span data-ttu-id="3d3bb-319">文件的内容正在发布到服务器，最终用户必须耐心地等待而无需任何确认，其上传时的进展情况。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-319">As the file s contents are being posted to the server, the end user must patiently wait without any confirmation that their upload is progressing.</span></span> <span data-ttu-id="3d3bb-320">处理较小的文件来上传在几秒钟内，但可以处理较大可能需要分钟才能上传的文件会出现问题时，这不是这么多问题。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-320">This is not so much an issue when dealing with smaller files that can be uploaded in a few seconds, but can be an issue when dealing with larger files that may take minutes to upload.</span></span> <span data-ttu-id="3d3bb-321">有各种第三方文件上传控件更好地适合用于处理较大的上载和很多这些供应商提供的进度指示器和 ActiveX 上载管理器，从而提供更完善的用户体验。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-321">There are a variety of third-party file upload controls that are better suited for handling large uploads and many of these vendors provide progress indicators and ActiveX upload managers that present a much more polished user experience.</span></span>

<span data-ttu-id="3d3bb-322">如果你的应用程序需要处理大型文件，您需要仔细研究面临的挑战和查找针对特定需求的合适解决方案。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-322">If your application needs to handle large files, you'll need to carefully investigate the challenges and find suitable solutions for your particular needs.</span></span>

## <a name="summary"></a><span data-ttu-id="3d3bb-323">总结</span><span class="sxs-lookup"><span data-stu-id="3d3bb-323">Summary</span></span>

<span data-ttu-id="3d3bb-324">生成的应用程序需要捕获二进制数据引入了一系列挑战。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-324">Building an application that needs to capture binary data introduces a number of challenges.</span></span> <span data-ttu-id="3d3bb-325">在本教程中我们探讨了前两个： 决定存储二进制数据的位置，并允许用户上传通过网页的二进制内容。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-325">In this tutorial we explored the first two: deciding where to store the binary data and allowing a user to upload binary content through a web page.</span></span> <span data-ttu-id="3d3bb-326">通过三个教程，我们将了解如何将上传的数据与数据库中记录相关联，以及如何显示以及它的文本数据字段的二进制数据。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-326">Over the next three tutorials, we'll see how to associate the uploaded data with a record in the database as well as how to display the binary data alongside its text data fields.</span></span>

<span data-ttu-id="3d3bb-327">快乐编程 ！</span><span class="sxs-lookup"><span data-stu-id="3d3bb-327">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="3d3bb-328">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="3d3bb-328">Further Reading</span></span>

<span data-ttu-id="3d3bb-329">在本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="3d3bb-329">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="3d3bb-330">使用大值数据类型</span><span class="sxs-lookup"><span data-stu-id="3d3bb-330">Using Large-Value Data Types</span></span>](https://msdn.microsoft.com/library/ms178158.aspx)
- [<span data-ttu-id="3d3bb-331">FileUpload 控件快速入门</span><span class="sxs-lookup"><span data-stu-id="3d3bb-331">FileUpload Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/fileupload.aspx)
- [<span data-ttu-id="3d3bb-332">ASP.NET 2.0 FileUpload 服务器控件</span><span class="sxs-lookup"><span data-stu-id="3d3bb-332">The ASP.NET 2.0 FileUpload Server Control</span></span>](http://www.wrox.com/WileyCDA/Section/id-292158.html)
- [<span data-ttu-id="3d3bb-333">文件上传在深端</span><span class="sxs-lookup"><span data-stu-id="3d3bb-333">The Dark Side of File Uploads</span></span>](http://www.aspnetresources.com/articles/dark_side_of_file_uploads.aspx)

## <a name="about-the-author"></a><span data-ttu-id="3d3bb-334">关于作者</span><span class="sxs-lookup"><span data-stu-id="3d3bb-334">About the Author</span></span>

<span data-ttu-id="3d3bb-335">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)的七个部 asp/ASP.NET 书籍并创办了作者[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年以来一直致力于 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-335">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="3d3bb-336">Scott 是独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-336">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="3d3bb-337">他最新著作是[ *Sams Teach 自己 ASP.NET 2.0 24 小时内*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-337">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="3d3bb-338">他可以到达[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="3d3bb-338">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="3d3bb-339">或通过他的博客，其中，请参阅[ http://ScottOnWriting.NET ](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-339">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="3d3bb-340">特别感谢</span><span class="sxs-lookup"><span data-stu-id="3d3bb-340">Special Thanks To</span></span>

<span data-ttu-id="3d3bb-341">很多有用的审阅者已评审本系列教程。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-341">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="3d3bb-342">本教程中的潜在顾客审阅者是 Teresa Murphy 和伯纳黛特 Leigh。</span><span class="sxs-lookup"><span data-stu-id="3d3bb-342">Lead reviewers for this tutorial were Teresa Murphy and Bernadette Leigh.</span></span> <span data-ttu-id="3d3bb-343">是否有兴趣查看我即将推出的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="3d3bb-343">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="3d3bb-344">如果是这样，给我在行[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="3d3bb-344">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="3d3bb-345">[上一页](updating-and-deleting-existing-binary-data-cs.md)
> [下一页](displaying-binary-data-in-the-data-web-controls-vb.md)</span><span class="sxs-lookup"><span data-stu-id="3d3bb-345">[Previous](updating-and-deleting-existing-binary-data-cs.md)
[Next](displaying-binary-data-in-the-data-web-controls-vb.md)</span></span>
