---
uid: web-forms/overview/data-access/working-with-binary-files/displaying-binary-data-in-the-data-web-controls-cs
title: 控制显示数据 Web 中的二进制数据 (C#) |Microsoft Docs
author: rick-anderson
description: 在本教程中我们看一下在 Web 页上，包括显示的图像文件和下载链接 f 的预配上显示二进制数据的选项...
ms.author: riande
ms.date: 03/27/2007
ms.assetid: 5cbeb9f8-5f92-4ba8-87ae-0b4d460ae6d4
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/displaying-binary-data-in-the-data-web-controls-cs
msc.type: authoredcontent
ms.openlocfilehash: 026fce7544f40ff333a5c0a500bc53c7fd434080
ms.sourcegitcommit: 289e051cc8a90e8f7127e239fda73047bde4de12
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/25/2019
ms.locfileid: "58422085"
---
<a name="displaying-binary-data-in-the-data-web-controls-c"></a><span data-ttu-id="594ec-103">显示数据 Web 控件中的二进制数据 (C#)</span><span class="sxs-lookup"><span data-stu-id="594ec-103">Displaying Binary Data in the Data Web Controls (C#)</span></span>
====================
<span data-ttu-id="594ec-104">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="594ec-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="594ec-105">[下载示例应用程序](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_55_CS.exe)或[下载 PDF](displaying-binary-data-in-the-data-web-controls-cs/_static/datatutorial55cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="594ec-105">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_55_CS.exe) or [Download PDF](displaying-binary-data-in-the-data-web-controls-cs/_static/datatutorial55cs1.pdf)</span></span>

> <span data-ttu-id="594ec-106">在本教程中我们查看一下在 Web 页上，包括显示的图像文件和 PDF 文件预配的下载链接上显示二进制数据的选项。</span><span class="sxs-lookup"><span data-stu-id="594ec-106">In this tutorial we look at the options to present binary data on a Web page, including the display of an image file and the provision of a 'Download' link for a PDF file.</span></span>


## <a name="introduction"></a><span data-ttu-id="594ec-107">介绍</span><span class="sxs-lookup"><span data-stu-id="594ec-107">Introduction</span></span>

<span data-ttu-id="594ec-108">在前面的教程，我们探讨了用于将二进制数据与应用程序 s 基础数据模型相关联的两个技术并使用 FileUpload 控件从浏览器到 web 服务器文件系统的文件上传。</span><span class="sxs-lookup"><span data-stu-id="594ec-108">In the preceding tutorial we explored the two techniques for associating binary data with an application s underlying data model and used the FileUpload control to upload files from a browser to the web server s file system.</span></span> <span data-ttu-id="594ec-109">我们 ve 尚未若要了解如何将上传的二进制数据与数据模型相关联。</span><span class="sxs-lookup"><span data-stu-id="594ec-109">We ve yet to see how to associate the uploaded binary data with the data model.</span></span> <span data-ttu-id="594ec-110">也就是说上, 传一个文件并将其保存到文件系统后，该文件的路径必须存储在相应的数据库记录。</span><span class="sxs-lookup"><span data-stu-id="594ec-110">That is, after a file has been uploaded and saved to the file system, a path to the file must be stored in the appropriate database record.</span></span> <span data-ttu-id="594ec-111">如果直接在数据库中存储数据上, 传的二进制数据需要不会保存到文件系统，但必须插入到数据库。</span><span class="sxs-lookup"><span data-stu-id="594ec-111">If the data is being stored directly in the database, then the uploaded binary data need not be saved to the file system, but must be injected into the database.</span></span>

<span data-ttu-id="594ec-112">我们看一下将数据与数据模型相关联之前，不过，让 s 首先看一下如何向最终用户提供的二进制数据。</span><span class="sxs-lookup"><span data-stu-id="594ec-112">Before we look at associating the data with the data model, though, let s first look at how to provide the binary data to the end user.</span></span> <span data-ttu-id="594ec-113">提供文本数据非常简单，但二进制数据的存在方式？</span><span class="sxs-lookup"><span data-stu-id="594ec-113">Presenting text data is simple enough, but how should binary data be presented?</span></span> <span data-ttu-id="594ec-114">它取决于，当然，二进制数据的类型。</span><span class="sxs-lookup"><span data-stu-id="594ec-114">It depends, of course, on the type of binary data.</span></span> <span data-ttu-id="594ec-115">对于映像，我们可能想要显示的图像;对于 pdf 文件，Microsoft Word 文档、 ZIP 文件和其他类型的二进制数据，提供下载链接是可能更合适。</span><span class="sxs-lookup"><span data-stu-id="594ec-115">For images, we likely want to display the image; for PDFs, Microsoft Word documents, ZIP files, and other types of binary data, providing a Download link is probably more appropriate.</span></span>

<span data-ttu-id="594ec-116">在本教程中我们将探讨如何显示以及使用数据及其关联的文本数据的二进制数据 Web 控件如 GridView 和 DetailsView。</span><span class="sxs-lookup"><span data-stu-id="594ec-116">In this tutorial we will look at how to present the binary data alongside its associated text data using data Web controls like the GridView and DetailsView.</span></span> <span data-ttu-id="594ec-117">在下一教程中我们要将注意力转移到将上传的文件与数据库相关联。</span><span class="sxs-lookup"><span data-stu-id="594ec-117">In the next tutorial we'll turn our attention to associating an uploaded file with the database.</span></span>

## <a name="step-1-providingbrochurepathvalues"></a><span data-ttu-id="594ec-118">步骤 1：提供`BrochurePath`值</span><span class="sxs-lookup"><span data-stu-id="594ec-118">Step 1: Providing`BrochurePath`Values</span></span>

<span data-ttu-id="594ec-119">`Picture`中的列`Categories`表已包含的不同的类别图像的二进制数据。</span><span class="sxs-lookup"><span data-stu-id="594ec-119">The `Picture` column in the `Categories` table already contains binary data for the various category images.</span></span> <span data-ttu-id="594ec-120">具体而言，`Picture`为每个记录的列包含有纹理、 低质量、 16 色位图图像的二进制内容。</span><span class="sxs-lookup"><span data-stu-id="594ec-120">Specifically, the `Picture` column for each record holds the binary contents of a grainy, low-quality, 16-color bitmap image.</span></span> <span data-ttu-id="594ec-121">每个类别的图像为 172 个像素宽和 120 像素、 高，并使用大致 11 KB。</span><span class="sxs-lookup"><span data-stu-id="594ec-121">Each category image is 172 pixels wide and 120 pixels tall and consumes roughly 11 KB.</span></span> <span data-ttu-id="594ec-122">新增更多、 中的二进制内容`Picture`列中包含 78 字节[OLE](http://en.wikipedia.org/wiki/Object_Linking_and_Embedding)必须显示该映像之前去除的标头。</span><span class="sxs-lookup"><span data-stu-id="594ec-122">What s more, the binary content in the `Picture` column includes a 78-byte [OLE](http://en.wikipedia.org/wiki/Object_Linking_and_Embedding) header that must be stripped before displaying the image.</span></span> <span data-ttu-id="594ec-123">存在此标头信息是因为 Northwind 数据库起源于 Microsoft Access。</span><span class="sxs-lookup"><span data-stu-id="594ec-123">This header information is present because the Northwind database has its roots in Microsoft Access.</span></span> <span data-ttu-id="594ec-124">在 Access 中，使用此标头采取的 OLE 对象的数据类型存储二进制数据。</span><span class="sxs-lookup"><span data-stu-id="594ec-124">In Access, binary data is stored using the OLE Object data type, which tacks on this header.</span></span> <span data-ttu-id="594ec-125">现在，我们将了解如何显示图片以去除这些低质量的图像中的标头。</span><span class="sxs-lookup"><span data-stu-id="594ec-125">For now, we'll see how to strip the headers from these low-quality images in order to display the picture.</span></span> <span data-ttu-id="594ec-126">在以后的教程，我们将构建一个接口，使更新类别的`Picture`列，并将为等效的 JPG 图像，而不必要的 OLE 标头与使用 OLE 标头这些位图图像。</span><span class="sxs-lookup"><span data-stu-id="594ec-126">In a future tutorial we'll build an interface for updating a category s `Picture` column and replace these bitmap images that use OLE headers with equivalent JPG images without the unnecessary OLE headers.</span></span>

<span data-ttu-id="594ec-127">在前面的教程中，我们已了解如何使用 FileUpload 控件。</span><span class="sxs-lookup"><span data-stu-id="594ec-127">In the preceding tutorial we saw how to use the FileUpload control.</span></span> <span data-ttu-id="594ec-128">因此，可以继续操作并将手册文件添加到 web 服务器文件系统。</span><span class="sxs-lookup"><span data-stu-id="594ec-128">Therefore, you can go ahead and add brochure files to the web server s file system.</span></span> <span data-ttu-id="594ec-129">这样做，但是，不会更新`BrochurePath`中的列`Categories`表。</span><span class="sxs-lookup"><span data-stu-id="594ec-129">Doing so, however, does not update the `BrochurePath` column in the `Categories` table.</span></span> <span data-ttu-id="594ec-130">在下一教程中，我们将了解如何实现此目的，但现在，我们需要手动为此列提供值。</span><span class="sxs-lookup"><span data-stu-id="594ec-130">In the next tutorial we'll see how to accomplish this, but for now we need to manually provide values for this column.</span></span>

<span data-ttu-id="594ec-131">本教程的下载内容中，您会发现中的七个 PDF 小册子文件`~/Brochures`文件夹，一个用于除 Seafood 类别中的每一个。</span><span class="sxs-lookup"><span data-stu-id="594ec-131">In this tutorial s download you'll find seven PDF brochure files in the `~/Brochures` folder, one for each of the categories except Seafood.</span></span> <span data-ttu-id="594ec-132">我有意省略了添加 Seafood 手册，为了说明如何处理方案具有关联并不是所有记录的二进制数据。</span><span class="sxs-lookup"><span data-stu-id="594ec-132">I purposefully omitted adding a Seafood brochure to illustrate how to handle scenarios where not all records have associated binary data.</span></span> <span data-ttu-id="594ec-133">若要更新`Categories`使用这些值表中，右键单击`Categories`节点从服务器资源管理器，然后选择显示表数据。</span><span class="sxs-lookup"><span data-stu-id="594ec-133">To update the `Categories` table with these values, right-click on the `Categories` node from Server Explorer and choose Show Table Data.</span></span> <span data-ttu-id="594ec-134">然后，输入具有小册子中，如图 1 所示的每个类别的手册文件虚拟路径。</span><span class="sxs-lookup"><span data-stu-id="594ec-134">Then, enter the virtual paths to the brochure files for each category that has a brochure, as Figure 1 shows.</span></span> <span data-ttu-id="594ec-135">由于没有任何手册 Seafood 类别，将保留其`BrochurePath`作为列的值`NULL`。</span><span class="sxs-lookup"><span data-stu-id="594ec-135">Since there is no brochure for the Seafood category, leave its `BrochurePath` column s value as `NULL`.</span></span>


<span data-ttu-id="594ec-136">[![手动输入类别表的 BrochurePath 列的值](displaying-binary-data-in-the-data-web-controls-cs/_static/image1.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="594ec-136">[![Manually Enter the Values for the Categories Table s BrochurePath Column](displaying-binary-data-in-the-data-web-controls-cs/_static/image1.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image1.png)</span></span>

<span data-ttu-id="594ec-137">**图 1**:手动输入的值`Categories`表 s`BrochurePath`列 ([单击以查看实际尺寸的图像](displaying-binary-data-in-the-data-web-controls-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="594ec-137">**Figure 1**: Manually Enter the Values for the `Categories` Table s `BrochurePath` Column ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image2.png))</span></span>


## <a name="step-2-providing-a-download-link-for-the-brochures-in-a-gridview"></a><span data-ttu-id="594ec-138">步骤 2：在 GridView 中小册子为提供的下载链接</span><span class="sxs-lookup"><span data-stu-id="594ec-138">Step 2: Providing a Download Link for the Brochures in a GridView</span></span>

<span data-ttu-id="594ec-139">与`BrochurePath`提供的值`Categories`表中，我们准备就绪后，若要创建一个 GridView，列出了用于下载类别的手册的链接以及每个类别。</span><span class="sxs-lookup"><span data-stu-id="594ec-139">With the `BrochurePath` values provided for the `Categories` table, we re ready to create a GridView that lists each category along with a link to download the category s brochure.</span></span> <span data-ttu-id="594ec-140">在步骤 4 中，我们将扩展此 GridView，其中还显示类别的图像。</span><span class="sxs-lookup"><span data-stu-id="594ec-140">In Step 4 we'll extend this GridView to also display the category s image.</span></span>

<span data-ttu-id="594ec-141">首先，将从工具箱拖到设计器的 GridView`DisplayOrDownloadData.aspx`页中`BinaryData`文件夹。</span><span class="sxs-lookup"><span data-stu-id="594ec-141">Start by dragging a GridView from the Toolbox onto the Designer of the `DisplayOrDownloadData.aspx` page in the `BinaryData` folder.</span></span> <span data-ttu-id="594ec-142">设置 GridView s`ID`到`Categories`通过 GridView s 智能标记，选择将其绑定到新的数据源。</span><span class="sxs-lookup"><span data-stu-id="594ec-142">Set the GridView s `ID` to `Categories` and through the GridView s smart tag, choose to bind it to a new data source.</span></span> <span data-ttu-id="594ec-143">具体而言，将其绑定到名为 ObjectDataSource`CategoriesDataSource`检索数据使用的`CategoriesBLL`对象的`GetCategories()`方法。</span><span class="sxs-lookup"><span data-stu-id="594ec-143">Specifically, bind it to an ObjectDataSource named `CategoriesDataSource` that retrieves data using the `CategoriesBLL` object s `GetCategories()` method.</span></span>


<span data-ttu-id="594ec-144">[![创建名为 CategoriesDataSource 新 ObjectDataSource](displaying-binary-data-in-the-data-web-controls-cs/_static/image2.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="594ec-144">[![Create a New ObjectDataSource Named CategoriesDataSource](displaying-binary-data-in-the-data-web-controls-cs/_static/image2.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image3.png)</span></span>

<span data-ttu-id="594ec-145">**图 2**:创建新对象数据源命名`CategoriesDataSource`([单击以查看实际尺寸的图像](displaying-binary-data-in-the-data-web-controls-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="594ec-145">**Figure 2**: Create a New ObjectDataSource Named `CategoriesDataSource` ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image4.png))</span></span>


<span data-ttu-id="594ec-146">[![配置对象数据源以使用 CategoriesBLL 类](displaying-binary-data-in-the-data-web-controls-cs/_static/image3.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="594ec-146">[![Configure the ObjectDataSource to Use the CategoriesBLL Class](displaying-binary-data-in-the-data-web-controls-cs/_static/image3.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image5.png)</span></span>

<span data-ttu-id="594ec-147">**图 3**:配置为使用 ObjectDataSource`CategoriesBLL`类 ([单击以查看实际尺寸的图像](displaying-binary-data-in-the-data-web-controls-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="594ec-147">**Figure 3**: Configure the ObjectDataSource to Use the `CategoriesBLL` Class ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image6.png))</span></span>


<span data-ttu-id="594ec-148">[![检索使用 GetCategories() 方法的类别列表](displaying-binary-data-in-the-data-web-controls-cs/_static/image4.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="594ec-148">[![Retrieve the List of Categories Using the GetCategories() Method](displaying-binary-data-in-the-data-web-controls-cs/_static/image4.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image7.png)</span></span>

<span data-ttu-id="594ec-149">**图 4**:检索列表的类别 Using`GetCategories()`方法 ([单击以查看实际尺寸的图像](displaying-binary-data-in-the-data-web-controls-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="594ec-149">**Figure 4**: Retrieve the List of Categories Using the `GetCategories()` Method ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image8.png))</span></span>


<span data-ttu-id="594ec-150">完成配置数据源向导后，Visual Studio 将自动添加到 BoundField `Categories` GridView `CategoryID`， `CategoryName`， `Description`， `NumberOfProducts`，并且`BrochurePath` `DataColumn` s。</span><span class="sxs-lookup"><span data-stu-id="594ec-150">After completing the Configure Data Source wizard, Visual Studio will automatically add a BoundField to the `Categories` GridView for the `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath` `DataColumn` s.</span></span> <span data-ttu-id="594ec-151">继续操作并删除`NumberOfProducts`以来 BoundField`GetCategories()`的方法查询不会检索此信息。</span><span class="sxs-lookup"><span data-stu-id="594ec-151">Go ahead and remove the `NumberOfProducts` BoundField since the `GetCategories()` method s query does not retrieve this information.</span></span> <span data-ttu-id="594ec-152">此外删除`CategoryID`BoundField 和重命名`CategoryName`并`BrochurePath`BoundFields`HeaderText`为类别和手册，属性分别。</span><span class="sxs-lookup"><span data-stu-id="594ec-152">Also remove the `CategoryID` BoundField and rename the `CategoryName` and `BrochurePath` BoundFields `HeaderText` properties to Category and Brochure, respectively.</span></span> <span data-ttu-id="594ec-153">进行这些更改后，您的 GridView 和 ObjectDataSource s 的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="594ec-153">After making these changes, your GridView and ObjectDataSource s declarative markup should look like the following:</span></span>


[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample1.aspx)]

<span data-ttu-id="594ec-154">查看此页上的通过浏览器 （请参见图 5）。</span><span class="sxs-lookup"><span data-stu-id="594ec-154">View this page through a browser (see Figure 5).</span></span> <span data-ttu-id="594ec-155">列出的每个八个类别。</span><span class="sxs-lookup"><span data-stu-id="594ec-155">Each of the eight categories is listed.</span></span> <span data-ttu-id="594ec-156">使用七种类别`BrochurePath`值具有`BrochurePath`各自 BoundField 中显示的值。</span><span class="sxs-lookup"><span data-stu-id="594ec-156">The seven categories with `BrochurePath` values have the `BrochurePath` value displayed in the respective BoundField.</span></span> <span data-ttu-id="594ec-157">Seafood，具有`NULL`值为其`BrochurePath`，将显示空单元格。</span><span class="sxs-lookup"><span data-stu-id="594ec-157">Seafood, which has a `NULL` value for its `BrochurePath`, displays an empty cell.</span></span>


<span data-ttu-id="594ec-158">[![列出每个类别的名称、 说明和 BrochurePath 值](displaying-binary-data-in-the-data-web-controls-cs/_static/image5.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="594ec-158">[![Each Category s Name, Description, and BrochurePath Value is Listed](displaying-binary-data-in-the-data-web-controls-cs/_static/image5.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image9.png)</span></span>

<span data-ttu-id="594ec-159">**图 5**:每个类别的名称、 说明，并`BrochurePath`列出值 ([单击以查看实际尺寸的图像](displaying-binary-data-in-the-data-web-controls-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="594ec-159">**Figure 5**: Each Category s Name, Description, and `BrochurePath` Value is Listed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image10.png))</span></span>


<span data-ttu-id="594ec-160">而不是显示的文本`BrochurePath`列中，我们想要创建指向小册子中的链接。</span><span class="sxs-lookup"><span data-stu-id="594ec-160">Rather than displaying the text of the `BrochurePath` column, we want to create a link to the brochure.</span></span> <span data-ttu-id="594ec-161">若要完成此操作，删除`BrochurePath`BoundField 和将其替换为 HyperLinkField。</span><span class="sxs-lookup"><span data-stu-id="594ec-161">To accomplish this, remove the `BrochurePath` BoundField and replace it with a HyperLinkField.</span></span> <span data-ttu-id="594ec-162">设置新 HyperLinkField s`HeaderText`属性设置为手册，其`Text`属性设置为视图小册子中，并将其`DataNavigateUrlFields`属性设置为`BrochurePath`。</span><span class="sxs-lookup"><span data-stu-id="594ec-162">Set the new HyperLinkField s `HeaderText` property to Brochure, its `Text` property to View Brochure, and its `DataNavigateUrlFields` property to `BrochurePath`.</span></span>


![为 BrochurePath 添加 HyperLinkField](displaying-binary-data-in-the-data-web-controls-cs/_static/image6.gif)

<span data-ttu-id="594ec-164">**图 6**:添加为 HyperLinkField `BrochurePath`</span><span class="sxs-lookup"><span data-stu-id="594ec-164">**Figure 6**: Add a HyperLinkField for `BrochurePath`</span></span>


<span data-ttu-id="594ec-165">如图 7 所示，这将添加一列链接到 GridView。</span><span class="sxs-lookup"><span data-stu-id="594ec-165">This will add a column of links to the GridView, as Figure 7 shows.</span></span> <span data-ttu-id="594ec-166">单击视图手册链接将直接在浏览器中显示 PDF 或提示用户下载的文件，具体取决于是否安装了 PDF 阅读器和浏览器的设置。</span><span class="sxs-lookup"><span data-stu-id="594ec-166">Clicking a View Brochure link will either display the PDF directly in the browser or prompt the user to download the file, depending on whether a PDF reader is installed and the browser s settings.</span></span>


<span data-ttu-id="594ec-167">[![可通过单击查看手册链接查看类别的手册](displaying-binary-data-in-the-data-web-controls-cs/_static/image7.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="594ec-167">[![A Category s Brochure Can Be Viewed by Clicking the View Brochure Link](displaying-binary-data-in-the-data-web-controls-cs/_static/image7.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image11.png)</span></span>

<span data-ttu-id="594ec-168">**图 7**:类别可以查看手册 s，通过单击查看手册链接 ([单击此项可查看原尺寸图像](displaying-binary-data-in-the-data-web-controls-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="594ec-168">**Figure 7**: A Category s Brochure Can Be Viewed by Clicking the View Brochure Link ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image12.png))</span></span>


<span data-ttu-id="594ec-169">[![显示类别的手册 PDF](displaying-binary-data-in-the-data-web-controls-cs/_static/image8.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="594ec-169">[![The Category s Brochure PDF is Displayed](displaying-binary-data-in-the-data-web-controls-cs/_static/image8.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image13.png)</span></span>

<span data-ttu-id="594ec-170">**图 8**:显示类别的手册 PDF ([单击此项可查看原尺寸图像](displaying-binary-data-in-the-data-web-controls-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="594ec-170">**Figure 8**: The Category s Brochure PDF is Displayed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image14.png))</span></span>


## <a name="hiding-the-view-brochure-text-for-categories-without-a-brochure"></a><span data-ttu-id="594ec-171">而无需手册的类别的隐藏视图手册文本</span><span class="sxs-lookup"><span data-stu-id="594ec-171">Hiding the View Brochure Text for Categories Without a Brochure</span></span>

<span data-ttu-id="594ec-172">如图 7 所示， `BrochurePath` HyperLinkField 显示其`Text`属性值 （视图手册） 的所有记录，而不管是否那里 s 非`NULL`值`BrochurePath`。</span><span class="sxs-lookup"><span data-stu-id="594ec-172">As Figure 7 shows, the `BrochurePath` HyperLinkField displays its `Text` property value ( View Brochure ) for all records, regardless of whether there s a non-`NULL` value for `BrochurePath`.</span></span> <span data-ttu-id="594ec-173">当然，如果`BrochurePath`是`NULL`，该链接显示为文本，然后与 Seafood 类别情况一样 （请参阅回图 7）。</span><span class="sxs-lookup"><span data-stu-id="594ec-173">Of course, if `BrochurePath` is `NULL`, then the link is displayed as text only, as is the case with the Seafood category (refer back to Figure 7).</span></span> <span data-ttu-id="594ec-174">而不是显示的文本视图手册，可能会很棒而无需这些类别`BrochurePath`值显示一些备用文本，如无手册可用。</span><span class="sxs-lookup"><span data-stu-id="594ec-174">Rather than displaying the text View Brochure, it might be nice to have those categories without a `BrochurePath` value display some alternate text, like No Brochure Available.</span></span>

<span data-ttu-id="594ec-175">为了提供此行为，我们需要使用通过调用页面方法发出相应的输出基于在生成其内容为 TemplateField`BrochurePath`值。</span><span class="sxs-lookup"><span data-stu-id="594ec-175">In order to provide this behavior, we need to use a TemplateField whose content is generated via a call to a page method that emits the appropriate output based on the `BrochurePath` value.</span></span> <span data-ttu-id="594ec-176">我们先探讨了此格式设置方法返回[GridView 控件中使用 Templatefield](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md)教程。</span><span class="sxs-lookup"><span data-stu-id="594ec-176">We first explored this formatting technique back in the [Using TemplateFields in the GridView Control](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md) tutorial.</span></span>

<span data-ttu-id="594ec-177">选择将转换为 TemplateField HyperLinkField `BrochurePath` HyperLinkField，然后单击转换此字段转换为 TemplateField 链接在编辑列对话框中。</span><span class="sxs-lookup"><span data-stu-id="594ec-177">Turn the HyperLinkField into a TemplateField by selecting the `BrochurePath` HyperLinkField and then clicking on the Convert this field into a TemplateField link in the Edit Columns dialog box.</span></span>


![HyperLinkField 转换为 TemplateField](displaying-binary-data-in-the-data-web-controls-cs/_static/image9.gif)

<span data-ttu-id="594ec-179">**图 9**:HyperLinkField 转换为 TemplateField</span><span class="sxs-lookup"><span data-stu-id="594ec-179">**Figure 9**: Convert the HyperLinkField into a TemplateField</span></span>


<span data-ttu-id="594ec-180">这将创建使用 TemplateField `ItemTemplate` ，其中包含超链接 Web 控件`NavigateUrl`属性绑定到`BrochurePath`值。</span><span class="sxs-lookup"><span data-stu-id="594ec-180">This will create a TemplateField with an `ItemTemplate` that contains a HyperLink Web control whose `NavigateUrl` property is bound to the `BrochurePath` value.</span></span> <span data-ttu-id="594ec-181">将此标记对方法的调用替换为`GenerateBrochureLink`中的值传入`BrochurePath`:</span><span class="sxs-lookup"><span data-stu-id="594ec-181">Replace this markup with a call to the method `GenerateBrochureLink`, passing in the value of `BrochurePath`:</span></span>


[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample2.aspx)]

<span data-ttu-id="594ec-182">接下来，创建`protected`方法在 ASP.NET 页上名为 s 代码隐藏类`GenerateBrochureLink`，它返回`string`并接受`object`作为输入参数。</span><span class="sxs-lookup"><span data-stu-id="594ec-182">Next, create a `protected` method in the ASP.NET page s code-behind class named `GenerateBrochureLink` that returns a `string` and accepts an `object` as an input parameter.</span></span>


[!code-csharp[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample3.cs)]

<span data-ttu-id="594ec-183">此方法用于确定传入的`object`值是一种数据库`NULL`和，如果是这样，将返回一个消息，指示该类别缺少手册。</span><span class="sxs-lookup"><span data-stu-id="594ec-183">This method determines if the passed-in `object` value is a database `NULL` and, if so, returns a message indicating that the category lacks a brochure.</span></span> <span data-ttu-id="594ec-184">否则为如果没有`BrochurePath`值，它显示超链接中的 s。</span><span class="sxs-lookup"><span data-stu-id="594ec-184">Otherwise, if there is a `BrochurePath` value, it s displayed in a hyperlink.</span></span> <span data-ttu-id="594ec-185">请注意，如果`BrochurePath`值是将其提交到传递的 s [ `ResolveUrl(url)`方法](https://msdn.microsoft.com/library/system.web.ui.control.resolveurl.aspx)。</span><span class="sxs-lookup"><span data-stu-id="594ec-185">Note that if the `BrochurePath` value is present it s passed into the [`ResolveUrl(url)` method](https://msdn.microsoft.com/library/system.web.ui.control.resolveurl.aspx).</span></span> <span data-ttu-id="594ec-186">此方法解析传入的*url*，并替换`~`字符与相应的虚拟路径。</span><span class="sxs-lookup"><span data-stu-id="594ec-186">This method resolves the passed-in *url*, replacing the `~` character with the appropriate virtual path.</span></span> <span data-ttu-id="594ec-187">例如，如果应用程序根节点`/Tutorial55`，`ResolveUrl("~/Brochures/Meats.pdf")`将返回`/Tutorial55/Brochures/Meat.pdf`。</span><span class="sxs-lookup"><span data-stu-id="594ec-187">For example, if the application is rooted at `/Tutorial55`, `ResolveUrl("~/Brochures/Meats.pdf")` will return `/Tutorial55/Brochures/Meat.pdf`.</span></span>

<span data-ttu-id="594ec-188">图 10 应用这些更改后显示的页。</span><span class="sxs-lookup"><span data-stu-id="594ec-188">Figure 10 shows the page after these changes have been applied.</span></span> <span data-ttu-id="594ec-189">请注意，Seafood 类别的`BrochurePath`字段现在显示无手册可用的文本。</span><span class="sxs-lookup"><span data-stu-id="594ec-189">Note that the Seafood category s `BrochurePath` field now displays the text No Brochure Available .</span></span>


<span data-ttu-id="594ec-190">[![文本否手册可显示有关这些类别而无需手册](displaying-binary-data-in-the-data-web-controls-cs/_static/image10.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="594ec-190">[![The Text No Brochure Available is Displayed for Those Categories Without a Brochure](displaying-binary-data-in-the-data-web-controls-cs/_static/image10.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image15.png)</span></span>

<span data-ttu-id="594ec-191">**图 10**:文本否手册可显示有关这些类别而无需手册 ([单击此项可查看原尺寸图像](displaying-binary-data-in-the-data-web-controls-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="594ec-191">**Figure 10**: The Text No Brochure Available is Displayed for Those Categories Without a Brochure ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image16.png))</span></span>


## <a name="step-3-adding-a-web-page-to-display-a-category-s-picture"></a><span data-ttu-id="594ec-192">步骤 3：添加 Web 页以显示类别的图片</span><span class="sxs-lookup"><span data-stu-id="594ec-192">Step 3: Adding a Web Page to Display a Category s Picture</span></span>

<span data-ttu-id="594ec-193">当用户访问 ASP.NET 页面时，他们将收到 ASP.NET 页的 HTML。</span><span class="sxs-lookup"><span data-stu-id="594ec-193">When a user visits an ASP.NET page, they receive the ASP.NET page s HTML.</span></span> <span data-ttu-id="594ec-194">收到的 HTML 只是文本，并且不包含任何二进制数据。</span><span class="sxs-lookup"><span data-stu-id="594ec-194">The received HTML is just text and does not contain any binary data.</span></span> <span data-ttu-id="594ec-195">任何其他的二进制数据，如图像、 声音文件、 Macromedia Flash 应用程序、 嵌入 Windows Media Player 视频等，作为单独的 web 服务器上的资源存在。</span><span class="sxs-lookup"><span data-stu-id="594ec-195">Any additional binary data, such as images, sound files, Macromedia Flash applications, embedded Windows Media Player videos, and so forth, exist as separate resources on the web server.</span></span> <span data-ttu-id="594ec-196">HTML 包含对这些文件的引用，但不包括文件的实际内容。</span><span class="sxs-lookup"><span data-stu-id="594ec-196">The HTML contains references to these files, but does not include the actual contents of the files.</span></span>

<span data-ttu-id="594ec-197">例如，在 HTML`<img>`元素用于引用一张图片，与`src`指向图像文件的属性如下所示：</span><span class="sxs-lookup"><span data-stu-id="594ec-197">For example, in HTML the `<img>` element is used to reference a picture, with the `src` attribute pointing to the image file like so:</span></span>


[!code-html[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample4.html)]

<span data-ttu-id="594ec-198">当浏览器收到此 HTML 时，它向 web 服务器以检索图像文件，并将结果显示在浏览器中的二进制内容发出另一个请求。</span><span class="sxs-lookup"><span data-stu-id="594ec-198">When a browser receives this HTML, it makes another request to the web server to retrieve the binary contents of the image file, which it then displays in the browser.</span></span> <span data-ttu-id="594ec-199">相同的概念适用于任何二进制数据。</span><span class="sxs-lookup"><span data-stu-id="594ec-199">The same concept applies to any binary data.</span></span> <span data-ttu-id="594ec-200">在步骤 2 中，小册子中已不发送到浏览器页面的 HTML 标记的一部分。</span><span class="sxs-lookup"><span data-stu-id="594ec-200">In Step 2, the brochure was not sent down to the browser as part of the page s HTML markup.</span></span> <span data-ttu-id="594ec-201">而是，呈现的 HTML 提供超链接，单击，导致浏览器直接请求 PDF 文档。</span><span class="sxs-lookup"><span data-stu-id="594ec-201">Rather, the rendered HTML provided hyperlinks that, when clicked, caused the browser to request the PDF document directly.</span></span>

<span data-ttu-id="594ec-202">若要显示或允许用户下载驻留在数据库中的二进制数据，我们需要创建一个单独的网页，返回的数据。</span><span class="sxs-lookup"><span data-stu-id="594ec-202">To display or allow users to download binary data that resides within the database, we need to create a separate web page that returns the data.</span></span> <span data-ttu-id="594ec-203">我们的应用程序，这里 s 只有一个直接存储在数据库类别的图片的二进制数据字段。</span><span class="sxs-lookup"><span data-stu-id="594ec-203">For our application, there s only one binary data field stored directly in the database the category s picture.</span></span> <span data-ttu-id="594ec-204">因此，我们需要一个页面，调用时，返回特定类别的图像数据。</span><span class="sxs-lookup"><span data-stu-id="594ec-204">Therefore, we need a page that, when called, returns the image data for a particular category.</span></span>

<span data-ttu-id="594ec-205">添加到新的 ASP.NET 页`BinaryData`文件夹名为`DisplayCategoryPicture.aspx`。</span><span class="sxs-lookup"><span data-stu-id="594ec-205">Add a new ASP.NET page to the `BinaryData` folder named `DisplayCategoryPicture.aspx`.</span></span> <span data-ttu-id="594ec-206">这样做时，选择母版页复选框保持未选中状态。</span><span class="sxs-lookup"><span data-stu-id="594ec-206">When doing so, leave the Select master page checkbox unchecked.</span></span> <span data-ttu-id="594ec-207">此页需要`CategoryID`在查询字符串并返回该类别 s 的二进制数据值`Picture`列。</span><span class="sxs-lookup"><span data-stu-id="594ec-207">This page expects a `CategoryID` value in the querystring and returns the binary data of that category s `Picture` column.</span></span> <span data-ttu-id="594ec-208">由于此页返回二进制数据和其他任何内容，因此它不需要的 HTML 部分中任何标记。</span><span class="sxs-lookup"><span data-stu-id="594ec-208">Since this page returns binary data and nothing else, it does not need any markup in the HTML section.</span></span> <span data-ttu-id="594ec-209">因此，单击左下角的源选项卡并删除所有页面的标记除外`<%@ Page %>`指令。</span><span class="sxs-lookup"><span data-stu-id="594ec-209">Therefore, click on the Source tab in the lower left corner and remove all of the page s markup except for the `<%@ Page %>` directive.</span></span> <span data-ttu-id="594ec-210">也就是说， `DisplayCategoryPicture.aspx` s 声明性标记应包含单个行：</span><span class="sxs-lookup"><span data-stu-id="594ec-210">That is, `DisplayCategoryPicture.aspx` s declarative markup should consist of a single line:</span></span>


[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample5.aspx)]

<span data-ttu-id="594ec-211">如果您看到`MasterPageFile`属性中`<%@ Page %>`指令，将其删除。</span><span class="sxs-lookup"><span data-stu-id="594ec-211">If you see the `MasterPageFile` attribute in the `<%@ Page %>` directive, remove it.</span></span>

<span data-ttu-id="594ec-212">在页面 + s 代码隐藏类中，以下代码添加到`Page_Load`事件处理程序：</span><span class="sxs-lookup"><span data-stu-id="594ec-212">In the page s code-behind class, add the following code to the `Page_Load` event handler:</span></span>


[!code-csharp[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample6.cs)]

<span data-ttu-id="594ec-213">此代码开始通过阅读`CategoryID`到一个名为变量的查询字符串值`categoryID`。</span><span class="sxs-lookup"><span data-stu-id="594ec-213">This code starts by reading in the `CategoryID` querystring value into a variable named `categoryID`.</span></span> <span data-ttu-id="594ec-214">接下来，通过调用检索图片数据`CategoriesBLL`类的`GetCategoryWithBinaryDataByCategoryID(categoryID)`方法。</span><span class="sxs-lookup"><span data-stu-id="594ec-214">Next, the picture data is retrieved via a call to the `CategoriesBLL` class s `GetCategoryWithBinaryDataByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="594ec-215">通过使用此数据返回到客户端`Response.BinaryWrite(data)`方法，但在此调用之前`Picture`必须删除列的值的 OLE 标头。</span><span class="sxs-lookup"><span data-stu-id="594ec-215">This data is returned to the client by using the `Response.BinaryWrite(data)` method, but before this is called, the `Picture` column value s OLE header must be removed.</span></span> <span data-ttu-id="594ec-216">这通过创建实现`byte`名为数组`strippedImageData`，将存放精确 78 个字符而不是在更少`Picture`列。</span><span class="sxs-lookup"><span data-stu-id="594ec-216">This is accomplished by creating a `byte` array named `strippedImageData` that will hold precisely 78 characters less than what is in the `Picture` column.</span></span> <span data-ttu-id="594ec-217">[ `Array.Copy`方法](https://msdn.microsoft.com/library/z50k9bft.aspx)用于中的数据复制`category.Picture`起始位置 78 转移到`strippedImageData`。</span><span class="sxs-lookup"><span data-stu-id="594ec-217">The [`Array.Copy` method](https://msdn.microsoft.com/library/z50k9bft.aspx) is used to copy the data from `category.Picture` starting at position 78 over to `strippedImageData`.</span></span>

<span data-ttu-id="594ec-218">`Response.ContentType`属性指定[MIME 类型](http://en.wikipedia.org/wiki/MIME)被返回，以便在浏览器知道如何呈现的内容。</span><span class="sxs-lookup"><span data-stu-id="594ec-218">The `Response.ContentType` property specifies the [MIME type](http://en.wikipedia.org/wiki/MIME) of the content being returned so that the browser knows how to render it.</span></span> <span data-ttu-id="594ec-219">由于`Categories`表的`Picture`列是位图图像、 位图 MIME 类型使用此处 (image/bmp)。</span><span class="sxs-lookup"><span data-stu-id="594ec-219">Since the `Categories` table s `Picture` column is a bitmap image, the bitmap MIME type is used here (image/bmp).</span></span> <span data-ttu-id="594ec-220">如果省略的 MIME 类型，大多数浏览器仍将显示图像正确因为它们可以推断出基于内容的图像文件 s 二进制数据类型。</span><span class="sxs-lookup"><span data-stu-id="594ec-220">If you omit the MIME type, most browsers will still display the image correctly because they can infer the type based on the contents of the image file s binary data.</span></span> <span data-ttu-id="594ec-221">但是，它比较明智的做法包括 MIME s 键入在可能的情况。</span><span class="sxs-lookup"><span data-stu-id="594ec-221">However, it s prudent to include the MIME type when possible.</span></span> <span data-ttu-id="594ec-222">请参阅[Internet 号码分配机构的网站](http://www.iana.org/)有关的完整列表[MIME 媒体类型](http://www.iana.org/assignments/media-types/)。</span><span class="sxs-lookup"><span data-stu-id="594ec-222">See the [Internet Assigned Numbers Authority s website](http://www.iana.org/) for a complete listing of [MIME media types](http://www.iana.org/assignments/media-types/).</span></span>

<span data-ttu-id="594ec-223">与创建此页，可以通过访问查看特定类别的图片`DisplayCategoryPicture.aspx?CategoryID=categoryID`。</span><span class="sxs-lookup"><span data-stu-id="594ec-223">With this page created, a particular category s picture can be viewed by visiting `DisplayCategoryPicture.aspx?CategoryID=categoryID`.</span></span> <span data-ttu-id="594ec-224">图 11 显示了饮料类别的图中，可以通过查看`DisplayCategoryPicture.aspx?CategoryID=1`。</span><span class="sxs-lookup"><span data-stu-id="594ec-224">Figure 11 shows the Beverages category s picture, which can be viewed from `DisplayCategoryPicture.aspx?CategoryID=1`.</span></span>


<span data-ttu-id="594ec-225">[![显示图片饮料类别 s](displaying-binary-data-in-the-data-web-controls-cs/_static/image11.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="594ec-225">[![The Beverages Category s Picture is Displayed](displaying-binary-data-in-the-data-web-controls-cs/_static/image11.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image17.png)</span></span>

<span data-ttu-id="594ec-226">**图 11**:显示图片的饮料类别 s ([单击此项可查看原尺寸图像](displaying-binary-data-in-the-data-web-controls-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="594ec-226">**Figure 11**: The Beverages Category s Picture is Displayed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image18.png))</span></span>


<span data-ttu-id="594ec-227">如果在访问`DisplayCategoryPicture.aspx?CategoryID=categoryID`，收到异常，并显示无法为类型的对象强制转换为 System.DBNull type 'System.Byte []，这可能导致两件事情。</span><span class="sxs-lookup"><span data-stu-id="594ec-227">If, when visiting `DisplayCategoryPicture.aspx?CategoryID=categoryID`, you get an exception that reads Unable to cast object of type 'System.DBNull' to type 'System.Byte[]', there are two things that may be causing this.</span></span> <span data-ttu-id="594ec-228">首先，`Categories`表 s`Picture`允许列`NULL`值。</span><span class="sxs-lookup"><span data-stu-id="594ec-228">First, the `Categories` table s `Picture` column does allow `NULL` values.</span></span> <span data-ttu-id="594ec-229">`DisplayCategoryPicture.aspx`页上，但是，假定有一个非`NULL`值存在。</span><span class="sxs-lookup"><span data-stu-id="594ec-229">The `DisplayCategoryPicture.aspx` page, however, assumes there is a non-`NULL` value present.</span></span> <span data-ttu-id="594ec-230">`Picture`的属性`CategoriesDataTable`如果有不能直接访问`NULL`值。</span><span class="sxs-lookup"><span data-stu-id="594ec-230">The `Picture` property of the `CategoriesDataTable` cannot be directly accessed if it has a `NULL` value.</span></span> <span data-ttu-id="594ec-231">如果确实想要允许`NULL`值为`Picture`列中，d 你想要包括以下条件：</span><span class="sxs-lookup"><span data-stu-id="594ec-231">If you do want to allow `NULL` values for the `Picture` column, you d want to include the following condition:</span></span>


[!code-csharp[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample7.cs)]

<span data-ttu-id="594ec-232">上面的代码假定一些图像名为文件即 s`NoPictureAvailable.gif`在`Images`想要显示这些类别，而无需图片的文件夹。</span><span class="sxs-lookup"><span data-stu-id="594ec-232">The above code assumes that there s some image file named `NoPictureAvailable.gif` in the `Images` folder that you want to display for those categories without a picture.</span></span>

<span data-ttu-id="594ec-233">如果，也可能导致此异常`CategoriesTableAdapter`s `GetCategoryWithBinaryDataByCategoryID` s 方法`SELECT`语句已恢复主查询的列列表中，出现这种情况，如果正在使用的临时 SQL 语句，并且你已重新运行该向导的 TableAdapter s主查询。</span><span class="sxs-lookup"><span data-stu-id="594ec-233">This exception could also be caused if the `CategoriesTableAdapter` s `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement has reverted back to the main query s column list, which can happen if you are using ad-hoc SQL statements and you ve re-run the wizard for the TableAdapter s main query.</span></span> <span data-ttu-id="594ec-234">检查以确保`GetCategoryWithBinaryDataByCategoryID`s 方法`SELECT`语句仍包含`Picture`列。</span><span class="sxs-lookup"><span data-stu-id="594ec-234">Check to ensure that `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement still includes the `Picture` column.</span></span>

> [!NOTE]
> <span data-ttu-id="594ec-235">每次`DisplayCategoryPicture.aspx`是访问时，对数据库进行访问，并返回指定的类别的图片数据。</span><span class="sxs-lookup"><span data-stu-id="594ec-235">Every time the `DisplayCategoryPicture.aspx` is visited, the database is accessed and the specified category s picture data is returned.</span></span> <span data-ttu-id="594ec-236">如果自用户上次查看它尚未更改类别的图片，不过，这就是做很多无用功。</span><span class="sxs-lookup"><span data-stu-id="594ec-236">If the category s picture hasn't changed since the user has last viewed it, though, this is wasted effort.</span></span> <span data-ttu-id="594ec-237">幸运的是，HTTP 允许*条件获取*。</span><span class="sxs-lookup"><span data-stu-id="594ec-237">Fortunately, HTTP allows for *conditional GETs*.</span></span> <span data-ttu-id="594ec-238">条件性 GET 发出 HTTP 请求的客户端中将发送沿[ `If-Modified-Since` HTTP 标头](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html)，它提供的日期和时间在客户端上次从 web 服务器中检索此资源。</span><span class="sxs-lookup"><span data-stu-id="594ec-238">With a conditional GET, the client making the HTTP request sends along an [`If-Modified-Since` HTTP header](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html) that provides the date and time the client last retrieved this resource from the web server.</span></span> <span data-ttu-id="594ec-239">如果内容未更改由于这指定日期，因此，web 服务器可能会响应[不会修改状态代码 (304)](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)和放弃发回请求的资源的内容。</span><span class="sxs-lookup"><span data-stu-id="594ec-239">If the content has not changed since this specified date, the web server may respond with a [Not Modified status code (304)](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html) and forgo sending back the requested resource s content.</span></span> <span data-ttu-id="594ec-240">简单地说，此技术使无需发送资源的内容，如果它未被修改自客户端上次访问以来的 web 服务器。</span><span class="sxs-lookup"><span data-stu-id="594ec-240">In short, this technique relieves the web server from having to send back content for a resource if it has not been modified since the client last accessed it.</span></span>


<span data-ttu-id="594ec-241">若要实现此行为，但是，要求您添加`PictureLastModified`列添加到`Categories`表，以捕获时`Picture`检查代码以及上次更新列`If-Modified-Since`标头。</span><span class="sxs-lookup"><span data-stu-id="594ec-241">To implement this behavior, however, requires that you add a `PictureLastModified` column to the `Categories` table to capture when the `Picture` column was last updated as well as code to check for the `If-Modified-Since` header.</span></span> <span data-ttu-id="594ec-242">有关详细信息`If-Modified-Since`标头和条件 GET 工作流，请参阅[HTTP 条件 GET RSS 黑客](http://fishbowl.pastiche.org/2002/10/21/http_conditional_get_for_rss_hackers)并[更深入地看看 ASP.NET 页中执行 HTTP 请求](http://aspnet.4guysfromrolla.com/articles/122204-1.aspx)。</span><span class="sxs-lookup"><span data-stu-id="594ec-242">For more information on the `If-Modified-Since` header and the conditional GET workflow, see [HTTP Conditional GET for RSS Hackers](http://fishbowl.pastiche.org/2002/10/21/http_conditional_get_for_rss_hackers) and [A Deeper Look at Performing HTTP Requests in an ASP.NET Page](http://aspnet.4guysfromrolla.com/articles/122204-1.aspx).</span></span>

## <a name="step-4-displaying-the-category-pictures-in-a-gridview"></a><span data-ttu-id="594ec-243">步骤 4：在 GridView 中显示的类别图片</span><span class="sxs-lookup"><span data-stu-id="594ec-243">Step 4: Displaying the Category Pictures in a GridView</span></span>

<span data-ttu-id="594ec-244">现在，我们已有要显示特定类别的图片的网页，我们可以显示使用其[图像 Web 控件](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/image.aspx)或对应的 HTML`<img>`指向的元素`DisplayCategoryPicture.aspx?CategoryID=categoryID`。</span><span class="sxs-lookup"><span data-stu-id="594ec-244">Now that we have a web page to display a particular category s picture, we can display it using the [Image Web control](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/image.aspx) or an HTML `<img>` element pointing to `DisplayCategoryPicture.aspx?CategoryID=categoryID`.</span></span> <span data-ttu-id="594ec-245">可以在 GridView 或使用 ImageField DetailsView 中显示其 URL 将由数据库数据的图像。</span><span class="sxs-lookup"><span data-stu-id="594ec-245">Images whose URL is determined by database data can be displayed in the GridView or DetailsView using the ImageField.</span></span> <span data-ttu-id="594ec-246">包含 ImageField`DataImageUrlField`并`DataImageUrlFormatString`属性的工作方式类似 HyperLinkField s`DataNavigateUrlFields`和`DataNavigateUrlFormatString`属性。</span><span class="sxs-lookup"><span data-stu-id="594ec-246">The ImageField contains `DataImageUrlField` and `DataImageUrlFormatString` properties that work like the HyperLinkField s `DataNavigateUrlFields` and `DataNavigateUrlFormatString` properties.</span></span>

<span data-ttu-id="594ec-247">让我们来扩充`Categories`中的 GridView`DisplayOrDownloadData.aspx`通过添加 ImageField 以显示每个类别的图片。</span><span class="sxs-lookup"><span data-stu-id="594ec-247">Let s augment the `Categories` GridView in `DisplayOrDownloadData.aspx` by adding an ImageField to show each category s picture.</span></span> <span data-ttu-id="594ec-248">只需添加 ImageField 并设置其`DataImageUrlField`并`DataImageUrlFormatString`属性设置为`CategoryID`和`DisplayCategoryPicture.aspx?CategoryID={0}`分别。</span><span class="sxs-lookup"><span data-stu-id="594ec-248">Simply add the ImageField and set its `DataImageUrlField` and `DataImageUrlFormatString` properties to `CategoryID` and `DisplayCategoryPicture.aspx?CategoryID={0}`, respectively.</span></span> <span data-ttu-id="594ec-249">这将创建 GridView 列呈现`<img>`元素的`src`属性引用`DisplayCategoryPicture.aspx?CategoryID={0}`，其中{0}替换为 GridView 行的`CategoryID`值。</span><span class="sxs-lookup"><span data-stu-id="594ec-249">This will create a GridView column that renders an `<img>` element whose `src` attribute references `DisplayCategoryPicture.aspx?CategoryID={0}`, where {0} is replaced with the GridView row s `CategoryID` value.</span></span>


![添加到 GridView ImageField](displaying-binary-data-in-the-data-web-controls-cs/_static/image12.gif)

<span data-ttu-id="594ec-251">**图 12**:添加到 GridView ImageField</span><span class="sxs-lookup"><span data-stu-id="594ec-251">**Figure 12**: Add an ImageField to the GridView</span></span>


<span data-ttu-id="594ec-252">以后将添加 ImageField，GridView s 声明性语法看起来应像 soothe 以下：</span><span class="sxs-lookup"><span data-stu-id="594ec-252">After adding the ImageField, your GridView s declarative syntax should look like soothe following:</span></span>


[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-cs/samples/sample8.aspx)]

<span data-ttu-id="594ec-253">请花费片刻时间来查看此页上的通过浏览器。</span><span class="sxs-lookup"><span data-stu-id="594ec-253">Take a moment to view this page through a browser.</span></span> <span data-ttu-id="594ec-254">请注意如何每条记录现在包含类别的图片。</span><span class="sxs-lookup"><span data-stu-id="594ec-254">Note how each record now includes a picture for the category.</span></span>


<span data-ttu-id="594ec-255">[![为每个行显示类别的图片](displaying-binary-data-in-the-data-web-controls-cs/_static/image13.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="594ec-255">[![The Category s Picture is Displayed for Each Row](displaying-binary-data-in-the-data-web-controls-cs/_static/image13.gif)](displaying-binary-data-in-the-data-web-controls-cs/_static/image19.png)</span></span>

<span data-ttu-id="594ec-256">**图 13**:为每个行显示类别的图片 ([单击此项可查看原尺寸图像](displaying-binary-data-in-the-data-web-controls-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="594ec-256">**Figure 13**: The Category s Picture is Displayed for Each Row ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-cs/_static/image20.png))</span></span>


## <a name="summary"></a><span data-ttu-id="594ec-257">总结</span><span class="sxs-lookup"><span data-stu-id="594ec-257">Summary</span></span>

<span data-ttu-id="594ec-258">在本教程中介绍了如何显示二进制数据。</span><span class="sxs-lookup"><span data-stu-id="594ec-258">In this tutorial we examined how to present binary data.</span></span> <span data-ttu-id="594ec-259">数据的显示方式取决于数据的类型。</span><span class="sxs-lookup"><span data-stu-id="594ec-259">How the data is presented depends on the type of data.</span></span> <span data-ttu-id="594ec-260">对于 PDF 小册子文件，我们向用户提供视图手册链接，单击时，用户直接所用的时间的 PDF 文件。</span><span class="sxs-lookup"><span data-stu-id="594ec-260">For the PDF brochure files, we offered the user a View Brochure link that, when clicked, took the user directly to the PDF file.</span></span> <span data-ttu-id="594ec-261">类别的图片，我们首先创建一个页面，检索并从数据库返回的二进制数据，并且然后使用该页面的 GridView 中显示每个类别的图片。</span><span class="sxs-lookup"><span data-stu-id="594ec-261">For the category s picture, we first created a page to retrieve and return the binary data from the database and then used that page to display each category s picture in a GridView.</span></span>

<span data-ttu-id="594ec-262">现在，我们已了解了如何显示二进制数据，我们准备就绪后，若要了解如何执行插入、 更新和删除针对数据库的二进制数据。</span><span class="sxs-lookup"><span data-stu-id="594ec-262">Now that we ve looked at how to display binary data, we re ready to examine how to perform insert, updates, and deletes against the database with the binary data.</span></span> <span data-ttu-id="594ec-263">在下一教程中我们将介绍如何将上传的文件与相应的数据库记录相关联。</span><span class="sxs-lookup"><span data-stu-id="594ec-263">In the next tutorial we'll look at how to associate an uploaded file with its corresponding database record.</span></span> <span data-ttu-id="594ec-264">在这之后的教程，我们将了解如何更新现有的二进制数据，以及如何删除其关联的记录已删除的二进制数据。</span><span class="sxs-lookup"><span data-stu-id="594ec-264">In the tutorial after that, we'll see how to update existing binary data as well as how to delete the binary data when its associated record is removed.</span></span>

<span data-ttu-id="594ec-265">快乐编程 ！</span><span class="sxs-lookup"><span data-stu-id="594ec-265">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="594ec-266">关于作者</span><span class="sxs-lookup"><span data-stu-id="594ec-266">About the Author</span></span>

<span data-ttu-id="594ec-267">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)的七个部 asp/ASP.NET 书籍并创办了作者[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年以来一直致力于 Microsoft Web 技术。</span><span class="sxs-lookup"><span data-stu-id="594ec-267">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="594ec-268">Scott 是独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="594ec-268">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="594ec-269">他最新著作是[ *Sams Teach 自己 ASP.NET 2.0 24 小时内*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="594ec-269">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="594ec-270">他可以到达[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="594ec-270">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="594ec-271">或通过他的博客，其中，请参阅[ http://ScottOnWriting.NET ](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="594ec-271">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="594ec-272">特别感谢</span><span class="sxs-lookup"><span data-stu-id="594ec-272">Special Thanks To</span></span>

<span data-ttu-id="594ec-273">很多有用的审阅者已评审本系列教程。</span><span class="sxs-lookup"><span data-stu-id="594ec-273">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="594ec-274">本教程中的潜在顾客审阅者是 Teresa Murphy 和 Dave Gardner。</span><span class="sxs-lookup"><span data-stu-id="594ec-274">Lead reviewers for this tutorial were Teresa Murphy and Dave Gardner.</span></span> <span data-ttu-id="594ec-275">是否有兴趣查看我即将推出的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="594ec-275">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="594ec-276">如果是这样，给我在行[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="594ec-276">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="594ec-277">[上一页](uploading-files-cs.md)
> [下一页](including-a-file-upload-option-when-adding-a-new-record-cs.md)</span><span class="sxs-lookup"><span data-stu-id="594ec-277">[Previous](uploading-files-cs.md)
[Next](including-a-file-upload-option-when-adding-a-new-record-cs.md)</span></span>
