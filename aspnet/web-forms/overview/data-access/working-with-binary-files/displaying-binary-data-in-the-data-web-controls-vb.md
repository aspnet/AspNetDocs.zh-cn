---
uid: web-forms/overview/data-access/working-with-binary-files/displaying-binary-data-in-the-data-web-controls-vb
title: 显示数据 Web 控件中的二进制数据（VB） |Microsoft Docs
author: rick-anderson
description: 在本教程中，我们将介绍用于在网页上显示二进制数据的选项，包括图像文件的显示和 "下载" 链接的设置 。
ms.author: riande
ms.date: 03/27/2007
ms.assetid: 9201656a-e1c2-4020-824b-18fb632d2925
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/displaying-binary-data-in-the-data-web-controls-vb
msc.type: authoredcontent
ms.openlocfilehash: 27c901af092aa990f557750dc5d2c42ba2644c02
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/06/2020
ms.locfileid: "78489098"
---
# <a name="displaying-binary-data-in-the-data-web-controls-vb"></a><span data-ttu-id="a3dc7-103">显示数据 Web 控件中的二进制数据 (VB)</span><span class="sxs-lookup"><span data-stu-id="a3dc7-103">Displaying Binary Data in the Data Web Controls (VB)</span></span>

<span data-ttu-id="a3dc7-104">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="a3dc7-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="a3dc7-105">[下载示例应用](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_55_VB.exe)或[下载 PDF](displaying-binary-data-in-the-data-web-controls-vb/_static/datatutorial55vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="a3dc7-105">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_55_VB.exe) or [Download PDF](displaying-binary-data-in-the-data-web-controls-vb/_static/datatutorial55vb1.pdf)</span></span>

> <span data-ttu-id="a3dc7-106">在本教程中，我们将介绍用于在网页上显示二进制数据的选项，包括图像文件的显示以及 PDF 文件的 "下载" 链接。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-106">In this tutorial we look at the options to present binary data on a Web page, including the display of an image file and the provision of a 'Download' link for a PDF file.</span></span>

## <a name="introduction"></a><span data-ttu-id="a3dc7-107">简介</span><span class="sxs-lookup"><span data-stu-id="a3dc7-107">Introduction</span></span>

<span data-ttu-id="a3dc7-108">在前面的教程中，我们探讨了两种方法，用于将二进制数据与应用程序的基础数据模型相关联，并使用 FileUpload 控件将文件从浏览器上传到 web 服务器的文件系统。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-108">In the preceding tutorial we explored the two techniques for associating binary data with an application s underlying data model and used the FileUpload control to upload files from a browser to the web server s file system.</span></span> <span data-ttu-id="a3dc7-109">我们尚未看到如何将上传的二进制数据与数据模型关联。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-109">We ve yet to see how to associate the uploaded binary data with the data model.</span></span> <span data-ttu-id="a3dc7-110">也就是说，将文件上传并保存到文件系统后，必须将文件的路径存储在相应的数据库记录中。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-110">That is, after a file has been uploaded and saved to the file system, a path to the file must be stored in the appropriate database record.</span></span> <span data-ttu-id="a3dc7-111">如果数据直接存储在数据库中，则上传的二进制数据无需保存到文件系统，但必须注入到数据库中。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-111">If the data is being stored directly in the database, then the uploaded binary data need not be saved to the file system, but must be injected into the database.</span></span>

<span data-ttu-id="a3dc7-112">但在查看将数据与数据模型关联之前，让我们先了解如何向最终用户提供二进制数据。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-112">Before we look at associating the data with the data model, though, let s first look at how to provide the binary data to the end user.</span></span> <span data-ttu-id="a3dc7-113">呈现文本数据非常简单，但应如何呈现二进制数据？</span><span class="sxs-lookup"><span data-stu-id="a3dc7-113">Presenting text data is simple enough, but how should binary data be presented?</span></span> <span data-ttu-id="a3dc7-114">当然，它取决于二进制数据的类型。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-114">It depends, of course, on the type of binary data.</span></span> <span data-ttu-id="a3dc7-115">对于图像，我们可能希望显示图像;对于 Pdf、Microsoft Word 文档、ZIP 文件和其他类型的二进制数据，提供下载链接可能更合适。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-115">For images, we likely want to display the image; for PDFs, Microsoft Word documents, ZIP files, and other types of binary data, providing a Download link is probably more appropriate.</span></span>

<span data-ttu-id="a3dc7-116">在本教程中，我们将介绍如何使用数据 Web 控件（如 GridView 和 DetailsView）来向其关联的文本数据显示二进制数据。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-116">In this tutorial we will look at how to present the binary data alongside its associated text data using data Web controls like the GridView and DetailsView.</span></span> <span data-ttu-id="a3dc7-117">在下一教程中，我们将重点介绍如何将上传的文件与数据库相关联。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-117">In the next tutorial we'll turn our attention to associating an uploaded file with the database.</span></span>

## <a name="step-1-providingbrochurepathvalues"></a><span data-ttu-id="a3dc7-118">步骤1：提供`BrochurePath`值</span><span class="sxs-lookup"><span data-stu-id="a3dc7-118">Step 1: Providing`BrochurePath`Values</span></span>

<span data-ttu-id="a3dc7-119">`Categories` 表中的 `Picture` 列已经包含不同类别图像的二进制数据。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-119">The `Picture` column in the `Categories` table already contains binary data for the various category images.</span></span> <span data-ttu-id="a3dc7-120">具体而言，每条记录的 `Picture` 列都包含有纹理、低质量、16色位图图像的二进制内容。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-120">Specifically, the `Picture` column for each record holds the binary contents of a grainy, low-quality, 16-color bitmap image.</span></span> <span data-ttu-id="a3dc7-121">每个类别的图像宽度为172像素，120像素高，使用约 11 KB。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-121">Each category image is 172 pixels wide and 120 pixels tall and consumes roughly 11 KB.</span></span> <span data-ttu-id="a3dc7-122">另外，`Picture` 列中的二进制内容包括78字节的[OLE](http://en.wikipedia.org/wiki/Object_Linking_and_Embedding)标头，在显示图像之前必须将其去除。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-122">What s more, the binary content in the `Picture` column includes a 78-byte [OLE](http://en.wikipedia.org/wiki/Object_Linking_and_Embedding) header that must be stripped before displaying the image.</span></span> <span data-ttu-id="a3dc7-123">存在此标头信息，因为 Northwind 数据库在 Microsoft Access 中具有其根。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-123">This header information is present because the Northwind database has its roots in Microsoft Access.</span></span> <span data-ttu-id="a3dc7-124">在 Access 中，二进制数据使用 OLE Object 数据类型进行存储，该数据类型在此标头 get-date。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-124">In Access, binary data is stored using the OLE Object data type, which tacks on this header.</span></span> <span data-ttu-id="a3dc7-125">现在，我们将了解如何从这些低质量图像中去除标头以显示图片。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-125">For now, we'll see how to strip the headers from these low-quality images in order to display the picture.</span></span> <span data-ttu-id="a3dc7-126">在将来的教程中，我们将构建一个用于更新类别 `Picture` 列的接口，并将使用 OLE 标头的位图图像替换为不必要的 OLE 标头的等效 JPG 图像。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-126">In a future tutorial we'll build an interface for updating a category s `Picture` column and replace these bitmap images that use OLE headers with equivalent JPG images without the unnecessary OLE headers.</span></span>

<span data-ttu-id="a3dc7-127">在前面的教程中，我们介绍了如何使用 FileUpload 控件。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-127">In the preceding tutorial we saw how to use the FileUpload control.</span></span> <span data-ttu-id="a3dc7-128">因此，您可以继续将小册子文件添加到 web 服务器的文件系统中。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-128">Therefore, you can go ahead and add brochure files to the web server s file system.</span></span> <span data-ttu-id="a3dc7-129">但这样做不会更新 `Categories` 表中的 `BrochurePath` 列。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-129">Doing so, however, does not update the `BrochurePath` column in the `Categories` table.</span></span> <span data-ttu-id="a3dc7-130">在下一教程中，我们将了解如何实现此目的，但现在我们需要为此列手动提供值。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-130">In the next tutorial we'll see how to accomplish this, but for now we need to manually provide values for this column.</span></span>

<span data-ttu-id="a3dc7-131">在本教程中，你将在 "`~/Brochures`" 文件夹中找到7个 PDF 小册子文件，其中每个类别都有 "海鲜" 除外。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-131">In this tutorial s download you'll find seven PDF brochure files in the `~/Brochures` folder, one for each of the categories except Seafood.</span></span> <span data-ttu-id="a3dc7-132">我有意省略了添加海鲜手册，旨在说明如何处理并非所有记录都具有关联的二进制数据的情况。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-132">I purposefully omitted adding a Seafood brochure to illustrate how to handle scenarios where not all records have associated binary data.</span></span> <span data-ttu-id="a3dc7-133">若要用这些值更新 `Categories` 表，请在服务器资源管理器中右键单击 `Categories` 节点，然后选择 "显示表数据"。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-133">To update the `Categories` table with these values, right-click on the `Categories` node from Server Explorer and choose Show Table Data.</span></span> <span data-ttu-id="a3dc7-134">然后，为包含小册子的每个类别的小册子文件输入虚拟路径，如图1所示。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-134">Then, enter the virtual paths to the brochure files for each category that has a brochure, as Figure 1 shows.</span></span> <span data-ttu-id="a3dc7-135">由于 "海鲜" 类别没有手册，请将其 `BrochurePath` 列 "值保留为 `NULL`。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-135">Since there is no brochure for the Seafood category, leave its `BrochurePath` column s value as `NULL`.</span></span>

<span data-ttu-id="a3dc7-136">[![手动输入 "类别" 表的 BrochurePath 列的值](displaying-binary-data-in-the-data-web-controls-vb/_static/image1.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="a3dc7-136">[![Manually Enter the Values for the Categories Table s BrochurePath Column](displaying-binary-data-in-the-data-web-controls-vb/_static/image1.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image1.png)</span></span>

<span data-ttu-id="a3dc7-137">**图 1**：手动输入 `Categories` 表 `BrochurePath` 列的值（[单击以查看完全大小的图像](displaying-binary-data-in-the-data-web-controls-vb/_static/image2.png)）</span><span class="sxs-lookup"><span data-stu-id="a3dc7-137">**Figure 1**: Manually Enter the Values for the `Categories` Table s `BrochurePath` Column ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image2.png))</span></span>

## <a name="step-2-providing-a-download-link-for-the-brochures-in-a-gridview"></a><span data-ttu-id="a3dc7-138">步骤2：为 GridView 中的手册提供下载链接</span><span class="sxs-lookup"><span data-stu-id="a3dc7-138">Step 2: Providing a Download Link for the Brochures in a GridView</span></span>

<span data-ttu-id="a3dc7-139">使用为 `Categories` 表提供的 `BrochurePath` 值，我们可以创建一个 GridView，其中列出了每个类别以及用于下载类别手册的链接。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-139">With the `BrochurePath` values provided for the `Categories` table, we re ready to create a GridView that lists each category along with a link to download the category s brochure.</span></span> <span data-ttu-id="a3dc7-140">在步骤4中，我们将扩展此 GridView，还会显示类别的图像。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-140">In Step 4 we'll extend this GridView to also display the category s image.</span></span>

<span data-ttu-id="a3dc7-141">首先，将 GridView 从工具箱拖动到 `BinaryData` 文件夹中 `DisplayOrDownloadData.aspx` 页面的设计器上。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-141">Start by dragging a GridView from the Toolbox onto the Designer of the `DisplayOrDownloadData.aspx` page in the `BinaryData` folder.</span></span> <span data-ttu-id="a3dc7-142">将 GridView `ID` 设置为 `Categories` 并通过 GridView s 智能标记，选择将其绑定到新的数据源。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-142">Set the GridView s `ID` to `Categories` and through the GridView s smart tag, choose to bind it to a new data source.</span></span> <span data-ttu-id="a3dc7-143">具体而言，将其绑定到名为 `CategoriesDataSource` 的 ObjectDataSource，该 ObjectDataSource 使用 `CategoriesBLL` 对象 s `GetCategories()` 方法检索数据。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-143">Specifically, bind it to an ObjectDataSource named `CategoriesDataSource` that retrieves data using the `CategoriesBLL` object s `GetCategories()` method.</span></span>

<span data-ttu-id="a3dc7-144">[![创建一个名为 CategoriesDataSource 的新 ObjectDataSource](displaying-binary-data-in-the-data-web-controls-vb/_static/image2.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="a3dc7-144">[![Create a New ObjectDataSource Named CategoriesDataSource](displaying-binary-data-in-the-data-web-controls-vb/_static/image2.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image3.png)</span></span>

<span data-ttu-id="a3dc7-145">**图 2**：创建名为 `CategoriesDataSource` 的新 ObjectDataSource （[单击以查看完全大小的映像](displaying-binary-data-in-the-data-web-controls-vb/_static/image4.png)）</span><span class="sxs-lookup"><span data-stu-id="a3dc7-145">**Figure 2**: Create a New ObjectDataSource Named `CategoriesDataSource` ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image4.png))</span></span>

<span data-ttu-id="a3dc7-146">[![将 ObjectDataSource 配置为使用 CategoriesBLL 类](displaying-binary-data-in-the-data-web-controls-vb/_static/image3.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="a3dc7-146">[![Configure the ObjectDataSource to Use the CategoriesBLL Class](displaying-binary-data-in-the-data-web-controls-vb/_static/image3.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image5.png)</span></span>

<span data-ttu-id="a3dc7-147">**图 3**：将 ObjectDataSource 配置为使用 `CategoriesBLL` 类（[单击以查看完全大小的映像](displaying-binary-data-in-the-data-web-controls-vb/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="a3dc7-147">**Figure 3**: Configure the ObjectDataSource to Use the `CategoriesBLL` Class ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image6.png))</span></span>

<span data-ttu-id="a3dc7-148">[![使用 GetCategories （）方法检索类别列表](displaying-binary-data-in-the-data-web-controls-vb/_static/image4.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="a3dc7-148">[![Retrieve the List of Categories Using the GetCategories() Method](displaying-binary-data-in-the-data-web-controls-vb/_static/image4.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image7.png)</span></span>

<span data-ttu-id="a3dc7-149">**图 4**：使用 `GetCategories()` 方法检索类别列表（[单击以查看完全大小的图像](displaying-binary-data-in-the-data-web-controls-vb/_static/image8.png)）</span><span class="sxs-lookup"><span data-stu-id="a3dc7-149">**Figure 4**: Retrieve the List of Categories Using the `GetCategories()` Method ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image8.png))</span></span>

<span data-ttu-id="a3dc7-150">完成 "配置数据源" 向导后，Visual Studio 会自动将 BoundField 添加到 `CategoryID`的 `Categories` GridView，`CategoryName`，`Description`，`NumberOfProducts`和 `BrochurePath` `DataColumn`。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-150">After completing the Configure Data Source wizard, Visual Studio will automatically add a BoundField to the `Categories` GridView for the `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath` `DataColumn` s.</span></span> <span data-ttu-id="a3dc7-151">继续并删除 `NumberOfProducts` BoundField，因为 `GetCategories()` 方法查询不检索此信息。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-151">Go ahead and remove the `NumberOfProducts` BoundField since the `GetCategories()` method s query does not retrieve this information.</span></span> <span data-ttu-id="a3dc7-152">同时删除 `CategoryID` BoundField，并分别将 `CategoryName` 和 `BrochurePath` BoundFields `HeaderText` 属性分别重命名为 "类别" 和 "小册子"。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-152">Also remove the `CategoryID` BoundField and rename the `CategoryName` and `BrochurePath` BoundFields `HeaderText` properties to Category and Brochure, respectively.</span></span> <span data-ttu-id="a3dc7-153">进行这些更改后，GridView 和 ObjectDataSource 的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="a3dc7-153">After making these changes, your GridView and ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample1.aspx)]

<span data-ttu-id="a3dc7-154">通过浏览器查看此页（参见图5）。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-154">View this page through a browser (see Figure 5).</span></span> <span data-ttu-id="a3dc7-155">列出了8个类别中的每一个。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-155">Each of the eight categories is listed.</span></span> <span data-ttu-id="a3dc7-156">具有 `BrochurePath` 值的七个类别在各自的 BoundField 中显示 `BrochurePath` 值。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-156">The seven categories with `BrochurePath` values have the `BrochurePath` value displayed in the respective BoundField.</span></span> <span data-ttu-id="a3dc7-157">对于其 `BrochurePath`具有 `NULL` 值的海鲜，将显示空单元。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-157">Seafood, which has a `NULL` value for its `BrochurePath`, displays an empty cell.</span></span>

<span data-ttu-id="a3dc7-158">[![列出了每个类别的 Name、Description 和 BrochurePath 值](displaying-binary-data-in-the-data-web-controls-vb/_static/image5.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="a3dc7-158">[![Each Category s Name, Description, and BrochurePath Value is Listed](displaying-binary-data-in-the-data-web-controls-vb/_static/image5.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image9.png)</span></span>

<span data-ttu-id="a3dc7-159">**图 5**：列出了每个类别的 "名称"、"说明" 和 "`BrochurePath` 值（[单击以查看完全大小的图像](displaying-binary-data-in-the-data-web-controls-vb/_static/image10.png)）</span><span class="sxs-lookup"><span data-stu-id="a3dc7-159">**Figure 5**: Each Category s Name, Description, and `BrochurePath` Value is Listed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image10.png))</span></span>

<span data-ttu-id="a3dc7-160">我们想要创建到小册子的链接，而不是显示 `BrochurePath` 列的文本。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-160">Rather than displaying the text of the `BrochurePath` column, we want to create a link to the brochure.</span></span> <span data-ttu-id="a3dc7-161">为此，请删除 `BrochurePath` BoundField，并将其替换为 HyperLinkField。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-161">To accomplish this, remove the `BrochurePath` BoundField and replace it with a HyperLinkField.</span></span> <span data-ttu-id="a3dc7-162">将新的 HyperLinkField s `HeaderText` 属性设置为小册子，将其 `Text` 属性设置为 "查看手册"，并将其 `DataNavigateUrlFields` 属性设置为 "`BrochurePath`"。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-162">Set the new HyperLinkField s `HeaderText` property to Brochure, its `Text` property to View Brochure, and its `DataNavigateUrlFields` property to `BrochurePath`.</span></span>

![添加 BrochurePath 的 HyperLinkField](displaying-binary-data-in-the-data-web-controls-vb/_static/image6.gif)

<span data-ttu-id="a3dc7-164">**图 6**：为 `BrochurePath` 添加 HyperLinkField</span><span class="sxs-lookup"><span data-stu-id="a3dc7-164">**Figure 6**: Add a HyperLinkField for `BrochurePath`</span></span>

<span data-ttu-id="a3dc7-165">这会将一个链接列添加到 GridView，如图7所示。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-165">This will add a column of links to the GridView, as Figure 7 shows.</span></span> <span data-ttu-id="a3dc7-166">单击 "查看小册子" 链接将直接在浏览器中显示 PDF，或提示用户下载文件，具体取决于是否安装了 PDF 读取器和浏览器设置。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-166">Clicking a View Brochure link will either display the PDF directly in the browser or prompt the user to download the file, depending on whether a PDF reader is installed and the browser s settings.</span></span>

<span data-ttu-id="a3dc7-167">[可以通过单击 "查看小册子" 链接 ![查看类别](displaying-binary-data-in-the-data-web-controls-vb/_static/image7.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="a3dc7-167">[![A Category s Brochure Can Be Viewed by Clicking the View Brochure Link](displaying-binary-data-in-the-data-web-controls-vb/_static/image7.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image11.png)</span></span>

<span data-ttu-id="a3dc7-168">**图 7**：可以通过单击 "查看小册子" 链接来查看类别的小册子（[单击以查看完全大小的图像](displaying-binary-data-in-the-data-web-controls-vb/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="a3dc7-168">**Figure 7**: A Category s Brochure Can Be Viewed by Clicking the View Brochure Link ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image12.png))</span></span>

<span data-ttu-id="a3dc7-169">[显示 "![类别" 手册 PDF](displaying-binary-data-in-the-data-web-controls-vb/_static/image8.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="a3dc7-169">[![The Category s Brochure PDF is Displayed](displaying-binary-data-in-the-data-web-controls-vb/_static/image8.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image13.png)</span></span>

<span data-ttu-id="a3dc7-170">**图 8**：显示了类别的手册 PDF （[单击以查看完全大小的图像](displaying-binary-data-in-the-data-web-controls-vb/_static/image14.png)）</span><span class="sxs-lookup"><span data-stu-id="a3dc7-170">**Figure 8**: The Category s Brochure PDF is Displayed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image14.png))</span></span>

## <a name="hiding-the-view-brochure-text-for-categories-without-a-brochure"></a><span data-ttu-id="a3dc7-171">隐藏没有手册的类别的查看小册子文本</span><span class="sxs-lookup"><span data-stu-id="a3dc7-171">Hiding the View Brochure Text for Categories Without a Brochure</span></span>

<span data-ttu-id="a3dc7-172">如图7所示，`BrochurePath` HyperLinkField 将显示所有记录的 `Text` 属性值（"查看小册子"），而不管是否有 `BrochurePath`的非`NULL` 值。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-172">As Figure 7 shows, the `BrochurePath` HyperLinkField displays its `Text` property value ( View Brochure ) for all records, regardless of whether there s a non-`NULL` value for `BrochurePath`.</span></span> <span data-ttu-id="a3dc7-173">当然，如果 `NULL``BrochurePath`，则链接将显示为 "仅文本"，与 "海鲜" 类别相同（请参阅图7）。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-173">Of course, if `BrochurePath` is `NULL`, then the link is displayed as text only, as is the case with the Seafood category (refer back to Figure 7).</span></span> <span data-ttu-id="a3dc7-174">如果没有显示文本视图小册子，则在没有 `BrochurePath` 值的情况下，不显示某些替代文本，如没有可用的小册子。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-174">Rather than displaying the text View Brochure, it might be nice to have those categories without a `BrochurePath` value display some alternate text, like No Brochure Available.</span></span>

<span data-ttu-id="a3dc7-175">为了提供此行为，我们需要使用 TemplateField，其内容是通过调用页面方法生成的，该方法基于 `BrochurePath` 值发出相应的输出。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-175">In order to provide this behavior, we need to use a TemplateField whose content is generated via a call to a page method that emits the appropriate output based on the `BrochurePath` value.</span></span> <span data-ttu-id="a3dc7-176">首先，我们将[使用 GridView 控件](../custom-formatting/using-templatefields-in-the-gridview-control-vb.md)教程中的 templatefield 来探索这种格式设置技术。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-176">We first explored this formatting technique back in the [Using TemplateFields in the GridView Control](../custom-formatting/using-templatefields-in-the-gridview-control-vb.md) tutorial.</span></span>

<span data-ttu-id="a3dc7-177">选择 `BrochurePath` HyperLinkField，然后单击 "编辑列" 对话框中的 "将此字段转换为 TemplateField" 链接，将 HyperLinkField 转换为 TemplateField。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-177">Turn the HyperLinkField into a TemplateField by selecting the `BrochurePath` HyperLinkField and then clicking on the Convert this field into a TemplateField link in the Edit Columns dialog box.</span></span>

![将 HyperLinkField 转换为 TemplateField](displaying-binary-data-in-the-data-web-controls-vb/_static/image9.gif)

<span data-ttu-id="a3dc7-179">**图 9**：将 HyperLinkField 转换为 TemplateField</span><span class="sxs-lookup"><span data-stu-id="a3dc7-179">**Figure 9**: Convert the HyperLinkField into a TemplateField</span></span>

<span data-ttu-id="a3dc7-180">这将创建一个具有 `ItemTemplate` 的 TemplateField，其中包含一个 `NavigateUrl` 属性绑定到 `BrochurePath` 值的超链接 Web 控件。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-180">This will create a TemplateField with an `ItemTemplate` that contains a HyperLink Web control whose `NavigateUrl` property is bound to the `BrochurePath` value.</span></span> <span data-ttu-id="a3dc7-181">将此标记替换为对方法的调用 `GenerateBrochureLink`，并传入 `BrochurePath`的值：</span><span class="sxs-lookup"><span data-stu-id="a3dc7-181">Replace this markup with a call to the method `GenerateBrochureLink`, passing in the value of `BrochurePath`:</span></span>

[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample2.aspx)]

<span data-ttu-id="a3dc7-182">接下来，在名为 `GenerateBrochureLink` 的 ASP.NET 页 s 代码隐藏类中创建一个 `Protected` 方法，该方法返回 `String`，并接受 `Object` 作为输入参数。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-182">Next, create a `Protected` method in the ASP.NET page s code-behind class named `GenerateBrochureLink` that returns a `String` and accepts an `Object` as an input parameter.</span></span>

[!code-vb[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample3.vb)]

<span data-ttu-id="a3dc7-183">此方法确定传入的 `Object` 值是否为数据库 `NULL` 如果是，则返回一条消息，指示该类别缺少一个手册。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-183">This method determines if the passed-in `Object` value is a database `NULL` and, if so, returns a message indicating that the category lacks a brochure.</span></span> <span data-ttu-id="a3dc7-184">否则，如果存在 `BrochurePath` 值，则它显示在超链接中。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-184">Otherwise, if there is a `BrochurePath` value, it s displayed in a hyperlink.</span></span> <span data-ttu-id="a3dc7-185">请注意，如果存在 `BrochurePath` 值，则将它传递到[`ResolveUrl(url)` 方法](https://msdn.microsoft.com/library/system.web.ui.control.resolveurl.aspx)中。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-185">Note that if the `BrochurePath` value is present it s passed into the [`ResolveUrl(url)` method](https://msdn.microsoft.com/library/system.web.ui.control.resolveurl.aspx).</span></span> <span data-ttu-id="a3dc7-186">此方法解析传入的*url*，并将 `~` 字符替换为适当的虚拟路径。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-186">This method resolves the passed-in *url*, replacing the `~` character with the appropriate virtual path.</span></span> <span data-ttu-id="a3dc7-187">例如，如果应用程序的根 `/Tutorial55`，`ResolveUrl("~/Brochures/Meats.pdf")` 将返回 `/Tutorial55/Brochures/Meat.pdf`。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-187">For example, if the application is rooted at `/Tutorial55`, `ResolveUrl("~/Brochures/Meats.pdf")` will return `/Tutorial55/Brochures/Meat.pdf`.</span></span>

<span data-ttu-id="a3dc7-188">图10显示了应用这些更改后的页面。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-188">Figure 10 shows the page after these changes have been applied.</span></span> <span data-ttu-id="a3dc7-189">请注意，"海鲜" 类别的 "`BrochurePath`" 字段现在显示文本 "无可用的内容"。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-189">Note that the Seafood category s `BrochurePath` field now displays the text No Brochure Available .</span></span>

<span data-ttu-id="a3dc7-190">[![没有手册的这些类别没有可用的文本](displaying-binary-data-in-the-data-web-controls-vb/_static/image10.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="a3dc7-190">[![The Text No Brochure Available is Displayed for Those Categories Without a Brochure](displaying-binary-data-in-the-data-web-controls-vb/_static/image10.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image15.png)</span></span>

<span data-ttu-id="a3dc7-191">**图 10**：没有手册的这些类别显示没有小册子的文本（[单击查看完全尺寸的图像](displaying-binary-data-in-the-data-web-controls-vb/_static/image16.png)）</span><span class="sxs-lookup"><span data-stu-id="a3dc7-191">**Figure 10**: The Text No Brochure Available is Displayed for Those Categories Without a Brochure ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image16.png))</span></span>

## <a name="step-3-adding-a-web-page-to-display-a-category-s-picture"></a><span data-ttu-id="a3dc7-192">步骤3：添加网页以显示类别的图片</span><span class="sxs-lookup"><span data-stu-id="a3dc7-192">Step 3: Adding a Web Page to Display a Category s Picture</span></span>

<span data-ttu-id="a3dc7-193">当用户访问 ASP.NET 页面时，他们将收到 ASP.NET 页的 HTML。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-193">When a user visits an ASP.NET page, they receive the ASP.NET page s HTML.</span></span> <span data-ttu-id="a3dc7-194">收到的 HTML 只是文本，不包含任何二进制数据。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-194">The received HTML is just text and does not contain any binary data.</span></span> <span data-ttu-id="a3dc7-195">任何附加的二进制数据（如图像、声音文件、Macromedia Flash 应用程序、嵌入的 Windows Media Player 视频等）都作为独立的资源存在于 web 服务器上。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-195">Any additional binary data, such as images, sound files, Macromedia Flash applications, embedded Windows Media Player videos, and so forth, exist as separate resources on the web server.</span></span> <span data-ttu-id="a3dc7-196">HTML 包含对这些文件的引用，但不包括文件的实际内容。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-196">The HTML contains references to these files, but does not include the actual contents of the files.</span></span>

<span data-ttu-id="a3dc7-197">例如，在 HTML 中，`<img>` 元素用于引用图片，`src` 属性指向图像文件，如下所示：</span><span class="sxs-lookup"><span data-stu-id="a3dc7-197">For example, in HTML the `<img>` element is used to reference a picture, with the `src` attribute pointing to the image file like so:</span></span>

[!code-html[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample4.html)]

<span data-ttu-id="a3dc7-198">当浏览器收到此 HTML 时，它会向 web 服务器发出另一个请求，以检索图像文件的二进制内容，然后在浏览器中显示该文件。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-198">When a browser receives this HTML, it makes another request to the web server to retrieve the binary contents of the image file, which it then displays in the browser.</span></span> <span data-ttu-id="a3dc7-199">相同的概念也适用于任何二进制数据。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-199">The same concept applies to any binary data.</span></span> <span data-ttu-id="a3dc7-200">在步骤2中，不会将小册子作为页的 HTML 标记的一部分发送到浏览器。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-200">In Step 2, the brochure was not sent down to the browser as part of the page s HTML markup.</span></span> <span data-ttu-id="a3dc7-201">所呈现的 HTML 提供的超链接，单击该超链接后，浏览器将直接请求 PDF 文档。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-201">Rather, the rendered HTML provided hyperlinks that, when clicked, caused the browser to request the PDF document directly.</span></span>

<span data-ttu-id="a3dc7-202">若要显示或允许用户下载驻留在数据库中的二进制数据，我们需要创建一个单独的网页来返回数据。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-202">To display or allow users to download binary data that resides within the database, we need to create a separate web page that returns the data.</span></span> <span data-ttu-id="a3dc7-203">对于我们的应用程序，只有一个二进制数据字段直接存储在数据库中类别的图片中。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-203">For our application, there s only one binary data field stored directly in the database the category s picture.</span></span> <span data-ttu-id="a3dc7-204">因此，我们需要一个页面，该页面在调用时返回特定类别的图像数据。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-204">Therefore, we need a page that, when called, returns the image data for a particular category.</span></span>

<span data-ttu-id="a3dc7-205">将新的 "ASP.NET" 页添加到名为 `DisplayCategoryPicture.aspx`的 `BinaryData` 文件夹。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-205">Add a new ASP.NET page to the `BinaryData` folder named `DisplayCategoryPicture.aspx`.</span></span> <span data-ttu-id="a3dc7-206">执行此操作时，请取消选中 "选择母版页" 复选框。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-206">When doing so, leave the Select master page checkbox unchecked.</span></span> <span data-ttu-id="a3dc7-207">此页需要 querystring 中的 `CategoryID` 值，并返回该类别 `Picture` 列的二进制数据。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-207">This page expects a `CategoryID` value in the querystring and returns the binary data of that category s `Picture` column.</span></span> <span data-ttu-id="a3dc7-208">由于此页面返回二进制数据而不是其他任何内容，因此在 HTML 部分中不需要任何标记。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-208">Since this page returns binary data and nothing else, it does not need any markup in the HTML section.</span></span> <span data-ttu-id="a3dc7-209">因此，请单击左下角的 "源" 选项卡，然后删除除 `<%@ Page %>` 指令之外的所有页标记。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-209">Therefore, click on the Source tab in the lower left corner and remove all of the page s markup except for the `<%@ Page %>` directive.</span></span> <span data-ttu-id="a3dc7-210">也就是说，`DisplayCategoryPicture.aspx` 的声明性标记应该包含一行：</span><span class="sxs-lookup"><span data-stu-id="a3dc7-210">That is, `DisplayCategoryPicture.aspx` s declarative markup should consist of a single line:</span></span>

[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample5.aspx)]

<span data-ttu-id="a3dc7-211">如果在 `<%@ Page %>` 指令中看到 `MasterPageFile` 属性，请将其删除。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-211">If you see the `MasterPageFile` attribute in the `<%@ Page %>` directive, remove it.</span></span>

<span data-ttu-id="a3dc7-212">在页的代码隐藏类中，将以下代码添加到 `Page_Load` 事件处理程序：</span><span class="sxs-lookup"><span data-stu-id="a3dc7-212">In the page s code-behind class, add the following code to the `Page_Load` event handler:</span></span>

[!code-vb[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample6.vb)]

<span data-ttu-id="a3dc7-213">此代码首先将 `CategoryID` querystring 值读入名为 `categoryID`的变量中。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-213">This code starts by reading in the `CategoryID` querystring value into a variable named `categoryID`.</span></span> <span data-ttu-id="a3dc7-214">接下来，通过调用 `CategoriesBLL` 类 `GetCategoryWithBinaryDataByCategoryID(categoryID)` 方法检索图片数据。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-214">Next, the picture data is retrieved via a call to the `CategoriesBLL` class s `GetCategoryWithBinaryDataByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="a3dc7-215">此数据通过使用 `Response.BinaryWrite(data)` 方法返回到客户端，但在调用此之前，必须删除 `Picture` 的列值 s OLE 标头。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-215">This data is returned to the client by using the `Response.BinaryWrite(data)` method, but before this is called, the `Picture` column value s OLE header must be removed.</span></span> <span data-ttu-id="a3dc7-216">这是通过创建一个名为 `strippedImageData` 的 `Byte` 数组来完成的，该数组78包含的字符数要小于 `Picture` 列中的字符。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-216">This is accomplished by creating a `Byte` array named `strippedImageData` that will hold precisely 78 characters less than what is in the `Picture` column.</span></span> <span data-ttu-id="a3dc7-217">[`Array.Copy` 方法](https://msdn.microsoft.com/library/z50k9bft.aspx)用于将数据从位置78开始复制到 `strippedImageData`的 `category.Picture`。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-217">The [`Array.Copy` method](https://msdn.microsoft.com/library/z50k9bft.aspx) is used to copy the data from `category.Picture` starting at position 78 over to `strippedImageData`.</span></span>

<span data-ttu-id="a3dc7-218">`Response.ContentType` 属性指定要返回的内容的[MIME 类型](http://en.wikipedia.org/wiki/MIME)，以便浏览器知道如何呈现内容。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-218">The `Response.ContentType` property specifies the [MIME type](http://en.wikipedia.org/wiki/MIME) of the content being returned so that the browser knows how to render it.</span></span> <span data-ttu-id="a3dc7-219">由于 `Categories` 表 s `Picture` 列是位图图像，此处使用位图 MIME 类型（image/bmp）。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-219">Since the `Categories` table s `Picture` column is a bitmap image, the bitmap MIME type is used here (image/bmp).</span></span> <span data-ttu-id="a3dc7-220">如果省略 MIME 类型，则大多数浏览器仍然会正确显示图像，因为它们可以根据图像文件的二进制数据的内容来推断类型。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-220">If you omit the MIME type, most browsers will still display the image correctly because they can infer the type based on the contents of the image file s binary data.</span></span> <span data-ttu-id="a3dc7-221">但是，尽可能包含 MIME 类型是明智的。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-221">However, it s prudent to include the MIME type when possible.</span></span> <span data-ttu-id="a3dc7-222">有关[MIME 媒体类型](http://www.iana.org/assignments/media-types/)的完整列表，请参阅[Internet 编号分配机构的网站](http://www.iana.org/)。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-222">See the [Internet Assigned Numbers Authority s website](http://www.iana.org/) for a complete listing of [MIME media types](http://www.iana.org/assignments/media-types/).</span></span>

<span data-ttu-id="a3dc7-223">创建此页面后，可以通过访问 `DisplayCategoryPicture.aspx?CategoryID=categoryID`查看特定类别的图片。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-223">With this page created, a particular category s picture can be viewed by visiting `DisplayCategoryPicture.aspx?CategoryID=categoryID`.</span></span> <span data-ttu-id="a3dc7-224">图11显示了饮料类别的图片，可以从 `DisplayCategoryPicture.aspx?CategoryID=1`进行查看。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-224">Figure 11 shows the Beverages category s picture, which can be viewed from `DisplayCategoryPicture.aspx?CategoryID=1`.</span></span>

<span data-ttu-id="a3dc7-225">[显示 "饮料" 类别的图片 ![](displaying-binary-data-in-the-data-web-controls-vb/_static/image11.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="a3dc7-225">[![The Beverages Category s Picture is Displayed](displaying-binary-data-in-the-data-web-controls-vb/_static/image11.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image17.png)</span></span>

<span data-ttu-id="a3dc7-226">**图 11**：显示饮料类别的图片（[单击以查看完全尺寸的图像](displaying-binary-data-in-the-data-web-controls-vb/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="a3dc7-226">**Figure 11**: The Beverages Category s Picture is Displayed ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image18.png))</span></span>

<span data-ttu-id="a3dc7-227">如果在访问 `DisplayCategoryPicture.aspx?CategoryID=categoryID`时，你将收到一个异常，该异常读取无法将类型为 "system.string" 的对象转换为类型 "system.string []"，这可能会导致这种情况。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-227">If, when visiting `DisplayCategoryPicture.aspx?CategoryID=categoryID`, you get an exception that reads Unable to cast object of type 'System.DBNull' to type 'System.Byte[]', there are two things that may be causing this.</span></span> <span data-ttu-id="a3dc7-228">首先，`Categories` 表 s `Picture` 列允许 `NULL` 值。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-228">First, the `Categories` table s `Picture` column does allow `NULL` values.</span></span> <span data-ttu-id="a3dc7-229">但 `DisplayCategoryPicture.aspx` 页假定存在一个非`NULL` 值。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-229">The `DisplayCategoryPicture.aspx` page, however, assumes there is a non-`NULL` value present.</span></span> <span data-ttu-id="a3dc7-230">如果 `CategoriesDataTable` 具有 `NULL` 值，则无法直接访问该的 `Picture` 属性。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-230">The `Picture` property of the `CategoriesDataTable` cannot be directly accessed if it has a `NULL` value.</span></span> <span data-ttu-id="a3dc7-231">如果确实要为 `Picture` 列允许 `NULL` 值，则需要包含以下条件：</span><span class="sxs-lookup"><span data-stu-id="a3dc7-231">If you do want to allow `NULL` values for the `Picture` column, you d want to include the following condition:</span></span>

[!code-vb[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample7.vb)]

<span data-ttu-id="a3dc7-232">上面的代码假定在 `Images` 文件夹中有一个名为 `NoPictureAvailable.gif` 的图像文件，需要在没有图片的情况下为这些类别显示。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-232">The above code assumes that there s some image file named `NoPictureAvailable.gif` in the `Images` folder that you want to display for those categories without a picture.</span></span>

<span data-ttu-id="a3dc7-233">如果 `GetCategoryWithBinaryDataByCategoryID` 方法的 `CategoriesTableAdapter` `SELECT` 语句已恢复到主查询的列列表，则也可能会导致此异常，如果您使用的是即席 SQL 语句，并为 TableAdapter s 主查询重新运行向导，则可能会发生这种情况。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-233">This exception could also be caused if the `CategoriesTableAdapter` s `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement has reverted back to the main query s column list, which can happen if you are using ad-hoc SQL statements and you ve re-run the wizard for the TableAdapter s main query.</span></span> <span data-ttu-id="a3dc7-234">检查以确保 `GetCategoryWithBinaryDataByCategoryID` 方法 s `SELECT` 语句仍包含 `Picture` 列。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-234">Check to ensure that `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement still includes the `Picture` column.</span></span>

> [!NOTE]
> <span data-ttu-id="a3dc7-235">每次访问 `DisplayCategoryPicture.aspx` 时，都将访问数据库并返回指定的类别的图片数据。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-235">Every time the `DisplayCategoryPicture.aspx` is visited, the database is accessed and the specified category s picture data is returned.</span></span> <span data-ttu-id="a3dc7-236">如果类别的图片自从用户最后一次查看后没有发生更改，则会浪费精力。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-236">If the category s picture hasn't changed since the user has last viewed it, though, this is wasted effort.</span></span> <span data-ttu-id="a3dc7-237">幸运的是，HTTP 允许*条件性获取*。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-237">Fortunately, HTTP allows for *conditional GETs*.</span></span> <span data-ttu-id="a3dc7-238">使用条件 GET 时，发出 HTTP 请求的客户端将发送[`If-Modified-Since` http 标头，该标头](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html)提供客户端上次从 web 服务器检索该资源的日期和时间。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-238">With a conditional GET, the client making the HTTP request sends along an [`If-Modified-Since` HTTP header](http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html) that provides the date and time the client last retrieved this resource from the web server.</span></span> <span data-ttu-id="a3dc7-239">如果自指定日期起，内容未更改，则 web 服务器可能会使用[未修改的状态代码（304）](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)进行响应，并且放弃将回发请求的资源 s 内容。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-239">If the content has not changed since this specified date, the web server may respond with a [Not Modified status code (304)](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html) and forgo sending back the requested resource s content.</span></span> <span data-ttu-id="a3dc7-240">简而言之，此方法使 web 服务器不需要在客户端上次访问资源后对其发送回内容。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-240">In short, this technique relieves the web server from having to send back content for a resource if it has not been modified since the client last accessed it.</span></span>

<span data-ttu-id="a3dc7-241">但是，若要实现此行为，要求您将 `PictureLastModified` 列添加到 `Categories` 表中，以便在上一次更新 `Picture` 列时进行捕获，以及检查 `If-Modified-Since` 标头的代码。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-241">To implement this behavior, however, requires that you add a `PictureLastModified` column to the `Categories` table to capture when the `Picture` column was last updated as well as code to check for the `If-Modified-Since` header.</span></span> <span data-ttu-id="a3dc7-242">有关 `If-Modified-Since` 标头和条件获取工作流的详细信息，请参阅[RSS 黑客的 Http 条件 get](http://fishbowl.pastiche.org/2002/10/21/http_conditional_get_for_rss_hackers) ，并[深入了解如何在 ASP.NET 页中执行 http 请求](http://aspnet.4guysfromrolla.com/articles/122204-1.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-242">For more information on the `If-Modified-Since` header and the conditional GET workflow, see [HTTP Conditional GET for RSS Hackers](http://fishbowl.pastiche.org/2002/10/21/http_conditional_get_for_rss_hackers) and [A Deeper Look at Performing HTTP Requests in an ASP.NET Page](http://aspnet.4guysfromrolla.com/articles/122204-1.aspx).</span></span>

## <a name="step-4-displaying-the-category-pictures-in-a-gridview"></a><span data-ttu-id="a3dc7-243">步骤4：在 GridView 中显示类别图片</span><span class="sxs-lookup"><span data-stu-id="a3dc7-243">Step 4: Displaying the Category Pictures in a GridView</span></span>

<span data-ttu-id="a3dc7-244">现在，我们有了一个显示特定类别图片的网页，可以使用[图像 web 控件](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/image.aspx)或指向 `DisplayCategoryPicture.aspx?CategoryID=categoryID`的 HTML `<img>` 元素来显示它。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-244">Now that we have a web page to display a particular category s picture, we can display it using the [Image Web control](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/image.aspx) or an HTML `<img>` element pointing to `DisplayCategoryPicture.aspx?CategoryID=categoryID`.</span></span> <span data-ttu-id="a3dc7-245">其 URL 由数据库数据确定的映像可以使用 ImageField 在 GridView 或 DetailsView 中显示。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-245">Images whose URL is determined by database data can be displayed in the GridView or DetailsView using the ImageField.</span></span> <span data-ttu-id="a3dc7-246">ImageField 包含 `DataImageUrlField` 和 `DataImageUrlFormatString` 属性，这些属性的工作方式类似于 HyperLinkField `DataNavigateUrlFields` 和 `DataNavigateUrlFormatString` 属性。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-246">The ImageField contains `DataImageUrlField` and `DataImageUrlFormatString` properties that work like the HyperLinkField s `DataNavigateUrlFields` and `DataNavigateUrlFormatString` properties.</span></span>

<span data-ttu-id="a3dc7-247">让我们通过添加 ImageField 来显示每个类别的图片，从而增加 `DisplayOrDownloadData.aspx` 中的 `Categories` GridView。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-247">Let s augment the `Categories` GridView in `DisplayOrDownloadData.aspx` by adding an ImageField to show each category s picture.</span></span> <span data-ttu-id="a3dc7-248">只需添加 ImageField，并将其 `DataImageUrlField` 和 `DataImageUrlFormatString` 属性分别设置为 `CategoryID` 和 `DisplayCategoryPicture.aspx?CategoryID={0}`。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-248">Simply add the ImageField and set its `DataImageUrlField` and `DataImageUrlFormatString` properties to `CategoryID` and `DisplayCategoryPicture.aspx?CategoryID={0}`, respectively.</span></span> <span data-ttu-id="a3dc7-249">这将创建一个 GridView 列，用于呈现一个 `<img>` 元素，该元素的 `src` 属性引用 `DisplayCategoryPicture.aspx?CategoryID={0}`，其中 {0} 被替换为 GridView 行 `CategoryID` 值。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-249">This will create a GridView column that renders an `<img>` element whose `src` attribute references `DisplayCategoryPicture.aspx?CategoryID={0}`, where {0} is replaced with the GridView row s `CategoryID` value.</span></span>

![向 GridView 添加 ImageField](displaying-binary-data-in-the-data-web-controls-vb/_static/image12.gif)

<span data-ttu-id="a3dc7-251">**图 12**：向 GridView 添加 ImageField</span><span class="sxs-lookup"><span data-stu-id="a3dc7-251">**Figure 12**: Add an ImageField to the GridView</span></span>

<span data-ttu-id="a3dc7-252">添加 ImageField 后，GridView 的声明性语法应该如下所示：</span><span class="sxs-lookup"><span data-stu-id="a3dc7-252">After adding the ImageField, your GridView s declarative syntax should look like soothe following:</span></span>

[!code-aspx[Main](displaying-binary-data-in-the-data-web-controls-vb/samples/sample8.aspx)]

<span data-ttu-id="a3dc7-253">请花点时间查看浏览器中的此页。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-253">Take a moment to view this page through a browser.</span></span> <span data-ttu-id="a3dc7-254">请注意每条记录现在如何包含类别的图片。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-254">Note how each record now includes a picture for the category.</span></span>

<span data-ttu-id="a3dc7-255">[![为每行显示类别的图片](displaying-binary-data-in-the-data-web-controls-vb/_static/image13.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="a3dc7-255">[![The Category s Picture is Displayed for Each Row](displaying-binary-data-in-the-data-web-controls-vb/_static/image13.gif)](displaying-binary-data-in-the-data-web-controls-vb/_static/image19.png)</span></span>

<span data-ttu-id="a3dc7-256">**图 13**：为每行显示类别的图片（[单击查看完全尺寸的图像](displaying-binary-data-in-the-data-web-controls-vb/_static/image20.png)）</span><span class="sxs-lookup"><span data-stu-id="a3dc7-256">**Figure 13**: The Category s Picture is Displayed for Each Row ([Click to view full-size image](displaying-binary-data-in-the-data-web-controls-vb/_static/image20.png))</span></span>

## <a name="summary"></a><span data-ttu-id="a3dc7-257">摘要</span><span class="sxs-lookup"><span data-stu-id="a3dc7-257">Summary</span></span>

<span data-ttu-id="a3dc7-258">在本教程中，我们介绍了如何提供二进制数据。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-258">In this tutorial we examined how to present binary data.</span></span> <span data-ttu-id="a3dc7-259">数据的显示方式取决于数据的类型。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-259">How the data is presented depends on the type of data.</span></span> <span data-ttu-id="a3dc7-260">对于 PDF 手册文件，我们向用户提供了一个 View 宣传册链接，单击该链接后，用户就可以直接使用 PDF 文件。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-260">For the PDF brochure files, we offered the user a View Brochure link that, when clicked, took the user directly to the PDF file.</span></span> <span data-ttu-id="a3dc7-261">对于 "类别" 图，我们首先创建了一个页面，用于检索和返回数据库中的二进制数据，然后使用该页面显示 GridView 中的每个类别图片。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-261">For the category s picture, we first created a page to retrieve and return the binary data from the database and then used that page to display each category s picture in a GridView.</span></span>

<span data-ttu-id="a3dc7-262">现在，我们已经介绍了如何显示二进制数据，接下来可以检查如何针对数据库执行插入、更新和删除操作。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-262">Now that we ve looked at how to display binary data, we re ready to examine how to perform insert, updates, and deletes against the database with the binary data.</span></span> <span data-ttu-id="a3dc7-263">在下一教程中，我们将介绍如何将上传的文件与相应的数据库记录相关联。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-263">In the next tutorial we'll look at how to associate an uploaded file with its corresponding database record.</span></span> <span data-ttu-id="a3dc7-264">在本教程中，我们将了解如何更新现有的二进制数据，以及如何在删除其关联的记录时删除二进制数据。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-264">In the tutorial after that, we'll see how to update existing binary data as well as how to delete the binary data when its associated record is removed.</span></span>

<span data-ttu-id="a3dc7-265">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="a3dc7-265">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="a3dc7-266">关于作者</span><span class="sxs-lookup"><span data-stu-id="a3dc7-266">About the Author</span></span>

<span data-ttu-id="a3dc7-267">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，创始人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已在使用 Microsoft Web 技术，自1998开始。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-267">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="a3dc7-268">Scott 的工作方式是独立的顾问、培训师和撰稿人。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-268">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="a3dc7-269">他的最新书籍是，[*在24小时内，sam ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-269">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="a3dc7-270">可以[mitchell@4GuysFromRolla.com访问。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a3dc7-270">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="a3dc7-271">或通过他的博客，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-271">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="a3dc7-272">特别感谢</span><span class="sxs-lookup"><span data-stu-id="a3dc7-272">Special Thanks To</span></span>

<span data-ttu-id="a3dc7-273">此教程系列由许多有用的审阅者查看。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-273">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="a3dc7-274">本教程的主管评审者是 Teresa Murphy 和 Dave Gardner。</span><span class="sxs-lookup"><span data-stu-id="a3dc7-274">Lead reviewers for this tutorial were Teresa Murphy and Dave Gardner.</span></span> <span data-ttu-id="a3dc7-275">想要查看我即将发布的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="a3dc7-275">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="a3dc7-276">如果是这样，请在mitchell@4GuysFromRolla.com放置一行[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a3dc7-276">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="a3dc7-277">[上一页](uploading-files-vb.md)
> [下一页](including-a-file-upload-option-when-adding-a-new-record-vb.md)</span><span class="sxs-lookup"><span data-stu-id="a3dc7-277">[Previous](uploading-files-vb.md)
[Next](including-a-file-upload-option-when-adding-a-new-record-vb.md)</span></span>
