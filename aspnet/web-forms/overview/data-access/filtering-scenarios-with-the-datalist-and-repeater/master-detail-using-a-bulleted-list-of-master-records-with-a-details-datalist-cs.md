---
uid: web-forms/overview/data-access/filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs
title: 使用带有详细信息 DataList （C#）的主记录的项目符号列表的母版/详细信息 |Microsoft Docs
author: rick-anderson
description: 在本教程中，我们将上一教程的两页主/从报表压缩为一个页面，并在 t 。
ms.author: riande
ms.date: 10/17/2006
ms.assetid: c727bb73-7b59-41a1-8dc3-623c6d69e7c2
msc.legacyurl: /web-forms/overview/data-access/filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs
msc.type: authoredcontent
ms.openlocfilehash: 4549ab8e64599b09c300c158bedfd5d85efafc4d
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/06/2020
ms.locfileid: "78490964"
---
# <a name="masterdetail-using-a-bulleted-list-of-master-records-with-a-details-datalist-c"></a><span data-ttu-id="4bc5c-103">通过详细信息 DataList 使用母版记录项目符号列表的母版/详细信息 (C#)</span><span class="sxs-lookup"><span data-stu-id="4bc5c-103">Master/Detail Using a Bulleted List of Master Records with a Details DataList (C#)</span></span>

<span data-ttu-id="4bc5c-104">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="4bc5c-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="4bc5c-105">[下载示例应用](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_35_CS.exe)或[下载 PDF](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/datatutorial35cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="4bc5c-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_35_CS.exe) or [Download PDF](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/datatutorial35cs1.pdf)</span></span>

> <span data-ttu-id="4bc5c-106">在本教程中，我们将上一教程的两页主/从报表压缩为一个页面，并在屏幕的左侧显示类别名称的项目符号列表，并在屏幕的右侧显示所选类别的产品。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-106">In this tutorial we'll compress the two-page master/detail report of the previous tutorial into a single page, showing a bulleted list of category names on the left side of the screen and the selected category's products on the right of the screen.</span></span>

## <a name="introduction"></a><span data-ttu-id="4bc5c-107">简介</span><span class="sxs-lookup"><span data-stu-id="4bc5c-107">Introduction</span></span>

<span data-ttu-id="4bc5c-108">在[前面的教程](master-detail-filtering-acess-two-pages-datalist-cs.md)中，我们介绍了如何在两个页面之间分隔主/详细信息报表。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-108">In the [preceding tutorial](master-detail-filtering-acess-two-pages-datalist-cs.md) we looked at how to separate a master/detail report across two pages.</span></span> <span data-ttu-id="4bc5c-109">在母版页中，我们使用了中继器控件来呈现类别的项目符号列表。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-109">In the master page we used a Repeater control to render a bulleted list of categories.</span></span> <span data-ttu-id="4bc5c-110">每个类别名称都是一个超链接，单击该超链接时，会将用户转到详细信息页，其中两列 DataList 显示属于所选类别的产品。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-110">Each category name was a hyperlink that, when clicked, would take the user to the details page, where a two-column DataList showed those products belonging to the selected category.</span></span>

<span data-ttu-id="4bc5c-111">在本教程中，我们会将两页教程压缩为一个页面，并在屏幕的左侧显示类别名称的项目符号列表，每个类别名称呈现为 LinkButton。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-111">In this tutorial we'll compress the two-page tutorial into a single page, showing a bulleted list of category names on the left side of the screen with each category name rendered as a LinkButton.</span></span> <span data-ttu-id="4bc5c-112">单击其中一个类别名称 LinkButtons 会引发回发，并将所选类别的产品绑定到屏幕右侧的两列 DataList。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-112">Clicking one of the category name LinkButtons induces a postback and binds the selected category s products to a two-column DataList on the right of the screen.</span></span> <span data-ttu-id="4bc5c-113">除了显示每个类别的名称外，左侧的中继器还显示给定类别的总产品数（参见图1）。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-113">In addition to displaying each category s name, the Repeater on the left shows how many total products there are for a given category (see Figure 1).</span></span>

<span data-ttu-id="4bc5c-114">[![类别的名称和产品总数显示在左侧](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image2.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="4bc5c-114">[![The Category s Name and Total Number of Products are Displayed on the Left](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image2.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image1.png)</span></span>

<span data-ttu-id="4bc5c-115">**图 1**：类别的名称和产品总数显示在左侧（[单击以查看完全大小的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="4bc5c-115">**Figure 1**: The Category s Name and Total Number of Products are Displayed on the Left ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image3.png))</span></span>

## <a name="step-1-displaying-a-repeater-in-the-left-portion-of-the-screen"></a><span data-ttu-id="4bc5c-116">步骤1：在屏幕左边部分显示中继器</span><span class="sxs-lookup"><span data-stu-id="4bc5c-116">Step 1: Displaying a Repeater in the Left Portion of the Screen</span></span>

<span data-ttu-id="4bc5c-117">对于本教程，我们需要在所选类别的产品左侧显示类别的项目符号列表。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-117">For this tutorial we need to have the bulleted list of categories appear to the left of the selected category s products.</span></span> <span data-ttu-id="4bc5c-118">网页中的内容可以使用标准 HTML 元素的段落标记、非换行空格、`<table>` s 等或通过级联样式表（CSS）技术进行定位。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-118">Content within a web page can be positioned using standard HTML elements paragraph tags, non-breaking spaces, `<table>` s, and so on or through cascading stylesheet (CSS) techniques.</span></span> <span data-ttu-id="4bc5c-119">到目前为止，我们的所有教程都使用了 CSS 技术进行定位。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-119">All of our tutorials thus far have used CSS techniques for positioning.</span></span> <span data-ttu-id="4bc5c-120">当我们在母版页中的母版页[和站点导航](../introduction/master-pages-and-site-navigation-cs.md)教程中生成导航用户界面时，我们使用了*绝对定位*，指示导航列表和主要内容的精确像素偏移量。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-120">When we built the navigation user interface in our master page in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial we used *absolute positioning*, indicating the precise pixel offset for the navigation list and the main content.</span></span> <span data-ttu-id="4bc5c-121">此外，CSS 还可以用于通过*浮动*将一个元素定位到另一个元素的右侧或左侧。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-121">Alternatively, CSS can be used to position one element to the right or left of another through *floating*.</span></span> <span data-ttu-id="4bc5c-122">对于所选类别的产品，我们可以将项目符号列表显示在所选类别的产品左侧</span><span class="sxs-lookup"><span data-stu-id="4bc5c-122">We can have the bulleted list of categories appear to the left of the selected category s products by floating the Repeater to the left of the DataList</span></span>

<span data-ttu-id="4bc5c-123">从 `DataListRepeaterFiltering` 文件夹打开 "`CategoriesAndProducts.aspx`" 页，并向该页添加一个 Repeater 和一个 DataList。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-123">Open the `CategoriesAndProducts.aspx` page from the `DataListRepeaterFiltering` folder and add to the page a Repeater and a DataList.</span></span> <span data-ttu-id="4bc5c-124">将中继站 `ID` 设置为 "`Categories`"，并将 "DataList" 设置为 "`CategoryProducts`"。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-124">Set the Repeater s `ID` to `Categories` and the DataList s to `CategoryProducts`.</span></span> <span data-ttu-id="4bc5c-125">中转到源视图，将 Repeater 和 DataList 控件放在其自己的 `<div>` 元素中。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-125">Go to the Source view and put the Repeater and DataList controls within their own `<div>` elements.</span></span> <span data-ttu-id="4bc5c-126">也就是说，在中继器之后直接在 `<div>` 元素内包含 Repeater，然后在其自己的 `<div>` 元素中包含 DataList。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-126">That is, enclose the Repeater within a `<div>` element first and then the DataList in its own `<div>` element directly after the Repeater.</span></span> <span data-ttu-id="4bc5c-127">此时，你的标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="4bc5c-127">Your markup at this point should look similar to the following:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample1.aspx)]

<span data-ttu-id="4bc5c-128">若要将中继器浮动到 DataList 的左侧，需要使用 `float` CSS 样式属性，如下所示：</span><span class="sxs-lookup"><span data-stu-id="4bc5c-128">To float the Repeater to the left of the DataList, we need to use the `float` CSS style attribute, like so:</span></span>

[!code-html[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample2.html)]

<span data-ttu-id="4bc5c-129">`float: left;` 将第一个 `<div>` 元素左移到第二个元素的左侧。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-129">The `float: left;` floats the first `<div>` element to the left of the second one.</span></span> <span data-ttu-id="4bc5c-130">"`width`" 和 "`padding-right`" 设置指示第一个 `<div>` `width` 以及在 "`<div>`" 元素的 "内容" 和 "右" 边距之间添加多少填充。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-130">The `width` and `padding-right` settings indicate the first `<div>` s `width` and how much padding is added between the `<div>` element s content and its right margin.</span></span> <span data-ttu-id="4bc5c-131">有关 CSS 中的浮动元素的详细信息，请参阅[Floatutorial](http://css.maxdesign.com.au/floatutorial/)。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-131">For more information on floating elements in CSS check out the [Floatutorial](http://css.maxdesign.com.au/floatutorial/).</span></span>

<span data-ttu-id="4bc5c-132">不是直接通过第一个 `<p>` 元素的 `style` 属性来指定样式设置，而是在名为 `FloatLeft`的 `Styles.css` 中创建一个新的 CSS 类：</span><span class="sxs-lookup"><span data-stu-id="4bc5c-132">Rather than specify the style setting directly through the first `<p>` element s `style` attribute, let s instead create a new CSS class in `Styles.css` named `FloatLeft`:</span></span>

[!code-css[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample3.css)]

<span data-ttu-id="4bc5c-133">然后，可以将 `<div>` 替换为 `<div class="FloatLeft">`。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-133">Then we can replace the `<div>` with `<div class="FloatLeft">`.</span></span>

<span data-ttu-id="4bc5c-134">添加 CSS 类并在 `CategoriesAndProducts.aspx` "页中配置标记后，请切换到设计器。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-134">After adding the CSS class and configuring the markup in the `CategoriesAndProducts.aspx` page, go to the Designer.</span></span> <span data-ttu-id="4bc5c-135">你应会看到浮动在 DataList 左侧的中继器（尽管现在这两个对话框只显示为灰色框，因为我们尚未配置其数据源或模板）。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-135">You should see the Repeater floating to the left of the DataList (although right now both just appear as gray boxes since we ve yet to configure their data sources or templates).</span></span>

<span data-ttu-id="4bc5c-136">[![，Repeater 将浮动到 DataList 的左侧](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image5.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="4bc5c-136">[![The Repeater is Floated to the Left of the DataList](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image5.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image4.png)</span></span>

<span data-ttu-id="4bc5c-137">**图 2**：中继器在 DataList 的左侧浮动（[单击以查看完全大小的映像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="4bc5c-137">**Figure 2**: The Repeater is Floated to the Left of the DataList ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image6.png))</span></span>

## <a name="step-2-determining-the-number-of-products-for-each-category"></a><span data-ttu-id="4bc5c-138">步骤2：确定每个类别的产品数量</span><span class="sxs-lookup"><span data-stu-id="4bc5c-138">Step 2: Determining the Number of Products for Each Category</span></span>

<span data-ttu-id="4bc5c-139">标记和 DataList 的标记完成后，我们就可以将类别数据绑定到 Repeater 控件了。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-139">With the Repeater and DataList s surrounding markup complete, we re ready to bind the category data to the Repeater control.</span></span> <span data-ttu-id="4bc5c-140">但是，如图1中的类别的项目符号列表所示，除了每个类别的名称，还需要显示与该类别关联的产品的数量。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-140">However, as the bulleted list of categories in Figure 1 shows, in addition to each category s name we also need to display the number of products associated with the category.</span></span> <span data-ttu-id="4bc5c-141">若要访问此信息，可以：</span><span class="sxs-lookup"><span data-stu-id="4bc5c-141">To access this information we can either:</span></span>

- <span data-ttu-id="4bc5c-142">**从 ASP.NET 页 s 代码隐藏类中确定此信息。**</span><span class="sxs-lookup"><span data-stu-id="4bc5c-142">**Determine this information from the ASP.NET page s code-behind class.**</span></span> <span data-ttu-id="4bc5c-143">对于特定 *`categoryID`* ，可以通过调用 `ProductsBLL` 类的 `GetProductsByCategoryID(categoryID)` 方法来确定关联的产品数。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-143">Given a particular *`categoryID`* we can determine the number of associated products by calling the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="4bc5c-144">此方法将返回一个 `ProductsDataTable` 对象，该对象的 `Count` 属性指示存在多少 `ProductsRow`，即指定 *`categoryID`* 的产品数。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-144">This method returns a `ProductsDataTable` object whose `Count` property indicates how many `ProductsRow` s exists, which is the number of products for the specified *`categoryID`*.</span></span> <span data-ttu-id="4bc5c-145">我们可以为中继器创建 `ItemDataBound` 事件处理程序，对于绑定到中继器的每个类别，将调用 `ProductsBLL` 类 s `GetProductsByCategoryID(categoryID)` 方法，并在输出中包含其计数。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-145">We can create an `ItemDataBound` event handler for the Repeater that, for each category bound to the Repeater, calls the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method and includes its count in the output.</span></span>
- <span data-ttu-id="4bc5c-146">**更新类型化数据集中的 `CategoriesDataTable` 以包含 `NumberOfProducts` 列。**</span><span class="sxs-lookup"><span data-stu-id="4bc5c-146">**Update the `CategoriesDataTable` in the Typed DataSet to include a `NumberOfProducts` column.**</span></span> <span data-ttu-id="4bc5c-147">然后，可以更新 `CategoriesDataTable` 中的 `GetCategories()` 方法以包含此信息，或将 `GetCategories()` 保留原样，并创建名为 `GetCategoriesAndNumberOfProducts()`的新 `CategoriesDataTable` 方法。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-147">We can then update the `GetCategories()` method in the `CategoriesDataTable` to include this information or, alternatively, leave `GetCategories()` as-is and create a new `CategoriesDataTable` method called `GetCategoriesAndNumberOfProducts()`.</span></span>

<span data-ttu-id="4bc5c-148">让我们来浏览这两种方法。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-148">Let s explore both of these techniques.</span></span> <span data-ttu-id="4bc5c-149">第一种方法更容易实现，因为我们不需要更新数据访问层;但是，它需要更多与数据库的通信。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-149">The first approach is simpler to implement since we don t need to update the Data Access Layer; however, it requires more communications with the database.</span></span> <span data-ttu-id="4bc5c-150">在 `ItemDataBound` 事件处理程序中对 `ProductsBLL` 类 s `GetProductsByCategoryID(categoryID)` 方法的调用为中继器中显示的每个类别添加了额外的数据库调用。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-150">The call to the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method in the `ItemDataBound` event handler adds an extra database call for each category displayed in the Repeater.</span></span> <span data-ttu-id="4bc5c-151">采用此方法时，有*n* + 1 个数据库调用，其中*N*是 Repeater 中显示的类别数。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-151">With this technique there are *N* + 1 database calls, where *N* is the number of categories displayed in the Repeater.</span></span> <span data-ttu-id="4bc5c-152">对于第二种方法，将返回产品计数，其中包含来自 `CategoriesBLL` 类 `GetCategories()` （或 `GetCategoriesAndNumberOfProducts()`）方法的每个类别的信息，因此只需一次处理数据库。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-152">With the second approach, the product count is returned with information about each category from the `CategoriesBLL` class s `GetCategories()` (or `GetCategoriesAndNumberOfProducts()`) method, thereby resulting in just one trip to the database.</span></span>

## <a name="determining-the-number-of-products-in-the-itemdatabound-event-handler"></a><span data-ttu-id="4bc5c-153">确定 ItemDataBound 事件处理程序中的产品数</span><span class="sxs-lookup"><span data-stu-id="4bc5c-153">Determining the Number of Products in the ItemDataBound Event Handler</span></span>

<span data-ttu-id="4bc5c-154">在 Repeater `ItemDataBound` 事件处理程序中确定每个类别的产品数量并不需要对现有的数据访问层进行任何修改。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-154">Determining the number of products for each category in the Repeater s `ItemDataBound` event handler does not require any modifications to our existing Data Access Layer.</span></span> <span data-ttu-id="4bc5c-155">所有修改都可以直接在 "`CategoriesAndProducts.aspx`" 页中进行。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-155">All modifications can be made directly within the `CategoriesAndProducts.aspx` page.</span></span> <span data-ttu-id="4bc5c-156">首先通过中继器 s 智能标记添加一个名为 `CategoriesDataSource` 的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-156">Start by adding a new ObjectDataSource named `CategoriesDataSource` via the Repeater s smart tag.</span></span> <span data-ttu-id="4bc5c-157">接下来，配置 `CategoriesDataSource` ObjectDataSource，使其从 `CategoriesBLL` 类 s `GetCategories()` 方法检索其数据。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-157">Next, configure the `CategoriesDataSource` ObjectDataSource so that it retrieves its data from the `CategoriesBLL` class s `GetCategories()` method.</span></span>

<span data-ttu-id="4bc5c-158">[![将 ObjectDataSource 配置为使用 CategoriesBLL class s GetCategories （）方法](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image8.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="4bc5c-158">[![Configure the ObjectDataSource to Use the CategoriesBLL class s GetCategories() Method](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image8.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image7.png)</span></span>

<span data-ttu-id="4bc5c-159">**图 3**：将 ObjectDataSource 配置为使用 `CategoriesBLL` 类 `GetCategories()` 方法（[单击以查看完全大小的映像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="4bc5c-159">**Figure 3**: Configure the ObjectDataSource to Use the `CategoriesBLL` class s `GetCategories()` Method ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image9.png))</span></span>

<span data-ttu-id="4bc5c-160">`Categories` Repeater 中的每一项都需要是可单击的，单击此项时，将导致 `CategoryProducts` DataList 显示选定类别的产品。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-160">Each item in the `Categories` Repeater needs to be clickable and, when clicked, cause the `CategoryProducts` DataList to display those products for the selected category.</span></span> <span data-ttu-id="4bc5c-161">这可以通过以下方式实现：将每个类别设为超链接，链接回此相同页面（`CategoriesAndProducts.aspx`），但将 `CategoryID` 传递到查询字符串，就像我们在上一教程中看到的那样。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-161">This can be accomplished by making each category a hyperlink, linking back to this same page (`CategoriesAndProducts.aspx`), but passing the `CategoryID` through the querystring, much like we saw in the previous tutorial.</span></span> <span data-ttu-id="4bc5c-162">此方法的优点是，可以通过搜索引擎将显示特定类别产品的页面加入书签并进行索引。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-162">The advantage of this approach is that a page displaying a particular category s products can be bookmarked and indexed by a search engine.</span></span>

<span data-ttu-id="4bc5c-163">另外，我们还可以将每个类别设为 LinkButton，这是我们在本教程中使用的方法。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-163">Alternatively, we can make each category a LinkButton, which is the approach we'll use for this tutorial.</span></span> <span data-ttu-id="4bc5c-164">LinkButton 在用户浏览器中呈现为超链接，但单击它时，将引发回发;在回发时，需要刷新 DataList 的 ObjectDataSource 以显示属于所选类别的产品。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-164">The LinkButton renders in the user s browser as a hyperlink but, when clicked, induces a postback; on postback, the DataList s ObjectDataSource needs to be refreshed to display those products belonging to the selected category.</span></span> <span data-ttu-id="4bc5c-165">对于本教程，使用超链接比使用 LinkButton 更有意义;但在其他情况下，使用 LinkButton 更有利。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-165">For this tutorial, using a hyperlink makes more sense than using a LinkButton; however, there may be other scenarios where using a LinkButton is more advantageous.</span></span> <span data-ttu-id="4bc5c-166">尽管在本示例中，超链接方法非常适合，但让我们来看一下使用 LinkButton。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-166">While the hyperlink approach would be ideal for this example, let s instead explore using the LinkButton.</span></span> <span data-ttu-id="4bc5c-167">正如我们所看到的，使用 LinkButton 会带来一些挑战，不会在超链接的情况下出现。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-167">As we'll see, using a LinkButton introduces some challenges that would not otherwise arise with a hyperlink.</span></span> <span data-ttu-id="4bc5c-168">因此，在本教程中使用 LinkButton 将突出显示这些挑战，并帮助为可能需要使用 LinkButton 而不是超链接的情况提供解决方案。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-168">Therefore, using a LinkButton in this tutorial will highlight these challenges and help provide solutions for those scenarios where we may want to use a LinkButton instead of a hyperlink.</span></span>

> [!NOTE]
> <span data-ttu-id="4bc5c-169">建议使用超链接控件或 `<a>` 元素（而不是 LinkButton）重复本教程。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-169">You are encouraged to repeat this tutorial using a HyperLink control or `<a>` element in lieu of the LinkButton.</span></span>

<span data-ttu-id="4bc5c-170">以下标记显示了中继器和 ObjectDataSource 的声明性语法。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-170">The following markup shows the declarative syntax for the Repeater and the ObjectDataSource.</span></span> <span data-ttu-id="4bc5c-171">请注意，Repeater 模板会呈现一个项目符号列表，其中每个项都是 LinkButton：</span><span class="sxs-lookup"><span data-stu-id="4bc5c-171">Note that the Repeater s templates render a bulleted list with each item as a LinkButton:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample4.aspx)]

> [!NOTE]
> <span data-ttu-id="4bc5c-172">在本教程中，Repeater 必须已启用其视图状态（请注意，省略 Repeater 声明性语法中的 `EnableViewState="False"`）。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-172">For this tutorial the Repeater must have its view state enabled (note the omission of the `EnableViewState="False"` from the Repeater s declarative syntax).</span></span> <span data-ttu-id="4bc5c-173">在步骤3中，我们将为中继器 `ItemCommand` 事件创建事件处理程序，我们将在此事件中更新 DataList s ObjectDataSource `SelectParameters` 集合。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-173">In step 3 we'll be creating an event handler for the Repeater s `ItemCommand` event in which we'll be updating the DataList s ObjectDataSource s `SelectParameters` collection.</span></span> <span data-ttu-id="4bc5c-174">但是，如果禁用了视图状态，则不会触发 Repeater `ItemCommand`。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-174">The Repeater s `ItemCommand`, however, won't fire if view state is disabled.</span></span> <span data-ttu-id="4bc5c-175">有关[Stumper 的](http://scottonwriting.net/sowblog/posts/1263.aspx)详细信息，请参阅 ASP.NET 问题及其[解决方案](http://scottonwriting.net/sowBlog/posts/1268.aspx)的详细信息。必须为中继器 `ItemCommand` 事件启用视图状态。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-175">See [A Stumper of an ASP.NET Question](http://scottonwriting.net/sowblog/posts/1263.aspx) and [its solution](http://scottonwriting.net/sowBlog/posts/1268.aspx) for more information on why view state must be enabled for a Repeater s `ItemCommand` event to fire.</span></span>

<span data-ttu-id="4bc5c-176">`ID` 属性值为 `ViewCategory` 的 LinkButton 没有其 `Text` 属性集。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-176">The LinkButton with the `ID` property value of `ViewCategory` does not have its `Text` property set.</span></span> <span data-ttu-id="4bc5c-177">如果只是想要显示类别名称，则可以通过数据绑定语法以声明方式设置文本属性，如下所示：</span><span class="sxs-lookup"><span data-stu-id="4bc5c-177">If we had just wanted to display the category name, we would have set the Text property declaratively, through databinding syntax, like so:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample5.aspx)]

<span data-ttu-id="4bc5c-178">但是，我们想要显示类别的名称*以及*属于该类别的产品数。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-178">However, we want to show both the category s name *and* the number of products belonging to that category.</span></span> <span data-ttu-id="4bc5c-179">可以通过调用 `ProductBLL` 类 s `GetCategoriesByProductID(categoryID)` 方法并确定在生成的 `ProductsDataTable`中返回多少记录，来从 Repeater `ItemDataBound` 事件处理程序检索此信息，如以下代码所示：</span><span class="sxs-lookup"><span data-stu-id="4bc5c-179">This information can be retrieved from the Repeater s `ItemDataBound` event handler by making a call to the `ProductBLL` class s `GetCategoriesByProductID(categoryID)` method and determining how many records are returned in the resulting `ProductsDataTable`, as the following code illustrates:</span></span>

[!code-csharp[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample6.cs)]

<span data-ttu-id="4bc5c-180">首先，我们要确保我们正在处理一个数据项（其 `ItemType` 是 `Item` 或 `AlternatingItem`），然后引用刚刚绑定到当前 `RepeaterItem`的 `CategoriesRow` 实例。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-180">We start out by ensuring that we re working with a data item (one whose `ItemType` is `Item` or `AlternatingItem`) and then reference the `CategoriesRow` instance that has just been bound to the current `RepeaterItem`.</span></span> <span data-ttu-id="4bc5c-181">接下来，我们通过创建 `ProductsBLL` 类的实例，调用其 `GetCategoriesByProductID(categoryID)` 方法并确定使用 `Count` 属性返回的记录数来确定此类别的产品数。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-181">Next, we determine the number of products for this category by creating an instance of the `ProductsBLL` class, calling its `GetCategoriesByProductID(categoryID)` method, and determining the number of records returned using the `Count` property.</span></span> <span data-ttu-id="4bc5c-182">最后，ItemTemplate 中的 `ViewCategory` LinkButton 是引用，其 `Text` 属性设置为 "*类别名称*（*NumberOfProductsInCategory*）"，其中*NumberOfProductsInCategory*的格式为包含零位小数位的数字。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-182">Finally, the `ViewCategory` LinkButton in the ItemTemplate is references and its `Text` property is set to *CategoryName* (*NumberOfProductsInCategory*), where *NumberOfProductsInCategory* is formatted as a number with zero decimal places.</span></span>

> [!NOTE]
> <span data-ttu-id="4bc5c-183">另外，我们还可以将*格式设置函数*添加到 ASP.NET 页 s 代码隐藏类中，该类接受 `CategoryName` 和 `CategoryID` 值的类别，并返回与该类别中的产品数量相连接的 `CategoryName` （通过调用 `GetCategoriesByProductID(categoryID)` 方法确定）。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-183">Alternatively, we could have added a *formatting function* to the ASP.NET page s code-behind class that accepts a category s `CategoryName` and `CategoryID` values and returns the `CategoryName` concatenated with the number of products in the category (as determined by calling the `GetCategoriesByProductID(categoryID)` method).</span></span> <span data-ttu-id="4bc5c-184">可以通过声明方式将此类格式设置函数的结果分配给 LinkButton s Text 属性，以替换 `ItemDataBound` 事件处理程序的需求。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-184">The results of such a formatting function could be declaratively assigned to the LinkButton s Text property replacing the need for the `ItemDataBound` event handler.</span></span> <span data-ttu-id="4bc5c-185">有关使用格式设置函数的详细信息，请参阅[GridView 控件中的 Using templatefield](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md)或[基于数据教程设置 DataList 和 Repeater 的格式](../displaying-data-with-the-datalist-and-repeater/formatting-the-datalist-and-repeater-based-upon-data-cs.md)。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-185">Refer to the [Using TemplateFields in the GridView Control](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md) or [Formatting the DataList and Repeater Based Upon Data](../displaying-data-with-the-datalist-and-repeater/formatting-the-datalist-and-repeater-based-upon-data-cs.md) tutorials for more information on using formatting functions.</span></span>

<span data-ttu-id="4bc5c-186">添加此事件处理程序后，请花点时间通过浏览器测试页面。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-186">After adding this event handler, take a moment to test the page through a browser.</span></span> <span data-ttu-id="4bc5c-187">请注意每个类别在项目符号列表中的列出方式，并显示类别的名称以及与该类别关联的产品数（请参阅图4）。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-187">Note how each category is listed in a bulleted list, displaying the category s name and the number of products associated with the category (see Figure 4).</span></span>

<span data-ttu-id="4bc5c-188">[![显示每个类别的名称和产品数量](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image11.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="4bc5c-188">[![Each Category s Name and Number of Products are Displayed](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image11.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image10.png)</span></span>

<span data-ttu-id="4bc5c-189">**图 4**：显示每个类别的名称和产品数量（[单击以查看完全大小的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="4bc5c-189">**Figure 4**: Each Category s Name and Number of Products are Displayed ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image12.png))</span></span>

## <a name="updating-thecategoriesdatatableandcategoriestableadapterto-include-the-number-of-products-for-each-category"></a><span data-ttu-id="4bc5c-190">更新`CategoriesDataTable`和`CategoriesTableAdapter`以包含每个类别的产品数量</span><span class="sxs-lookup"><span data-stu-id="4bc5c-190">Updating the`CategoriesDataTable`and`CategoriesTableAdapter`to Include the Number of Products for Each Category</span></span>

<span data-ttu-id="4bc5c-191">我们可以通过调整数据访问层中的 `CategoriesDataTable` 和 `CategoriesTableAdapter` 来将此信息集中在一起，来简化此过程，而不是确定每个类别绑定到中继器的产品数。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-191">Rather than determining the number of products for each category as it s bound to the Repeater, we can streamline this process by adjusting the `CategoriesDataTable` and `CategoriesTableAdapter` in the Data Access Layer to include this information natively.</span></span> <span data-ttu-id="4bc5c-192">若要实现此目的，必须将一个新列添加到 `CategoriesDataTable` 以容纳关联的产品数。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-192">To achieve this, we must add a new column to `CategoriesDataTable` to hold the number of associated products.</span></span> <span data-ttu-id="4bc5c-193">若要将新列添加到 DataTable，请打开类型化数据集（`App_Code\DAL\Northwind.xsd`），右键单击要修改的 DataTable，然后选择 "添加/列"。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-193">To add a new column to a DataTable, open the Typed DataSet (`App_Code\DAL\Northwind.xsd`), right-click on the DataTable to modify, and choose Add / Column.</span></span> <span data-ttu-id="4bc5c-194">向 `CategoriesDataTable` 添加一个新列（参见图5）。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-194">Add a new column to the `CategoriesDataTable` (see Figure 5).</span></span>

<span data-ttu-id="4bc5c-195">[![将新列添加到 CategoriesDataSource](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image14.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="4bc5c-195">[![Add a New Column to the CategoriesDataSource](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image14.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image13.png)</span></span>

<span data-ttu-id="4bc5c-196">**图 5**：将新列添加到 `CategoriesDataSource` （[单击以查看完全大小的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="4bc5c-196">**Figure 5**: Add a New Column to the `CategoriesDataSource` ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image15.png))</span></span>

<span data-ttu-id="4bc5c-197">这会添加一个名为 "`Column1`" 的新列，只需键入不同的名称即可更改此列。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-197">This will add a new column named `Column1`, which you can change by simply typing in a different name.</span></span> <span data-ttu-id="4bc5c-198">将此新列重命名为 `NumberOfProducts`。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-198">Rename this new column to `NumberOfProducts`.</span></span> <span data-ttu-id="4bc5c-199">接下来，需要配置此列的属性。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-199">Next, we need to configure this column s properties.</span></span> <span data-ttu-id="4bc5c-200">单击新列并中转到属性窗口。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-200">Click on the new column and go to the Properties window.</span></span> <span data-ttu-id="4bc5c-201">将列 `DataType` 属性从 `System.String` 更改为 `System.Int32`，并将 `ReadOnly` 属性设置为 `True`，如图6所示。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-201">Change the column s `DataType` property from `System.String` to `System.Int32` and set the `ReadOnly` property to `True`, as shown in Figure 6.</span></span>

![设置新列的 DataType 和 ReadOnly 属性](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image16.png)

<span data-ttu-id="4bc5c-203">**图 6**：设置新列的 "`DataType`" 和 "`ReadOnly`" 属性</span><span class="sxs-lookup"><span data-stu-id="4bc5c-203">**Figure 6**: Set the `DataType` and `ReadOnly` Properties of the New Column</span></span>

<span data-ttu-id="4bc5c-204">虽然 `CategoriesDataTable` 现在具有 `NumberOfProducts` 列，但它的值不是由任何对应的 TableAdapter 查询设置的。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-204">While the `CategoriesDataTable` now has a `NumberOfProducts` column, its value is not set by any of the corresponding TableAdapter s queries.</span></span> <span data-ttu-id="4bc5c-205">如果希望每次检索类别信息时返回此信息，我们可以更新 `GetCategories()` 方法以返回此信息。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-205">We can update the `GetCategories()` method to return this information if we want such information returned every time category information is retrieved.</span></span> <span data-ttu-id="4bc5c-206">但是，如果只需要获取极少实例（例如，仅用于本教程）中类别的关联产品数，则可以将 `GetCategories()` 原样保留并创建返回此信息的新方法。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-206">If, however, we only need to grab the number of associated products for the categories in rare instances (such as just for this tutorial), then we can leave `GetCategories()` as-is and create a new method that returns this information.</span></span> <span data-ttu-id="4bc5c-207">让我们使用后一种方法，创建名为 `GetCategoriesAndNumberOfProducts()`的新方法。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-207">Let s use this latter approach, creating a new method named `GetCategoriesAndNumberOfProducts()`.</span></span>

<span data-ttu-id="4bc5c-208">若要添加此新的 `GetCategoriesAndNumberOfProducts()` 方法，请右键单击 `CategoriesTableAdapter` 并选择 "新建查询"。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-208">To add this new `GetCategoriesAndNumberOfProducts()` method, right-click on the `CategoriesTableAdapter` and choose New Query.</span></span> <span data-ttu-id="4bc5c-209">这会显示 "TableAdapter 查询配置向导"，在前面的教程中，我们曾使用过多次。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-209">This brings up the TableAdapter Query Configuration Wizard, which we ve used numerous times in previous tutorials.</span></span> <span data-ttu-id="4bc5c-210">对于此方法，通过指示查询使用返回行的即席 SQL 语句启动向导。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-210">For this method, start the wizard by indicating that the query uses an ad-hoc SQL statement that returns rows.</span></span>

<span data-ttu-id="4bc5c-211">[![使用即席 SQL 语句创建方法](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image18.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="4bc5c-211">[![Create the Method Using an Ad-Hoc SQL Statement](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image18.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image17.png)</span></span>

<span data-ttu-id="4bc5c-212">**图 7**：使用即席 SQL 语句创建方法（[单击以查看完全大小的映像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image19.png)）</span><span class="sxs-lookup"><span data-stu-id="4bc5c-212">**Figure 7**: Create the Method Using an Ad-Hoc SQL Statement ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image19.png))</span></span>

<span data-ttu-id="4bc5c-213">[![SQL 语句返回的行数](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image21.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="4bc5c-213">[![The SQL Statement Returns Rows](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image21.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image20.png)</span></span>

<span data-ttu-id="4bc5c-214">**图 8**： SQL 语句返回行（[单击以查看完全大小的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image22.png)）</span><span class="sxs-lookup"><span data-stu-id="4bc5c-214">**Figure 8**: The SQL Statement Returns Rows ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image22.png))</span></span>

<span data-ttu-id="4bc5c-215">接下来的向导屏幕提示我们提供查询以供使用。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-215">The next wizard screen prompts us for the query to use.</span></span> <span data-ttu-id="4bc5c-216">若要返回每个类别 `CategoryID`、`CategoryName`和 `Description` 字段以及与该类别关联的产品数量，请使用以下 `SELECT` 语句：</span><span class="sxs-lookup"><span data-stu-id="4bc5c-216">To return each category s `CategoryID`, `CategoryName`, and `Description` fields, along with the number of products associated with the category, use the following `SELECT` statement:</span></span>

[!code-sql[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample7.sql)]

<span data-ttu-id="4bc5c-217">[![指定要使用的查询](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image24.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="4bc5c-217">[![Specify the Query to Use](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image24.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image23.png)</span></span>

<span data-ttu-id="4bc5c-218">**图 9**：指定要使用的查询（[单击以查看完全大小的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image25.png)）</span><span class="sxs-lookup"><span data-stu-id="4bc5c-218">**Figure 9**: Specify the Query to Use ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image25.png))</span></span>

<span data-ttu-id="4bc5c-219">请注意，计算与该类别关联的产品数量的子查询的别名为 `NumberOfProducts`。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-219">Note that the subquery that computes the number of products associated with the category is aliased as `NumberOfProducts`.</span></span> <span data-ttu-id="4bc5c-220">此命名匹配会导致此子查询返回的值与 `CategoriesDataTable` `NumberOfProducts` 列关联。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-220">This naming match causes the value returned by this subquery to be associated with the `CategoriesDataTable` s `NumberOfProducts` column.</span></span>

<span data-ttu-id="4bc5c-221">输入此查询后，最后一步是选择新方法的名称。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-221">After entering this query, the last step is to choose the name for the new method.</span></span> <span data-ttu-id="4bc5c-222">使用 `FillWithNumberOfProducts` 和 `GetCategoriesAndNumberOfProducts` 填充 DataTable 并分别返回 DataTable 模式。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-222">Use `FillWithNumberOfProducts` and `GetCategoriesAndNumberOfProducts` for the Fill a DataTable and Return a DataTable patterns, respectively.</span></span>

<span data-ttu-id="4bc5c-223">[![命名新的 TableAdapter s 方法 FillWithNumberOfProducts 和 GetCategoriesAndNumberOfProducts](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image27.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="4bc5c-223">[![Name the New TableAdapter s Methods FillWithNumberOfProducts and GetCategoriesAndNumberOfProducts](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image27.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image26.png)</span></span>

<span data-ttu-id="4bc5c-224">**图 10**：将新的 TableAdapter s 方法命名 `FillWithNumberOfProducts` 和 `GetCategoriesAndNumberOfProducts` （[单击以查看完全大小的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image28.png)）</span><span class="sxs-lookup"><span data-stu-id="4bc5c-224">**Figure 10**: Name the New TableAdapter s Methods `FillWithNumberOfProducts` and `GetCategoriesAndNumberOfProducts` ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image28.png))</span></span>

<span data-ttu-id="4bc5c-225">此时，数据访问层已扩展为包含每个类别的产品数。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-225">At this point the Data Access Layer has been extended to include the number of products per category.</span></span> <span data-ttu-id="4bc5c-226">由于所有表示层都通过单独的业务逻辑层将对 DAL 的所有调用路由，我们需要将相应的 `GetCategoriesAndNumberOfProducts` 方法添加到 `CategoriesBLL` 类：</span><span class="sxs-lookup"><span data-stu-id="4bc5c-226">Since all our presentation layer routes all calls to the DAL through a separate Business Logic Layer we need to add a corresponding `GetCategoriesAndNumberOfProducts` method to the `CategoriesBLL` class:</span></span>

[!code-csharp[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample8.cs)]

<span data-ttu-id="4bc5c-227">当 DAL 和 BLL 完成后，我们就可以将这些数据绑定到 `CategoriesAndProducts.aspx`中的 `Categories` 中继器！</span><span class="sxs-lookup"><span data-stu-id="4bc5c-227">With the DAL and BLL complete, we re ready to bind this data to the `Categories` Repeater in `CategoriesAndProducts.aspx`!</span></span> <span data-ttu-id="4bc5c-228">如果已从确定 `ItemDataBound` 事件处理程序部分中的产品数创建了用于 Repeater 的 ObjectDataSource，请删除此 ObjectDataSource 并删除中继器 s `DataSourceID` 属性设置;还通过删除 ASP.NET 代码隐藏类中的 `Handles Categories.OnItemDataBound` 语法，unwire 事件处理程序中的中继器 `ItemDataBound` 事件。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-228">If you ve already created an ObjectDataSource for the Repeater from the Determining the Number of Products in the `ItemDataBound` Event Handler section, delete this ObjectDataSource and remove the Repeater s `DataSourceID` property setting; also unwire the Repeater s `ItemDataBound` event from the event handler by removing the `Handles Categories.OnItemDataBound` syntax in the ASP.NET code-behind class.</span></span>

<span data-ttu-id="4bc5c-229">重新播放器恢复其原始状态后，通过中继器 s 智能标记添加一个名为 `CategoriesDataSource` 的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-229">With the Repeater back in its original state, add a new ObjectDataSource named `CategoriesDataSource` via the Repeater s smart tag.</span></span> <span data-ttu-id="4bc5c-230">将 ObjectDataSource 配置为使用 `CategoriesBLL` 类，但不使用 `GetCategories()` 方法，而是改为使用 `GetCategoriesAndNumberOfProducts()` （参见图11）。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-230">Configure the ObjectDataSource to use the `CategoriesBLL` class, but instead of having it use the `GetCategories()` method, have it use `GetCategoriesAndNumberOfProducts()` instead (see Figure 11).</span></span>

<span data-ttu-id="4bc5c-231">[![将 ObjectDataSource 配置为使用 GetCategoriesAndNumberOfProducts 方法](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image30.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="4bc5c-231">[![Configure the ObjectDataSource to Use the GetCategoriesAndNumberOfProducts Method](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image30.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image29.png)</span></span>

<span data-ttu-id="4bc5c-232">**图 11**：将 ObjectDataSource 配置为使用 `GetCategoriesAndNumberOfProducts` 方法（[单击查看完全大小的映像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image31.png)）</span><span class="sxs-lookup"><span data-stu-id="4bc5c-232">**Figure 11**: Configure the ObjectDataSource to Use the `GetCategoriesAndNumberOfProducts` Method ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image31.png))</span></span>

<span data-ttu-id="4bc5c-233">接下来，更新 `ItemTemplate`，以便使用数据绑定语法以声明方式分配 LinkButton s `Text` 属性，同时包含 `CategoryName` 和 `NumberOfProducts` 数据字段。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-233">Next, update the `ItemTemplate` so that the LinkButton s `Text` property is declaratively assigned using databinding syntax and includes both the `CategoryName` and `NumberOfProducts` data fields.</span></span> <span data-ttu-id="4bc5c-234">转发器和 `CategoriesDataSource` ObjectDataSource 的完整声明性标记如下所示：</span><span class="sxs-lookup"><span data-stu-id="4bc5c-234">The complete declarative markup for the Repeater and the `CategoriesDataSource` ObjectDataSource follow:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample9.aspx)]

<span data-ttu-id="4bc5c-235">通过将 DAL 更新为包含 `NumberOfProducts` 列时所呈现的输出与使用 `ItemDataBound` 事件处理程序方法相同（请参阅图4，以查看显示类别名称和产品数量的中继器屏幕截图）。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-235">The output rendered by updating the DAL to include a `NumberOfProducts` column is the same as using the `ItemDataBound` event handler approach (refer back to Figure 4 to see a screen shot of the Repeater showing the category names and number of products).</span></span>

## <a name="step-3-displaying-the-selected-category-s-products"></a><span data-ttu-id="4bc5c-236">步骤3：显示所选类别的产品</span><span class="sxs-lookup"><span data-stu-id="4bc5c-236">Step 3: Displaying the Selected Category s Products</span></span>

<span data-ttu-id="4bc5c-237">此时，我们的 `Categories` Repeater 会显示类别列表以及每个类别中的产品数目。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-237">At this point we have the `Categories` Repeater displaying the list of categories along with the number of products in each category.</span></span> <span data-ttu-id="4bc5c-238">中继器对每个类别使用 LinkButton，当单击此类别时，将导致回发，此时需要在 `CategoryProducts` DataList 中显示所选类别的产品。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-238">The Repeater uses a LinkButton for each category that, when clicked, causes a postback, at which point we need to display those products for the selected category in the `CategoryProducts` DataList.</span></span>

<span data-ttu-id="4bc5c-239">一项挑战是，如何让 DataList 仅显示所选类别的产品。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-239">One challenge facing us is how to have the DataList display just those products for the selected category.</span></span> <span data-ttu-id="4bc5c-240">在[大纲/详细信息中，使用可选择的主 GridView 和详细信息 DetailsView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md)教程，我们看到了如何构建一个可以选择行的 GridView，其中所选的行详细信息显示在同一页上的 DetailsView 中。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-240">In the [Master/Detail Using a Selectable Master GridView with a Details DetailsView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md) tutorial we saw how to build a GridView whose rows could be selected, with the selected row s details being displayed in a DetailsView on the same page.</span></span> <span data-ttu-id="4bc5c-241">GridView 的 ObjectDataSource 使用 `ProductsBLL` s `GetProducts()` 方法返回有关所有产品的信息，而 DetailsView s 则 ObjectDataSource 使用 `GetProductsByProductID(productID)` 方法检索有关选定产品的信息。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-241">The GridView s ObjectDataSource returned information about all products using the `ProductsBLL` s `GetProducts()` method while the DetailsView s ObjectDataSource retrieved information about the selected product using the `GetProductsByProductID(productID)` method.</span></span> <span data-ttu-id="4bc5c-242">通过将 *`productID`* 参数值与 GridView s `SelectedValue` 属性的值相关联，以声明方式提供。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-242">The *`productID`* parameter value was provided declaratively by associating it with the value of the GridView s `SelectedValue` property.</span></span> <span data-ttu-id="4bc5c-243">遗憾的是，中继器没有 `SelectedValue` 属性，无法用作参数源。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-243">Unfortunately, the Repeater does not have a `SelectedValue` property and cannot serve as a parameter source.</span></span>

> [!NOTE]
> <span data-ttu-id="4bc5c-244">这是在 Repeater 中使用 LinkButton 时出现的难题之一。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-244">This is one of those challenges that appear when using the LinkButton in a Repeater.</span></span> <span data-ttu-id="4bc5c-245">如果我们使用了超链接通过 querystring 传入 `CategoryID`，则可以使用该 QueryString 字段作为参数 s 值的源。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-245">Had we used a hyperlink to pass in the `CategoryID` through the querystring instead, we could use that QueryString field as the source for the parameter s value.</span></span>

<span data-ttu-id="4bc5c-246">不过，在我们担心是否缺少用于中继器的 `SelectedValue` 属性之前，让我们先将 DataList 绑定到 ObjectDataSource 并指定其 `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-246">Before we worry about the lack of a `SelectedValue` property for the Repeater, though, let s first bind the DataList to an ObjectDataSource and specify its `ItemTemplate`.</span></span>

<span data-ttu-id="4bc5c-247">在 DataList s 智能标记中，选择添加名为 `CategoryProductsDataSource` 的新 ObjectDataSource，并将其配置为使用 `ProductsBLL` 类 `GetProductsByCategoryID(categoryID)` 方法。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-247">From the DataList s smart tag, opt to add a new ObjectDataSource named `CategoryProductsDataSource` and configure it to use the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="4bc5c-248">由于本教程中的 DataList 提供了一个只读界面，因此可随意将插入、更新和删除选项卡中的下拉列表设置为 "（无）"。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-248">Since the DataList in this tutorial offers a read-only interface, feel free to set the drop-down lists in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>

<span data-ttu-id="4bc5c-249">[![将 ObjectDataSource 配置为使用 ProductsBLL 类 s GetProductsByCategoryID （类别 Id）方法](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image33.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="4bc5c-249">[![Configure the ObjectDataSource to Use ProductsBLL Class s GetProductsByCategoryID(categoryID) Method](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image33.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image32.png)</span></span>

<span data-ttu-id="4bc5c-250">**图 12**：将 ObjectDataSource 配置为使用 `ProductsBLL` 类 `GetProductsByCategoryID(categoryID)` 方法（[单击以查看完全大小的映像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image34.png)）</span><span class="sxs-lookup"><span data-stu-id="4bc5c-250">**Figure 12**: Configure the ObjectDataSource to Use `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image34.png))</span></span>

<span data-ttu-id="4bc5c-251">由于 `GetProductsByCategoryID(categoryID)` 方法需要输入参数（ *`categoryID`* ），因此 "配置数据源" 向导允许我们指定参数 "源"。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-251">Since the `GetProductsByCategoryID(categoryID)` method expects an input parameter (*`categoryID`*), the Configure Data Source wizard allows us to specify the parameter s source.</span></span> <span data-ttu-id="4bc5c-252">如果类别已在 GridView 或 DataList 中列出，请将 "参数源" 下拉列表设置为 "控件"，并将 ControlID 设置为数据 Web 控件的 `ID`。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-252">Had the categories been listed in a GridView or a DataList, we d set the Parameter source drop-down list to Control and the ControlID to the `ID` of the data Web control.</span></span> <span data-ttu-id="4bc5c-253">但是，由于中继器缺少 `SelectedValue` 属性，因此不能将其用作参数源。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-253">However, since the Repeater lacks a `SelectedValue` property it cannot be used as a parameter source.</span></span> <span data-ttu-id="4bc5c-254">如果选中，则会发现 ControlID 下拉列表仅包含一个控件 `ID``CategoryProducts`（DataList 的 `ID`）。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-254">If you check, you'll find that the ControlID drop-down list only contains one control `ID``CategoryProducts`, the `ID` of the DataList.</span></span>

<span data-ttu-id="4bc5c-255">现在，将 "参数源" 下拉列表设置为 "无"。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-255">For now, set the Parameter source drop-down list to None.</span></span> <span data-ttu-id="4bc5c-256">当在 Repeater 中单击类别 LinkButton 时，我们将以编程方式分配此参数值。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-256">We'll end up programmatically assigning this parameter value when a category LinkButton is clicked in the Repeater.</span></span>

<span data-ttu-id="4bc5c-257">[![未指定类别 Id 参数的参数源](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image36.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="4bc5c-257">[![Do Not Specify a Parameter Source for the categoryID Parameter](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image36.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image35.png)</span></span>

<span data-ttu-id="4bc5c-258">**图 13**：不要为 *`categoryID`* 参数指定参数源（[单击查看完全大小的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image37.png)）</span><span class="sxs-lookup"><span data-stu-id="4bc5c-258">**Figure 13**: Do Not Specify a Parameter Source for the *`categoryID`* Parameter ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image37.png))</span></span>

<span data-ttu-id="4bc5c-259">完成 "配置数据源" 向导后，Visual Studio 会自动生成 DataList s `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-259">After completing the Configure Data Source wizard, Visual Studio auto-generates the DataList s `ItemTemplate`.</span></span> <span data-ttu-id="4bc5c-260">将此默认 `ItemTemplate` 替换为在前面的教程中使用的模板;同时，将 DataList s `RepeatColumns` 属性设置为2。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-260">Replace this default `ItemTemplate` with the template we used in the preceding tutorial; also, set the DataList s `RepeatColumns` property to 2.</span></span> <span data-ttu-id="4bc5c-261">进行这些更改后，DataList 及其关联的 ObjectDataSource 的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="4bc5c-261">After making these changes the declarative markup for your DataList and its associated ObjectDataSource should look like the following:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample10.aspx)]

<span data-ttu-id="4bc5c-262">当前不会设置 `CategoryProductsDataSource` ObjectDataSource s *`categoryID`* 参数，因此查看该页时不会显示任何产品。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-262">Currently, the `CategoryProductsDataSource` ObjectDataSource s *`categoryID`* parameter is never set, so no products are displayed when viewing the page.</span></span> <span data-ttu-id="4bc5c-263">我们需要做的就是基于中继器中单击的类别的 `CategoryID` 设置此参数值。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-263">What we need to do is have this parameter value set based on the `CategoryID` of the clicked category in the Repeater.</span></span> <span data-ttu-id="4bc5c-264">这就带来了两个难题：首先，如何确定何时单击了 LinkButton `ItemTemplate` 中的;其次，如何确定被单击 LinkButton 的相应类别的 `CategoryID`？</span><span class="sxs-lookup"><span data-stu-id="4bc5c-264">This introduces two challenges: first, how do we determine when a LinkButton in the Repeater s `ItemTemplate` has been clicked; and second, how can we determine the `CategoryID` of the corresponding category whose LinkButton was clicked?</span></span>

<span data-ttu-id="4bc5c-265">LinkButton 和 ImageButton 控件一样，都有一个 `Click` 事件和一个[`Command` 事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.command.aspx)。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-265">The LinkButton like the Button and ImageButton controls has a `Click` event and a [`Command` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.command.aspx).</span></span> <span data-ttu-id="4bc5c-266">`Click` 事件旨在只需注意 LinkButton 已被单击。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-266">The `Click` event is designed to simply note that the LinkButton has been clicked.</span></span> <span data-ttu-id="4bc5c-267">但有时，除了指出已单击 LinkButton 外，还需要将一些额外的信息传递给事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-267">At times, however, in addition to noting that the LinkButton has been clicked we also need to pass some extra information to the event handler.</span></span> <span data-ttu-id="4bc5c-268">如果是这种情况，则可以为 LinkButton s [`CommandName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandname.aspx)和[`CommandArgument`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandargument.aspx)属性分配此额外信息。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-268">If this is the case, the LinkButton s [`CommandName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandname.aspx) and [`CommandArgument`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandargument.aspx) properties can be assigned this extra information.</span></span> <span data-ttu-id="4bc5c-269">然后，在单击 LinkButton 时，将激发其 `Command` 事件（而不是其 `Click` 事件），并向事件处理程序传递 `CommandName` 和 `CommandArgument` 属性的值。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-269">Then, when the LinkButton is clicked, its `Command` event fires (instead of its `Click` event) and the event handler is passed the values of the `CommandName` and `CommandArgument` properties.</span></span>

<span data-ttu-id="4bc5c-270">当从 Repeater 中的模板中引发 `Command` 事件时，将激发 Repeater [`ItemCommand` 事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeater.itemcommand.aspx)，并将该事件传递给所单击的 LinkButton （或按钮或 ImageButton）的 `CommandName` 和 `CommandArgument` 值。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-270">When a `Command` event is raised from within a template in the Repeater, the Repeater s [`ItemCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeater.itemcommand.aspx) fires and is passed the `CommandName` and `CommandArgument` values of the clicked LinkButton (or Button or ImageButton).</span></span> <span data-ttu-id="4bc5c-271">因此，若要确定何时单击了 Repeater 中的类别 LinkButton，需要执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="4bc5c-271">Therefore, to determine when a category LinkButton in the Repeater has been clicked, we need to do the following:</span></span>

1. <span data-ttu-id="4bc5c-272">将 Repeater `ItemTemplate` 中 LinkButton 的 `CommandName` 属性设置为某个值（我曾使用 ListProducts）。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-272">Set the `CommandName` property of the LinkButton in the Repeater s `ItemTemplate` to some value (I ve used ListProducts ).</span></span> <span data-ttu-id="4bc5c-273">通过设置此 `CommandName` 值，单击 LinkButton 时将触发 LinkButton s `Command` 事件。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-273">By setting this `CommandName` value, the LinkButton s `Command` event fires when the LinkButton is clicked.</span></span>
2. <span data-ttu-id="4bc5c-274">将 LinkButton `CommandArgument` 属性设置为当前项的 `CategoryID`值。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-274">Set the LinkButton s `CommandArgument` property to the value of the current item s `CategoryID`.</span></span>
3. <span data-ttu-id="4bc5c-275">为中继器 `ItemCommand` 事件创建事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-275">Create an event handler for the Repeater s `ItemCommand` event.</span></span> <span data-ttu-id="4bc5c-276">在事件处理程序中，将 `CategoryProductsDataSource` ObjectDataSource s `CategoryID` 参数设置为传入 `CommandArgument`的值。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-276">In the event handler, set the `CategoryProductsDataSource` ObjectDataSource s `CategoryID` parameter to the value of the passed-in `CommandArgument`.</span></span>

<span data-ttu-id="4bc5c-277">以下 `ItemTemplate` 类别 Repeater 标记的标记实现步骤1和2。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-277">The following `ItemTemplate` markup for the Categories Repeater implements steps 1 and 2.</span></span> <span data-ttu-id="4bc5c-278">请注意如何使用数据绑定语法为 `CommandArgument` 值分配数据项 `CategoryID`：</span><span class="sxs-lookup"><span data-stu-id="4bc5c-278">Note how the `CommandArgument` value is assigned the data item s `CategoryID` using databinding syntax:</span></span>

[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample11.aspx)]

<span data-ttu-id="4bc5c-279">无论何时创建 `ItemCommand` 事件处理程序，始终首先检查传入的 `CommandName` 值是明智的，因为在 Repeater 中*任何*LinkButton 或 ImageButton 引发的*任何*`Command` 事件都将导致触发 `ItemCommand` 事件。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-279">Whenever creating an `ItemCommand` event handler it is prudent to always first check the incoming `CommandName` value because *any* `Command` event raised by *any* Button, LinkButton, or ImageButton within the Repeater will cause the `ItemCommand` event to fire.</span></span> <span data-ttu-id="4bc5c-280">虽然目前只有一个这样的 LinkButton，但在将来我们（或我们团队的另一个开发人员）可能会将其他按钮 Web 控件添加到中继器，单击该控件时，将引发相同的 `ItemCommand` 事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-280">While we currently only have one such LinkButton now, in the future we (or another developer on our team) might add additional button Web controls to the Repeater that, when clicked, raises the same `ItemCommand` event handler.</span></span> <span data-ttu-id="4bc5c-281">因此，最佳做法是始终确保检查 `CommandName` 属性，如果与所需的值匹配，只需继续编程逻辑。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-281">Therefore, it s best to always make sure you check the `CommandName` property and only proceed with your programmatic logic if it matches up to the value expected.</span></span>

<span data-ttu-id="4bc5c-282">在确保传入的 `CommandName` 值等于 ListProducts 后，事件处理程序会将 `CategoryProductsDataSource` ObjectDataSource s `CategoryID` 参数分配给传入的 `CommandArgument`的值。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-282">After ensuring that the passed-in `CommandName` value equals ListProducts, the event handler then assigns the `CategoryProductsDataSource` ObjectDataSource s `CategoryID` parameter to the value of the passed-in `CommandArgument`.</span></span> <span data-ttu-id="4bc5c-283">对 ObjectDataSource `SelectParameters` 的这一修改会自动导致 DataList 重新绑定到数据源，从而显示新选定类别的产品。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-283">This modification to the ObjectDataSource s `SelectParameters` automatically causes the DataList to rebind itself to the data source, showing the products for the newly selected category.</span></span>

[!code-csharp[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample12.cs)]

<span data-ttu-id="4bc5c-284">添加这些内容后，我们的教程已完成！</span><span class="sxs-lookup"><span data-stu-id="4bc5c-284">With these additions, our tutorial is complete!</span></span> <span data-ttu-id="4bc5c-285">花点时间在浏览器中进行测试。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-285">Take a moment to test it out in a browser.</span></span> <span data-ttu-id="4bc5c-286">图14：首次访问页面时显示屏幕。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-286">Figure 14 shows the screen when first visiting the page.</span></span> <span data-ttu-id="4bc5c-287">由于尚未选择类别，因此不会显示任何产品。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-287">Since a category has yet to be selected, no products are displayed.</span></span> <span data-ttu-id="4bc5c-288">单击某一类别（如 "生产"）会在两列视图的 "产品" 类别中显示这些产品（参见图15）。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-288">Clicking on a category, such as Produce, displays those products in the Product category in a two-column view (see Figure 15).</span></span>

<span data-ttu-id="4bc5c-289">[首次访问页面时，不会显示 ![产品](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image39.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image38.png)</span><span class="sxs-lookup"><span data-stu-id="4bc5c-289">[![No Products are Displayed When First Visiting the Page](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image39.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image38.png)</span></span>

<span data-ttu-id="4bc5c-290">**图 14**：首次访问页面时未显示任何产品（[单击以查看完全大小的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image40.png)）</span><span class="sxs-lookup"><span data-stu-id="4bc5c-290">**Figure 14**: No Products are Displayed When First Visiting the Page ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image40.png))</span></span>

<span data-ttu-id="4bc5c-291">[![单击 "生成" 类别将列出匹配的产品](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image42.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image41.png)</span><span class="sxs-lookup"><span data-stu-id="4bc5c-291">[![Clicking the Produce Category Lists the Matching Products to the Right](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image42.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image41.png)</span></span>

<span data-ttu-id="4bc5c-292">**图 15**：单击 "生成" 类别将列出匹配的产品（[单击以查看完全大小的图像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image43.png)）</span><span class="sxs-lookup"><span data-stu-id="4bc5c-292">**Figure 15**: Clicking the Produce Category Lists the Matching Products to the Right ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image43.png))</span></span>

## <a name="summary"></a><span data-ttu-id="4bc5c-293">摘要</span><span class="sxs-lookup"><span data-stu-id="4bc5c-293">Summary</span></span>

<span data-ttu-id="4bc5c-294">正如我们在本教程中看到的那样，主/详细信息报表可以分散在两个页面上，也可以合并在一起。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-294">As we saw in this tutorial and the preceding one, master/detail reports can be spread out across two pages, or consolidated on one.</span></span> <span data-ttu-id="4bc5c-295">但是，在单页上显示主/详细信息报表会给出一些有关如何最好地在页面上布局大纲和详细信息的问题。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-295">Displaying a master/details report on a single page, however, introduces some challenges on how best to layout the master and details records on the page.</span></span> <span data-ttu-id="4bc5c-296">在*主/详细信息中，使用可选择的主 GridView 和详细信息 DetailsView*教程，我们的详细信息记录显示在主记录上;在本教程中，我们使用了 CSS 技术将主记录浮动到详细信息的左侧。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-296">In the *Master/Detail Using a Selectable Master GridView with a Details DetailsView* tutorial we had the details records appear above the master records; in this tutorial we used CSS techniques to have the master records float to the left of the details.</span></span>

<span data-ttu-id="4bc5c-297">除了显示主/详细信息报表之外，我们还可以探索如何检索与每个类别关联的产品的数量，以及如何在从中继器内单击 LinkButton （或按钮或 ImageButton）时执行服务器端逻辑。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-297">Along with displaying master/details reports, we also had the opportunity to explore how to retrieve the number of products associated with each category as well as how to perform server-side logic when a LinkButton (or Button or ImageButton) is clicked from within a Repeater.</span></span>

<span data-ttu-id="4bc5c-298">本教程通过 DataList 和中继器完成对主/详细信息报表的检查。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-298">This tutorial completes our examination of master/detail reports with the DataList and Repeater.</span></span> <span data-ttu-id="4bc5c-299">下一组教程将演示如何向 DataList 控件添加编辑和删除功能。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-299">Our next set of tutorials will illustrate how to add editing and deleting capabilities to the DataList control.</span></span>

<span data-ttu-id="4bc5c-300">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="4bc5c-300">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="4bc5c-301">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="4bc5c-301">Further Reading</span></span>

<span data-ttu-id="4bc5c-302">有关本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="4bc5c-302">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- <span data-ttu-id="4bc5c-303">使用 CSS [Floatutorial](http://css.maxdesign.com.au/floatutorial/)有关浮动 css 元素的教程</span><span class="sxs-lookup"><span data-stu-id="4bc5c-303">[Floatutorial](http://css.maxdesign.com.au/floatutorial/) a tutorial on floating CSS elements with CSS</span></span>
- <span data-ttu-id="4bc5c-304">[Css 定位](http://www.brainjar.com/css/positioning/)有关将元素定位到 css 的详细信息</span><span class="sxs-lookup"><span data-stu-id="4bc5c-304">[CSS Positioning](http://www.brainjar.com/css/positioning/) more information on positioning elements with CSS</span></span>
- <span data-ttu-id="4bc5c-305">使用 `<table>` 和用于定位的其他 HTML 元素，使用[Html 布局内容](http://www.w3schools.com/html/html_layout.asp)</span><span class="sxs-lookup"><span data-stu-id="4bc5c-305">[Laying Out Content with HTML](http://www.w3schools.com/html/html_layout.asp) using `<table>` s and other HTML elements for positioning</span></span>

## <a name="about-the-author"></a><span data-ttu-id="4bc5c-306">关于作者</span><span class="sxs-lookup"><span data-stu-id="4bc5c-306">About the Author</span></span>

<span data-ttu-id="4bc5c-307">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，创始人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已在使用 Microsoft Web 技术，自1998开始。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-307">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="4bc5c-308">Scott 的工作方式是独立的顾问、培训师和撰稿人。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-308">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="4bc5c-309">他的最新书籍是，[*在24小时内，sam ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-309">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="4bc5c-310">可以[mitchell@4GuysFromRolla.com访问。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="4bc5c-310">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="4bc5c-311">或通过他的博客，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-311">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="4bc5c-312">特别感谢</span><span class="sxs-lookup"><span data-stu-id="4bc5c-312">Special Thanks To</span></span>

<span data-ttu-id="4bc5c-313">此教程系列由许多有用的审阅者查看。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-313">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="4bc5c-314">本教程的领导审查人员是 Zack 的。</span><span class="sxs-lookup"><span data-stu-id="4bc5c-314">Lead reviewer for this tutorial was Zack Jones.</span></span> <span data-ttu-id="4bc5c-315">想要查看我即将发布的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="4bc5c-315">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="4bc5c-316">如果是这样，请在mitchell@4GuysFromRolla.com放置一行[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="4bc5c-316">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="4bc5c-317">[上一页](master-detail-filtering-acess-two-pages-datalist-cs.md)
> [下一页](master-detail-filtering-with-a-dropdownlist-datalist-vb.md)</span><span class="sxs-lookup"><span data-stu-id="4bc5c-317">[Previous](master-detail-filtering-acess-two-pages-datalist-cs.md)
[Next](master-detail-filtering-with-a-dropdownlist-datalist-vb.md)</span></span>
