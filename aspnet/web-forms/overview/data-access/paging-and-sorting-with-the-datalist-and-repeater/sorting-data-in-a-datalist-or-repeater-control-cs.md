---
uid: web-forms/overview/data-access/paging-and-sorting-with-the-datalist-and-repeater/sorting-data-in-a-datalist-or-repeater-control-cs
title: 对 DataList 或 Repeater 控件中的数据进行C#排序（） |Microsoft Docs
author: rick-anderson
description: 在本教程中，我们将探讨如何在 DataList 和 Repeater 中包含排序支持，以及如何构造其数据可以 。
ms.author: riande
ms.date: 11/13/2006
ms.assetid: f52c302a-1b7c-46fe-8a13-8412c95cbf6d
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting-with-the-datalist-and-repeater/sorting-data-in-a-datalist-or-repeater-control-cs
msc.type: authoredcontent
ms.openlocfilehash: 66a09c637d33c812b39e0ce85a552bd71665a2e1
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/06/2020
ms.locfileid: "78502952"
---
# <a name="sorting-data-in-a-datalist-or-repeater-control-c"></a><span data-ttu-id="9efb4-103">排序 DataList 或 Repeater 控件中的数据 (C#)</span><span class="sxs-lookup"><span data-stu-id="9efb4-103">Sorting Data in a DataList or Repeater Control (C#)</span></span>

<span data-ttu-id="9efb4-104">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="9efb4-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="9efb4-105">[下载示例应用](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_45_CS.exe)或[下载 PDF](sorting-data-in-a-datalist-or-repeater-control-cs/_static/datatutorial45cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="9efb4-105">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_45_CS.exe) or [Download PDF](sorting-data-in-a-datalist-or-repeater-control-cs/_static/datatutorial45cs1.pdf)</span></span>

> <span data-ttu-id="9efb4-106">在本教程中，我们将介绍如何在 DataList 和 Repeater 中加入排序支持，以及如何构造可对其数据进行分页和排序的 DataList 或 Repeater。</span><span class="sxs-lookup"><span data-stu-id="9efb4-106">In this tutorial we'll examine how to include sorting support in the DataList and Repeater, as well as how to construct a DataList or Repeater whose data can be paged and sorted.</span></span>

## <a name="introduction"></a><span data-ttu-id="9efb4-107">简介</span><span class="sxs-lookup"><span data-stu-id="9efb4-107">Introduction</span></span>

<span data-ttu-id="9efb4-108">在[上一教程](paging-report-data-in-a-datalist-or-repeater-control-cs.md)中，我们探讨了如何向 DataList 添加分页支持。</span><span class="sxs-lookup"><span data-stu-id="9efb4-108">In the [previous tutorial](paging-report-data-in-a-datalist-or-repeater-control-cs.md) we examined how to add paging support to a DataList.</span></span> <span data-ttu-id="9efb4-109">我们在 `ProductsBLL` 类（`GetProductsAsPagedDataSource`）中创建了一个返回 `PagedDataSource` 对象的新方法。</span><span class="sxs-lookup"><span data-stu-id="9efb4-109">We created a new method in the `ProductsBLL` class (`GetProductsAsPagedDataSource`) that returned a `PagedDataSource` object.</span></span> <span data-ttu-id="9efb4-110">绑定到 DataList 或中继器时，DataList 或 Repeater 只显示请求的数据页。</span><span class="sxs-lookup"><span data-stu-id="9efb4-110">When bound to a DataList or Repeater, the DataList or Repeater would display just the requested page of data.</span></span> <span data-ttu-id="9efb4-111">此方法类似于 GridView、DetailsView 和 FormView 控件在内部使用的方法，以提供其内置的默认分页功能。</span><span class="sxs-lookup"><span data-stu-id="9efb4-111">This technique is similar to what is used internally by the GridView, DetailsView, and FormView controls to provide their built-in default paging functionality.</span></span>

<span data-ttu-id="9efb4-112">除了提供分页支持以外，GridView 还包括现成的排序支持。</span><span class="sxs-lookup"><span data-stu-id="9efb4-112">In addition to offering paging support, the GridView also includes out of the box sorting support.</span></span> <span data-ttu-id="9efb4-113">DataList 和 Repeater 都不提供内置排序功能;但是，可以使用一些代码来添加排序功能。</span><span class="sxs-lookup"><span data-stu-id="9efb4-113">Neither the DataList nor Repeater provides built-in sorting functionality; however, sorting features can be added with a bit of code.</span></span> <span data-ttu-id="9efb4-114">在本教程中，我们将介绍如何在 DataList 和 Repeater 中加入排序支持，以及如何构造可对其数据进行分页和排序的 DataList 或 Repeater。</span><span class="sxs-lookup"><span data-stu-id="9efb4-114">In this tutorial we'll examine how to include sorting support in the DataList and Repeater, as well as how to construct a DataList or Repeater whose data can be paged and sorted.</span></span>

## <a name="a-review-of-sorting"></a><span data-ttu-id="9efb4-115">排序检查</span><span class="sxs-lookup"><span data-stu-id="9efb4-115">A Review of Sorting</span></span>

<span data-ttu-id="9efb4-116">正如我们在[分页和排序报表数据](../paging-and-sorting/paging-and-sorting-report-data-cs.md)教程中看到的那样，GridView 控件提供了现成的排序支持。</span><span class="sxs-lookup"><span data-stu-id="9efb4-116">As we saw in the [Paging and Sorting Report Data](../paging-and-sorting/paging-and-sorting-report-data-cs.md) tutorial, the GridView control provides out of the box sorting support.</span></span> <span data-ttu-id="9efb4-117">每个 GridView 字段都可以有关联的 `SortExpression`，指示对数据进行排序所依据的数据字段。</span><span class="sxs-lookup"><span data-stu-id="9efb4-117">Each GridView field can have an associated `SortExpression`, which indicates the data field by which to sort the data.</span></span> <span data-ttu-id="9efb4-118">当 GridView `AllowSorting` 属性设置为 `true`时，具有 `SortExpression` 属性值的每个 GridView 字段的标头将呈现为 LinkButton。</span><span class="sxs-lookup"><span data-stu-id="9efb4-118">When the GridView s `AllowSorting` property is set to `true`, each GridView field that has a `SortExpression` property value has its header rendered as a LinkButton.</span></span> <span data-ttu-id="9efb4-119">当用户单击某个特定 GridView 字段 "标头" 时，将发生回发，并根据所单击的字段 "`SortExpression`对数据进行排序。</span><span class="sxs-lookup"><span data-stu-id="9efb4-119">When a user clicks a particular GridView field s header, a postback occurs and the data is sorted according to the clicked field s `SortExpression`.</span></span>

<span data-ttu-id="9efb4-120">GridView 控件也有一个 `SortExpression` 属性，该属性存储数据排序所依据的 GridView 字段的 `SortExpression`。</span><span class="sxs-lookup"><span data-stu-id="9efb4-120">The GridView control has a `SortExpression` property as well, which stores the `SortExpression` of the GridView field the data is sorted by.</span></span> <span data-ttu-id="9efb4-121">此外，`SortDirection` 属性指示是按升序还是降序对数据进行排序（如果用户连续单击特定 GridView 字段标题链接两次，则会切换排序顺序）。</span><span class="sxs-lookup"><span data-stu-id="9efb4-121">Additionally, a `SortDirection` property indicates whether the data is to be sorted in ascending or descending order (if a user clicks a particular GridView field s header link twice in succession, the sort order is toggled).</span></span>

<span data-ttu-id="9efb4-122">当 GridView 绑定到其数据源控件时，它会将其 `SortExpression`，并 `SortDirection` 属性传递到数据源控件。</span><span class="sxs-lookup"><span data-stu-id="9efb4-122">When the GridView is bound to its data source control, it hands off its `SortExpression` and `SortDirection` properties to the data source control.</span></span> <span data-ttu-id="9efb4-123">数据源控件检索数据，然后根据提供的 `SortExpression` 和 `SortDirection` 属性对数据进行排序。</span><span class="sxs-lookup"><span data-stu-id="9efb4-123">The data source control retrieves the data and then sorts it according to the supplied `SortExpression` and `SortDirection` properties.</span></span> <span data-ttu-id="9efb4-124">对数据进行排序后，数据源控件将其返回给 GridView。</span><span class="sxs-lookup"><span data-stu-id="9efb4-124">After sorting the data, the data source control returns it to the GridView.</span></span>

<span data-ttu-id="9efb4-125">若要在 DataList 或 Repeater 控件中复制此功能，必须执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="9efb4-125">To replicate this functionality with the DataList or Repeater controls, we must:</span></span>

- <span data-ttu-id="9efb4-126">创建排序接口</span><span class="sxs-lookup"><span data-stu-id="9efb4-126">Create a sorting interface</span></span>
- <span data-ttu-id="9efb4-127">记住要按其排序的数据字段，以及是按升序还是按降序排序</span><span class="sxs-lookup"><span data-stu-id="9efb4-127">Remember the data field to sort by and whether to sort in ascending or descending order</span></span>
- <span data-ttu-id="9efb4-128">指示 ObjectDataSource 按特定数据字段对数据进行排序</span><span class="sxs-lookup"><span data-stu-id="9efb4-128">Instruct the ObjectDataSource to sort the data by a particular data field</span></span>

<span data-ttu-id="9efb4-129">在步骤3和4中，我们将解决这三个任务。</span><span class="sxs-lookup"><span data-stu-id="9efb4-129">We'll tackle these three tasks in steps 3 and 4.</span></span> <span data-ttu-id="9efb4-130">接下来，我们将探讨如何在 DataList 或中继器中包含分页和排序支持。</span><span class="sxs-lookup"><span data-stu-id="9efb4-130">Following that, we'll examine how to include both paging and sorting support in a DataList or Repeater.</span></span>

## <a name="step-2-displaying-the-products-in-a-repeater"></a><span data-ttu-id="9efb4-131">步骤2：在中继器中显示产品</span><span class="sxs-lookup"><span data-stu-id="9efb4-131">Step 2: Displaying the Products in a Repeater</span></span>

<span data-ttu-id="9efb4-132">在考虑如何实现任何与排序相关的功能之前，让我们首先列出 Repeater 控件中的产品。</span><span class="sxs-lookup"><span data-stu-id="9efb4-132">Before we worry about implementing any of the sorting-related functionality, let s start by listing the products in a Repeater control.</span></span> <span data-ttu-id="9efb4-133">首先打开 `PagingSortingDataListRepeater` 文件夹中的 "`Sorting.aspx`" 页。</span><span class="sxs-lookup"><span data-stu-id="9efb4-133">Start by opening the `Sorting.aspx` page in the `PagingSortingDataListRepeater` folder.</span></span> <span data-ttu-id="9efb4-134">将 Repeater 控件添加到网页，并将其 `ID` 属性设置为 `SortableProducts`。</span><span class="sxs-lookup"><span data-stu-id="9efb4-134">Add a Repeater control to the web page, setting its `ID` property to `SortableProducts`.</span></span> <span data-ttu-id="9efb4-135">从 "Repeater" 智能标记中创建一个名为 `ProductsDataSource` 的新 ObjectDataSource，并将其配置为从 `ProductsBLL` 类 `GetProducts()` 方法检索数据。</span><span class="sxs-lookup"><span data-stu-id="9efb4-135">From the Repeater s smart tag, create a new ObjectDataSource named `ProductsDataSource` and configure it to retrieve data from the `ProductsBLL` class s `GetProducts()` method.</span></span> <span data-ttu-id="9efb4-136">从 "插入"、"更新" 和 "删除" 选项卡的下拉列表中选择 "（无）" 选项。</span><span class="sxs-lookup"><span data-stu-id="9efb4-136">Select the (None) option from the drop-down lists in the INSERT, UPDATE, and DELETE tabs.</span></span>

<span data-ttu-id="9efb4-137">[![创建 ObjectDataSource 并将其配置为使用 GetProductsAsPagedDataSource （）方法](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image2.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="9efb4-137">[![Create an ObjectDataSource and Configure it to Use the GetProductsAsPagedDataSource() Method](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image2.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image1.png)</span></span>

<span data-ttu-id="9efb4-138">**图 1**：创建 ObjectDataSource 并将其配置为使用 `GetProductsAsPagedDataSource()` 方法（[单击查看完全大小的映像](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="9efb4-138">**Figure 1**: Create an ObjectDataSource and Configure it to Use the `GetProductsAsPagedDataSource()` Method ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image3.png))</span></span>

<span data-ttu-id="9efb4-139">[![在 "更新"、"插入" 和 "删除" 选项卡中将下拉列表设置为 "（无）"](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image5.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="9efb4-139">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE tabs to (None)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image5.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image4.png)</span></span>

<span data-ttu-id="9efb4-140">**图 2**：将 "更新"、"插入" 和 "删除" 选项卡中的下拉列表设置为 "（无）" （[单击查看完全大小的映像](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="9efb4-140">**Figure 2**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE tabs to (None) ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image6.png))</span></span>

<span data-ttu-id="9efb4-141">与 DataList 不同，Visual Studio 不会在将 Repeater 控件绑定到数据源后自动为其创建 `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="9efb4-141">Unlike with the DataList, Visual Studio does not automatically create an `ItemTemplate` for the Repeater control after binding it to a data source.</span></span> <span data-ttu-id="9efb4-142">而且，我们必须以声明方式添加此 `ItemTemplate`，因为 Repeater 控件的智能标记缺少 DataList s 中的编辑模板选项。</span><span class="sxs-lookup"><span data-stu-id="9efb4-142">Furthermore, we must add this `ItemTemplate` declaratively, as the Repeater control s smart tag lacks the Edit Templates option found in the DataList s.</span></span> <span data-ttu-id="9efb4-143">允许使用上一教程中的相同 `ItemTemplate`，其中显示了产品名称、供应商和类别。</span><span class="sxs-lookup"><span data-stu-id="9efb4-143">Let s use the same `ItemTemplate` from the previous tutorial, which displayed the product s name, supplier, and category.</span></span>

<span data-ttu-id="9efb4-144">添加 `ItemTemplate`后，Repeater 和 ObjectDataSource 的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="9efb4-144">After adding the `ItemTemplate`, the Repeater and ObjectDataSource s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-cs/samples/sample1.aspx)]

<span data-ttu-id="9efb4-145">图3在浏览器中查看时显示此页。</span><span class="sxs-lookup"><span data-stu-id="9efb4-145">Figure 3 shows this page when viewed through a browser.</span></span>

<span data-ttu-id="9efb4-146">[![显示每个产品的名称、供应商和类别](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image8.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="9efb4-146">[![Each Product s Name, Supplier, and Category is Displayed](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image8.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image7.png)</span></span>

<span data-ttu-id="9efb4-147">**图 3**：显示了每个产品的名称、供应商和类别（[单击以查看完全大小的图像](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="9efb4-147">**Figure 3**: Each Product s Name, Supplier, and Category is Displayed ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image9.png))</span></span>

## <a name="step-3-instructing-the-objectdatasource-to-sort-the-data"></a><span data-ttu-id="9efb4-148">步骤3：指示 ObjectDataSource 对数据进行排序</span><span class="sxs-lookup"><span data-stu-id="9efb4-148">Step 3: Instructing the ObjectDataSource to Sort the Data</span></span>

<span data-ttu-id="9efb4-149">若要对在 Repeater 中显示的数据进行排序，需要将排序表达式的 ObjectDataSource 通知给数据排序依据。</span><span class="sxs-lookup"><span data-stu-id="9efb4-149">To sort the data displayed in the Repeater, we need to inform the ObjectDataSource of the sort expression by which the data should be sorted.</span></span> <span data-ttu-id="9efb4-150">在 ObjectDataSource 检索其数据之前，它首先会激发其[`Selecting` 事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selecting.aspx)，这为我们提供了指定排序表达式的机会。</span><span class="sxs-lookup"><span data-stu-id="9efb4-150">Before the ObjectDataSource retrieves its data, it first fires its [`Selecting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selecting.aspx), which provides an opportunity for us to specify a sort expression.</span></span> <span data-ttu-id="9efb4-151">`Selecting` 事件处理程序传递[`ObjectDataSourceSelectingEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourceselectingeventargs.aspx)类型的对象，该对象的属性名为[`Arguments`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourceselectingeventargs.arguments.aspx) [`DataSourceSelectArguments`](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx)类型。</span><span class="sxs-lookup"><span data-stu-id="9efb4-151">The `Selecting` event handler is passed an object of type [`ObjectDataSourceSelectingEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourceselectingeventargs.aspx), which has a property named [`Arguments`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasourceselectingeventargs.arguments.aspx) of type [`DataSourceSelectArguments`](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx).</span></span> <span data-ttu-id="9efb4-152">`DataSourceSelectArguments` 类旨在将数据相关请求从数据使用者传递到数据源控件，并包括[`SortExpression` 属性](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.sortexpression.aspx)。</span><span class="sxs-lookup"><span data-stu-id="9efb4-152">The `DataSourceSelectArguments` class is designed to pass data-related requests from a consumer of data to the data source control, and includes a [`SortExpression` property](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.sortexpression.aspx).</span></span>

<span data-ttu-id="9efb4-153">若要将 ASP.NET 页中的排序信息传递到 ObjectDataSource，请为 `Selecting` 事件创建事件处理程序，并使用以下代码：</span><span class="sxs-lookup"><span data-stu-id="9efb4-153">To pass sorting information from the ASP.NET page to the ObjectDataSource, create an event handler for the `Selecting` event and use the following code:</span></span>

[!code-csharp[Main](sorting-data-in-a-datalist-or-repeater-control-cs/samples/sample2.cs)]

<span data-ttu-id="9efb4-154">应为*sortExpression*值分配数据字段的名称，以便对数据进行排序（例如 ProductName）。</span><span class="sxs-lookup"><span data-stu-id="9efb4-154">The *sortExpression* value should be assigned the name of the data field to sort the data by (such as ProductName ).</span></span> <span data-ttu-id="9efb4-155">没有与排序方向相关的属性，因此，如果要按降序对数据进行排序，请将字符串 DESC 追加到*sortExpression*值（例如 ProductName DESC）。</span><span class="sxs-lookup"><span data-stu-id="9efb4-155">There is no sort direction-related property, so if you want to sort the data in descending order, append the string DESC to the *sortExpression* value (such as ProductName DESC ).</span></span>

<span data-ttu-id="9efb4-156">继续，尝试为*sortExpression*使用一些不同的硬编码值，并在浏览器中测试结果。</span><span class="sxs-lookup"><span data-stu-id="9efb4-156">Go ahead and try some different hard-coded values for *sortExpression* and test the results in a browser.</span></span> <span data-ttu-id="9efb4-157">如图4所示，使用 ProductName DESC 作为*sortExpression*时，产品按其名称以逆序字母顺序排序。</span><span class="sxs-lookup"><span data-stu-id="9efb4-157">As Figure 4 shows, when using ProductName DESC as the *sortExpression*, the products are sorted by their name in reverse alphabetical order.</span></span>

<span data-ttu-id="9efb4-158">[![产品按其名称以逆序字母顺序排序](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image11.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="9efb4-158">[![The Products are Sorted by their Name in Reverse Alphabetical Order](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image11.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image10.png)</span></span>

<span data-ttu-id="9efb4-159">**图 4**：产品按其名称以逆序字母顺序排序（[单击以查看完全大小的图像](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="9efb4-159">**Figure 4**: The Products are Sorted by their Name in Reverse Alphabetical Order ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image12.png))</span></span>

## <a name="step-4-creating-the-sorting-interface-and-remembering-the-sort-expression-and-direction"></a><span data-ttu-id="9efb4-160">步骤4：创建排序接口并记住排序表达式和方向</span><span class="sxs-lookup"><span data-stu-id="9efb4-160">Step 4: Creating the Sorting Interface and Remembering the Sort Expression and Direction</span></span>

<span data-ttu-id="9efb4-161">在 GridView 中开启排序支持将每个可排序字段的标头文本转换为 LinkButton，单击此项可对数据进行相应排序。</span><span class="sxs-lookup"><span data-stu-id="9efb4-161">Turning on sorting support in the GridView converts each sortable field s header text into a LinkButton that, when clicked, sorts the data accordingly.</span></span> <span data-ttu-id="9efb4-162">此类排序接口对 GridView 非常合理，其中的数据在列中整齐地布局。</span><span class="sxs-lookup"><span data-stu-id="9efb4-162">Such a sorting interface makes sense for the GridView, where its data is neatly laid out in columns.</span></span> <span data-ttu-id="9efb4-163">但对于 DataList 和 Repeater 控件，需要不同的排序接口。</span><span class="sxs-lookup"><span data-stu-id="9efb4-163">For the DataList and Repeater controls, however, a different sorting interface is needed.</span></span> <span data-ttu-id="9efb4-164">数据列表（而不是数据网格）的常见排序接口是一个下拉列表，提供可用于对数据进行排序的字段。</span><span class="sxs-lookup"><span data-stu-id="9efb4-164">A common sorting interface for a list of data (as opposed to a grid of data), is a drop-down list that provides the fields by which the data can be sorted.</span></span> <span data-ttu-id="9efb4-165">在本教程中，让 s 实现此类接口。</span><span class="sxs-lookup"><span data-stu-id="9efb4-165">Let s implement such an interface for this tutorial.</span></span>

<span data-ttu-id="9efb4-166">将 DropDownList Web 控件添加到 `SortableProducts` Repeater 上，并将其 `ID` 属性设置为 "`SortBy`"。</span><span class="sxs-lookup"><span data-stu-id="9efb4-166">Add a DropDownList Web control above the `SortableProducts` Repeater and set its `ID` property to `SortBy`.</span></span> <span data-ttu-id="9efb4-167">在属性窗口中，单击 "`Items`" 属性中的省略号以显示 "有选择的集合编辑器"。</span><span class="sxs-lookup"><span data-stu-id="9efb4-167">From the Properties window, click the ellipses in the `Items` property to bring up the ListItem Collection Editor.</span></span> <span data-ttu-id="9efb4-168">添加 `ListItem` 以便按 `ProductName`、`CategoryName`和 `SupplierName` 字段对数据进行排序。</span><span class="sxs-lookup"><span data-stu-id="9efb4-168">Add `ListItem` s to sort the data by the `ProductName`, `CategoryName`, and `SupplierName` fields.</span></span> <span data-ttu-id="9efb4-169">另外，还可以添加一个 `ListItem` 以便按其名称以逆序字母顺序对产品进行排序。</span><span class="sxs-lookup"><span data-stu-id="9efb4-169">Also add a `ListItem` to sort the products by their name in reverse alphabetical order.</span></span>

<span data-ttu-id="9efb4-170">`ListItem` `Text` 属性可以设置为任何值（例如名称），但 `Value` 属性必须设置为数据字段的名称（例如 ProductName）。</span><span class="sxs-lookup"><span data-stu-id="9efb4-170">The `ListItem` `Text` properties can be set to any value (such as Name ), but the `Value` properties must be set to the name of the data field (such as ProductName ).</span></span> <span data-ttu-id="9efb4-171">若要按降序对结果进行排序，请将字符串 DESC 追加到数据字段名称，如 ProductName DESC。</span><span class="sxs-lookup"><span data-stu-id="9efb4-171">To sort the results in descending order, append the string DESC to the data field name, like ProductName DESC .</span></span>

![为每个可排序的数据字段添加一个项](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image13.png)

<span data-ttu-id="9efb4-173">**图 5**：为每个可排序的数据字段添加 `ListItem`</span><span class="sxs-lookup"><span data-stu-id="9efb4-173">**Figure 5**: Add a `ListItem` for Each of the Sortable Data Fields</span></span>

<span data-ttu-id="9efb4-174">最后，在 DropDownList 右侧添加一个按钮 Web 控件。</span><span class="sxs-lookup"><span data-stu-id="9efb4-174">Finally, add a Button Web control to the right of the DropDownList.</span></span> <span data-ttu-id="9efb4-175">将其 `ID` 设置为 `RefreshRepeater` 及其 `Text` 属性进行刷新。</span><span class="sxs-lookup"><span data-stu-id="9efb4-175">Set its `ID` to `RefreshRepeater` and its `Text` property to Refresh .</span></span>

<span data-ttu-id="9efb4-176">创建 `ListItem` 并添加 "刷新" 按钮后，DropDownList 和按钮的声明性语法应类似于以下形式：</span><span class="sxs-lookup"><span data-stu-id="9efb4-176">After creating the `ListItem` s and adding the Refresh button, the DropDownList and Button s declarative syntax should look similar to the following:</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-cs/samples/sample3.aspx)]

<span data-ttu-id="9efb4-177">排序 DropDownList 完成后，接下来需要更新 ObjectDataSource `Selecting` 事件处理程序，使其使用所选 `SortBy``ListItem` s `Value` 属性，而不是硬编码的排序表达式。</span><span class="sxs-lookup"><span data-stu-id="9efb4-177">With the sorting DropDownList complete, we next need to update the ObjectDataSource s `Selecting` event handler so that it uses the selected `SortBy``ListItem` s `Value` property as opposed to a hard-coded sort expression.</span></span>

[!code-csharp[Main](sorting-data-in-a-datalist-or-repeater-control-cs/samples/sample4.cs)]

<span data-ttu-id="9efb4-178">此时，第一次访问该页面时，产品最初会按 `ProductName` 数据字段进行排序，因为它是默认选择的 `SortBy` `ListItem` （请参阅图6）。</span><span class="sxs-lookup"><span data-stu-id="9efb4-178">At this point when first visiting the page the products will initially be sorted by the `ProductName` data field, as it s the `SortBy` `ListItem` selected by default (see Figure 6).</span></span> <span data-ttu-id="9efb4-179">选择其他排序选项（如 "类别" 和 "刷新"）将导致回发并按类别名称对数据进行重新排序，如图7所示。</span><span class="sxs-lookup"><span data-stu-id="9efb4-179">Selecting a different sorting option such as Category and clicking Refresh will cause a postback and re-sort the data by the category name, as Figure 7 shows.</span></span>

<span data-ttu-id="9efb4-180">[![产品最初按其名称进行排序](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image15.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="9efb4-180">[![The Products are Initially Sorted by their Name](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image15.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image14.png)</span></span>

<span data-ttu-id="9efb4-181">**图 6**：产品最初按其名称进行排序（[单击以查看完全大小的图像](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image16.png)）</span><span class="sxs-lookup"><span data-stu-id="9efb4-181">**Figure 6**: The Products are Initially Sorted by their Name ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image16.png))</span></span>

<span data-ttu-id="9efb4-182">[![产品现在按类别排序](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image18.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="9efb4-182">[![The Products are Now Sorted by Category](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image18.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image17.png)</span></span>

<span data-ttu-id="9efb4-183">**图 7**：产品现在按类别排序（[单击查看完全尺寸的图像](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image19.png)）</span><span class="sxs-lookup"><span data-stu-id="9efb4-183">**Figure 7**: The Products are Now Sorted by Category ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image19.png))</span></span>

> [!NOTE]
> <span data-ttu-id="9efb4-184">单击 "刷新" 按钮将导致自动对数据进行重新排序，因为 Repeater 的视图状态已禁用，从而导致 Repeater 在每次回发时重新绑定到其数据源。</span><span class="sxs-lookup"><span data-stu-id="9efb4-184">Clicking the Refresh button causes the data to automatically be re-sorted because the Repeater s view state has been disabled, thereby causing the Repeater to rebind to its data source on every postback.</span></span> <span data-ttu-id="9efb4-185">如果已启用 "中继器" 视图状态，更改 "排序" 下拉列表将不会对排序顺序产生任何影响。</span><span class="sxs-lookup"><span data-stu-id="9efb4-185">If you ve left the Repeater s view state enabled, changing the sorting drop-down list won't have any affect on the sort order.</span></span> <span data-ttu-id="9efb4-186">若要解决此情况，请为 "刷新" 按钮的 `Click` 事件创建事件处理程序，并将中继器重新绑定到其数据源（通过调用 Repeater s `DataBind()` 方法）。</span><span class="sxs-lookup"><span data-stu-id="9efb4-186">To remedy this, create an event handler for the Refresh Button s `Click` event and rebind the Repeater to its data source (by calling the Repeater s `DataBind()` method).</span></span>

## <a name="remembering-the-sort-expression-and-direction"></a><span data-ttu-id="9efb4-187">记住排序表达式和方向</span><span class="sxs-lookup"><span data-stu-id="9efb4-187">Remembering the Sort Expression and Direction</span></span>

<span data-ttu-id="9efb4-188">在可能发生非排序相关回发的页上创建可排序的 DataList 或 Repeater 时，需要在回发之间记住排序表达式和方向。</span><span class="sxs-lookup"><span data-stu-id="9efb4-188">When creating a sortable DataList or Repeater on a page where non-sort related postbacks may occur, it s imperative that the sort expression and direction be remembered across postbacks.</span></span> <span data-ttu-id="9efb4-189">例如，假设我们在本教程中更新了中继器，以包含每个产品的 "删除" 按钮。</span><span class="sxs-lookup"><span data-stu-id="9efb4-189">For example, imagine that we updated the Repeater in this tutorial to include a Delete button with each product.</span></span> <span data-ttu-id="9efb4-190">当用户单击 "删除" 按钮时，我们将运行一些代码来删除所选产品，然后将数据重新绑定到中继器。</span><span class="sxs-lookup"><span data-stu-id="9efb4-190">When the user clicks the Delete button we d run some code to delete the selected product and then rebind the data to the Repeater.</span></span> <span data-ttu-id="9efb4-191">如果未在回发期间保留排序详细信息，则屏幕上显示的数据将恢复为原始排序顺序。</span><span class="sxs-lookup"><span data-stu-id="9efb4-191">If the sort details are not persisted across postback, the data displayed on screen will revert to the original sort order.</span></span>

<span data-ttu-id="9efb4-192">对于本教程，DropDownList 会将排序表达式和方向隐式保存到我们的视图状态。</span><span class="sxs-lookup"><span data-stu-id="9efb4-192">For this tutorial, the DropDownList implicitly saves the sort expression and direction in its view state for us.</span></span> <span data-ttu-id="9efb4-193">如果我们使用的是不同的排序接口，比如，LinkButtons 提供了各种排序选项，则需要注意，请记住跨回发的排序顺序。</span><span class="sxs-lookup"><span data-stu-id="9efb4-193">If we were using a different sorting interface one with, say, LinkButtons that provided the various sorting options we d need to take care to remember the sort order across postbacks.</span></span> <span data-ttu-id="9efb4-194">这可以通过在页的视图状态中存储排序参数来实现，方法是在查询字符串中包含 sort 参数，或者通过某些其他状态持久性方法。</span><span class="sxs-lookup"><span data-stu-id="9efb4-194">This could be accomplished by storing the sorting parameters in the page s view state, by including the sort parameter in the querystring, or through some other state persistence technique.</span></span>

<span data-ttu-id="9efb4-195">本教程中的后续示例将探讨如何在页的视图状态中保存排序详细信息。</span><span class="sxs-lookup"><span data-stu-id="9efb4-195">Future examples in this tutorial explore how to persist the sorting details in the page s view state.</span></span>

## <a name="step-5-adding-sorting-support-to-a-datalist-that-uses-default-paging"></a><span data-ttu-id="9efb4-196">步骤5：将排序支持添加到使用默认分页的 DataList</span><span class="sxs-lookup"><span data-stu-id="9efb4-196">Step 5: Adding Sorting Support to a DataList that Uses Default Paging</span></span>

<span data-ttu-id="9efb4-197">在[前面的教程](paging-report-data-in-a-datalist-or-repeater-control-cs.md)中，我们探讨了如何使用 DataList 实现默认分页。</span><span class="sxs-lookup"><span data-stu-id="9efb4-197">In the [preceding tutorial](paging-report-data-in-a-datalist-or-repeater-control-cs.md) we examined how to implement default paging with a DataList.</span></span> <span data-ttu-id="9efb4-198">让我们扩展前面的示例，以包括对分页数据进行排序的功能。</span><span class="sxs-lookup"><span data-stu-id="9efb4-198">Let s extend this previous example to include the ability to sort the paged data.</span></span> <span data-ttu-id="9efb4-199">首先打开 `PagingSortingDataListRepeater` 文件夹中的 `SortingWithDefaultPaging.aspx` 和 `Paging.aspx` 页面。</span><span class="sxs-lookup"><span data-stu-id="9efb4-199">Start by opening the `SortingWithDefaultPaging.aspx` and `Paging.aspx` pages in the `PagingSortingDataListRepeater` folder.</span></span> <span data-ttu-id="9efb4-200">在 "`Paging.aspx`" 页上，单击 "源" 按钮以查看页面的声明性标记。</span><span class="sxs-lookup"><span data-stu-id="9efb4-200">From the `Paging.aspx` page, click on the Source button to view the page s declarative markup.</span></span> <span data-ttu-id="9efb4-201">复制所选文本（见图8），然后将其粘贴到 `<asp:Content>` 标记之间 `SortingWithDefaultPaging.aspx` 的声明性标记中。</span><span class="sxs-lookup"><span data-stu-id="9efb4-201">Copy the selected text (see Figure 8) and paste it into the declarative markup of `SortingWithDefaultPaging.aspx` between the `<asp:Content>` tags.</span></span>

<span data-ttu-id="9efb4-202">[![将 &lt;asp： Content&gt; 标记中的声明性标记从页面 .aspx 复制到 SortingWithDefaultPaging](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image21.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="9efb4-202">[![Replicate the Declarative Markup in the &lt;asp:Content&gt; Tags from Paging.aspx to SortingWithDefaultPaging.aspx](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image21.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image20.png)</span></span>

<span data-ttu-id="9efb4-203">**图 8**：将 `<asp:Content>` 标记中的声明性标记从 `Paging.aspx` 复制到 `SortingWithDefaultPaging.aspx` （[单击查看完全大小的图像](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image22.png)）</span><span class="sxs-lookup"><span data-stu-id="9efb4-203">**Figure 8**: Replicate the Declarative Markup in the `<asp:Content>` Tags from `Paging.aspx` to `SortingWithDefaultPaging.aspx` ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image22.png))</span></span>

<span data-ttu-id="9efb4-204">复制声明性标记后，将 `Paging.aspx` 页 s 代码隐藏类中的方法和属性复制到 `SortingWithDefaultPaging.aspx`的代码隐藏类。</span><span class="sxs-lookup"><span data-stu-id="9efb4-204">After copying the declarative markup, copy the methods and properties in the `Paging.aspx` page s code-behind class to the code-behind class for `SortingWithDefaultPaging.aspx`.</span></span> <span data-ttu-id="9efb4-205">接下来，请花点时间查看浏览器中的 "`SortingWithDefaultPaging.aspx`" 页。</span><span class="sxs-lookup"><span data-stu-id="9efb4-205">Next, take a moment to view the `SortingWithDefaultPaging.aspx` page in a browser.</span></span> <span data-ttu-id="9efb4-206">它应表现出与 `Paging.aspx`相同的功能和外观。</span><span class="sxs-lookup"><span data-stu-id="9efb4-206">It should exhibit the same functionality and appearance as `Paging.aspx`.</span></span>

## <a name="enhancing-productsbll-to-include-a-default-paging-and-sorting-method"></a><span data-ttu-id="9efb4-207">增强 ProductsBLL 以包含默认分页和排序方法</span><span class="sxs-lookup"><span data-stu-id="9efb4-207">Enhancing ProductsBLL to Include a Default Paging and Sorting Method</span></span>

<span data-ttu-id="9efb4-208">在上一教程中，我们在 `ProductsBLL` 类中创建了一个 `GetProductsAsPagedDataSource(pageIndex, pageSize)` 方法，该方法返回 `PagedDataSource` 对象。</span><span class="sxs-lookup"><span data-stu-id="9efb4-208">In the previous tutorial we created a `GetProductsAsPagedDataSource(pageIndex, pageSize)` method in the `ProductsBLL` class that returned a `PagedDataSource` object.</span></span> <span data-ttu-id="9efb4-209">此 `PagedDataSource` 对象是用*所有*产品（通过 BLL 的 `GetProducts()` 方法）填充的，但是当绑定到 DataList 时，仅显示与指定*pageIndex*和*pageSize*输入参数相对应的记录。</span><span class="sxs-lookup"><span data-stu-id="9efb4-209">This `PagedDataSource` object was populated with *all* of the products (via the BLL s `GetProducts()` method), but when bound to the DataList only those records corresponding to the specified *pageIndex* and *pageSize* input parameters were displayed.</span></span>

<span data-ttu-id="9efb4-210">在本教程的前面部分，我们通过指定 ObjectDataSource s `Selecting` 事件处理程序中的排序表达式来添加排序支持。</span><span class="sxs-lookup"><span data-stu-id="9efb4-210">Earlier in this tutorial we added sorting support by specifying the sort expression from the ObjectDataSource s `Selecting` event handler.</span></span> <span data-ttu-id="9efb4-211">当 ObjectDataSource 返回一个可进行排序的对象（如 `GetProducts()` 方法返回的 `ProductsDataTable`）时，这非常有效。</span><span class="sxs-lookup"><span data-stu-id="9efb4-211">This works well when the ObjectDataSource is returned an object that can be sorted, like the `ProductsDataTable` returned by the `GetProducts()` method.</span></span> <span data-ttu-id="9efb4-212">但是，`GetProductsAsPagedDataSource` 方法返回的 `PagedDataSource` 对象不支持对其内部数据源进行排序。</span><span class="sxs-lookup"><span data-stu-id="9efb4-212">However, the `PagedDataSource` object returned by the `GetProductsAsPagedDataSource` method does not support sorting of its inner data source.</span></span> <span data-ttu-id="9efb4-213">相反，我们需要先对从 `GetProducts()` 方法返回的结果进行排序，*然后再*将其放入 `PagedDataSource`。</span><span class="sxs-lookup"><span data-stu-id="9efb4-213">Instead, we need to sort the results returned from the `GetProducts()` method *before* we put it in the `PagedDataSource`.</span></span>

<span data-ttu-id="9efb4-214">若要实现此目的，请在 `ProductsBLL` 类中创建一个新方法，`GetProductsSortedAsPagedDataSource(sortExpression, pageIndex, pageSize)`。</span><span class="sxs-lookup"><span data-stu-id="9efb4-214">To accomplish this, create a new method in the `ProductsBLL` class, `GetProductsSortedAsPagedDataSource(sortExpression, pageIndex, pageSize)`.</span></span> <span data-ttu-id="9efb4-215">若要对 `GetProducts()` 方法返回的 `ProductsDataTable` 进行排序，请指定其默认 `DataTableView`的 `Sort` 属性：</span><span class="sxs-lookup"><span data-stu-id="9efb4-215">To sort the `ProductsDataTable` returned by the `GetProducts()` method, specify the `Sort` property of its default `DataTableView`:</span></span>

[!code-csharp[Main](sorting-data-in-a-datalist-or-repeater-control-cs/samples/sample5.cs)]

<span data-ttu-id="9efb4-216">`GetProductsSortedAsPagedDataSource` 方法与上一教程中创建的 `GetProductsAsPagedDataSource` 方法稍有不同。</span><span class="sxs-lookup"><span data-stu-id="9efb4-216">The `GetProductsSortedAsPagedDataSource` method differs only slightly from the `GetProductsAsPagedDataSource` method created in the previous tutorial.</span></span> <span data-ttu-id="9efb4-217">具体而言，`GetProductsSortedAsPagedDataSource` 接受附加输入参数 `sortExpression`，并将该值分配给 `ProductDataTable` `DefaultView`的 `Sort` 属性。</span><span class="sxs-lookup"><span data-stu-id="9efb4-217">In particular, `GetProductsSortedAsPagedDataSource` accepts an additional input parameter `sortExpression` and assigns this value to the `Sort` property of the `ProductDataTable` s `DefaultView`.</span></span> <span data-ttu-id="9efb4-218">几行代码稍后，会为 `PagedDataSource` 对象的数据源分配 `ProductDataTable` s `DefaultView`。</span><span class="sxs-lookup"><span data-stu-id="9efb4-218">A few lines of code later, the `PagedDataSource` object s DataSource is assigned the `ProductDataTable` s `DefaultView`.</span></span>

## <a name="calling-the-getproductssortedaspageddatasource-method-and-specifying-the-value-for-the-sortexpression-input-parameter"></a><span data-ttu-id="9efb4-219">调用 GetProductsSortedAsPagedDataSource 方法并指定 SortExpression 输入参数的值</span><span class="sxs-lookup"><span data-stu-id="9efb4-219">Calling the GetProductsSortedAsPagedDataSource Method and Specifying the Value for the SortExpression Input Parameter</span></span>

<span data-ttu-id="9efb4-220">完成 `GetProductsSortedAsPagedDataSource` 方法后，下一步是提供此参数的值。</span><span class="sxs-lookup"><span data-stu-id="9efb4-220">With the `GetProductsSortedAsPagedDataSource` method complete, the next step is to provide the value for this parameter.</span></span> <span data-ttu-id="9efb4-221">`SortingWithDefaultPaging.aspx` 中的 ObjectDataSource 当前配置为调用 `GetProductsAsPagedDataSource` 方法，并通过其两个 `QueryStringParameters`传递两个输入参数，这些参数在 `SelectParameters` 集合中指定。</span><span class="sxs-lookup"><span data-stu-id="9efb4-221">The ObjectDataSource in `SortingWithDefaultPaging.aspx` is currently configured to call the `GetProductsAsPagedDataSource` method and passes in the two input parameters through its two `QueryStringParameters`, which are specified in the `SelectParameters` collection.</span></span> <span data-ttu-id="9efb4-222">这两个 `QueryStringParameters` 表示 `GetProductsAsPagedDataSource` 方法 s *pageIndex*和*pageSize*参数的源来自 querystring 字段 `pageIndex` 和 `pageSize`。</span><span class="sxs-lookup"><span data-stu-id="9efb4-222">These two `QueryStringParameters` indicate that the source for the `GetProductsAsPagedDataSource` method s *pageIndex* and *pageSize* parameters come from the querystring fields `pageIndex` and `pageSize`.</span></span>

<span data-ttu-id="9efb4-223">更新 ObjectDataSource `SelectMethod` 属性，使其调用新的 `GetProductsSortedAsPagedDataSource` 方法。</span><span class="sxs-lookup"><span data-stu-id="9efb4-223">Update the ObjectDataSource s `SelectMethod` property so that it invokes the new `GetProductsSortedAsPagedDataSource` method.</span></span> <span data-ttu-id="9efb4-224">然后，添加一个新的 `QueryStringParameter`，以便从 querystring 字段 `sortExpression`访问*sortExpression*输入参数。</span><span class="sxs-lookup"><span data-stu-id="9efb4-224">Then, add a new `QueryStringParameter` so that the *sortExpression* input parameter is accessed from the querystring field `sortExpression`.</span></span> <span data-ttu-id="9efb4-225">将 `QueryStringParameter` `DefaultValue` 设置为 "ProductName"。</span><span class="sxs-lookup"><span data-stu-id="9efb4-225">Set the `QueryStringParameter` s `DefaultValue` to ProductName .</span></span>

<span data-ttu-id="9efb4-226">进行这些更改后，ObjectDataSource 的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="9efb4-226">After these changes, the ObjectDataSource s declarative markup should look like:</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-cs/samples/sample6.aspx)]

<span data-ttu-id="9efb4-227">此时，"`SortingWithDefaultPaging.aspx`" 页将按产品名称的字母顺序对其结果进行排序（参见图9）。</span><span class="sxs-lookup"><span data-stu-id="9efb4-227">At this point, the `SortingWithDefaultPaging.aspx` page will sort its results alphabetically by the product name (see Figure 9).</span></span> <span data-ttu-id="9efb4-228">这是因为，默认情况下，ProductName 的值作为 `GetProductsSortedAsPagedDataSource` 方法 s *sortExpression*参数传入。</span><span class="sxs-lookup"><span data-stu-id="9efb4-228">This is because, by default, a value of ProductName is passed in as the `GetProductsSortedAsPagedDataSource` method s *sortExpression* parameter.</span></span>

<span data-ttu-id="9efb4-229">[![默认情况下，结果按 ProductName 排序](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image24.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="9efb4-229">[![By Default, the Results are Sorted by ProductName](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image24.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image23.png)</span></span>

<span data-ttu-id="9efb4-230">**图 9**：默认情况下，结果按 `ProductName` 排序（[单击查看完全大小的图像](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image25.png)）</span><span class="sxs-lookup"><span data-stu-id="9efb4-230">**Figure 9**: By Default, the Results are Sorted by `ProductName` ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image25.png))</span></span>

<span data-ttu-id="9efb4-231">如果手动添加 `sortExpression` querystring 字段，如 `SortingWithDefaultPaging.aspx?sortExpression=CategoryName` 结果将按指定 `sortExpression`排序。</span><span class="sxs-lookup"><span data-stu-id="9efb4-231">If you manually add a `sortExpression` querystring field such as `SortingWithDefaultPaging.aspx?sortExpression=CategoryName` the results will be sorted by the specified `sortExpression`.</span></span> <span data-ttu-id="9efb4-232">但是，当移动到不同的数据页时，此 `sortExpression` 参数不会包含在查询字符串中。</span><span class="sxs-lookup"><span data-stu-id="9efb4-232">However, this `sortExpression` parameter is not included in the querystring when moving to a different page of data.</span></span> <span data-ttu-id="9efb4-233">事实上，单击 "下一步" 或 "最后一页" 按钮会使我们恢复 `Paging.aspx`！</span><span class="sxs-lookup"><span data-stu-id="9efb4-233">In fact, clicking on the Next or Last page buttons takes us back to `Paging.aspx`!</span></span> <span data-ttu-id="9efb4-234">此外，目前还没有排序接口。</span><span class="sxs-lookup"><span data-stu-id="9efb4-234">Furthermore, there s currently no sorting interface.</span></span> <span data-ttu-id="9efb4-235">用户可以更改分页数据的排序顺序的唯一方式是直接操作 querystring。</span><span class="sxs-lookup"><span data-stu-id="9efb4-235">The only way a user can change the sort order of the paged data is by manipulating the querystring directly.</span></span>

## <a name="creating-the-sorting-interface"></a><span data-ttu-id="9efb4-236">创建排序接口</span><span class="sxs-lookup"><span data-stu-id="9efb4-236">Creating the Sorting Interface</span></span>

<span data-ttu-id="9efb4-237">首先需要更新 `RedirectUser` 方法，以便将用户发送到 `SortingWithDefaultPaging.aspx` （而不是 `Paging.aspx`）并将 `sortExpression` 值包含在 querystring 中。</span><span class="sxs-lookup"><span data-stu-id="9efb4-237">We first need to update the `RedirectUser` method to send the user to `SortingWithDefaultPaging.aspx` (instead of `Paging.aspx`) and to include the `sortExpression` value in the querystring.</span></span> <span data-ttu-id="9efb4-238">还应添加一个名为 `SortExpression` 属性的只读页面级。</span><span class="sxs-lookup"><span data-stu-id="9efb4-238">We should also add a read-only, page-level named `SortExpression` property.</span></span> <span data-ttu-id="9efb4-239">此属性类似于在上一教程中创建的 `PageIndex` 和 `PageSize` 属性，如果存在，则返回 `sortExpression` querystring 字段的值，否则返回默认值（ProductName）。</span><span class="sxs-lookup"><span data-stu-id="9efb4-239">This property, similar to the `PageIndex` and `PageSize` properties created in the previous tutorial, returns the value of the `sortExpression` querystring field if it exists, and the default value ( ProductName ) otherwise.</span></span>

<span data-ttu-id="9efb4-240">目前 `RedirectUser` 方法仅接受单个输入参数要显示的页的索引。</span><span class="sxs-lookup"><span data-stu-id="9efb4-240">Currently the `RedirectUser` method accepts only a single input parameter the index of the page to display.</span></span> <span data-ttu-id="9efb4-241">不过，有时我们希望使用排序表达式（而不是查询字符串中指定的内容）将用户重定向到特定的数据页。</span><span class="sxs-lookup"><span data-stu-id="9efb4-241">However, there may be times when we want to redirect the user to a particular page of data using a sort expression other than what s specified in the querystring.</span></span> <span data-ttu-id="9efb4-242">稍后我们将为此页面创建排序界面，其中包含一系列用于按指定列对数据进行排序的按钮 Web 控件。</span><span class="sxs-lookup"><span data-stu-id="9efb4-242">In a moment we'll create the sorting interface for this page, which will include a series of Button Web controls for sorting the data by a specified column.</span></span> <span data-ttu-id="9efb4-243">单击其中一个按钮时，我们希望重定向用户，并传入适当的排序表达式值。</span><span class="sxs-lookup"><span data-stu-id="9efb4-243">When one of those Buttons is clicked, we want to redirect the user passing in the appropriate sort expression value.</span></span> <span data-ttu-id="9efb4-244">若要提供此功能，请创建 `RedirectUser` 方法的两个版本。</span><span class="sxs-lookup"><span data-stu-id="9efb4-244">To provide this functionality, create two versions of the `RedirectUser` method.</span></span> <span data-ttu-id="9efb4-245">第一个应该只接受要显示的页索引，而第二个只接受页索引和排序表达式。</span><span class="sxs-lookup"><span data-stu-id="9efb4-245">The first one should accept just the page index to display, while the second one accepts the page index and sort expression.</span></span>

[!code-csharp[Main](sorting-data-in-a-datalist-or-repeater-control-cs/samples/sample7.cs)]

<span data-ttu-id="9efb4-246">在本教程的第一个示例中，我们使用 DropDownList 创建了排序接口。</span><span class="sxs-lookup"><span data-stu-id="9efb4-246">In the first example in this tutorial, we created a sorting interface using a DropDownList.</span></span> <span data-ttu-id="9efb4-247">在此示例中，让我们使用位于 DataList 一的三个按钮 Web 控件进行排序，`ProductName`，一个用于 `CategoryName`，另一个用于 `SupplierName`。</span><span class="sxs-lookup"><span data-stu-id="9efb4-247">For this example, let s use three Button Web controls positioned above the DataList one for sorting by `ProductName`, one for `CategoryName`, and one for `SupplierName`.</span></span> <span data-ttu-id="9efb4-248">添加三个按钮 Web 控件，并相应地设置其 `ID` 和 `Text` 属性：</span><span class="sxs-lookup"><span data-stu-id="9efb4-248">Add the three Button Web controls, setting their `ID` and `Text` properties appropriately:</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-cs/samples/sample8.aspx)]

<span data-ttu-id="9efb4-249">接下来，为每个创建一个 `Click` 事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="9efb4-249">Next, create a `Click` event handler for each.</span></span> <span data-ttu-id="9efb4-250">事件处理程序应调用 `RedirectUser` 方法，并使用相应的排序表达式将用户返回到第一页。</span><span class="sxs-lookup"><span data-stu-id="9efb4-250">The event handlers should call the `RedirectUser` method, returning the user to the first page using the appropriate sort expression.</span></span>

[!code-csharp[Main](sorting-data-in-a-datalist-or-repeater-control-cs/samples/sample9.cs)]

<span data-ttu-id="9efb4-251">首次访问该页面时，数据按产品名称字母顺序排序（请参阅图9）。</span><span class="sxs-lookup"><span data-stu-id="9efb4-251">When first visiting the page, the data is sorted by the product name alphabetically (refer back to Figure 9).</span></span> <span data-ttu-id="9efb4-252">单击 "下一步" 按钮转到第二页数据，然后单击 "按类别排序" 按钮。</span><span class="sxs-lookup"><span data-stu-id="9efb4-252">Click the Next button to advance to the second page of data and then click the Sort by Category button.</span></span> <span data-ttu-id="9efb4-253">这会将我们返回到第一页数据，按类别名称排序（请参阅图10）。</span><span class="sxs-lookup"><span data-stu-id="9efb4-253">This returns us to the first page of data, sorted by category name (see Figure 10).</span></span> <span data-ttu-id="9efb4-254">同样，单击 "按供应商排序" 按钮会按供应商从数据的第一页对数据进行排序。</span><span class="sxs-lookup"><span data-stu-id="9efb4-254">Likewise, clicking the Sort by Supplier button sorts the data by supplier starting from the first page of data.</span></span> <span data-ttu-id="9efb4-255">数据分页到后，会记住排序选项。</span><span class="sxs-lookup"><span data-stu-id="9efb4-255">The sort choice is remembered as the data is paged through.</span></span> <span data-ttu-id="9efb4-256">图11按类别排序后显示该页，然后转到第十三个数据页。</span><span class="sxs-lookup"><span data-stu-id="9efb4-256">Figure 11 shows the page after sorting by category and then advancing to the thirteenth page of data.</span></span>

<span data-ttu-id="9efb4-257">[按类别对产品进行排序 ![](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image27.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="9efb4-257">[![The Products are Sorted by Category](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image27.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image26.png)</span></span>

<span data-ttu-id="9efb4-258">**图 10**：按类别对产品进行排序（[单击查看全尺寸图像](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image28.png)）</span><span class="sxs-lookup"><span data-stu-id="9efb4-258">**Figure 10**: The Products are Sorted by Category ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image28.png))</span></span>

<span data-ttu-id="9efb4-259">[![在分页数据时记住排序表达式](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image30.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="9efb4-259">[![The Sort Expression is Remembered When Paging Through the Data](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image30.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image29.png)</span></span>

<span data-ttu-id="9efb4-260">**图 11**：对数据进行分页时，将记住排序表达式（[单击以查看完全大小的图像](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image31.png)）</span><span class="sxs-lookup"><span data-stu-id="9efb4-260">**Figure 11**: The Sort Expression is Remembered When Paging Through the Data ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image31.png))</span></span>

## <a name="step-6-custom-paging-through-records-in-a-repeater"></a><span data-ttu-id="9efb4-261">步骤6：通过中继器中的记录进行自定义分页</span><span class="sxs-lookup"><span data-stu-id="9efb4-261">Step 6: Custom Paging Through Records in a Repeater</span></span>

<span data-ttu-id="9efb4-262">通过使用低效的默认分页技术，在步骤5页面中通过其数据检查 DataList 示例。</span><span class="sxs-lookup"><span data-stu-id="9efb4-262">The DataList example examined in step 5 pages through its data using the inefficient default paging technique.</span></span> <span data-ttu-id="9efb4-263">当对大量数据进行分页时，必须使用自定义分页。</span><span class="sxs-lookup"><span data-stu-id="9efb4-263">When paging through sufficiently large amounts of data, it is imperative that custom paging be used.</span></span> <span data-ttu-id="9efb4-264">返回[到通过大量数据有效分页](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs.md)并对[自定义分页数据进行排序](../paging-and-sorting/sorting-custom-paged-data-cs.md)教程，我们探讨了默认值和自定义分页之间的差异，以及在 BLL 中创建的方法，以便利用自定义分页数据和对自定义分页数据进行排序。</span><span class="sxs-lookup"><span data-stu-id="9efb4-264">Back in the [Efficiently Paging Through Large Amounts of Data](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs.md) and [Sorting Custom Paged Data](../paging-and-sorting/sorting-custom-paged-data-cs.md) tutorials, we examined the differences between default and custom paging and created methods in the BLL for utilizing custom paging and sorting custom paged data.</span></span> <span data-ttu-id="9efb4-265">具体而言，在这两个以前的教程中，我们向 `ProductsBLL` 类中添加了以下三种方法：</span><span class="sxs-lookup"><span data-stu-id="9efb4-265">In particular, in these two previous tutorials we added the following three methods to the `ProductsBLL` class:</span></span>

- <span data-ttu-id="9efb4-266">`GetProductsPaged(startRowIndex, maximumRows)` 返回一小部分记录，从*startRowIndex*开始，而不是超过*maximumRows*。</span><span class="sxs-lookup"><span data-stu-id="9efb4-266">`GetProductsPaged(startRowIndex, maximumRows)` returns a particular subset of records starting at *startRowIndex* and not exceeding *maximumRows*.</span></span>
- <span data-ttu-id="9efb4-267">`GetProductsPagedAndSorted(sortExpression, startRowIndex, maximumRows)` 返回按指定*sortExpression*输入参数排序的特定记录子集。</span><span class="sxs-lookup"><span data-stu-id="9efb4-267">`GetProductsPagedAndSorted(sortExpression, startRowIndex, maximumRows)` returns a particular subset of records sorted by the specified *sortExpression* input parameter.</span></span>
- <span data-ttu-id="9efb4-268">`TotalNumberOfProducts()` 提供 `Products` 数据库表中的记录总数。</span><span class="sxs-lookup"><span data-stu-id="9efb4-268">`TotalNumberOfProducts()` provides the total number of records in the `Products` database table.</span></span>

<span data-ttu-id="9efb4-269">可以使用这些方法通过 DataList 或 Repeater 控件高效地对数据进行分页和排序。</span><span class="sxs-lookup"><span data-stu-id="9efb4-269">These methods can be used to efficiently page and sort through data using a DataList or Repeater control.</span></span> <span data-ttu-id="9efb4-270">为了说明这一点，让我们首先创建一个具有自定义分页支持的中继器控件;接下来，我们将添加排序功能。</span><span class="sxs-lookup"><span data-stu-id="9efb4-270">To illustrate this, let s start by creating a Repeater control with custom paging support; we'll then add sorting capabilities.</span></span>

<span data-ttu-id="9efb4-271">打开 `PagingSortingDataListRepeater` 文件夹中的 "`SortingWithCustomPaging.aspx`" 页，并向页面中添加中继器，并将其 `ID` 属性设置为 "`Products`"。</span><span class="sxs-lookup"><span data-stu-id="9efb4-271">Open the `SortingWithCustomPaging.aspx` page in the `PagingSortingDataListRepeater` folder and add a Repeater to the page, setting its `ID` property to `Products`.</span></span> <span data-ttu-id="9efb4-272">从 "Repeater" 智能标记中，创建一个名为 `ProductsDataSource`的新 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="9efb4-272">From the Repeater s smart tag, create a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="9efb4-273">将其配置为从 `ProductsBLL` 类 `GetProductsPaged` 方法中选择其数据。</span><span class="sxs-lookup"><span data-stu-id="9efb4-273">Configure it to select its data from the `ProductsBLL` class s `GetProductsPaged` method.</span></span>

<span data-ttu-id="9efb4-274">[![将 ObjectDataSource 配置为使用 ProductsBLL Class s GetProductsPaged 方法](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image33.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="9efb4-274">[![Configure the ObjectDataSource to Use the ProductsBLL Class s GetProductsPaged Method](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image33.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image32.png)</span></span>

<span data-ttu-id="9efb4-275">**图 12**：将 ObjectDataSource 配置为使用 `ProductsBLL` 类 `GetProductsPaged` 方法（[单击以查看完全大小的映像](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image34.png)）</span><span class="sxs-lookup"><span data-stu-id="9efb4-275">**Figure 12**: Configure the ObjectDataSource to Use the `ProductsBLL` Class s `GetProductsPaged` Method ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image34.png))</span></span>

<span data-ttu-id="9efb4-276">将 "更新"、"插入" 和 "删除" 选项卡中的下拉列表设置为 "（无）"，然后单击 "下一步" 按钮。</span><span class="sxs-lookup"><span data-stu-id="9efb4-276">Set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) and then click the Next button.</span></span> <span data-ttu-id="9efb4-277">"配置数据源" 向导现在会提示输入 `GetProductsPaged` 方法*startRowIndex*和*maximumRows*输入参数的源。</span><span class="sxs-lookup"><span data-stu-id="9efb4-277">The Configure Data Source wizard now prompts for the sources of the `GetProductsPaged` method s *startRowIndex* and *maximumRows* input parameters.</span></span> <span data-ttu-id="9efb4-278">事实上，会忽略这些输入参数。</span><span class="sxs-lookup"><span data-stu-id="9efb4-278">In actuality, these input parameters are ignored.</span></span> <span data-ttu-id="9efb4-279">相反， *startRowIndex*和*maximumRows*值将通过 ObjectDataSource `Selecting` 事件处理程序中的 `Arguments` 属性传入，就像我们在本教程的第一个演示中指定*sortExpression*的方式一样。</span><span class="sxs-lookup"><span data-stu-id="9efb4-279">Instead, the *startRowIndex* and *maximumRows* values will be passed in through the `Arguments` property in the ObjectDataSource s `Selecting` event handler, just like how we specified the *sortExpression* in this tutorial s first demo.</span></span> <span data-ttu-id="9efb4-280">因此，请在向导中将 "参数源" 下拉列表保留为 "无"。</span><span class="sxs-lookup"><span data-stu-id="9efb4-280">Therefore, leave the parameter source drop-down lists in the wizard set at None .</span></span>

<span data-ttu-id="9efb4-281">[![将参数源设置为 "无"](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image36.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="9efb4-281">[![Leave the Parameter Sources Set to None](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image36.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image35.png)</span></span>

<span data-ttu-id="9efb4-282">**图 13**：将参数源设置为 "无" （[单击查看完全大小的图像](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image37.png)）</span><span class="sxs-lookup"><span data-stu-id="9efb4-282">**Figure 13**: Leave the Parameter Sources Set to None ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image37.png))</span></span>

> [!NOTE]
> <span data-ttu-id="9efb4-283">不要将 ObjectDataSource `EnablePaging`*属性设置为*`true`。</span><span class="sxs-lookup"><span data-stu-id="9efb4-283">Do *not* set the ObjectDataSource s `EnablePaging` property to `true`.</span></span> <span data-ttu-id="9efb4-284">这将导致 ObjectDataSource 自动将其自己的*startRowIndex*和*maximumRows*参数添加到 `SelectMethod` 的现有参数列表中。</span><span class="sxs-lookup"><span data-stu-id="9efb4-284">This will cause the ObjectDataSource to automatically include its own *startRowIndex* and *maximumRows* parameters to the `SelectMethod` s existing parameter list.</span></span> <span data-ttu-id="9efb4-285">将自定义分页数据绑定到 GridView、DetailsView 或 FormView 控件时，`EnablePaging` 属性非常有用，因为这些控件预计在 `EnablePaging` 属性 `true`时，仅可用于 ObjectDataSource 的某些行为。</span><span class="sxs-lookup"><span data-stu-id="9efb4-285">The `EnablePaging` property is useful when binding custom paged data to a GridView, DetailsView, or FormView control because these controls expect certain behavior from the ObjectDataSource that s only available when `EnablePaging` property is `true`.</span></span> <span data-ttu-id="9efb4-286">由于我们必须手动添加 DataList 和 Repeater 的分页支持，因此，请将此属性设置为 `false` （默认值），因为我们会直接在 ASP.NET 页面中制作所需功能。</span><span class="sxs-lookup"><span data-stu-id="9efb4-286">Since we have to manually add the paging support for the DataList and Repeater, leave this property set to `false` (the default), as we'll bake in the needed functionality directly within our ASP.NET page.</span></span>

<span data-ttu-id="9efb4-287">最后，定义中继站 `ItemTemplate` 以便显示产品的名称、类别和供应商。</span><span class="sxs-lookup"><span data-stu-id="9efb4-287">Finally, define the Repeater s `ItemTemplate` so that the product s name, category, and supplier are shown.</span></span> <span data-ttu-id="9efb4-288">进行这些更改之后，中继器和 ObjectDataSource 声明性语法应类似于以下形式：</span><span class="sxs-lookup"><span data-stu-id="9efb4-288">After these changes, the Repeater and ObjectDataSource s declarative syntax should look similar to the following:</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-cs/samples/sample10.aspx)]

<span data-ttu-id="9efb4-289">请花点时间通过浏览器访问该页，并注意不返回任何记录。</span><span class="sxs-lookup"><span data-stu-id="9efb4-289">Take a moment to visit the page through a browser and note that no records are returned.</span></span> <span data-ttu-id="9efb4-290">这是因为我们还需要指定*startRowIndex*和*maximumRows*参数值;因此，为两者传入0值。</span><span class="sxs-lookup"><span data-stu-id="9efb4-290">This is because we ve yet to specify the *startRowIndex* and *maximumRows* parameter values; therefore, values of 0 are being passed in for both.</span></span> <span data-ttu-id="9efb4-291">若要指定这些值，请为 ObjectDataSource `Selecting` 事件创建事件处理程序，并以编程方式将这些参数值设置为分别为0和5的硬编码值：</span><span class="sxs-lookup"><span data-stu-id="9efb4-291">To specify these values, create an event handler for the ObjectDataSource s `Selecting` event and set these parameters values programmatically to hard-coded values of 0 and 5, respectively:</span></span>

[!code-csharp[Main](sorting-data-in-a-datalist-or-repeater-control-cs/samples/sample11.cs)]

<span data-ttu-id="9efb4-292">进行此更改后，在浏览器中查看页面时，会显示前5个产品。</span><span class="sxs-lookup"><span data-stu-id="9efb4-292">With this change, the page, when viewed through a browser, shows the first five products.</span></span>

<span data-ttu-id="9efb4-293">[显示前5条记录 ![](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image39.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image38.png)</span><span class="sxs-lookup"><span data-stu-id="9efb4-293">[![The First Five Records are Displayed](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image39.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image38.png)</span></span>

<span data-ttu-id="9efb4-294">**图 14**：显示前5条记录（[单击查看完全大小的图像](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image40.png)）</span><span class="sxs-lookup"><span data-stu-id="9efb4-294">**Figure 14**: The First Five Records are Displayed ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image40.png))</span></span>

> [!NOTE]
> <span data-ttu-id="9efb4-295">图14中列出的产品将按产品名称进行排序，这是因为执行有效自定义分页查询的 `GetProductsPaged` 存储过程按 `ProductName`对结果进行排序。</span><span class="sxs-lookup"><span data-stu-id="9efb4-295">The products listed in Figure 14 happen to be sorted by product name because the `GetProductsPaged` stored procedure that performs the efficient custom paging query orders the results by `ProductName`.</span></span>

<span data-ttu-id="9efb4-296">为了允许用户单步执行页面，我们需要跟踪起始行索引和最大行数，并在回发之间记住这些值。</span><span class="sxs-lookup"><span data-stu-id="9efb4-296">In order to allow the user to step through the pages, we need to keep track of the start row index and maximum rows and remember these values across postbacks.</span></span> <span data-ttu-id="9efb4-297">在默认分页示例中，我们使用了 querystring 字段来保存这些值;对于此演示，让我们在页的视图状态中保存此信息。</span><span class="sxs-lookup"><span data-stu-id="9efb4-297">In the default paging example we used querystring fields to persist these values; for this demo, let s persist this information in the page s view state.</span></span> <span data-ttu-id="9efb4-298">创建以下两个属性：</span><span class="sxs-lookup"><span data-stu-id="9efb4-298">Create the following two properties:</span></span>

[!code-csharp[Main](sorting-data-in-a-datalist-or-repeater-control-cs/samples/sample12.cs)]

<span data-ttu-id="9efb4-299">接下来，更新选择事件处理程序中的代码，使其使用 `StartRowIndex` 和 `MaximumRows` 属性，而不是硬编码值0和5：</span><span class="sxs-lookup"><span data-stu-id="9efb4-299">Next, update the code in the Selecting event handler so that it uses the `StartRowIndex` and `MaximumRows` properties instead of the hard-coded values of 0 and 5:</span></span>

[!code-csharp[Main](sorting-data-in-a-datalist-or-repeater-control-cs/samples/sample13.cs)]

<span data-ttu-id="9efb4-300">此时，页面仍只显示前五个记录。</span><span class="sxs-lookup"><span data-stu-id="9efb4-300">At this point our page still shows just the first five records.</span></span> <span data-ttu-id="9efb4-301">但是，在设置了这些属性后，我们就可以创建分页接口了。</span><span class="sxs-lookup"><span data-stu-id="9efb4-301">However, with these properties in place, we re ready to create our paging interface.</span></span>

## <a name="adding-the-paging-interface"></a><span data-ttu-id="9efb4-302">添加分页接口</span><span class="sxs-lookup"><span data-stu-id="9efb4-302">Adding the Paging Interface</span></span>

<span data-ttu-id="9efb4-303">允许使用默认分页示例中使用的第一个、上一个、下一个和最后一个分页接口，包括显示正在查看的数据页的标签 Web 控件以及存在的总页数。</span><span class="sxs-lookup"><span data-stu-id="9efb4-303">Let s use the same First, Previous, Next, Last paging interface used in the default paging example, including the Label Web control that displays what page of data is being viewed and how many total pages exist.</span></span> <span data-ttu-id="9efb4-304">在中继器下面添加四个按钮 Web 控件和标签。</span><span class="sxs-lookup"><span data-stu-id="9efb4-304">Add the four Button Web controls and Label below the Repeater.</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-cs/samples/sample14.aspx)]

<span data-ttu-id="9efb4-305">接下来，为四个按钮创建 `Click` 事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="9efb4-305">Next, create `Click` event handlers for the four Buttons.</span></span> <span data-ttu-id="9efb4-306">单击其中一个按钮时，需要更新 `StartRowIndex`，然后将数据重新绑定到中继器。</span><span class="sxs-lookup"><span data-stu-id="9efb4-306">When one of these Buttons is clicked, we need to update the `StartRowIndex` and rebind the data to the Repeater.</span></span> <span data-ttu-id="9efb4-307">"上一步"、"上一步" 和 "下一步" 按钮的代码非常简单，但对于最后一个按钮，我们如何确定最后一个数据页的起始行索引？</span><span class="sxs-lookup"><span data-stu-id="9efb4-307">The code for the First, Previous, and Next buttons is simple enough, but for the Last button how do we determine the start row index for the last page of data?</span></span> <span data-ttu-id="9efb4-308">若要计算此索引以及能否确定是否应启用 "下一步" 和 "上一个" 按钮，我们需要知道正在分页到的记录数。</span><span class="sxs-lookup"><span data-stu-id="9efb4-308">To compute this index as well as being able to determine whether the Next and Last buttons should be enabled we need to know how many records in total are being paged through.</span></span> <span data-ttu-id="9efb4-309">可以通过调用 `ProductsBLL` 类 `TotalNumberOfProducts()` 方法来确定这一点。</span><span class="sxs-lookup"><span data-stu-id="9efb4-309">We can determine this by calling the `ProductsBLL` class s `TotalNumberOfProducts()` method.</span></span> <span data-ttu-id="9efb4-310">让我们创建一个名为 `TotalRowCount` 的只读属性，该属性将返回 `TotalNumberOfProducts()` 方法的结果：</span><span class="sxs-lookup"><span data-stu-id="9efb4-310">Let s create a read-only, page-level property named `TotalRowCount` that returns the results of the `TotalNumberOfProducts()` method:</span></span>

[!code-csharp[Main](sorting-data-in-a-datalist-or-repeater-control-cs/samples/sample15.cs)]

<span data-ttu-id="9efb4-311">通过此属性，我们现在可以确定最后一页的起始行索引。</span><span class="sxs-lookup"><span data-stu-id="9efb4-311">With this property we can now determine the last page s start row index.</span></span> <span data-ttu-id="9efb4-312">具体而言，它是 `TotalRowCount` 减1除以 `MaximumRows`（乘以 `MaximumRows`）的整数结果。</span><span class="sxs-lookup"><span data-stu-id="9efb4-312">Specifically, it s the integer result of the `TotalRowCount` minus 1 divided by `MaximumRows`, multiplied by `MaximumRows`.</span></span> <span data-ttu-id="9efb4-313">现在，我们可以为四个分页接口按钮编写 `Click` 事件处理程序：</span><span class="sxs-lookup"><span data-stu-id="9efb4-313">We can now write the `Click` event handlers for the four paging interface buttons:</span></span>

[!code-csharp[Main](sorting-data-in-a-datalist-or-repeater-control-cs/samples/sample16.cs)]

<span data-ttu-id="9efb4-314">最后，当查看第一页数据时，需要禁用分页界面中的第一个和最后一个按钮，并在查看最后一个页面时禁用 "下一个" 和 "最后一个" 按钮。</span><span class="sxs-lookup"><span data-stu-id="9efb4-314">Finally, we need to disable the First and Previous buttons in the paging interface when viewing the first page of data and the Next and Last buttons when viewing the last page.</span></span> <span data-ttu-id="9efb4-315">若要实现此目的，请将以下代码添加到 ObjectDataSource s `Selecting` 事件处理程序：</span><span class="sxs-lookup"><span data-stu-id="9efb4-315">To accomplish this, add the following code to the ObjectDataSource s `Selecting` event handler:</span></span>

[!code-csharp[Main](sorting-data-in-a-datalist-or-repeater-control-cs/samples/sample17.cs)]

<span data-ttu-id="9efb4-316">添加这些 `Click` 事件处理程序和代码以根据当前起始行索引启用或禁用分页接口元素后，请在浏览器中测试页面。</span><span class="sxs-lookup"><span data-stu-id="9efb4-316">After adding these `Click` event handlers and the code to enable or disable the paging interface elements based on the current start row index, test the page in a browser.</span></span> <span data-ttu-id="9efb4-317">如图15所示，第一次访问页面时，第一个和前一个按钮将被禁用。</span><span class="sxs-lookup"><span data-stu-id="9efb4-317">As Figure 15 illustrates, when first visiting the page the First and Previous buttons will are disabled.</span></span> <span data-ttu-id="9efb4-318">单击 "下一步" 将显示第二页数据，而单击 "最后" 将显示最后一页（请参阅图16和17）。</span><span class="sxs-lookup"><span data-stu-id="9efb4-318">Clicking Next shows the second page of data, while clicking Last displays the final page (see Figures 16 and 17).</span></span> <span data-ttu-id="9efb4-319">查看数据的最后一页时，"下一步" 和 "最后一个" 按钮将被禁用。</span><span class="sxs-lookup"><span data-stu-id="9efb4-319">When viewing the last page of data both the Next and Last buttons are disabled.</span></span>

<span data-ttu-id="9efb4-320">[查看产品的第一页时，![上一个和最后一个按钮被禁用](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image42.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image41.png)</span><span class="sxs-lookup"><span data-stu-id="9efb4-320">[![The Previous and Last Buttons are Disabled When Viewing the First Page of Products](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image42.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image41.png)</span></span>

<span data-ttu-id="9efb4-321">**图 15**：查看产品的第一页时，上一个和最后一个按钮被禁用（[单击以查看完全大小的图像](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image43.png)）</span><span class="sxs-lookup"><span data-stu-id="9efb4-321">**Figure 15**: The Previous and Last Buttons are Disabled When Viewing the First Page of Products ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image43.png))</span></span>

<span data-ttu-id="9efb4-322">[显示产品的第二页 ![](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image45.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image44.png)</span><span class="sxs-lookup"><span data-stu-id="9efb4-322">[![The Second Page of Products are Displayed](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image45.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image44.png)</span></span>

<span data-ttu-id="9efb4-323">**图 16**：显示了产品的第二页（[单击以查看完全大小的图像](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image46.png)）</span><span class="sxs-lookup"><span data-stu-id="9efb4-323">**Figure 16**: The Second Page of Products are Displayed ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image46.png))</span></span>

<span data-ttu-id="9efb4-324">[![单击 "上一步" 将显示最后一页的数据](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image48.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image47.png)</span><span class="sxs-lookup"><span data-stu-id="9efb4-324">[![Clicking Last Displays the Final Page of Data](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image48.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image47.png)</span></span>

<span data-ttu-id="9efb4-325">**图 17**：单击 "上一步" 将显示最后一页的数据（[单击查看完全尺寸的图像](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image49.png)）</span><span class="sxs-lookup"><span data-stu-id="9efb4-325">**Figure 17**: Clicking Last Displays the Final Page of Data ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image49.png))</span></span>

## <a name="step-7-including-sorting-support-with-the-custom-paged-repeater"></a><span data-ttu-id="9efb4-326">步骤7：包含对自定义分页中继器的排序支持</span><span class="sxs-lookup"><span data-stu-id="9efb4-326">Step 7: Including Sorting Support with the Custom Paged Repeater</span></span>

<span data-ttu-id="9efb4-327">现在已经实现了自定义分页，我们已准备好加入排序支持。</span><span class="sxs-lookup"><span data-stu-id="9efb4-327">Now that custom paging has been implemented, we re ready to include sorting support.</span></span> <span data-ttu-id="9efb4-328">`ProductsBLL` 类 `GetProductsPagedAndSorted` 方法具有与 `GetProductsPaged`相同的*startRowIndex*和*maximumRows*输入参数，但允许附加*sortExpression*输入参数。</span><span class="sxs-lookup"><span data-stu-id="9efb4-328">The `ProductsBLL` class s `GetProductsPagedAndSorted` method has the same *startRowIndex* and *maximumRows* input parameters as `GetProductsPaged`, but permits an additional *sortExpression* input parameter.</span></span> <span data-ttu-id="9efb4-329">若要从 `SortingWithCustomPaging.aspx`使用 `GetProductsPagedAndSorted` 方法，需要执行以下步骤：</span><span class="sxs-lookup"><span data-stu-id="9efb4-329">To use the `GetProductsPagedAndSorted` method from `SortingWithCustomPaging.aspx`, we need to perform the following steps:</span></span>

1. <span data-ttu-id="9efb4-330">将 ObjectDataSource `SelectMethod` 属性从 `GetProductsPaged` 更改为 `GetProductsPagedAndSorted`。</span><span class="sxs-lookup"><span data-stu-id="9efb4-330">Change the ObjectDataSource s `SelectMethod` property from `GetProductsPaged` to `GetProductsPagedAndSorted`.</span></span>
2. <span data-ttu-id="9efb4-331">将*sortExpression* `Parameter` 对象添加到 ObjectDataSource `SelectParameters` 集合。</span><span class="sxs-lookup"><span data-stu-id="9efb4-331">Add a *sortExpression* `Parameter` object to the ObjectDataSource s `SelectParameters` collection.</span></span>
3. <span data-ttu-id="9efb4-332">创建专用的页面级 `SortExpression` 属性，该属性通过页面的视图状态在回发之间保持其值。</span><span class="sxs-lookup"><span data-stu-id="9efb4-332">Create a private, page-level `SortExpression` property that persists its value across postbacks through the page s view state.</span></span>
4. <span data-ttu-id="9efb4-333">更新 ObjectDataSource `Selecting` 事件处理程序，以便为 ObjectDataSource s *sortExpression*参数分配页面级 `SortExpression` 属性的值。</span><span class="sxs-lookup"><span data-stu-id="9efb4-333">Update the ObjectDataSource s `Selecting` event handler to assign the ObjectDataSource s *sortExpression* parameter the value of the page-level `SortExpression` property.</span></span>
5. <span data-ttu-id="9efb4-334">创建排序接口。</span><span class="sxs-lookup"><span data-stu-id="9efb4-334">Create the sorting interface.</span></span>

<span data-ttu-id="9efb4-335">首先更新 ObjectDataSource `SelectMethod` 属性并添加*sortExpression* `Parameter`。</span><span class="sxs-lookup"><span data-stu-id="9efb4-335">Start by updating the ObjectDataSource s `SelectMethod` property and adding a *sortExpression* `Parameter`.</span></span> <span data-ttu-id="9efb4-336">请确保*sortExpression* `Parameter` s `Type` 属性设置为 "`String`"。</span><span class="sxs-lookup"><span data-stu-id="9efb4-336">Make sure that the *sortExpression* `Parameter` s `Type` property is set to `String`.</span></span> <span data-ttu-id="9efb4-337">完成前两个任务后，ObjectDataSource 的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="9efb4-337">After completing these first two tasks, the ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-cs/samples/sample18.aspx)]

<span data-ttu-id="9efb4-338">接下来，需要一个页级 `SortExpression` 属性，其值被序列化为视图状态。</span><span class="sxs-lookup"><span data-stu-id="9efb4-338">Next, we need a page-level `SortExpression` property whose value is serialized to view state.</span></span> <span data-ttu-id="9efb4-339">如果未设置排序表达式值，请使用 ProductName 作为默认值：</span><span class="sxs-lookup"><span data-stu-id="9efb4-339">If no sort expression value has been set, use ProductName as the default:</span></span>

[!code-csharp[Main](sorting-data-in-a-datalist-or-repeater-control-cs/samples/sample19.cs)]

<span data-ttu-id="9efb4-340">在 ObjectDataSource 调用 `GetProductsPagedAndSorted` 方法之前，我们需要将*sortExpression* `Parameter` 设置为 `SortExpression` 属性的值。</span><span class="sxs-lookup"><span data-stu-id="9efb4-340">Before the ObjectDataSource invokes the `GetProductsPagedAndSorted` method we need to set the *sortExpression* `Parameter` to the value of the `SortExpression` property.</span></span> <span data-ttu-id="9efb4-341">在 `Selecting` 事件处理程序中，添加以下代码行：</span><span class="sxs-lookup"><span data-stu-id="9efb4-341">In the `Selecting` event handler, add the following line of code:</span></span>

[!code-csharp[Main](sorting-data-in-a-datalist-or-repeater-control-cs/samples/sample20.cs)]

<span data-ttu-id="9efb4-342">剩下的就是实现排序接口。</span><span class="sxs-lookup"><span data-stu-id="9efb4-342">All that remains is to implement the sorting interface.</span></span> <span data-ttu-id="9efb4-343">正如我们在上一示例中所做的那样，让我们使用三个按钮 Web 控件实现了排序界面，用户可以按产品名称、类别或供应商对结果进行排序。</span><span class="sxs-lookup"><span data-stu-id="9efb4-343">As we did in the last example, let s have the sorting interface implemented using three Button Web controls that allow the user to sort the results by product name, category, or supplier.</span></span>

[!code-aspx[Main](sorting-data-in-a-datalist-or-repeater-control-cs/samples/sample21.aspx)]

<span data-ttu-id="9efb4-344">为这三个按钮控件创建 `Click` 事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="9efb4-344">Create `Click` event handlers for these three Button controls.</span></span> <span data-ttu-id="9efb4-345">在事件处理程序中，将 `StartRowIndex` 重置为0，将 `SortExpression` 设置为适当的值，并将数据重新绑定到 Repeater：</span><span class="sxs-lookup"><span data-stu-id="9efb4-345">In the event handler, reset the `StartRowIndex` to 0, set the `SortExpression` to the appropriate value, and rebind the data to the Repeater:</span></span>

[!code-csharp[Main](sorting-data-in-a-datalist-or-repeater-control-cs/samples/sample22.cs)]

<span data-ttu-id="9efb4-346">就是这样！</span><span class="sxs-lookup"><span data-stu-id="9efb4-346">That s all there is to it!</span></span> <span data-ttu-id="9efb4-347">虽然实现自定义分页和排序的步骤很多，但这些步骤与默认分页的步骤非常类似。</span><span class="sxs-lookup"><span data-stu-id="9efb4-347">While there were a number of steps to get custom paging and sorting implemented, the steps were very similar to those needed for default paging.</span></span> <span data-ttu-id="9efb4-348">图18显示了按类别排序后查看数据的最后一页的产品。</span><span class="sxs-lookup"><span data-stu-id="9efb4-348">Figure 18 shows the products when viewing the last page of data when sorted by category.</span></span>

<span data-ttu-id="9efb4-349">[显示最后一个数据页，按类别排序，随即显示 ![](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image51.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image50.png)</span><span class="sxs-lookup"><span data-stu-id="9efb4-349">[![The Last Page of Data, Sorted by Category, is Displayed](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image51.png)](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image50.png)</span></span>

<span data-ttu-id="9efb4-350">**图 18**：显示了按类别排序的最后一页数据（[单击以查看完全大小的图像](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image52.png)）</span><span class="sxs-lookup"><span data-stu-id="9efb4-350">**Figure 18**: The Last Page of Data, Sorted by Category, is Displayed ([Click to view full-size image](sorting-data-in-a-datalist-or-repeater-control-cs/_static/image52.png))</span></span>

> [!NOTE]
> <span data-ttu-id="9efb4-351">在前面的示例中，当供应商供应商进行排序时，使用的是排序表达式。</span><span class="sxs-lookup"><span data-stu-id="9efb4-351">In previous examples, when sorting by the supplier SupplierName was used as the sort expression.</span></span> <span data-ttu-id="9efb4-352">但是，对于自定义分页实现，我们需要使用 "公司名称"。</span><span class="sxs-lookup"><span data-stu-id="9efb4-352">However, for the custom paging implementation, we need to use CompanyName.</span></span> <span data-ttu-id="9efb4-353">这是因为负责实现自定义分页的存储过程 `GetProductsPagedAndSorted` 将排序表达式传递到 `ROW_NUMBER()` 关键字，`ROW_NUMBER()` 关键字需要实际列名而不是别名。</span><span class="sxs-lookup"><span data-stu-id="9efb4-353">This is because the stored procedure responsible for implementing custom paging `GetProductsPagedAndSorted` passes the sort expression into the `ROW_NUMBER()` keyword, The `ROW_NUMBER()` keyword requires the actual column name rather than an alias.</span></span> <span data-ttu-id="9efb4-354">因此，必须使用 `CompanyName` （`Suppliers` 表中列的名称），而不是在用于排序表达式的 `SELECT` 查询（`SupplierName`）中使用的别名。</span><span class="sxs-lookup"><span data-stu-id="9efb4-354">Therefore, we must use `CompanyName` (the name of the column in the `Suppliers` table) rather than the alias used in the `SELECT` query (`SupplierName`) for the sort expression.</span></span>

## <a name="summary"></a><span data-ttu-id="9efb4-355">摘要</span><span class="sxs-lookup"><span data-stu-id="9efb4-355">Summary</span></span>

<span data-ttu-id="9efb4-356">DataList 和 Repeater 都无法提供内置排序支持，但有一些代码和自定义排序接口，可以添加此类功能。</span><span class="sxs-lookup"><span data-stu-id="9efb4-356">Neither the DataList nor Repeater offer built-in sorting support, but with a bit of code and a custom sorting interface, such functionality can be added.</span></span> <span data-ttu-id="9efb4-357">实现排序而不是分页时，可以通过传递到 ObjectDataSource s `Select` 方法中的 `DataSourceSelectArguments` 对象指定排序表达式。</span><span class="sxs-lookup"><span data-stu-id="9efb4-357">When implementing sorting, but not paging, the sort expression can be specified through the `DataSourceSelectArguments` object passed into the ObjectDataSource s `Select` method.</span></span> <span data-ttu-id="9efb4-358">此 `DataSourceSelectArguments` 对象 s `SortExpression` 属性可在 ObjectDataSource `Selecting` 事件处理程序中进行分配。</span><span class="sxs-lookup"><span data-stu-id="9efb4-358">This `DataSourceSelectArguments` object s `SortExpression` property can be assigned in the ObjectDataSource s `Selecting` event handler.</span></span>

<span data-ttu-id="9efb4-359">若要向已提供分页支持的 DataList 或中继器添加排序功能，最简单的方法是自定义业务逻辑层以包含接受排序表达式的方法。</span><span class="sxs-lookup"><span data-stu-id="9efb4-359">To add sorting capabilities to a DataList or Repeater that already provides paging support, the easiest approach is to customize the Business Logic Layer to include a method that accepts a sort expression.</span></span> <span data-ttu-id="9efb4-360">然后，可以通过 `SelectParameters`中的参数在中传递此信息。</span><span class="sxs-lookup"><span data-stu-id="9efb4-360">This information can then be passed in through a parameter in the ObjectDataSource s `SelectParameters`.</span></span>

<span data-ttu-id="9efb4-361">本教程完成了对 DataList 和 Repeater 控件的分页和排序检查。</span><span class="sxs-lookup"><span data-stu-id="9efb4-361">This tutorial completes our examination of paging and sorting with the DataList and Repeater controls.</span></span> <span data-ttu-id="9efb4-362">我们的下一个和最后一个教程将介绍如何将按钮 Web 控件添加到 DataList 和 Repeater 模板中，以便基于每个项提供一些自定义的、用户启动的功能。</span><span class="sxs-lookup"><span data-stu-id="9efb4-362">Our next and final tutorial will examine how to add Button Web controls to the DataList and Repeater s templates in order to provide some custom, user-initiated functionality on a per-item basis.</span></span>

<span data-ttu-id="9efb4-363">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="9efb4-363">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="9efb4-364">关于作者</span><span class="sxs-lookup"><span data-stu-id="9efb4-364">About the Author</span></span>

<span data-ttu-id="9efb4-365">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，创始人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已在使用 Microsoft Web 技术，自1998开始。</span><span class="sxs-lookup"><span data-stu-id="9efb4-365">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="9efb4-366">Scott 的工作方式是独立的顾问、培训师和撰稿人。</span><span class="sxs-lookup"><span data-stu-id="9efb4-366">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="9efb4-367">他的最新书籍是，[*在24小时内，sam ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="9efb4-367">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="9efb4-368">可以[mitchell@4GuysFromRolla.com访问。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="9efb4-368">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="9efb4-369">或通过他的博客，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="9efb4-369">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="9efb4-370">特别感谢</span><span class="sxs-lookup"><span data-stu-id="9efb4-370">Special Thanks To</span></span>

<span data-ttu-id="9efb4-371">此教程系列由许多有用的审阅者查看。</span><span class="sxs-lookup"><span data-stu-id="9efb4-371">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="9efb4-372">本教程的领导审查人员是 David Suru。</span><span class="sxs-lookup"><span data-stu-id="9efb4-372">Lead reviewer for this tutorial was David Suru.</span></span> <span data-ttu-id="9efb4-373">想要查看我即将发布的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="9efb4-373">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="9efb4-374">如果是这样，请在mitchell@4GuysFromRolla.com放置一行[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="9efb4-374">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="9efb4-375">[上一页](paging-report-data-in-a-datalist-or-repeater-control-cs.md)
> [下一页](paging-report-data-in-a-datalist-or-repeater-control-vb.md)</span><span class="sxs-lookup"><span data-stu-id="9efb4-375">[Previous](paging-report-data-in-a-datalist-or-repeater-control-cs.md)
[Next](paging-report-data-in-a-datalist-or-repeater-control-vb.md)</span></span>
