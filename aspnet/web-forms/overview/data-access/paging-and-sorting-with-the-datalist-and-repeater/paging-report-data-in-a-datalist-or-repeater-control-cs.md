---
uid: web-forms/overview/data-access/paging-and-sorting-with-the-datalist-and-repeater/paging-report-data-in-a-datalist-or-repeater-control-cs
title: 对 DataList 或 Repeater 控件中的报表数据进行C#分页（） |Microsoft Docs
author: rick-anderson
description: 尽管 DataList 和中继器都不提供自动分页或排序支持，但本教程介绍了如何向 DataList 或中继器添加分页支持,。
ms.author: riande
ms.date: 11/13/2006
ms.assetid: e8e0809b-25c4-4c3b-8d12-9a17048148ae
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting-with-the-datalist-and-repeater/paging-report-data-in-a-datalist-or-repeater-control-cs
msc.type: authoredcontent
ms.openlocfilehash: 16686c7e41926698c0da9c60d3cf26e858f5daca
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/28/2019
ms.locfileid: "74617728"
---
# <a name="paging-report-data-in-a-datalist-or-repeater-control-c"></a><span data-ttu-id="708a7-103">分页 DataList 或 Repeater 控件中的报表数据 (C#)</span><span class="sxs-lookup"><span data-stu-id="708a7-103">Paging Report Data in a DataList or Repeater Control (C#)</span></span>

<span data-ttu-id="708a7-104">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="708a7-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="708a7-105">[下载示例应用](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_44_CS.exe)或[下载 PDF](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/datatutorial44cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="708a7-105">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_44_CS.exe) or [Download PDF](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/datatutorial44cs1.pdf)</span></span>

> <span data-ttu-id="708a7-106">尽管 DataList 和中继器都不提供自动分页或排序支持，但本教程还介绍了如何将分页支持添加到 DataList 或中继器，这允许实现更灵活的分页和数据显示界面。</span><span class="sxs-lookup"><span data-stu-id="708a7-106">While neither the DataList nor Repeater offer automatic paging or sorting support, this tutorial shows how to add paging support to the DataList or Repeater, which allows for much more flexible paging and data display interfaces.</span></span>

## <a name="introduction"></a><span data-ttu-id="708a7-107">简介</span><span class="sxs-lookup"><span data-stu-id="708a7-107">Introduction</span></span>

<span data-ttu-id="708a7-108">在联机应用程序中显示数据时，分页和排序是两种非常常见的功能。</span><span class="sxs-lookup"><span data-stu-id="708a7-108">Paging and sorting are two very common features when displaying data in an online application.</span></span> <span data-ttu-id="708a7-109">例如，在在线书店搜索 ASP.NET 书籍时，可能会有数百个这类书籍，但是列出搜索结果的报告只列出每页的十个匹配项。</span><span class="sxs-lookup"><span data-stu-id="708a7-109">For example, when searching for ASP.NET books at an online bookstore, there may be hundreds of such books, but the report listing the search results lists only ten matches per page.</span></span> <span data-ttu-id="708a7-110">而且，结果可以按标题、价格、页计数、作者姓名等进行排序。</span><span class="sxs-lookup"><span data-stu-id="708a7-110">Moreover, the results can be sorted by title, price, page count, author name, and so on.</span></span> <span data-ttu-id="708a7-111">正如我们在[分页和排序报表数据](../paging-and-sorting/paging-and-sorting-report-data-cs.md)教程中讨论的那样，GridView、DetailsView 和 FormView 控件都提供了可在复选框的勾选标记下启用的内置分页支持。</span><span class="sxs-lookup"><span data-stu-id="708a7-111">As we discussed in the [Paging and Sorting Report Data](../paging-and-sorting/paging-and-sorting-report-data-cs.md) tutorial, the GridView, DetailsView, and FormView controls all provide built-in paging support that can be enabled at the tick of a checkbox.</span></span> <span data-ttu-id="708a7-112">GridView 还包括排序支持。</span><span class="sxs-lookup"><span data-stu-id="708a7-112">The GridView also includes sorting support.</span></span>

<span data-ttu-id="708a7-113">遗憾的是，DataList 和中继器都不提供自动分页或排序支持。</span><span class="sxs-lookup"><span data-stu-id="708a7-113">Unfortunately, neither the DataList nor Repeater offer automatic paging or sorting support.</span></span> <span data-ttu-id="708a7-114">在本教程中，我们将讨论如何向 DataList 或中继器添加分页支持。</span><span class="sxs-lookup"><span data-stu-id="708a7-114">In this tutorial we'll examine how to add paging support to the DataList or Repeater.</span></span> <span data-ttu-id="708a7-115">我们必须手动创建分页接口，显示适当的记录页，并记住跨回发访问的页面。</span><span class="sxs-lookup"><span data-stu-id="708a7-115">We must manually create the paging interface, display the appropriate page of records, and remember the page being visited across postbacks.</span></span> <span data-ttu-id="708a7-116">尽管这需要花费更多的时间和代码，而不是使用 GridView、DetailsView 或 FormView，但 DataList 和 Repeater 允许使用更灵活的分页和数据显示界面。</span><span class="sxs-lookup"><span data-stu-id="708a7-116">While this does take more time and code than with the GridView, DetailsView, or FormView, the DataList and Repeater allow for much more flexible paging and data display interfaces.</span></span>

> [!NOTE]
> <span data-ttu-id="708a7-117">本教程专门讲述分页。</span><span class="sxs-lookup"><span data-stu-id="708a7-117">This tutorial focuses exclusively on paging.</span></span> <span data-ttu-id="708a7-118">在下一教程中，我们将重点介绍如何添加排序功能。</span><span class="sxs-lookup"><span data-stu-id="708a7-118">In the next tutorial we'll turn our attention to adding sorting capabilities.</span></span>

## <a name="step-1-adding-the-paging-and-sorting-tutorial-web-pages"></a><span data-ttu-id="708a7-119">步骤1：添加分页和排序教程网页</span><span class="sxs-lookup"><span data-stu-id="708a7-119">Step 1: Adding the Paging and Sorting Tutorial Web Pages</span></span>

<span data-ttu-id="708a7-120">开始本教程之前，先花点时间添加本教程和下一教程所需的 ASP.NET 页面。</span><span class="sxs-lookup"><span data-stu-id="708a7-120">Before we start this tutorial, let s first take a moment to add the ASP.NET pages we'll need for this tutorial and the next one.</span></span> <span data-ttu-id="708a7-121">首先，在项目中创建一个名为 `PagingSortingDataListRepeater`的新文件夹。</span><span class="sxs-lookup"><span data-stu-id="708a7-121">Start by creating a new folder in the project named `PagingSortingDataListRepeater`.</span></span> <span data-ttu-id="708a7-122">接下来，将以下五个 ASP.NET 页面添加到此文件夹，所有这些页面都配置为使用母版页 `Site.master`：</span><span class="sxs-lookup"><span data-stu-id="708a7-122">Next, add the following five ASP.NET pages to this folder, having all of them configured to use the master page `Site.master`:</span></span>

- `Default.aspx`
- `Paging.aspx`
- `Sorting.aspx`
- `SortingWithDefaultPaging.aspx`
- `SortingWithCustomPaging.aspx`

![创建 PagingSortingDataListRepeater 文件夹并添加教程 ASP.NET 页面](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image1.png)

<span data-ttu-id="708a7-124">**图 1**：创建 `PagingSortingDataListRepeater` 文件夹并添加教程 ASP.NET 页面</span><span class="sxs-lookup"><span data-stu-id="708a7-124">**Figure 1**: Create a `PagingSortingDataListRepeater` Folder and Add the Tutorial ASP.NET Pages</span></span>

<span data-ttu-id="708a7-125">接下来，打开 `Default.aspx` 页面，并将 `SectionLevelTutorialListing.ascx` 用户控件从 `UserControls` 文件夹拖到设计图面上。</span><span class="sxs-lookup"><span data-stu-id="708a7-125">Next, open the `Default.aspx` page and drag the `SectionLevelTutorialListing.ascx` User Control from the `UserControls` folder onto the Design surface.</span></span> <span data-ttu-id="708a7-126">此用户控件（我们在[母版页和站点导航](../introduction/master-pages-and-site-navigation-cs.md)教程中创建）枚举站点地图，并在项目符号列表中的当前部分显示这些教程。</span><span class="sxs-lookup"><span data-stu-id="708a7-126">This User Control, which we created in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial, enumerates the site map and displays those tutorials in the current section in a bulleted list.</span></span>

<span data-ttu-id="708a7-127">[![将 SectionLevelTutorialListing 用户控件添加到 default.aspx](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image3.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="708a7-127">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image3.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image2.png)</span></span>

<span data-ttu-id="708a7-128">**图 2**：将 `SectionLevelTutorialListing.ascx` 用户控件添加到 `Default.aspx` （[单击以查看完全大小的图像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image4.png)）</span><span class="sxs-lookup"><span data-stu-id="708a7-128">**Figure 2**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image4.png))</span></span>

<span data-ttu-id="708a7-129">为了使项目符号列表显示我们要创建的分页和排序教程，我们需要将它们添加到站点地图。</span><span class="sxs-lookup"><span data-stu-id="708a7-129">In order to have the bulleted list display the paging and sorting tutorials we'll be creating, we need to add them to the site map.</span></span> <span data-ttu-id="708a7-130">打开 `Web.sitemap` 文件，并在编辑后添加以下标记并删除 DataList 站点地图节点标记：</span><span class="sxs-lookup"><span data-stu-id="708a7-130">Open the `Web.sitemap` file and add the following markup after the Editing and Deleting with the DataList site map node markup:</span></span>

[!code-xml[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample1.xml)]

![更新站点映射以包括新的 ASP.NET 页面](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image5.png)

<span data-ttu-id="708a7-132">**图 3**：更新站点映射以包括新的 ASP.NET 页面</span><span class="sxs-lookup"><span data-stu-id="708a7-132">**Figure 3**: Update the Site Map to Include the New ASP.NET Pages</span></span>

## <a name="a-review-of-paging"></a><span data-ttu-id="708a7-133">查看分页</span><span class="sxs-lookup"><span data-stu-id="708a7-133">A Review of Paging</span></span>

<span data-ttu-id="708a7-134">在前面的教程中，我们看到了如何逐页浏览 GridView、DetailsView 和 FormView 控件中的数据。</span><span class="sxs-lookup"><span data-stu-id="708a7-134">In previous tutorials we saw how to page through the data in the GridView, DetailsView, and FormView controls.</span></span> <span data-ttu-id="708a7-135">这三个控件提供一种称为*默认分页*的简单分页，只需选中 "控制" 智能标记中的 "启用分页" 选项即可实现。</span><span class="sxs-lookup"><span data-stu-id="708a7-135">These three controls offer a simple form of paging called *default paging* that can be implemented by simply checking the Enable Paging option in the control s smart tag.</span></span> <span data-ttu-id="708a7-136">使用默认分页时，每次在第一页上请求数据页时，或者当用户导航到不同的数据页时，GridView、DetailsView 或 FormView 控件会重新请求 ObjectDataSource 中的*所有*数据。</span><span class="sxs-lookup"><span data-stu-id="708a7-136">With default paging, each time a page of data is requested either on the first page visit or when the user navigates to a different page of data the GridView, DetailsView, or FormView control re-requests *all* of the data from the ObjectDataSource.</span></span> <span data-ttu-id="708a7-137">然后，它将显示给定请求的页索引和每页显示的记录数的特定记录集。</span><span class="sxs-lookup"><span data-stu-id="708a7-137">It then snips out the particular set of records to display given the requested page index and the number of records to display per page.</span></span> <span data-ttu-id="708a7-138">我们在[分页和排序报表数据](../paging-and-sorting/paging-and-sorting-report-data-cs.md)教程中详细讨论了默认分页。</span><span class="sxs-lookup"><span data-stu-id="708a7-138">We discussed default paging in detail in the [Paging and Sorting Report Data](../paging-and-sorting/paging-and-sorting-report-data-cs.md) tutorial.</span></span>

<span data-ttu-id="708a7-139">由于默认寻呼会重新请求每个页面的所有记录，因此在通过足够大量的数据进行分页时，这种情况并不可行。</span><span class="sxs-lookup"><span data-stu-id="708a7-139">Since default paging re-requests all records for each page, it is not practical when paging through sufficiently large amounts of data.</span></span> <span data-ttu-id="708a7-140">例如，假设页面大小为10的50000记录。</span><span class="sxs-lookup"><span data-stu-id="708a7-140">For example, imagine paging through 50,000 records with a page size of 10.</span></span> <span data-ttu-id="708a7-141">用户每次移动到新页时，都必须从数据库检索所有50000记录，即使只显示了其中的十个记录。</span><span class="sxs-lookup"><span data-stu-id="708a7-141">Each time the user moves to a new page, all 50,000 records must be retrieved from the database, even though only ten of them are displayed.</span></span>

<span data-ttu-id="708a7-142">*自定义分页*通过仅获取在请求的页上显示的记录的精确子集，来解决默认分页的性能问题。</span><span class="sxs-lookup"><span data-stu-id="708a7-142">*Custom paging* solves the performance concerns of default paging by grabbing only the precise subset of records to display on the requested page.</span></span> <span data-ttu-id="708a7-143">实现自定义分页时，必须编写只返回正确记录集的 SQL 查询。</span><span class="sxs-lookup"><span data-stu-id="708a7-143">When implementing custom paging, we must write the SQL query that will efficiently return just the correct set of records.</span></span> <span data-ttu-id="708a7-144">我们已了解如何使用 SQL Server 2005 s new [`ROW_NUMBER()` 关键字](http://www.4guysfromrolla.com/webtech/010406-1.shtml)，[通过大量数据有效分页](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs.md)来创建此类查询。</span><span class="sxs-lookup"><span data-stu-id="708a7-144">We saw how to create such a query using SQL Server 2005 s new [`ROW_NUMBER()` keyword](http://www.4guysfromrolla.com/webtech/010406-1.shtml) back in the [Efficiently Paging Through Large Amounts of Data](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs.md) tutorial.</span></span>

<span data-ttu-id="708a7-145">若要在 DataList 或 Repeater 控件中实现默认分页，可以使用[`PagedDataSource` 类](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.aspx)作为正在分页的 `ProductsDataTable` 周围的包装器。</span><span class="sxs-lookup"><span data-stu-id="708a7-145">To implement default paging in the DataList or Repeater controls, we can use the [`PagedDataSource` class](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.aspx) as a wrapper around the `ProductsDataTable` whose contents are being paged.</span></span> <span data-ttu-id="708a7-146">`PagedDataSource` 类具有一个 `DataSource` 属性，该属性可分配给任何可枚举对象，并[`PageSize`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.pagesize.aspx)和[`CurrentPageIndex`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.currentpageindex.aspx)属性，这些属性指示每页显示的记录数和当前页索引。</span><span class="sxs-lookup"><span data-stu-id="708a7-146">The `PagedDataSource` class has a `DataSource` property that can be assigned to any enumerable object and [`PageSize`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.pagesize.aspx) and [`CurrentPageIndex`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.currentpageindex.aspx) properties that indicate how many records to show per page and the current page index.</span></span> <span data-ttu-id="708a7-147">设置这些属性后，可以将 `PagedDataSource` 用作任何数据 Web 控件的数据源。</span><span class="sxs-lookup"><span data-stu-id="708a7-147">Once these properties have been set, the `PagedDataSource` can be used as the data source of any data Web control.</span></span> <span data-ttu-id="708a7-148">枚举的 `PagedDataSource`将仅根据 `PageSize` 和 `CurrentPageIndex` 属性返回其内部 `DataSource` 的适当记录子集。</span><span class="sxs-lookup"><span data-stu-id="708a7-148">The `PagedDataSource`, when enumerated, will only return the appropriate subset of records of its inner `DataSource` based on the `PageSize` and `CurrentPageIndex` properties.</span></span> <span data-ttu-id="708a7-149">图4演示了 `PagedDataSource` 类的功能。</span><span class="sxs-lookup"><span data-stu-id="708a7-149">Figure 4 depicts the functionality of the `PagedDataSource` class.</span></span>

![PagedDataSource 使用可分页接口包装可枚举对象](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image6.png)

<span data-ttu-id="708a7-151">**图 4**： `PagedDataSource` 使用可分页接口包装可枚举对象</span><span class="sxs-lookup"><span data-stu-id="708a7-151">**Figure 4**: The `PagedDataSource` Wraps an Enumerable Object with a Pageable Interface</span></span>

<span data-ttu-id="708a7-152">`PagedDataSource` 对象可以直接从业务逻辑层创建和配置，并通过 ObjectDataSource 绑定到 DataList 或中继器，也可以直接在 ASP.NET page s 代码隐藏类中创建和配置。</span><span class="sxs-lookup"><span data-stu-id="708a7-152">The `PagedDataSource` object can be created and configured directly from the Business Logic Layer and bound to a DataList or Repeater through an ObjectDataSource, or can be created and configured directly in the ASP.NET page s code-behind class.</span></span> <span data-ttu-id="708a7-153">如果使用后一种方法，则必须使用 ObjectDataSource 放弃，并以编程方式将分页数据绑定到 DataList 或 Repeater。</span><span class="sxs-lookup"><span data-stu-id="708a7-153">If the latter approach is used, we must forgo using the ObjectDataSource and instead bind the paged data to the DataList or Repeater programmatically.</span></span>

<span data-ttu-id="708a7-154">`PagedDataSource` 对象还具有支持自定义分页的属性。</span><span class="sxs-lookup"><span data-stu-id="708a7-154">The `PagedDataSource` object also has properties to support custom paging.</span></span> <span data-ttu-id="708a7-155">但是，我们可以绕过使用 `PagedDataSource` 进行自定义分页，因为在 `ProductsBLL` 类中已经有为自定义分页设计的 BLL 方法，该方法返回要显示的精确记录。</span><span class="sxs-lookup"><span data-stu-id="708a7-155">However, we can bypass using a `PagedDataSource` for custom paging because we already have BLL methods in the `ProductsBLL` class designed for custom paging that return the precise records to display.</span></span>

<span data-ttu-id="708a7-156">在本教程中，我们将介绍如何通过将新方法添加到 `ProductsBLL` 类（该方法返回适当配置的 `PagedDataSource` 对象）来实现 DataList 中的默认分页。</span><span class="sxs-lookup"><span data-stu-id="708a7-156">In this tutorial we'll look at implementing default paging in a DataList by adding a new method to the `ProductsBLL` class that returns an appropriately configured `PagedDataSource` object.</span></span> <span data-ttu-id="708a7-157">在下一教程中，我们将了解如何使用自定义分页。</span><span class="sxs-lookup"><span data-stu-id="708a7-157">In the next tutorial, we'll see how to use custom paging.</span></span>

## <a name="step-2-adding-a-default-paging-method-in-the-business-logic-layer"></a><span data-ttu-id="708a7-158">步骤2：在业务逻辑层中添加默认分页方法</span><span class="sxs-lookup"><span data-stu-id="708a7-158">Step 2: Adding a Default Paging Method in the Business Logic Layer</span></span>

<span data-ttu-id="708a7-159">`ProductsBLL` 类当前有一种方法，用于返回所有产品信息 `GetProducts()`，一个方法用于返回 `GetProductsPaged(startRowIndex, maximumRows)`起始索引处的特定产品子集。</span><span class="sxs-lookup"><span data-stu-id="708a7-159">The `ProductsBLL` class currently has a method for returning all product information `GetProducts()` and one for returning a particular subset of products at a starting index `GetProductsPaged(startRowIndex, maximumRows)`.</span></span> <span data-ttu-id="708a7-160">使用默认分页时，GridView、DetailsView 和 FormView 控件都使用 `GetProducts()` 方法检索所有产品，但随后使用 `PagedDataSource` 来只显示正确的记录子集。</span><span class="sxs-lookup"><span data-stu-id="708a7-160">With default paging, the GridView, DetailsView, and FormView controls all use the `GetProducts()` method to retrieve all products, but then use a `PagedDataSource` internally to display only the correct subset of records.</span></span> <span data-ttu-id="708a7-161">若要使用 DataList 和 Repeater 控件复制此功能，可以在具有模拟此行为的 BLL 中创建新方法。</span><span class="sxs-lookup"><span data-stu-id="708a7-161">To replicate this functionality with the DataList and Repeater controls, we can create a new method in the BLL that mimics this behavior.</span></span>

<span data-ttu-id="708a7-162">将一个方法添加到名为 `GetProductsAsPagedDataSource` 的 `ProductsBLL` 类，该方法采用两个整数输入参数：</span><span class="sxs-lookup"><span data-stu-id="708a7-162">Add a method to the `ProductsBLL` class named `GetProductsAsPagedDataSource` that takes in two integer input parameters:</span></span>

- <span data-ttu-id="708a7-163">`pageIndex` 要显示的页的索引，索引为零和</span><span class="sxs-lookup"><span data-stu-id="708a7-163">`pageIndex` the index of the page to display, indexed at zero, and</span></span>
- <span data-ttu-id="708a7-164">`pageSize` 每页显示的记录数。</span><span class="sxs-lookup"><span data-stu-id="708a7-164">`pageSize` the number of records to display per page.</span></span>

<span data-ttu-id="708a7-165">`GetProductsAsPagedDataSource` 首先从 `GetProducts()`检索*所有*记录。</span><span class="sxs-lookup"><span data-stu-id="708a7-165">`GetProductsAsPagedDataSource` starts by retrieving *all* of the records from `GetProducts()`.</span></span> <span data-ttu-id="708a7-166">然后，它将创建一个 `PagedDataSource` 对象，并将其 `CurrentPageIndex` 和 `PageSize` 属性设置为传入的 `pageIndex` 和 `pageSize` 参数的值。</span><span class="sxs-lookup"><span data-stu-id="708a7-166">It then creates a `PagedDataSource` object, setting its `CurrentPageIndex` and `PageSize` properties to the values of the passed-in `pageIndex` and `pageSize` parameters.</span></span> <span data-ttu-id="708a7-167">方法通过返回此配置的 `PagedDataSource`来结束：</span><span class="sxs-lookup"><span data-stu-id="708a7-167">The method concludes by returning this configured `PagedDataSource`:</span></span>

[!code-csharp[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample2.cs)]

## <a name="step-3-displaying-product-information-in-a-datalist-using-default-paging"></a><span data-ttu-id="708a7-168">步骤3：使用默认分页在 DataList 中显示产品信息</span><span class="sxs-lookup"><span data-stu-id="708a7-168">Step 3: Displaying Product Information in a DataList Using Default Paging</span></span>

<span data-ttu-id="708a7-169">将 `GetProductsAsPagedDataSource` 方法添加到 `ProductsBLL` 类中后，现在可以创建提供默认分页的 DataList 或 Repeater。</span><span class="sxs-lookup"><span data-stu-id="708a7-169">With the `GetProductsAsPagedDataSource` method added to the `ProductsBLL` class, we can now create a DataList or Repeater that provides default paging.</span></span> <span data-ttu-id="708a7-170">首先打开 `PagingSortingDataListRepeater` 文件夹中的 "`Paging.aspx`" 页，然后从 "工具箱" 中将 DataList 拖到设计器上，将 DataList s `ID` 属性设置为 "`ProductsDefaultPaging`"。</span><span class="sxs-lookup"><span data-stu-id="708a7-170">Start by opening the `Paging.aspx` page in the `PagingSortingDataListRepeater` folder and drag a DataList from the Toolbox onto the Designer, setting the DataList s `ID` property to `ProductsDefaultPaging`.</span></span> <span data-ttu-id="708a7-171">从 DataList s 智能标记中创建一个名为 `ProductsDefaultPagingDataSource` 的新 ObjectDataSource，并对其进行配置，使其使用 `GetProductsAsPagedDataSource` 方法检索数据。</span><span class="sxs-lookup"><span data-stu-id="708a7-171">From the DataList s smart tag, create a new ObjectDataSource named `ProductsDefaultPagingDataSource` and configure it so that it retrieves data using the `GetProductsAsPagedDataSource` method.</span></span>

<span data-ttu-id="708a7-172">[![创建 ObjectDataSource 并将其配置为使用 GetProductsAsPagedDataSource （）方法](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image8.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="708a7-172">[![Create an ObjectDataSource and Configure it to Use the GetProductsAsPagedDataSource () Method](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image8.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image7.png)</span></span>

<span data-ttu-id="708a7-173">**图 5**：创建 ObjectDataSource 并将其配置为使用 `GetProductsAsPagedDataSource` `()` 方法（[单击查看完全大小的映像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="708a7-173">**Figure 5**: Create an ObjectDataSource and Configure it to Use the `GetProductsAsPagedDataSource` `()` Method ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image9.png))</span></span>

<span data-ttu-id="708a7-174">将 "更新"、"插入" 和 "删除" 选项卡中的下拉列表设置为 "（无）"。</span><span class="sxs-lookup"><span data-stu-id="708a7-174">Set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="708a7-175">[![在 "更新"、"插入" 和 "删除" 选项卡中将下拉列表设置为 "（无）"](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image11.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="708a7-175">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE tabs to (None)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image11.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image10.png)</span></span>

<span data-ttu-id="708a7-176">**图 6**：将 "更新"、"插入" 和 "删除" 选项卡中的下拉列表设置为 "（无）" （[单击查看完全大小的映像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="708a7-176">**Figure 6**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE tabs to (None) ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image12.png))</span></span>

<span data-ttu-id="708a7-177">由于 `GetProductsAsPagedDataSource` 方法需要两个输入参数，因此向导会提示我们输入这些参数值的源。</span><span class="sxs-lookup"><span data-stu-id="708a7-177">Since the `GetProductsAsPagedDataSource` method expects two input parameters, the wizard prompts us for the source of these parameter values.</span></span>

<span data-ttu-id="708a7-178">必须跨回发记住页索引和页大小值。</span><span class="sxs-lookup"><span data-stu-id="708a7-178">The page index and page size values must be remembered across postbacks.</span></span> <span data-ttu-id="708a7-179">它们可以存储在视图状态中，保存到 querystring，存储在 session 变量中，或使用其他方法记住。</span><span class="sxs-lookup"><span data-stu-id="708a7-179">They can be stored in view state, persisted to the querystring, stored in session variables, or remembered using some other technique.</span></span> <span data-ttu-id="708a7-180">对于本教程，我们将使用 querystring，该查询的优点是允许将特定的数据页作为书签。</span><span class="sxs-lookup"><span data-stu-id="708a7-180">For this tutorial we'll use the querystring, which has the advantage of allowing a particular page of data to be bookmarked.</span></span>

<span data-ttu-id="708a7-181">具体而言，请分别对 `pageIndex` 和 `pageSize` 参数使用 querystring 字段 pageIndex 和 pageSize （参见图7）。</span><span class="sxs-lookup"><span data-stu-id="708a7-181">In particular, use the querystring fields pageIndex and pageSize for the `pageIndex` and `pageSize` parameters, respectively (see Figure 7).</span></span> <span data-ttu-id="708a7-182">请花片刻时间为这些参数设置默认值，因为当用户第一次访问此页时，查询字符串值不会出现。</span><span class="sxs-lookup"><span data-stu-id="708a7-182">Take a moment to set the default values for these parameters, as the querystring values won't be present when a user first visits this page.</span></span> <span data-ttu-id="708a7-183">对于 "`pageIndex`"，将默认值设置为0（显示数据的第一页） `pageSize`，将默认值设置为4。</span><span class="sxs-lookup"><span data-stu-id="708a7-183">For `pageIndex`, set the default value to 0 (which will show the first page of data) and `pageSize` s default value to 4.</span></span>

<span data-ttu-id="708a7-184">[![使用 QueryString 作为 pageIndex 和 pageSize 参数的源](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image14.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="708a7-184">[![Use the QueryString as the Source for the pageIndex and pageSize Parameters](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image14.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image13.png)</span></span>

<span data-ttu-id="708a7-185">**图 7**：使用 QueryString 作为 `pageIndex` 和 `pageSize` 参数的源（[单击查看完全大小的映像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="708a7-185">**Figure 7**: Use the QueryString as the Source for the `pageIndex` and `pageSize` Parameters ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image15.png))</span></span>

<span data-ttu-id="708a7-186">配置 ObjectDataSource 后，Visual Studio 会自动为 DataList 创建 `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="708a7-186">After configuring the ObjectDataSource, Visual Studio automatically creates an `ItemTemplate` for the DataList.</span></span> <span data-ttu-id="708a7-187">自定义 `ItemTemplate` 以便只显示产品的名称、类别和供应商。</span><span class="sxs-lookup"><span data-stu-id="708a7-187">Customize the `ItemTemplate` so that only the product s name, category, and supplier are shown.</span></span> <span data-ttu-id="708a7-188">同时，将 DataList s `RepeatColumns` 属性设置为2，将其 `Width` 为100%，并将其 `ItemStyle` `Width` 为50%。</span><span class="sxs-lookup"><span data-stu-id="708a7-188">Also set the DataList s `RepeatColumns` property to 2, its `Width` to 100%, and its `ItemStyle` s `Width` to 50%.</span></span> <span data-ttu-id="708a7-189">这些宽度设置将为这两列提供相等的间距。</span><span class="sxs-lookup"><span data-stu-id="708a7-189">These width settings will provide equal spacing for the two columns.</span></span>

<span data-ttu-id="708a7-190">进行这些更改后，DataList 和 ObjectDataSource 的标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="708a7-190">After making these changes, the DataList and ObjectDataSource s markup should look similar to the following:</span></span>

[!code-aspx[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample3.aspx)]

> [!NOTE]
> <span data-ttu-id="708a7-191">由于我们未在本教程中执行任何更新或删除功能，因此你可以禁用 DataList 的视图状态以减少呈现的页面大小。</span><span class="sxs-lookup"><span data-stu-id="708a7-191">Since we are not performing any update or delete functionality in this tutorial, you may disable the DataList s view state to reduce the rendered page size.</span></span>

<span data-ttu-id="708a7-192">最初通过浏览器访问此页时，既不提供 `pageIndex` 也不提供 `pageSize` 查询字符串参数。</span><span class="sxs-lookup"><span data-stu-id="708a7-192">When initially visiting this page through a browser, neither the `pageIndex` nor `pageSize` querystring parameters are provided.</span></span> <span data-ttu-id="708a7-193">因此，将使用默认值0和4。</span><span class="sxs-lookup"><span data-stu-id="708a7-193">Hence, the default values of 0 and 4 are used.</span></span> <span data-ttu-id="708a7-194">如图8所示，这会生成一个 DataList，其中显示前四个产品。</span><span class="sxs-lookup"><span data-stu-id="708a7-194">As Figure 8 shows, this results in a DataList that displays the first four products.</span></span>

<span data-ttu-id="708a7-195">[![列出了前四项产品](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image17.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="708a7-195">[![The First Four Products are Listed](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image17.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image16.png)</span></span>

<span data-ttu-id="708a7-196">**图 8**：列出了前四个产品（[单击以查看完全大小的图像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="708a7-196">**Figure 8**: The First Four Products are Listed ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image18.png))</span></span>

<span data-ttu-id="708a7-197">如果没有分页界面，则目前没有用户导航到第二页数据的方法。</span><span class="sxs-lookup"><span data-stu-id="708a7-197">Without a paging interface, there s currently no straightforward means for a user to navigate to the second page of data.</span></span> <span data-ttu-id="708a7-198">我们将在步骤4中创建分页接口。</span><span class="sxs-lookup"><span data-stu-id="708a7-198">We'll create a paging interface in step 4.</span></span> <span data-ttu-id="708a7-199">但现在，只能通过直接在 querystring 中指定分页条件来实现分页。</span><span class="sxs-lookup"><span data-stu-id="708a7-199">For now, though, paging can only be accomplished by directly specifying the paging criteria in the querystring.</span></span> <span data-ttu-id="708a7-200">例如，若要查看第二页，请将浏览器的地址栏中的 URL 更改 `Paging.aspx` 到 `Paging.aspx?pageIndex=2`，然后按 Enter。</span><span class="sxs-lookup"><span data-stu-id="708a7-200">For example, to view the second page, change the URL in the browser s Address bar from `Paging.aspx` to `Paging.aspx?pageIndex=2` and hit Enter.</span></span> <span data-ttu-id="708a7-201">这将导致显示第二页数据（参见图9）。</span><span class="sxs-lookup"><span data-stu-id="708a7-201">This causes the second page of data to be displayed (see Figure 9).</span></span>

<span data-ttu-id="708a7-202">[显示第二页数据 ![](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image20.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="708a7-202">[![The Second Page of Data is Displayed](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image20.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image19.png)</span></span>

<span data-ttu-id="708a7-203">**图 9**：显示第二页数据（[单击以查看完全大小的图像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image21.png)）</span><span class="sxs-lookup"><span data-stu-id="708a7-203">**Figure 9**: The Second Page of Data is Displayed ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image21.png))</span></span>

## <a name="step-4-creating-the-paging-interface"></a><span data-ttu-id="708a7-204">步骤4：创建分页接口</span><span class="sxs-lookup"><span data-stu-id="708a7-204">Step 4: Creating the Paging Interface</span></span>

<span data-ttu-id="708a7-205">可以实现各种不同的分页接口。</span><span class="sxs-lookup"><span data-stu-id="708a7-205">There are a variety of different paging interfaces that can be implemented.</span></span> <span data-ttu-id="708a7-206">GridView、DetailsView 和 FormView 控件提供四个不同的接口来进行选择：</span><span class="sxs-lookup"><span data-stu-id="708a7-206">The GridView, DetailsView, and FormView controls provide four different interfaces to choose among:</span></span>

- <span data-ttu-id="708a7-207">**接下来，以前**的用户可以一次将一个页面移动到下一个或上一个页面。</span><span class="sxs-lookup"><span data-stu-id="708a7-207">**Next, Previous** users can move one page at a time, to either the next or previous one.</span></span>
- <span data-ttu-id="708a7-208">**接下来，"上一页"、"last"、"Last** " 除 "下一步" 和 "上一步" 按钮外，此接口包含用于移动到第一页或最后一页的第一个和</span><span class="sxs-lookup"><span data-stu-id="708a7-208">**Next, Previous, First, Last** in addition to Next and Previous buttons, this interface includes First and Last buttons for moving to the very first or very last page.</span></span>
- <span data-ttu-id="708a7-209">**数值**列出页面接口中的页码，使用户能够快速跳转至特定页面。</span><span class="sxs-lookup"><span data-stu-id="708a7-209">**Numeric** lists the page numbers in the paging interface, allowing a user to quickly jump to a particular page.</span></span>
- <span data-ttu-id="708a7-210">**数值、第一个、最后一个**除数字页码外，还包含用于移动到第一页或最后一页的按钮。</span><span class="sxs-lookup"><span data-stu-id="708a7-210">**Numeric, First, Last** in addition to the numeric page numbers, includes buttons for moving to the very first or very last page.</span></span>

<span data-ttu-id="708a7-211">对于 DataList 和中继器，我们负责确定分页接口并实现它。</span><span class="sxs-lookup"><span data-stu-id="708a7-211">For the DataList and Repeater, we are responsible for deciding upon a paging interface and implementing it.</span></span> <span data-ttu-id="708a7-212">这涉及到在页中创建所需的 Web 控件，并在单击特定的分页接口按钮时显示请求的页面。</span><span class="sxs-lookup"><span data-stu-id="708a7-212">This involves creating the needed Web controls in the page and displaying the requested page when a particular paging interface button is clicked.</span></span> <span data-ttu-id="708a7-213">此外，可能需要禁用某些分页接口控件。</span><span class="sxs-lookup"><span data-stu-id="708a7-213">Additionally, certain paging interface controls may need to be disabled.</span></span> <span data-ttu-id="708a7-214">例如，使用 "下一步"、"上一步"、"最后一个" 接口查看第一页数据时，将禁用 "第一个" 和 "上一个" 按钮。</span><span class="sxs-lookup"><span data-stu-id="708a7-214">For example, when viewing the first page of data using the Next, Previous, First, Last interface, both the First and Previous buttons would be disabled.</span></span>

<span data-ttu-id="708a7-215">对于本教程，请使用 "下一步"、"上一步"、"最后一个" 接口。</span><span class="sxs-lookup"><span data-stu-id="708a7-215">For this tutorial, let s use the Next, Previous, First, Last interface.</span></span> <span data-ttu-id="708a7-216">将四个按钮 Web 控件添加到页面，并将其 `ID` 设置为 `FirstPage`、`PrevPage`、`NextPage`和 `LastPage`。</span><span class="sxs-lookup"><span data-stu-id="708a7-216">Add four Button Web controls to the page and set their `ID` s to `FirstPage`, `PrevPage`, `NextPage`, and `LastPage`.</span></span> <span data-ttu-id="708a7-217">将 `Text` 属性设置为首先 &lt;&lt;，&lt; "上一步"、"下一 &gt;" 和 "最后 &gt;&gt;"。</span><span class="sxs-lookup"><span data-stu-id="708a7-217">Set the `Text` properties to &lt;&lt; First, &lt; Prev, Next &gt;, and Last &gt;&gt; .</span></span>

[!code-aspx[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample4.aspx)]

<span data-ttu-id="708a7-218">接下来，为每个按钮创建一个 `Click` 事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="708a7-218">Next, create a `Click` event handler for each of these Buttons.</span></span> <span data-ttu-id="708a7-219">稍后，我们将添加显示请求的页面所需的代码。</span><span class="sxs-lookup"><span data-stu-id="708a7-219">In a moment we'll add the code necessary to display the requested page.</span></span>

## <a name="remembering-the-total-number-of-records-being-paged-through"></a><span data-ttu-id="708a7-220">记住要分页到的记录总数</span><span class="sxs-lookup"><span data-stu-id="708a7-220">Remembering the Total Number of Records Being Paged Through</span></span>

<span data-ttu-id="708a7-221">无论选择哪种分页接口，都需要计算并记住正在分页的记录总数。</span><span class="sxs-lookup"><span data-stu-id="708a7-221">Regardless of the paging interface selected, we need to compute and remember the total number of records being paged through.</span></span> <span data-ttu-id="708a7-222">总行数（与页面大小一起）决定正在分页的总页数（确定要添加或启用了哪些分页接口控件）。</span><span class="sxs-lookup"><span data-stu-id="708a7-222">The total row count (in conjunction with the page size) determines how many total pages of data are being paged through, which determines what paging interface controls are added or are enabled.</span></span> <span data-ttu-id="708a7-223">在接下来的 "上一个"、"第一个" 和 "最后一个" 界面中，将通过两种方式使用页面计数：</span><span class="sxs-lookup"><span data-stu-id="708a7-223">In the Next, Previous, First, Last interface that we are building, the page count is used in two ways:</span></span>

- <span data-ttu-id="708a7-224">确定是否正在查看最后一个页面，在这种情况下，"下一步" 和 "最后一个" 按钮会被禁用。</span><span class="sxs-lookup"><span data-stu-id="708a7-224">To determine whether we are viewing the last page, in which case the Next and Last buttons are disabled.</span></span>
- <span data-ttu-id="708a7-225">如果用户单击最后一个按钮，则需要将其 whisk 到最后一页，其索引小于页计数。</span><span class="sxs-lookup"><span data-stu-id="708a7-225">If the user clicks the Last button we need to whisk them to the last page, whose index is one less than the page count.</span></span>

<span data-ttu-id="708a7-226">页计数计算为总计行数的上限除以页面大小。</span><span class="sxs-lookup"><span data-stu-id="708a7-226">The page count is calculated as the ceiling of the total row count divided by the page size.</span></span> <span data-ttu-id="708a7-227">例如，如果我们要分页到79条记录（每页四条记录），则页计数为20（79/4 的上限）。</span><span class="sxs-lookup"><span data-stu-id="708a7-227">For example, if we are paging through 79 records with four records per page, then the page count is 20 (the ceiling of 79 / 4).</span></span> <span data-ttu-id="708a7-228">如果使用的是数字分页接口，则此信息会告诉我们要显示多少个数值页按钮;如果分页接口包含 "下一步" 或 "最后一个" 按钮，则使用页面计数来确定何时禁用下一个或最后一个按钮。</span><span class="sxs-lookup"><span data-stu-id="708a7-228">If we are using the Numeric paging interface, this information informs us as to how many numeric page buttons to display; if our paging interface includes Next or Last buttons, the page count is used to determine when to disable the Next or Last buttons.</span></span>

<span data-ttu-id="708a7-229">如果分页接口包含 "最后一个" 按钮，则必须在每次回发时记住要分页的记录总数，以便单击最后一个按钮时，可以确定最后一页的索引。</span><span class="sxs-lookup"><span data-stu-id="708a7-229">If the paging interface includes a Last button, it is imperative that the total number of records being paged through be remembered across postbacks so that when the Last button is clicked we can determine the last page index.</span></span> <span data-ttu-id="708a7-230">为了便于实现此目的，请在 ASP.NET 页 s 代码隐藏类中创建一个 `TotalRowCount` 属性，该属性将其值保持为查看状态：</span><span class="sxs-lookup"><span data-stu-id="708a7-230">To facilitate this, create a `TotalRowCount` property in the ASP.NET page s code-behind class that persists its value to view state:</span></span>

[!code-csharp[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample5.cs)]

<span data-ttu-id="708a7-231">除了 `TotalRowCount`，请花一分钟时间创建只读页面级属性，以便轻松访问页面索引、页面大小和页面计数：</span><span class="sxs-lookup"><span data-stu-id="708a7-231">In addition to `TotalRowCount`, take a minute to create read-only page-level properties for easily accessing the page index, page size, and page count:</span></span>

[!code-csharp[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample6.cs)]

## <a name="determining-the-total-number-of-records-being-paged-through"></a><span data-ttu-id="708a7-232">确定分页的记录总数</span><span class="sxs-lookup"><span data-stu-id="708a7-232">Determining the Total Number of Records Being Paged Through</span></span>

<span data-ttu-id="708a7-233">从 ObjectDataSource s `Select()` 方法返回的 `PagedDataSource` 对象在*所有*产品记录中都包含在其中，即使 DataList 中只显示了其中的一个子集。</span><span class="sxs-lookup"><span data-stu-id="708a7-233">The `PagedDataSource` object returned from the ObjectDataSource s `Select()` method has within it *all* of the product records, even though only a subset of them are displayed in the DataList.</span></span> <span data-ttu-id="708a7-234">`PagedDataSource` s [`Count` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.count.aspx)仅返回将在 DataList 中显示的项数;[`DataSourceCount` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.datasourcecount.aspx)返回 `PagedDataSource`中项的总数。</span><span class="sxs-lookup"><span data-stu-id="708a7-234">The `PagedDataSource` s [`Count` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.count.aspx) returns only the number of items that will be displayed in the DataList; the [`DataSourceCount` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.datasourcecount.aspx) returns the total number of items within the `PagedDataSource`.</span></span> <span data-ttu-id="708a7-235">因此，需要将 ASP.NET 页 s `TotalRowCount` 属性分配给 `PagedDataSource` s `DataSourceCount` 属性的值。</span><span class="sxs-lookup"><span data-stu-id="708a7-235">Therefore, we need to assign the ASP.NET page s `TotalRowCount` property the value of the `PagedDataSource` s `DataSourceCount` property.</span></span>

<span data-ttu-id="708a7-236">为此，请为 ObjectDataSource `Selected` 事件创建事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="708a7-236">To accomplish this, create an event handler for the ObjectDataSource s `Selected` event.</span></span> <span data-ttu-id="708a7-237">在 `Selected` 事件处理程序中，我们有权访问 ObjectDataSource s `Select()` 方法（在本例中为 `PagedDataSource`）的返回值。</span><span class="sxs-lookup"><span data-stu-id="708a7-237">In the `Selected` event handler we have access to the return value of the ObjectDataSource s `Select()` method in this case, the `PagedDataSource`.</span></span>

[!code-csharp[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample7.cs)]

## <a name="displaying-the-requested-page-of-data"></a><span data-ttu-id="708a7-238">显示请求的数据页</span><span class="sxs-lookup"><span data-stu-id="708a7-238">Displaying the Requested Page of Data</span></span>

<span data-ttu-id="708a7-239">当用户单击寻呼界面中的某个按钮时，需要显示请求的数据页。</span><span class="sxs-lookup"><span data-stu-id="708a7-239">When the user clicks one of the buttons in the paging interface, we need to display the requested page of data.</span></span> <span data-ttu-id="708a7-240">由于分页参数是通过 querystring 指定的，因此要显示请求的数据页，`Response.Redirect(url)` 使用户浏览器使用适当的分页参数重新请求 `Paging.aspx` 页面。</span><span class="sxs-lookup"><span data-stu-id="708a7-240">Since the paging parameters are specified via the querystring, to show the requested page of data use `Response.Redirect(url)` to have the user s browser re-request the `Paging.aspx` page with the appropriate paging parameters.</span></span> <span data-ttu-id="708a7-241">例如，若要显示第二页数据，我们会将用户重定向到 `Paging.aspx?pageIndex=1`。</span><span class="sxs-lookup"><span data-stu-id="708a7-241">For example, to display the second page of data, we would redirect the user to `Paging.aspx?pageIndex=1`.</span></span>

<span data-ttu-id="708a7-242">为此，请创建一个将用户重定向到 `Paging.aspx?pageIndex=sendUserToPageIndex`的 `RedirectUser(sendUserToPageIndex)` 方法。</span><span class="sxs-lookup"><span data-stu-id="708a7-242">To facilitate this, create a `RedirectUser(sendUserToPageIndex)` method that redirects the user to `Paging.aspx?pageIndex=sendUserToPageIndex`.</span></span> <span data-ttu-id="708a7-243">然后，从四个按钮 `Click` 事件处理程序调用此方法。</span><span class="sxs-lookup"><span data-stu-id="708a7-243">Then, call this method from the four Button `Click` event handlers.</span></span> <span data-ttu-id="708a7-244">在 `FirstPage` `Click` 事件处理程序中，调用 `RedirectUser(0)`，以将其发送到第一页;在 `PrevPage` `Click` 事件处理程序中，使用 `PageIndex - 1` 作为页索引;依此类推。</span><span class="sxs-lookup"><span data-stu-id="708a7-244">In the `FirstPage` `Click` event handler, call `RedirectUser(0)`, to send them to the first page; in the `PrevPage` `Click` event handler, use `PageIndex - 1` as the page index; and so on.</span></span>

[!code-csharp[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample8.cs)]

<span data-ttu-id="708a7-245">完成 `Click` 事件处理程序后，可通过单击按钮将 DataList s 记录分页。</span><span class="sxs-lookup"><span data-stu-id="708a7-245">With the `Click` event handlers complete, the DataList s records can be paged through by clicking the buttons.</span></span> <span data-ttu-id="708a7-246">请稍等片刻！</span><span class="sxs-lookup"><span data-stu-id="708a7-246">Take a moment to try it out!</span></span>

## <a name="disabling-paging-interface-controls"></a><span data-ttu-id="708a7-247">禁用分页接口控件</span><span class="sxs-lookup"><span data-stu-id="708a7-247">Disabling Paging Interface Controls</span></span>

<span data-ttu-id="708a7-248">目前，无论正在查看哪个页面，都将启用所有四个按钮。</span><span class="sxs-lookup"><span data-stu-id="708a7-248">Currently, all four buttons are enabled regardless of the page being viewed.</span></span> <span data-ttu-id="708a7-249">但是，当显示第一页数据时，我们希望禁用第一个和上一个按钮，并且在显示最后一页时，将显示 "下一步" 和 "最后一个" 按钮。</span><span class="sxs-lookup"><span data-stu-id="708a7-249">However, we want to disable the First and Previous buttons when showing the first page of data, and the Next and Last buttons when showing the last page.</span></span> <span data-ttu-id="708a7-250">由 ObjectDataSource s `Select()` 方法返回 `PagedDataSource` 对象具有[`IsFirstPage`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.isfirstpage.aspx)和[`IsLastPage`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.islastpage.aspx)的属性，我们可以进行检查以确定是否正在查看第一个或最后一个数据页。</span><span class="sxs-lookup"><span data-stu-id="708a7-250">The `PagedDataSource` object returned by the ObjectDataSource s `Select()` method has properties [`IsFirstPage`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.isfirstpage.aspx) and [`IsLastPage`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.pageddatasource.islastpage.aspx) that we can examine to determine if we are viewing the first or last page of data.</span></span>

<span data-ttu-id="708a7-251">将以下内容添加到 ObjectDataSource s `Selected` 事件处理程序：</span><span class="sxs-lookup"><span data-stu-id="708a7-251">Add the following to the ObjectDataSource s `Selected` event handler:</span></span>

[!code-csharp[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample9.cs)]

<span data-ttu-id="708a7-252">添加此项后，在查看第一页时，将禁用第一个和最后一个按钮，而 "下一步" 和 "上一个" 按钮将在查看最后一页时禁用。</span><span class="sxs-lookup"><span data-stu-id="708a7-252">With this addition, the First and Previous buttons will be disabled when viewing the first page, while the Next and Last buttons will be disabled when viewing the last page.</span></span>

<span data-ttu-id="708a7-253">让我们通过向用户通知他们当前正在查看的页和存在的总页数，来完成分页接口。</span><span class="sxs-lookup"><span data-stu-id="708a7-253">Let s complete the paging interface by informing the user what page they re currently viewing and how many total pages exist.</span></span> <span data-ttu-id="708a7-254">将标签 Web 控件添加到页面，并将其 `ID` 属性设置为 `CurrentPageNumber`。</span><span class="sxs-lookup"><span data-stu-id="708a7-254">Add a Label Web control to the page and set its `ID` property to `CurrentPageNumber`.</span></span> <span data-ttu-id="708a7-255">在 ObjectDataSource s 所选事件处理程序中设置其 `Text` 属性，使其包括正在查看的当前页面（`PageIndex + 1`）和总页数（`PageCount`）。</span><span class="sxs-lookup"><span data-stu-id="708a7-255">Set its `Text` property in the ObjectDataSource s Selected event handler such that it includes the current page being viewed (`PageIndex + 1`) and the total number of pages (`PageCount`).</span></span>

[!code-csharp[Main](paging-report-data-in-a-datalist-or-repeater-control-cs/samples/sample10.cs)]

<span data-ttu-id="708a7-256">图10显示了首次访问 `Paging.aspx`。</span><span class="sxs-lookup"><span data-stu-id="708a7-256">Figure 10 shows `Paging.aspx` when first visited.</span></span> <span data-ttu-id="708a7-257">由于 querystring 为空，因此 DataList 默认为显示前四个产品;"第一个" 和 "上一个" 按钮已禁用。</span><span class="sxs-lookup"><span data-stu-id="708a7-257">Since the querystring is empty, the DataList defaults to showing the first four products; the First and Previous buttons are disabled.</span></span> <span data-ttu-id="708a7-258">单击 "下一步" 将显示接下来的四条记录（见图11）;现在启用了 "前" 和 "上一个" 按钮。</span><span class="sxs-lookup"><span data-stu-id="708a7-258">Clicking Next displays the next four records (see Figure 11); the First and Previous buttons are now enabled.</span></span>

<span data-ttu-id="708a7-259">[显示第一页数据 ![](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image23.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="708a7-259">[![The First Page of Data is Displayed](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image23.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image22.png)</span></span>

<span data-ttu-id="708a7-260">**图 10**：显示了数据的第一页（[单击以查看完全大小的图像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image24.png)）</span><span class="sxs-lookup"><span data-stu-id="708a7-260">**Figure 10**: The First Page of Data is Displayed ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image24.png))</span></span>

<span data-ttu-id="708a7-261">[显示第二页数据 ![](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image26.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="708a7-261">[![The Second Page of Data is Displayed](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image26.png)](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image25.png)</span></span>

<span data-ttu-id="708a7-262">**图 11**：显示第二页数据（[单击以查看完全大小的图像](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image27.png)）</span><span class="sxs-lookup"><span data-stu-id="708a7-262">**Figure 11**: The Second Page of Data is Displayed ([Click to view full-size image](paging-report-data-in-a-datalist-or-repeater-control-cs/_static/image27.png))</span></span>

> [!NOTE]
> <span data-ttu-id="708a7-263">通过允许用户指定要在每页上查看多少页，可以进一步增强分页接口。</span><span class="sxs-lookup"><span data-stu-id="708a7-263">The paging interface can be further enhanced by allowing the user to specify how many pages to view per page.</span></span> <span data-ttu-id="708a7-264">例如，可以添加 DropDownList，其中列出了页面大小选项，如5、10、25、50和 All。</span><span class="sxs-lookup"><span data-stu-id="708a7-264">For example, a DropDownList could be added listing page size options like 5, 10, 25, 50, and All.</span></span> <span data-ttu-id="708a7-265">选择页面大小后，用户需要重定向回 `Paging.aspx?pageIndex=0&pageSize=selectedPageSize`。</span><span class="sxs-lookup"><span data-stu-id="708a7-265">Upon selecting a page size, the user would need to be redirected back to `Paging.aspx?pageIndex=0&pageSize=selectedPageSize`.</span></span> <span data-ttu-id="708a7-266">我将此增强功能实现为读者的练习。</span><span class="sxs-lookup"><span data-stu-id="708a7-266">I leave implementing this enhancement as an exercise for the reader.</span></span>

## <a name="using-custom-paging"></a><span data-ttu-id="708a7-267">使用自定义分页</span><span class="sxs-lookup"><span data-stu-id="708a7-267">Using Custom Paging</span></span>

<span data-ttu-id="708a7-268">使用低效的默认分页方法通过其数据对 DataList 页面进行分页。</span><span class="sxs-lookup"><span data-stu-id="708a7-268">The DataList pages through its data using the inefficient default paging technique.</span></span> <span data-ttu-id="708a7-269">当对大量数据进行分页时，必须使用自定义分页。</span><span class="sxs-lookup"><span data-stu-id="708a7-269">When paging through sufficiently large amounts of data, it is imperative that custom paging be used.</span></span> <span data-ttu-id="708a7-270">虽然实现细节略有不同，但在 DataList 中实现自定义分页的概念与使用默认分页的概念相同。</span><span class="sxs-lookup"><span data-stu-id="708a7-270">Although the implementation details differ slightly, the concepts behind implementing custom paging in a DataList are the same as with default paging.</span></span> <span data-ttu-id="708a7-271">使用自定义分页时，请使用 `ProductBLL` 类 `GetProductsPaged` 方法（而不是 `GetProductsAsPagedDataSource`）。</span><span class="sxs-lookup"><span data-stu-id="708a7-271">With custom paging, use the `ProductBLL` class s `GetProductsPaged` method (instead of `GetProductsAsPagedDataSource`).</span></span> <span data-ttu-id="708a7-272">如[通过大量数据有效分页](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs.md)教程中所述，必须向 `GetProductsPaged` 传递起始行索引和要返回的最大行数。</span><span class="sxs-lookup"><span data-stu-id="708a7-272">As discussed in the [Efficiently Paging Through Large Amounts of Data](../paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs.md) tutorial, `GetProductsPaged` must be passed the start row index and maximum number of rows to return.</span></span> <span data-ttu-id="708a7-273">可以通过 querystring 来维护这些参数，就像在默认分页中使用的 `pageIndex` 和 `pageSize` 参数。</span><span class="sxs-lookup"><span data-stu-id="708a7-273">These parameters can be maintained through the querystring just like the `pageIndex` and `pageSize` parameters used in default paging.</span></span>

<span data-ttu-id="708a7-274">由于没有使用自定义分页的 `PagedDataSource`，因此必须使用替代技术来确定要分页的记录总数，以及是否显示第一个或最后一个数据页。</span><span class="sxs-lookup"><span data-stu-id="708a7-274">Since there s no `PagedDataSource` with custom paging, alternative techniques must be used to determine the total number of records being paged through and whether we re displaying the first or last page of data.</span></span> <span data-ttu-id="708a7-275">`ProductsBLL` 类中的 `TotalNumberOfProducts()` 方法返回正在分页的产品总数。</span><span class="sxs-lookup"><span data-stu-id="708a7-275">The `TotalNumberOfProducts()` method in the `ProductsBLL` class returns the total number of products being paged through.</span></span> <span data-ttu-id="708a7-276">若要确定是否正在查看第一页数据，请检查起始行索引是否为零，然后查看第一页。</span><span class="sxs-lookup"><span data-stu-id="708a7-276">To determine if the first page of data is being viewed, examine the start row index if it is zero, then the first page is being viewed.</span></span> <span data-ttu-id="708a7-277">如果起始行索引加上要返回的最大行数大于或等于要分页的记录总数，则查看最后一页。</span><span class="sxs-lookup"><span data-stu-id="708a7-277">The last page is being viewed if the start row index plus the maximum rows to return is greater than or equal to the total number of records being paged through.</span></span>

<span data-ttu-id="708a7-278">在下一教程中，我们将更详细地探讨如何实现自定义分页。</span><span class="sxs-lookup"><span data-stu-id="708a7-278">We'll explore implementing custom paging in greater detail in the next tutorial.</span></span>

## <a name="summary"></a><span data-ttu-id="708a7-279">总结</span><span class="sxs-lookup"><span data-stu-id="708a7-279">Summary</span></span>

<span data-ttu-id="708a7-280">尽管 DataList 和 Repeater 都不提供在 GridView、DetailsView 和 FormView 控件中提供的 "开箱即用" 支持，但这种功能可以极少地添加。</span><span class="sxs-lookup"><span data-stu-id="708a7-280">While neither the DataList nor Repeater offers the out of the box paging support found in the GridView, DetailsView, and FormView controls, such functionality can be added with minimal effort.</span></span> <span data-ttu-id="708a7-281">实现默认分页的最简单方法是将整个产品集包装在 `PagedDataSource` 中，然后将 `PagedDataSource` 绑定到 DataList 或 Repeater。</span><span class="sxs-lookup"><span data-stu-id="708a7-281">The easiest way to implement default paging is to wrap the entire set of products within a `PagedDataSource` and then bind the `PagedDataSource` to the DataList or Repeater.</span></span> <span data-ttu-id="708a7-282">在本教程中，我们将 `GetProductsAsPagedDataSource` 方法添加到 `ProductsBLL` 类以返回 `PagedDataSource`。</span><span class="sxs-lookup"><span data-stu-id="708a7-282">In this tutorial we added the `GetProductsAsPagedDataSource` method to the `ProductsBLL` class to return the `PagedDataSource`.</span></span> <span data-ttu-id="708a7-283">`ProductsBLL` 类已经包含了自定义分页 `GetProductsPaged` 和 `TotalNumberOfProducts`所需的方法。</span><span class="sxs-lookup"><span data-stu-id="708a7-283">The `ProductsBLL` class already contains the methods needed for custom paging `GetProductsPaged` and `TotalNumberOfProducts`.</span></span>

<span data-ttu-id="708a7-284">除了检索要为自定义分页或默认分页的 `PagedDataSource` 中的所有记录显示的一组确切记录，还需要手动添加分页接口。</span><span class="sxs-lookup"><span data-stu-id="708a7-284">Along with retrieving either the precise set of records to display for custom paging or all records in a `PagedDataSource` for default paging, we also need to manually add the paging interface.</span></span> <span data-ttu-id="708a7-285">在本教程中，我们创建了下一个、上一个、第一个、最后一个具有四个按钮 Web 控件的接口。</span><span class="sxs-lookup"><span data-stu-id="708a7-285">For this tutorial we created a Next, Previous, First, Last interface with four Button Web controls.</span></span> <span data-ttu-id="708a7-286">此外，还添加了一个显示当前页码和总页数的标签控件。</span><span class="sxs-lookup"><span data-stu-id="708a7-286">Also, a Label control displaying the current page number and total number of pages was added.</span></span>

<span data-ttu-id="708a7-287">在下一教程中，我们将了解如何向 DataList 和中继器添加排序支持。</span><span class="sxs-lookup"><span data-stu-id="708a7-287">In the next tutorial we'll see how to add sorting support to the DataList and Repeater.</span></span> <span data-ttu-id="708a7-288">此外，我们还将了解如何创建可以分页和排序的 DataList （使用默认和自定义分页的示例）。</span><span class="sxs-lookup"><span data-stu-id="708a7-288">We'll also see how to create a DataList that can be both paged and sorted (with examples using default and custom paging).</span></span>

<span data-ttu-id="708a7-289">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="708a7-289">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="708a7-290">关于作者</span><span class="sxs-lookup"><span data-stu-id="708a7-290">About the Author</span></span>

<span data-ttu-id="708a7-291">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，创始人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已在使用 Microsoft Web 技术，自1998开始。</span><span class="sxs-lookup"><span data-stu-id="708a7-291">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="708a7-292">Scott 的工作方式是独立的顾问、培训师和撰稿人。</span><span class="sxs-lookup"><span data-stu-id="708a7-292">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="708a7-293">他的最新书籍是，[*在24小时内，sam ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="708a7-293">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="708a7-294">可以[mitchell@4GuysFromRolla.com访问。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="708a7-294">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="708a7-295">或通过他的博客，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="708a7-295">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="708a7-296">特别感谢</span><span class="sxs-lookup"><span data-stu-id="708a7-296">Special Thanks To</span></span>

<span data-ttu-id="708a7-297">此教程系列由许多有用的审阅者查看。</span><span class="sxs-lookup"><span data-stu-id="708a7-297">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="708a7-298">本教程的主管评审者是 Liz Shulok、Ken Pespisa 和 Bernadette Leigh。</span><span class="sxs-lookup"><span data-stu-id="708a7-298">Lead reviewers for this tutorial were Liz Shulok, Ken Pespisa, and Bernadette Leigh.</span></span> <span data-ttu-id="708a7-299">想要查看我即将发布的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="708a7-299">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="708a7-300">如果是这样，请在mitchell@4GuysFromRolla.com放置一行[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="708a7-300">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="708a7-301">下一页</span><span class="sxs-lookup"><span data-stu-id="708a7-301">Next</span></span>](sorting-data-in-a-datalist-or-repeater-control-cs.md)
