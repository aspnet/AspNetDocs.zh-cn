---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/an-overview-of-editing-and-deleting-data-in-the-datalist-cs
title: 编辑和删除 DataList 中的数据的概述（C#） |Microsoft Docs
author: rick-anderson
description: 尽管 DataList 缺少内置的编辑和删除功能，但在本教程中，我们将了解如何创建支持编辑和删除 o 的 DataList 。
ms.author: riande
ms.date: 10/30/2006
ms.assetid: c3b0c86e-fe98-41ee-b26f-ca38cddaa75e
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/an-overview-of-editing-and-deleting-data-in-the-datalist-cs
msc.type: authoredcontent
ms.openlocfilehash: 481c9a14b1ebfe36ffcddd0237701bc04266e393
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/28/2019
ms.locfileid: "74629538"
---
# <a name="an-overview-of-editing-and-deleting-data-in-the-datalist-c"></a><span data-ttu-id="6dea8-103">编辑和删除 DataList 中的数据的概述（C#）</span><span class="sxs-lookup"><span data-stu-id="6dea8-103">An Overview of Editing and Deleting Data in the DataList (C#)</span></span>

<span data-ttu-id="6dea8-104">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="6dea8-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="6dea8-105">[下载示例应用](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_36_CS.exe)或[下载 PDF](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/datatutorial36cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="6dea8-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_36_CS.exe) or [Download PDF](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/datatutorial36cs1.pdf)</span></span>

> <span data-ttu-id="6dea8-106">尽管 DataList 缺少内置的编辑和删除功能，但在本教程中，我们将了解如何创建支持编辑和删除其基础数据的 DataList。</span><span class="sxs-lookup"><span data-stu-id="6dea8-106">While the DataList lacks built-in editing and deleting capabilities, in this tutorial we'll see how to create a DataList that supports editing and deleting of its underlying data.</span></span>

## <a name="introduction"></a><span data-ttu-id="6dea8-107">简介</span><span class="sxs-lookup"><span data-stu-id="6dea8-107">Introduction</span></span>

<span data-ttu-id="6dea8-108">在[插入、更新和删除数据的概述](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)中，我们介绍了如何使用应用程序体系结构、ObjectDataSource 和 GridView、DetailsView 和 FormView 控件插入、更新和删除数据。</span><span class="sxs-lookup"><span data-stu-id="6dea8-108">In the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial we looked at how to insert, update, and delete data using the application architecture, an ObjectDataSource, and the GridView, DetailsView, and FormView controls.</span></span> <span data-ttu-id="6dea8-109">使用 ObjectDataSource 和这三个数据 Web 控件，实现简单的数据修改接口就是一个 snap，只需从智能标记中计时一个复选框。</span><span class="sxs-lookup"><span data-stu-id="6dea8-109">With the ObjectDataSource and these three data Web controls, implementing simple data modification interfaces was a snap and involved merely ticking a checkbox from a smart tag.</span></span> <span data-ttu-id="6dea8-110">无需编写代码。</span><span class="sxs-lookup"><span data-stu-id="6dea8-110">No code needed to be written.</span></span>

<span data-ttu-id="6dea8-111">遗憾的是，DataList 缺少 GridView 控件中固有的内置编辑和删除功能。</span><span class="sxs-lookup"><span data-stu-id="6dea8-111">Unfortunately, the DataList lacks the built-in editing and deleting capabilities inherent in the GridView control.</span></span> <span data-ttu-id="6dea8-112">此缺少的功能在某种程度上是因为，当声明性数据源控件和无代码的数据修改页不可用时，DataList 是以前版本的 ASP.NET 中的 relic。</span><span class="sxs-lookup"><span data-stu-id="6dea8-112">This missing functionality is due in part to the fact that the DataList is a relic from the previous version of ASP.NET, when declarative data source controls and code-free data modification pages were unavailable.</span></span> <span data-ttu-id="6dea8-113">尽管 ASP.NET 2.0 中的 DataList 不提供与 GridView 相同的现成数据修改功能，但我们仍可以使用 ASP.NET 1.x 技术来包括此类功能。</span><span class="sxs-lookup"><span data-stu-id="6dea8-113">While the DataList in ASP.NET 2.0 does not offer the same out of the box data modification capabilities as the GridView, we can use ASP.NET 1.x techniques to include such functionality.</span></span> <span data-ttu-id="6dea8-114">此方法需要一些代码，但正如我们在本教程中看到的那样，DataList 提供了一些事件和属性来帮助进行此过程。</span><span class="sxs-lookup"><span data-stu-id="6dea8-114">This approach requires a bit of code but, as we'll see in this tutorial, the DataList has some events and properties in place to aid in this process.</span></span>

<span data-ttu-id="6dea8-115">在本教程中，我们将了解如何创建支持编辑和删除其基础数据的 DataList。</span><span class="sxs-lookup"><span data-stu-id="6dea8-115">In this tutorial we'll see how to create a DataList that supports editing and deleting of its underlying data.</span></span> <span data-ttu-id="6dea8-116">将来的教程将介绍更高级的编辑和删除方案，包括输入字段验证、适当处理从数据访问或业务逻辑层引发的异常等。</span><span class="sxs-lookup"><span data-stu-id="6dea8-116">Future tutorials will examine more advanced editing and deleting scenarios, including input field validation, gracefully handling exceptions raised from the Data Access or Business Logic Layers, and so on.</span></span>

> [!NOTE]
> <span data-ttu-id="6dea8-117">与 DataList 一样，Repeater 控件缺少用于插入、更新或删除的现成功能。</span><span class="sxs-lookup"><span data-stu-id="6dea8-117">Like the DataList, the Repeater control lacks the out of the box functionality for inserting, updating, or deleting.</span></span> <span data-ttu-id="6dea8-118">虽然可以添加此类功能，但 DataList 包含在 Repeater 中找不到的属性和事件，可简化此类功能的添加。</span><span class="sxs-lookup"><span data-stu-id="6dea8-118">While such functionality can be added, the DataList includes properties and events not found in the Repeater that simplify adding such capabilities.</span></span> <span data-ttu-id="6dea8-119">因此，本教程和以后查看编辑和删除的教程将严格关注 DataList。</span><span class="sxs-lookup"><span data-stu-id="6dea8-119">Therefore, this tutorial and future ones that look at editing and deleting will focus strictly on the DataList.</span></span>

## <a name="step-1-creating-the-editing-and-deleting-tutorials-web-pages"></a><span data-ttu-id="6dea8-120">步骤1：创建编辑和删除教程网页</span><span class="sxs-lookup"><span data-stu-id="6dea8-120">Step 1: Creating the Editing and Deleting Tutorials Web Pages</span></span>

<span data-ttu-id="6dea8-121">在开始探索如何更新和删除 DataList 中的数据之前，先花点时间在我们的网站项目中创建 ASP.NET 页面，我们将在本教程和下几个页面中创建这些页面。</span><span class="sxs-lookup"><span data-stu-id="6dea8-121">Before we start exploring how to update and delete data from a DataList, let s first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial and the next several ones.</span></span> <span data-ttu-id="6dea8-122">首先添加一个名为 `EditDeleteDataList`的新文件夹。</span><span class="sxs-lookup"><span data-stu-id="6dea8-122">Start by adding a new folder named `EditDeleteDataList`.</span></span> <span data-ttu-id="6dea8-123">接下来，将以下 ASP.NET 页面添加到该文件夹，并确保将每个页面与 `Site.master` 母版页关联：</span><span class="sxs-lookup"><span data-stu-id="6dea8-123">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `Basics.aspx`
- `BatchUpdate.aspx`
- `ErrorHandling.aspx`
- `UIValidation.aspx`
- `CustomizedUI.aspx`
- `OptimisticConcurrency.aspx`
- `ConfirmationOnDelete.aspx`
- `UserLevelAccess.aspx`

![添加教程的 ASP.NET 页](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image1.png)

<span data-ttu-id="6dea8-125">**图 1**：添加教程的 ASP.NET 页</span><span class="sxs-lookup"><span data-stu-id="6dea8-125">**Figure 1**: Add the ASP.NET Pages for the Tutorials</span></span>

<span data-ttu-id="6dea8-126">与在其他文件夹中一样，`EditDeleteDataList` 文件夹中的 `Default.aspx` 列出了本部分中的教程。</span><span class="sxs-lookup"><span data-stu-id="6dea8-126">Like in the other folders, `Default.aspx` in the `EditDeleteDataList` folder lists the tutorials in its section.</span></span> <span data-ttu-id="6dea8-127">请记住，`SectionLevelTutorialListing.ascx` 用户控件提供此功能。</span><span class="sxs-lookup"><span data-stu-id="6dea8-127">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="6dea8-128">因此，通过将此用户控件从解决方案资源管理器拖到页面 s 设计视图，将该用户控件添加到 `Default.aspx`。</span><span class="sxs-lookup"><span data-stu-id="6dea8-128">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>

<span data-ttu-id="6dea8-129">[![将 SectionLevelTutorialListing 用户控件添加到 default.aspx](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image3.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="6dea8-129">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image3.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image2.png)</span></span>

<span data-ttu-id="6dea8-130">**图 2**：将 `SectionLevelTutorialListing.ascx` 用户控件添加到 `Default.aspx` （[单击以查看完全大小的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image4.png)）</span><span class="sxs-lookup"><span data-stu-id="6dea8-130">**Figure 2**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image4.png))</span></span>

<span data-ttu-id="6dea8-131">最后，将页面作为条目添加到 `Web.sitemap` 文件中。</span><span class="sxs-lookup"><span data-stu-id="6dea8-131">Lastly, add the pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="6dea8-132">具体而言，请在主/详细信息报表后面添加包含 DataList 和 Repeater `<siteMapNode>`的以下标记：</span><span class="sxs-lookup"><span data-stu-id="6dea8-132">Specifically, add the following markup after the Master/Detail Reports with the DataList and Repeater `<siteMapNode>`:</span></span>

[!code-xml[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample1.xml)]

<span data-ttu-id="6dea8-133">更新 `Web.sitemap`后，请花点时间通过浏览器查看教程网站。</span><span class="sxs-lookup"><span data-stu-id="6dea8-133">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="6dea8-134">左侧菜单现在包含 DataList 编辑和删除教程的项。</span><span class="sxs-lookup"><span data-stu-id="6dea8-134">The menu on the left now includes items for the DataList editing and deleting tutorials.</span></span>

![站点映射现在包含 DataList 编辑和删除教程的条目](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image5.png)

<span data-ttu-id="6dea8-136">**图 3**：站点地图现在包含 DataList 编辑和删除教程的条目</span><span class="sxs-lookup"><span data-stu-id="6dea8-136">**Figure 3**: The Site Map Now Includes Entries for the DataList Editing and Deleting Tutorials</span></span>

## <a name="step-2-examining-techniques-for-updating-and-deleting-data"></a><span data-ttu-id="6dea8-137">步骤2：检查更新和删除数据的方法</span><span class="sxs-lookup"><span data-stu-id="6dea8-137">Step 2: Examining Techniques for Updating and Deleting Data</span></span>

<span data-ttu-id="6dea8-138">使用 GridView 编辑和删除数据变得非常简单，因为在幕后，GridView 和 ObjectDataSource 在协同工作。</span><span class="sxs-lookup"><span data-stu-id="6dea8-138">Editing and deleting data with the GridView is so easy because, underneath the covers, the GridView and ObjectDataSource work in concert.</span></span> <span data-ttu-id="6dea8-139">如[检查与插入、更新和删除教程相关的事件](../editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-cs.md)中所述，单击 "行更新" 按钮时，GridView 会自动将使用双向数据绑定的字段分配给其 ObjectDataSource 的 `UpdateParameters` 集合，然后调用该 objectdatasource 的 `Update()` 方法。</span><span class="sxs-lookup"><span data-stu-id="6dea8-139">As discussed in the [Examining the Events Associated with Inserting, Updating, and Deleting](../editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-cs.md) tutorial, when a row s Update button is clicked, the GridView automatically assigns its fields that used two-way databinding to the `UpdateParameters` collection of its ObjectDataSource and then invokes that ObjectDataSource s `Update()` method.</span></span>

<span data-ttu-id="6dea8-140">不幸的是，DataList 并未提供此内置功能。</span><span class="sxs-lookup"><span data-stu-id="6dea8-140">Sadly, the DataList does not provide any of this built-in functionality.</span></span> <span data-ttu-id="6dea8-141">我们负责确保将用户的值分配给 ObjectDataSource s 参数，并调用它的 `Update()` 方法。</span><span class="sxs-lookup"><span data-stu-id="6dea8-141">It is our responsibility to ensure that the user s values are assigned to the ObjectDataSource s parameters and that its `Update()` method is called.</span></span> <span data-ttu-id="6dea8-142">为帮助我们做到这一点，DataList 提供了以下属性和事件：</span><span class="sxs-lookup"><span data-stu-id="6dea8-142">To aid us in this endeavor, the DataList provides the following properties and events:</span></span>

- <span data-ttu-id="6dea8-143">**[`DataKeyField` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basedatalist.datakeyfield.aspx)** 在更新或删除时，需要能够唯一地标识 DataList 中的每一项。</span><span class="sxs-lookup"><span data-stu-id="6dea8-143">**The [`DataKeyField` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basedatalist.datakeyfield.aspx)** when updating or deleting, we need to be able to uniquely identify each item in the DataList.</span></span> <span data-ttu-id="6dea8-144">将此属性设置为显示的数据的主键字段。</span><span class="sxs-lookup"><span data-stu-id="6dea8-144">Set this property to the primary key field of the displayed data.</span></span> <span data-ttu-id="6dea8-145">这样做将用每个 DataList 项的指定 `DataKeyField` 值填充 DataList s [`DataKeys` 集合](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basedatalist.datakeys.aspx)。</span><span class="sxs-lookup"><span data-stu-id="6dea8-145">Doing so will populate the DataList s [`DataKeys` collection](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basedatalist.datakeys.aspx) with the specified `DataKeyField` value for each DataList item.</span></span>
- <span data-ttu-id="6dea8-146">当单击其 `CommandName` 属性设置为 "编辑" 的按钮、LinkButton 或 ImageButton 时，**将激发[`EditCommand` 事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.editcommand.aspx)** 。</span><span class="sxs-lookup"><span data-stu-id="6dea8-146">**The [`EditCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.editcommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Edit is clicked.</span></span>
- <span data-ttu-id="6dea8-147">当单击 `CommandName` 属性设置为取消的按钮、LinkButton 或 ImageButton 时 **，将激发[`CancelCommand` 事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.cancelcommand.aspx)** 。</span><span class="sxs-lookup"><span data-stu-id="6dea8-147">**The [`CancelCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.cancelcommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Cancel is clicked.</span></span>
- <span data-ttu-id="6dea8-148">当单击其 `CommandName` 属性设置为 Update 的按钮、LinkButton 或 ImageButton 时，**将激发[`UpdateCommand` 事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.updatecommand.aspx)** 。</span><span class="sxs-lookup"><span data-stu-id="6dea8-148">**The [`UpdateCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.updatecommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Update is clicked.</span></span>
- <span data-ttu-id="6dea8-149">当单击其 `CommandName` 属性设置为删除的按钮、LinkButton 或 ImageButton 时，**将激发[`DeleteCommand` 事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.deletecommand.aspx)** 。</span><span class="sxs-lookup"><span data-stu-id="6dea8-149">**The [`DeleteCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.deletecommand.aspx)** fires when a Button, LinkButton, or ImageButton whose `CommandName` property is set to Delete is clicked.</span></span>

<span data-ttu-id="6dea8-150">使用这些属性和事件，可以使用四种方法更新和删除 DataList 中的数据：</span><span class="sxs-lookup"><span data-stu-id="6dea8-150">Using these properties and events, there are four approaches we can use to update and delete data from the DataList:</span></span>

1. <span data-ttu-id="6dea8-151">**使用 ASP.NET 1.X 技术**，DataList 在 ASP.NET 2.0 和 objectdatasource 之前已经存在，并能够完全通过编程方式更新和删除数据。</span><span class="sxs-lookup"><span data-stu-id="6dea8-151">**Using ASP.NET 1.x Techniques** the DataList existed prior to ASP.NET 2.0 and ObjectDataSources and was able to update and delete data entirely through programmatic means.</span></span> <span data-ttu-id="6dea8-152">此方法完全 ditches 了 ObjectDataSource，并要求将数据直接从业务逻辑层绑定到 DataList，同时检索要显示的数据以及更新或删除记录的时间。</span><span class="sxs-lookup"><span data-stu-id="6dea8-152">This technique ditches the ObjectDataSource altogether and requires that we bind the data to the DataList directly from the Business Logic Layer, both in retrieving the data to display and when updating or deleting a record.</span></span>
2. <span data-ttu-id="6dea8-153">在**页面上使用单个 ObjectDataSource 控件来选择、更新和删除**DataList，而 DataList 缺少 GridView 固有的编辑和删除功能，则没有理由将它们自行添加。</span><span class="sxs-lookup"><span data-stu-id="6dea8-153">**Using a Single ObjectDataSource Control on the Page for Selecting, Updating, and Deleting** while the DataList lacks the GridView s inherent editing and deleting capabilities, there s no reason we can t add them in ourselves.</span></span> <span data-ttu-id="6dea8-154">使用此方法时，我们将使用一个 ObjectDataSource，就像在 GridView 示例中一样，但必须为 DataList s `UpdateCommand` 事件创建一个事件处理程序，并在其中设置 ObjectDataSource s 参数并调用其 `Update()` 方法。</span><span class="sxs-lookup"><span data-stu-id="6dea8-154">With this approach, we use an ObjectDataSource just like in the GridView examples, but must create an event handler for the DataList s `UpdateCommand` event where we set the ObjectDataSource s parameters and call its `Update()` method.</span></span>
3. <span data-ttu-id="6dea8-155">**使用 ObjectDataSource 控件选择，但**在使用选项2时，直接针对 BLL 进行更新和删除，我们需要在 `UpdateCommand` 事件中编写一些代码，并分配参数值等。</span><span class="sxs-lookup"><span data-stu-id="6dea8-155">**Using an ObjectDataSource Control for Selecting, but Updating and Deleting Directly Against the BLL** when using option 2, we need to write a bit of code in the `UpdateCommand` event, assigning parameter values and so on.</span></span> <span data-ttu-id="6dea8-156">相反，我们可以继续使用 ObjectDataSource 进行选择，但会直接对 BLL 进行更新和删除调用（如使用选项1）。</span><span class="sxs-lookup"><span data-stu-id="6dea8-156">Instead, we can stick with using the ObjectDataSource for selecting, but make the updating and deleting calls directly against the BLL (like with option 1).</span></span> <span data-ttu-id="6dea8-157">在我看来，通过直接与 BLL 进行联系，更新数据会导致可读性更高的代码，而不是分配 ObjectDataSource `UpdateParameters` 并调用其 `Update()` 方法。</span><span class="sxs-lookup"><span data-stu-id="6dea8-157">In my opinion, updating data by interfacing directly with the BLL leads to more readable code than assigning the ObjectDataSource s `UpdateParameters` and calling its `Update()` method.</span></span>
4. <span data-ttu-id="6dea8-158">**使用声明性方式，通过多个 objectdatasource** ，以上三种方法都需要使用几个代码。</span><span class="sxs-lookup"><span data-stu-id="6dea8-158">**Using Declarative Means through Multiple ObjectDataSources** the previous three approaches all require a bit of code.</span></span> <span data-ttu-id="6dea8-159">如果你不想继续使用尽可能多的声明性语法，最后一种方法是在页面上包含多个 Objectdatasource。</span><span class="sxs-lookup"><span data-stu-id="6dea8-159">If you d rather keep using as much declarative syntax as possible, a final option is to include multiple ObjectDataSources on the page.</span></span> <span data-ttu-id="6dea8-160">第一个 ObjectDataSource 从 BLL 中检索数据并将其绑定到 DataList。</span><span class="sxs-lookup"><span data-stu-id="6dea8-160">The first ObjectDataSource retrieves the data from the BLL and binds it to the DataList.</span></span> <span data-ttu-id="6dea8-161">对于更新，会添加另一个 ObjectDataSource，但会直接在 `EditItemTemplate`的 DataList 中添加。</span><span class="sxs-lookup"><span data-stu-id="6dea8-161">For updating, another ObjectDataSource is added, but added directly within the DataList s `EditItemTemplate`.</span></span> <span data-ttu-id="6dea8-162">若要包括删除支持，请在 `ItemTemplate`中需要另一个 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="6dea8-162">To include deleting support, yet another ObjectDataSource would be needed in the `ItemTemplate`.</span></span> <span data-ttu-id="6dea8-163">使用此方法时，这些嵌入的 ObjectDataSource 会使用 `ControlParameters` 以声明方式将 ObjectDataSource s 参数绑定到用户输入控件（不必在 DataList s `UpdateCommand` 事件处理程序中以编程方式指定这些参数）。</span><span class="sxs-lookup"><span data-stu-id="6dea8-163">With this approach, these embedded ObjectDataSource s use `ControlParameters` to declaratively bind the ObjectDataSource s parameters to the user input controls (rather than having to specify them programmatically in the DataList s `UpdateCommand` event handler).</span></span> <span data-ttu-id="6dea8-164">此方法仍需要一些代码来调用嵌入的 ObjectDataSource `Update()` 或 `Delete()` 命令，但所需的方法远远低于其他三个方法。</span><span class="sxs-lookup"><span data-stu-id="6dea8-164">This approach still requires a bit of code we need to call the embedded ObjectDataSource s `Update()` or `Delete()` command but requires far less than with the other three approaches.</span></span> <span data-ttu-id="6dea8-165">这里的缺点是，多个 Objectdatasource 确实会打乱页面，从整体的可读性中 detracting。</span><span class="sxs-lookup"><span data-stu-id="6dea8-165">The downside here is that the multiple ObjectDataSources do clutter up the page, detracting from the overall readability.</span></span>

<span data-ttu-id="6dea8-166">如果强制只使用其中一种方法，我将选择选项1，因为它提供了最大的灵活性，并且 DataList 最初设计为适应此模式。</span><span class="sxs-lookup"><span data-stu-id="6dea8-166">If forced to only ever use one of these approaches, I d choose option 1 because it provides the most flexibility and because the DataList was originally designed to accommodate this pattern.</span></span> <span data-ttu-id="6dea8-167">尽管 DataList 已经过扩展，可以使用 ASP.NET 2.0 数据源控件，但它不具有官方 ASP.NET 2.0 数据 Web 控件（GridView、DetailsView 和 FormView）的所有扩展点或功能。</span><span class="sxs-lookup"><span data-stu-id="6dea8-167">While the DataList was extended to work with the ASP.NET 2.0 data source controls, it does not have all of the extensibility points or features of the official ASP.NET 2.0 data Web controls (the GridView, DetailsView, and FormView).</span></span> <span data-ttu-id="6dea8-168">但不能使用选项2到4。</span><span class="sxs-lookup"><span data-stu-id="6dea8-168">Options 2 through 4 are not without merit, though.</span></span>

<span data-ttu-id="6dea8-169">这种情况下，以后的编辑和删除教程将使用 ObjectDataSource 来检索要显示的数据，并直接调用 BLL 以更新和删除数据（选项3）。</span><span class="sxs-lookup"><span data-stu-id="6dea8-169">This and the future editing and deleting tutorials will use an ObjectDataSource for retrieving the data to display and direct calls to the BLL to update and delete data (option 3).</span></span>

## <a name="step-3-adding-the-datalist-and-configuring-its-objectdatasource"></a><span data-ttu-id="6dea8-170">步骤3：添加 DataList 并配置其 ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="6dea8-170">Step 3: Adding the DataList and Configuring its ObjectDataSource</span></span>

<span data-ttu-id="6dea8-171">在本教程中，我们将创建一个列出产品信息的 DataList，并为每个产品提供了编辑名称和价格以及完全删除该产品的功能。</span><span class="sxs-lookup"><span data-stu-id="6dea8-171">In this tutorial we will create a DataList that lists product information and, for each product, provides the user the ability to edit the name and price and to delete the product altogether.</span></span> <span data-ttu-id="6dea8-172">具体而言，我们将使用 ObjectDataSource 检索要显示的记录，但通过直接与 BLL 进行直接交互来执行更新和删除操作。</span><span class="sxs-lookup"><span data-stu-id="6dea8-172">In particular, we will retrieve the records to display using an ObjectDataSource, but perform the update and delete actions by interfacing directly with the BLL.</span></span> <span data-ttu-id="6dea8-173">在考虑如何实现对 DataList 的编辑和删除功能之前，让我们先获取页面以在只读界面中显示产品。</span><span class="sxs-lookup"><span data-stu-id="6dea8-173">Before we worry about implementing the editing and deleting capabilities to the DataList, let s first get the page to display the products in a read-only interface.</span></span> <span data-ttu-id="6dea8-174">由于我们已在前面的教程中检查了这些步骤，因此我将继续执行这些步骤。</span><span class="sxs-lookup"><span data-stu-id="6dea8-174">Since we ve examined these steps in previous tutorials, I'll proceed through them quickly.</span></span>

<span data-ttu-id="6dea8-175">首先打开 `EditDeleteDataList` 文件夹中的 "`Basics.aspx`" 页，然后从设计视图向页面添加 DataList。</span><span class="sxs-lookup"><span data-stu-id="6dea8-175">Start by opening the `Basics.aspx` page in the `EditDeleteDataList` folder and, from the Design view, add a DataList to the page.</span></span> <span data-ttu-id="6dea8-176">接下来，从 DataList s 智能标记创建一个新的 ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="6dea8-176">Next, from the DataList s smart tag, create a new ObjectDataSource.</span></span> <span data-ttu-id="6dea8-177">由于我们使用的是产品数据，因此请将其配置为使用 `ProductsBLL` 类。</span><span class="sxs-lookup"><span data-stu-id="6dea8-177">Since we are working with product data, configure it to use the `ProductsBLL` class.</span></span> <span data-ttu-id="6dea8-178">若要检索*所有*产品，请在 "选择" 选项卡中选择 `GetProducts()` 方法。</span><span class="sxs-lookup"><span data-stu-id="6dea8-178">To retrieve *all* products, choose the `GetProducts()` method in the SELECT tab.</span></span>

<span data-ttu-id="6dea8-179">[![将 ObjectDataSource 配置为使用 ProductsBLL 类](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image7.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="6dea8-179">[![Configure the ObjectDataSource to Use the ProductsBLL Class](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image7.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image6.png)</span></span>

<span data-ttu-id="6dea8-180">**图 4**：将 ObjectDataSource 配置为使用 `ProductsBLL` 类（[单击以查看完全大小的映像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image8.png)）</span><span class="sxs-lookup"><span data-stu-id="6dea8-180">**Figure 4**: Configure the ObjectDataSource to Use the `ProductsBLL` Class ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image8.png))</span></span>

<span data-ttu-id="6dea8-181">[![使用 GetProducts （）方法返回产品信息](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image10.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="6dea8-181">[![Return the Product Information Using the GetProducts() Method](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image10.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image9.png)</span></span>

<span data-ttu-id="6dea8-182">**图 5**：使用 `GetProducts()` 方法返回产品信息（[单击以查看完全大小的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image11.png)）</span><span class="sxs-lookup"><span data-stu-id="6dea8-182">**Figure 5**: Return the Product Information Using the `GetProducts()` Method ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image11.png))</span></span>

<span data-ttu-id="6dea8-183">DataList （如 GridView）不用于插入新数据;因此，请从 "插入" 选项卡的下拉列表中选择 "（无）" 选项。对于 "更新" 和 "删除" 选项卡，请选择 "（无）"，因为更新和删除操作将通过 BLL 以编程方式执行。</span><span class="sxs-lookup"><span data-stu-id="6dea8-183">The DataList, like the GridView, is not designed for inserting new data; therefore, select the (None) option from the drop-down list in the INSERT tab. Also choose (None) for the UPDATE and DELETE tabs since the updates and deletes will be performed programmatically through the BLL.</span></span>

<span data-ttu-id="6dea8-184">[![确认 ObjectDataSource s INSERT、UPDATE 和 DELETE 选项卡中的下拉列表设置为 "（无）"](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image13.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="6dea8-184">[![Confirm that the Drop-Down Lists in the ObjectDataSource s INSERT, UPDATE, and DELETE Tabs are Set to (None)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image13.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image12.png)</span></span>

<span data-ttu-id="6dea8-185">**图 6**：确认 OBJECTDATASOURCE s INSERT、UPDATE 和 DELETE 选项卡中的下拉列表设置为 "（无）" （[单击查看完全大小的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image14.png)）</span><span class="sxs-lookup"><span data-stu-id="6dea8-185">**Figure 6**: Confirm that the Drop-Down Lists in the ObjectDataSource s INSERT, UPDATE, and DELETE Tabs are Set to (None) ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image14.png))</span></span>

<span data-ttu-id="6dea8-186">配置 ObjectDataSource 后，单击 "完成"，返回到设计器。</span><span class="sxs-lookup"><span data-stu-id="6dea8-186">After configuring the ObjectDataSource, click Finish, returning to the Designer.</span></span> <span data-ttu-id="6dea8-187">正如我们过去的示例中所示，当完成 ObjectDataSource 配置时，Visual Studio 将自动为 DropDownList 创建 `ItemTemplate`，并显示每个数据字段。</span><span class="sxs-lookup"><span data-stu-id="6dea8-187">As we ve seen in past examples, when completing the ObjectDataSource configuration, Visual Studio automatically creates an `ItemTemplate` for the DropDownList, displaying each of the data fields.</span></span> <span data-ttu-id="6dea8-188">将此 `ItemTemplate` 替换为仅显示产品的名称和价格的。</span><span class="sxs-lookup"><span data-stu-id="6dea8-188">Replace this `ItemTemplate` with one that displays only the product s name and price.</span></span> <span data-ttu-id="6dea8-189">同时，将 `RepeatColumns` 属性设置为2。</span><span class="sxs-lookup"><span data-stu-id="6dea8-189">Also, set the `RepeatColumns` property to 2.</span></span>

> [!NOTE]
> <span data-ttu-id="6dea8-190">如*插入、更新和删除数据概述*教程中所述，当使用 ObjectDataSource 修改数据时，我们的体系结构需要从 objectdatasource 的声明性标记中删除 `OldValuesParameterFormatString` 属性（或将其重置为其默认值，`{0}`）。</span><span class="sxs-lookup"><span data-stu-id="6dea8-190">As discussed in the *Overview of Inserting, Updating, and Deleting Data* tutorial, when modifying data using the ObjectDataSource our architecture requires that we remove the `OldValuesParameterFormatString` property from the ObjectDataSource s declarative markup (or reset it to its default value, `{0}`).</span></span> <span data-ttu-id="6dea8-191">但是，在本教程中，我们只使用 ObjectDataSource 来检索数据。</span><span class="sxs-lookup"><span data-stu-id="6dea8-191">In this tutorial, however, we are using the ObjectDataSource only for retrieving data.</span></span> <span data-ttu-id="6dea8-192">因此，不需要修改 ObjectDataSource s `OldValuesParameterFormatString` 属性值（尽管这不会造成影响）。</span><span class="sxs-lookup"><span data-stu-id="6dea8-192">Therefore, we do not need to modify the ObjectDataSource s `OldValuesParameterFormatString` property value (although it doesn t hurt to do so).</span></span>

<span data-ttu-id="6dea8-193">将默认 DataList `ItemTemplate` 替换为自定义的 DataList 后，页面上的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="6dea8-193">After replacing the default DataList `ItemTemplate` with a customized one, the declarative markup on your page should look similar to the following:</span></span>

[!code-aspx[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample2.aspx)]

<span data-ttu-id="6dea8-194">花点时间通过浏览器查看进度。</span><span class="sxs-lookup"><span data-stu-id="6dea8-194">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="6dea8-195">如图7所示，DataList 显示两列中的每个产品的产品名称和单价。</span><span class="sxs-lookup"><span data-stu-id="6dea8-195">As Figure 7 shows, the DataList displays the product name and unit price for each product in two columns.</span></span>

<span data-ttu-id="6dea8-196">[![产品名称和价格显示在两列 DataList 中](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image16.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="6dea8-196">[![The Products Names and Prices are Displayed in a Two-Column DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image16.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image15.png)</span></span>

<span data-ttu-id="6dea8-197">**图 7**：产品名称和价格显示在两列 DataList 中（[单击以查看完全大小的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image17.png)）</span><span class="sxs-lookup"><span data-stu-id="6dea8-197">**Figure 7**: The Products Names and Prices are Displayed in a Two-Column DataList ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image17.png))</span></span>

> [!NOTE]
> <span data-ttu-id="6dea8-198">DataList 具有多个更新和删除进程所需的属性，这些值存储在视图状态中。</span><span class="sxs-lookup"><span data-stu-id="6dea8-198">The DataList has a number of properties that are required for the updating and deleting process, and these values are stored in view state.</span></span> <span data-ttu-id="6dea8-199">因此，在生成支持编辑或删除数据的 DataList 时，必须启用 DataList 的视图状态。</span><span class="sxs-lookup"><span data-stu-id="6dea8-199">Therefore, when building a DataList that supports editing or deleting data, it is essential that the DataList s view state be enabled.</span></span>  
>   
> <span data-ttu-id="6dea8-200">敏锐读取器可能会回忆到，我们能够在创建可编辑的 GridViews、DetailsViews 和 FormViews 时禁用视图状态。</span><span class="sxs-lookup"><span data-stu-id="6dea8-200">The astute reader may recall that we were able to disable view state when creating editable GridViews, DetailsViews, and FormViews.</span></span> <span data-ttu-id="6dea8-201">这是因为，ASP.NET 2.0 Web 控件可以包含*控件状态*，这是在视图状态等回发（如视图状态，但认为是必需的）期间保持的状态。</span><span class="sxs-lookup"><span data-stu-id="6dea8-201">This is because ASP.NET 2.0 Web controls can include *control state*, which is state persisted across postbacks like view state, but deemed essential.</span></span>

<span data-ttu-id="6dea8-202">在 GridView 中禁用视图状态只会省略普通状态信息，但会保持控件状态（包括编辑和删除所需的状态）。</span><span class="sxs-lookup"><span data-stu-id="6dea8-202">Disabling view state in the GridView merely omits trivial state information, but maintains the control state (which includes the state necessary for editing and deleting).</span></span> <span data-ttu-id="6dea8-203">在 ASP.NET 1.x 时间范围内创建的 DataList 不使用控件状态，因此必须启用视图状态。</span><span class="sxs-lookup"><span data-stu-id="6dea8-203">The DataList, having been created in the ASP.NET 1.x timeframe, does not utilize control state and therefore must have view state enabled.</span></span> <span data-ttu-id="6dea8-204">有关控件状态的用途及其与视图状态之间的不同之处的详细信息，请参阅[控件状态与视图状态](https://msdn.microsoft.com/library/1whwt1k7.aspx)。</span><span class="sxs-lookup"><span data-stu-id="6dea8-204">See [Control State vs. View State](https://msdn.microsoft.com/library/1whwt1k7.aspx) for more information on the purpose of control state and how it differs from view state.</span></span>

## <a name="step-4-adding-an-editing-user-interface"></a><span data-ttu-id="6dea8-205">步骤4：添加编辑用户界面</span><span class="sxs-lookup"><span data-stu-id="6dea8-205">Step 4: Adding an Editing User Interface</span></span>

<span data-ttu-id="6dea8-206">GridView 控件由一组字段（BoundFields、CheckBoxFields、Templatefield 等）组成。</span><span class="sxs-lookup"><span data-stu-id="6dea8-206">The GridView control is composed of a collection of fields (BoundFields, CheckBoxFields, TemplateFields, and so on).</span></span> <span data-ttu-id="6dea8-207">这些字段可根据其模式调整呈现的标记。</span><span class="sxs-lookup"><span data-stu-id="6dea8-207">These fields can adjust their rendered markup depending on their mode.</span></span> <span data-ttu-id="6dea8-208">例如，在只读模式下，BoundField 将其数据字段值显示为文本;处于编辑模式时，它将呈现一个文本框 Web 控件，其 `Text` 属性分配有数据字段值。</span><span class="sxs-lookup"><span data-stu-id="6dea8-208">For example, when in read-only mode, a BoundField displays its data field value as text; when in edit mode, it renders a TextBox Web control whose `Text` property is assigned the data field value.</span></span>

<span data-ttu-id="6dea8-209">另一方面，DataList 使用模板呈现其项。</span><span class="sxs-lookup"><span data-stu-id="6dea8-209">The DataList, on the other hand, renders its items using templates.</span></span> <span data-ttu-id="6dea8-210">只读项是使用 `ItemTemplate` 呈现的，而处于编辑模式的项则是通过 `EditItemTemplate`呈现的。</span><span class="sxs-lookup"><span data-stu-id="6dea8-210">Read-only items are rendered using the `ItemTemplate` whereas items in edit mode are rendered via the `EditItemTemplate`.</span></span> <span data-ttu-id="6dea8-211">此时，DataList 只有一个 `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="6dea8-211">At this point, our DataList has only an `ItemTemplate`.</span></span> <span data-ttu-id="6dea8-212">若要支持项级编辑功能，我们需要添加一个 `EditItemTemplate`，其中包含要为可编辑项显示的标记。</span><span class="sxs-lookup"><span data-stu-id="6dea8-212">To support item-level editing functionality we need to add an `EditItemTemplate` that contains the markup to be displayed for the editable item.</span></span> <span data-ttu-id="6dea8-213">对于本教程，我们将使用 TextBox Web 控件来编辑产品的名称和单价。</span><span class="sxs-lookup"><span data-stu-id="6dea8-213">For this tutorial, we'll use TextBox Web controls for editing the product s name and unit price.</span></span>

<span data-ttu-id="6dea8-214">可以通过声明方式或通过设计器创建 `EditItemTemplate` （通过从 DataList s 智能标记选择 "编辑模板" 选项）。</span><span class="sxs-lookup"><span data-stu-id="6dea8-214">The `EditItemTemplate` can be created either declaratively or through the Designer (by selecting the Edit Templates option from the DataList s smart tag).</span></span> <span data-ttu-id="6dea8-215">若要使用 "编辑模板" 选项，请先在智能标记中单击 "编辑模板" 链接，然后从下拉列表中选择 `EditItemTemplate` 项。</span><span class="sxs-lookup"><span data-stu-id="6dea8-215">To use the Edit Templates option, first click the Edit Templates link in the smart tag and then select the `EditItemTemplate` item from the drop-down list.</span></span>

<span data-ttu-id="6dea8-216">[![选择使用 DataList s EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image19.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="6dea8-216">[![Opt to Work with the DataList s EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image19.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image18.png)</span></span>

<span data-ttu-id="6dea8-217">**图 8**：选择使用 DataList `EditItemTemplate` （[单击查看完全大小的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image20.png)）</span><span class="sxs-lookup"><span data-stu-id="6dea8-217">**Figure 8**: Opt to Work with the DataList s `EditItemTemplate` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image20.png))</span></span>

<span data-ttu-id="6dea8-218">接下来，键入产品名称：和价格：，然后将 "工具箱" 中的两个 TextBox 控件拖到设计器上的 `EditItemTemplate` 接口。</span><span class="sxs-lookup"><span data-stu-id="6dea8-218">Next, type in Product name: and Price: and then drag two TextBox controls from the Toolbox into the `EditItemTemplate` interface on the Designer.</span></span> <span data-ttu-id="6dea8-219">将 "文本框" `ID` 属性设置为 `ProductName` 和 `UnitPrice`。</span><span class="sxs-lookup"><span data-stu-id="6dea8-219">Set the TextBoxes `ID` properties to `ProductName` and `UnitPrice`.</span></span>

<span data-ttu-id="6dea8-220">[![为产品的名称和价格添加文本框](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image22.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="6dea8-220">[![Add a TextBox for the Product s Name and Price](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image22.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image21.png)</span></span>

<span data-ttu-id="6dea8-221">**图 9**：为产品的 "名称" 和 "价格" 添加文本框（[单击以查看完全大小的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image23.png)）</span><span class="sxs-lookup"><span data-stu-id="6dea8-221">**Figure 9**: Add a TextBox for the Product s Name and Price ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image23.png))</span></span>

<span data-ttu-id="6dea8-222">需要将相应的产品数据字段值绑定到两个文本框的 `Text` 属性。</span><span class="sxs-lookup"><span data-stu-id="6dea8-222">We need to bind the corresponding product data field values to the `Text` properties of the two TextBoxes.</span></span> <span data-ttu-id="6dea8-223">在 "文本框" 智能标记中，单击 "编辑数据绑定" 链接，然后将相应的数据字段与 `Text` 属性相关联，如图10所示。</span><span class="sxs-lookup"><span data-stu-id="6dea8-223">From the TextBoxes smart tags, click on the Edit DataBindings link and then associate the appropriate data field with the `Text` property, as shown in Figure 10.</span></span>

> [!NOTE]
> <span data-ttu-id="6dea8-224">将 `UnitPrice` 数据字段绑定到 "价格" 文本框 `Text` 字段时，可以将其格式设置为货币值（`{0:C}`）、常规数字（`{0:N}`），或将其设置为未格式化。</span><span class="sxs-lookup"><span data-stu-id="6dea8-224">When binding the `UnitPrice` data field to the price TextBox s `Text` field, you may format it as a currency value (`{0:C}`), a general number (`{0:N}`), or leave it unformatted.</span></span>

![将 "产品名称" 和 "单价" 数据字段绑定到文本框的文本属性](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image24.png)

<span data-ttu-id="6dea8-226">**图 10**：将 `ProductName` 和 `UnitPrice` 数据字段绑定到文本框的 `Text` 属性</span><span class="sxs-lookup"><span data-stu-id="6dea8-226">**Figure 10**: Bind the `ProductName` and `UnitPrice` Data Fields to the `Text` Properties of the TextBoxes</span></span>

<span data-ttu-id="6dea8-227">请注意，图10中的 "编辑数据绑定" 对话框*不*包含双向数据绑定复选框，在 GridView 或 DetailsView 中编辑 TemplateField 时，或在 FormView 中模板。</span><span class="sxs-lookup"><span data-stu-id="6dea8-227">Notice how the Edit DataBindings dialog box in Figure 10 does *not* include the Two-way databinding checkbox that is present when editing a TemplateField in the GridView or DetailsView, or a template in the FormView.</span></span> <span data-ttu-id="6dea8-228">双向数据绑定功能允许在插入或更新数据时将输入 Web 控件中输入的值自动分配给相应的 ObjectDataSource s `InsertParameters` 或 `UpdateParameters`。</span><span class="sxs-lookup"><span data-stu-id="6dea8-228">The two-way databinding feature allowed the value entered into the input Web control to be automatically assigned to the corresponding ObjectDataSource s `InsertParameters` or `UpdateParameters` when inserting or updating data.</span></span> <span data-ttu-id="6dea8-229">DataList 不支持双向数据绑定，因为我们稍后将在本教程中看到，在用户进行更改并准备好更新数据后，我们需要以编程方式访问这些文本框 `Text` 属性，并将其值传入 `ProductsBLL` 类中相应的 `UpdateProduct` 方法。</span><span class="sxs-lookup"><span data-stu-id="6dea8-229">The DataList does not support two-way databinding as we'll see later on in this tutorial, after the user makes her changes and is ready to update the data, we will need to programmatically access these TextBoxes `Text` properties and pass in their values to the appropriate `UpdateProduct` method in the `ProductsBLL` class.</span></span>

<span data-ttu-id="6dea8-230">最后，需要向 `EditItemTemplate`中添加 "更新" 和 "取消" 按钮。</span><span class="sxs-lookup"><span data-stu-id="6dea8-230">Finally, we need to add Update and Cancel buttons to the `EditItemTemplate`.</span></span> <span data-ttu-id="6dea8-231">正如我们[使用带有详细信息 DataList 教程的主记录的项目符号列表在主/详细信息](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md)中看到的那样，在中继器或 datalist 内单击其 `CommandName` 属性的按钮、LinkButton 或 ImageButton 时，将引发 Repeater 或 datalist s `ItemCommand` 事件。</span><span class="sxs-lookup"><span data-stu-id="6dea8-231">As we saw in the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) tutorial, when a Button, LinkButton, or ImageButton whose `CommandName` property is set is clicked from within a Repeater or DataList, the Repeater or DataList s `ItemCommand` event is raised.</span></span> <span data-ttu-id="6dea8-232">对于 DataList，如果 `CommandName` 属性设置为某个值，则还可能会引发附加事件。</span><span class="sxs-lookup"><span data-stu-id="6dea8-232">For the DataList, if the `CommandName` property is set to a certain value, an additional event may be raised as well.</span></span> <span data-ttu-id="6dea8-233">特殊 `CommandName` 属性值包括：</span><span class="sxs-lookup"><span data-stu-id="6dea8-233">The special `CommandName` property values include, among others:</span></span>

- <span data-ttu-id="6dea8-234">Cancel 引发 `CancelCommand` 事件</span><span class="sxs-lookup"><span data-stu-id="6dea8-234">Cancel raises the `CancelCommand` event</span></span>
- <span data-ttu-id="6dea8-235">编辑引发 `EditCommand` 事件</span><span class="sxs-lookup"><span data-stu-id="6dea8-235">Edit raises the `EditCommand` event</span></span>
- <span data-ttu-id="6dea8-236">Update 引发 `UpdateCommand` 事件</span><span class="sxs-lookup"><span data-stu-id="6dea8-236">Update raises the `UpdateCommand` event</span></span>

<span data-ttu-id="6dea8-237">请记住，除了 `ItemCommand` 事件外，*还*会引发这些事件。</span><span class="sxs-lookup"><span data-stu-id="6dea8-237">Keep in mind that these events are raised *in addition to* the `ItemCommand` event.</span></span>

<span data-ttu-id="6dea8-238">添加到 `EditItemTemplate` 两个按钮 Web 控件，其中一个 `CommandName` 设置为 "更新"，另一个设置为 "取消"。</span><span class="sxs-lookup"><span data-stu-id="6dea8-238">Add to the `EditItemTemplate` two Button Web controls, one whose `CommandName` is set to Update and the other s set to Cancel.</span></span> <span data-ttu-id="6dea8-239">添加这两个按钮 Web 控件后，设计器应如下所示：</span><span class="sxs-lookup"><span data-stu-id="6dea8-239">After adding these two Button Web controls the Designer should look similar to the following:</span></span>

<span data-ttu-id="6dea8-240">[![向 EditItemTemplate 添加 "更新" 和 "取消" 按钮](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image26.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="6dea8-240">[![Add Update and Cancel Buttons to the EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image26.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image25.png)</span></span>

<span data-ttu-id="6dea8-241">**图 11**：向 `EditItemTemplate` 添加 "更新" 和 "取消" 按钮（[单击以查看完全大小的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image27.png)）</span><span class="sxs-lookup"><span data-stu-id="6dea8-241">**Figure 11**: Add Update and Cancel Buttons to the `EditItemTemplate` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image27.png))</span></span>

<span data-ttu-id="6dea8-242">`EditItemTemplate` 完成后，DataList 的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="6dea8-242">With the `EditItemTemplate` complete your DataList s declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample3.aspx)]

## <a name="step-5-adding-the-plumbing-to-enter-edit-mode"></a><span data-ttu-id="6dea8-243">步骤5：添加用于进入编辑模式的管道</span><span class="sxs-lookup"><span data-stu-id="6dea8-243">Step 5: Adding the Plumbing to Enter Edit Mode</span></span>

<span data-ttu-id="6dea8-244">此时，DataList 有一个通过其 `EditItemTemplate`定义的编辑界面;但是，目前没有办法让用户访问我们的页面，以指示他要编辑产品的信息。</span><span class="sxs-lookup"><span data-stu-id="6dea8-244">At this point our DataList has an editing interface defined via its `EditItemTemplate`; however, there s currently no way for a user visiting our page to indicate that he wants to edit a product s information.</span></span> <span data-ttu-id="6dea8-245">我们需要向每个产品添加一个 "编辑" 按钮，在单击该按钮时，将在编辑模式下呈现该 DataList 项。</span><span class="sxs-lookup"><span data-stu-id="6dea8-245">We need to add an Edit button to each product that, when clicked, renders that DataList item in edit mode.</span></span> <span data-ttu-id="6dea8-246">首先，通过设计器或以声明方式向 `ItemTemplate`添加 "编辑" 按钮。</span><span class="sxs-lookup"><span data-stu-id="6dea8-246">Start by adding an Edit button to the `ItemTemplate`, either through the Designer or declaratively.</span></span> <span data-ttu-id="6dea8-247">请确保将 "编辑" 按钮 `CommandName` 属性设置为 "编辑"。</span><span class="sxs-lookup"><span data-stu-id="6dea8-247">Be certain to set the Edit button s `CommandName` property to Edit .</span></span>

<span data-ttu-id="6dea8-248">添加此编辑按钮后，请花点时间查看浏览器中的页面。</span><span class="sxs-lookup"><span data-stu-id="6dea8-248">After you have added this Edit button, take a moment to view the page through a browser.</span></span> <span data-ttu-id="6dea8-249">添加此项后，每个产品列表都应包含 "编辑" 按钮。</span><span class="sxs-lookup"><span data-stu-id="6dea8-249">With this addition, each product listing should include an Edit button.</span></span>

<span data-ttu-id="6dea8-250">[![向 EditItemTemplate 添加 "更新" 和 "取消" 按钮](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image29.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="6dea8-250">[![Add Update and Cancel Buttons to the EditItemTemplate](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image29.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image28.png)</span></span>

<span data-ttu-id="6dea8-251">**图 12**：向 `EditItemTemplate` 添加 "更新" 和 "取消" 按钮（[单击以查看完全大小的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image30.png)）</span><span class="sxs-lookup"><span data-stu-id="6dea8-251">**Figure 12**: Add Update and Cancel Buttons to the `EditItemTemplate` ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image30.png))</span></span>

<span data-ttu-id="6dea8-252">单击该按钮将导致回发，但*不会将产品列表置于编辑*模式。</span><span class="sxs-lookup"><span data-stu-id="6dea8-252">Clicking the button causes a postback, but does *not* bring the product listing into edit mode.</span></span> <span data-ttu-id="6dea8-253">要使产品可编辑，我们需要：</span><span class="sxs-lookup"><span data-stu-id="6dea8-253">To make the product editable, we need to:</span></span>

1. <span data-ttu-id="6dea8-254">将 DataList s [`EditItemIndex` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx)设置为刚单击 "编辑" 按钮的 `DataListItem` 的索引。</span><span class="sxs-lookup"><span data-stu-id="6dea8-254">Set the DataList s [`EditItemIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx) to the index of the `DataListItem` whose Edit button was just clicked.</span></span>
2. <span data-ttu-id="6dea8-255">将数据重新绑定到 DataList。</span><span class="sxs-lookup"><span data-stu-id="6dea8-255">Rebind the data to the DataList.</span></span> <span data-ttu-id="6dea8-256">重新呈现 DataList 后，其 `ItemIndex` 对应于 DataList s `EditItemIndex` 的 `DataListItem` 将使用其 `EditItemTemplate`进行呈现。</span><span class="sxs-lookup"><span data-stu-id="6dea8-256">When the DataList is re-rendered, the `DataListItem` whose `ItemIndex` corresponds with the DataList s `EditItemIndex` will render using its `EditItemTemplate`.</span></span>

<span data-ttu-id="6dea8-257">由于在单击 "编辑" 按钮时将激发 DataList `EditCommand` 事件，请使用以下代码创建 `EditCommand` 事件处理程序：</span><span class="sxs-lookup"><span data-stu-id="6dea8-257">Since the DataList s `EditCommand` event is fired when the Edit button is clicked, create an `EditCommand` event handler with the following code:</span></span>

[!code-csharp[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample4.cs)]

<span data-ttu-id="6dea8-258">`EditCommand` 事件处理程序在类型 `DataListCommandEventArgs` 的对象中传递为它的第二个输入参数，其中包括对其编辑按钮被单击（`e.Item`）的 `DataListItem` 的引用。</span><span class="sxs-lookup"><span data-stu-id="6dea8-258">The `EditCommand` event handler is passed in an object of type `DataListCommandEventArgs` as its second input parameter, which includes a reference to the `DataListItem` whose Edit button was clicked (`e.Item`).</span></span> <span data-ttu-id="6dea8-259">此事件处理程序首先将 DataList `EditItemIndex` 设置为可编辑 `DataListItem` 的 `ItemIndex`，然后通过调用 DataList s `DataBind()` 方法将数据重新绑定到 DataList。</span><span class="sxs-lookup"><span data-stu-id="6dea8-259">The event handler first sets the DataList s `EditItemIndex` to the `ItemIndex` of the editable `DataListItem` and then rebinds the data to the DataList by calling the DataList s `DataBind()` method.</span></span>

<span data-ttu-id="6dea8-260">添加此事件处理程序后，请在浏览器中重新访问此页。</span><span class="sxs-lookup"><span data-stu-id="6dea8-260">After adding this event handler, revisit the page in a browser.</span></span> <span data-ttu-id="6dea8-261">单击 "编辑" 按钮会使单击的产品可编辑（参见图13）。</span><span class="sxs-lookup"><span data-stu-id="6dea8-261">Clicking the Edit button now makes the clicked product editable (see Figure 13).</span></span>

<span data-ttu-id="6dea8-262">[单击 "编辑" 按钮 ![使产品可编辑](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image32.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="6dea8-262">[![Clicking the Edit Button Makes the Product Editable](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image32.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image31.png)</span></span>

<span data-ttu-id="6dea8-263">**图 13**：单击 "编辑" 按钮使产品可编辑（[单击以查看完全尺寸的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image33.png)）</span><span class="sxs-lookup"><span data-stu-id="6dea8-263">**Figure 13**: Clicking the Edit Button Makes the Product Editable ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image33.png))</span></span>

## <a name="step-6-saving-the-user-s-changes"></a><span data-ttu-id="6dea8-264">步骤6：保存用户的更改</span><span class="sxs-lookup"><span data-stu-id="6dea8-264">Step 6: Saving the User s Changes</span></span>

<span data-ttu-id="6dea8-265">此时单击 "已编辑的产品更新" 或 "取消" 按钮将不执行任何操作;若要添加此功能，需要为 DataList s `UpdateCommand` 和 `CancelCommand` 事件创建事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="6dea8-265">Clicking the edited product s Update or Cancel buttons does nothing at this point; to add this functionality we need to create event handlers for the DataList s `UpdateCommand` and `CancelCommand` events.</span></span> <span data-ttu-id="6dea8-266">首先创建 `CancelCommand` 事件处理程序，该处理程序在单击 "已编辑的产品" "取消" 按钮时执行，并将 DataList 返回到其预编辑状态。</span><span class="sxs-lookup"><span data-stu-id="6dea8-266">Start by creating the `CancelCommand` event handler, which will execute when the edited product s Cancel button is clicked and it tasked with returning the DataList to its pre-editing state.</span></span>

<span data-ttu-id="6dea8-267">若要使 DataList 在只读模式下呈现其所有项，需执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="6dea8-267">To have the DataList render all of its items in the read-only mode, we need to:</span></span>

1. <span data-ttu-id="6dea8-268">将 DataList s [`EditItemIndex` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx)设置为不存在的 `DataListItem` 索引的索引。</span><span class="sxs-lookup"><span data-stu-id="6dea8-268">Set the DataList s [`EditItemIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx) to the index of a non-existent `DataListItem` index.</span></span> <span data-ttu-id="6dea8-269">`-1` 是一种安全选择，因为 `DataListItem` 索引从 `0`开始。</span><span class="sxs-lookup"><span data-stu-id="6dea8-269">`-1` is a safe choice, since the `DataListItem` indexes start at `0`.</span></span>
2. <span data-ttu-id="6dea8-270">将数据重新绑定到 DataList。</span><span class="sxs-lookup"><span data-stu-id="6dea8-270">Rebind the data to the DataList.</span></span> <span data-ttu-id="6dea8-271">由于 `DataListItem` `ItemIndex` es 都不对应于 DataList `EditItemIndex`，因此整个 DataList 将以只读模式呈现。</span><span class="sxs-lookup"><span data-stu-id="6dea8-271">Since no `DataListItem` `ItemIndex` es correspond to the DataList s `EditItemIndex`, the entire DataList will be rendered in a read-only mode.</span></span>

<span data-ttu-id="6dea8-272">可以通过以下事件处理程序代码来完成这些步骤：</span><span class="sxs-lookup"><span data-stu-id="6dea8-272">These steps can be accomplished with the following event handler code:</span></span>

[!code-csharp[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample5.cs)]

<span data-ttu-id="6dea8-273">添加此项后，单击 "取消" 按钮会将 DataList 返回到其预编辑状态。</span><span class="sxs-lookup"><span data-stu-id="6dea8-273">With this addition, clicking the Cancel button returns the DataList to its pre-editing state.</span></span>

<span data-ttu-id="6dea8-274">需要完成的最后一个事件处理程序是 `UpdateCommand` 事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="6dea8-274">The last event handler we need to complete is the `UpdateCommand` event handler.</span></span> <span data-ttu-id="6dea8-275">此事件处理程序需要：</span><span class="sxs-lookup"><span data-stu-id="6dea8-275">This event handler needs to:</span></span>

1. <span data-ttu-id="6dea8-276">以编程方式访问用户输入的产品名称、价格以及已编辑的产品 `ProductID`。</span><span class="sxs-lookup"><span data-stu-id="6dea8-276">Programmatically access the user-entered product name and price as well as the edited product s `ProductID`.</span></span>
2. <span data-ttu-id="6dea8-277">通过在 `ProductsBLL` 类中调用相应的 `UpdateProduct` 重载来启动更新过程。</span><span class="sxs-lookup"><span data-stu-id="6dea8-277">Initiate the update process by calling the appropriate `UpdateProduct` overload in the `ProductsBLL` class.</span></span>
3. <span data-ttu-id="6dea8-278">将 DataList s [`EditItemIndex` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx)设置为不存在的 `DataListItem` 索引的索引。</span><span class="sxs-lookup"><span data-stu-id="6dea8-278">Set the DataList s [`EditItemIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.edititemindex.aspx) to the index of a non-existent `DataListItem` index.</span></span> <span data-ttu-id="6dea8-279">`-1` 是一种安全选择，因为 `DataListItem` 索引从 `0`开始。</span><span class="sxs-lookup"><span data-stu-id="6dea8-279">`-1` is a safe choice, since the `DataListItem` indexes start at `0`.</span></span>
4. <span data-ttu-id="6dea8-280">将数据重新绑定到 DataList。</span><span class="sxs-lookup"><span data-stu-id="6dea8-280">Rebind the data to the DataList.</span></span> <span data-ttu-id="6dea8-281">由于 `DataListItem` `ItemIndex` es 都不对应于 DataList `EditItemIndex`，因此整个 DataList 将以只读模式呈现。</span><span class="sxs-lookup"><span data-stu-id="6dea8-281">Since no `DataListItem` `ItemIndex` es correspond to the DataList s `EditItemIndex`, the entire DataList will be rendered in a read-only mode.</span></span>

<span data-ttu-id="6dea8-282">步骤1和步骤2负责保存用户的更改;在保存更改后，步骤3和4将 DataList 返回到其预编辑状态，并且与 `CancelCommand` 事件处理程序中执行的步骤相同。</span><span class="sxs-lookup"><span data-stu-id="6dea8-282">Steps 1 and 2 are responsible for saving the user s changes; steps 3 and 4 return the DataList to its pre-editing state after the changes have been saved and are identical to the steps performed in the `CancelCommand` event handler.</span></span>

<span data-ttu-id="6dea8-283">若要获取更新后的产品名称和价格，需要使用 `FindControl` 方法以编程方式引用 `EditItemTemplate`中的 TextBox Web 控件。</span><span class="sxs-lookup"><span data-stu-id="6dea8-283">To get the updated product name and price, we need to use the `FindControl` method to programmatically reference the TextBox Web controls within the `EditItemTemplate`.</span></span> <span data-ttu-id="6dea8-284">我们还需要获取已编辑的产品 `ProductID` 值。</span><span class="sxs-lookup"><span data-stu-id="6dea8-284">We also need to get the edited product s `ProductID` value.</span></span> <span data-ttu-id="6dea8-285">最初将 ObjectDataSource 绑定到 DataList 时，Visual Studio 将 DataList s `DataKeyField` 属性分配给数据源（`ProductID`）中的主键值。</span><span class="sxs-lookup"><span data-stu-id="6dea8-285">When we initially bound the ObjectDataSource to the DataList, Visual Studio assigned the DataList s `DataKeyField` property to the primary key value from the data source (`ProductID`).</span></span> <span data-ttu-id="6dea8-286">然后，可以从 DataList s `DataKeys` 集合中检索此值。</span><span class="sxs-lookup"><span data-stu-id="6dea8-286">This value can then be retrieved from the DataList s `DataKeys` collection.</span></span> <span data-ttu-id="6dea8-287">请花点时间确保 `DataKeyField` 属性确实设置为 `ProductID`。</span><span class="sxs-lookup"><span data-stu-id="6dea8-287">Take a moment to ensure that the `DataKeyField` property is indeed set to `ProductID`.</span></span>

<span data-ttu-id="6dea8-288">下面的代码实现了以下四个步骤：</span><span class="sxs-lookup"><span data-stu-id="6dea8-288">The following code implements the four steps:</span></span>

[!code-csharp[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample6.cs)]

<span data-ttu-id="6dea8-289">此事件处理程序首先从 `DataKeys` 集合的已编辑的产品 `ProductID` 中进行读取。</span><span class="sxs-lookup"><span data-stu-id="6dea8-289">The event handler starts by reading in the edited product s `ProductID` from the `DataKeys` collection.</span></span> <span data-ttu-id="6dea8-290">接下来，引用 `EditItemTemplate` 中的两个文本框，并将其 `Text` 属性存储在本地变量中，`productNameValue` 和 `unitPriceValue`。</span><span class="sxs-lookup"><span data-stu-id="6dea8-290">Next, the two TextBoxes in the `EditItemTemplate` are referenced and their `Text` properties stored in local variables, `productNameValue` and `unitPriceValue`.</span></span> <span data-ttu-id="6dea8-291">我们使用 `Decimal.Parse()` 方法从 "`UnitPrice`" 文本框中读取值，以便如果输入的值具有货币符号，则仍可将其正确转换为 `Decimal` 值。</span><span class="sxs-lookup"><span data-stu-id="6dea8-291">We use the `Decimal.Parse()` method to read the value from the `UnitPrice` TextBox so that if the value entered has a currency symbol, it can still be correctly converted into a `Decimal` value.</span></span>

> [!NOTE]
> <span data-ttu-id="6dea8-292">如果文本框文本属性指定了值，则仅将 `ProductName` 和 `UnitPrice` 文本框中的值分配给 productNameValue 和 unitPriceValue 变量。</span><span class="sxs-lookup"><span data-stu-id="6dea8-292">The values from the `ProductName` and `UnitPrice` TextBoxes are only assigned to the productNameValue and unitPriceValue variables if the TextBoxes Text properties have a value specified.</span></span> <span data-ttu-id="6dea8-293">否则，将 `Nothing` 的值用于变量，这就是使用数据库 `NULL` 值更新数据的效果。</span><span class="sxs-lookup"><span data-stu-id="6dea8-293">Otherwise, a value of `Nothing` is used for the variables, which has the effect of updating the data with a database `NULL` value.</span></span> <span data-ttu-id="6dea8-294">也就是说，我们的代码处理将空字符串转换为数据库 `NULL` 值，这是 GridView、DetailsView 和 FormView 控件中编辑界面的默认行为。</span><span class="sxs-lookup"><span data-stu-id="6dea8-294">That is, our code treats converts empty strings to database `NULL` values, which is the default behavior of the editing interface in the GridView, DetailsView, and FormView controls.</span></span>

<span data-ttu-id="6dea8-295">读取值后，将调用 `ProductsBLL` 类 s `UpdateProduct` 方法，并传入产品的名称、价格和 `ProductID`。</span><span class="sxs-lookup"><span data-stu-id="6dea8-295">After reading the values, the `ProductsBLL` class s `UpdateProduct` method is called, passing in the product s name, price, and `ProductID`.</span></span> <span data-ttu-id="6dea8-296">事件处理程序完成，方法是使用与 `CancelCommand` 事件处理程序中的完全相同的逻辑将 DataList 返回到其预编辑状态。</span><span class="sxs-lookup"><span data-stu-id="6dea8-296">The event handler completes by returning the DataList to its pre-editing state using the exact same logic as in the `CancelCommand` event handler.</span></span>

<span data-ttu-id="6dea8-297">完成 `EditCommand`、`CancelCommand`和 `UpdateCommand` 事件处理程序后，访问者可以编辑产品的名称和价格。</span><span class="sxs-lookup"><span data-stu-id="6dea8-297">With the `EditCommand`, `CancelCommand`, and `UpdateCommand` event handlers complete, a visitor can edit the name and price of a product.</span></span> <span data-ttu-id="6dea8-298">图14-16 显示此编辑工作流的运行情况。</span><span class="sxs-lookup"><span data-stu-id="6dea8-298">Figures 14-16 show this editing workflow in action.</span></span>

<span data-ttu-id="6dea8-299">[![首次访问页面时，所有产品都处于只读模式](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image35.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="6dea8-299">[![When First Visiting the Page, All Products are in Read-Only Mode](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image35.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image34.png)</span></span>

<span data-ttu-id="6dea8-300">**图 14**：首次访问页面时，所有产品都处于只读模式（[单击以查看完全大小的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image36.png)）</span><span class="sxs-lookup"><span data-stu-id="6dea8-300">**Figure 14**: When First Visiting the Page, All Products are in Read-Only Mode ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image36.png))</span></span>

<span data-ttu-id="6dea8-301">[![更新产品的名称或价格，请单击 "编辑" 按钮](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image38.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="6dea8-301">[![To Update a Product s Name or Price, Click the Edit Button](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image38.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image37.png)</span></span>

<span data-ttu-id="6dea8-302">**图 15**：若要更新产品的名称或价格，请单击 "编辑" 按钮（[单击以查看完全大小的图像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image39.png)）</span><span class="sxs-lookup"><span data-stu-id="6dea8-302">**Figure 15**: To Update a Product s Name or Price, Click the Edit Button ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image39.png))</span></span>

<span data-ttu-id="6dea8-303">[更改值后 ![，单击 "更新" 以返回到只读模式](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image41.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="6dea8-303">[![After Changing the Value, Click Update to Return to the Read-Only Mode](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image41.png)](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image40.png)</span></span>

<span data-ttu-id="6dea8-304">**图 16**：更改值后，单击 "更新" 以返回到只读模式（[单击以查看完全大小的映像](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image42.png)）</span><span class="sxs-lookup"><span data-stu-id="6dea8-304">**Figure 16**: After Changing the Value, Click Update to Return to the Read-Only Mode ([Click to view full-size image](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/_static/image42.png))</span></span>

## <a name="step-7-adding-delete-capabilities"></a><span data-ttu-id="6dea8-305">步骤7：添加删除功能</span><span class="sxs-lookup"><span data-stu-id="6dea8-305">Step 7: Adding Delete Capabilities</span></span>

<span data-ttu-id="6dea8-306">将删除功能添加到 DataList 的步骤类似于用于添加编辑功能的步骤。</span><span class="sxs-lookup"><span data-stu-id="6dea8-306">The steps for adding delete capabilities to a DataList are similar to those for adding editing capabilities.</span></span> <span data-ttu-id="6dea8-307">简而言之，在单击时，需要向 `ItemTemplate` 添加 "删除" 按钮：</span><span class="sxs-lookup"><span data-stu-id="6dea8-307">In short, we need to add a Delete button to the `ItemTemplate` that, when clicked:</span></span>

1. <span data-ttu-id="6dea8-308">通过 `DataKeys` 集合读取相应的产品 `ProductID`。</span><span class="sxs-lookup"><span data-stu-id="6dea8-308">Reads in the corresponding product s `ProductID` via the `DataKeys` collection.</span></span>
2. <span data-ttu-id="6dea8-309">通过调用 `ProductsBLL` 类 s `DeleteProduct` 方法执行删除。</span><span class="sxs-lookup"><span data-stu-id="6dea8-309">Performs the delete by calling the `ProductsBLL` class s `DeleteProduct` method.</span></span>
3. <span data-ttu-id="6dea8-310">将数据重新绑定到 DataList。</span><span class="sxs-lookup"><span data-stu-id="6dea8-310">Rebinds the data to the DataList.</span></span>

<span data-ttu-id="6dea8-311">首先，让我们将 "删除" 按钮添加到 `ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="6dea8-311">Let s start by adding a Delete button to the `ItemTemplate`.</span></span>

<span data-ttu-id="6dea8-312">单击此按钮时，其 `CommandName` 为 "编辑"、"更新" 或 "取消" 的按钮会引发 DataList s `ItemCommand` 事件，同时还会引发附加事件（例如，在使用 "编辑" 时，将引发 `EditCommand` 事件）。</span><span class="sxs-lookup"><span data-stu-id="6dea8-312">When clicked, a Button whose `CommandName` is Edit, Update, or Cancel raises the DataList s `ItemCommand` event along with an additional event (for example, when using Edit the `EditCommand` event is raised as well).</span></span> <span data-ttu-id="6dea8-313">同样，DataList 中其 `CommandName` 属性设置为 "删除" 的任何按钮、LinkButton 或 ImageButton 都将引发 `DeleteCommand` 事件（连同 `ItemCommand`）。</span><span class="sxs-lookup"><span data-stu-id="6dea8-313">Similarly, any Button, LinkButton, or ImageButton in the DataList whose `CommandName` property is set to Delete causes the `DeleteCommand` event to fire (along with `ItemCommand`).</span></span>

<span data-ttu-id="6dea8-314">在 `ItemTemplate`中的 "编辑" 按钮旁边添加 "删除" 按钮，并将其 `CommandName` 属性设置为 "删除"。</span><span class="sxs-lookup"><span data-stu-id="6dea8-314">Add a Delete button next to the Edit button in the `ItemTemplate`, setting its `CommandName` property to Delete.</span></span> <span data-ttu-id="6dea8-315">添加此按钮后，DataList 的 `ItemTemplate` 声明性语法应该如下所示：</span><span class="sxs-lookup"><span data-stu-id="6dea8-315">After adding this Button control your DataList s `ItemTemplate` declarative syntax should look like:</span></span>

[!code-aspx[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample7.aspx)]

<span data-ttu-id="6dea8-316">接下来，使用以下代码为 DataList s `DeleteCommand` 事件创建事件处理程序：</span><span class="sxs-lookup"><span data-stu-id="6dea8-316">Next, create an event handler for the DataList s `DeleteCommand` event, using the following code:</span></span>

[!code-csharp[Main](an-overview-of-editing-and-deleting-data-in-the-datalist-cs/samples/sample8.cs)]

<span data-ttu-id="6dea8-317">单击 "删除" 按钮会导致回发，并激发 DataList `DeleteCommand` 事件。</span><span class="sxs-lookup"><span data-stu-id="6dea8-317">Clicking the Delete button causes a postback and fires the DataList s `DeleteCommand` event.</span></span> <span data-ttu-id="6dea8-318">在事件处理程序中，从 `DataKeys` 集合访问已单击的产品 `ProductID` 值。</span><span class="sxs-lookup"><span data-stu-id="6dea8-318">In the event handler, the clicked product s `ProductID` value is accessed from the `DataKeys` collection.</span></span> <span data-ttu-id="6dea8-319">接下来，通过调用 `ProductsBLL` 类 `DeleteProduct` 方法删除该产品。</span><span class="sxs-lookup"><span data-stu-id="6dea8-319">Next, the product is deleted by calling the `ProductsBLL` class s `DeleteProduct` method.</span></span>

<span data-ttu-id="6dea8-320">删除产品后，将数据重新绑定到 DataList （`DataList1.DataBind()`）非常重要，否则 DataList 将继续显示刚刚删除的产品。</span><span class="sxs-lookup"><span data-stu-id="6dea8-320">After deleting the product, it s important that we rebind the data to the DataList (`DataList1.DataBind()`), otherwise the DataList will continue to show the product that was just deleted.</span></span>

## <a name="summary"></a><span data-ttu-id="6dea8-321">总结</span><span class="sxs-lookup"><span data-stu-id="6dea8-321">Summary</span></span>

<span data-ttu-id="6dea8-322">尽管 DataList 缺少点并单击编辑和删除 GridView 所能提供的支持，但有一小段代码可以对其进行增强，以包含这些功能。</span><span class="sxs-lookup"><span data-stu-id="6dea8-322">While the DataList lacks the point and click editing and deleting support enjoyed by the GridView, with a short bit of code it can be enhanced to include these features.</span></span> <span data-ttu-id="6dea8-323">在本教程中，我们介绍了如何创建一个两列的列表，其中列出了可删除的产品以及名称和价格。</span><span class="sxs-lookup"><span data-stu-id="6dea8-323">In this tutorial we saw how to create a two-column listing of products that could be deleted and whose name and price could be edited.</span></span> <span data-ttu-id="6dea8-324">添加编辑和删除支持是指在 `ItemTemplate` 和 `EditItemTemplate`中包含适当的 Web 控件，创建相应的事件处理程序，读取用户输入的值和主键值，并与业务逻辑层交互。</span><span class="sxs-lookup"><span data-stu-id="6dea8-324">Adding editing and deleting support is a matter of including the appropriate Web controls in the `ItemTemplate` and `EditItemTemplate`, creating the corresponding event handlers, reading the user-entered and primary key values, and interfacing with the Business Logic Layer.</span></span>

<span data-ttu-id="6dea8-325">虽然我们向 DataList 添加了基本的编辑和删除功能，但它没有更多的高级功能。</span><span class="sxs-lookup"><span data-stu-id="6dea8-325">While we have added basic editing and deleting capabilities to the DataList, it lacks more advanced features.</span></span> <span data-ttu-id="6dea8-326">例如，没有输入字段验证-如果用户输入的价格太大，则在尝试将太昂贵的资源转换为 `Decimal`时，`Decimal.Parse` 会引发异常。</span><span class="sxs-lookup"><span data-stu-id="6dea8-326">For example, there is no input field validation - if a user enters a price of Too expensive, an exception will be thrown by `Decimal.Parse` when attempting to convert Too expensive into a `Decimal`.</span></span> <span data-ttu-id="6dea8-327">同样，如果在业务逻辑或数据访问层上更新数据时出现问题，则会向用户显示标准错误屏幕。</span><span class="sxs-lookup"><span data-stu-id="6dea8-327">Similarly, if there is a problem in updating the data at the Business Logic or Data Access Layers the user will be presented with the standard error screen.</span></span> <span data-ttu-id="6dea8-328">如果在 "删除" 按钮上没有任何类型的确认，则意外删除产品会很有可能。</span><span class="sxs-lookup"><span data-stu-id="6dea8-328">Without any sort of confirmation on the Delete button, accidentally deleting a product is all too likely.</span></span>

<span data-ttu-id="6dea8-329">在将来的教程中，我们将了解如何改进编辑用户体验。</span><span class="sxs-lookup"><span data-stu-id="6dea8-329">In future tutorials we'll see how to improve the editing user experience.</span></span>

<span data-ttu-id="6dea8-330">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="6dea8-330">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="6dea8-331">关于作者</span><span class="sxs-lookup"><span data-stu-id="6dea8-331">About the Author</span></span>

<span data-ttu-id="6dea8-332">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，创始人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已在使用 Microsoft Web 技术，自1998开始。</span><span class="sxs-lookup"><span data-stu-id="6dea8-332">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="6dea8-333">Scott 的工作方式是独立的顾问、培训师和撰稿人。</span><span class="sxs-lookup"><span data-stu-id="6dea8-333">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="6dea8-334">他的最新书籍是，[*在24小时内，sam ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="6dea8-334">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="6dea8-335">可以[mitchell@4GuysFromRolla.com访问。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="6dea8-335">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="6dea8-336">或通过他的博客，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="6dea8-336">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="6dea8-337">特别感谢</span><span class="sxs-lookup"><span data-stu-id="6dea8-337">Special Thanks To</span></span>

<span data-ttu-id="6dea8-338">此教程系列由许多有用的审阅者查看。</span><span class="sxs-lookup"><span data-stu-id="6dea8-338">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="6dea8-339">本教程的潜在客户评审者是 Zack，Ken Pespisa 和 Randy Schmidt。</span><span class="sxs-lookup"><span data-stu-id="6dea8-339">Lead reviewers for this tutorial were Zack Jones, Ken Pespisa, and Randy Schmidt.</span></span> <span data-ttu-id="6dea8-340">想要查看我即将发布的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="6dea8-340">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="6dea8-341">如果是这样，请在mitchell@4GuysFromRolla.com放置一行[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="6dea8-341">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="6dea8-342">下一页</span><span class="sxs-lookup"><span data-stu-id="6dea8-342">Next</span></span>](performing-batch-updates-cs.md)
