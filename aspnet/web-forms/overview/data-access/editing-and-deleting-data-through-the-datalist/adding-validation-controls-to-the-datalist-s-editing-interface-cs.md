---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/adding-validation-controls-to-the-datalist-s-editing-interface-cs
title: 向 DataList 的编辑界面（C#）添加验证控件 |Microsoft Docs
author: rick-anderson
description: 在本教程中，我们将了解如何轻松地将验证控件添加到 DataList 的 EditItemTemplate 中，以便为用户提供更可靠的编辑用户 int 。
ms.author: riande
ms.date: 10/30/2006
ms.assetid: 3ecc21c5-da0e-40ab-abb4-fac1e47398ad
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/adding-validation-controls-to-the-datalist-s-editing-interface-cs
msc.type: authoredcontent
ms.openlocfilehash: e3c14b7098da832bd28f57026e81dcb7f7ba7130
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/06/2020
ms.locfileid: "78480854"
---
# <a name="adding-validation-controls-to-the-datalists-editing-interface-c"></a><span data-ttu-id="ed098-103">向 DataList 的编辑界面添加验证控件 (C#)</span><span class="sxs-lookup"><span data-stu-id="ed098-103">Adding Validation Controls to the DataList's Editing Interface (C#)</span></span>

<span data-ttu-id="ed098-104">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="ed098-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="ed098-105">[下载示例应用](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_39_CS.exe)或[下载 PDF](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/datatutorial39cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="ed098-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_39_CS.exe) or [Download PDF](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/datatutorial39cs1.pdf)</span></span>

> <span data-ttu-id="ed098-106">在本教程中，我们将了解如何轻松地将验证控件添加到 DataList 的 EditItemTemplate 中，以便提供更可靠的编辑用户界面。</span><span class="sxs-lookup"><span data-stu-id="ed098-106">In this tutorial we'll see how easy it is to add validation controls to the DataList's EditItemTemplate in order to provide a more foolproof editing user interface.</span></span>

## <a name="introduction"></a><span data-ttu-id="ed098-107">简介</span><span class="sxs-lookup"><span data-stu-id="ed098-107">Introduction</span></span>

<span data-ttu-id="ed098-108">在迄今为止的 DataList 编辑教程中，DataLists 编辑界面未包含任何主动用户输入验证，即使无效的用户输入（如缺少产品名称或负价格），也不会导致异常。</span><span class="sxs-lookup"><span data-stu-id="ed098-108">In the DataList editing tutorials thus far, the DataLists editing interfaces have not included any proactive user input validation even though invalid user input such as a missing product name or negative price results in an exception.</span></span> <span data-ttu-id="ed098-109">在[前面的教程](handling-bll-and-dal-level-exceptions-cs.md)中，我们介绍了如何将异常处理代码添加到 DataList s `UpdateCommand` 事件处理程序中，以便捕获并正确地显示有关引发的任何异常的信息。</span><span class="sxs-lookup"><span data-stu-id="ed098-109">In the [preceding tutorial](handling-bll-and-dal-level-exceptions-cs.md) we examined how to add exception handling code to the DataList s `UpdateCommand` event handler in order to catch and gracefully display information about any exceptions that were raised.</span></span> <span data-ttu-id="ed098-110">但理想情况下，编辑界面会包括验证控件，以防止用户首先输入这样的无效数据。</span><span class="sxs-lookup"><span data-stu-id="ed098-110">Ideally, however, the editing interface would include validation controls to prevent a user from entering such invalid data in the first place.</span></span>

<span data-ttu-id="ed098-111">在本教程中，我们将了解如何轻松地将验证控件添加到 DataList s `EditItemTemplate` 中，以便提供更可靠的编辑用户界面。</span><span class="sxs-lookup"><span data-stu-id="ed098-111">In this tutorial we'll see how easy it is to add validation controls to the DataList s `EditItemTemplate` in order to provide a more foolproof editing user interface.</span></span> <span data-ttu-id="ed098-112">具体而言，本教程采用前面教程中创建的示例，并补充编辑界面以包括适当的验证。</span><span class="sxs-lookup"><span data-stu-id="ed098-112">Specifically, this tutorial takes the example created in the preceding tutorial and augments the editing interface to include appropriate validation.</span></span>

## <a name="step-1-replicating-the-example-fromhandling-bll--and-dal-level-exceptions"></a><span data-ttu-id="ed098-113">步骤1：复制示例以[处理 BLL 和 DAL 级别的异常](handling-bll-and-dal-level-exceptions-cs.md)</span><span class="sxs-lookup"><span data-stu-id="ed098-113">Step 1: Replicating the Example from[Handling BLL- and DAL-Level Exceptions](handling-bll-and-dal-level-exceptions-cs.md)</span></span>

<span data-ttu-id="ed098-114">在[处理 BLL 和 DAL 级别的异常](handling-bll-and-dal-level-exceptions-cs.md)教程中，我们创建了一个页面，其中列出了两列的可编辑 DataList 中产品的名称和价格。</span><span class="sxs-lookup"><span data-stu-id="ed098-114">In the [Handling BLL- and DAL-Level Exceptions](handling-bll-and-dal-level-exceptions-cs.md) tutorial we created a page that listed the names and prices of the products in a two-column, editable DataList.</span></span> <span data-ttu-id="ed098-115">本教程的目标是增加 DataList 的编辑界面以包括验证控件。</span><span class="sxs-lookup"><span data-stu-id="ed098-115">Our goal for this tutorial is to augment the DataList s editing interface to include validation controls.</span></span> <span data-ttu-id="ed098-116">具体而言，我们的验证逻辑将：</span><span class="sxs-lookup"><span data-stu-id="ed098-116">In particular, our validation logic will:</span></span>

- <span data-ttu-id="ed098-117">要求提供产品名称</span><span class="sxs-lookup"><span data-stu-id="ed098-117">Require that the product s name be provided</span></span>
- <span data-ttu-id="ed098-118">确保为 "价格" 输入的值是有效的货币格式</span><span class="sxs-lookup"><span data-stu-id="ed098-118">Ensure that the value entered for the price is a valid currency format</span></span>
- <span data-ttu-id="ed098-119">确保为价格输入的值大于或等于零，因为负 `UnitPrice` 值是非法的</span><span class="sxs-lookup"><span data-stu-id="ed098-119">Ensure that the value entered for the price is greater than or equal to zero, since a negative `UnitPrice` value is illegal</span></span>

<span data-ttu-id="ed098-120">首先，我们需要将本教程的 "`ErrorHandling.aspx`" 页中的示例从 `EditDeleteDataList` 文件夹中的 "" 页复制到本教程的页面，`UIValidation.aspx`。</span><span class="sxs-lookup"><span data-stu-id="ed098-120">Before we can look at augmenting the previous example to include validation, we first need to replicate the example from the `ErrorHandling.aspx` page in the `EditDeleteDataList` folder to the page for this tutorial, `UIValidation.aspx`.</span></span> <span data-ttu-id="ed098-121">若要实现此目的，我们需要通过 `ErrorHandling.aspx` 页的声明性标记及其源代码进行复制。</span><span class="sxs-lookup"><span data-stu-id="ed098-121">To achieve this we need to copy over both the `ErrorHandling.aspx` page s declarative markup and its source code.</span></span> <span data-ttu-id="ed098-122">首先，通过执行以下步骤，通过声明性标记进行复制：</span><span class="sxs-lookup"><span data-stu-id="ed098-122">First copy over the declarative markup by performing the following steps:</span></span>

1. <span data-ttu-id="ed098-123">在 Visual Studio 中打开 `ErrorHandling.aspx` 页面</span><span class="sxs-lookup"><span data-stu-id="ed098-123">Open the `ErrorHandling.aspx` page in Visual Studio</span></span>
2. <span data-ttu-id="ed098-124">中转到页面声明性标记（单击页面底部的 "源" 按钮）</span><span class="sxs-lookup"><span data-stu-id="ed098-124">Go to the page s declarative markup (click on the Source button at the bottom of the page)</span></span>
3. <span data-ttu-id="ed098-125">复制 `<asp:Content>` 和 `</asp:Content>` 标记（第3行到第32行）中的文本，如图1所示。</span><span class="sxs-lookup"><span data-stu-id="ed098-125">Copy the text within the `<asp:Content>` and `</asp:Content>` tags (lines 3 through 32), as shown in Figure 1.</span></span>

<span data-ttu-id="ed098-126">[![复制 &lt;asp： Content&gt; 控件中的文本](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image2.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="ed098-126">[![Copy the Text Within the &lt;asp:Content&gt; Control](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image2.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image1.png)</span></span>

<span data-ttu-id="ed098-127">**图 1**：复制 `<asp:Content>` 控件中的文本（[单击查看完全尺寸的图像](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="ed098-127">**Figure 1**: Copy the Text Within the `<asp:Content>` Control ([Click to view full-size image](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image3.png))</span></span>

1. <span data-ttu-id="ed098-128">打开 `UIValidation.aspx` 页面</span><span class="sxs-lookup"><span data-stu-id="ed098-128">Open the `UIValidation.aspx` page</span></span>
2. <span data-ttu-id="ed098-129">中转到页面声明性标记</span><span class="sxs-lookup"><span data-stu-id="ed098-129">Go to the page s declarative markup</span></span>
3. <span data-ttu-id="ed098-130">将文本粘贴到 `<asp:Content>` 控件中。</span><span class="sxs-lookup"><span data-stu-id="ed098-130">Paste the text within the `<asp:Content>` control.</span></span>

<span data-ttu-id="ed098-131">若要复制源代码，请打开 `ErrorHandling.aspx.vb` 页面并只复制 `EditDeleteDataList_ErrorHandling` 类*中*的文本。</span><span class="sxs-lookup"><span data-stu-id="ed098-131">To copy over the source code, open the `ErrorHandling.aspx.vb` page and copy just the text *within* the `EditDeleteDataList_ErrorHandling` class.</span></span> <span data-ttu-id="ed098-132">将三个事件处理程序（`Products_EditCommand`、`Products_CancelCommand`和 `Products_UpdateCommand`）与 `DisplayExceptionDetails` 方法**一起复制，但不要复制类**声明或 `using` 语句。</span><span class="sxs-lookup"><span data-stu-id="ed098-132">Copy the three event handlers (`Products_EditCommand`, `Products_CancelCommand`, and `Products_UpdateCommand`) along with the `DisplayExceptionDetails` method, but do **not** copy the class declaration or `using` statements.</span></span> <span data-ttu-id="ed098-133">将复制*的文本粘贴到 `UIValidation.aspx.vb`* 中的 `EditDeleteDataList_UIValidation` 类中。</span><span class="sxs-lookup"><span data-stu-id="ed098-133">Paste the copied text *within* the `EditDeleteDataList_UIValidation` class in `UIValidation.aspx.vb`.</span></span>

<span data-ttu-id="ed098-134">将内容和代码移到 `ErrorHandling.aspx` 到 `UIValidation.aspx`后，请花点时间在浏览器中测试页面。</span><span class="sxs-lookup"><span data-stu-id="ed098-134">After moving over the content and code from `ErrorHandling.aspx` to `UIValidation.aspx`, take a moment to test out the pages in a browser.</span></span> <span data-ttu-id="ed098-135">在这两个页面中，你应看到相同的输出和体验相同的功能（请参阅图2）。</span><span class="sxs-lookup"><span data-stu-id="ed098-135">You should see the same output and experience the same functionality in each of these two pages (see Figure 2).</span></span>

<span data-ttu-id="ed098-136">[![UIValidation 页面模拟 ErrorHandling 中的功能](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image5.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="ed098-136">[![The UIValidation.aspx Page Mimics the Functionality in ErrorHandling.aspx](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image5.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image4.png)</span></span>

<span data-ttu-id="ed098-137">**图 2**： `UIValidation.aspx` 页模拟 `ErrorHandling.aspx` 中的功能（[单击查看完全大小的图像](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="ed098-137">**Figure 2**: The `UIValidation.aspx` Page Mimics the Functionality in `ErrorHandling.aspx` ([Click to view full-size image](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image6.png))</span></span>

## <a name="step-2-adding-the-validation-controls-to-the-datalist-s-edititemtemplate"></a><span data-ttu-id="ed098-138">步骤2：将验证控件添加到 DataList s EditItemTemplate</span><span class="sxs-lookup"><span data-stu-id="ed098-138">Step 2: Adding the Validation Controls to the DataList s EditItemTemplate</span></span>

<span data-ttu-id="ed098-139">构造数据输入窗体时，用户必须输入所有必填字段，并且其提供的所有输入都是合法的格式正确的值，这一点非常重要。</span><span class="sxs-lookup"><span data-stu-id="ed098-139">When constructing data entry forms, it is important that users enter any required fields and that all their provided inputs are legal, properly-formatted values.</span></span> <span data-ttu-id="ed098-140">为了帮助确保用户的输入有效，ASP.NET 提供了五个用于验证单个输入 Web 控件的值的内置验证控件：</span><span class="sxs-lookup"><span data-stu-id="ed098-140">To help ensure that a user s inputs are valid, ASP.NET provides five built-in validation controls that are designed to validate the value of a single input Web control:</span></span>

- <span data-ttu-id="ed098-141">[RequiredFieldValidator](https://msdn.microsoft.com/library/5hbw267h(VS.80).aspx)确保已提供值</span><span class="sxs-lookup"><span data-stu-id="ed098-141">[RequiredFieldValidator](https://msdn.microsoft.com/library/5hbw267h(VS.80).aspx) ensures that a value has been provided</span></span>
- <span data-ttu-id="ed098-142">[CompareValidator](https://msdn.microsoft.com/library/db330ayw(VS.80).aspx)根据另一个 Web 控件值或常数值验证值，或确保值 s 格式对于指定的数据类型是合法的</span><span class="sxs-lookup"><span data-stu-id="ed098-142">[CompareValidator](https://msdn.microsoft.com/library/db330ayw(VS.80).aspx) validates a value against another Web control value or a constant value, or ensures that the value s format is legal for a specified data type</span></span>
- <span data-ttu-id="ed098-143">[RangeValidator](https://msdn.microsoft.com/library/f70d09xt.aspx)可确保值在值范围内</span><span class="sxs-lookup"><span data-stu-id="ed098-143">[RangeValidator](https://msdn.microsoft.com/library/f70d09xt.aspx) ensures that a value is within a range of values</span></span>
- <span data-ttu-id="ed098-144">[RegularExpressionValidator](https://msdn.microsoft.com/library/eahwtc9e.aspx)根据[正则表达式](http://en.wikipedia.org/wiki/Regular_expression)验证值</span><span class="sxs-lookup"><span data-stu-id="ed098-144">[RegularExpressionValidator](https://msdn.microsoft.com/library/eahwtc9e.aspx) validates a value against a [regular expression](http://en.wikipedia.org/wiki/Regular_expression)</span></span>
- <span data-ttu-id="ed098-145">[CustomValidator](https://msdn.microsoft.com/library/9eee01cx(VS.80).aspx)根据自定义的用户定义方法验证值</span><span class="sxs-lookup"><span data-stu-id="ed098-145">[CustomValidator](https://msdn.microsoft.com/library/9eee01cx(VS.80).aspx) validates a value against a custom, user-defined method</span></span>

<span data-ttu-id="ed098-146">有关这五个控件的详细信息，请参阅将[验证控件添加到编辑和插入接口](../editing-inserting-and-deleting-data/adding-validation-controls-to-the-editing-and-inserting-interfaces-cs.md)教程或查看[ASP.NET 快速入门教程](https://quickstarts.asp.net)中的 "[验证控件" 部分](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/validation/default.aspx)。</span><span class="sxs-lookup"><span data-stu-id="ed098-146">For more information on these five controls refer back to the [Adding Validation Controls to the Editing and Inserting Interfaces](../editing-inserting-and-deleting-data/adding-validation-controls-to-the-editing-and-inserting-interfaces-cs.md) tutorial or check out the [Validation Controls section](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/validation/default.aspx) of the [ASP.NET Quickstart Tutorials](https://quickstarts.asp.net).</span></span>

<span data-ttu-id="ed098-147">在本教程中，我们将需要使用 RequiredFieldValidator 来确保已提供产品名称的值，并使用 CompareValidator 确保输入的价格的值大于或等于0，并且以有效的货币格式显示。</span><span class="sxs-lookup"><span data-stu-id="ed098-147">For our tutorial we'll need to use a RequiredFieldValidator to ensure that a value for the product name has been supplied and a CompareValidator to ensure that the entered price has a value greater than or equal to 0 and is presented in a valid currency format.</span></span>

> [!NOTE]
> <span data-ttu-id="ed098-148">尽管 ASP.NET 1.x 具有这些相同的五个验证控件，但 ASP.NET 2.0 已增加了许多改进，主要两个是浏览器的客户端脚本支持，除了 Internet Explorer 外，还可以将页上的验证控件分区为验证组。</span><span class="sxs-lookup"><span data-stu-id="ed098-148">While ASP.NET 1.x had these same five validation controls, ASP.NET 2.0 has added a number of improvements, the main two being client-side script support for browsers in addition to Internet Explorer and the ability to partition validation controls on a page into validation groups.</span></span> <span data-ttu-id="ed098-149">有关2.0 中的新验证控制功能的详细信息，请参阅[二级 the ASP.NET 2.0 中的验证控件](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx)。</span><span class="sxs-lookup"><span data-stu-id="ed098-149">For more information on the new validation control features in 2.0, refer to [Dissecting the Validation Controls in ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx).</span></span>

<span data-ttu-id="ed098-150">首先，让我们将必要的验证控件添加到 DataList s `EditItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="ed098-150">Let s start by adding the necessary validation controls to the DataList s `EditItemTemplate`.</span></span> <span data-ttu-id="ed098-151">可以通过在设计器中单击 DataList s 智能标记或声明性语法中的 "编辑模板" 链接来执行此任务。</span><span class="sxs-lookup"><span data-stu-id="ed098-151">This task can be performed through the Designer by clicking on the Edit Templates link from the DataList s smart tag, or through the declarative syntax.</span></span> <span data-ttu-id="ed098-152">让我们使用设计视图中的 "编辑模板" 选项逐步执行该过程。</span><span class="sxs-lookup"><span data-stu-id="ed098-152">Let s step through the process using the Edit Templates option from the Design view.</span></span> <span data-ttu-id="ed098-153">选择编辑 DataList `EditItemTemplate`后，通过将其从 "工具箱" 拖放到模板编辑界面中来添加 RequiredFieldValidator，并将其放置在 "`ProductName`" 文本框之后。</span><span class="sxs-lookup"><span data-stu-id="ed098-153">After choosing to edit the DataList s `EditItemTemplate`, add a RequiredFieldValidator by dragging it from the Toolbox into the template editing interface, placing it after the `ProductName` TextBox.</span></span>

<span data-ttu-id="ed098-154">[![在 "ProductName" 文本框后面添加 RequiredFieldValidator 到 EditItemTemplate](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image8.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="ed098-154">[![Add a RequiredFieldValidator to the EditItemTemplate After the ProductName TextBox](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image8.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image7.png)</span></span>

<span data-ttu-id="ed098-155">**图 3**：将 RequiredFieldValidator 添加到 "`ProductName`" 文本框 `EditItemTemplate After` （[单击以查看完全大小的图像](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="ed098-155">**Figure 3**: Add a RequiredFieldValidator to the `EditItemTemplate After` the `ProductName` TextBox ([Click to view full-size image](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image9.png))</span></span>

<span data-ttu-id="ed098-156">所有验证控件都是通过验证单个 ASP.NET Web 控件的输入来完成的。</span><span class="sxs-lookup"><span data-stu-id="ed098-156">All validation controls work by validating the input of a single ASP.NET Web control.</span></span> <span data-ttu-id="ed098-157">因此，我们需要指出，我们刚刚添加的 RequiredFieldValidator 应该针对 `ProductName` 文本框进行验证;完成此操作的方法是：将[`ControlToValidate` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.controltovalidate(VS.80).aspx)的验证控件设置为相应 Web 控件的 `ID` （在此实例中为`ProductName`）。</span><span class="sxs-lookup"><span data-stu-id="ed098-157">Therefore, we need to indicate that the RequiredFieldValidator we just added should validate against the `ProductName` TextBox; this is done by setting the validation control s [`ControlToValidate` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.controltovalidate(VS.80).aspx) to the `ID` of the appropriate Web control (`ProductName`, in this instance).</span></span> <span data-ttu-id="ed098-158">接下来，将[`ErrorMessage` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.errormessage(VS.80).aspx)设置为，则必须将产品的名称和[`Text` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.text(VS.80).aspx)提供给 \*。</span><span class="sxs-lookup"><span data-stu-id="ed098-158">Next, set the [`ErrorMessage` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.errormessage(VS.80).aspx) to You must provide the product s name and the [`Text` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basevalidator.text(VS.80).aspx) to \*.</span></span> <span data-ttu-id="ed098-159">如果验证失败，则 `Text` 属性值（如果提供）是验证控件显示的文本。</span><span class="sxs-lookup"><span data-stu-id="ed098-159">The `Text` property value, if provided, is the text that is displayed by the validation control if the validation fails.</span></span> <span data-ttu-id="ed098-160">ValidationSummary 控件使用所需的 `ErrorMessage` 属性值;如果省略 `Text` 属性值，则验证控件将对无效输入显示 `ErrorMessage` 属性值。</span><span class="sxs-lookup"><span data-stu-id="ed098-160">The `ErrorMessage` property value, which is required, is used by the ValidationSummary control; if the `Text` property value is omitted, the `ErrorMessage` property value is displayed by the validation control on invalid input.</span></span>

<span data-ttu-id="ed098-161">设置 RequiredFieldValidator 的这三个属性后，屏幕应类似于图4所示。</span><span class="sxs-lookup"><span data-stu-id="ed098-161">After setting these three properties of the RequiredFieldValidator, your screen should look similar to Figure 4.</span></span>

<span data-ttu-id="ed098-162">[![设置 RequiredFieldValidator s ControlToValidate、ErrorMessage 和 Text 属性](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image11.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="ed098-162">[![Set the RequiredFieldValidator s ControlToValidate, ErrorMessage, and Text Properties](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image11.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image10.png)</span></span>

<span data-ttu-id="ed098-163">**图 4**：设置 RequiredFieldValidator `ControlToValidate`、`ErrorMessage`和 `Text` 属性（[单击以查看完全大小的图像](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="ed098-163">**Figure 4**: Set the RequiredFieldValidator s `ControlToValidate`, `ErrorMessage`, and `Text` Properties ([Click to view full-size image](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image12.png))</span></span>

<span data-ttu-id="ed098-164">将 RequiredFieldValidator 添加到 `EditItemTemplate`后，剩下的就是为 "产品价格" 文本框添加必要的验证。</span><span class="sxs-lookup"><span data-stu-id="ed098-164">With the RequiredFieldValidator added to the `EditItemTemplate`, all that remains is to add the necessary validation for the product s price TextBox.</span></span> <span data-ttu-id="ed098-165">由于 `UnitPrice` 在编辑记录时是可选的，因此我们不需要添加 RequiredFieldValidator。</span><span class="sxs-lookup"><span data-stu-id="ed098-165">Since the `UnitPrice` is optional when editing a record, we don t need to add a RequiredFieldValidator.</span></span> <span data-ttu-id="ed098-166">但是，我们需要添加一个 CompareValidator，以确保 `UnitPrice`（如提供）的格式正确设置为货币，并且大于或等于0。</span><span class="sxs-lookup"><span data-stu-id="ed098-166">We do, however, need to add a CompareValidator to ensure that the `UnitPrice`, if supplied, is properly formatted as a currency and is greater than or equal to 0.</span></span>

<span data-ttu-id="ed098-167">将 CompareValidator 添加到 `EditItemTemplate` 中，并将其 `ControlToValidate` 属性设置为 `UnitPrice`，其 "`ErrorMessage`" 属性值必须大于或等于零，并且不能包含货币符号，并将其 `Text` 属性添加到 "\*"。</span><span class="sxs-lookup"><span data-stu-id="ed098-167">Add the CompareValidator into the `EditItemTemplate` and set its `ControlToValidate` property to `UnitPrice`, its `ErrorMessage` property to The price must be greater than or equal to zero and cannot include the currency symbol, and its `Text` property to \*.</span></span> <span data-ttu-id="ed098-168">若要指示 `UnitPrice` 值必须大于或等于0，请将 CompareValidator s [`Operator` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.comparevalidator.operator(VS.80).aspx)设置为 `GreaterThanEqual`，将其[`ValueToCompare` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.comparevalidator.valuetocompare(VS.80).aspx)设置为0，并将其[`Type` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basecomparevalidator.type.aspx)设置为 `Currency`。</span><span class="sxs-lookup"><span data-stu-id="ed098-168">To indicate that the `UnitPrice` value must be greater than or equal to 0, set the CompareValidator s [`Operator` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.comparevalidator.operator(VS.80).aspx) to `GreaterThanEqual`, its [`ValueToCompare` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.comparevalidator.valuetocompare(VS.80).aspx) to 0, and its [`Type` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.basecomparevalidator.type.aspx) to `Currency`.</span></span>

<span data-ttu-id="ed098-169">添加这两个验证控件后，DataList s `EditItemTemplate` 的声明性语法应类似于以下形式：</span><span class="sxs-lookup"><span data-stu-id="ed098-169">After adding these two validation controls, the DataList s `EditItemTemplate` s declarative syntax should look similar to the following:</span></span>

[!code-aspx[Main](adding-validation-controls-to-the-datalist-s-editing-interface-cs/samples/sample1.aspx)]

<span data-ttu-id="ed098-170">进行这些更改后，在浏览器中打开该页。</span><span class="sxs-lookup"><span data-stu-id="ed098-170">After making these changes, open the page in a browser.</span></span> <span data-ttu-id="ed098-171">如果在编辑产品时尝试省略名称或输入无效价格值，则文本框的旁边会出现一个星号。</span><span class="sxs-lookup"><span data-stu-id="ed098-171">If you attempt to omit the name or enter an invalid price value when editing a product, an asterisk appears next to the textbox.</span></span> <span data-ttu-id="ed098-172">如图5所示，包含货币符号（如 $19.95）的价格值被视为无效。</span><span class="sxs-lookup"><span data-stu-id="ed098-172">As Figure 5 shows, a price value that includes the currency symbol such as $19.95 is considered invalid.</span></span> <span data-ttu-id="ed098-173">CompareValidator s `Currency` `Type` 允许使用数字分隔符（如逗号或句点，具体取决于区域性设置）和前导加号或减号，但*不允许货币*符号。</span><span class="sxs-lookup"><span data-stu-id="ed098-173">The CompareValidator s `Currency` `Type` allows for digit separators (such as commas or periods, depending on the culture settings) and a leading plus or minus sign, but does *not* permit a currency symbol.</span></span> <span data-ttu-id="ed098-174">此行为可能会 perplex 用户，因为编辑界面当前使用货币格式呈现 `UnitPrice`。</span><span class="sxs-lookup"><span data-stu-id="ed098-174">This behavior may perplex users as the editing interface currently renders the `UnitPrice` using the currency format.</span></span>

<span data-ttu-id="ed098-175">[![带有无效输入的文本框旁边显示星号](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image14.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="ed098-175">[![An Asterisk Appears Next to the Textboxes with Invalid Input](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image14.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image13.png)</span></span>

<span data-ttu-id="ed098-176">**图 5**：在包含无效输入的文本框旁边显示一个星号（[单击以查看完全大小的图像](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="ed098-176">**Figure 5**: An Asterisk Appears Next to the Textboxes with Invalid Input ([Click to view full-size image](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image15.png))</span></span>

<span data-ttu-id="ed098-177">当验证按原样工作时，用户必须在编辑记录时手动删除货币符号，这是不可接受的。</span><span class="sxs-lookup"><span data-stu-id="ed098-177">While the validation works as-is, the user has to manually remove the currency symbol when editing a record, which is not acceptable.</span></span> <span data-ttu-id="ed098-178">此外，如果编辑界面中有无效输入，则在单击 "更新" 或 "取消" 按钮时，将调用回发。</span><span class="sxs-lookup"><span data-stu-id="ed098-178">Moreover, if there are invalid inputs in the editing interface neither the Update nor Cancel buttons, when clicked, will invoke a postback.</span></span> <span data-ttu-id="ed098-179">理想情况下，"取消" 按钮会将 DataList 返回到其预编辑状态，而不考虑用户输入的有效性。</span><span class="sxs-lookup"><span data-stu-id="ed098-179">Ideally, the Cancel button would return the DataList to its pre-editing state regardless of the validity of the user s inputs.</span></span> <span data-ttu-id="ed098-180">此外，在更新 DataList `UpdateCommand` 事件处理程序中的产品信息之前，我们需要确保页数据有效，因为浏览器不支持 JavaScript 或禁用其支持时，用户可以绕过验证控件客户端逻辑。</span><span class="sxs-lookup"><span data-stu-id="ed098-180">Also, we need to ensure that the page s data is valid before updating the product information in the DataList s `UpdateCommand` event handler, as the validation controls client-side logic can be bypassed by users whose browsers either don t support JavaScript or have its support disabled.</span></span>

## <a name="removing-the-currency-symbol-from-the-edititemtemplate-s-unitprice-textbox"></a><span data-ttu-id="ed098-181">从 "EditItemTemplate" 的 "单价" 文本框中删除货币符号</span><span class="sxs-lookup"><span data-stu-id="ed098-181">Removing the Currency Symbol from the EditItemTemplate s UnitPrice TextBox</span></span>

<span data-ttu-id="ed098-182">使用 CompareValidator `Currency``Type`时，正在验证的输入不能包含任何货币符号。</span><span class="sxs-lookup"><span data-stu-id="ed098-182">When using the CompareValidator s `Currency``Type`, the input being validated must not include any currency symbols.</span></span> <span data-ttu-id="ed098-183">此类符号的存在导致 CompareValidator 将输入标记为 "无效"。</span><span class="sxs-lookup"><span data-stu-id="ed098-183">The presence of such symbols causes the CompareValidator to mark the input as invalid.</span></span> <span data-ttu-id="ed098-184">不过，编辑界面当前在 "`UnitPrice`" 文本框中包含一个货币符号，这意味着用户必须在保存其更改之前显式删除该货币符号。</span><span class="sxs-lookup"><span data-stu-id="ed098-184">However, our editing interface currently includes a currency symbol in the `UnitPrice` TextBox, meaning the user must explicitly remove the currency symbol before saving their changes.</span></span> <span data-ttu-id="ed098-185">为此，我们有三个选项：</span><span class="sxs-lookup"><span data-stu-id="ed098-185">To remedy this we have three options:</span></span>

1. <span data-ttu-id="ed098-186">将 `EditItemTemplate` 配置为不将 `UnitPrice` TextBox 值设置为货币格式。</span><span class="sxs-lookup"><span data-stu-id="ed098-186">Configure the `EditItemTemplate` so that the `UnitPrice` TextBox value is not formatted as a currency.</span></span>
2. <span data-ttu-id="ed098-187">允许用户通过删除 CompareValidator 来输入货币符号，并将其替换为 RegularExpressionValidator 检查格式是否正确的货币值。</span><span class="sxs-lookup"><span data-stu-id="ed098-187">Allow the user to enter a currency symbol by removing the CompareValidator and replacing it with a RegularExpressionValidator that checks for a properly formatted currency value.</span></span> <span data-ttu-id="ed098-188">此处的难题是，用于验证货币值的正则表达式与 CompareValidator 简单，并且如果要合并区域性设置，则需要编写代码。</span><span class="sxs-lookup"><span data-stu-id="ed098-188">The challenge here is that the regular expression to validate a currency value is not as straightforward as the CompareValidator and would require writing code if we wanted to incorporate culture settings.</span></span>
3. <span data-ttu-id="ed098-189">完全移除验证控件，并依赖于 GridView `RowUpdating` 事件处理程序中的自定义服务器端验证逻辑。</span><span class="sxs-lookup"><span data-stu-id="ed098-189">Remove the validation control altogether and rely on custom server-side validation logic in the GridView s `RowUpdating` event handler.</span></span>

<span data-ttu-id="ed098-190">在本教程中，让我们通过选项1。</span><span class="sxs-lookup"><span data-stu-id="ed098-190">Let s go with option 1 for this tutorial.</span></span> <span data-ttu-id="ed098-191">由于 `EditItemTemplate`： `<%# Eval("UnitPrice", "{0:c}") %>`中文本框的数据绑定表达式，当前 `UnitPrice` 被设置为货币值的格式。</span><span class="sxs-lookup"><span data-stu-id="ed098-191">Currently the `UnitPrice` is formatted as a currency value due to the databinding expression for the TextBox in the `EditItemTemplate`: `<%# Eval("UnitPrice", "{0:c}") %>`.</span></span> <span data-ttu-id="ed098-192">将 `Eval` 语句更改为 `Eval("UnitPrice", "{0:n2}")`，这将结果的格式设置为具有两位精度的数字。</span><span class="sxs-lookup"><span data-stu-id="ed098-192">Change the `Eval` statement to `Eval("UnitPrice", "{0:n2}")`, which formats the result as a number with two digits of precision.</span></span> <span data-ttu-id="ed098-193">这可以直接通过声明性语法来完成，也可以通过单击 DataList s `EditItemTemplate`的 "`UnitPrice`" 文本框中的 "编辑 databinding" 链接来完成。</span><span class="sxs-lookup"><span data-stu-id="ed098-193">This can be done directly through the declarative syntax or by clicking on the Edit DataBindings link from the `UnitPrice` TextBox in the DataList s `EditItemTemplate`.</span></span>

<span data-ttu-id="ed098-194">进行此更改后，编辑界面中的格式化价格以逗号作为组分隔符，将句点作为小数点分隔符，但保留货币符号。</span><span class="sxs-lookup"><span data-stu-id="ed098-194">With this change, the formatted price in the editing interface includes commas as the group separator and a period as the decimal separator, but leaves off the currency symbol.</span></span>

> [!NOTE]
> <span data-ttu-id="ed098-195">从可编辑界面中删除货币格式时，我发现将货币符号放置在文本框外的文本很有用。</span><span class="sxs-lookup"><span data-stu-id="ed098-195">When removing the currency format from the editable interface, I find it helpful to put the currency symbol as text outside the TextBox.</span></span> <span data-ttu-id="ed098-196">这是用户不需要提供货币符号的提示。</span><span class="sxs-lookup"><span data-stu-id="ed098-196">This serves as a hint to the user that they do not need to provide the currency symbol.</span></span>

## <a name="fixing-the-cancel-button"></a><span data-ttu-id="ed098-197">修复 "取消" 按钮</span><span class="sxs-lookup"><span data-stu-id="ed098-197">Fixing the Cancel Button</span></span>

<span data-ttu-id="ed098-198">默认情况下，验证 Web 控件发出 JavaScript 以在客户端执行验证。</span><span class="sxs-lookup"><span data-stu-id="ed098-198">By default, the validation Web controls emit JavaScript to perform validation on the client-side.</span></span> <span data-ttu-id="ed098-199">单击 "Button"、"LinkButton" 或 "ImageButton" 时，将在客户端上检查页上的验证控件，然后进行回发。</span><span class="sxs-lookup"><span data-stu-id="ed098-199">When a Button, LinkButton, or ImageButton is clicked, the validation controls on the page are checked on the client-side before the postback occurs.</span></span> <span data-ttu-id="ed098-200">如果有任何无效数据，则取消回发。</span><span class="sxs-lookup"><span data-stu-id="ed098-200">If there is any invalid data, the postback is cancelled.</span></span> <span data-ttu-id="ed098-201">但对于某些按钮，数据的有效性可能是重要;在这种情况下，由于无效数据导致回发已取消，因此是一种干扰。</span><span class="sxs-lookup"><span data-stu-id="ed098-201">For certain Buttons, though, the validity of the data might be immaterial; in such a case, having the postback cancelled due to invalid data is a nuisance.</span></span>

<span data-ttu-id="ed098-202">"取消" 按钮是一个示例。</span><span class="sxs-lookup"><span data-stu-id="ed098-202">The Cancel button is such an example.</span></span> <span data-ttu-id="ed098-203">假设用户输入的数据无效，如省略产品名称，然后决定不想在所有的产品之后保存产品并点击 "取消" 按钮。</span><span class="sxs-lookup"><span data-stu-id="ed098-203">Imagine that a user enters invalid data, such as omitting the product s name, and then decides she doesn t want to save the product after all and hits the Cancel button.</span></span> <span data-ttu-id="ed098-204">当前，"取消" 按钮用于触发页面上的验证控件，该控件报告产品名称缺失并阻止回发。</span><span class="sxs-lookup"><span data-stu-id="ed098-204">Currently, the Cancel button triggers the validation controls on the page, which report that the product name is missing and prevent the postback.</span></span> <span data-ttu-id="ed098-205">用户必须在 "`ProductName`" 文本框中键入一些文本，才能取消编辑过程。</span><span class="sxs-lookup"><span data-stu-id="ed098-205">Our user has to type some text into the `ProductName` TextBox just to cancel out of the editing process.</span></span>

<span data-ttu-id="ed098-206">幸运的是，按钮、LinkButton 和 ImageButton 具有一个[`CausesValidation` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.button.causesvalidation.aspx)，该属性可以指示单击按钮是否应启动验证逻辑（默认为 `True`）。</span><span class="sxs-lookup"><span data-stu-id="ed098-206">Fortunately, the Button, LinkButton, and ImageButton have a [`CausesValidation` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.button.causesvalidation.aspx) that can indicate whether or not clicking the Button should initiate the validation logic (defaults to `True`).</span></span> <span data-ttu-id="ed098-207">将 "取消" 按钮 `CausesValidation` 属性设置为 `False`。</span><span class="sxs-lookup"><span data-stu-id="ed098-207">Set the Cancel Button s `CausesValidation` property to `False`.</span></span>

## <a name="ensuring-the-inputs-are-valid-in-the-updatecommand-event-handler"></a><span data-ttu-id="ed098-208">确保输入在 UpdateCommand 事件处理程序中有效</span><span class="sxs-lookup"><span data-stu-id="ed098-208">Ensuring the Inputs are Valid in the UpdateCommand Event Handler</span></span>

<span data-ttu-id="ed098-209">由于验证控件发出的客户端脚本，如果用户输入了无效输入，则验证控件将取消按钮、LinkButton 或 ImageButton 控件启动的任何回发，其 `CausesValidation` 属性是 `True` （默认值）。</span><span class="sxs-lookup"><span data-stu-id="ed098-209">Due to the client-side script emitted by the validation controls, if a user enters invalid input the validation controls cancel any postbacks initiated by Button, LinkButton, or ImageButton controls whose `CausesValidation` properties are `True` (the default).</span></span> <span data-ttu-id="ed098-210">但是，如果用户使用陈旧浏览器访问，或其 JavaScript 支持已禁用的浏览器，则不会执行客户端验证检查。</span><span class="sxs-lookup"><span data-stu-id="ed098-210">However, if a user is visiting with an antiquated browser or one whose JavaScript support has been disabled, the client-side validation checks will not execute.</span></span>

<span data-ttu-id="ed098-211">所有 ASP.NET 验证控件会在回发时立即重复其验证逻辑，并通过[`Page.IsValid` 属性](https://msdn.microsoft.com/library/system.web.ui.page.isvalid.aspx)报告页面输入的整体有效性。</span><span class="sxs-lookup"><span data-stu-id="ed098-211">All of the ASP.NET validation controls repeat their validation logic immediately upon postback and report the overall validity of the page s inputs via the [`Page.IsValid` property](https://msdn.microsoft.com/library/system.web.ui.page.isvalid.aspx).</span></span> <span data-ttu-id="ed098-212">但是，不会根据 `Page.IsValid`的值，以任何方式中断或停止页面流。</span><span class="sxs-lookup"><span data-stu-id="ed098-212">However, the page flow is not interrupted or stopped in any way based on the value of `Page.IsValid`.</span></span> <span data-ttu-id="ed098-213">作为开发人员，我们负责确保 `Page.IsValid` 属性的值为 `True`，然后再继续执行采用有效输入数据的代码。</span><span class="sxs-lookup"><span data-stu-id="ed098-213">As developers, it is our responsibility to ensure that the `Page.IsValid` property has a value of `True` before proceeding with code that assumes valid input data.</span></span>

<span data-ttu-id="ed098-214">如果用户禁用了 JavaScript，请访问我们的页面，编辑产品，输入价格值太大，然后单击 "更新" 按钮，客户端验证将被绕过，而回发会不幸。</span><span class="sxs-lookup"><span data-stu-id="ed098-214">If a user has JavaScript disabled, visits our page, edits a product, enters a price value of Too expensive, and clicks the Update button, the client-side validation will be bypassed and a postback will ensue.</span></span> <span data-ttu-id="ed098-215">在回发时，ASP.NET 页 s `UpdateCommand` 事件处理程序执行，在尝试分析 `Decimal`的资源太昂贵时，将引发异常。</span><span class="sxs-lookup"><span data-stu-id="ed098-215">On postback, the ASP.NET page s `UpdateCommand` event handler executes and an exception is raised when attempting to parse Too expensive to a `Decimal`.</span></span> <span data-ttu-id="ed098-216">由于我们有异常处理，因此将适当处理此类异常，但如果 `Page.IsValid` 的值为 `True`，则只能通过 `UpdateCommand` 事件处理程序来阻止无效数据在第一次遍历。</span><span class="sxs-lookup"><span data-stu-id="ed098-216">Since we have exception handling, such an exception will be handled gracefully, but we could prevent the invalid data from slipping through in the first place by only proceeding with the `UpdateCommand` event handler if `Page.IsValid` has a value of `True`.</span></span>

<span data-ttu-id="ed098-217">将以下代码添加到 `UpdateCommand` 事件处理程序的开头，紧跟在 `Try` 块之前：</span><span class="sxs-lookup"><span data-stu-id="ed098-217">Add the following code to the start of the `UpdateCommand` event handler, immediately before the `Try` block:</span></span>

[!code-csharp[Main](adding-validation-controls-to-the-datalist-s-editing-interface-cs/samples/sample2.cs)]

<span data-ttu-id="ed098-218">通过此添加，产品将尝试仅在提交的数据有效时进行更新。</span><span class="sxs-lookup"><span data-stu-id="ed098-218">With this addition, the product will attempt to be updated only if the submitted data is valid.</span></span> <span data-ttu-id="ed098-219">由于验证控制客户端脚本，大多数用户将无法回发无效数据，但是浏览器不支持 JavaScript 或禁用了 JavaScript 支持的用户可以绕过客户端检查并提交无效数据。</span><span class="sxs-lookup"><span data-stu-id="ed098-219">Most users won't be able to postback invalid data due to the validation controls client-side scripts, but users whose browsers don t support JavaScript or that have JavaScript support disabled, can bypass the client-side checks and submit invalid data.</span></span>

> [!NOTE]
> <span data-ttu-id="ed098-220">敏锐读取器会回忆到，在通过 GridView 更新数据时，我们不需要在页面代码隐藏类中显式检查 `Page.IsValid` 属性。</span><span class="sxs-lookup"><span data-stu-id="ed098-220">The astute reader will recall that when updating data with the GridView, we didn't need to explicitly check the `Page.IsValid` property in our page s code-behind class.</span></span> <span data-ttu-id="ed098-221">这是因为 GridView 会询问我们的 `Page.IsValid` 属性，只在返回值为 `True`时才继续更新。</span><span class="sxs-lookup"><span data-stu-id="ed098-221">This is because the GridView consults the `Page.IsValid` property for us and only proceeds with the update only if it returns a value of `True`.</span></span>

## <a name="step-3-summarizing-data-entry-problems"></a><span data-ttu-id="ed098-222">步骤3：汇总数据输入问题</span><span class="sxs-lookup"><span data-stu-id="ed098-222">Step 3: Summarizing Data Entry Problems</span></span>

<span data-ttu-id="ed098-223">除了五个验证控件外，ASP.NET 还包含[ValidationSummary 控件](https://msdn.microsoft.com/library/f9h59855(VS.80).aspx)，该控件显示检测到无效数据的那些验证控件的 `ErrorMessage`。</span><span class="sxs-lookup"><span data-stu-id="ed098-223">In addition to the five validation controls, ASP.NET includes the [ValidationSummary control](https://msdn.microsoft.com/library/f9h59855(VS.80).aspx), which displays the `ErrorMessage` s of those validation controls that detected invalid data.</span></span> <span data-ttu-id="ed098-224">此摘要数据可以在网页上或通过模式的客户端 messagebox 显示为文本。</span><span class="sxs-lookup"><span data-stu-id="ed098-224">This summary data can be displayed as text on the web page or through a modal, client-side messagebox.</span></span> <span data-ttu-id="ed098-225">让我们增加本教程，使其包括客户端 messagebox，汇总所有验证问题。</span><span class="sxs-lookup"><span data-stu-id="ed098-225">Let s enhance this tutorial to include a client-side messagebox summarizing any validation problems.</span></span>

<span data-ttu-id="ed098-226">若要实现此目的，请将 ValidationSummary 控件从工具箱拖到设计器上。</span><span class="sxs-lookup"><span data-stu-id="ed098-226">To accomplish this, drag a ValidationSummary control from the Toolbox onto the Designer.</span></span> <span data-ttu-id="ed098-227">ValidationSummary 控件的位置并不重要，因为我们会将其配置为仅将摘要显示为 messagebox。</span><span class="sxs-lookup"><span data-stu-id="ed098-227">The location of the ValidationSummary control doesn t really matter, since we re going to configure it to only display the summary as a messagebox.</span></span> <span data-ttu-id="ed098-228">添加控件后，将其[`ShowSummary` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.validationsummary.showsummary(VS.80).aspx)设置为 "`False`"，并将其[`ShowMessageBox` 属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.validationsummary.showmessagebox(VS.80).aspx)设置为 "`True`"。</span><span class="sxs-lookup"><span data-stu-id="ed098-228">After adding the control, set its [`ShowSummary` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.validationsummary.showsummary(VS.80).aspx) to `False` and its [`ShowMessageBox` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.validationsummary.showmessagebox(VS.80).aspx) to `True`.</span></span> <span data-ttu-id="ed098-229">添加此项后，会在客户端 messagebox 中汇总验证错误（参见图6）。</span><span class="sxs-lookup"><span data-stu-id="ed098-229">With this addition, any validation errors are summarized in a client-side messagebox (see Figure 6).</span></span>

<span data-ttu-id="ed098-230">[![在客户端 Messagebox 中汇总验证错误](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image17.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="ed098-230">[![The Validation Errors are Summarized in a Client-Side Messagebox](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image17.png)](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image16.png)</span></span>

<span data-ttu-id="ed098-231">**图 6**：在客户端 Messagebox 中汇总验证错误（[单击以查看完全大小的映像](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="ed098-231">**Figure 6**: The Validation Errors are Summarized in a Client-Side Messagebox ([Click to view full-size image](adding-validation-controls-to-the-datalist-s-editing-interface-cs/_static/image18.png))</span></span>

## <a name="summary"></a><span data-ttu-id="ed098-232">摘要</span><span class="sxs-lookup"><span data-stu-id="ed098-232">Summary</span></span>

<span data-ttu-id="ed098-233">在本教程中，我们介绍了如何通过使用验证控件主动确保用户输入有效，然后再尝试在更新工作流中使用它们，从而降低异常的可能性。</span><span class="sxs-lookup"><span data-stu-id="ed098-233">In this tutorial we saw how to reduce the likelihood of exceptions by using validation controls to proactively ensure that our users inputs are valid before attempting to use them in the updating workflow.</span></span> <span data-ttu-id="ed098-234">ASP.NET 提供了五个验证 Web 控件，这些控件旨在检查特定的 Web 控件的输入，并返回输入的有效性。</span><span class="sxs-lookup"><span data-stu-id="ed098-234">ASP.NET provides five validation Web controls that are designed to inspect a particular Web control s input and report back on the input s validity.</span></span> <span data-ttu-id="ed098-235">在本教程中，我们使用这五个控件中的两个控件 RequiredFieldValidator 和 CompareValidator，以确保已提供产品的名称，并且价格的货币格式值大于或等于零。</span><span class="sxs-lookup"><span data-stu-id="ed098-235">In this tutorial we used two of those five controls the RequiredFieldValidator and the CompareValidator to ensure that the product s name was supplied and that the price had a currency format with a value greater than or equal to zero.</span></span>

<span data-ttu-id="ed098-236">向 DataList 的编辑界面添加验证控件就像将它们从工具箱拖动到 `EditItemTemplate`，再设置几个属性一样简单。</span><span class="sxs-lookup"><span data-stu-id="ed098-236">Adding validation controls to the DataList s editing interface is as simple as dragging them onto the `EditItemTemplate` from the Toolbox and setting a handful of properties.</span></span> <span data-ttu-id="ed098-237">默认情况下，验证控件会自动发出客户端验证脚本;它们还提供对回发的服务器端验证，将累积结果存储在 `Page.IsValid` 属性中。</span><span class="sxs-lookup"><span data-stu-id="ed098-237">By default, the validation controls automatically emit client-side validation script; they also provide server-side validation on postback, storing the cumulative result in the `Page.IsValid` property.</span></span> <span data-ttu-id="ed098-238">若要在单击按钮、LinkButton 或 ImageButton 时绕过客户端验证，请将按钮 `CausesValidation` 属性设置为 `False`。</span><span class="sxs-lookup"><span data-stu-id="ed098-238">To bypass the client-side validation when a Button, LinkButton, or ImageButton is clicked, set the button s `CausesValidation` property to `False`.</span></span> <span data-ttu-id="ed098-239">此外，在对回发提交的数据执行任何任务之前，请确保 `Page.IsValid` 属性返回 `True`。</span><span class="sxs-lookup"><span data-stu-id="ed098-239">Also, before performing any tasks with the data submitted on postback, ensure that the `Page.IsValid` property returns `True`.</span></span>

<span data-ttu-id="ed098-240">到目前为止，我们已经检查过的所有 DataList 编辑教程都有非常简单的编辑界面，其中包含产品名称的文本框和价格。</span><span class="sxs-lookup"><span data-stu-id="ed098-240">All of the DataList editing tutorials we ve examined so far have had very simple editing interfaces a TextBox for the product s name and another for the price.</span></span> <span data-ttu-id="ed098-241">不过，编辑界面可以包含不同的 Web 控件，如 DropDownLists、日历、单选按钮、复选框等。</span><span class="sxs-lookup"><span data-stu-id="ed098-241">The editing interface, however, can contain a mix of different Web controls, such as DropDownLists, Calendars, RadioButtons, CheckBoxes, and so on.</span></span> <span data-ttu-id="ed098-242">在下一教程中，我们将介绍如何构建使用各种 Web 控件的接口。</span><span class="sxs-lookup"><span data-stu-id="ed098-242">In our next tutorial we'll look at building an interface that uses a variety of Web controls.</span></span>

<span data-ttu-id="ed098-243">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="ed098-243">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="ed098-244">关于作者</span><span class="sxs-lookup"><span data-stu-id="ed098-244">About the Author</span></span>

<span data-ttu-id="ed098-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，创始人的[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已在使用 Microsoft Web 技术，自1998开始。</span><span class="sxs-lookup"><span data-stu-id="ed098-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="ed098-246">Scott 的工作方式是独立的顾问、培训师和撰稿人。</span><span class="sxs-lookup"><span data-stu-id="ed098-246">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="ed098-247">他的最新书籍是，[*在24小时内，sam ASP.NET 2.0*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="ed098-247">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="ed098-248">可以[mitchell@4GuysFromRolla.com访问。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="ed098-248">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="ed098-249">或通过他的博客，可以在[http://ScottOnWriting.NET](http://ScottOnWriting.NET)找到。</span><span class="sxs-lookup"><span data-stu-id="ed098-249">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="ed098-250">特别感谢</span><span class="sxs-lookup"><span data-stu-id="ed098-250">Special Thanks To</span></span>

<span data-ttu-id="ed098-251">此教程系列由许多有用的审阅者查看。</span><span class="sxs-lookup"><span data-stu-id="ed098-251">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="ed098-252">本教程的主管评审者是 Dennis Patterson 将、Ken Pespisa 和 Liz Shulok。</span><span class="sxs-lookup"><span data-stu-id="ed098-252">Lead reviewers for this tutorial were Dennis Patterson, Ken Pespisa, and Liz Shulok.</span></span> <span data-ttu-id="ed098-253">想要查看我即将发布的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="ed098-253">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="ed098-254">如果是这样，请在mitchell@4GuysFromRolla.com放置一行[。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="ed098-254">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="ed098-255">[上一页](handling-bll-and-dal-level-exceptions-cs.md)
> [下一页](customizing-the-datalist-s-editing-interface-cs.md)</span><span class="sxs-lookup"><span data-stu-id="ed098-255">[Previous](handling-bll-and-dal-level-exceptions-cs.md)
[Next](customizing-the-datalist-s-editing-interface-cs.md)</span></span>
