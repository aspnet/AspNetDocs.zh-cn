---
uid: web-forms/overview/moving-to-aspnet-20/data-bound-controls
title: 数据绑定控件 |微软文档
author: rick-anderson
description: 大多数ASP.NET应用程序依赖于后端数据源的某种程度的数据表示。 数据绑定控件是交互的关键部分。
ms.author: riande
ms.date: 02/20/2005
ms.assetid: 0e23ff32-646d-43f3-8bec-6b2313d3abd6
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/data-bound-controls
msc.type: authoredcontent
ms.openlocfilehash: 941e2ed15b3da28991e7b06cbab570eb1b5b8899
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/17/2020
ms.locfileid: "81543075"
---
# <a name="data-bound-controls"></a>数据绑定控件

由[微软](https://github.com/microsoft)

> 大多数ASP.NET应用程序依赖于后端数据源的某种程度的数据表示。 数据绑定控件一直是动态 Web 应用程序中与数据交互的关键部分。 ASP.NET 2.0 引入了对数据绑定控件的一些实质性改进，包括新的 BaseDataBoundControl 类和声明性语法。

大多数ASP.NET应用程序依赖于后端数据源的某种程度的数据表示。 数据绑定控件一直是动态 Web 应用程序中与数据交互的关键部分。 ASP.NET 2.0 引入了对数据绑定控件的一些实质性改进，包括新的 BaseDataBoundControl 类和声明性语法。

BaseDataBoundControl 充当 DataBoundControl 类和分层数据绑定控制类的基类。 在本模块中，我们将讨论以下从 DataBoundControl 派生的类：

- AdRotator
- 列表控件
- GridView
- 窗体视图
- 详细信息查看

我们还将讨论以下派生自分层数据绑定控制类的类：

- TreeView
- 菜单
- 站点地图路径

## <a name="databoundcontrol-class"></a>数据绑定控制类

DataBoundControl 类是一个抽象类（在 VB 中标记为 MustInherit），用于与表格或列表样式数据进行交互。 以下控件是从 DataBoundControl 派生的一些控件。

## <a name="adrotator"></a>AdRotator

AdRotator 控件允许您在链接到特定 URL 的网页上显示图形横幅。 显示的图形使用控件的属性旋转。 可以使用**展示次数**配置网页上特定广告的频率，并且可以使用关键字筛选对广告进行筛选。

AdRotator 控件使用 XML 文件或数据库中的表来收集数据。 XML 文件中使用以下属性来配置 AdRotator 控件。

### <a name="imageurl"></a>ImageUrl
要为广告显示的图像的 URL。

### <a name="navigateurl"></a>导航Url
点击广告时应带用户输入的网址。 这应该是 URL 编码的。

### <a name="alternatetext"></a>AlternateText
在工具提示中显示的由屏幕阅读器读取的备用文本。 还显示 ImageUrl 指定的图像不可用时。

### <a name="keyword"></a>关键字
定义在使用关键字筛选时可以使用的关键字。 如果指定，则仅显示关键字与关键字筛选器匹配的广告。

### <a name="impressions"></a>曝光数
确定特定广告的展示频率的加权数字。 它相对于同一文件中其他广告的展示次数。 XML 文件中所有广告的集体展示的最大价值为 2，048，000，000 1。

### <a name="height"></a>高度
广告的高度（以像素为单位）。

### <a name="width"></a>宽度
广告的宽度（以像素为单位）。

> [!NOTE]
> "高度和宽度"属性将覆盖 AdRotator 控件本身的高度和宽度。

典型的 XML 文件可能如下所示：

[!code-xml[Main](data-bound-controls/samples/sample1.xml)]

在上面的示例中，Contoso 的广告出现的可能性是ASP.NET网站广告的两倍，因为"展示次数"属性的值。

要显示来自上述 XML 文件中的广告，向页面添加 AdRotator 控件，并将 **"广告文件"** 属性设置为指向 XML 文件，如下所示：

[!code-aspx[Main](data-bound-controls/samples/sample2.aspx)]

如果选择使用数据库表作为 AdRotator 控件的数据源，则首先需要使用以下架构设置数据库：

| **列名称** | **数据类型** | **说明** |
| --- | --- | --- |
| ID | int | 主密钥。 此列可以具有任何名称。 |
| ImageUrl | 恩瓦尔恰尔（*长度*） | 要为广告显示的图像的相对或绝对 URL。 |
| 导航Url | 恩瓦尔恰尔（*长度*） | 广告的目标网址。 如果您未提供值，则广告不是超链接。 |
| AlternateText | 恩瓦尔恰尔（*长度*） | 如果找不到图像，则显示的文本。 在某些浏览器中，文本显示为工具提示。 备用文本还用于辅助功能，以便看不到图形的用户可以听到其描述大声读出。 |
| 关键字 | 恩瓦尔恰尔（*长度*） | 网页可以过滤的广告的类别。 |
| 曝光数 | int（4） | 指示广告展示频率的可能性的数字。 数字越大，广告的展示频率就越大。 XML 文件中的所有展示次数值总数不得超过 2，048，000，000 - 1。 |
| 宽度 | int（4） | 图像的宽度（以像素为单位）。 |
| 高度 | int（4） | 图像的高度（以像素为单位）。 |

如果您已经拥有了具有不同架构的数据库，则可以使用**AlternateTextField、ImageUrlField**和**NavigateUrlField****NavigateUrlField**属性将 AdRotator 属性映射到现有数据库。 要在 AdRotator 控件中显示数据库中的数据，请向页面添加数据源控件，配置数据源控件的连接字符串以指向数据库，并将 AdRotator 控件的**DataSourceID**属性设置为数据源控件的 ID。 如果您需要以编程方式配置 AdRotator 广告，请使用 Ad"创建"活动。 AdCreated 事件需要两个参数;一个对象，另一个为 AdCreatedEventArgs 的实例。 AdCreatedEventArgs 是对正在创建的广告的引用。

以下代码段以编程方式设置广告的 ImageUrl、NavigateUrl 和备用文本：

[!code-csharp[Main](data-bound-controls/samples/sample3.cs)]

## <a name="list-controls"></a>列表控件

列表控件包括列表框、下拉列表、复选框列表、广播按钮列表和项目符号列表。 这些控件中的每一个都可以绑定到数据源的数据。 它们使用数据源中的一个字段作为显示文本，可以选择使用第二个字段作为项的值。 还可以在设计时静态添加项，还可以混合从数据源添加的静态项和动态项。

要绑定列表控件，向页面添加数据源控件。 为数据源控件指定 SELECT 命令，然后将列表控件的 DataSourceID 属性设置为数据源控件的 ID。 使用**DataTextField**和**DataValueField**属性定义显示文本和控件的值。 此外，您可以使用**DataTextFormatString**属性控制显示文本的外观，如下所示：

| **表达** | **说明** |
| --- | --- |
| 价格：{0:C} | 对于数字/十进制数据。 显示字面"价格："后跟货币格式的数字。 货币格式取决于**在 Page**指令或 Web.config 文件中的区域性属性中指定的区域性设置。 |
| {0:D4} | 对于整数数据。 不能与十进制数字一起使用。 整数显示在四个字符宽的零填充字段中。 |
| {0:N2}% | 对于数字数据。 显示具有 2 位精度的数字，后跟字"%"。 |
| {0:000.0} | 对于数字/十进制数据。 数字四舍五入为小数位数。 不到三位的数字用零填充。 |
| {0:D} | 对于日期/时间数据。 显示长日期格式（"1996 年 8 月 6 日，星期四"）。 日期格式取决于页面或 Web.config 文件的区域性设置。 |
| {0:d} | 对于日期/时间数据。 显示短日期格式（"12/31/99"）。 |
| {0:yy-MM-dd} | 对于日期/时间数据。 以数字年月格式显示日期 （96-08-06） |

## <a name="gridview"></a>GridView

GridView 控件允许使用声明性方法进行表格式数据显示和编辑，是 DataGrid 控件的继承者。 网格视图控件中提供了以下功能。

- 绑定到数据源控件，如 SqlDataSource。
- 内置排序功能。
- 内置更新和删除功能。
- 内置寻呼功能。
- 内置行选择功能。
- 对 GridView 对象模型的编程访问，以动态设置属性、处理事件等。
- 多个键字段。
- 超链接列的多个数据字段。
- 通过主题和样式自定义外观。

**列字段**

GridView 控件中的每个列都由数据控制字段对象表示。 默认情况下，自动生成列柱属性设置为 true ，该**属性**为数据源中的每个字段创建一个自动生成字段对象。 然后，每个字段都以网格视图控件中的列呈现为一列，顺序显示每个字段在数据源中。 还可以通过将 **"自动生成列"** 属性设置为**false，** 然后定义自己的列字段集合，手动控制**GridView**控件中显示的列字段。 不同的列字段类型确定控件中列的行为。

下表列出了可以使用的不同列字段类型。

| **列字段类型** | **说明** |
| --- | --- |
| BoundField | 显示数据源中字段的值。 这是 GridView 控件的默认列类型。 |
| ButtonField | 显示 GridView 控件中每个项目的命令按钮。 这允许您创建自定义按钮控件的列，例如"添加"或"删除"按钮。 |
| CheckBoxField | 在 GridView 控件中显示每个项目的复选框。 此列字段类型通常用于显示具有布尔值的字段。 |
| CommandField | 显示预定义的命令按钮，以执行选择、编辑或删除操作。 |
| HyperLinkField | 将数据源中的字段值显示为超链接。 此列字段类型允许您将第二个字段绑定到超链接的 URL。 |
| ImageField | 在 GridView 控件中显示每个项目的图像。 |
| 模板字段 | 根据指定的模板显示 GridView 控件中每个项目的用户定义内容。 此列字段类型允许您创建自定义列字段。 |

要声明性地定义列字段集合，请首先在 GridView 控件的打开和关闭标记之间添加开篇和关闭**&lt;列&gt;** 标记。 接下来，列出要在"开始"和"关闭**&lt;列"&gt;** 标记之间包含的列字段。 指定的列按列出的顺序添加到列集合中。 **列**集合存储控件中的所有列字段，并允许您以编程方式管理 GridView 控件中的列字段。

显式声明的列字段可以与自动生成的列字段结合显示。 当两者同时使用时，首先呈现显式声明的列字段，后跟自动生成的列字段。

## <a name="binding-to-data"></a>绑定到数据

GridView 控件可以绑定到数据源控件（如**SqlDataSource、ObjectDataSource**等）以及实现系统的任何数据源。 **ObjectDataSource** 使用以下方法之一将 GridView 控件绑定到相应的数据源类型：

- 要绑定到数据源控件，将 GridView 控件的 DataSourceID 属性设置为数据源控件的 ID 值。 GridView 控件会自动绑定到指定的数据源控件，并可以利用数据源控件的功能执行排序、更新、删除和分页功能。 这是绑定到数据的首选方法。
- 要绑定到实现 System.集合.IE50ble 接口的数据源，请以编程方式将 GridView 控件的 DataSource 属性设置为数据源，然后调用 DataBind 方法。 使用此方法时，GridView 控件不提供内置排序、更新、删除和分页功能。 您需要自己提供此功能。

## <a name="data-operations"></a>数据操作

GridView 控件提供了许多内置功能，允许用户对控件中的项进行排序、更新、删除、选择和分页。 当 GridView 控件绑定到数据源控件时，GridView 控件可以利用数据源控件的功能并提供自动排序、更新和删除功能。

> [!NOTE]
> GridView 控件可以为与其他类型的数据源进行排序、更新和删除提供支持;但是，您需要提供适当的事件处理程序，并实现这些操作。

排序允许用户通过单击列的标题对 GridView 控件中相对于特定列的项目进行排序。 要启用排序，请将 Allow 排序属性设置为**true**。

单击**ButtonField**或**模板字段**字段中的按钮（分别具有"编辑"、"删除"和"选择"）时，将启用自动更新、删除和选择功能。 如果"自动生成编辑按钮"、"自动生成删除按钮"或"自动生成选择按钮"属性分别设置为**true，** 则 GridView 控件可以自动添加带有"编辑"、"删除"或"选择"按钮的 **"命令字段**"列字段。

> [!NOTE]
> GridView 控件不支持将记录插入数据源。 但是，可以使用 GridView 控件与"详细信息视图"或"窗体视图"控件结合使用来插入记录。

GridView 控件可以自动将记录分解为页面，而不是同时显示数据源中的所有记录。 要启用分页，请将 Allow 分页属性设置为**true**。

## <a name="customizing-the-user-interface"></a>自定义用户界面

您可以通过为控件的不同部分设置样式属性来自定义 GridView 控件的外观。 下表列出了不同的样式属性。

| **样式属性** | **说明** |
| --- | --- |
| 交替行样式 | GridView 控件中交替数据行的样式设置。 设置此属性时，数据行在 RowStyle 设置和**交替行设置**之间交替显示。 |
| 编辑行样式 | 网格视图控件中正在编辑的行的样式设置。 |
| 空数据行样式 | 当数据源不包含任何记录时，GridView 控件中显示的空数据行的样式设置。 |
| 脚法 | GridView 控件的脚行的样式设置。 |
| 标题样式 | GridView 控件的标头行的样式设置。 |
| 寻呼机样式 | GridView 控件的寻呼机行的样式设置。 |
| 行样式 | GridView 控件中数据行的样式设置。 当还设置**交替罗文样式**属性时，数据行将显示在 **"行样式"** 设置和**交替行设置**之间交替显示。 |
| 所选行样式 | GridView 控件中所选行的样式设置。 |

您还可以显示或隐藏控件的不同部分。 下表列出了控制显示或隐藏哪些零件的属性。

| **属性** | **说明** |
| --- | --- |
| 显示足 | 显示或隐藏 GridView 控件的脚部。 |
| 显示标题 | 显示或隐藏 GridView 控件的标题部分。 |

### <a name="events"></a>事件

GridView 控件提供了多个可以针对的事件。 这允许您在发生事件时运行自定义例程。 下表列出了 GridView 控件支持的事件。

| **事件** | **说明** |
| --- | --- |
| 页面索引已更改 | 单击其中一个寻呼机按钮，但在 GridView 控件处理分页操作后发生。 当用户导航到控件中的不同页面后需要执行任务时，通常使用此事件。 |
| 页面索引更改 | 单击其中一个寻呼机按钮，但在 GridView 控件处理分页操作之前发生。 此事件通常用于取消分页操作。 |
| 行取消编辑 | 单击行的"取消"按钮，但在 GridView 控件退出编辑模式之前发生。 此事件通常用于停止取消操作。 |
| 行命令 | 在 GridView 控件中单击按钮时发生。 当在控件中单击按钮时，此事件通常用于执行任务。 |
| 行创建 | 在 GridView 控件中创建新行时发生。 此事件通常用于在创建行时修改行的内容。 |
| 行数据绑定 | 当数据行绑定到 GridView 控件中的数据时发生。 此事件通常用于在行绑定到数据时修改行的内容。 |
| 已删除行 | 单击行的"删除"按钮，但在 GridView 控件从数据源中删除记录后，将发生。 此事件通常用于检查删除操作的结果。 |
| 行删除 | 单击行的"删除"按钮，但在 GridView 控件从数据源中删除记录之前发生。 此事件通常用于取消删除操作。 |
| 行编辑 | 单击行的"编辑"按钮，但在 GridView 控件进入编辑模式之前发生。 此事件通常用于取消编辑操作。 |
| 行更新 | 单击行的"更新"按钮，但在 GridView 控件更新行后发生。 此事件通常用于检查更新操作的结果。 |
| 行更新 | 单击行的"更新"按钮，但在 GridView 控件更新行之前发生。 此事件通常用于取消更新操作。 |
| SelectedIndexChanged | 单击行的"选择"按钮，但在 GridView 控件处理选择操作后发生。 此事件通常用于在控件中选择行后执行任务。 |
| 选定的索引更改 | 单击行的"选择"按钮，但在 GridView 控件处理选择操作之前发生。 此事件通常用于取消选择操作。 |
| 排序 | 单击对列进行排序的超链接，但在 GridView 控件处理排序操作后，将发生。 此事件通常用于在用户单击超链接对列进行排序后执行任务。 |
| 排序 | 单击对列进行排序的超链接，但在 GridView 控件处理排序操作之前发生。 此事件通常用于取消排序操作或执行自定义排序例程。 |

## <a name="formview"></a>窗体视图

FormView 控件用于显示数据源中的单个记录。 它与"详细信息视图"控件类似，只显示用户定义的模板而不是行字段。 通过创建自己的模板，您可以更灵活地控制数据的显示方式。 FormView 控件支持以下功能：

- 绑定到数据源控件，如 SqlDataSource 和 ObjectDataSource。
- 内置插入功能。
- 内置更新和删除功能。
- 内置寻呼功能。
- 对 FormView 对象模型的编程访问，以动态设置属性、处理事件等。
- 通过用户定义的模板、主题和样式自定义外观。

## <a name="templates"></a>模板

要显示内容，需要为控件的不同部分创建模板。 大多数模板是可选的;但是，您必须为配置控件的模式创建模板。 例如，支持插入记录的 FormView 控件必须定义插入项模板。 下表列出了您可以创建的不同模板。

| **模板类型** | **说明** |
| --- | --- |
| 编辑项目模板 | 在 FormView 控件处于编辑模式时定义数据行的内容。 此模板通常包含输入控件和命令按钮，用户可以使用这些按钮编辑现有记录。 |
| 空数据模板 | 定义 FormView 控件绑定到不包含任何记录的数据源时显示的空数据行的内容。 此模板通常包含内容，以提醒用户数据源不包含任何记录。 |
| 脚部模板 | 定义页脚行的内容。 此模板通常包含您希望在页脚行中显示的任何其他内容。 作为替代方法，只需设置"英尺文本"属性，即可指定要在页脚行中显示的文本。 |
| 标题模板 | 定义标题行的内容。 此模板通常包含要在标题行中显示的任何其他内容。 作为替代方法，只需设置"标题文本"属性，即可指定要在标题行中显示的文本。 |
| ItemTemplate | 当 FormView 控件处于只读模式时，定义数据行的内容。 此模板通常包含用于显示现有记录的值的内容。 |
| 插入项目模板 | 在 FormView 控件处于插入模式时定义数据行的内容。 此模板通常包含输入控件和命令按钮，用户可以使用这些按钮添加新记录。 |
| 寻呼机模板 | 定义启用分页功能时显示的寻呼机行的内容（当 Allow 分页属性设置为**true**时）。 此模板通常包含用户可以导航到其他记录的控件。 |

编辑项模板和插入项模板中的输入控件可以使用双向绑定表达式绑定到数据源的字段。 这允许 FormView 控件自动提取用于更新或插入操作的输入控件的值。 双向绑定表达式还允许编辑项模板中的输入控件自动显示原始字段值。

### <a name="binding-to-data"></a>绑定到数据

FormView 控件可以绑定到数据源控件（如 SqlDataSource、AccessDataSource、ObjectDataSource**ObjectDataSource**等）或实现系统的任何数据源。 **SqlDataSource** 使用以下方法之一将 FormView 控件绑定到相应的数据源类型：

- 要绑定到数据源控件，将 FormView 控件的 DataSourceID 属性设置为数据源控件的 ID 值。 FormView 控件会自动绑定到指定的数据源控件，并可以利用数据源控件的功能执行插入、更新、删除和分页功能。 这是绑定到数据的首选方法。
- 要绑定到实现**System.集合.IE50ble 接口**的数据源，请以编程方式将 FormView 控件的 DataSource 属性设置为数据源，然后调用 DataBind 方法。 使用此方法时，FormView 控件不提供内置的插入、更新、删除和分页功能。 您需要使用相应的事件来提供此功能。

## <a name="data-operations"></a>数据操作

FormView 控件提供了许多内置功能，允许用户更新、删除、插入和翻阅控件中的项。 当 FormView 控件绑定到数据源控件时，FormView 控件可以利用数据源控件的功能并提供自动更新、删除、插入和分页功能。 FormView 控件可以为与其他类型的数据源的更新、删除、插入和分页操作提供支持;但是，您必须提供适当的事件处理程序，并实现这些操作。

由于 FormView 控件使用模板，因此它不提供自动生成命令按钮以执行更新、删除或插入操作的方法。 您必须手动将这些命令按钮包含在相应的模板中。 FormView 控件可识别某些按钮，这些按钮的命令**名称**属性设置为特定值。 下表列出了 FormView 控件识别的命令按钮。

| **按钮** | **命令名称值** | **说明** |
| --- | --- | --- |
| 取消 | "取消" | 用于更新或插入操作以取消操作并丢弃用户输入的值。 然后，FormView 控件返回到默认模式属性指定的模式。 |
| 删除 | “Delete” | 用于删除从数据源中删除显示的记录的操作。 引发项目删除和项目删除事件。 |
| 编辑 | "编辑" | 用于更新操作，将 FormView 控件置于编辑模式。 为数据行显示**在 EditItemTemplate**属性中指定的内容。 |
| 插入 | "插入" | 用于插入操作，尝试使用用户提供的值在数据源中插入新记录。 引发项目插入和项目插入事件。 |
| 新建 | "新建" | 用于插入操作，将 FormView 控件置于插入模式。 在**InsertItemTemplate**属性中指定的内容将显示为数据行。 |
| 页 | "页" | 用于寻呼操作，以表示执行分页的寻呼行中的按钮。 要指定分页操作，请将按钮的**CommandArgument**属性设置为"下一步"、"前一"、"第一"、"最后"或要导航的页面的索引。 引发页面索引更改和页面索引更改事件。 |
| 更新 | "更新" | 用于更新操作，以尝试使用用户提供的值更新数据源中显示的记录。 引发项目更新和项目更新事件。 |

与"删除"按钮（立即删除显示的记录）不同，当单击"编辑"或"新建"按钮时，"FormView"控件将分别进入编辑或插入模式。 在编辑模式下，当前数据项将显示 **"编辑项目模板"** 属性中包含的内容。 通常，定义编辑项目模板，以便将"编辑"按钮替换为"更新"和"取消"按钮。 适合字段数据类型（如 TextBox 或 CheckBox 控件）的输入控件通常也会显示字段的值供用户修改。 单击"更新"按钮会更新数据源中的记录，而单击"取消"按钮将放弃任何更改。

同样，当控件处于插入模式**InsertItemTemplate**时，数据项中包含的内容。 插入项模板通常定义，以便将"新建"按钮替换为"插入"和"取消"按钮，并显示空输入控件，以便用户输入新记录的值。 单击"插入"按钮会将记录插入数据源中，而单击"取消"按钮将放弃任何更改。

FormView 控件提供分页功能，允许用户导航到数据源中的其他记录。 启用后，在包含页面导航控件的 FormView 控件中将显示寻呼行。 要启用分页，请将**Allow 分页**属性设置为**true**。 您可以通过设置寻呼机样式和寻呼程序设置属性中包含的对象的属性来自定义寻呼机行。 您可以使用**寻呼器模板**属性创建自己的 UI，而不是使用内置寻呼机行 UI。

## <a name="customizing-the-user-interface"></a>自定义用户界面

您可以通过为控件的不同部分设置样式属性来自定义 FormView 控件的外观。 下表列出了不同的样式属性。

| **样式属性** | **说明** |
| --- | --- |
| 编辑行样式 | 当 FormView 控件处于编辑模式时，数据行的样式设置。 |
| 空数据行样式 | 当数据源不包含任何记录时，窗体视图控件中显示的空数据行的样式设置。 |
| 脚法 | FormView 控件的脚行的样式设置。 |
| 标题样式 | FormView 控件的标头行的样式设置。 |
| 插入行样式 | 当 FormView 控件处于插入模式时，数据行的样式设置。 |
| 寻呼机样式 | 启用分页功能时，在 FormView 控件中显示的寻呼机行的样式设置。 |
| 行样式 | 当 FormView 控件处于只读模式时，数据行的样式设置。 |

## <a name="events"></a>事件

FormView 控件提供了多个事件，您可以针对这些事件进行编程。 这允许您在发生事件时运行自定义例程。 下表列出了 FormView 控件支持的事件。

| **事件** | **说明** |
| --- | --- |
| 项目命令 | 单击 FormView 控件中的按钮时发生。 当在控件中单击按钮时，此事件通常用于执行任务。 |
| 项目创建 | 在窗体视图控件中创建所有 FormViewRow 对象后发生。 此事件通常用于在显示记录之前修改记录的值。 |
| 项目已删除 | 单击"删除"按钮（其**CommandName**属性设置为"删除"的按钮），但在 FormView 控件从数据源中删除记录后，将发生这种情况。 此事件通常用于检查删除操作的结果。 |
| 项目删除 | 单击"删除"按钮，但在 FormView 控件从数据源中删除记录之前发生。 此事件通常用于取消删除操作。 |
| 项目已插入 | 单击"插入"按钮（其**CommandName**属性设置为"插入"的按钮），但在 FormView 控件插入记录后，将发生这种情况。 此事件通常用于检查插入操作的结果。 |
| 项目插入 | 单击"插入"按钮，但在 FormView 控件插入记录之前发生。 此事件通常用于取消插入操作。 |
| 项目更新 | 单击"更新"按钮（其**CommandName**属性设置为"更新"的按钮），但在 FormView 控件更新行后，将发生。 此事件通常用于检查更新操作的结果。 |
| 项目更新 | 单击"更新"按钮，但在 FormView 控件更新记录之前发生。 此事件通常用于取消更新操作。 |
| 模式已更改 | 在 FormView 控件更改模式（编辑、插入或只读模式）后发生。 此事件通常用于在 FormView 控件更改模式时执行任务。 |
| 模式更改 | 在 FormView 控件更改模式之前发生（以编辑、插入或只读模式）。 此事件通常用于取消模式更改。 |
| 页面索引已更改 | 单击其中一个寻呼机按钮，但在 FormView 控件处理分页操作后发生。 当用户导航到控件中的不同记录后需要执行任务时，通常使用此事件。 |
| 页面索引更改 | 单击其中一个寻呼机按钮，但在 FormView 控件处理分页操作之前发生。 此事件通常用于取消分页操作。 |

## <a name="detailsview"></a>详细信息查看

"详细信息视图"控件用于显示表中数据源中的单个记录，其中记录的每个字段都显示在表的一行中。 它可以与 GridView 控件结合使用，用于主详细信息方案。 "详细信息视图"控件支持以下功能：

- 绑定到数据源控件，如 SqlDataSource。
- 内置插入功能。
- 内置更新和删除功能。
- 内置寻呼功能。
- 对 DetailsView 对象模型的编程访问，以动态设置属性、处理事件等。
- 通过主题和样式自定义外观。

## <a name="row-fields"></a>行字段

"详细信息视图"控件中的每个数据行都是通过声明字段控件创建的。 不同的行字段类型确定控件中的行的行为。 字段控件派生自数据控制字段。 下表列出了可以使用的不同行字段类型。

| **列字段类型** | **说明** |
| --- | --- |
| BoundField | 将数据源中的字段值显示为文本。 |
| ButtonField | 在"详细信息查看"控件中显示命令按钮。 这允许您显示具有自定义按钮控件（如"添加"或"删除"按钮）的行。 |
| CheckBoxField | 在"详细信息查看"控件中显示复选框。 此行字段类型通常用于显示具有布尔值的字段。 |
| CommandField | 显示内置命令按钮，用于在"详细信息视图"控件中执行编辑、插入或删除操作。 |
| HyperLinkField | 将数据源中的字段值显示为超链接。 此行字段类型允许您将第二个字段绑定到超链接的 URL。 |
| ImageField | 在"详细信息视图"控件中显示图像。 |
| 模板字段 | 根据指定的模板在"详细信息视图"控件中显示行的用户定义内容。 此行字段类型允许您创建自定义行字段。 |

默认情况下，AutoGenerateRows 属性设置为**true**，该属性会自动为数据源中可绑定类型的每个字段生成绑定行字段对象。 有效的可绑定类型是字符串、日期时间、十进制、Guid 和基元类型集。 然后，每个字段以文本形式以每个字段在数据源中显示的顺序显示。

自动生成行提供了一种快速简便的方法来显示记录中的每个字段。 但是，要利用"详细信息视图"控件的高级功能，必须显式声明要包含在"详细信息视图"控件中的行字段。 要声明行字段，首先将**AutoGenerateRows**属性设置为**false**。 接下来，在"详细信息视图"控件的打开和关闭标记之间添加打开和关闭**&lt;字段&gt;** 标记。 最后，列出要在"字段"标记之间包括的行**&lt;字段&gt;**。 指定的行字段按列出的顺序添加到字段集合中。 "**字段**"集合允许您以编程方式管理"详细信息视图"控件中的行字段。

> [!NOTE]
> 自动生成的行字段不会添加到字段集合中。

## <a name="binding-to-data"></a>绑定到数据

详细信息视图控件可以绑定到数据源控件（如**SqlDataSource**或 AccessDataSource）或实现系统的任何数据源。

使用以下方法之一将"详细信息视图"控件绑定到相应的数据源类型：

- 要绑定到数据源控件，请将"详细信息视图"控件的 DataSourceID 属性设置为数据源控件的 ID 值。 "详细信息视图"控件会自动绑定到指定的数据源控件。 这是绑定到数据的首选方法。
- 要绑定到实现**System.集合.IE50ble 接口**的数据源，请以编程方式将"详细信息视图"控件的 DataSource 属性设置为数据源，然后调用 DataBind 方法。

## <a name="security"></a>安全性

此控件可用于显示用户输入，其中可能包括恶意客户端脚本。 在应用程序中显示可执行脚本、SQL 语句或其他代码之前，请检查从客户端发送的任何信息。 ASP.NET提供输入请求验证功能，以阻止用户输入中的脚本和 HTML。

## <a name="data-operations"></a>数据操作

"详细信息视图"控件提供内置功能，允许用户更新、删除、插入和翻阅控件中的项。 当"详细信息视图"控件绑定到数据源控件时，详细信息视图控件可以利用数据源控件的功能并提供自动更新、删除、插入和分页功能。

"详细信息视图"控件可以为与其他类型的数据源的更新、删除、插入和分页操作提供支持;但是，您必须在适当的事件处理程序中为这些操作提供实现。

"详细信息视图"控件可以通过分别将"自动生成编辑按钮"、"自动生成删除按钮"或"自动生成插入按钮"属性设置为**true，** 自动添加具有"编辑"、"删除"或"新建"按钮的**CommandField**行字段。 与"删除"按钮（立即删除所选记录）不同，单击"编辑"或"新建"按钮时，"详细信息视图"控件将分别进入编辑或插入模式。 在编辑模式下，"编辑"按钮将替换为"更新"和"取消"按钮。 适合字段数据类型（如 TextBox 或 CheckBox 控件）的输入控件将显示字段的值，供用户修改。 单击"更新"按钮会更新数据源中的记录，而单击"取消"按钮将放弃任何更改。 同样，在插入模式下，"新建"按钮将替换为"插入"和"取消"按钮，并显示空输入控件，以便用户输入新记录的值。

"详细信息视图"控件提供分页功能，允许用户导航到数据源中的其他记录。 启用后，页面导航控件将显示在寻呼机行中。 要启用分页，请将 Allow 分页属性设置为**true**。 可以使用寻呼机样式和寻呼器设置属性自定义寻呼机行。

## <a name="customizing-the-user-interface"></a>自定义用户界面

您可以通过为控件的不同部分设置样式属性来自定义"详细信息视图"控件的外观。 下表列出了不同的样式属性。

| **样式属性** | **说明** |
| --- | --- |
| 交替行样式 | "详细信息视图"控件中交替数据行的样式设置。 设置此属性时，数据行在 RowStyle 设置和**交替行设置**之间交替显示。 |
| 命令行样式 | 包含"详细信息视图"控件中的内置命令按钮的行的样式设置。 |
| 编辑行样式 | 当"详细信息视图"控件处于编辑模式时，数据行的样式设置。 |
| 空数据行样式 | 当数据源不包含任何记录时，在"详细信息视图"控件中显示的空数据行的样式设置。 |
| 脚法 | "详细信息视图"控件的脚行的样式设置。 |
| 标题样式 | 详细信息视图控件的标头行的样式设置。 |
| 插入行样式 | 当"详细信息视图"控件处于插入模式时，数据行的样式设置。 |
| 寻呼机样式 | "详细信息视图"控件的寻呼机行的样式设置。 |
| 行样式 | 详细信息视图控件中数据行的样式设置。 当还设置**交替罗文样式**属性时，数据行将显示在 **"行样式"** 设置和**交替行设置**之间交替显示。 |
| 字段标题样式 | "详细信息视图"控件的标题列的样式设置。 |

## <a name="events"></a>事件

"详细信息视图"控件提供了多个事件，您可以针对这些事件进行编程。 这允许您在发生事件时运行自定义例程。 下表列出了详细信息视图控件支持的事件。 "详细信息视图"控件还从其基本类继承这些事件：数据绑定、数据绑定、已处置、Init、加载、预渲染和渲染。

| **事件** | **说明** |
| --- | --- |
| 项目命令 | 在"详细信息查看"控件中单击按钮时发生。 |
| 项目创建 | 在"详细信息视图"控件中创建所有详细信息视图行对象后发生。 此事件通常用于在显示记录之前修改记录的值。 |
| 项目已删除 | 单击"删除"按钮，但在"详细信息查看"控件从数据源中删除记录后发生。 此事件通常用于检查删除操作的结果。 |
| 项目删除 | 单击"删除"按钮，但在"详细信息查看"控件从数据源中删除记录之前发生。 此事件通常用于取消删除操作。 |
| 项目已插入 | 单击"插入"按钮，但在"详细信息视图"控件插入记录后发生。 此事件通常用于检查插入操作的结果。 |
| 项目插入 | 单击"插入"按钮，但在"详细信息视图"控件插入记录之前发生。 此事件通常用于取消插入操作。 |
| 项目更新 | 单击"更新"按钮时发生，但在"详细信息查看"控件更新行后发生。 此事件通常用于检查更新操作的结果。 |
| 项目更新 | 单击"更新"按钮，但在"详细信息查看"控件更新记录之前发生。 此事件通常用于取消更新操作。 |
| 模式已更改 | 在"详细信息视图"控件更改模式（编辑、插入或只读模式）后发生。 当"详细信息视图"控件更改模式时，此事件通常用于执行任务。 |
| 模式更改 | 在"详细信息视图"控件更改模式（编辑、插入或只读模式）之前发生。 此事件通常用于取消模式更改。 |
| 页面索引已更改 | 单击其中一个寻呼机按钮，但在"详细信息视图"控件处理分页操作后发生。 当用户导航到控件中的不同记录后需要执行任务时，通常使用此事件。 |
| 页面索引更改 | 单击其中一个寻呼机按钮，但在"详细信息视图"控件处理分页操作之前发生。 此事件通常用于取消分页操作。 |

## <a name="the-menu-control"></a>菜单控件

ASP.NET 2.0 中的菜单控件设计为功能齐全的导航系统。 它可以轻松地将数据绑定到分层数据源（如 SiteMapDataSource）。

菜单控件结构可以声明性或动态定义，由单个根节点和任意数量的子节点组成。 以下代码声明性地定义了菜单控件的菜单。

[!code-aspx[Main](data-bound-controls/samples/sample4.aspx)]

在上面的示例中，Home.aspx 节点是根节点。 所有其他节点都嵌套在不同级别的根节点中。

菜单控件可以呈现两种类型的菜单;静态菜单和动态菜单。 静态菜单由始终可见的菜单项组成。 动态菜单由菜单项组成，这些菜单仅在用户用鼠标悬停在菜单项上时才可见。 客户可能会经常将静态菜单与声明性菜单和动态菜单与运行时数据绑定的菜单混淆。 事实上，动态菜单和静态菜单与总体方法无关。 术语*静态*和*动态*仅指默认情况下菜单是静态显示还是仅在用户执行某些操作时显示。

**StaticDisplayLevels 属性**用于配置菜单的级别是静态的，因此默认情况下显示。 在上面的示例中，将**StaticDisplayLevels**属性设置为值 2 将导致菜单静态显示主节点、音乐节点和影片节点。 当用户悬停在父节点上时，将动态显示所有其他节点。

**"最大动态显示级别"** 属性配置菜单能够显示的最大动态级别数。 任何级别高于**最大动态显示级别**属性指定的值的动态菜单都会被丢弃。

> [!NOTE]
> 几乎可以肯定的是，由于"最大动态显示级别"属性，您可能会遇到菜单未显示的情况。 在这些情况下，请确保属性设置得足够，以便显示客户菜单。

## <a name="data-binding-the-menu-control"></a>数据绑定菜单控件

菜单控件可以绑定到任何分层数据源，如 SiteMapDataSource 或 XMLDataSource。 SiteMapDataSource 是将数据绑定到菜单控件最常用的方法，因为它从 Web.sitemap 文件及其架构中馈送到菜单控件的已知 API。 下面的列表显示了一个简单的 Web.sitemap 文件。

[!code-xml[Main](data-bound-controls/samples/sample5.xml)]

请注意，只有一个根站点MapNode元素，在这种情况下，是 Home 元素。 可以为每个站点 MapNode 配置多个属性。 最常用的属性是：

- **url**指定用户单击菜单项时要显示的 URL。 如果此属性不存在，则节点在单击时将仅重新发布。
- **标题**指定菜单项上显示的文本。
- **描述**用作节点的文档。 当鼠标悬停在节点上时，也会显示为工具提示。
- **站点地图文件**允许嵌套站点地图。 此属性必须指向格式良好的ASP.NET站点地图文件。
- **角色**允许由ASP.NET安全修整控制节点的外观。

请注意，虽然这些属性都是可选的，但如果未指定菜单，则菜单的行为可能不是预期。 例如，如果指定*了 URL*属性，但*描述*属性未指定，则节点将不可见，并且无法导航到指定的 URL。

## <a name="controlling-a-menus-operation"></a>控制菜单操作

有几个属性会影响ASP.NET菜单控件的操作;但是，有几个属性会影响菜单控件的操作。**方向**属性 **、"消失后"** 属性、**静态项目格式字符串**属性和**StaticPopoutImageUrl**属性仅是其中的几个属性。

- "**方向"** 可以设置为*水平*或*垂直*，并控制静态菜单项是水平排列在一行中，还是垂直堆叠在一起。 此属性不会影响动态菜单。
- **"消失后"** 属性配置动态菜单在鼠标移离后应保持可见的时间。 该值以毫秒为单位指定，默认值为 500。 将此属性设置为 -1 的值将导致菜单永远不会自动消失。 在这种情况下，菜单将仅在用户单击菜单外部时消失。
- **StaticItemFormatString**属性使菜单系统中维护一致措辞变得容易。 指定此属性时，*{0}* 应输入代替数据源中显示的说明。 例如，为了让练习 1 中的菜单项"访问我们的产品页面"等，您需要指定"访问我们的{0}页面"以执行静态项目格式字符串。 在运行时，ASP.NET将用菜单项的正确说明{0}替换 的任何匹配项。
- **StaticPopoutImageUrl**属性指定用于指示特定菜单节点具有可以通过悬停在该节点上访问的子节点的图像。 动态菜单将继续使用默认图像。

## <a name="templated-menu-controls"></a>模板化菜单控件

菜单控件是模板化控件，允许两个不同的 ItemTemplate;静态项目模板和动态项目模板。 使用这些模板，您可以轻松地将服务器控件或用户控件添加到菜单中。

要编辑 Visual Studio .NET 中的模板，请单击菜单上的"智能标记"按钮，然后选择"编辑模板"。 然后，您可以选择编辑静态项目模板或动态项目模板。

加载页面时，添加到 StaticItemTemplate 的任何控件都将显示在静态菜单中。 添加到动态项目模板的任何控件都将显示在所有弹出式菜单上。

## <a name="menu-events"></a>菜单事件

"菜单"控件有两个对此独有的事件;**菜单项目已单击**和**菜单项数据绑定**事件。

单击菜单项时，将引发"菜单项目单击"事件。 当菜单项数据绑定时，将引发 MenuItemData绑定事件。 传递到事件处理程序的**MenuEventArgs**通过 Item 属性提供对菜单项的访问。

## <a name="controlling-a-menus-appearance"></a>控制菜单外观

您还可以使用可用于设置菜单格式的许多样式中的一种或多种样式来影响菜单控件的外观。 其中包括**静态菜单样式**、**动态菜单样式**、**动态菜单项样式**、**动态选择样式**和**动态悬停样式**。 这些属性使用标准 HTML 样式字符串进行配置。 例如，以下内容将影响动态菜单的样式。

[!code-aspx[Main](data-bound-controls/samples/sample6.aspx)]

> [!NOTE]
> 如果使用任何悬停样式，则需要在页中&lt;添加头&gt;元素，其中*runat*元素设置为*服务器*。

菜单控件还支持使用ASP.NET 2.0 主题。

## <a name="the-treeview-control"></a>树视图控件

TreeView 控件在树状结构中显示数据。 与菜单控件一样，它可以轻松地绑定到任何分层数据源（如 SiteMapDataSource）的数据。

客户可能会询问ASP.NET 2.0 中的 TreeView 控件的第一个问题是，该控件是否与可用于 ASP.NET 1.x 的 TreeView IE WebControl 相关。 不是。 ASP.NET 2.0 TreeView 控件是从零开始编写的，与之前可用的 IE TreeView WebControl 提供了显著改进。

我不会详细介绍如何将 TreeView 控件绑定到站点地图，因为它的执行方式与"菜单"控件完全相同。 但是，TreeView 控件在操作方式上存在一些明显差异。

默认情况下，TreeView 控件显示为完全展开。 要更改初始加载时的扩展级别，请修改控件的 **"展开深度**"属性。 这在 TreeView 在扩展特定节点时的数据绑定的情况下尤其重要。

## <a name="databinding-the-treeview-control"></a>数据绑定树视图控件

与"菜单"控件不同，TreeView 非常适合处理大量数据。 因此，除了与 SiteMapDataSource 或 XMLDataSource 的数据绑定外，TreeView 通常是绑定到 DataSet 或其他关系数据的数据。 如果 TreeView 控件绑定到大量数据，则最好仅绑定到控件中实际可见的数据。 然后，当 TreeView 节点展开时，可以将数据绑定到其他数据。

在这些情况下，树视图的**填充 OnDemand**属性应设置为*true*。 然后，您需要为**TreeNode 填充**方法提供实现。

## <a name="data-binding-without-postback"></a>数据绑定，无需回邮

请注意，当您首次展开上一个示例中的节点时，页面会重新发布并刷新。 在此示例中，这不是问题，但可以想象它可能位于具有大量数据的生产环境中。 更好的方案是 TreeView 仍将动态填充其节点，但不会回服务器。

通过将 **"填充NodesFromClient"** 和 **"填充OnDemand"** 属性设置为 true，ASP.NET TreeView 控件将动态填充节点，而无需回帖。 扩展父节点时，将从客户端发出 XMLHttp 请求，并触发 OnTreeNode 填充事件。 服务器使用 XML 数据孤岛进行响应，然后用于数据绑定子节点。

ASP.NET动态创建实现此功能的客户端代码。 包含&lt;脚本&gt;的脚本标记将生成指向 AXD 文件。 例如，下面的列表显示了生成 XMLHttp 请求的脚本代码的脚本链接。

[!code-html[Main](data-bound-controls/samples/sample7.html)]

如果您在浏览器中浏览上面的 AXD 文件并打开该文件，您将看到实现 XMLHttp 请求的代码。 此方法可防止客户修改脚本文件。

## <a name="controlling-the-operation-of-the-treeview-control"></a>控制树视图控件的操作

TreeView 控件具有影响控件操作的几个属性。 最明显的属性是 **"显示检查框****"、"显示展开折叠"** 和"**显示线**"。

**"ShowCheckBox"** 属性会影响节点在渲染时是否显示复选框。 此属性的有效值为 **"无**"、"**根**"、"**父**"、"**叶**"和"**全部**"。 这些影响树视图控件如下所示：

| **属性值** | **效果** |
| --- | --- |
| 无 | 复选框不显示在任何节点上。 这是默认设置。 |
| Root | 复选框仅显示在根节点上。 |
| Parent | 复选框仅显示在具有子节点的节点上。 这些子节点可以是父节点或叶节点。 |
| 叶 | 复选框仅显示在没有子节点的节点上。 |
| 全部 | 所有节点上都显示一个复选框。 |

使用复选框时 **，"CheckNodes"** 属性将返回在回邮时检查的 TreeView 节点的集合。

**ShowExpandCollapse**属性控制根节点和父节点旁边的展开/折叠图像的外观。 如果此属性设置为**false，** 则 TreeView 节点将呈现为超链接，并通过单击链接展开/折叠。

**ShowLines**属性控制是否显示将父节点连接到子节点的线路。 当**false（** 默认值）时，不显示任何行。 **当为 true**时，TreeView 控件将使用**LineImageFolder**属性指定的文件夹中的线图像。

要自定义 TreeView 线条的外观，Visual Studio .NET 2005 包括一个线设计器工具。 您可以使用"树视图"控件上的"智能标记"按钮访问此工具，如下所示。

![](data-bound-controls/_static/image1.jpg)

**图 1**

选择 **"自定义线图像"** 菜单选项时，将启动"线设计器"工具，以允许您配置 TreeView 线的外观。

## <a name="treeview-events"></a>树视图事件

TreeView 控件具有以下唯一事件：

- 当根据 **"选择操作"** 属性选择节点时，将发生"选择节点更改"。
- 更改节点复选框状态时，将发生树节点检查更改。
- 当节点基于**SelectAction**属性展开时，将发生树节点扩展。
- 当节点折叠时，树节点折叠发生。
- 当节点被数据绑定时，就会发生树节点数据绑定。
- 填充节点时发生树节点填充。

**SelectAction**属性允许您配置选择节点时触发的事件。 SelectAction 属性提供以下操作：

- 树节点选择操作.在选择节点时展开引发树节点展开。
- 树节点选择操作.当节点被选中时，不引发任何事件。
- 树节点选择操作.选择在选择节点时引发"选定节点更改"事件。
- 树节点选择操作.选择展开在选择节点时同时引发"选定节点更改"事件和树节点展开事件。

## <a name="controlling-appearance-with-styles"></a>使用样式控制外观

TreeView 控件提供了许多属性，用于使用样式控制控件的外观。 以下属性可用。

| **属性名称** | **控件** |
| --- | --- |
| 悬停节点样式 | 当鼠标悬停在节点上时，控制节点的样式。 |
| 叶节点样式 | 控制叶节点的样式。 |
| 节点样式 | 控制所有节点的样式。 特定节点样式（如 LeafNodeStyle）覆盖此样式。 |
| 父节点样式 | 控制所有父节点的样式。 |
| 根节点样式 | 控制根节点的样式。 |
| 选定的节点样式 | 控制所选节点的样式。 |

每个属性都是只读的。 但是，它们各自将返回一个**TreeNodeStyle**对象，并且可以使用*属性子属性*格式修改该对象的属性。 例如，要设置 **"选定NodeStyle"** 的**ForeColor**属性，请使用以下语法：

[!code-aspx[Main](data-bound-controls/samples/sample8.aspx)]

请注意，上面的标记未关闭。 这是因为，当使用此处显示的声明性语法时，您也会在 HTML 代码中包括 TreeViews 节点。

样式属性也可以使用*属性.subproperty*格式在代码中指定。 例如，要在代码中设置**RootNodeStyle**的**ForeColor**属性，请使用以下语法：

[!code-csharp[Main](data-bound-controls/samples/sample9.cs)]

> [!NOTE]
> 有关不同样式属性的完整列表，请参阅 TreeNodeStyle 对象上的 MSDN 文档。

## <a name="the-sitemappath-control"></a>站点地图路径控件

SiteMapPath 控件为ASP.NET开发人员提供了面包屑导航控件。 与其他导航控件一样，它可以轻松地绑定到分层数据源（如 SiteMapDataSource 或 XmlDataSource）的数据。

站点地图路径控件由站点映射节点项目对象组成。 有三种类型的节点;根节点、父节点和当前节点。 根节点是层次结构顶部的节点。 当前节点表示当前页面。 所有其他节点都是父节点。

## <a name="controlling-the-operation-of-the-sitemappath-control"></a>控制站点地图路径控件的操作

控制站点地图路径控件操作的属性如下所示：

| **属性** | **财产描述** |
| --- | --- |
| 显示父级 | 控制显示的父节点数。 默认值为 -1，它对显示的父节点数没有限制。 |
| 路径方向 | 控制站点地图路径的方向。 有效值为"根到当前"（默认）和"当前到根"。 |
| 路径分离器 | 控制分隔站点地图路径控件中节点的字符的字符串。 默认值为 ：。 |
| 渲染电流节点链接 | 控制当前节点是否呈现为链接的布尔值。 默认值为 False。 |
| 跳过链接文本 | 当屏幕阅读器查看页面时，有助于辅助访问。 此属性允许屏幕阅读器跳过站点地图路径控件。 要禁用此功能，请将属性设置为 String.Empty。 |

## <a name="templated-sitemappath-controls"></a>模板化站点地图路径控件

SiteMapControl 是一个模板化控件，因此，您可以定义不同的模板以用于显示控件。 要编辑 SiteMapPath 控件中的模板，请单击控件上的"智能标记"按钮，并从菜单中选择"编辑模板"。 这将显示 SiteMapTasks 菜单，如下所示，您可以在其中选择可用的不同模板。

![](data-bound-controls/_static/image2.jpg)

**图 2**

**节点模板**引用站点地图路径中的任何节点。 如果节点是根节点或当前节点，并且配置了**RootNodeTemplate**或**CurrentNodeTemplate，** 则节点模板将被覆盖。

## <a name="sitemappath-events"></a>站点地图路径事件

SiteMapPath 控件有两个不是从控件类派生的事件;另一个事件不是从控件类派生的。**项目创建**事件和**项目数据绑定**事件。 创建站点地图路径项时，将引发"项目创建"事件。 在 SiteMapPath 节点的数据绑定期间调用 DataBind 方法时，将引发 ItemDataBound。 **站点映射NodeItemEventArgs**对象通过 Item 属性提供对特定站点MapNodeItem的访问。

## <a name="controlling-appearance-with-styles"></a>使用样式控制外观

以下样式可用于设置站点地图路径控件的格式。

| **属性名称** | **控件** |
| --- | --- |
| 当前节点样式 | 控制当前节点的文本样式。 |
| 根节点样式 | 控制根节点的文本样式。 |
| 节点样式 | 控制所有节点的文本样式，前提是当前NodeStyle 或 RootNodeStyle 不适用。 |

NodeStyle 属性被当前节点样式或 RootNodeStyle 覆盖。 每个属性都是只读的，并返回一个**Style**对象。 要使用这些属性之一影响节点的外观，您需要设置返回的 Style 对象的属性。 例如，下面的代码更改当前节点的前色属性。

[!code-aspx[Main](data-bound-controls/samples/sample10.aspx)]

也可以按照如下方式以编程方式应用该属性：

[!code-csharp[Main](data-bound-controls/samples/sample11.cs)]

> [!NOTE]
> 如果应用模板，将不会应用该样式。

## <a name="lab-1-configuring-an-aspnet-menu-control"></a>实验 1：配置ASP.NET菜单控件

1. 创建新网站。
2. 通过从文件模板列表中选择"文件、新建、文件和选择站点映射"来添加站点映射文件。
3. 打开站点地图（默认情况下为 Web.sitemap），并对其进行修改，使其看起来像下面的列表。 在站点地图文件中链接到的页面实际上不存在，但这不是本练习的问题。

    [!code-xml[Main](data-bound-controls/samples/sample12.xml)]
4. 在"设计"视图中打开默认 Web 窗体。
5. 从工具箱的导航部分，向页面添加新的"菜单"控件。
6. 从工具箱的数据部分，添加新的 SiteMapDataSource。 SiteMapDataSource 将自动使用站点中的 Web.sitemap 文件。 （Web.sitemap 文件*必须*位于站点的根文件夹中。
7. 单击"菜单"控件，然后单击"智能标记"按钮以显示"菜单任务"对话框。
8. 在"选择数据源"下拉下拉列表，选择 SiteMapDataSource1。
9. 单击"自动格式"链接并选择菜单的格式。
10. 在"属性"窗格中，将 **"静态显示级别"** 属性设置为 2。 "菜单"控件现在应在设计器中显示"主页"、"产品和服务"节点。
11. 浏览浏览器中的页面以使用菜单。 （由于添加到站点地图的页面实际上不存在，因此当您尝试浏览这些页面时，您将看到错误。

尝试更改静态显示级别和最大动态显示级别属性，并了解它们如何影响菜单的呈现方式。

## <a name="lab-2-dynamically-binding-a-treeview-control"></a>实验 2：动态绑定树视图控件

本练习假定 SQL Server 在本地运行，并且北风数据库存在于 SQL Server 实例上。 如果未满足这些条件，请更改示例中的连接字符串。 请注意，您可能还需要指定 SQL Server 身份验证，而不是受信任的连接。

1. 创建新网站。
2. 切换到 Default.aspx 的代码视图，并将所有代码替换为下面列出的代码。 

    [!code-aspx[Main](data-bound-controls/samples/sample13.aspx)]
3. 将页面另存为树视图.aspx。
4. 浏览页面。
5. 首次显示页面时，在浏览器中查看页面源。 请注意，只有可见节点发送到客户端。
6. 单击任何节点旁边的加号。
7. 再次查看页面上的源。 请注意，新显示的节点现在存在。

## <a name="lab-3-details-view-and-editing-data-using-a-gridview-and-detailsview"></a>实验 3：使用网格视图和详细信息查看查看和编辑数据的详细信息

1. 创建新网站。
2. 向网站添加新的 Web.config。
3. 将连接字符串添加到 Web.config 文件，如下所示： 

    [!code-xml[Main](data-bound-controls/samples/sample14.xml)]

    > [!NOTE]
    > 您可能需要根据环境更改连接字符串。
4. 保存并关闭 web.config 文件。
5. 打开 Default.aspx 并添加新的 SqlDataSource 控件。
6. 将 SqlDataSource 控件的 ID 更改为**产品**。
7. 在**SqlDataSource 任务**菜单中，单击 **"配置数据源**"。
8. 在连接下拉列表中选择 **"北风**"，然后单击"下一步"。
9. 从 **"名称**"下拉列表中选择**产品**，然后选中 **"产品 ID、****产品名称**、**单价**"和 **"单位库存**"复选框，如下所示。 

![](data-bound-controls/_static/image3.jpg)

    **Figure 3**
10. 单击“下一步”。 
11. 单击“完成”  。
12. 切换到"源"视图并检查生成的代码。 请注意添加到 SqlDataSource 控件的**Select命令**、**删除命令**、**插入命令**和**更新命令**。 另请注意添加的参数。
13. 切换到"设计"视图，并将新的 GridView 控件添加到页面。
14. 从 **"选择数据源**"下拉列表中选择**产品**。
15. 选中**启用分页**和**启用选择**，如下所示。 

![](data-bound-controls/_static/image4.jpg)

    **Figure 4**
16. 单击 **"编辑列"** 链接，并确保选中**自动生成字段**。
17. 单击 **“确定”** 。
18. 选择 GridView 控件后，单击"属性"窗格中的**DataKeyNames**属性旁边的按钮。
19. 从 **"可用数据字段**"列表中选择**&gt;****"产品 ID"，** 然后单击该按钮进行添加。
20. 单击“确定”。
21. 向页面添加新的 SqlDataSource 控件。
22. 将 SqlDataSource 控件的 ID 更改为**详细信息**。
23. 在 SqlDataSource 任务菜单中，选择 **"配置数据源**"。
24. 从下拉列表中选择**北风**，然后单击 **"下一步**"。
25. 从<strong>"名称</strong>"下拉列表中选择<strong>\<<strong>"产品</strong>"，然后选中<strong>"列</strong>列表"框中的/强>* 复选框。
26. 单击 **"WHERE"** 按钮。
27. 从 **"列**"下拉列表中选择**产品 ID。**
28. 在**=**"操作员下拉列表"中选择。
29. 从 **"源**"下拉列表中选择 **"控件**"。
30. 从**控制 ID**下拉列表中选择**GridView1。**
31. 单击"**添加**"按钮以添加 WHERE 子句。
32. 单击 **“确定”** 。
33. 单击 **"高级"** 按钮，然后选中 **"生成插入"、"更新"和"删除语句"** 复选框。
34. 单击 **“确定”** 。
35. 单击 **"下一步**"，然后单击 **"完成**"。
36. 向页面添加"详细信息查看"控件。
37. 在 **"选择数据源**"下拉下拉列表，选择 **"详细信息**"。
38. 选中"**启用编辑**"复选框，如下所示。 

![](data-bound-controls/_static/image1.gif)

    **Figure 5**
39. 保存页面并浏览默认.aspx。
40. 单击不同记录旁边的 **"选择**"链接，自动查看"详细信息查看"更新。
41. 单击"详细信息查看"控件中的 **"编辑**"链接。
42. 更改记录，然后单击 **"更新**"。
