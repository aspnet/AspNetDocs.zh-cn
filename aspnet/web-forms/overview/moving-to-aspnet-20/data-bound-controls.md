---
uid: web-forms/overview/moving-to-aspnet-20/data-bound-controls
title: 数据绑定控件 |Microsoft Docs
author: microsoft
description: 大多数 ASP.NET 应用程序依赖于后端数据源的某种程度的数据呈现。 数据绑定控件是交互 w ... 的 pivotal 部分
ms.author: riande
ms.date: 02/20/2005
ms.assetid: 0e23ff32-646d-43f3-8bec-6b2313d3abd6
msc.legacyurl: /web-forms/overview/moving-to-aspnet-20/data-bound-controls
msc.type: authoredcontent
ms.openlocfilehash: 1154b38e0fa3d9d56cb407ae659c3b0d69871fda
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/06/2020
ms.locfileid: "78488870"
---
# <a name="data-bound-controls"></a>数据绑定控件

由[Microsoft](https://github.com/microsoft)

> 大多数 ASP.NET 应用程序依赖于后端数据源的某种程度的数据呈现。 数据绑定控件是在动态 Web 应用程序中与数据进行交互的 pivotal 部分。 ASP.NET 2.0 引入了对数据绑定控件的一些重大改进，包括新的 BaseDataBoundControl 类和声明性语法。

大多数 ASP.NET 应用程序依赖于后端数据源的某种程度的数据呈现。 数据绑定控件是在动态 Web 应用程序中与数据进行交互的 pivotal 部分。 ASP.NET 2.0 引入了对数据绑定控件的一些重大改进，包括新的 BaseDataBoundControl 类和声明性语法。

BaseDataBoundControl 充当 DataBoundControl 类和 HierarchicalDataBoundControl 类的基类。 在此模块中，我们将讨论从 DataBoundControl 派生的以下类：

- AdRotator
- 列表控件
- GridView
- FormView
- DetailsView

我们还将讨论派生自 HierarchicalDataBoundControl 类的以下类：

- TreeView
- 菜单
- SiteMapPath

## <a name="databoundcontrol-class"></a>DataBoundControl 类

DataBoundControl 类是用于与表格或列表样式数据进行交互的抽象类（在 VB 中标记为 MustInherit）。 以下控件是派生自 DataBoundControl 的一些控件。

## <a name="adrotator"></a>AdRotator

使用 AdRotator 控件可以在链接到特定 URL 的网页上显示图形横幅。 使用控件的属性旋转显示的图形。 可以使用 "**印记**" 属性配置页面上特定广告显示的频率，可以使用关键字筛选来筛选广告。

AdRotator 控件使用 XML 文件或数据库中的表来表示数据。 在 XML 文件中使用以下属性来配置 AdRotator 控件。

### <a name="imageurl"></a>ImageUrl
要为广告显示的图像的 URL。

### <a name="navigateurl"></a>NavigateUrl
单击广告时应将用户转到的 URL。 应进行 URL 编码。

### <a name="alternatetext"></a>AlternateText
在工具提示中显示并由屏幕阅读器读取的替换文字。 当 ImageUrl 指定的图像不可用时，还会显示。

### <a name="keyword"></a>关键字
定义使用关键字筛选时可以使用的关键字。 如果指定，则只显示关键字与关键字筛选器匹配的广告。

### <a name="impressions"></a>形成
一个权重号，确定特定广告可能出现的频率。 它相对于同一文件中其他广告的印象。 XML 文件中所有广告的集体印象的最大值为 2048000000 1。

### <a name="height"></a>高度
广告的高度（以像素为单位）。

### <a name="width"></a>宽度
广告的宽度（以像素为单位）。

> [!NOTE]
> Height 和 Width 属性覆盖 AdRotator 控件本身的高度和宽度。

典型的 XML 文件可能如下所示：

[!code-xml[Main](data-bound-controls/samples/sample1.xml)]

在上面的示例中，Contoso 的广告为 ASP.NET 网站的广告提供的两倍，因为该属性的值为。

若要显示上述 XML 文件中的广告，请将 AdRotator 控件添加到页面，并将**AdvertisementFile**属性设置为指向该 xml 文件，如下所示：

[!code-aspx[Main](data-bound-controls/samples/sample2.aspx)]

如果选择使用数据库表作为 AdRotator 控件的数据源，则首先需要使用以下架构设置数据库：

| **列名** | **Data type** | **描述** |
| --- | --- | --- |
| Id | int | 主密钥。 此列可以包含任何名称。 |
| ImageUrl | nvarchar （*长度*） | 要为广告显示的图像的相对或绝对 URL。 |
| NavigateUrl | nvarchar （*长度*） | 广告的目标 URL。 如果未提供值，则广告不是超链接。 |
| AlternateText | nvarchar （*长度*） | 当找不到图像时显示的文本。 在某些浏览器中，文本显示为工具提示。 替代文本还可用于辅助功能，以便无法看到图形的用户可以听到大声朗读的说明。 |
| 关键字 | nvarchar （*长度*） | 可在其中筛选页面的广告的类别。 |
| 形成 | int(4) | 指示广告显示频率的数字。 数字越大，显示广告的频率就越多。 XML 文件中所有印记值的总和不得超过 2048000000-1。 |
| 宽度 | int(4) | 图像的宽度（以像素为单位）。 |
| 高度 | int(4) | 图像的高度（以像素为单位）。 |

如果你已有一个具有不同架构的数据库，则可以使用**AlternateTextField**、 **ImageUrlField**和**NavigateUrlField**属性将 AdRotator 特性映射到现有数据库。 若要在 AdRotator 控件中显示数据库中的数据，请向页面中添加一个数据源控件，将数据源控件的连接字符串配置为指向您的数据库，并将 AdRotator 控件的**DataSourceID**属性设置为数据源控件的 ID。 如果需要以编程方式配置 AdRotator 广告，请使用 AdCreated 事件。 AdCreated 事件采用两个参数;一个对象，另一个是 AdCreatedEventArgs 的实例。 AdCreatedEventArgs 是对正在创建的广告的引用。

以下代码片段以编程方式为 ad 设置 ImageUrl、NavigateUrl 和 AlternateText：

[!code-csharp[Main](data-bound-controls/samples/sample3.cs)]

## <a name="list-controls"></a>列表控件

列表控件包括 ListBox、DropDownList、CheckBoxList、RadioButtonList 和 BulletedList。 其中每个控件都可以是绑定到数据源的数据。 它们使用数据源中的一个字段作为显示文本，并且可以选择使用第二个字段作为项的值。 还可以在设计时静态地添加项，并可以混合从数据源添加的静态项和动态项。

若要将列表控件绑定到数据，请将数据源控件添加到该页。 为数据源控件指定选择命令，然后将列表控件的 DataSourceID 属性设置为数据源控件的 ID。 使用**DataTextField**和**DataValueField**属性定义控件的显示文本和值。 此外，还可以使用**DataTextFormatString**属性来控制显示文本的外观，如下所示：

| **表达式** | **描述** |
| --- | --- |
| 价格： {0:C} | 对于数字/小数数据。 显示文本 "Price："，后跟以货币格式表示的数字。 货币格式取决于在**Page**指令或 web.config 文件中的 culture 特性中指定的区域性设置。 |
| {0:D4} | 对于整数数据。 不能与十进制数一起使用。 整数显示在宽度为4个字符的零填充字段中。 |
| {0:N2}% | 用于数值数据。 显示数字，其后跟文本 "%"。 |
| {0:000.0} | 对于数字/小数数据。 数字舍入为一个小数位。 不到三位的数字用零填充。 |
| {0:D} | 对于日期/时间数据。 显示长日期格式（"星期四，6月6日，1996"）。 日期格式取决于页面或 Web.config 文件的区域性设置。 |
| {0:d} | 对于日期/时间数据。 显示短日期格式（"12/31/99"）。 |
| {0:yy-MM-dd} | 对于日期/时间数据。 按数字年-月-日格式显示日期（96-08-06） |

## <a name="gridview"></a>GridView

GridView 控件允许使用声明性方法显示和编辑表格数据，并且是 DataGrid 控件的后继控件。 以下功能在 GridView 控件中可用。

- 绑定到数据源控件，如 SqlDataSource。
- 内置的排序功能。
- 内置的更新和删除功能。
- 内置的分页功能。
- 内置行选择功能。
- 以编程方式访问 GridView 对象模型，以动态设置属性、处理事件等。
- 多个键字段。
- 超链接列的多个数据字段。
- 通过主题和样式自定义外观。

**列字段**

GridView 控件中的每一列都由一个 DataControlField 对象表示。 默认情况下，AutoGenerateColumns 属性设置为**true**，这将为数据源中的每个字段创建 AutoGeneratedField 对象。 然后，每个字段都按每个字段在数据源中出现的顺序呈现为 GridView 控件中的一列。 还可以通过将 " **AutoGenerateColumns** " 属性设置为 " **false** "，然后定义自己的列字段集合，手动控制在**GridView**控件中显示的列字段。 不同的列字段类型确定控件中列的行为。

下表列出了可以使用的不同列字段类型。

| **列字段类型** | **描述** |
| --- | --- |
| BoundField | 显示数据源中的字段的值。 这是 GridView 控件的默认列类型。 |
| ButtonField | 显示 GridView 控件中每个项的命令按钮。 这允许您创建自定义按钮控件的列，如 "添加" 或 "移除" 按钮。 |
| CheckBoxField | 显示 GridView 控件中每个项的复选框。 此列字段类型通常用于显示具有布尔值的字段。 |
| CommandField | 显示预定义的命令按钮，以执行选择、编辑或删除操作。 |
| HyperLinkField | 将数据源中的字段值显示为超链接。 通过此列字段类型，可以将第二个字段绑定到超链接的 URL。 |
| ImageField | 显示 GridView 控件中每个项的图像。 |
| TemplateField | 根据指定的模板，显示 GridView 控件中每个项的用户定义内容。 此列字段类型允许您创建自定义列字段。 |

若要以声明方式定义列字段集合，请首先在 GridView 控件的开始标记和结束标记之间添加开始和结束 **&lt;列&gt;** 标记。 接下来，列出要在开始和结束 **&lt;列&gt;** 标记之间包括的列字段。 指定的列将按所列顺序添加到 Columns 集合中。 **Columns**集合存储控件中的所有列字段，并允许你以编程方式管理 GridView 控件中的列字段。

显式声明的列字段可与自动生成的列字段一起显示。 如果同时使用这两个列，则将首先呈现显式声明的列字段，后跟自动生成的列字段。

## <a name="binding-to-data"></a>绑定到数据

GridView 控件可以绑定到数据源控件（如 SqlDataSource、 **ObjectDataSource**等），以及任何实现了接口的数据源（例如，system.web、node.js、或 system.web..........）。 使用以下方法之一将 GridView 控件绑定到相应的数据源类型：

- 若要绑定到数据源控件，请将 GridView 控件的 DataSourceID 属性设置为数据源控件的 ID 值。 GridView 控件将自动绑定到指定的数据源控件，并可以利用数据源控件的功能执行排序、更新、删除和分页功能。 这是绑定到数据的首选方法。
- 若要绑定到实现 System.web 接口的数据源，请以编程方式将 GridView 控件的 DataSource 属性设置为数据源，然后调用 DataBind 方法。 使用此方法时，GridView 控件不提供内置排序、更新、删除和分页功能。 你需要自行提供此功能。

## <a name="data-operations"></a>数据操作

GridView 控件提供了许多内置功能，使用户可以对控件中的项进行排序、更新、删除、选择和分页。 当 GridView 控件绑定到数据源控件时，GridView 控件可以利用数据源控件的功能，并提供自动排序、更新和删除功能。

> [!NOTE]
> GridView 控件可以提供对其他类型的数据源的排序、更新和删除的支持;但是，你将需要为这些操作的实现提供相应的事件处理程序。

排序允许用户通过单击列的标题，对 GridView 控件中的项进行排序。 若要启用排序，请将 AllowSorting 属性设置为**true**。

单击 " **ButtonField** " 或 " **TemplateField** " 列字段中的按钮时，将启用自动更新、删除和选择功能，分别为命令名称为 "编辑"、"删除" 和 "选择"。 如果 "AutoGenerateEditButton"、"AutoGenerateDeleteButton" 或 "AutoGenerateSelectButton" 属性分别设置为 " **true**"，则 GridView 控件可以使用 "编辑"、"删除" 或 "选择" 按钮自动添加**CommandField**列字段。

> [!NOTE]
> GridView 控件不直接支持将记录插入到数据源中。 但是，也可以通过将 GridView 控件与 DetailsView 或 FormView 控件结合使用来插入记录。

GridView 控件可以自动将记录拆分为多个页面，而不是同时在数据源中显示所有记录。 若要启用分页，请将 AllowPaging 属性设置为**true**。

## <a name="customizing-the-user-interface"></a>自定义用户界面

您可以通过设置控件的不同部分的样式属性来自定义 GridView 控件的外观。 下表列出了不同的样式属性。

| **Style 属性** | **描述** |
| --- | --- |
| AlternatingRowStyle | GridView 控件中的交替数据行的样式设置。 设置此属性时，数据行将在 RowStyle 设置和**AlternatingRowStyle**设置之间交替显示。 |
| EditRowStyle | GridView 控件中正在编辑的行的样式设置。 |
| EmptyDataRowStyle | 当数据源不包含任何记录时，在 GridView 控件中显示的空数据行的样式设置。 |
| FooterStyle | GridView 控件的脚注行的样式设置。 |
| HeaderStyle | GridView 控件的标题行的样式设置。 |
| PagerStyle | GridView 控件的页导航行的样式设置。 |
| RowStyle | GridView 控件中的数据行的样式设置。 如果同时设置了**AlternatingRowStyle**属性，则会在 " **RowStyle** " 设置和 " **AlternatingRowStyle** " 设置之间交替显示数据行。 |
| SelectedRowStyle | GridView 控件中选定行的样式设置。 |

还可以显示或隐藏控件的不同部分。 下表列出了属性，这些属性控制要显示或隐藏的部分。

| **Property** | **描述** |
| --- | --- |
| ShowFooter | 显示或隐藏 GridView 控件的页脚部分。 |
| ShowHeader | 显示或隐藏 GridView 控件的标头部分。 |

### <a name="events"></a>事件

GridView 控件提供了几个可对其进行编程的事件。 这使您可以在每次发生事件时运行自定义例程。 下表列出了 GridView 控件支持的事件。

| **Event** | **描述** |
| --- | --- |
| PageIndexChanged | 在单击某一页导航按钮时，但在 GridView 控件处理分页操作后发生。 当用户导航到控件中的其他页面后，如果需要执行某个任务，通常会使用此事件。 |
| PageIndexChanging | 在单击某一页导航按钮时，但在 GridView 控件处理分页操作之前发生。 此事件通常用于取消分页操作。 |
| RowCancelingEdit | 在单击某一行的 "取消" 按钮时，但在 GridView 控件退出编辑模式之前发生。 此事件通常用于停止取消操作。 |
| RowCommand | 在 GridView 控件中单击按钮时发生。 此事件通常用于在控件中单击按钮时执行任务。 |
| RowCreated | 在 GridView 控件中创建新行时发生。 此事件通常用于在创建行时修改行的内容。 |
| RowDataBound | 当数据行绑定到 GridView 控件中的数据时发生。 当行绑定到数据时，此事件通常用于修改行的内容。 |
| RowDeleted | 在单击某一行的 "删除" 按钮时，但在 GridView 控件从数据源中删除该记录之后发生。 此事件通常用于检查删除操作的结果。 |
| RowDeleting | 在单击某一行的 "删除" 按钮时，但在 GridView 控件从数据源中删除该记录之前发生。 此事件通常用于取消删除操作。 |
| RowEditing | 在单击某一行的 "编辑" 按钮时，但在 GridView 控件进入编辑模式之前发生。 此事件通常用于取消编辑操作。 |
| RowUpdated | 在单击某一行的 "更新" 按钮时，但在 GridView 控件更新行后发生。 此事件通常用于检查更新操作的结果。 |
| RowUpdating | 在单击某一行的 "更新" 按钮时，但在 GridView 控件更新行之前发生。 此事件通常用于取消更新操作。 |
| SelectedIndexChanged | 在单击某一行的 "选择" 按钮时，但在 GridView 控件处理选择操作之后发生。 此事件通常用于在控件中选择行后执行任务。 |
| SelectedIndexChanging | 在单击某一行的 "选择" 按钮时，但在 GridView 控件处理选择操作之前发生。 此事件通常用于取消选择操作。 |
| 排序 | 当单击用于列排序的超链接时，但在 GridView 控件处理排序操作后发生。 此事件通常用于在用户单击用于对列进行排序的超链接后执行任务。 |
| 排序 | 当单击用于列排序的超链接时，但在 GridView 控件处理排序操作之前发生。 此事件通常用于取消排序操作或执行自定义的排序例程。 |

## <a name="formview"></a>FormView

FormView 控件用于显示数据源中的单个记录。 它类似于 DetailsView 控件，只不过它显示用户定义的模板而不是行字段。 创建自己的模板使你可以更灵活地控制数据的显示方式。 FormView 控件支持以下功能：

- 绑定到数据源控件，如 SqlDataSource 和 ObjectDataSource。
- 内置插入功能。
- 内置的更新和删除功能。
- 内置的分页功能。
- 以编程方式访问 FormView 对象模型，以动态设置属性、处理事件等。
- 通过用户定义的模板、主题和样式可自定义外观。

## <a name="templates"></a>模板

要使 FormView 控件显示内容，需要为控件的不同部分创建模板。 大多数模板是可选的;但是，您必须为在其中配置控件的模式创建模板。 例如，支持插入记录的 FormView 控件必须定义插入项模板。 下表列出了你可以创建的不同模板。

| **模板类型** | **描述** |
| --- | --- |
| EditItemTemplate | 定义在 FormView 控件处于编辑模式时数据行的内容。 此模板通常包含输入控件和命令按钮，用户可以使用这些按钮编辑现有记录。 |
| EmptyDataTemplate | 定义在将 FormView 控件绑定到不包含任何记录的数据源时所显示的空数据行的内容。 此模板通常包含用于向用户发出警报，指出数据源不包含任何记录的内容。 |
| FooterTemplate | 定义脚注行的内容。 此模板通常包含希望在页脚行中显示的任何其他内容。 作为替代方法，您可以通过设置 FooterText 属性来指定要在脚注行中显示的文本。 |
| HeaderTemplate | 定义标题行的内容。 此模板通常包含你希望在标题行中显示的任何其他内容。 作为替代方法，您可以通过设置 HeaderText 属性来指定要在标题行中显示的文本。 |
| ItemTemplate | 定义在 FormView 控件处于只读模式时数据行的内容。 此模板通常包含用于显示现有记录的值的内容。 |
| InsertItemTemplate | 定义数据行的内容（当 FormView 控件处于插入模式时）。 此模板通常包含用户可用于添加新记录的输入控件和命令按钮。 |
| PagerTemplate | 定义当分页功能处于启用状态时显示的页导航行的内容（当 AllowPaging 属性设置为**true**时）。 此模板通常包含用户可在其中导航到另一记录的控件。 |

编辑项模板和插入项模板中的输入控件可以通过使用双向绑定表达式绑定到数据源的字段。 这允许 FormView 控件自动提取输入控件的值以进行更新或插入操作。 双向绑定表达式还允许编辑项模板中的输入控件自动显示原始字段值。

### <a name="binding-to-data"></a>绑定到数据

FormView 控件可以绑定到数据源控件（如**SqlDataSource**、AccessDataSource、 **ObjectDataSource**等），也可以绑定到任何实现了接口的数据源（例如，、和 system.object）的任何数据源中的数据源。 使用以下方法之一将 FormView 控件绑定到相应的数据源类型：

- 若要绑定到数据源控件，请将 FormView 控件的 DataSourceID 属性设置为数据源控件的 ID 值。 FormView 控件会自动绑定到指定的数据源控件，并可以利用数据源控件的功能执行插入、更新、删除和分页功能。 这是绑定到数据的首选方法。
- 若要绑定到实现**system.web**接口的数据源，请以编程方式将 FormView 控件的 DataSource 属性设置为数据源，然后调用 DataBind 方法。 使用此方法时，FormView 控件不提供内置的插入、更新、删除和分页功能。 需要使用相应的事件来提供此功能。

## <a name="data-operations"></a>数据操作

FormView 控件提供了许多内置功能，使用户可以对控件中的项进行更新、删除、插入和分页。 当 FormView 控件绑定到数据源控件时，FormView 控件可以利用数据源控件的功能，并提供自动更新、删除、插入和分页功能。 FormView 控件可为与其他类型的数据源的更新、删除、插入和分页操作提供支持;但是，必须为这些操作的实现提供相应的事件处理程序。

由于 FormView 控件使用模板，因此它不提供自动生成命令按钮以执行更新、删除或插入操作的方法。 您必须在适当的模板中手动包含这些命令按钮。 FormView 控件识别某些按钮，这些按钮的**CommandName**属性设置为特定值。 下表列出了 FormView 控件识别的命令按钮。

| **Button** | **Commandname 值** | **描述** |
| --- | --- | --- |
| 取消 | 退出 | 在更新或插入操作中用于取消操作并丢弃用户输入的值。 然后，FormView 控件返回到 DefaultMode 属性指定的模式。 |
| 删除 | “Delete” | 用于删除操作以从数据源中删除所显示的记录。 引发 ItemDeleting 和 ItemDeleted 事件。 |
| 编辑 | 编辑 | 用于更新操作以将 FormView 控件置于编辑模式。 为数据行显示在**EditItemTemplate**属性中指定的内容。 |
| Insert | & | 在插入操作中用于尝试使用用户提供的值在数据源中插入新记录。 引发 ItemInserting 和 ItemInserted 事件。 |
| 新的 | 新西兰 | 在插入操作中用于将 FormView 控件置于插入模式中。 为数据行显示在**则**属性中指定的内容。 |
| 页面 | 分页 | 用于在分页操作中表示执行分页的页导航行中的按钮。 若要指定分页操作，请将该按钮的**CommandArgument**属性设置为 "下一步"、"上一步"、"First"、"Last" 或要导航到的页面的索引。 引发 PageIndexChanging 和 PageIndexChanged 事件。 |
| 更新 | 时更新 | 用于更新操作，尝试使用用户提供的值更新数据源中显示的记录。 引发 ItemUpdating 和 ItemUpdated 事件。 |

与 "删除" 按钮（它会立即删除显示的记录）不同，单击 "编辑" 或 "新建" 按钮时，FormView 控件会分别进入 "编辑" 或 "插入" 模式。 在编辑模式下，为当前数据项显示了**EditItemTemplate**属性中包含的内容。 通常，编辑项模板的定义使 "编辑" 按钮替换为更新和 "取消" 按钮。 适用于字段的数据类型（例如 TextBox 或 CheckBox 控件）的输入控件通常还显示有字段值，供用户修改。 单击 "更新" 按钮将更新数据源中的记录，而单击 "取消" 按钮将放弃所有更改。

同样，当控件处于插入模式时，将为数据项显示**则**属性中包含的内容。 插入项模板通常定义为：将 "新建" 按钮替换为 "插入" 和 "取消" 按钮，并为用户显示空输入控件以输入新记录的值。 单击 "插入" 按钮将插入数据源中的记录，而单击 "取消" 按钮将放弃所有更改。

FormView 控件提供分页功能，该功能允许用户导航到数据源中的其他记录。 启用后，页导航行显示在包含页面导航控件的 FormView 控件中。 若要启用分页，请将**AllowPaging**属性设置为**true**。 通过设置 PagerStyle 和 PagerSettings 属性中包含的对象的属性，可以自定义页导航行。 您可以使用**PagerTemplate**属性来创建自己的 UI，而不是使用内置的页导航行 ui。

## <a name="customizing-the-user-interface"></a>自定义用户界面

您可以通过设置控件的不同部分的样式属性来自定义 FormView 控件的外观。 下表列出了不同的样式属性。

| **Style 属性** | **描述** |
| --- | --- |
| EditRowStyle | 当 FormView 控件处于编辑模式时数据行的样式设置。 |
| EmptyDataRowStyle | 当数据源不包含任何记录时，FormView 控件中显示的空数据行的样式设置。 |
| FooterStyle | FormView 控件的脚注行的样式设置。 |
| HeaderStyle | FormView 控件的标题行的样式设置。 |
| InsertRowStyle | 当 FormView 控件处于插入模式时数据行的样式设置。 |
| PagerStyle | 启用分页功能时，在 FormView 控件中显示的页导航行的样式设置。 |
| RowStyle | 当 FormView 控件处于只读模式时，数据行的样式设置。 |

## <a name="events"></a>事件

FormView 控件提供了几个可对其进行编程的事件。 这使您可以在每次发生事件时运行自定义例程。 下表列出了 FormView 控件支持的事件。

| **Event** | **描述** |
| --- | --- |
| ItemCommand | 在单击 FormView 控件中的按钮时发生。 此事件通常用于在控件中单击按钮时执行任务。 |
| ItemCreated | 在 FormView 控件中创建所有 FormViewRow 对象之后发生。 此事件通常用于在记录显示之前修改记录的值。 |
| ItemDeleted | 在单击 "删除" 按钮（其**CommandName**属性设置为 "Delete" 的按钮）时，但在 FormView 控件从数据源中删除记录之后发生。 此事件通常用于检查删除操作的结果。 |
| ItemDeleting | 在单击 "删除" 按钮时，但在 FormView 控件从数据源中删除记录之前发生。 此事件通常用于取消删除操作。 |
| ItemInserted | 单击 "插入" 按钮（其**CommandName**属性设置为 "插入" 的按钮）时，但在 FormView 控件插入记录后发生。 此事件通常用于检查插入操作的结果。 |
| ItemInserting | 当单击 "插入" 按钮时，但在 FormView 控件插入记录之前发生。 此事件通常用于取消插入操作。 |
| ItemUpdated | 在单击 "更新" 按钮（其**CommandName**属性设置为 "Update" 的按钮）时，但在 FormView 控件更新行后发生。 此事件通常用于检查更新操作的结果。 |
| ItemUpdating | 当单击 "更新" 按钮时，但在 FormView 控件更新记录之前发生。 此事件通常用于取消更新操作。 |
| ModeChanged | 在 FormView 控件更改模式（用于编辑、插入或只读模式）后发生。 此事件通常用于在 FormView 控件更改模式时执行任务。 |
| ModeChanging | 在 FormView 控件更改模式（用于编辑、插入或只读模式）之前发生。 此事件通常用于取消模式更改。 |
| PageIndexChanged | 在单击某一页导航按钮时，但在 FormView 控件处理分页操作之后发生。 此事件通常在用户导航至控件中的其他记录后需要执行任务时使用。 |
| PageIndexChanging | 在单击某一页导航按钮时，但在 FormView 控件处理分页操作之前发生。 此事件通常用于取消分页操作。 |

## <a name="detailsview"></a>DetailsView

"DetailsView" 控件用于在表中显示数据源中的单个记录，其中，记录的每个字段都显示在表的一行中。 它可以与主/从方案的 GridView 控件结合使用。 DetailsView 控件支持以下功能：

- 绑定到数据源控件，如 SqlDataSource。
- 内置插入功能。
- 内置的更新和删除功能。
- 内置的分页功能。
- 以编程方式访问 DetailsView 对象模型，以动态设置属性、处理事件等。
- 通过主题和样式自定义外观。

## <a name="row-fields"></a>行字段

DetailsView 控件中的每个数据行都是通过声明字段控件创建的。 不同的行字段类型确定控件中行的行为。 字段控件派生自 DataControlField。 下表列出了可以使用的不同行字段类型。

| **列字段类型** | **描述** |
| --- | --- |
| BoundField | 以文本形式显示数据源中字段的值。 |
| ButtonField | 在 DetailsView 控件中显示命令按钮。 这允许您显示具有自定义按钮控件的行，如 "添加" 或 "移除" 按钮。 |
| CheckBoxField | 在 DetailsView 控件中显示复选框。 此行字段类型通常用于显示具有布尔值的字段。 |
| CommandField | 显示内置命令按钮，用于在 DetailsView 控件中执行编辑、插入或删除操作。 |
| HyperLinkField | 将数据源中的字段值显示为超链接。 此行字段类型允许您将第二个字段绑定到超链接的 URL。 |
| ImageField | 在 DetailsView 控件中显示图像。 |
| TemplateField | 根据指定的模板在 DetailsView 控件中显示行的用户定义内容。 此行字段类型允许您创建自定义行字段。 |

默认情况下，AutoGenerateRows 属性设置为**true**，这将为数据源中的可绑定类型的每个字段自动生成绑定行字段对象。 有效的可绑定类型包括 String、DateTime、Decimal、Guid 和基元类型集。 然后，每个字段在行中显示为文本，并按照每个字段在数据源中的显示顺序显示。

自动生成行可提供一种快速简单的方法来显示记录中的每个字段。 但是，若要使用 DetailsView 控件的高级功能，必须显式声明要包含在 DetailsView 控件中的行字段。 若要声明行字段，请首先将**AutoGenerateRows**属性设置为**false**。 接下来，在 DetailsView 控件的开始标记和结束标记之间添加开始和结束 **&lt;字段&gt;** 标记。 最后，在 "开始" 和 "结束" **&lt;字段&gt;** 标记之间列出要包括的行字段。 指定的行字段将按所列顺序添加到字段集合中。 **字段**集合允许您以编程方式管理 DetailsView 控件中的行字段。

> [!NOTE]
> 自动生成的行字段不会添加到 "字段" 集合中。

## <a name="binding-to-data"></a>绑定到数据

DetailsView 控件可以绑定到数据源控件（如**SqlDataSource**或 AccessDataSource），也可以绑定到实现接口的任何数据源（例如，），并将其绑定到任何实现。

使用以下方法之一将 DetailsView 控件绑定到相应的数据源类型：

- 若要绑定到数据源控件，请将 DetailsView 控件的 DataSourceID 属性设置为数据源控件的 ID 值。 DetailsView 控件将自动绑定到指定的数据源控件。 这是绑定到数据的首选方法。
- 若要绑定到实现**system.web**接口的数据源，请以编程方式将 DetailsView 控件的 DataSource 属性设置为数据源，然后调用 DataBind 方法。

## <a name="security"></a>安全

此控件可用于显示用户输入，其中可能包括恶意客户端脚本。 在应用程序中显示可执行脚本、SQL 语句或其他代码之前，请检查从该客户端发送的任何信息。 ASP.NET 提供输入请求验证功能来阻止用户输入中的脚本和 HTML。

## <a name="data-operations"></a>数据操作

"DetailsView" 控件提供内置功能，使用户能够对控件中的项进行更新、删除、插入和分页。 当 DetailsView 控件绑定到数据源控件时，DetailsView 控件可以利用数据源控件的功能，并提供自动更新、删除、插入和分页功能。

DetailsView 控件可为与其他类型的数据源的更新、删除、插入和分页操作提供支持;但是，必须在相应的事件处理程序中提供这些操作的实现。

使用 "编辑"、"删除" 或 "新建" 按钮，DetailsView 控件可以分别将 AutoGenerateEditButton、AutoGenerateDeleteButton 或 AutoGenerateInsertButton 属性设置为 " **true**"，从而自动添加**CommandField**行字段。 与 "删除" 按钮（它会立即删除选定的记录）不同，单击 "编辑" 或 "新建" 按钮时，DetailsView 控件将分别进入编辑或插入模式。 在编辑模式下，"编辑" 按钮将替换为更新和 "取消" 按钮。 与字段的数据类型（例如 TextBox 或 CheckBox 控件）对应的输入控件将显示，其中包含字段值供用户修改。 单击 "更新" 按钮将更新数据源中的记录，而单击 "取消" 按钮将放弃所有更改。 同样，在插入模式下，"新建" 按钮将被替换为 "插入" 和 "取消" 按钮，并为用户显示空输入控件以输入新记录的值。

DetailsView 控件提供分页功能，该功能允许用户导航到数据源中的其他记录。 启用后，页面导航控件将显示在页导航行中。 若要启用分页，请将 AllowPaging 属性设置为**true**。 使用 PagerStyle 和 PagerSettings 属性可以自定义页导航行。

## <a name="customizing-the-user-interface"></a>自定义用户界面

您可以通过设置控件的不同部分的样式属性来自定义 DetailsView 控件的外观。 下表列出了不同的样式属性。

| **Style 属性** | **描述** |
| --- | --- |
| AlternatingRowStyle | DetailsView 控件中交替数据行的样式设置。 设置此属性时，数据行将在 RowStyle 设置和**AlternatingRowStyle**设置之间交替显示。 |
| CommandRowStyle | 包含 DetailsView 控件中内置命令按钮的行的样式设置。 |
| EditRowStyle | DetailsView 控件处于编辑模式时数据行的样式设置。 |
| EmptyDataRowStyle | 当数据源不包含任何记录时，DetailsView 控件中显示的空数据行的样式设置。 |
| FooterStyle | DetailsView 控件的页脚行的样式设置。 |
| HeaderStyle | DetailsView 控件的标题行的样式设置。 |
| InsertRowStyle | DetailsView 控件处于插入模式时数据行的样式设置。 |
| PagerStyle | DetailsView 控件的页导航行的样式设置。 |
| RowStyle | DetailsView 控件中的数据行的样式设置。 如果同时设置了**AlternatingRowStyle**属性，则会在 " **RowStyle** " 设置和 " **AlternatingRowStyle** " 设置之间交替显示数据行。 |
| FieldHeaderStyle | DetailsView 控件的标题列的样式设置。 |

## <a name="events"></a>事件

DetailsView 控件提供了几个可对其进行编程的事件。 这使您可以在每次发生事件时运行自定义例程。 下表列出了 DetailsView 控件支持的事件。 DetailsView 控件还从其基类继承这些事件：数据绑定、数据绑定、已释放、初始化、加载、呈现和呈现。

| **Event** | **描述** |
| --- | --- |
| ItemCommand | 在 DetailsView 控件中单击按钮时发生。 |
| ItemCreated | 在 DetailsView 控件中创建所有 DetailsViewRow 对象之后发生。 此事件通常用于在记录显示之前修改记录的值。 |
| ItemDeleted | 在单击 "删除" 按钮时，但在 DetailsView 控件从数据源中删除记录之后发生。 此事件通常用于检查删除操作的结果。 |
| ItemDeleting | 当单击 "删除" 按钮时，但在 DetailsView 控件从数据源删除记录之前发生。 此事件通常用于取消删除操作。 |
| ItemInserted | 单击 "插入" 按钮时，但在 DetailsView 控件插入记录后发生。 此事件通常用于检查插入操作的结果。 |
| ItemInserting | 当单击 "插入" 按钮时，但在 DetailsView 控件插入记录之前发生。 此事件通常用于取消插入操作。 |
| ItemUpdated | 单击 "更新" 按钮时，但在 DetailsView 控件更新行后发生。 此事件通常用于检查更新操作的结果。 |
| ItemUpdating | 当单击 "更新" 按钮时，但在 DetailsView 控件更新记录之前发生。 此事件通常用于取消更新操作。 |
| ModeChanged | 在 DetailsView 控件更改模式（编辑、插入或只读模式）后发生。 此事件通常用于在 DetailsView 控件更改模式时执行任务。 |
| ModeChanging | 在 DetailsView 控件更改模式（编辑、插入或只读模式）之前发生。 此事件通常用于取消模式更改。 |
| PageIndexChanged | 在单击某一页导航按钮时，但在 DetailsView 控件处理分页操作之后发生。 此事件通常在用户导航至控件中的其他记录后需要执行任务时使用。 |
| PageIndexChanging | 当单击某一页导航按钮时，但在 DetailsView 控件处理分页操作之前发生。 此事件通常用于取消分页操作。 |

## <a name="the-menu-control"></a>Menu 控件

ASP.NET 2.0 中的 Menu 控件设计为功能完备的导航系统。 可以轻松地将其绑定到分层数据源（例如 SiteMapDataSource）。

可以通过声明方式或动态方式定义菜单控件结构，并由单个根节点和任意数量的子节点组成。 下面的代码以声明方式为 Menu 控件定义菜单。

[!code-aspx[Main](data-bound-controls/samples/sample4.aspx)]

在上面的示例中，"主页 .aspx" 节点是根节点。 所有其他节点嵌套在根节点的不同级别。

菜单控件可以呈现两种类型的菜单：静态菜单和动态菜单。 静态菜单包含始终可见的菜单项。 动态菜单由菜单项组成，它们仅在用户用鼠标悬停在其上时可见。 客户可能经常将静态菜单与以声明方式定义的菜单和动态菜单（包含在运行时进行数据绑定的菜单）混淆。 事实上，动态和静态菜单与填充方法无关。 术语*static*和*dynamic*仅指默认情况下是否静态显示菜单，或仅在用户执行某个操作时显示。

**StaticDisplayLevels**属性用于配置默认情况下显示的静态菜单级别数。 在上面的示例中，将**StaticDisplayLevels**属性设置为值2将导致菜单静态地显示 "主节点"、"音乐" 节点和 "电影" 节点。 当用户将鼠标指针悬停在父节点上时，所有其他节点将会动态显示。

**MaximumDynamicDisplayLevels**属性配置菜单能够显示的最大动态级别数。 高于**MaximumDynamicDisplayLevels**属性指定的值的任何动态菜单都将被丢弃。

> [!NOTE]
> 您可能会遇到这样的情况：由于 MaximumDynamicDisplayLevels 属性的原因，菜单没有呈现出来。 在这些情况下，请确保已将属性设置为足以允许显示 "客户" 菜单。

## <a name="data-binding-the-menu-control"></a>数据绑定菜单控件

Menu 控件可以绑定到任何分层数据源，如 SiteMapDataSource 或 XMLDataSource。 SiteMapDataSource 是用于向 Menu 控件进行数据绑定的最常用方法，因为该方法从 Web.config 文件中馈送，并且其架构为 Menu 控件提供已知 API。 下面的列表显示了一个简单的 Web.config 文件。

[!code-xml[Main](data-bound-controls/samples/sample5.xml)]

请注意，在此示例中，只有一个根 siteMapNode 元素，即 Home 元素。 可以为每个 siteMapNode 配置多个属性。 最常用的属性包括：

- **url**指定当用户单击菜单项时要显示的 URL。 如果此属性不存在，则该节点将在被单击时直接回发。
- **标题**指定在菜单项上显示的文本。
- **描述**用作节点的文档。 当鼠标悬停在节点上时，还会显示为工具提示。
- **siteMapFile**允许嵌套站点地图。 此特性必须指向格式正确的 ASP.NET 站点地图文件。
- **角色**允许通过 ASP.NET 安全修整来控制节点的外观。

请注意，尽管这些属性都是可选的，但如果未指定，菜单的行为可能不是预期的。 例如，如果指定了*url*属性，但*description*属性不为，则该节点将不可见，因此将无法导航到指定的 url。

## <a name="controlling-a-menus-operation"></a>控制菜单操作

有几个属性会影响 ASP.NET 菜单控件的操作;"**方向**" 属性、 **DisappearAfter**属性、 **StaticItemFormatString**属性和**StaticPopoutImageUrl**属性只是其中的一部分。

- 可以将**方向**设置为*水平*或*垂直*，并控制静态菜单项是在行中水平布局还是垂直布局。 此属性不影响动态菜单。
- **DisappearAfter**属性配置动态菜单在移动鼠标后应保持可见的时间。 该值以毫秒为单位指定，默认值为500。 如果将此属性的值设置为-1，则会导致菜单永远不会自动消失。 在这种情况下，仅当用户在菜单外部单击时，菜单才会消失。
- **StaticItemFormatString**属性使你可以轻松地在菜单系统中维护一致的措辞。 指定此属性时，应输入 *{0}* ，以代替出现在数据源中的说明。 例如，若要让 "练习 1" 中的菜单项显示 "访问我们的产品" 页，等，请为 StaticItemFormatString 指定访问我们的 {0} 页。 在运行时，ASP.NET 会将任何 {0} 替换为菜单项的正确说明。
- **StaticPopoutImageUrl**属性指定用于指示特定菜单节点具有可通过鼠标悬停在其上访问的子节点的图像。 动态菜单将继续使用默认图像。

## <a name="templated-menu-controls"></a>模板化菜单控件

Menu 控件是模板化控件，允许两个不同的 ItemTemplates;StaticItemTemplate 和 DynamicItemTemplate。 使用这些模板，可以轻松地向菜单添加服务器控件或用户控件。

若要在 Visual Studio .NET 中编辑模板，请单击菜单上的 "智能标记" 按钮，然后选择 "编辑模板"。 然后，可以在编辑 StaticItemTemplate 或 DynamicItemTemplate 之间进行选择。

加载页面时，添加到 StaticItemTemplate 的任何控件都将显示在静态菜单中。 任何添加到 DynamicItemTemplate 的控件将显示在所有弹出菜单上。

## <a name="menu-events"></a>菜单事件

Menu 控件有两个唯一的事件;**MenuItemClicked**和**MenuItemDatabound**事件。

单击菜单项时，将引发 MenuItemClicked 事件。 当对菜单项进行数据绑定时，将引发 MenuItemDatabound 事件。 传递给事件处理程序的**MenuEventArgs**通过 item 属性提供对菜单项的访问。

## <a name="controlling-a-menus-appearance"></a>控制菜单外观

您还可以使用一个或多个可用于设置菜单格式的样式来影响菜单控件的外观。 其中包括**StaticMenuStyle**、 **DynamicMenuStyle**、 **DynamicMenuItemStyle**、 **DynamicSelectedStyle**和**DynamicHoverStyle**。 这些属性是使用标准 HTML 样式字符串配置的。 例如，以下将影响动态菜单的样式。

[!code-aspx[Main](data-bound-controls/samples/sample6.aspx)]

> [!NOTE]
> 如果使用任何悬停样式，则需要将中的 &lt;head&gt; 元素添加到页面，并将*runat*元素设置为*server*。

Menu 控件还支持使用 ASP.NET 2.0 主题。

## <a name="the-treeview-control"></a>TreeView 控件

TreeView 控件在类似于树的结构中显示数据。 与 Menu 控件一样，可以轻松地将数据绑定到任何分层数据源（例如 SiteMapDataSource）。

对于 ASP.NET 2.0 中的 TreeView 控件，客户可能会问的第一个问题是是否与可用于 ASP.NET 1.x 的 TreeView IE WebControl 相关。 不是。 ASP.NET 2.0 TreeView 控件已从头开始编写，并为以前提供的 IE TreeView WebControl 提供了显著改进。

我不会详细介绍如何将 TreeView 控件绑定到站点地图，因为它的执行方式与菜单控件完全相同。 但是，TreeView 控件的运行方式有一些不同之处。

默认情况下，TreeView 控件完全展开。 若要更改初始加载时的扩展级别，请修改控件的**ExpandDepth**属性。 当 TreeView 在展开特定节点时进行数据绑定时，这一点尤其重要。

## <a name="databinding-the-treeview-control"></a>对 TreeView 控件进行数据绑定

与 Menu 控件不同，TreeView 适合处理大量数据。 因此，除了数据绑定到 SiteMapDataSource 或 XMLDataSource，TreeView 通常还会数据绑定到数据集或其他关系数据。 在 TreeView 控件绑定到大量数据的情况下，最好只绑定到控件中实际可见的数据。 然后，你可以在展开 TreeView 节点时数据绑定到其他数据。

在这些情况下，TreeView 的**PopulateOnDemand**属性应设置为*true*。 然后，需要为**TreeNodePopulate**方法提供实现。

## <a name="data-binding-without-postback"></a>无回发的数据绑定

请注意，当你首次展开上一示例中的节点时，该页会回发并刷新。 这并不是此示例中的问题，但可以想象，它可能位于具有大量数据的生产环境中。 更好的方案是 TreeView 仍会动态填充其节点，而不会回发到服务器。

通过将**PopulateNodesFromClient**和**PopulateOnDemand**属性设置为 true，ASP.NET TreeView 控件将在不回发的情况下动态填充节点。 展开父节点时，会从客户端发出 XMLHttp 请求，并触发 OnTreeNodePopulate 事件。 服务器使用 XML 数据岛进行响应，该数据岛随后用于对子节点进行数据绑定。

ASP.NET 动态创建实现此功能的客户端代码。 包含脚本&gt; 标记 &lt;脚本会生成指向 AXD 文件。 例如，下面的列表显示了生成 XMLHttp 请求的脚本代码的脚本链接。

[!code-html[Main](data-bound-controls/samples/sample7.html)]

如果在浏览器中浏览上面的 AXD 文件并将其打开，则会看到实现了 XMLHttp 请求的代码。 此方法阻止客户修改脚本文件。

## <a name="controlling-the-operation-of-the-treeview-control"></a>控制 TreeView 控件的操作

TreeView 控件具有几个影响控件操作的属性。 最明显的属性包括**ShowCheckBoxes**、 **ShowExpandCollapse**和**ShowLines**。

**ShowCheckBoxes**属性影响在呈现时节点是否显示复选框。 此属性的有效值为**None**、 **Root**、 **Parent**、**叶**和**All**。 这会影响 TreeView 控件，如下所示：

| **属性值** | **效果** |
| --- | --- |
| 无 | 复选框不会显示在任何节点上。 此为默认设置。 |
| Root | 仅在根节点上显示复选框。 |
| 父级 | 只有具有子节点的节点上才会显示复选框。 这些子节点可以是父节点或叶节点。 |
| 叶 | 仅对没有子节点的节点显示复选框。 |
| All | 在所有节点上显示复选框。 |

当使用 checkbox 时， **CheckedNodes**属性将返回在回发时检查的 TreeView 节点的集合。

**ShowExpandCollapse**属性控制 root 节点和父节点旁边的展开/折叠图像的外观。 如果将此属性设置为**false**，则 TreeView 节点呈现为超链接，并通过单击链接展开/折叠。

**ShowLines**属性控制是否显示将父节点连接到子节点的行。 如果**为 false** （默认值），则不显示任何行。 如果**为 true**，TreeView 控件将使用**LineImagesFolder**属性指定的文件夹中的行图像。

为了自定义 TreeView 线条的外观，Visual Studio .NET 2005 包含行设计器工具。 您可以使用 TreeView 控件上的智能标记按钮访问此工具，如下所示。

![](data-bound-controls/_static/image1.jpg)

**图1**

当选择 "**自定义行图像**" 菜单选项时，将启动线条设计器工具，以便您可以配置 TreeView 线条的外观。

## <a name="treeview-events"></a>TreeView 事件

TreeView 控件具有以下唯一事件：

- 根据**SelectAction**属性选择节点时，会发生 SelectedNodeChanged。
- 节点 checkboxs 状态更改时发生 TreeNodeCheckChanged。
- 当基于**SelectAction**属性展开某个节点时，会发生 TreeNodeExpanded。
- 折叠节点时，会发生 TreeNodeCollapsed。
- 节点绑定到数据时，会发生 TreeNodeDataBound。
- 填充节点时，会发生 TreeNodePopulate。

使用**SelectAction**属性可以配置选择节点时触发的事件。 SelectAction 属性提供以下操作：

- 选择节点时，TreeNodeSelectAction 将引发 TreeNodeExpanded。
- TreeNodeSelectAction 在选择节点时不引发任何事件。
- TreeNodeSelectAction 在选择节点时引发 SelectedNodeChanged 事件。
- TreeNodeSelectAction SelectExpand 会在选择节点时引发 SelectedNodeChanged 事件和 TreeNodeExpanded 事件。

## <a name="controlling-appearance-with-styles"></a>用样式控制外观

TreeView 控件提供了许多用于控制具有样式的控件外观的属性。 以下属性可用。

| **属性名称** | **控件** |
| --- | --- |
| HoverNodeStyle | 当鼠标悬停在节点上时控制其样式。 |
| LeafNodeStyle | 控制叶节点的样式。 |
| NodeStyle | 控制所有节点的样式。 特定节点样式（如 LeafNodeStyle）覆盖此样式。 |
| ParentNodeStyle | 控制所有父节点的样式。 |
| RootNodeStyle | 控制根节点的样式。 |
| SelectedNodeStyle | 控制所选节点的样式。 |

其中每个属性都是只读的。 但是，它们每个都将返回一个**TreeNodeStyle**对象，该对象的属性可以使用*属性子属性*格式进行修改。 例如，若要设置**SelectedNodeStyle**的 "**前景色**" 属性，请使用以下语法：

[!code-aspx[Main](data-bound-controls/samples/sample8.aspx)]

请注意，上面的标记未关闭。 这是因为，使用此处所示的声明性语法时，还会在 HTML 代码中包含 Treeview 节点。

还可以使用*属性子属性*格式在代码中指定样式属性。 例如，若要在代码中设置**RootNodeStyle**的 "**前景色**" 属性，请使用以下语法：

[!code-csharp[Main](data-bound-controls/samples/sample9.cs)]

> [!NOTE]
> 有关不同样式属性的完整列表，请参阅 TreeNodeStyle 对象上的 MSDN 文档。

## <a name="the-sitemappath-control"></a>SiteMapPath 控件

SiteMapPath 控件为 ASP.NET 开发人员提供了一个详细的痕迹导航控件。 与其他导航控件一样，可以轻松地将数据绑定到分层数据源，例如 SiteMapDataSource 或 XmlDataSource。

SiteMapPath 控件由 SiteMapNodeItem 对象组成。 有三种类型的节点：根节点、父节点和当前节点。 根节点是层次结构顶部的节点。 当前节点表示当前页。 所有其他节点均为父节点。

## <a name="controlling-the-operation-of-the-sitemappath-control"></a>控制 SiteMapPath 控件的操作

控制 SiteMapPath 控件的操作的属性如下所示：

| **Property** | **属性说明** |
| --- | --- |
| ParentLevelsDisplayed | 控制显示多少父节点。 默认值为-1，它对显示的父节点数量没有限制。 |
| PathDirection | 控制 SiteMapPath 的方向。 有效值为 RootToCurrent （默认值）和 CurrentToRoot。 |
| PathSeparator | 控制在 SiteMapPath 控件中分隔节点的字符的字符串。 默认值为：。 |
| RenderCurrentNodeAsLink | 一个布尔值，该值控制当前节点是否呈现为链接。 默认值为 False。 |
| SkipLinkText | 当屏幕阅读器查看页面时，可提供辅助功能。 此属性允许屏幕阅读器跳过 SiteMapPath 控件。 若要禁用此功能，请将属性设置为 String。 |

## <a name="templated-sitemappath-controls"></a>模板化 SiteMapPath 控件

SiteMapControl 是一个模板化控件，因此，您可以定义用于显示控件的不同模板。 若要在 SiteMapPath 控件中编辑模板，请单击控件上的智能标记按钮，然后从菜单中选择 "编辑模板"。 此时将显示 "SiteMapTasks" 菜单，如下所示，你可以在不同的可用模板之间进行选择。

![](data-bound-controls/_static/image2.jpg)

**图2**

**NodeTemplate**模板引用 SiteMapPath 中的任何节点。 如果节点是根节点或当前节点，并且配置了**RootNodeTemplate**或**CurrentNodeTemplate** ，则将覆盖 NodeTemplate。

## <a name="sitemappath-events"></a>SiteMapPath 事件

SiteMapPath 控件有两个不是从控件类派生的事件;**ItemCreated**事件和**ItemDataBound**事件。 创建 SiteMapPath 项时，将引发 ItemCreated 事件。 在 SiteMapPath 节点的数据绑定过程中调用 DataBind 方法时，将引发 ItemDataBound。 **SiteMapNodeItemEventArgs**对象通过 Item 属性提供对特定 SiteMapNodeItem 的访问。

## <a name="controlling-appearance-with-styles"></a>用样式控制外观

以下样式可用于 SiteMapPath 控件的格式设置。

| **属性名称** | **控件** |
| --- | --- |
| CurrentNodeStyle | 控制当前节点的文本样式。 |
| RootNodeStyle | 控制根节点的文本样式。 |
| NodeStyle | 控制所有节点的文本样式，假设 CurrentNodeStyle 或 RootNodeStyle 不适用。 |

NodeStyle 属性由 CurrentNodeStyle 或 RootNodeStyle 重写。 其中每个属性都是只读的，并返回**Style**对象。 若要使用这些属性之一影响节点的外观，您需要设置返回的样式对象的属性。 例如，下面的代码更改当前节点的前景色属性。

[!code-aspx[Main](data-bound-controls/samples/sample10.aspx)]

还可以通过编程方式应用属性，如下所示：

[!code-csharp[Main](data-bound-controls/samples/sample11.cs)]

> [!NOTE]
> 如果应用了模板，则不会应用样式。

## <a name="lab-1-configuring-an-aspnet-menu-control"></a>实验室1：配置 ASP.NET 菜单控件

1. 创建新网站。
2. 通过从文件模板列表中选择 "文件"、"新建"、"文件" 和 "选择网站地图" 来添加站点映射文件。
3. 打开站点地图（默认情况下为 web.sitemap），并对其进行修改，使其类似于下面的列表。 您要在站点地图文件中链接的页面并不真正存在，但这不是此练习的问题。

    [!code-xml[Main](data-bound-controls/samples/sample12.xml)]
4. 在设计视图中打开默认 Web 窗体。
5. 从 "工具箱" 的 "导航" 部分，向页面添加一个新的菜单控件。
6. 在 "工具箱" 的 "数据" 部分中，添加一个新的 SiteMapDataSource。 SiteMapDataSource 将自动使用站点中的 Web.config 文件。 （Web.sitemap 文件*必须*位于站点的根文件夹中。）
7. 单击 "菜单" 控件，然后单击 "智能标记" 按钮以显示 "菜单任务" 对话框。
8. 在 "选择数据源" 下拉列表中，选择 "SiteMapDataSource1"。
9. 单击 "自动套用格式" 链接，然后为菜单选择一种格式。
10. 在 "属性" 窗格中，将 " **StaticDisplayLevels** " 属性设置为2。 菜单控件现在应显示设计器中的 "主页"、"产品" 和 "服务" 节点。
11. 浏览浏览器中的页面以使用菜单。 （由于你已添加到站点映射的页面实际上并不存在，因此当你尝试浏览到它们时，你会看到一个错误。）

尝试更改 StaticDisplayLevels 和 MaximumDynamicDisplayLevels 属性，并查看其如何影响菜单的呈现方式。

## <a name="lab-2-dynamically-binding-a-treeview-control"></a>实验室2：动态绑定 TreeView 控件

本练习假设您 SQL Server 本地运行，并且 Northwind 数据库存在于 SQL Server 实例上。 如果未满足这些条件，请在示例中更改连接字符串。 请注意，你可能还需要指定 SQL Server 身份验证而不是可信连接。

1. 创建新网站。
2. 切换到默认 .aspx 的代码视图，并将所有代码替换为以下所列的代码。 

    [!code-aspx[Main](data-bound-controls/samples/sample13.aspx)]
3. 将该页另存为 treeview .aspx。
4. 浏览页面。
5. 第一次显示页面时，请在浏览器中查看页面的源。 请注意，仅向客户端发送可见节点。
6. 单击 "任何" 节点旁边的加号。
7. 再次在页面上查看源。 请注意，新显示的节点现在存在。

## <a name="lab-3-details-view-and-editing-data-using-a-gridview-and-detailsview"></a>实验室3：使用 GridView 和 DetailsView 查看和编辑数据的详细信息

1. 创建新网站。
2. 向网站添加一个新的 web.config。
3. 向 web.config 文件添加一个连接字符串，如下所示： 

    [!code-xml[Main](data-bound-controls/samples/sample14.xml)]

    > [!NOTE]
    > 您可能需要根据您的环境更改连接字符串。
4. 保存并关闭 web.config 文件。
5. 打开 default.aspx 并添加一个新的 SqlDataSource 控件。
6. 将 SqlDataSource 控件的 ID 更改为**Products**。
7. 在 " **SqlDataSource 任务**" 菜单中，单击 "**配置数据源**"。
8. 在 "连接" 下拉列表中选择**Northwind** ，并单击 "下一步"
9. 从 "**名称**" 下拉列表中选择 "**产品**"，然后选中 " **ProductID**、 **ProductName**、**单价**和**库存**" 复选框，如下所示。 

![](data-bound-controls/_static/image3.jpg)

    **Figure 3**
10. 单击 **“下一步”** 。
11. 单击“完成”。
12. 切换到 "源" 视图并检查生成的代码。 请注意，已添加到 SqlDataSource 控件中的**SelectCommand**、 **DeleteCommand**、 **InsertCommand**和**UpdateCommand** 。 另请注意已添加的参数。
13. 切换到设计视图并向页面添加一个新的 GridView 控件。
14. 从 "**选择数据源**" 下拉列表中选择 "**产品**"。
15. 选中 "**启用分页**并**启用选项**"，如下所示。 

![](data-bound-controls/_static/image4.jpg)

    **Figure 4**
16. 单击 "**编辑列**" 链接，并确保选中 "**自动生成字段**"。
17. 单击“确定”。
18. 选择 GridView 控件后，在 "属性" 窗格中单击 " **DataKeyNames** " 属性旁边的按钮。
19. 从 "**可用数据字段**" 列表中选择 " **ProductID** "，然后单击 " **&gt;** " 按钮进行添加。
20. 单击“确定”。
21. 向页面添加一个新的 SqlDataSource 控件。
22. 将 SqlDataSource 控件的 ID 更改为 "**详细信息**"。
23. 从 "SqlDataSource 任务" 菜单中，选择 "**配置数据源**"。
24. 从下拉列表中选择 " **Northwind** "，然后单击 "**下一步**"。
25. 从 "<strong>名称</strong>" 下拉列表中选择 "<strong>产品</strong>"，并选中 "<strong>列</strong>" 列表框中的 "<strong>\</strong >
26. 单击 "**位置**" 按钮。
27. 从 "**列**" 下拉列表中选择 " **ProductID** "。
28. 在 "运算符" 下拉列表中选择 **=** 。
29. 从 "**源**" 下拉列表中选择 "**控件**"。
30. 从 "**控件 ID** " 下拉列表中选择 " **GridView1** "。
31. 单击 "**添加**" 按钮添加 WHERE 子句。
32. 单击“确定”。
33. 单击 "**高级**" 按钮，然后选中 "**生成 INSERT、UPDATE 和 DELETE 语句**" 复选框。
34. 单击“确定”。
35. 单击 "**下一步**" 并单击 "**完成**"。
36. 将 DetailsView 控件添加到页面。
37. 在 "**选择数据源**" 下拉列表中，选择 "**详细信息**"。
38. 选中 "**启用编辑**" 复选框，如下所示。 

![](data-bound-controls/_static/image1.gif)

    **Figure 5**
39. 保存该页并浏览 default.aspx。
40. 单击 "不同记录" 旁边的 "**选择**" 链接，以查看自动更新的更新。
41. 单击 "DetailsView" 控件中的 "**编辑**" 链接。
42. 对记录进行更改，然后单击 "**更新**"。
