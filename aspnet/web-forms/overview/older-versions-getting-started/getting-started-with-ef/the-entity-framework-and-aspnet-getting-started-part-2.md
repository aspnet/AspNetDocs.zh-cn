---
uid: web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2
title: 入门实体框架 4.0 Database First 和 ASP.NET 4 Web 窗体-第2部分 |Microsoft Docs
author: tdykstra
description: Contoso 大学示例 web 应用程序演示了如何使用实体框架创建 ASP.NET Web 窗体应用程序。 示例应用程序为 。
ms.author: riande
ms.date: 12/03/2010
ms.assetid: fb63a326-a4ae-4b0c-a4f5-412327197216
msc.legacyurl: /web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2
msc.type: authoredcontent
ms.openlocfilehash: bd6a2e29e6f0df04e39be29160e2e08cc99c4706
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/06/2020
ms.locfileid: "78456446"
---
# <a name="getting-started-with-entity-framework-40-database-first-and-aspnet-4-web-forms---part-2"></a><span data-ttu-id="dbabb-104">入门实体框架 4.0 Database First 和 ASP.NET 4 Web 窗体-第2部分</span><span class="sxs-lookup"><span data-stu-id="dbabb-104">Getting Started with Entity Framework 4.0 Database First and ASP.NET 4 Web Forms - Part 2</span></span>

<span data-ttu-id="dbabb-105">作者： [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="dbabb-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="dbabb-106">Contoso 大学示例 web 应用程序演示了如何使用实体框架4.0 和 Visual Studio 2010 创建 ASP.NET Web 窗体应用程序。</span><span class="sxs-lookup"><span data-stu-id="dbabb-106">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="dbabb-107">有关本教程系列的信息，请参阅[系列教程中的第一个教程](the-entity-framework-and-aspnet-getting-started-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="dbabb-107">For information about the tutorial series, see [the first tutorial in the series](the-entity-framework-and-aspnet-getting-started-part-1.md)</span></span>

## <a name="the-entitydatasource-control"></a><span data-ttu-id="dbabb-108">EntityDataSource 控件</span><span class="sxs-lookup"><span data-stu-id="dbabb-108">The EntityDataSource Control</span></span>

<span data-ttu-id="dbabb-109">在上一教程中，您创建了一个网站、一个数据库和一个数据模型。</span><span class="sxs-lookup"><span data-stu-id="dbabb-109">In the previous tutorial you created a web site, a database, and a data model.</span></span> <span data-ttu-id="dbabb-110">在本教程中，您将使用 ASP.NET 提供的 `EntityDataSource` 控件以便于处理实体框架的数据模型。</span><span class="sxs-lookup"><span data-stu-id="dbabb-110">In this tutorial you work with the `EntityDataSource` control that ASP.NET provides in order to make it easy to work with an Entity Framework data model.</span></span> <span data-ttu-id="dbabb-111">您将创建一个 `GridView` 控件用于显示和编辑学生数据、用于添加新学生的 `DetailsView` 控件，以及用于选择部门的 `DropDownList` 控件（稍后将用于显示相关的课程）。</span><span class="sxs-lookup"><span data-stu-id="dbabb-111">You'll create a `GridView` control for displaying and editing student data, a `DetailsView` control for adding new students, and a `DropDownList` control for selecting a department (which you'll use later for displaying associated courses).</span></span>

<span data-ttu-id="dbabb-112">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-112">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image1.png)</span></span>

<span data-ttu-id="dbabb-113">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-113">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image3.png)</span></span>

<span data-ttu-id="dbabb-114">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-114">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image5.png)</span></span>

<span data-ttu-id="dbabb-115">请注意，在此应用程序中，不会向更新数据库的页面添加输入验证，并且某些错误处理将不会像生产应用程序中所需的那样可靠。</span><span class="sxs-lookup"><span data-stu-id="dbabb-115">Note that in this application you won't be adding input validation to pages that update the database, and some of the error handling will not be as robust as would be required in a production application.</span></span> <span data-ttu-id="dbabb-116">这使教程重点介绍实体框架并使其不会太长。</span><span class="sxs-lookup"><span data-stu-id="dbabb-116">That keeps the tutorial focused on the Entity Framework and keeps it from getting too long.</span></span> <span data-ttu-id="dbabb-117">有关如何向应用程序添加这些功能的详细信息，请参阅在[ASP.NET 页和应用程序](https://msdn.microsoft.com/library/w16865z6.aspx)中验证 ASP.NET 网页和错误处理中的[用户输入](https://msdn.microsoft.com/library/7kh55542.aspx)。</span><span class="sxs-lookup"><span data-stu-id="dbabb-117">For details about how to add these features to your application, see [Validating User Input in ASP.NET Web Pages](https://msdn.microsoft.com/library/7kh55542.aspx) and [Error Handling in ASP.NET Pages and Applications](https://msdn.microsoft.com/library/w16865z6.aspx).</span></span>

## <a name="adding-and-configuring-the-entitydatasource-control"></a><span data-ttu-id="dbabb-118">添加和配置 EntityDataSource 控件</span><span class="sxs-lookup"><span data-stu-id="dbabb-118">Adding and Configuring the EntityDataSource Control</span></span>

<span data-ttu-id="dbabb-119">首先，将 `EntityDataSource` 控件配置为读取 `People` 实体集中的 `Person` 实体。</span><span class="sxs-lookup"><span data-stu-id="dbabb-119">You'll begin by configuring an `EntityDataSource` control to read `Person` entities from the `People` entity set.</span></span>

<span data-ttu-id="dbabb-120">请确保已打开 Visual Studio，并且使用的是在第1部分中创建的项目。</span><span class="sxs-lookup"><span data-stu-id="dbabb-120">Make sure you have Visual Studio open and that you're working with the project you created in part 1.</span></span> <span data-ttu-id="dbabb-121">如果你在创建数据模型后，或自上次更改后生成了项目，请立即生成项目。</span><span class="sxs-lookup"><span data-stu-id="dbabb-121">If you haven't built the project since you created the data model or since the last change you made to it, build the project now.</span></span> <span data-ttu-id="dbabb-122">在生成项目之前，不能对数据模型进行更改。</span><span class="sxs-lookup"><span data-stu-id="dbabb-122">Changes to the data model are not made available to the designer until the project is built.</span></span>

<span data-ttu-id="dbabb-123">使用 "母版页" 模板创建一个使用**Web 窗体**的新网页，*并将其*命名为 "student"。</span><span class="sxs-lookup"><span data-stu-id="dbabb-123">Create a new web page using the **Web Form using Master Page** template, and name it *Students.aspx*.</span></span>

<span data-ttu-id="dbabb-124">[![Image23](the-entity-framework-and-aspnet-getting-started-part-2/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-124">[![Image23](the-entity-framework-and-aspnet-getting-started-part-2/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image7.png)</span></span>

<span data-ttu-id="dbabb-125">指定*网站地图*作为母版页。</span><span class="sxs-lookup"><span data-stu-id="dbabb-125">Specify *Site.Master* as the master page.</span></span> <span data-ttu-id="dbabb-126">你为这些教程创建的所有页面都将使用此母版页。</span><span class="sxs-lookup"><span data-stu-id="dbabb-126">All of the pages you create for these tutorials will use this master page.</span></span>

<span data-ttu-id="dbabb-127">[![Image24](the-entity-framework-and-aspnet-getting-started-part-2/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-127">[![Image24](the-entity-framework-and-aspnet-getting-started-part-2/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image9.png)</span></span>

<span data-ttu-id="dbabb-128">在 "**源**" 视图中，将 `h2` 标题添加到名为 `Content2`的 `Content` 控件，如以下示例中所示：</span><span class="sxs-lookup"><span data-stu-id="dbabb-128">In **Source** view, add an `h2` heading to the `Content` control named `Content2`, as shown in the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample1.aspx)]

<span data-ttu-id="dbabb-129">从 "工具箱" 的 "**数据**" 选项卡中，将 **"** `EntityDataSource`" 控件拖动到页面上，将其放在标题下方，将 ID 更改为 `StudentsEntityDataSource`：</span><span class="sxs-lookup"><span data-stu-id="dbabb-129">From the **Data** tab of the **Toolbox**, drag an `EntityDataSource` control to the page, drop it below the heading, and change the ID to `StudentsEntityDataSource`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample2.aspx)]

<span data-ttu-id="dbabb-130">切换到 "**设计**" 视图，单击数据源控件的智能标记，然后单击 "**配置数据源**" 以启动 "**配置数据源**" 向导。</span><span class="sxs-lookup"><span data-stu-id="dbabb-130">Switch to **Design** view, click the data source control's smart tag, and then click **Configure Data Source** to launch the **Configure Data Source** wizard.</span></span>

<span data-ttu-id="dbabb-131">[![Image01](the-entity-framework-and-aspnet-getting-started-part-2/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-131">[![Image01](the-entity-framework-and-aspnet-getting-started-part-2/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image11.png)</span></span>

<span data-ttu-id="dbabb-132">在 "**配置 ObjectContext**向导" 步骤中，选择 " **SchoolEntities** " 作为 "**命名连接**" 的值，并选择 " **SchoolEntities** " 作为 " **DefaultContainerName** " 值。</span><span class="sxs-lookup"><span data-stu-id="dbabb-132">In the **Configure ObjectContext** wizard step, select **SchoolEntities** as the value for **Named Connection**, and select **SchoolEntities** as the **DefaultContainerName** value.</span></span> <span data-ttu-id="dbabb-133">再单击 **“下一步”** 。</span><span class="sxs-lookup"><span data-stu-id="dbabb-133">Then click **Next**.</span></span>

<span data-ttu-id="dbabb-134">[![Image02](the-entity-framework-and-aspnet-getting-started-part-2/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-134">[![Image02](the-entity-framework-and-aspnet-getting-started-part-2/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image13.png)</span></span>

<span data-ttu-id="dbabb-135">注意：如果此时获取以下对话框，则必须先生成项目，然后才能继续。</span><span class="sxs-lookup"><span data-stu-id="dbabb-135">Note: If you get the following dialog box at this point, you have to build the project before proceeding.</span></span>

<span data-ttu-id="dbabb-136">[![Image25](the-entity-framework-and-aspnet-getting-started-part-2/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-136">[![Image25](the-entity-framework-and-aspnet-getting-started-part-2/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image15.png)</span></span>

<span data-ttu-id="dbabb-137">在 "**配置数据选择**" 步骤中，选择 "**用户**" 作为**EntitySetName**的值。</span><span class="sxs-lookup"><span data-stu-id="dbabb-137">In the **Configure Data Selection** step, select **People** as the value for **EntitySetName**.</span></span> <span data-ttu-id="dbabb-138">在 "**选择**" 下，确保选中 "**选择**ll" 复选框。</span><span class="sxs-lookup"><span data-stu-id="dbabb-138">Under **Select**, make sure the **Select A** ll check box is selected.</span></span> <span data-ttu-id="dbabb-139">然后选择用于启用更新和删除的选项。</span><span class="sxs-lookup"><span data-stu-id="dbabb-139">Then select the options to enable update and delete.</span></span> <span data-ttu-id="dbabb-140">完成后，单击 "**完成**"。</span><span class="sxs-lookup"><span data-stu-id="dbabb-140">When you're done, click **Finish**.</span></span>

<span data-ttu-id="dbabb-141">[![Image03](the-entity-framework-and-aspnet-getting-started-part-2/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-141">[![Image03](the-entity-framework-and-aspnet-getting-started-part-2/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image17.png)</span></span>

## <a name="configuring-database-rules-to-allow-deletion"></a><span data-ttu-id="dbabb-142">将数据库规则配置为允许删除</span><span class="sxs-lookup"><span data-stu-id="dbabb-142">Configuring Database Rules to Allow Deletion</span></span>

<span data-ttu-id="dbabb-143">你将创建一个页面，使用户能够从 `Person` 表中删除学生，此表与其他表（`Course`、`StudentGrade`和 `OfficeAssignment`）有三个关系。</span><span class="sxs-lookup"><span data-stu-id="dbabb-143">You'll be creating a page that lets users delete students from the `Person` table, which has three relationships with other tables (`Course`, `StudentGrade`, and `OfficeAssignment`).</span></span> <span data-ttu-id="dbabb-144">默认情况下，如果其中一个表中存在相关行，数据库将阻止您删除 `Person` 中的行。</span><span class="sxs-lookup"><span data-stu-id="dbabb-144">By default, the database will prevent you from deleting a row in `Person` if there are related rows in one of the other tables.</span></span> <span data-ttu-id="dbabb-145">您可以先手动删除相关行，也可以将数据库配置为删除 `Person` 行时自动删除这些行。</span><span class="sxs-lookup"><span data-stu-id="dbabb-145">You can manually delete the related rows first, or you can configure the database to delete them automatically when you delete a `Person` row.</span></span> <span data-ttu-id="dbabb-146">对于本教程中的学生记录，你将配置数据库以自动删除相关数据。</span><span class="sxs-lookup"><span data-stu-id="dbabb-146">For student records in this tutorial, you'll configure the database to delete the related data automatically.</span></span> <span data-ttu-id="dbabb-147">由于学生只能在 `StudentGrade` 表中有相关的行，因此只需配置这三个关系之一。</span><span class="sxs-lookup"><span data-stu-id="dbabb-147">Because students can have related rows only in the `StudentGrade` table, you need to configure only one of the three relationships.</span></span>

<span data-ttu-id="dbabb-148">如果使用从本教程中的项目下载的*School .mdf*文件，则可以跳过此部分，因为这些配置更改已经完成。</span><span class="sxs-lookup"><span data-stu-id="dbabb-148">If you're using the *School.mdf* file that you downloaded from the project that goes with this tutorial, you can skip this section because these configuration changes have already been done.</span></span> <span data-ttu-id="dbabb-149">如果通过运行脚本来创建数据库，请通过执行以下过程来配置数据库。</span><span class="sxs-lookup"><span data-stu-id="dbabb-149">If you created the database by running a script, configure the database by performing the following procedures.</span></span>

<span data-ttu-id="dbabb-150">在**服务器资源管理器**中，打开你在第1部分中创建的数据库关系图。</span><span class="sxs-lookup"><span data-stu-id="dbabb-150">In **Server Explorer**, open the database diagram that you created in part 1.</span></span> <span data-ttu-id="dbabb-151">右键单击 "`Person`" 和 "`StudentGrade`" 之间的关系（"表之间的线条"），然后选择 "**属性**"。</span><span class="sxs-lookup"><span data-stu-id="dbabb-151">Right-click the relationship between `Person` and `StudentGrade` (the line between tables), and then select **Properties**.</span></span>

<span data-ttu-id="dbabb-152">[![Image04](the-entity-framework-and-aspnet-getting-started-part-2/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-152">[![Image04](the-entity-framework-and-aspnet-getting-started-part-2/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image19.png)</span></span>

<span data-ttu-id="dbabb-153">在 "**属性**" 窗口中，展开 "**插入并更新规范**"，并将 " **DeleteRule** " 属性设置为**Cascade**。</span><span class="sxs-lookup"><span data-stu-id="dbabb-153">In the **Properties** window, expand **INSERT and UPDATE Specification** and set the **DeleteRule** property to **Cascade**.</span></span>

<span data-ttu-id="dbabb-154">[![Image05](the-entity-framework-and-aspnet-getting-started-part-2/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-154">[![Image05](the-entity-framework-and-aspnet-getting-started-part-2/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image21.png)</span></span>

<span data-ttu-id="dbabb-155">保存并关闭关系图。</span><span class="sxs-lookup"><span data-stu-id="dbabb-155">Save and close the diagram.</span></span> <span data-ttu-id="dbabb-156">如果系统询问您是否要更新数据库，请单击 **"是"** 。</span><span class="sxs-lookup"><span data-stu-id="dbabb-156">If you're asked whether you want to update the database, click **Yes**.</span></span>

<span data-ttu-id="dbabb-157">若要确保模型将内存中的实体与数据库所执行的操作保持同步，必须在数据模型中设置相应的规则。</span><span class="sxs-lookup"><span data-stu-id="dbabb-157">To make sure that the model keeps entities that are in memory in sync with what the database is doing, you must set corresponding rules in the data model.</span></span> <span data-ttu-id="dbabb-158">打开*SchoolModel*，右键单击 `Person` 和 `StudentGrade`之间的关联线，然后选择 "**属性**"。</span><span class="sxs-lookup"><span data-stu-id="dbabb-158">Open *SchoolModel.edmx*, right-click the association line between `Person` and `StudentGrade`, and then select **Properties**.</span></span>

<span data-ttu-id="dbabb-159">[![Image21](the-entity-framework-and-aspnet-getting-started-part-2/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-159">[![Image21](the-entity-framework-and-aspnet-getting-started-part-2/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image23.png)</span></span>

<span data-ttu-id="dbabb-160">在 "**属性**" 窗口中，将**End1 OnDelete**设置为**Cascade**。</span><span class="sxs-lookup"><span data-stu-id="dbabb-160">In the **Properties** window, set **End1 OnDelete** to **Cascade**.</span></span>

<span data-ttu-id="dbabb-161">[![Image22](the-entity-framework-and-aspnet-getting-started-part-2/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-161">[![Image22](the-entity-framework-and-aspnet-getting-started-part-2/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image25.png)</span></span>

<span data-ttu-id="dbabb-162">保存并关闭*SchoolModel*文件，然后重新生成项目。</span><span class="sxs-lookup"><span data-stu-id="dbabb-162">Save and close the *SchoolModel.edmx* file, and then rebuild the project.</span></span>

<span data-ttu-id="dbabb-163">通常，当数据库发生更改时，可以选择多个选项来同步模型：</span><span class="sxs-lookup"><span data-stu-id="dbabb-163">In general, when the database changes, you have several choices for how to sync up the model:</span></span>

- <span data-ttu-id="dbabb-164">对于某些类型的更改（例如，添加或刷新表、视图或存储过程），请在设计器中右键单击，然后选择 "**从数据库更新模型**" 使设计器自动进行更改。</span><span class="sxs-lookup"><span data-stu-id="dbabb-164">For certain kinds of changes (such as adding or refreshing tables, views, or stored procedures), right-click in the designer and select **Update Model from Database** to have the designer make the changes automatically.</span></span>
- <span data-ttu-id="dbabb-165">重新生成数据模型。</span><span class="sxs-lookup"><span data-stu-id="dbabb-165">Regenerate the data model.</span></span>
- <span data-ttu-id="dbabb-166">进行手动更新，与此类似。</span><span class="sxs-lookup"><span data-stu-id="dbabb-166">Make manual updates like this one.</span></span>

<span data-ttu-id="dbabb-167">在这种情况下，您可以重新生成模型或刷新由关系更改影响的表，但随后必须重新进行字段名称更改（从 `FirstName` 到 `FirstMidName`）。</span><span class="sxs-lookup"><span data-stu-id="dbabb-167">In this case, you could have regenerated the model or refreshed the tables affected by the relationship change, but then you'd have to make the field-name change again (from `FirstName` to `FirstMidName`).</span></span>

## <a name="using-a-gridview-control-to-read-and-update-entities"></a><span data-ttu-id="dbabb-168">使用 GridView 控件读取和更新实体</span><span class="sxs-lookup"><span data-stu-id="dbabb-168">Using a GridView Control to Read and Update Entities</span></span>

<span data-ttu-id="dbabb-169">在本部分中，你将使用 `GridView` 控件来显示、更新或删除学生。</span><span class="sxs-lookup"><span data-stu-id="dbabb-169">In this section you'll use a `GridView` control to display, update, or delete students.</span></span>

<span data-ttu-id="dbabb-170">打开或切换到 "student *" 并切换到 "* **设计**" 视图。</span><span class="sxs-lookup"><span data-stu-id="dbabb-170">Open or switch to *Students.aspx* and switch to **Design** view.</span></span> <span data-ttu-id="dbabb-171">从 "**工具箱**" 的 "**数据**" 选项卡中，将 `GridView` 控件拖动到 `EntityDataSource` 控件的右侧，将其命名为 `StudentsGridView`，单击智能标记，然后选择 " **StudentsEntityDataSource** " 作为数据源。</span><span class="sxs-lookup"><span data-stu-id="dbabb-171">From the **Data** tab of the **Toolbox**, drag a `GridView` control to the right of the `EntityDataSource` control, name it `StudentsGridView`, click the smart tag, and then select **StudentsEntityDataSource** as the data source.</span></span>

<span data-ttu-id="dbabb-172">[![Image06](the-entity-framework-and-aspnet-getting-started-part-2/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-172">[![Image06](the-entity-framework-and-aspnet-getting-started-part-2/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image27.png)</span></span>

<span data-ttu-id="dbabb-173">单击 "**刷新架构**" （如果系统提示确认，请单击 **"是"** ），然后单击 "**启用分页**"、"**启用排序**"、"**启用编辑**" 和 "**启用删除**"。</span><span class="sxs-lookup"><span data-stu-id="dbabb-173">Click **Refresh Schema** (click **Yes** if you're prompted to confirm), then click **Enable Paging**, **Enable Sorting**, **Enable Editing**, and **Enable Deleting**.</span></span>

<span data-ttu-id="dbabb-174">单击 "**编辑列**"。</span><span class="sxs-lookup"><span data-stu-id="dbabb-174">Click **Edit Columns**.</span></span>

<span data-ttu-id="dbabb-175">[![Image10](the-entity-framework-and-aspnet-getting-started-part-2/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-175">[![Image10](the-entity-framework-and-aspnet-getting-started-part-2/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image29.png)</span></span>

<span data-ttu-id="dbabb-176">在 "**所选字段**" 框中，删除**PersonID**、 **LastName**和**雇佣**日期。</span><span class="sxs-lookup"><span data-stu-id="dbabb-176">In the **Selected fields** box, delete **PersonID**, **LastName**, and **HireDate**.</span></span> <span data-ttu-id="dbabb-177">你通常不会向用户显示记录键，雇用日期与学生无关，你会将这两部分名称放在一个字段中，因此你只需要一个名称字段。）</span><span class="sxs-lookup"><span data-stu-id="dbabb-177">You typically don't display a record key to users, hire date is not relevant to students, and you'll put both parts of the name in one field, so you only need one of the name fields.)</span></span>

<span data-ttu-id="dbabb-178">[![Image11](the-entity-framework-and-aspnet-getting-started-part-2/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-178">[![Image11](the-entity-framework-and-aspnet-getting-started-part-2/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image31.png)</span></span>

<span data-ttu-id="dbabb-179">选择**FirstMidName**字段，然后单击 "**将此字段转换为 TemplateField**"。</span><span class="sxs-lookup"><span data-stu-id="dbabb-179">Select the **FirstMidName** field and then click **Convert this field into a TemplateField**.</span></span>

<span data-ttu-id="dbabb-180">对**EnrollmentDate**执行相同的操作。</span><span class="sxs-lookup"><span data-stu-id="dbabb-180">Do the same for **EnrollmentDate**.</span></span>

<span data-ttu-id="dbabb-181">[![Image13](the-entity-framework-and-aspnet-getting-started-part-2/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-181">[![Image13](the-entity-framework-and-aspnet-getting-started-part-2/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image33.png)</span></span>

<span data-ttu-id="dbabb-182">单击 **"确定"** ，然后切换到 "**源**" 视图。</span><span class="sxs-lookup"><span data-stu-id="dbabb-182">Click **OK** and then switch to **Source** view.</span></span> <span data-ttu-id="dbabb-183">其余更改将更容易直接在标记中进行。</span><span class="sxs-lookup"><span data-stu-id="dbabb-183">The remaining changes will be easier to do directly in markup.</span></span> <span data-ttu-id="dbabb-184">`GridView` 控件标记现在如下例所示。</span><span class="sxs-lookup"><span data-stu-id="dbabb-184">The `GridView` control markup now looks like the following example.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample3.aspx)]

<span data-ttu-id="dbabb-185">命令字段之后的第一列是当前显示名字的模板字段。</span><span class="sxs-lookup"><span data-stu-id="dbabb-185">The first column after the command field is a template field that currently displays the first name.</span></span> <span data-ttu-id="dbabb-186">更改此模板字段的标记，使其类似于以下示例：</span><span class="sxs-lookup"><span data-stu-id="dbabb-186">Change the markup for this template field to look like the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample4.aspx)]

<span data-ttu-id="dbabb-187">在显示模式下，两个 `Label` 控件显示名字和姓氏。</span><span class="sxs-lookup"><span data-stu-id="dbabb-187">In display mode, two `Label` controls display the first and last name.</span></span> <span data-ttu-id="dbabb-188">在编辑模式下，提供了两个文本框，以便您可以更改名字和姓氏。</span><span class="sxs-lookup"><span data-stu-id="dbabb-188">In edit mode, two text boxes are provided so you can change the first and last name.</span></span> <span data-ttu-id="dbabb-189">与在显示模式下 `Label` 控件一样，你可以像使用直接连接到数据库的 ASP.NET 数据源控件一样使用 `Bind` 和 `Eval` 表达式。</span><span class="sxs-lookup"><span data-stu-id="dbabb-189">As with the `Label` controls in display mode, you use `Bind` and `Eval` expressions exactly as you would with ASP.NET data source controls that connect directly to databases.</span></span> <span data-ttu-id="dbabb-190">唯一的差别在于，您指定的是实体属性而不是数据库列。</span><span class="sxs-lookup"><span data-stu-id="dbabb-190">The only difference is that you're specifying entity properties instead of database columns.</span></span>

<span data-ttu-id="dbabb-191">最后一列是显示注册日期的模板字段。</span><span class="sxs-lookup"><span data-stu-id="dbabb-191">The last column is a template field that displays the enrollment date.</span></span> <span data-ttu-id="dbabb-192">更改此字段的标记，使其类似于以下示例：</span><span class="sxs-lookup"><span data-stu-id="dbabb-192">Change the markup for this field to look like the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample5.aspx)]

<span data-ttu-id="dbabb-193">在显示模式和编辑模式下，格式字符串 "{0，d}" 会使日期以 "短日期" 格式显示。</span><span class="sxs-lookup"><span data-stu-id="dbabb-193">In both display and edit mode, the format string "{0,d}" causes the date to be displayed in the "short date" format.</span></span> <span data-ttu-id="dbabb-194">（您的计算机可能配置为以不同于本教程中所示的屏幕图像显示此格式。）</span><span class="sxs-lookup"><span data-stu-id="dbabb-194">(Your computer might be configured to display this format differently from the screen images shown in this tutorial.)</span></span>

<span data-ttu-id="dbabb-195">请注意，在每个模板字段中，设计器默认使用 `Bind` 表达式，但您已将其更改为 `ItemTemplate` 元素中的 `Eval` 表达式。</span><span class="sxs-lookup"><span data-stu-id="dbabb-195">Notice that in each of these template fields, the designer used a `Bind` expression by default, but you've changed that to an `Eval` expression in the `ItemTemplate` elements.</span></span> <span data-ttu-id="dbabb-196">`Bind` 表达式使数据在 `GridView` 控件属性中可用，以防需要在代码中访问数据。</span><span class="sxs-lookup"><span data-stu-id="dbabb-196">The `Bind` expression makes the data available in `GridView` control properties in case you need to access the data in code.</span></span> <span data-ttu-id="dbabb-197">在此页中，您不需要在代码中访问此数据，因此您可以使用 `Eval`，这种效率更高。</span><span class="sxs-lookup"><span data-stu-id="dbabb-197">In this page you don't need to access this data in code, so you can use `Eval`, which is more efficient.</span></span> <span data-ttu-id="dbabb-198">有关详细信息，请参阅[从数据控件中获取数据](https://weblogs.asp.net/davidfowler/archive/2008/12/12/getting-your-data-out-of-the-data-controls.aspx)。</span><span class="sxs-lookup"><span data-stu-id="dbabb-198">For more information, see [Getting your data out of the data controls](https://weblogs.asp.net/davidfowler/archive/2008/12/12/getting-your-data-out-of-the-data-controls.aspx).</span></span>

## <a name="revising-entitydatasource-control-markup-to-improve-performance"></a><span data-ttu-id="dbabb-199">修改 EntityDataSource 控件标记以提高性能</span><span class="sxs-lookup"><span data-stu-id="dbabb-199">Revising EntityDataSource Control Markup to Improve Performance</span></span>

<span data-ttu-id="dbabb-200">在 `EntityDataSource` 控件的标记中，删除 `ConnectionString` 和 `DefaultContainerName` 属性，并将其替换为 `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` 特性。</span><span class="sxs-lookup"><span data-stu-id="dbabb-200">In the markup for the `EntityDataSource` control, remove the `ConnectionString` and `DefaultContainerName` attributes and replace them with a `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` attribute.</span></span> <span data-ttu-id="dbabb-201">这是每次创建 `EntityDataSource` 控件时应进行的更改，除非你需要使用与在对象上下文类中进行硬编码的连接不同的连接。</span><span class="sxs-lookup"><span data-stu-id="dbabb-201">This is a change you should make every time you create an `EntityDataSource` control, unless you need to use a connection that is different from the one that's hard-coded in the object context class.</span></span> <span data-ttu-id="dbabb-202">使用 `ContextTypeName` 特性具有以下优势：</span><span class="sxs-lookup"><span data-stu-id="dbabb-202">Using the `ContextTypeName` attribute provides the following benefits:</span></span>

- <span data-ttu-id="dbabb-203">性能更好。</span><span class="sxs-lookup"><span data-stu-id="dbabb-203">Better performance.</span></span> <span data-ttu-id="dbabb-204">当 `EntityDataSource` 控件使用 `ConnectionString` 和 `DefaultContainerName` 特性初始化数据模型时，它将执行额外的工作以加载每个请求的元数据。</span><span class="sxs-lookup"><span data-stu-id="dbabb-204">When the `EntityDataSource` control initializes the data model using the `ConnectionString` and `DefaultContainerName` attributes, it performs additional work to load metadata on every request.</span></span> <span data-ttu-id="dbabb-205">如果指定 `ContextTypeName` 属性，则不是必需的。</span><span class="sxs-lookup"><span data-stu-id="dbabb-205">This isn't necessary if you specify the `ContextTypeName` attribute.</span></span>
- <span data-ttu-id="dbabb-206">默认情况下，延迟加载在实体框架4.0 中生成的对象上下文类（如本教程 `SchoolEntities`）中处于打开状态。</span><span class="sxs-lookup"><span data-stu-id="dbabb-206">Lazy loading is turned on by default in generated object context classes (such as `SchoolEntities` in this tutorial) in Entity Framework 4.0.</span></span> <span data-ttu-id="dbabb-207">这意味着，导航属性将在需要时自动加载相关数据。</span><span class="sxs-lookup"><span data-stu-id="dbabb-207">This means that navigation properties are loaded with related data automatically right when you need it.</span></span> <span data-ttu-id="dbabb-208">稍后将在本教程中更详细地介绍延迟加载。</span><span class="sxs-lookup"><span data-stu-id="dbabb-208">Lazy loading is explained in more detail later in this tutorial.</span></span>
- <span data-ttu-id="dbabb-209">已应用于对象上下文类的所有自定义项（在此示例中，`SchoolEntities` 类）将可用于使用 `EntityDataSource` 控件的控件。</span><span class="sxs-lookup"><span data-stu-id="dbabb-209">Any customizations that you've applied to the object context class (in this case, the `SchoolEntities` class) will be available to controls that use the `EntityDataSource` control.</span></span> <span data-ttu-id="dbabb-210">自定义对象上下文类是本系列教程未涵盖的高级主题。</span><span class="sxs-lookup"><span data-stu-id="dbabb-210">Customizing the object context class is an advanced topic that is not covered in this tutorial series.</span></span> <span data-ttu-id="dbabb-211">有关详细信息，请参阅[扩展实体框架生成的类型](https://msdn.microsoft.com/library/dd456844.aspx)。</span><span class="sxs-lookup"><span data-stu-id="dbabb-211">For more information, see [Extending Entity Framework Generated Types](https://msdn.microsoft.com/library/dd456844.aspx).</span></span>

<span data-ttu-id="dbabb-212">标记现在将类似于以下示例（属性的顺序可能不同）：</span><span class="sxs-lookup"><span data-stu-id="dbabb-212">The markup will now resemble the following example (the order of the properties might be different):</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample6.aspx)]

<span data-ttu-id="dbabb-213">`EnableFlattening` 属性指的是早期版本的实体框架中所需的功能，因为外键列并未作为实体属性公开。</span><span class="sxs-lookup"><span data-stu-id="dbabb-213">The `EnableFlattening` attribute refers to a feature that was needed in earlier versions of the Entity Framework because foreign key columns were not exposed as entity properties.</span></span> <span data-ttu-id="dbabb-214">当前版本允许使用*外键关联*，这意味着外键属性是针对所有但多对多关联公开的。</span><span class="sxs-lookup"><span data-stu-id="dbabb-214">The current version makes it possible to use *foreign key associations*, which means foreign key properties are exposed for all but many-to-many associations.</span></span> <span data-ttu-id="dbabb-215">如果实体具有外键属性，而没有[复杂类型](https://msdn.microsoft.com/library/bb738472.aspx)，则可以将此特性设置为 `False`。</span><span class="sxs-lookup"><span data-stu-id="dbabb-215">If your entities have foreign key properties and no [complex types](https://msdn.microsoft.com/library/bb738472.aspx), you can leave this attribute set to `False`.</span></span> <span data-ttu-id="dbabb-216">请勿从标记中删除属性，因为默认值为 `True`。</span><span class="sxs-lookup"><span data-stu-id="dbabb-216">Don't remove the attribute from the markup, because the default value is `True`.</span></span> <span data-ttu-id="dbabb-217">有关详细信息，请参阅[平展对象（EntityDataSource）](https://msdn.microsoft.com/library/ee404746.aspx)。</span><span class="sxs-lookup"><span data-stu-id="dbabb-217">For more information, see [Flattening Objects (EntityDataSource)](https://msdn.microsoft.com/library/ee404746.aspx).</span></span>

<span data-ttu-id="dbabb-218">运行页面，你将看到学生和员工的列表（在下一教程中，你将仅针对学生进行筛选）。</span><span class="sxs-lookup"><span data-stu-id="dbabb-218">Run the page and you see a list of students and employees (you'll filter for just students in the next tutorial).</span></span> <span data-ttu-id="dbabb-219">名字和姓氏一起显示在一起。</span><span class="sxs-lookup"><span data-stu-id="dbabb-219">The first name and last name are displayed together.</span></span>

<span data-ttu-id="dbabb-220">[![Image07](the-entity-framework-and-aspnet-getting-started-part-2/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-220">[![Image07](the-entity-framework-and-aspnet-getting-started-part-2/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image35.png)</span></span>

<span data-ttu-id="dbabb-221">若要对显示进行排序，请单击列名称。</span><span class="sxs-lookup"><span data-stu-id="dbabb-221">To sort the display, click a column name.</span></span>

<span data-ttu-id="dbabb-222">单击任意行中的 "**编辑**"。</span><span class="sxs-lookup"><span data-stu-id="dbabb-222">Click **Edit** in any row.</span></span> <span data-ttu-id="dbabb-223">此时会显示文本框，可以在其中更改名字和姓氏。</span><span class="sxs-lookup"><span data-stu-id="dbabb-223">Text boxes are displayed where you can change the first and last name.</span></span>

<span data-ttu-id="dbabb-224">[![Image08](the-entity-framework-and-aspnet-getting-started-part-2/_static/image38.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-224">[![Image08](the-entity-framework-and-aspnet-getting-started-part-2/_static/image38.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image37.png)</span></span>

<span data-ttu-id="dbabb-225">"**删除**" 按钮也可以正常工作。</span><span class="sxs-lookup"><span data-stu-id="dbabb-225">The **Delete** button also works.</span></span> <span data-ttu-id="dbabb-226">对于具有注册日期的行，单击 "删除"，该行将会消失。</span><span class="sxs-lookup"><span data-stu-id="dbabb-226">Click delete for a row that has an enrollment date and the row disappears.</span></span> <span data-ttu-id="dbabb-227">（无注册日期的行表示讲师，你可能会收到引用完整性错误。</span><span class="sxs-lookup"><span data-stu-id="dbabb-227">(Rows without an enrollment date represent instructors and you may get a referential integrity error.</span></span> <span data-ttu-id="dbabb-228">在下一教程中，你将筛选此列表，使其仅包含学生。）</span><span class="sxs-lookup"><span data-stu-id="dbabb-228">In the next tutorial you'll filter this list to include just students.)</span></span>

## <a name="displaying-data-from-a-navigation-property"></a><span data-ttu-id="dbabb-229">显示导航属性中的数据</span><span class="sxs-lookup"><span data-stu-id="dbabb-229">Displaying Data from a Navigation Property</span></span>

<span data-ttu-id="dbabb-230">现在假设你想要了解每个学生注册的课程数。</span><span class="sxs-lookup"><span data-stu-id="dbabb-230">Now suppose you want to know how many courses each student is enrolled in.</span></span> <span data-ttu-id="dbabb-231">实体框架在 `Person` 实体的 `StudentGrades` 导航属性中提供这些信息。</span><span class="sxs-lookup"><span data-stu-id="dbabb-231">The Entity Framework provides that information in the `StudentGrades` navigation property of the `Person` entity.</span></span> <span data-ttu-id="dbabb-232">由于数据库设计不允许学生在没有分配评分的情况下注册，因此，对于本教程，您可以假设与课程关联的 `StudentGrade` 表行中的行与在课程中注册的行相同。</span><span class="sxs-lookup"><span data-stu-id="dbabb-232">Because the database design does not allow a student to be enrolled in a course without having a grade assigned, for this tutorial you can assume that having a row in the `StudentGrade` table row that is associated with a course is the same as being enrolled in the course.</span></span> <span data-ttu-id="dbabb-233">（`Courses` 导航属性仅适用于讲师。）</span><span class="sxs-lookup"><span data-stu-id="dbabb-233">(The `Courses` navigation property is only for instructors.)</span></span>

<span data-ttu-id="dbabb-234">当你使用 `EntityDataSource` 控件的 `ContextTypeName` 属性时，在访问该属性时，实体框架会自动检索导航属性的信息。</span><span class="sxs-lookup"><span data-stu-id="dbabb-234">When you use the `ContextTypeName` attribute of the `EntityDataSource` control, the Entity Framework automatically retrieves information for a navigation property when you access that property.</span></span> <span data-ttu-id="dbabb-235">这称为 "*延迟加载*"。</span><span class="sxs-lookup"><span data-stu-id="dbabb-235">This is called *lazy loading*.</span></span> <span data-ttu-id="dbabb-236">但是，这可能效率低下，因为这会导致每次需要额外信息时都单独调用数据库。</span><span class="sxs-lookup"><span data-stu-id="dbabb-236">However, this can be inefficient, because it results in a separate call to the database each time additional information is needed.</span></span> <span data-ttu-id="dbabb-237">如果您需要 `EntityDataSource` 控件返回的每个实体的导航属性中的数据，则在对数据库的单个调用中检索相关数据以及实体本身会更有效。</span><span class="sxs-lookup"><span data-stu-id="dbabb-237">If you need data from the navigation property for every entity returned by the `EntityDataSource` control, it's more efficient to retrieve the related data along with the entity itself in a single call to the database.</span></span> <span data-ttu-id="dbabb-238">这称为*预先加载*，通过设置 `EntityDataSource` 控件的 `Include` 属性，为导航属性指定预先加载。</span><span class="sxs-lookup"><span data-stu-id="dbabb-238">This is called *eager loading*, and you specify eager loading for a navigation property by setting the `Include` property of the `EntityDataSource` control.</span></span>

<span data-ttu-id="dbabb-239">在*default.aspx*中，你希望显示每个学生的课程数量，因此预先加载是最佳选择。</span><span class="sxs-lookup"><span data-stu-id="dbabb-239">In *Students.aspx*, you want to show the number of courses for every student, so eager loading is the best choice.</span></span> <span data-ttu-id="dbabb-240">如果你正在显示所有学生，但只显示几个课程的课程数量（这需要编写除标记之外的一些代码），则延迟加载可能是更好的选择。</span><span class="sxs-lookup"><span data-stu-id="dbabb-240">If you were displaying all students but showing the number of courses only for a few of them (which would require writing some code in addition to the markup), lazy loading might be a better choice.</span></span>

<span data-ttu-id="dbabb-241">打开或切换到 *"student*"，切换到 "**设计**" 视图，选择 "`StudentsEntityDataSource`"，然后在 "**属性**" 窗口中将 " **StudentGrades**" 属性设置**为 ""** 。</span><span class="sxs-lookup"><span data-stu-id="dbabb-241">Open or switch to *Students.aspx*, switch to **Design** view, select `StudentsEntityDataSource`, and in the **Properties** window set the **Include** property to **StudentGrades**.</span></span> <span data-ttu-id="dbabb-242">（如果你想要获取多个导航属性，则可以指定它们的名称，用逗号分隔，例如**StudentGrades、课程**。）</span><span class="sxs-lookup"><span data-stu-id="dbabb-242">(If you wanted to get multiple navigation properties, you could specify their names separated by commas — for example, **StudentGrades, Courses**.)</span></span>

<span data-ttu-id="dbabb-243">[![Image19](the-entity-framework-and-aspnet-getting-started-part-2/_static/image40.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-243">[![Image19](the-entity-framework-and-aspnet-getting-started-part-2/_static/image40.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image39.png)</span></span>

<span data-ttu-id="dbabb-244">切换到 "**源**" 视图。</span><span class="sxs-lookup"><span data-stu-id="dbabb-244">Switch to **Source** view.</span></span> <span data-ttu-id="dbabb-245">在 `StudentsGridView` 控件中的最后一个 `asp:TemplateField` 元素之后，添加以下新的模板字段：</span><span class="sxs-lookup"><span data-stu-id="dbabb-245">In the `StudentsGridView` control, after the last `asp:TemplateField` element, add the following new template field:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample7.aspx)]

<span data-ttu-id="dbabb-246">在 `Eval` 表达式中，可以 `StudentGrades`引用导航属性。</span><span class="sxs-lookup"><span data-stu-id="dbabb-246">In the `Eval` expression, you can reference the navigation property `StudentGrades`.</span></span> <span data-ttu-id="dbabb-247">由于此属性包含一个集合，因此它具有一个 `Count` 属性，您可以使用该属性来显示注册了学生的课程的数目。</span><span class="sxs-lookup"><span data-stu-id="dbabb-247">Because this property contains a collection, it has a `Count` property that you can use to display the number of courses in which the student is enrolled.</span></span> <span data-ttu-id="dbabb-248">在后面的教程中，你将了解如何显示包含单个实体而不是集合的导航属性中的数据。</span><span class="sxs-lookup"><span data-stu-id="dbabb-248">In a later tutorial you'll see how to display data from navigation properties that contain single entities instead of collections.</span></span> <span data-ttu-id="dbabb-249">（请注意，不能使用 `BoundField` 元素显示导航属性中的数据。）</span><span class="sxs-lookup"><span data-stu-id="dbabb-249">(Note that you cannot use `BoundField` elements to display data from navigation properties.)</span></span>

<span data-ttu-id="dbabb-250">运行该页，现在可以看到每个学生注册了多少课程。</span><span class="sxs-lookup"><span data-stu-id="dbabb-250">Run the page and you now see how many courses each student is enrolled in.</span></span>

<span data-ttu-id="dbabb-251">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image42.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image41.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-251">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image42.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image41.png)</span></span>

## <a name="using-a-detailsview-control-to-insert-entities"></a><span data-ttu-id="dbabb-252">使用 DetailsView 控件插入实体</span><span class="sxs-lookup"><span data-stu-id="dbabb-252">Using a DetailsView Control to Insert Entities</span></span>

<span data-ttu-id="dbabb-253">下一步是创建一个具有 `DetailsView` 控件的页面，您可以在其中添加新的学生。</span><span class="sxs-lookup"><span data-stu-id="dbabb-253">The next step is to create a page that has a `DetailsView` control that will let you add new students.</span></span> <span data-ttu-id="dbabb-254">关闭浏览器，然后使用 "*网站*母版页" 创建新网页。</span><span class="sxs-lookup"><span data-stu-id="dbabb-254">Close the browser and then create a new web page using the *Site.Master* master page.</span></span> <span data-ttu-id="dbabb-255">将该页命名为*StudentsAdd*，然后切换到 "**源**" 视图。</span><span class="sxs-lookup"><span data-stu-id="dbabb-255">Name the page *StudentsAdd.aspx*, and then switch to **Source** view.</span></span>

<span data-ttu-id="dbabb-256">添加以下标记，以替换名为 `Content2`的 `Content` 控件的现有标记：</span><span class="sxs-lookup"><span data-stu-id="dbabb-256">Add the following markup to replace the existing markup for the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample8.aspx)]

<span data-ttu-id="dbabb-257">此标记创建一个 `EntityDataSource` 控件，该控件类似于在*default.aspx*中创建的控件，但它允许插入。</span><span class="sxs-lookup"><span data-stu-id="dbabb-257">This markup creates an `EntityDataSource` control that is similar to the one you created in *Students.aspx*, except it enables insertion.</span></span> <span data-ttu-id="dbabb-258">与 `GridView` 控件一样，`DetailsView` 控件的绑定字段的编码方式与直接连接到数据库的数据控件的绑定字段不同，只不过它们引用实体属性。</span><span class="sxs-lookup"><span data-stu-id="dbabb-258">As with the `GridView` control, the bound fields of the `DetailsView` control are coded exactly as they would be for a data control that connects directly to a database, except that they reference entity properties.</span></span> <span data-ttu-id="dbabb-259">在这种情况下，`DetailsView` 控件仅用于插入行，因此您已将默认模式设置为 `Insert`。</span><span class="sxs-lookup"><span data-stu-id="dbabb-259">In this case, the `DetailsView` control is used only for inserting rows, so you have set the default mode to `Insert`.</span></span>

<span data-ttu-id="dbabb-260">运行该页并添加新的学生。</span><span class="sxs-lookup"><span data-stu-id="dbabb-260">Run the page and add a new student.</span></span>

<span data-ttu-id="dbabb-261">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image44.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-261">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image44.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image43.png)</span></span>

<span data-ttu-id="dbabb-262">插入新的学生后不会发生什么情况，但如果你现在*运行了*student，你将看到新的学生信息。</span><span class="sxs-lookup"><span data-stu-id="dbabb-262">Nothing will happen after you insert a new student, but if you now run *Students.aspx*, you'll see the new student information.</span></span>

## <a name="displaying-data-in-a-drop-down-list"></a><span data-ttu-id="dbabb-263">在下拉列表中显示数据</span><span class="sxs-lookup"><span data-stu-id="dbabb-263">Displaying Data in a Drop-Down List</span></span>

<span data-ttu-id="dbabb-264">在下面的步骤中，你将使用 `EntityDataSource` 控件将 `DropDownList` 控件 databind 到实体集。</span><span class="sxs-lookup"><span data-stu-id="dbabb-264">In the following steps you'll databind a `DropDownList` control to an entity set using an `EntityDataSource` control.</span></span> <span data-ttu-id="dbabb-265">在本教程的此部分中，你将不会执行此操作。</span><span class="sxs-lookup"><span data-stu-id="dbabb-265">In this part of the tutorial, you won't do much with this list.</span></span> <span data-ttu-id="dbabb-266">但在后续部分中，你将使用列表让用户选择一个部门来显示与该部门关联的课程。</span><span class="sxs-lookup"><span data-stu-id="dbabb-266">In subsequent parts, though, you'll use the list to let users select a department to display courses associated with the department.</span></span>

<span data-ttu-id="dbabb-267">创建新的名为 "*课程*" 的网页。</span><span class="sxs-lookup"><span data-stu-id="dbabb-267">Create a new web page named *Courses.aspx*.</span></span> <span data-ttu-id="dbabb-268">在 "**源**" 视图中，将标题添加到名为 `Content2`的 `Content` 控件：</span><span class="sxs-lookup"><span data-stu-id="dbabb-268">In **Source** view, add a heading to the `Content` control that's named `Content2`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample9.aspx)]

<span data-ttu-id="dbabb-269">在 "**设计**" 视图中，像以前一样向页面添加 `EntityDataSource` 控件，只不过此时间名 `DepartmentsEntityDataSource`。</span><span class="sxs-lookup"><span data-stu-id="dbabb-269">In **Design** view, add an `EntityDataSource` control to the page as you did before, except this time name it `DepartmentsEntityDataSource`.</span></span> <span data-ttu-id="dbabb-270">选择 "**部门**" 作为**EntitySetName**值，并仅选择 " **DepartmentID** " 和 " **Name** " 属性。</span><span class="sxs-lookup"><span data-stu-id="dbabb-270">Select **Departments** as the **EntitySetName** value, and select only the **DepartmentID** and **Name** properties.</span></span>

<span data-ttu-id="dbabb-271">[![Image15](the-entity-framework-and-aspnet-getting-started-part-2/_static/image46.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-271">[![Image15](the-entity-framework-and-aspnet-getting-started-part-2/_static/image46.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image45.png)</span></span>

<span data-ttu-id="dbabb-272">从 "工具箱" 的 "**标准**" 选项卡中，将 **"** `DropDownList`" 控件拖动到页面上，将其命名为 `DepartmentsDropDownList`，单击智能标记，然后选择 "**选择数据源**" 以启动 "数据源**配置向导**"。</span><span class="sxs-lookup"><span data-stu-id="dbabb-272">From the **Standard** tab of the **Toolbox**, drag a `DropDownList` control to the page, name it `DepartmentsDropDownList`, click the smart tag, and select **Choose Data Source** to start the **DataSource Configuration Wizard**.</span></span>

<span data-ttu-id="dbabb-273">[![Image16](the-entity-framework-and-aspnet-getting-started-part-2/_static/image48.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image47.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-273">[![Image16](the-entity-framework-and-aspnet-getting-started-part-2/_static/image48.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image47.png)</span></span>

<span data-ttu-id="dbabb-274">在 "**选择数据源**" 步骤中，选择 " **DepartmentsEntityDataSource** " 作为数据源，单击 "**刷新架构**"，然后选择 "**名称**" 作为要显示的数据字段，并选择 " **DepartmentID** " 作为值数据字段。</span><span class="sxs-lookup"><span data-stu-id="dbabb-274">In the **Choose a Data Source** step, select **DepartmentsEntityDataSource** as the data source, click **Refresh Schema**, and then select **Name** as the data field to display and **DepartmentID** as the value data field.</span></span> <span data-ttu-id="dbabb-275">单击“确定”。</span><span class="sxs-lookup"><span data-stu-id="dbabb-275">Click **OK**.</span></span>

<span data-ttu-id="dbabb-276">[![Image17](the-entity-framework-and-aspnet-getting-started-part-2/_static/image50.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-276">[![Image17](the-entity-framework-and-aspnet-getting-started-part-2/_static/image50.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image49.png)</span></span>

<span data-ttu-id="dbabb-277">使用实体框架对控件进行数据绑定的方法与其他 ASP.NET 数据源控件相同，不同之处在于指定实体和实体属性。</span><span class="sxs-lookup"><span data-stu-id="dbabb-277">The method you use to databind the control using the Entity Framework is the same as with other ASP.NET data source controls except you're specifying entities and entity properties.</span></span>

<span data-ttu-id="dbabb-278">切换到 "**源**" 视图，并在 `DropDownList` 控件之前添加 "选择一个部门："。</span><span class="sxs-lookup"><span data-stu-id="dbabb-278">Switch to **Source** view and add "Select a department:" immediately before the `DropDownList` control.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample10.aspx)]

<span data-ttu-id="dbabb-279">作为提醒，请将 `ConnectionString` 和 `DefaultContainerName` 特性替换为 `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` 特性，此时更改 `EntityDataSource` 控件的标记。</span><span class="sxs-lookup"><span data-stu-id="dbabb-279">As a reminder, change the markup for the `EntityDataSource` control at this point by replacing the `ConnectionString` and `DefaultContainerName` attributes with a `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` attribute.</span></span> <span data-ttu-id="dbabb-280">在更改 `EntityDataSource` 控件标记之前，通常最好等待，直到创建了链接到数据源控件的数据绑定控件，因为在进行更改后，设计器不会在数据绑定控件中提供**刷新架构**选项。</span><span class="sxs-lookup"><span data-stu-id="dbabb-280">It's often best to wait until after you've created the data-bound control that is linked to the data source control before you change the `EntityDataSource` control markup, because after you make the change, the designer will not provide you with a **Refresh Schema** option in the data-bound control.</span></span>

<span data-ttu-id="dbabb-281">运行页面，您可以从下拉列表中选择一个部门。</span><span class="sxs-lookup"><span data-stu-id="dbabb-281">Run the page and you can select a department from the drop-down list.</span></span>

<span data-ttu-id="dbabb-282">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image52.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image51.png)</span><span class="sxs-lookup"><span data-stu-id="dbabb-282">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image52.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image51.png)</span></span>

<span data-ttu-id="dbabb-283">这将完成使用 `EntityDataSource` 控件的简介。</span><span class="sxs-lookup"><span data-stu-id="dbabb-283">This completes the introduction to using the `EntityDataSource` control.</span></span> <span data-ttu-id="dbabb-284">通常，使用此控件与使用其他 ASP.NET 数据源控件没有什么不同，只是引用实体和属性，而不是引用表和列。</span><span class="sxs-lookup"><span data-stu-id="dbabb-284">Working with this control is generally no different from working with other ASP.NET data source controls, except that you reference entities and properties instead of tables and columns.</span></span> <span data-ttu-id="dbabb-285">唯一的例外是要访问导航属性。</span><span class="sxs-lookup"><span data-stu-id="dbabb-285">The only exception is when you want to access navigation properties.</span></span> <span data-ttu-id="dbabb-286">在下一教程中，您将看到，在对数据进行筛选、分组和排序时，您用于 `EntityDataSource` 控件的语法也可能与其他数据源控件不同。</span><span class="sxs-lookup"><span data-stu-id="dbabb-286">In the next tutorial you'll see that the syntax you use with `EntityDataSource` control might also differ from other data source controls when you filter, group, and order data.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="dbabb-287">[上一页](the-entity-framework-and-aspnet-getting-started-part-1.md)
> [下一页](the-entity-framework-and-aspnet-getting-started-part-3.md)</span><span class="sxs-lookup"><span data-stu-id="dbabb-287">[Previous](the-entity-framework-and-aspnet-getting-started-part-1.md)
[Next](the-entity-framework-and-aspnet-getting-started-part-3.md)</span></span>
