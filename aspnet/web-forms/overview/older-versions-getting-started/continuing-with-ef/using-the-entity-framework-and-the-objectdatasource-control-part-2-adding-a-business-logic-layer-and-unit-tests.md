---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests
title: 使用实体框架4.0 和 ObjectDataSource 控件，第2部分：添加业务逻辑层和单元测试 |Microsoft Docs
author: tdykstra
description: 本教程系列在使用实体框架4.0 教程系列的入门创建的 Contoso 大学 web 应用程序上构建。 I...
ms.author: riande
ms.date: 01/26/2011
ms.assetid: efb0e677-10b8-48dc-93d3-9ba3902dd807
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests
msc.type: authoredcontent
ms.openlocfilehash: 24344cc33d7c26d7c408db26c0530ef2c708a7d3
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/06/2020
ms.locfileid: "78439952"
---
# <a name="using-the-entity-framework-40-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests"></a><span data-ttu-id="678ca-104">使用实体框架4.0 和 ObjectDataSource 控件，第2部分：添加业务逻辑层和单元测试</span><span class="sxs-lookup"><span data-stu-id="678ca-104">Using the Entity Framework 4.0 and the ObjectDataSource Control, Part 2: Adding a Business Logic Layer and Unit Tests</span></span>

<span data-ttu-id="678ca-105">作者： [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="678ca-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="678ca-106">本教程系列在[使用实体框架 4.0](https://asp.net/entity-framework/tutorials#Getting%20Started)教程系列的入门创建的 Contoso 大学 web 应用程序上构建。</span><span class="sxs-lookup"><span data-stu-id="678ca-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](https://asp.net/entity-framework/tutorials#Getting%20Started) tutorial series.</span></span> <span data-ttu-id="678ca-107">如果你没有完成前面的教程，作为本教程的起点，你可以下载你要创建[的应用程序](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a)。</span><span class="sxs-lookup"><span data-stu-id="678ca-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="678ca-108">你还可以下载完整的系列教程创建的[应用程序](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa)。</span><span class="sxs-lookup"><span data-stu-id="678ca-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span> <span data-ttu-id="678ca-109">如果有关于这些教程的问题，可以将其发布到[ASP.NET 实体框架论坛](https://forums.asp.net/1227.aspx)。</span><span class="sxs-lookup"><span data-stu-id="678ca-109">If you have questions about the tutorials, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx).</span></span>

<span data-ttu-id="678ca-110">在上一教程中，你使用实体框架和 `ObjectDataSource` 控件创建了一个 n 层 web 应用程序。</span><span class="sxs-lookup"><span data-stu-id="678ca-110">In the previous tutorial you created an n-tier web application using the Entity Framework and the `ObjectDataSource` control.</span></span> <span data-ttu-id="678ca-111">本教程介绍如何在保持业务逻辑层（BLL）和数据访问层（DAL）的同时添加业务逻辑，并说明如何为 BLL 创建自动单元测试。</span><span class="sxs-lookup"><span data-stu-id="678ca-111">This tutorial shows how to add business logic while keeping the business-logic layer (BLL) and the data-access layer (DAL) separate, and it shows how to create automated unit tests for the BLL.</span></span>

<span data-ttu-id="678ca-112">在本教程中，你将完成以下任务：</span><span class="sxs-lookup"><span data-stu-id="678ca-112">In this tutorial you'll complete the following tasks:</span></span>

- <span data-ttu-id="678ca-113">创建一个存储库接口，用于声明所需的数据访问方法。</span><span class="sxs-lookup"><span data-stu-id="678ca-113">Create a repository interface that declares the data-access methods you need.</span></span>
- <span data-ttu-id="678ca-114">在存储库类中实现存储库接口。</span><span class="sxs-lookup"><span data-stu-id="678ca-114">Implement the repository interface in the repository class.</span></span>
- <span data-ttu-id="678ca-115">创建一个业务逻辑类，该类调用存储库类来执行数据访问函数。</span><span class="sxs-lookup"><span data-stu-id="678ca-115">Create a business-logic class that calls the repository class to perform data-access functions.</span></span>
- <span data-ttu-id="678ca-116">将 `ObjectDataSource` 控件连接到业务逻辑类，而不是存储库类。</span><span class="sxs-lookup"><span data-stu-id="678ca-116">Connect the `ObjectDataSource` control to the business-logic class instead of to the repository class.</span></span>
- <span data-ttu-id="678ca-117">创建单元测试项目，并使用内存中集合的数据存储区。</span><span class="sxs-lookup"><span data-stu-id="678ca-117">Create a unit-test project and a repository class that uses in-memory collections for its data store.</span></span>
- <span data-ttu-id="678ca-118">为想要添加到业务逻辑类的业务逻辑创建单元测试，然后运行测试并查看其失败。</span><span class="sxs-lookup"><span data-stu-id="678ca-118">Create a unit test for business logic that you want to add to the business-logic class, then run the test and see it fail.</span></span>
- <span data-ttu-id="678ca-119">在业务逻辑类中实现业务逻辑，然后重新运行单元测试并查看它是否通过。</span><span class="sxs-lookup"><span data-stu-id="678ca-119">Implement the business logic in the business-logic class, then re-run the unit test and see it pass.</span></span>

<span data-ttu-id="678ca-120">你将使用在上一教程中创建的*DepartmentsAdd 和 .aspx*页。</span><span class="sxs-lookup"><span data-stu-id="678ca-120">You'll work with the *Departments.aspx* and *DepartmentsAdd.aspx* pages that you created in the previous tutorial.</span></span>

## <a name="creating-a-repository-interface"></a><span data-ttu-id="678ca-121">创建存储库接口</span><span class="sxs-lookup"><span data-stu-id="678ca-121">Creating a Repository Interface</span></span>

<span data-ttu-id="678ca-122">首先，你将创建存储库接口。</span><span class="sxs-lookup"><span data-stu-id="678ca-122">You'll begin by creating the repository interface.</span></span>

<span data-ttu-id="678ca-123">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="678ca-123">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image1.png)</span></span>

<span data-ttu-id="678ca-124">在*DAL*文件夹中，创建一个新的类文件，将其命名为*ISchoolRepository.cs*，并将现有代码替换为以下代码：</span><span class="sxs-lookup"><span data-stu-id="678ca-124">In the *DAL* folder, create a new class file, name it *ISchoolRepository.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample1.cs)]

<span data-ttu-id="678ca-125">接口为你在存储库类中创建的每个 CRUD （创建、读取、更新、删除）方法定义一个方法。</span><span class="sxs-lookup"><span data-stu-id="678ca-125">The interface defines one method for each of the CRUD (create, read, update, delete) methods that you created in the repository class.</span></span>

<span data-ttu-id="678ca-126">在*SchoolRepository.cs*中的 `SchoolRepository` 类中，指示此类实现 `ISchoolRepository` 接口：</span><span class="sxs-lookup"><span data-stu-id="678ca-126">In the `SchoolRepository` class in *SchoolRepository.cs*, indicate that this class implements the `ISchoolRepository` interface:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample2.cs)]

## <a name="creating-a-business-logic-class"></a><span data-ttu-id="678ca-127">创建业务逻辑类</span><span class="sxs-lookup"><span data-stu-id="678ca-127">Creating a Business-Logic Class</span></span>

<span data-ttu-id="678ca-128">接下来，您将创建业务逻辑类。</span><span class="sxs-lookup"><span data-stu-id="678ca-128">Next, you'll create the business-logic class.</span></span> <span data-ttu-id="678ca-129">这样做的目的是为了能够添加将由 `ObjectDataSource` 控件执行的业务逻辑，不过您还不会这样做。</span><span class="sxs-lookup"><span data-stu-id="678ca-129">You do this so that you can add business logic that will be executed by the `ObjectDataSource` control, although you will not do that yet.</span></span> <span data-ttu-id="678ca-130">现在，新的业务逻辑类将仅执行存储库所执行的相同 CRUD 操作。</span><span class="sxs-lookup"><span data-stu-id="678ca-130">For now, the new business-logic class will only perform the same CRUD operations that the repository does.</span></span>

<span data-ttu-id="678ca-131">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="678ca-131">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image3.png)</span></span>

<span data-ttu-id="678ca-132">创建一个新文件夹并将其命名为*BLL*。</span><span class="sxs-lookup"><span data-stu-id="678ca-132">Create a new folder and name it *BLL*.</span></span> <span data-ttu-id="678ca-133">（在实际应用程序中，业务逻辑层通常将作为一个类库实现，而不是一个单独的项目，但为了简化本教程，将在项目文件夹中保留 BLL 类。）</span><span class="sxs-lookup"><span data-stu-id="678ca-133">(In a real-world application, the business-logic layer would typically be implemented as a class library — a separate project — but to keep this tutorial simple, BLL classes will be kept in a project folder.)</span></span>

<span data-ttu-id="678ca-134">在*BLL*文件夹中，创建一个新的类文件，将其命名为*SchoolBL.cs*，并将现有代码替换为以下代码：</span><span class="sxs-lookup"><span data-stu-id="678ca-134">In the *BLL* folder, create a new class file, name it *SchoolBL.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample3.cs)]

<span data-ttu-id="678ca-135">此代码将创建你在存储库类前面看到的相同 CRUD 方法，但不直接访问实体框架方法，而是调用存储库类方法。</span><span class="sxs-lookup"><span data-stu-id="678ca-135">This code creates the same CRUD methods you saw earlier in the repository class, but instead of accessing the Entity Framework methods directly, it calls the repository class methods.</span></span>

<span data-ttu-id="678ca-136">保存对存储库类的引用的类变量定义为接口类型，而实例化存储库类的代码包含在两个构造函数中。</span><span class="sxs-lookup"><span data-stu-id="678ca-136">The class variable that holds a reference to the repository class is defined as an interface type, and the code that instantiates the repository class is contained in two constructors.</span></span> <span data-ttu-id="678ca-137">`ObjectDataSource` 控件将使用无参数的构造函数。</span><span class="sxs-lookup"><span data-stu-id="678ca-137">The parameterless constructor will be used by the `ObjectDataSource` control.</span></span> <span data-ttu-id="678ca-138">它创建之前创建的 `SchoolRepository` 类的实例。</span><span class="sxs-lookup"><span data-stu-id="678ca-138">It creates an instance of the `SchoolRepository` class that you created earlier.</span></span> <span data-ttu-id="678ca-139">另一个构造函数允许对业务逻辑类进行实例化的任何代码传递到实现存储库接口的任何对象。</span><span class="sxs-lookup"><span data-stu-id="678ca-139">The other constructor allows whatever code that instantiates the business-logic class to pass in any object that implements the repository interface.</span></span>

<span data-ttu-id="678ca-140">通过调用存储库类和两个构造函数的 CRUD 方法，可以将业务逻辑类用于所选的任何后端数据存储。</span><span class="sxs-lookup"><span data-stu-id="678ca-140">The CRUD methods that call the repository class and the two constructors make it possible to use the business-logic class with whatever back-end data store you choose.</span></span> <span data-ttu-id="678ca-141">业务逻辑类无需知道它所调用的类如何持久保存数据。</span><span class="sxs-lookup"><span data-stu-id="678ca-141">The business-logic class does not need to be aware of how the class that it's calling persists the data.</span></span> <span data-ttu-id="678ca-142">（这通常称为*持久性无感知*。）这可以简化单元测试，因为可以将业务逻辑类连接到存储库实现，该实现使用与内存中 `List` 集合一样简单的内容来存储数据。</span><span class="sxs-lookup"><span data-stu-id="678ca-142">(This is often called *persistence ignorance*.) This facilitates unit testing, because you can connect the business-logic class to a repository implementation that uses something as simple as in-memory `List` collections to store data.</span></span>

> [!NOTE]
> <span data-ttu-id="678ca-143">从技术上讲，实体对象仍然不是持久性未知的，因为它们是从从实体框架的 `EntityObject` 类继承的类实例化的。</span><span class="sxs-lookup"><span data-stu-id="678ca-143">Technically, the entity objects are still not persistence-ignorant, because they're instantiated from classes that inherit from the Entity Framework's `EntityObject` class.</span></span> <span data-ttu-id="678ca-144">对于完整的持久性无感知，可以使用*普通的旧 CLR 对象*或*poco*来代替从 `EntityObject` 类继承的对象。</span><span class="sxs-lookup"><span data-stu-id="678ca-144">For complete persistence ignorance, you can use *plain old CLR objects*, or *POCOs*, in place of objects that inherit from the `EntityObject` class.</span></span> <span data-ttu-id="678ca-145">使用 Poco 超出了本教程的范围。</span><span class="sxs-lookup"><span data-stu-id="678ca-145">Using POCOs is beyond the scope of this tutorial.</span></span> <span data-ttu-id="678ca-146">有关详细信息，请参阅 MSDN 网站上的可[测试性和实体框架 4.0](https://msdn.microsoft.com/library/ff714955.aspx) 。）</span><span class="sxs-lookup"><span data-stu-id="678ca-146">For more information, see [Testability and Entity Framework 4.0](https://msdn.microsoft.com/library/ff714955.aspx) on the MSDN website.)</span></span>

<span data-ttu-id="678ca-147">现在，你可以将 `ObjectDataSource` 控件连接到业务逻辑类，而不是连接到存储库，并验证所有内容是否像以前一样正常工作。</span><span class="sxs-lookup"><span data-stu-id="678ca-147">Now you can connect the `ObjectDataSource` controls to the business-logic class instead of to the repository and verify that everything works as it did before.</span></span>

<span data-ttu-id="678ca-148">在 *.aspx*和*DepartmentsAdd*中，将 `TypeName="ContosoUniversity.DAL.SchoolRepository"` 的每个匹配项更改 `TypeName="ContosoUniversity.BLL.SchoolBL`"。</span><span class="sxs-lookup"><span data-stu-id="678ca-148">In *Departments.aspx* and *DepartmentsAdd.aspx*, change each occurrence of `TypeName="ContosoUniversity.DAL.SchoolRepository"` to `TypeName="ContosoUniversity.BLL.SchoolBL`".</span></span> <span data-ttu-id="678ca-149">（共有四个实例。）</span><span class="sxs-lookup"><span data-stu-id="678ca-149">(There are four instances in all.)</span></span>

<span data-ttu-id="678ca-150">运行 "node.js" 和 " *DepartmentsAdd* "*页，验证*它们是否仍像以前一样工作。</span><span class="sxs-lookup"><span data-stu-id="678ca-150">Run the *Departments.aspx* and *DepartmentsAdd.aspx* pages to verify that they still work as they did before.</span></span>

<span data-ttu-id="678ca-151">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="678ca-151">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image5.png)</span></span>

<span data-ttu-id="678ca-152">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="678ca-152">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image7.png)</span></span>

## <a name="creating-a-unit-test-project-and-repository-implementation"></a><span data-ttu-id="678ca-153">创建单元测试项目和存储库实现</span><span class="sxs-lookup"><span data-stu-id="678ca-153">Creating a Unit-Test Project and Repository Implementation</span></span>

<span data-ttu-id="678ca-154">使用 "**测试项目**" 模板将新项目添加到解决方案，并将其命名为 `ContosoUniversity.Tests`。</span><span class="sxs-lookup"><span data-stu-id="678ca-154">Add a new project to the solution using the **Test Project** template, and name it `ContosoUniversity.Tests`.</span></span>

<span data-ttu-id="678ca-155">在测试项目中，添加对 `System.Data.Entity` 的引用并将项目引用添加到 `ContosoUniversity` 项目。</span><span class="sxs-lookup"><span data-stu-id="678ca-155">In the test project, add a reference to `System.Data.Entity` and add a project reference to the `ContosoUniversity` project.</span></span>

<span data-ttu-id="678ca-156">你现在可以创建将用于单元测试的存储库类。</span><span class="sxs-lookup"><span data-stu-id="678ca-156">You can now create the repository class that you'll use with unit tests.</span></span> <span data-ttu-id="678ca-157">此存储库的数据存储将位于类中。</span><span class="sxs-lookup"><span data-stu-id="678ca-157">The data store for this repository will be within the class.</span></span>

<span data-ttu-id="678ca-158">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="678ca-158">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image9.png)</span></span>

<span data-ttu-id="678ca-159">在测试项目中，创建一个新的类文件，将其命名为*MockSchoolRepository.cs*，并将现有代码替换为以下代码：</span><span class="sxs-lookup"><span data-stu-id="678ca-159">In the test project, create a new class file, name it *MockSchoolRepository.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample4.cs)]

<span data-ttu-id="678ca-160">此存储库类具有与直接访问实体框架相同的 CRUD 方法，但它们使用的是内存中 `List` 集合，而不是与数据库一起使用。</span><span class="sxs-lookup"><span data-stu-id="678ca-160">This repository class has the same CRUD methods as the one that accesses the Entity Framework directly, but they work with `List` collections in memory instead of with a database.</span></span> <span data-ttu-id="678ca-161">这使得测试类可以更轻松地设置和验证业务逻辑类的单元测试。</span><span class="sxs-lookup"><span data-stu-id="678ca-161">This makes it easier for a test class to set up and validate unit tests for the business-logic class.</span></span>

## <a name="creating-unit-tests"></a><span data-ttu-id="678ca-162">创建单元测试</span><span class="sxs-lookup"><span data-stu-id="678ca-162">Creating Unit Tests</span></span>

<span data-ttu-id="678ca-163">**测试**项目模板为你创建了一个存根单元测试类，下一个任务是通过为要添加到业务逻辑类的业务逻辑添加单元测试方法来修改此类。</span><span class="sxs-lookup"><span data-stu-id="678ca-163">The **Test** project template created a stub unit test class for you, and your next task is to modify this class by adding unit test methods to it for business logic that you want to add to the business-logic class.</span></span>

<span data-ttu-id="678ca-164">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="678ca-164">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image11.png)</span></span>

<span data-ttu-id="678ca-165">在 Contoso 大学，任何单个指导员只能成为单个部门的管理员，并且你需要添加业务逻辑来强制实施此规则。</span><span class="sxs-lookup"><span data-stu-id="678ca-165">At Contoso University, any individual instructor can only be the administrator of a single department, and you need to add business logic to enforce this rule.</span></span> <span data-ttu-id="678ca-166">首先添加测试并运行测试，以查看它们是否失败。</span><span class="sxs-lookup"><span data-stu-id="678ca-166">You will start by adding tests and running the tests to see them fail.</span></span> <span data-ttu-id="678ca-167">然后，你将添加代码并重新运行测试，并希望其通过。</span><span class="sxs-lookup"><span data-stu-id="678ca-167">You'll then add the code and rerun the tests, expecting to see them pass.</span></span>

<span data-ttu-id="678ca-168">打开*UnitTest1.cs*文件并添加在 ContosoUniversity 项目中创建的业务逻辑和数据访问层的 `using` 语句：</span><span class="sxs-lookup"><span data-stu-id="678ca-168">Open the *UnitTest1.cs* file and add `using` statements for the business logic and data-access layers that you created in the ContosoUniversity project:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample5.cs)]

<span data-ttu-id="678ca-169">将 `TestMethod1` 方法替换为以下方法：</span><span class="sxs-lookup"><span data-stu-id="678ca-169">Replace the `TestMethod1` method with the following methods:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample6.cs)]

<span data-ttu-id="678ca-170">`CreateSchoolBL` 方法创建为单元测试项目创建的存储库类的实例，然后将该实例传递给业务逻辑类的新实例。</span><span class="sxs-lookup"><span data-stu-id="678ca-170">The `CreateSchoolBL` method creates an instance of the repository class that you created for the unit test project, which it then passes to a new instance of the business-logic class.</span></span> <span data-ttu-id="678ca-171">然后，方法使用业务逻辑类插入三个可以在测试方法中使用的部门。</span><span class="sxs-lookup"><span data-stu-id="678ca-171">The method then uses the business-logic class to insert three departments that you can use in test methods.</span></span>

<span data-ttu-id="678ca-172">如果有人尝试插入具有与现有部门相同的管理员的新部门，或者如果有人尝试通过将其设置为人员的 ID 来更新部门的管理员，则测试方法将验证业务逻辑类是否引发异常。谁已是另一个部门的管理员。</span><span class="sxs-lookup"><span data-stu-id="678ca-172">The test methods verify that the business-logic class throws an exception if someone tries to insert a new department with the same administrator as an existing department, or if someone tries to update a department's administrator by setting it to the ID of a person who is already the administrator of another department.</span></span>

<span data-ttu-id="678ca-173">尚未创建异常类，因此此代码将不会编译。</span><span class="sxs-lookup"><span data-stu-id="678ca-173">You haven't created the exception class yet, so this code will not compile.</span></span> <span data-ttu-id="678ca-174">若要进行编译，请右键单击 `DuplicateAdministratorException`，然后选择 "**生成**"，然后选择 "**类**"。</span><span class="sxs-lookup"><span data-stu-id="678ca-174">To get it to compile, right-click `DuplicateAdministratorException` and select **Generate**, and then **Class**.</span></span>

<span data-ttu-id="678ca-175">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="678ca-175">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image13.png)</span></span>

<span data-ttu-id="678ca-176">这会在测试项目中创建一个可在主项目中创建异常类后删除的类。</span><span class="sxs-lookup"><span data-stu-id="678ca-176">This creates a class in the test project which you can delete after you've created the exception class in the main project.</span></span> <span data-ttu-id="678ca-177">和实现业务逻辑。</span><span class="sxs-lookup"><span data-stu-id="678ca-177">and implemented the business logic.</span></span>

<span data-ttu-id="678ca-178">运行测试项目。</span><span class="sxs-lookup"><span data-stu-id="678ca-178">Run the test project.</span></span> <span data-ttu-id="678ca-179">如预期那样，测试将失败。</span><span class="sxs-lookup"><span data-stu-id="678ca-179">As expected, the tests fail.</span></span>

<span data-ttu-id="678ca-180">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="678ca-180">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image15.png)</span></span>

## <a name="adding-business-logic-to-make-a-test-pass"></a><span data-ttu-id="678ca-181">添加业务逻辑以便进行测试</span><span class="sxs-lookup"><span data-stu-id="678ca-181">Adding Business Logic to Make a Test Pass</span></span>

<span data-ttu-id="678ca-182">接下来，你将实现业务逻辑，使其不能被设置为属于另一部门的管理员的部门的管理员。</span><span class="sxs-lookup"><span data-stu-id="678ca-182">Next, you'll implement the business logic that makes it impossible to set as the administrator of a department someone who is already administrator of another department.</span></span> <span data-ttu-id="678ca-183">如果用户编辑部门并在选择已成为管理员的人员后单击 "**更新**"，则将从业务逻辑层引发异常，然后在表示层中捕获该异常。</span><span class="sxs-lookup"><span data-stu-id="678ca-183">You'll throw an exception from the business-logic layer, and then catch it in the presentation layer if a user edits a department and clicks **Update** after selecting someone who is already an administrator.</span></span> <span data-ttu-id="678ca-184">（您也可以从下拉列表中删除已在您呈现页面之前已经是管理员的指导员，但此处的目的是使用业务逻辑层。）</span><span class="sxs-lookup"><span data-stu-id="678ca-184">(You could also remove instructors from the drop-down list who are already administrators before you render the page, but the purpose here is to work with the business-logic layer.)</span></span>

<span data-ttu-id="678ca-185">首先，创建一个异常类，当用户尝试使讲师成为多个部门的管理员时，将引发该异常类。</span><span class="sxs-lookup"><span data-stu-id="678ca-185">Start by creating the exception class that you'll throw when a user tries to make an instructor the administrator of more than one department.</span></span> <span data-ttu-id="678ca-186">在主项目中，在*BLL*文件夹中创建一个新的类文件，将其命名为*DuplicateAdministratorException.cs*，并将现有代码替换为以下代码：</span><span class="sxs-lookup"><span data-stu-id="678ca-186">In the main project, create a new class file in the *BLL* folder, name it *DuplicateAdministratorException.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample7.cs)]

<span data-ttu-id="678ca-187">现在删除之前在测试项目中创建的临时*DuplicateAdministratorException.cs*文件，以便能够进行编译。</span><span class="sxs-lookup"><span data-stu-id="678ca-187">Now delete the temporary *DuplicateAdministratorException.cs* file that you created in the test project earlier in order to be able to compile.</span></span>

<span data-ttu-id="678ca-188">在主项目中，打开*SchoolBL.cs*文件并添加以下包含验证逻辑的方法。</span><span class="sxs-lookup"><span data-stu-id="678ca-188">In the main project, open the *SchoolBL.cs* file and add the following method that contains the validation logic.</span></span> <span data-ttu-id="678ca-189">（代码引用稍后将创建的方法。）</span><span class="sxs-lookup"><span data-stu-id="678ca-189">(The code refers to a method that you'll create later.)</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample8.cs)]

<span data-ttu-id="678ca-190">在插入或更新 `Department` 实体时，将调用此方法，以检查其他部门是否已具有相同的管理员。</span><span class="sxs-lookup"><span data-stu-id="678ca-190">You'll call this method when you're inserting or updating `Department` entities in order to check whether another department already has the same administrator.</span></span>

<span data-ttu-id="678ca-191">此代码将调用一个方法，以便在数据库中搜索与要插入或更新的实体具有相同 `Administrator` 属性值的 `Department` 实体。</span><span class="sxs-lookup"><span data-stu-id="678ca-191">The code calls a method to search the database for a `Department` entity that has the same `Administrator` property value as the entity being inserted or updated.</span></span> <span data-ttu-id="678ca-192">如果找到一个，代码将引发异常。</span><span class="sxs-lookup"><span data-stu-id="678ca-192">If one is found, the code throws an exception.</span></span> <span data-ttu-id="678ca-193">如果要插入或更新的实体没有 `Administrator` 值，则不需要验证检查; 如果在更新过程中调用方法，则不会引发异常，并且找到的 `Department` 实体与正在更新的 `Department` 实体匹配。</span><span class="sxs-lookup"><span data-stu-id="678ca-193">No validation check is required if the entity being inserted or updated has no `Administrator` value, and no exception is thrown if the method is called during an update and the `Department` entity found matches the `Department` entity being updated.</span></span>

<span data-ttu-id="678ca-194">从 `Insert` 和 `Update` 方法中调用新方法：</span><span class="sxs-lookup"><span data-stu-id="678ca-194">Call the new method from the `Insert` and `Update` methods:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample9.cs)]

<span data-ttu-id="678ca-195">在*ISchoolRepository.cs*中，为新的数据访问方法添加以下声明：</span><span class="sxs-lookup"><span data-stu-id="678ca-195">In *ISchoolRepository.cs*, add the following declaration for the new data-access method:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample10.cs)]

<span data-ttu-id="678ca-196">在*SchoolRepository.cs*中，添加以下 `using` 语句：</span><span class="sxs-lookup"><span data-stu-id="678ca-196">In *SchoolRepository.cs*, add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample11.cs)]

<span data-ttu-id="678ca-197">在*SchoolRepository.cs*中，添加以下新的数据访问方法：</span><span class="sxs-lookup"><span data-stu-id="678ca-197">In *SchoolRepository.cs*, add the following new data-access method:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample12.cs)]

<span data-ttu-id="678ca-198">此代码检索具有指定管理员 `Department` 实体。</span><span class="sxs-lookup"><span data-stu-id="678ca-198">This code retrieves `Department` entities that have a specified administrator.</span></span> <span data-ttu-id="678ca-199">只应找到一个部门（如果有）。</span><span class="sxs-lookup"><span data-stu-id="678ca-199">Only one department should be found (if any).</span></span> <span data-ttu-id="678ca-200">但是，由于数据库中没有内置的约束，因此在找到多个部门的情况下，返回类型是一个集合。</span><span class="sxs-lookup"><span data-stu-id="678ca-200">However, because no constraint is built into the database, the return type is a collection in case multiple departments are found.</span></span>

<span data-ttu-id="678ca-201">默认情况下，当对象上下文从数据库中检索实体时，它将在其对象状态管理器中进行跟踪。</span><span class="sxs-lookup"><span data-stu-id="678ca-201">By default, when the object context retrieves entities from the database, it keeps track of them in its object state manager.</span></span> <span data-ttu-id="678ca-202">`MergeOption.NoTracking` 参数指定不会对此查询执行此跟踪。</span><span class="sxs-lookup"><span data-stu-id="678ca-202">The `MergeOption.NoTracking` parameter specifies that this tracking will not be done for this query.</span></span> <span data-ttu-id="678ca-203">这是必需的，因为查询可能返回您尝试更新的确切实体，然后您将无法附加该实体。</span><span class="sxs-lookup"><span data-stu-id="678ca-203">This is necessary because the query might return the exact entity that you're trying to update, and then you would not be able to attach that entity.</span></span> <span data-ttu-id="678ca-204">例如，如果在 " *default.aspx* " 页中编辑历史记录部门并使管理员保持不变，则此查询将返回历史记录部门。</span><span class="sxs-lookup"><span data-stu-id="678ca-204">For example, if you edit the History department in the *Departments.aspx* page and leave the administrator unchanged, this query will return the History department.</span></span> <span data-ttu-id="678ca-205">如果未设置 `NoTracking`，则对象上下文的对象状态管理器中已包含 "历史记录部门" 实体。</span><span class="sxs-lookup"><span data-stu-id="678ca-205">If `NoTracking` is not set, the object context would already have the History department entity in its object state manager.</span></span> <span data-ttu-id="678ca-206">然后，在附加从视图状态重新创建的历史部门实体时，对象上下文将引发指出 `"An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key"`的异常。</span><span class="sxs-lookup"><span data-stu-id="678ca-206">Then when you attach the History department entity that's re-created from view state, the object context would throw an exception that says `"An object with the same key already exists in the ObjectStateManager. The ObjectStateManager cannot track multiple objects with the same key"`.</span></span>

<span data-ttu-id="678ca-207">（作为指定 `MergeOption.NoTracking`的替代方法，您可以为此查询创建一个新的对象上下文。</span><span class="sxs-lookup"><span data-stu-id="678ca-207">(As an alternative to specifying `MergeOption.NoTracking`, you could create a new object context just for this query.</span></span> <span data-ttu-id="678ca-208">由于新的对象上下文会有自己的对象状态管理器，因此在调用 `Attach` 方法时，不会发生冲突。</span><span class="sxs-lookup"><span data-stu-id="678ca-208">Because the new object context would have its own object state manager, there would be no conflict when you call the `Attach` method.</span></span> <span data-ttu-id="678ca-209">新的对象上下文将与原始对象上下文共享元数据和数据库连接，因此这种替代方法的性能损失会很小。</span><span class="sxs-lookup"><span data-stu-id="678ca-209">The new object context would share metadata and database connection with the original object context, so the performance penalty of this alternate approach would be minimal.</span></span> <span data-ttu-id="678ca-210">但此处显示的方法引入了 `NoTracking` 选项，你会在其他上下文中找到该选项。</span><span class="sxs-lookup"><span data-stu-id="678ca-210">The approach shown here, however, introduces the `NoTracking` option, which you'll find useful in other contexts.</span></span> <span data-ttu-id="678ca-211">本系列后面的教程进一步讨论了 `NoTracking` 选项。）</span><span class="sxs-lookup"><span data-stu-id="678ca-211">The `NoTracking` option is discussed further in a later tutorial in this series.)</span></span>

<span data-ttu-id="678ca-212">在测试项目中，将新的数据访问方法添加到*MockSchoolRepository.cs*：</span><span class="sxs-lookup"><span data-stu-id="678ca-212">In the test project, add the new data-access method to *MockSchoolRepository.cs*:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample13.cs)]

<span data-ttu-id="678ca-213">此代码使用 LINQ 执行 `ContosoUniversity` 的项目存储库使用 LINQ to Entities 的相同数据选择。</span><span class="sxs-lookup"><span data-stu-id="678ca-213">This code uses LINQ to perform the same data selection that the `ContosoUniversity` project repository uses LINQ to Entities for.</span></span>

<span data-ttu-id="678ca-214">再次运行测试项目。</span><span class="sxs-lookup"><span data-stu-id="678ca-214">Run the test project again.</span></span> <span data-ttu-id="678ca-215">这次测试通过了。</span><span class="sxs-lookup"><span data-stu-id="678ca-215">This time the tests pass.</span></span>

<span data-ttu-id="678ca-216">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="678ca-216">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image17.png)</span></span>

## <a name="handling-objectdatasource-exceptions"></a><span data-ttu-id="678ca-217">处理 ObjectDataSource 异常</span><span class="sxs-lookup"><span data-stu-id="678ca-217">Handling ObjectDataSource Exceptions</span></span>

<span data-ttu-id="678ca-218">在 `ContosoUniversity` 项目中，运行 "node.js *" 页，* 然后尝试将某个部门的管理员更改为已是另一个部门的管理员的用户。</span><span class="sxs-lookup"><span data-stu-id="678ca-218">In the `ContosoUniversity` project, run the *Departments.aspx* page and try to change the administrator for a department to someone who is already administrator for another department.</span></span> <span data-ttu-id="678ca-219">（请记住，您只能编辑您在本教程中添加的部门，因为数据库预加载了无效的数据。）出现以下服务器错误页：</span><span class="sxs-lookup"><span data-stu-id="678ca-219">(Remember that you can only edit departments that you added during this tutorial, because the database comes preloaded with invalid data.) You get the following server error page:</span></span>

<span data-ttu-id="678ca-220">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="678ca-220">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image19.png)</span></span>

<span data-ttu-id="678ca-221">您不希望用户看到此类错误页面，因此您需要添加错误处理代码。</span><span class="sxs-lookup"><span data-stu-id="678ca-221">You don't want users to see this kind of error page, so you need to add error-handling code.</span></span> <span data-ttu-id="678ca-222">打开 "*部门*"，并为 `DepartmentsObjectDataSource`的 `OnUpdated` 事件指定处理程序。</span><span class="sxs-lookup"><span data-stu-id="678ca-222">Open *Departments.aspx* and specify a handler for the `OnUpdated` event of the `DepartmentsObjectDataSource`.</span></span> <span data-ttu-id="678ca-223">`ObjectDataSource` 开始标记现在类似于以下示例。</span><span class="sxs-lookup"><span data-stu-id="678ca-223">The `ObjectDataSource` opening tag now resembles the following example.</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample14.aspx)]

<span data-ttu-id="678ca-224">在*Departments.aspx.cs*中，添加以下 `using` 语句：</span><span class="sxs-lookup"><span data-stu-id="678ca-224">In *Departments.aspx.cs*, add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample15.cs)]

<span data-ttu-id="678ca-225">为 `Updated` 事件添加以下处理程序：</span><span class="sxs-lookup"><span data-stu-id="678ca-225">Add the following handler for the `Updated` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample16.cs)]

<span data-ttu-id="678ca-226">如果 `ObjectDataSource` 控件在尝试执行更新时捕获到异常，则它会将事件自变量（`e`）中的异常传递给该处理程序。</span><span class="sxs-lookup"><span data-stu-id="678ca-226">If the `ObjectDataSource` control catches an exception when it tries to perform the update, it passes the exception in the event argument (`e`) to this handler.</span></span> <span data-ttu-id="678ca-227">处理程序中的代码检查异常是否是重复的管理员异常。</span><span class="sxs-lookup"><span data-stu-id="678ca-227">The code in the handler checks to see if the exception is the duplicate administrator exception.</span></span> <span data-ttu-id="678ca-228">如果是，该代码将创建一个验证程序控件，其中包含要显示的 `ValidationSummary` 控件的错误消息。</span><span class="sxs-lookup"><span data-stu-id="678ca-228">If it is, the code creates a validator control that contains an error message for the `ValidationSummary` control to display.</span></span>

<span data-ttu-id="678ca-229">运行该页并再次尝试让两个部门的管理员。</span><span class="sxs-lookup"><span data-stu-id="678ca-229">Run the page and attempt to make someone the administrator of two departments again.</span></span> <span data-ttu-id="678ca-230">这次 `ValidationSummary` 控件将显示错误消息。</span><span class="sxs-lookup"><span data-stu-id="678ca-230">This time the `ValidationSummary` control displays an error message.</span></span>

<span data-ttu-id="678ca-231">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="678ca-231">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/_static/image21.png)</span></span>

<span data-ttu-id="678ca-232">对*DepartmentsAdd*页进行类似的更改。</span><span class="sxs-lookup"><span data-stu-id="678ca-232">Make similar changes to the *DepartmentsAdd.aspx* page.</span></span> <span data-ttu-id="678ca-233">在*DepartmentsAdd*中，为 `DepartmentsObjectDataSource`的 `OnInserted` 事件指定处理程序。</span><span class="sxs-lookup"><span data-stu-id="678ca-233">In *DepartmentsAdd.aspx*, specify a handler for the `OnInserted` event of the `DepartmentsObjectDataSource`.</span></span> <span data-ttu-id="678ca-234">生成的标记将类似于下面的示例。</span><span class="sxs-lookup"><span data-stu-id="678ca-234">The resulting markup will resemble the following example.</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample17.aspx)]

<span data-ttu-id="678ca-235">在*DepartmentsAdd.aspx.cs*中，添加相同的 `using` 语句：</span><span class="sxs-lookup"><span data-stu-id="678ca-235">In *DepartmentsAdd.aspx.cs*, add the same `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample18.cs)]

<span data-ttu-id="678ca-236">添加以下事件处理程序：</span><span class="sxs-lookup"><span data-stu-id="678ca-236">Add the following event handler:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests/samples/sample19.cs)]

<span data-ttu-id="678ca-237">你现在可以测试*DepartmentsAdd.aspx.cs*页，验证它是否还正确地处理使一个用户成为多个部门的管理员的尝试。</span><span class="sxs-lookup"><span data-stu-id="678ca-237">You can now test the *DepartmentsAdd.aspx.cs* page to verify that it also correctly handles attempts to make one person the administrator of more than one department.</span></span>

<span data-ttu-id="678ca-238">这就完成了实现使用实体框架的 `ObjectDataSource` 控件的存储库模式的简介。</span><span class="sxs-lookup"><span data-stu-id="678ca-238">This completes the introduction to implementing the repository pattern for using the `ObjectDataSource` control with the Entity Framework.</span></span> <span data-ttu-id="678ca-239">有关存储库模式和可测试性的详细信息，请参阅 MSDN 白皮书可[测试性和4.0 实体框架](https://msdn.microsoft.com/library/ff714955.aspx)。</span><span class="sxs-lookup"><span data-stu-id="678ca-239">For more information about the repository pattern and testability, see the MSDN whitepaper [Testability and Entity Framework 4.0](https://msdn.microsoft.com/library/ff714955.aspx).</span></span>

<span data-ttu-id="678ca-240">在以下教程中，你将了解如何将排序和筛选功能添加到应用程序。</span><span class="sxs-lookup"><span data-stu-id="678ca-240">In the following tutorial you'll see how to add sorting and filtering functionality to the application.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="678ca-241">[上一页](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started.md)
> [下一页](using-the-entity-framework-and-the-objectdatasource-control-part-3-sorting-and-filtering.md)</span><span class="sxs-lookup"><span data-stu-id="678ca-241">[Previous](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started.md)
[Next](using-the-entity-framework-and-the-objectdatasource-control-part-3-sorting-and-filtering.md)</span></span>
