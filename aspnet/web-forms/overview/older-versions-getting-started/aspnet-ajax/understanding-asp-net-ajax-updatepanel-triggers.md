---
uid: web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-asp-net-ajax-updatepanel-triggers
title: 了解 ASP.NET AJAX UpdatePanel 触发器 |Microsoft Docs
author: scottcate
description: Visual Studio 中的标记编辑器中工作时，你可能会注意到 （从智能感知） 有两个 UpdatePanel 控件的子元素。 以下值时的一个...
ms.author: riande
ms.date: 03/12/2008
ms.assetid: faab8503-2984-48a9-8a40-7728461abc50
msc.legacyurl: /web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-asp-net-ajax-updatepanel-triggers
msc.type: authoredcontent
ms.openlocfilehash: 9501a2e855bdffe8c9d85c0dd0d836f50935b306
ms.sourcegitcommit: 24b1f6decbb17bb22a45166e5fdb0845c65af498
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/01/2019
ms.locfileid: "57025294"
---
<a name="understanding-aspnet-ajax-updatepanel-triggers"></a><span data-ttu-id="da3cb-104">了解 ASP.NET AJAX UpdatePanel 触发器</span><span class="sxs-lookup"><span data-stu-id="da3cb-104">Understanding ASP.NET AJAX UpdatePanel Triggers</span></span>
====================
<span data-ttu-id="da3cb-105">通过[Scott Cate](https://github.com/scottcate)</span><span class="sxs-lookup"><span data-stu-id="da3cb-105">by [Scott Cate](https://github.com/scottcate)</span></span>

[<span data-ttu-id="da3cb-106">下载 PDF</span><span class="sxs-lookup"><span data-stu-id="da3cb-106">Download PDF</span></span>](http://download.microsoft.com/download/C/1/9/C19A3451-1D14-477C-B703-54EF22E197EE/AJAX_tutorial02_Triggers_cs.pdf)

> <span data-ttu-id="da3cb-107">Visual Studio 中的标记编辑器中工作时，你可能会注意到 （从智能感知） 有两个 UpdatePanel 控件的子元素。</span><span class="sxs-lookup"><span data-stu-id="da3cb-107">When working in the markup editor in Visual Studio, you may notice (from IntelliSense) that there are two child elements of an UpdatePanel control.</span></span> <span data-ttu-id="da3cb-108">其中之一是触发器元素，它指定页 （或用户控件，如果您正在使用它） 上的控件，将触发该元素所在的 UpdatePanel 控件部分呈现。</span><span class="sxs-lookup"><span data-stu-id="da3cb-108">One of which is the Triggers element, which specifies the controls on the page (or the user control, if you are using one) that will trigger a partial render of the UpdatePanel control in which the element resides.</span></span>


## <a name="introduction"></a><span data-ttu-id="da3cb-109">介绍</span><span class="sxs-lookup"><span data-stu-id="da3cb-109">Introduction</span></span>

<span data-ttu-id="da3cb-110">Microsoft 的 ASP.NET 技术带来了面向对象和事件驱动的编程模型，并将其与已编译的代码的好处结合在一起。</span><span class="sxs-lookup"><span data-stu-id="da3cb-110">Microsoft's ASP.NET technology brings an object-oriented and event-driven programming model and unites it with the benefits of compiled code.</span></span> <span data-ttu-id="da3cb-111">但是，其服务器端处理模型有几个缺点固有的技术，其中很多可以通过 Microsoft ASP.NET 3.5 AJAX Extensions 中包含的新功能进行寻址。</span><span class="sxs-lookup"><span data-stu-id="da3cb-111">However, its server-side processing model has several drawbacks inherent in the technology, many of which can be addressed by the new features included in the Microsoft ASP.NET 3.5 AJAX Extensions.</span></span> <span data-ttu-id="da3cb-112">使用这些扩展，许多新的丰富的客户端功能，而无需整页刷新，通过客户端脚本 （包括 ASP.NET 分析 API） 和广泛的客户端 API 访问 Web 服务的功能包括部分呈现的页面用于镜像许多 ASP.NET 服务器端控件集所示的控制方案。</span><span class="sxs-lookup"><span data-stu-id="da3cb-112">These extensions enable many new rich client features, including partial rendering of pages without requiring a full page refresh, the ability to access Web Services via client script (including the ASP.NET profiling API), and an extensive client-side API designed to mirror many of the control schemes seen in the ASP.NET server-side control set.</span></span>

<span data-ttu-id="da3cb-113">本白皮书探讨 ASP.NET AJAX 的 XML 触发器功能`UpdatePanel`组件。</span><span class="sxs-lookup"><span data-stu-id="da3cb-113">This whitepaper examines the XML Triggers functionality of the ASP.NET AJAX `UpdatePanel` component.</span></span> <span data-ttu-id="da3cb-114">XML 触发器提供精细的控制可能会导致特定的 UpdatePanel 控件的部分呈现的组件。</span><span class="sxs-lookup"><span data-stu-id="da3cb-114">XML Triggers give granular control over the components that can cause partial rendering for specific UpdatePanel controls.</span></span>

<span data-ttu-id="da3cb-115">此白皮书基于 Beta 2 版本的.NET Framework 3.5 和 Visual Studio 2008。</span><span class="sxs-lookup"><span data-stu-id="da3cb-115">This whitepaper is based on the Beta 2 release of the .NET Framework 3.5 and Visual Studio 2008.</span></span> <span data-ttu-id="da3cb-116">ASP.NET AJAX Extensions，以前针对 ASP.NET 2.0 中，外接程序程序集现已集成到.NET Framework 基类库。</span><span class="sxs-lookup"><span data-stu-id="da3cb-116">The ASP.NET AJAX Extensions, previously an add-on assembly targeted at ASP.NET 2.0, are now integrated into the .NET Framework Base Class Library.</span></span> <span data-ttu-id="da3cb-117">本白皮书还假定你将使用 Visual Studio 2008 中，不 Visual Web Developer 速成版，并将提供根据 Visual Studio 的用户界面的演练 （尽管将完全兼容而不考虑代码列表开发环境）。</span><span class="sxs-lookup"><span data-stu-id="da3cb-117">This whitepaper also assumes that you will be working with Visual Studio 2008, not Visual Web Developer Express, and will provide walkthroughs according to the user interface of Visual Studio (although code listings will be entirely compatible regardless of development environment).</span></span>

## <a name="triggers"></a><span data-ttu-id="da3cb-118">*触发器*</span><span class="sxs-lookup"><span data-stu-id="da3cb-118">*Triggers*</span></span>

<span data-ttu-id="da3cb-119">对于给定的 UpdatePanel，默认情况下，触发器会自动包括调用的回发，包括 （例如） 文本框控件，具有任何子控件及其`AutoPostBack`属性设置为**true**。</span><span class="sxs-lookup"><span data-stu-id="da3cb-119">Triggers for a given UpdatePanel, by default, automatically include any child controls that invoke a postback, including (for example) TextBox controls that have their `AutoPostBack` property set to **true**.</span></span> <span data-ttu-id="da3cb-120">但是，触发器也可以包含以声明方式使用标记;这是在`<triggers>`UpdatePanel 控件声明的部分。</span><span class="sxs-lookup"><span data-stu-id="da3cb-120">However, triggers can also be included declaratively using markup; this is done within the `<triggers>` section of the UpdatePanel control declaration.</span></span> <span data-ttu-id="da3cb-121">尽管可以通过访问触发器`Triggers`集合属性，则建议 （例如，如果控件在设计时不可用） 注册在运行时的任何部分呈现触发器使用`RegisterAsyncPostBackControl(Control)`方法ScriptManager 对象为您的页面，在`Page_Load`事件。</span><span class="sxs-lookup"><span data-stu-id="da3cb-121">Although triggers can be accessed via the `Triggers` collection property, it is recommended that you register any partial render triggers at run-time (for instance, if a control is not available at design time) by using the `RegisterAsyncPostBackControl(Control)` method of the ScriptManager object for your page, within the `Page_Load` event.</span></span> <span data-ttu-id="da3cb-122">请记住，页是无状态，因此你应重新注册这些控件每次创建它们。</span><span class="sxs-lookup"><span data-stu-id="da3cb-122">Remember that Pages are stateless, and so you should re-register these controls every time they are created.</span></span>

<span data-ttu-id="da3cb-123">自动子触发器包含也可禁用 （以便创建回发的子控件不会自动触发部分呈现） 通过设置`ChildrenAsTriggers`属性设置为**false**。</span><span class="sxs-lookup"><span data-stu-id="da3cb-123">Automatic child trigger inclusion can also be disabled (so that child controls that create postbacks do not automatically trigger partial renders) by setting the `ChildrenAsTriggers` property to **false**.</span></span> <span data-ttu-id="da3cb-124">这样可以最大的灵活性分配哪些特定控件可能调用页呈现，并建议，以便开发人员将参加来响应某个事件，而不是处理可能会出现任何事件。</span><span class="sxs-lookup"><span data-stu-id="da3cb-124">This allows you the greatest flexibility in assigning which specific controls may invoke a page render, and is recommended, so that a developer will opt-in to respond to an event, rather than handling any events that may arise.</span></span>

<span data-ttu-id="da3cb-125">请注意，当 UpdatePanel 控件嵌套时，如果 UpdateMode 设置为**条件**，如果触发 UpdatePanel 的子级，但父无效，则仅将刷新 UpdatePanel 的子级。</span><span class="sxs-lookup"><span data-stu-id="da3cb-125">Note that when UpdatePanel controls are nested, when the UpdateMode is set to **Conditional**, if the child UpdatePanel is triggered, but the parent is not, then only the child UpdatePanel will refresh.</span></span> <span data-ttu-id="da3cb-126">但是，如果父 UpdatePanel 刷新，然后子 UpdatePanel 也会刷新。</span><span class="sxs-lookup"><span data-stu-id="da3cb-126">However, if the parent UpdatePanel is refreshed, then the child UpdatePanel will also be refreshed.</span></span>

## <a name="the-lttriggersgt-element"></a><span data-ttu-id="da3cb-127">*&lt;触发器&gt;元素*</span><span class="sxs-lookup"><span data-stu-id="da3cb-127">*The &lt;Triggers&gt; Element*</span></span>

<span data-ttu-id="da3cb-128">Visual Studio 中的标记编辑器中工作时，你可能会注意到 （从智能感知） 有两个子元素的`UpdatePanel`控件。</span><span class="sxs-lookup"><span data-stu-id="da3cb-128">When working in the markup editor in Visual Studio, you may notice (from IntelliSense) that there are two child elements of an `UpdatePanel` control.</span></span> <span data-ttu-id="da3cb-129">最常见的元素是`<ContentTemplate>`元素，它实质上是封装将持有的更新面板的内容 （我们要为其启用部分呈现的内容）。</span><span class="sxs-lookup"><span data-stu-id="da3cb-129">The most-frequently seen element is the `<ContentTemplate>` element, which essentially encapsulates the content that will be held by the update panel (the content for which we are enabling partial rendering).</span></span> <span data-ttu-id="da3cb-130">其他元素是`<Triggers>`元素，它指定页 （或用户控件，如果您正在使用它） 上的控件，将触发 UpdatePanel 控件在其中的部分呈现&lt;触发器&gt;元素驻留。</span><span class="sxs-lookup"><span data-stu-id="da3cb-130">The other element is the `<Triggers>` element, which specifies the controls on the page (or the user control, if you are using one) that will trigger a partial render of the UpdatePanel control in which the &lt;Triggers&gt; element resides.</span></span>

<span data-ttu-id="da3cb-131">`<Triggers>`元素可以包含两个子节点的任意数量每个：`<asp:AsyncPostBackTrigger>`和`<asp:PostBackTrigger>`。</span><span class="sxs-lookup"><span data-stu-id="da3cb-131">The `<Triggers>` element can contain any number each of two child nodes: `<asp:AsyncPostBackTrigger>` and `<asp:PostBackTrigger>`.</span></span> <span data-ttu-id="da3cb-132">它们都接受两个属性`ControlID`和`EventName`，可以指定封装的当前单位中的任何控件 （例如，UpdatePanel 控件位于 Web 用户控件内，如果您不应尝试在引用的控件用户控件将在其驻留的页确定）。</span><span class="sxs-lookup"><span data-stu-id="da3cb-132">They both accept two attributes, `ControlID` and `EventName`, and can specify any Control within the current unit of encapsulation (for instance, if your UpdatePanel control resides within a Web User Control, you should not attempt to reference a Control on the Page on which the User Control will reside).</span></span>

<span data-ttu-id="da3cb-133">`<asp:AsyncPostBackTrigger>`元素是特别有用，因为它可以为目标的子级作为存在的控件中的任何事件*任何*UpdatePanel 控件封装，而不仅仅是此触发器在其下的子 UpdatePanel 单位.</span><span class="sxs-lookup"><span data-stu-id="da3cb-133">The `<asp:AsyncPostBackTrigger>` element is particularly useful in that it can target any event from a Control that exists as a child of *any* UpdatePanel control in the unit of encapsulation, not just the UpdatePanel under which this trigger is a child.</span></span> <span data-ttu-id="da3cb-134">因此，可以进行的任何控件，以触发部分页面更新。</span><span class="sxs-lookup"><span data-stu-id="da3cb-134">Thus, any control can be made to trigger a partial page update.</span></span>

<span data-ttu-id="da3cb-135">同样，`<asp:PostBackTrigger>`元素可用于的触发器部分页面呈现，但需要完整往返服务器。</span><span class="sxs-lookup"><span data-stu-id="da3cb-135">Similarly, the `<asp:PostBackTrigger>` element can be used to trigger a partial page render, but one that requires a full round-trip to the server.</span></span> <span data-ttu-id="da3cb-136">此触发器元素还可用于控制将否则通常会触发部分页面呈现时强制执行整页呈现器 (例如，当`Button`控件中存在`<ContentTemplate>`UpdatePanel 控件元素)。</span><span class="sxs-lookup"><span data-stu-id="da3cb-136">This trigger element can also be used to force a full page render when a control would otherwise normally trigger a partial page render (for instance, when a `Button` control exists in the `<ContentTemplate>` element of an UpdatePanel control).</span></span> <span data-ttu-id="da3cb-137">同样，PostBackTrigger 元素可以指定是在当前的单元中封装任何 UpdatePanel 控件的子级的任何控件。</span><span class="sxs-lookup"><span data-stu-id="da3cb-137">Again, the PostBackTrigger element can specify any control that is a child of any UpdatePanel control in the current unit of encapsulation.</span></span>

## <a name="lttriggersgt-element-reference"></a><span data-ttu-id="da3cb-138">*&lt;触发器&gt;元素引用*</span><span class="sxs-lookup"><span data-stu-id="da3cb-138">*&lt;Triggers&gt; Element Reference*</span></span>

<span data-ttu-id="da3cb-139">*标记后代：*</span><span class="sxs-lookup"><span data-stu-id="da3cb-139">*Markup Descendants:*</span></span>

| <span data-ttu-id="da3cb-140">**Tag**</span><span class="sxs-lookup"><span data-stu-id="da3cb-140">**Tag**</span></span> | <span data-ttu-id="da3cb-141">**说明**</span><span class="sxs-lookup"><span data-stu-id="da3cb-141">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="da3cb-142">&lt;asp:AsyncPostBackTrigger&gt;</span><span class="sxs-lookup"><span data-stu-id="da3cb-142">&lt;asp:AsyncPostBackTrigger&gt;</span></span> | <span data-ttu-id="da3cb-143">指定控件并将导致部分页面更新的 UpdatePanel，其中包含此触发器引用的事件。</span><span class="sxs-lookup"><span data-stu-id="da3cb-143">Specifies a control and event that will cause a partial page update for the UpdatePanel that contains this trigger reference.</span></span> |
| <span data-ttu-id="da3cb-144">&lt;asp:PostBackTrigger&gt;</span><span class="sxs-lookup"><span data-stu-id="da3cb-144">&lt;asp:PostBackTrigger&gt;</span></span> | <span data-ttu-id="da3cb-145">指定的控件和事件将导致整页更新 （整页刷新）。</span><span class="sxs-lookup"><span data-stu-id="da3cb-145">Specifies a control and event that will cause a full page update (a full page refresh).</span></span> <span data-ttu-id="da3cb-146">此标记可用于强制完全刷新时控件否则会触发部分呈现。</span><span class="sxs-lookup"><span data-stu-id="da3cb-146">This tag can be used to force a full refresh when a control would otherwise trigger partial rendering.</span></span> |

## <a name="walkthrough-cross-updatepanel-triggers"></a><span data-ttu-id="da3cb-147">*演练：跨 UpdatePanel 触发器*</span><span class="sxs-lookup"><span data-stu-id="da3cb-147">*Walkthrough: Cross-UpdatePanel Triggers*</span></span>

1. <span data-ttu-id="da3cb-148">使用设置为启用部分呈现 ScriptManager 对象创建一个新的 ASP.NET 页面。</span><span class="sxs-lookup"><span data-stu-id="da3cb-148">Create a new ASP.NET page with a ScriptManager object set to enable partial rendering.</span></span> <span data-ttu-id="da3cb-149">将两个 Updatepanel 添加到此页-在第一个，包括 Label 控件 (Label1) 和两个按钮控件 （Button1 和 Button2）。</span><span class="sxs-lookup"><span data-stu-id="da3cb-149">Add two UpdatePanels to this page - in the first, include a Label control ( Label1 ) and two Button controls ( Button1 and Button2 ).</span></span> <span data-ttu-id="da3cb-150">应该在 Button1 单击此项可同时更新和 Button2 应显示单击此项可更新，或类似。</span><span class="sxs-lookup"><span data-stu-id="da3cb-150">Button1 should say Click to Update Both and Button2 should say Click to Update This, or something along those lines.</span></span> <span data-ttu-id="da3cb-151">在第二个 UpdatePanel，包括仅标签控件 (Label2)，但其 ForeColor 属性设置为默认值对其进行区分以外。</span><span class="sxs-lookup"><span data-stu-id="da3cb-151">In the second UpdatePanel, include only a Label control ( Label2 ), but set its ForeColor property to something other than the default to differentiate it.</span></span>
2. <span data-ttu-id="da3cb-152">这两个 UpdatePanel 标记的 UpdateMode 属性设置**条件**。</span><span class="sxs-lookup"><span data-stu-id="da3cb-152">Set the UpdateMode property of both UpdatePanel tags to **Conditional**.</span></span>

<span data-ttu-id="da3cb-153">**列表 1:Default.aspx 的标记：**</span><span class="sxs-lookup"><span data-stu-id="da3cb-153">**Listing 1: Markup for default.aspx:**</span></span> 

[!code-aspx[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample1.aspx)]

1. <span data-ttu-id="da3cb-154">在 Button1 单击事件处理程序，设置 Label1.Text 和 Label2.Text 为有依赖于时间的 （例如 DateTime.Now.ToLongTimeString())。</span><span class="sxs-lookup"><span data-stu-id="da3cb-154">In the Click event handler for Button1, set Label1.Text and Label2.Text to something time-dependent (such as DateTime.Now.ToLongTimeString()).</span></span> <span data-ttu-id="da3cb-155">Button2 的单击事件处理程序，将仅 Label1.Text 设为依赖于时间的值。</span><span class="sxs-lookup"><span data-stu-id="da3cb-155">For the Click event handler for Button2, set only Label1.Text to the time-dependent value.</span></span>

<span data-ttu-id="da3cb-156">**列表 2:（剪裁） default.aspx.cs 中的代码隐藏文件：**</span><span class="sxs-lookup"><span data-stu-id="da3cb-156">**Listing 2: Codebehind (trimmed) in default.aspx.cs:**</span></span> 

[!code-csharp[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample2.cs)]

1. <span data-ttu-id="da3cb-157">按 F5 生成并运行项目。</span><span class="sxs-lookup"><span data-stu-id="da3cb-157">Press F5 to build and run the project.</span></span> <span data-ttu-id="da3cb-158">请注意，当您单击更新同时面板，这两个标签将更改属性。但是，当您单击更新此面板，仅 Label1 更新。</span><span class="sxs-lookup"><span data-stu-id="da3cb-158">Note that, when you click Update Both Panels, both labels change text; however, when you click Update This Panel, only Label1 updates.</span></span>


[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image2.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image1.png)

<span data-ttu-id="da3cb-159">([单击此项可查看原尺寸图像](understanding-asp-net-ajax-updatepanel-triggers/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="da3cb-159">([Click to view full-size image](understanding-asp-net-ajax-updatepanel-triggers/_static/image3.png))</span></span>


## <a name="under-the-hood"></a><span data-ttu-id="da3cb-160">*揭秘*</span><span class="sxs-lookup"><span data-stu-id="da3cb-160">*Under the Hood*</span></span>

<span data-ttu-id="da3cb-161">利用我们刚构建的示例，我们可以看看 ASP.NET AJAX 的作用以及我们 UpdatePanel 跨面板触发器的工作原理。</span><span class="sxs-lookup"><span data-stu-id="da3cb-161">Utilizing the example we just constructed, we can take a look at what ASP.NET AJAX is doing and how our UpdatePanel cross-panel triggers work.</span></span> <span data-ttu-id="da3cb-162">若要执行此操作，我们将使用生成的页源 HTML，以及使用它，调用 FireBug-Mozilla Firefox 扩展我们可以轻松地检查 AJAX 回发。</span><span class="sxs-lookup"><span data-stu-id="da3cb-162">To do so, we will work with the generated page source HTML, as well as the Mozilla Firefox extension called FireBug - with it, we can easily examine the AJAX postbacks.</span></span> <span data-ttu-id="da3cb-163">我们将使用由 Lutz Roeder 的.NET Reflector 工具。</span><span class="sxs-lookup"><span data-stu-id="da3cb-163">We will also use the .NET Reflector tool by Lutz Roeder.</span></span> <span data-ttu-id="da3cb-164">这两种工具是免费提供联机，并可使用 internet 搜索找到。</span><span class="sxs-lookup"><span data-stu-id="da3cb-164">Both of these tools are freely available online, and can be found with an internet search.</span></span>

<span data-ttu-id="da3cb-165">检查页的源代码演示几乎没什么特别之;UpdatePanel 控件呈现为`<div>`容器，并且我们可以看到脚本资源包含提供由`<asp:ScriptManager>`。</span><span class="sxs-lookup"><span data-stu-id="da3cb-165">An examination of the page source code shows almost nothing out of the ordinary; the UpdatePanel controls are rendered as `<div>` containers, and we can see the script resource includes provided by the `<asp:ScriptManager>`.</span></span> <span data-ttu-id="da3cb-166">也有一些新 AJAX 特定的调用到 PageRequestManager 内部的 AJAX 客户端脚本库。</span><span class="sxs-lookup"><span data-stu-id="da3cb-166">There are also some new AJAX-specific calls to the PageRequestManager that are internal to the AJAX client script library.</span></span> <span data-ttu-id="da3cb-167">最后，我们看到两个 UpdatePanel 容器-一个用于呈现`<input>`具有两个按钮`<asp:Label>`控件呈现为`<span>`容器。</span><span class="sxs-lookup"><span data-stu-id="da3cb-167">Finally, we see the two UpdatePanel containers - one with the rendered `<input>` buttons with the two `<asp:Label>` controls rendered as `<span>` containers.</span></span> <span data-ttu-id="da3cb-168">（如果您检查 DOM 树在 FireBug 中的，您将注意到标签灰显以指示不能发出可见内容）。</span><span class="sxs-lookup"><span data-stu-id="da3cb-168">(If you inspect the DOM tree in FireBug, you will notice that the labels are dimmed to indicate that they are not producing visible content).</span></span>

<span data-ttu-id="da3cb-169">单击更新此面板按钮，并注意顶部 UpdatePanel 将与当前服务器时间一起更新。</span><span class="sxs-lookup"><span data-stu-id="da3cb-169">Click the Update This Panel button, and notice the top UpdatePanel will be updated with the current server time.</span></span> <span data-ttu-id="da3cb-170">在 FireBug 中，选择控制台选项卡，以便你可以检查请求。</span><span class="sxs-lookup"><span data-stu-id="da3cb-170">In FireBug, choose the Console tab so that you can examine the request.</span></span> <span data-ttu-id="da3cb-171">首先检查 POST 请求参数：</span><span class="sxs-lookup"><span data-stu-id="da3cb-171">Examine the POST request parameters first:</span></span>


[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image5.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image4.png)

<span data-ttu-id="da3cb-172">([单击此项可查看原尺寸图像](understanding-asp-net-ajax-updatepanel-triggers/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="da3cb-172">([Click to view full-size image](understanding-asp-net-ajax-updatepanel-triggers/_static/image6.png))</span></span>


<span data-ttu-id="da3cb-173">请注意，UpdatePanel 已指明服务器端 AJAX 代码到精确的控件树已触发通过 ScriptManager1 参数：`Button1`的`UpdatePanel1`控件。</span><span class="sxs-lookup"><span data-stu-id="da3cb-173">Note that the UpdatePanel has indicated to the server-side AJAX code precisely which control tree was fired via the ScriptManager1 parameter: `Button1` of the `UpdatePanel1` control.</span></span> <span data-ttu-id="da3cb-174">现在，单击更新两个面板按钮。</span><span class="sxs-lookup"><span data-stu-id="da3cb-174">Now, click on the Update Both Panels button.</span></span> <span data-ttu-id="da3cb-175">然后，检查响应，可看到竖线分隔的一系列变量在一个字符串; 中设置具体而言，我们看到顶部 UpdatePanel， `UpdatePanel1`，具有整个其发送到浏览器的 HTML。</span><span class="sxs-lookup"><span data-stu-id="da3cb-175">Then, examining the response, we see a pipe-delimited series of variables set in a string; specifically, we see the top UpdatePanel, `UpdatePanel1`, has the entirety of its HTML sent to the browser.</span></span> <span data-ttu-id="da3cb-176">AJAX 客户端脚本库替换 UpdatePanel 的原始 HTML 内容使用新的内容通过`.innerHTML`属性，因此，服务器将从为 HTML 的服务器发送更改的内容。</span><span class="sxs-lookup"><span data-stu-id="da3cb-176">The AJAX client script library substitutes the UpdatePanel's original HTML content with the new content via the `.innerHTML` property, and so the server sends the changed content from the server as HTML.</span></span>

<span data-ttu-id="da3cb-177">现在，单击更新两个面板按钮并检查来自服务器的结果。</span><span class="sxs-lookup"><span data-stu-id="da3cb-177">Now, click on the Update Both Panels button and examine the results from the server.</span></span> <span data-ttu-id="da3cb-178">结果是非常类似-这两个 Updatepanel 从服务器接收新的 html 代码。</span><span class="sxs-lookup"><span data-stu-id="da3cb-178">The results are very similar - both UpdatePanels receive new HTML from the server.</span></span> <span data-ttu-id="da3cb-179">与上一个回调，一样发送更多页面状态。</span><span class="sxs-lookup"><span data-stu-id="da3cb-179">As with the previous callback, additional page state is sent.</span></span>

<span data-ttu-id="da3cb-180">我们可以看到，因为没有特殊的代码用来执行 AJAX 回发，AJAX 客户端脚本库就能够截获窗体回发而无需任何其他代码。</span><span class="sxs-lookup"><span data-stu-id="da3cb-180">As we can see, because no special code is utilized to perform an AJAX postback, the AJAX client script library is able to intercept form postbacks without any additional code.</span></span> <span data-ttu-id="da3cb-181">服务器控件，以便它们不会自动提交窗体-ASP.NET 自动插入代码窗体验证和状态，主要通过自动脚本资源包含，PostBackOptions 类来实现自动利用 JavaScript和 ClientScriptManager 类。</span><span class="sxs-lookup"><span data-stu-id="da3cb-181">Server controls automatically utilize JavaScript so that they do not automatically submit the form - ASP.NET automatically injects code for form validation and state already, primarily achieved by automatic script resource inclusion, the PostBackOptions class, and the ClientScriptManager class.</span></span>

<span data-ttu-id="da3cb-182">例如，考虑一个复选框控件;检查在.NET Reflector 类反汇编。</span><span class="sxs-lookup"><span data-stu-id="da3cb-182">For instance, consider a CheckBox control; examine the class disassembly in .NET Reflector.</span></span> <span data-ttu-id="da3cb-183">为此，请确保在 System.Web 程序集已打开，并导航到`System.Web.UI.WebControls.CheckBox`类中，打开`RenderInputTag`方法。</span><span class="sxs-lookup"><span data-stu-id="da3cb-183">To do so, ensure that your System.Web assembly is open, and navigate to the `System.Web.UI.WebControls.CheckBox` class, opening the `RenderInputTag` method.</span></span> <span data-ttu-id="da3cb-184">检查的条件查找`AutoPostBack`属性：</span><span class="sxs-lookup"><span data-stu-id="da3cb-184">Look for a conditional that checks the `AutoPostBack` property:</span></span>


[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image8.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image7.png)

<span data-ttu-id="da3cb-185">([单击此项可查看原尺寸图像](understanding-asp-net-ajax-updatepanel-triggers/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="da3cb-185">([Click to view full-size image](understanding-asp-net-ajax-updatepanel-triggers/_static/image9.png))</span></span>


<span data-ttu-id="da3cb-186">当在上启用自动回发`CheckBox`控制 （通过将 AutoPostBack 属性是否均为 true），所产生的`<input>`标记的因此呈现使用 ASP.NET 事件处理脚本在其`onclick`属性。</span><span class="sxs-lookup"><span data-stu-id="da3cb-186">When automatic postback is enabled on a `CheckBox` control (via the AutoPostBack property being true), the resultant `<input>` tag is therefore rendered with an ASP.NET event handling script in its `onclick` attribute.</span></span> <span data-ttu-id="da3cb-187">窗体的提交，然后，利用拦截，ASP.NET AJAX 注入到页 nonintrusively，帮助避免所有潜在的重大更改，可能出现的使用可能不精确的字符串替换。</span><span class="sxs-lookup"><span data-stu-id="da3cb-187">The interception of the form's submission, then, allows ASP.NET AJAX to be injected into the page nonintrusively, helping to avoid any potential breaking changes that might occur by utilizing a possibly-imprecise string replacement.</span></span> <span data-ttu-id="da3cb-188">此外，这使得*任何*自定义 ASP.NET 控件，以利用功能的 ASP.NET AJAX 无需任何其他代码以支持其使用 UpdatePanel 容器中的。</span><span class="sxs-lookup"><span data-stu-id="da3cb-188">Furthermore, this enables *any* custom ASP.NET control to utilize the power of ASP.NET AJAX without any additional code to support its use within an UpdatePanel container.</span></span>

<span data-ttu-id="da3cb-189">`<triggers>`功能对应于初始化 PageRequestManager 调用中的值\_updateControls （请注意，ASP.NET AJAX 客户端脚本库使用约定，该方法、 事件和字段名称以用下划线标记为内部，因此它们不能在库自身以外使用）。</span><span class="sxs-lookup"><span data-stu-id="da3cb-189">The `<triggers>` functionality corresponds to the values initialized in the PageRequestManager call to \_updateControls (note that the ASP.NET AJAX client script library utilizes the convention that methods, events, and field names that begin with an underscore are marked as internal, and are not meant for use outside of the library itself).</span></span> <span data-ttu-id="da3cb-190">使用它，我们可以观察到哪些控件旨在导致 AJAX 回发。</span><span class="sxs-lookup"><span data-stu-id="da3cb-190">With it, we can observe which controls are intended to cause AJAX postbacks.</span></span>

<span data-ttu-id="da3cb-191">例如，让我们添加到页上，完全，使一个 Updatepanel 之外的控件并保留一个 UpdatePanel 内的两个其他控件。</span><span class="sxs-lookup"><span data-stu-id="da3cb-191">For example, let's add two additional controls to the page, leaving one control outside of the UpdatePanels entirely, and leaving one within an UpdatePanel.</span></span> <span data-ttu-id="da3cb-192">我们将添加上部 UpdatePanel 内的复选框控件和列表中定义的颜色数与删除 DropDownList。</span><span class="sxs-lookup"><span data-stu-id="da3cb-192">We will add a CheckBox control within the upper UpdatePanel, and drop a DropDownList with a number of colors defined within the list.</span></span> <span data-ttu-id="da3cb-193">以下是新标记：</span><span class="sxs-lookup"><span data-stu-id="da3cb-193">Here is the new markup:</span></span>

<span data-ttu-id="da3cb-194">**代码清单 3:新的标记**</span><span class="sxs-lookup"><span data-stu-id="da3cb-194">**Listing 3: New Markup**</span></span>

[!code-aspx[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample3.aspx)]

<span data-ttu-id="da3cb-195">而以下是新的代码隐藏：</span><span class="sxs-lookup"><span data-stu-id="da3cb-195">And here is the new code-behind:</span></span>

<span data-ttu-id="da3cb-196">**列表 4:代码隐藏文件**</span><span class="sxs-lookup"><span data-stu-id="da3cb-196">**Listing 4: Codebehind**</span></span>

[!code-csharp[Main](understanding-asp-net-ajax-updatepanel-triggers/samples/sample4.cs)]

<span data-ttu-id="da3cb-197">此页背后的理念是，下拉列表中选择一个三种颜色以显示第二个标签、 复选框确定它是否以粗体显示，和标签显示日期，以及时间。</span><span class="sxs-lookup"><span data-stu-id="da3cb-197">The idea behind this page is that the drop-down list selects one of three colors to show the second label, that the check box determines both whether it is bold, and whether the labels display the date as well as the time.</span></span> <span data-ttu-id="da3cb-198">复选框并不会导致 AJAX 更新，但应下拉列表，即使它不位于 UpdatePanel 中也是如此。</span><span class="sxs-lookup"><span data-stu-id="da3cb-198">The check box should not cause an AJAX update, but the drop-down list should, even though it is not housed within an UpdatePanel.</span></span>


[![](understanding-asp-net-ajax-updatepanel-triggers/_static/image11.png)](understanding-asp-net-ajax-updatepanel-triggers/_static/image10.png)

<span data-ttu-id="da3cb-199">([单击此项可查看原尺寸图像](understanding-asp-net-ajax-updatepanel-triggers/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="da3cb-199">([Click to view full-size image](understanding-asp-net-ajax-updatepanel-triggers/_static/image12.png))</span></span>


<span data-ttu-id="da3cb-200">很明显在上面的屏幕截图，最新的按钮被单击时右侧的按钮更新此面板中，更新此订阅顶部时间独立于的底部时间。</span><span class="sxs-lookup"><span data-stu-id="da3cb-200">As is apparent in the above screen shot, the most-recent button to be clicked was the right button Update This Panel, which updated the top time independent of the bottom time.</span></span> <span data-ttu-id="da3cb-201">日期也关闭了之间次单击，如日期是在底部标签中可见。</span><span class="sxs-lookup"><span data-stu-id="da3cb-201">The date was also switched off between clicks, as the date is visible in the bottom label.</span></span> <span data-ttu-id="da3cb-202">最后感兴趣的是底部标签的颜色： 它比标签的文本，演示，控件状态很重要，最近已更新，用户希望它将保留通过 AJAX 回发。</span><span class="sxs-lookup"><span data-stu-id="da3cb-202">Finally of interest is the bottom label's color: it was updated more recently than the label's text, which demonstrates that control state is important, and users expect it to be preserved through AJAX postbacks.</span></span> <span data-ttu-id="da3cb-203">*但是*，不更新的时间。</span><span class="sxs-lookup"><span data-stu-id="da3cb-203">*However*, the time was not updated.</span></span> <span data-ttu-id="da3cb-204">时间已自动重新填充在的暂留\_\_时在服务器上重新呈现该控件时，ASP.NET 运行时所解释的页的视图状态字段。</span><span class="sxs-lookup"><span data-stu-id="da3cb-204">The time was automatically repopulated through the persistence of the \_\_VIEWSTATE field of the page being interpreted by the ASP.NET runtime when the control was being re-rendered on the server.</span></span> <span data-ttu-id="da3cb-205">ASP.NET AJAX 服务器代码中不能识别控件的方法在其中更改状态;它只需重新填充从视图状态，然后运行相应的事件。</span><span class="sxs-lookup"><span data-stu-id="da3cb-205">The ASP.NET AJAX server code does not recognize in which methods the controls are changing state; it simply repopulates from view state and then runs the events that are appropriate.</span></span>

<span data-ttu-id="da3cb-206">它应前面所指出的但是，，具有我初始化页内的时间\_Load 事件中，时间会有已正确增加。</span><span class="sxs-lookup"><span data-stu-id="da3cb-206">It should be pointed out, however, that had I initialized the time within the Page\_Load event, the time would have been incremented correctly.</span></span> <span data-ttu-id="da3cb-207">因此，开发人员应慎重考虑，将相应的代码运行在相应的事件处理程序，并避免使用页面\_加载时应适合使用控件事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="da3cb-207">Consequently, developers should be wary that the appropriate code is being run during the appropriate event handlers, and avoid use of Page\_Load when a control event handler would be appropriate.</span></span>

## <a name="summary"></a><span data-ttu-id="da3cb-208">总结</span><span class="sxs-lookup"><span data-stu-id="da3cb-208">Summary</span></span>

<span data-ttu-id="da3cb-209">ASP.NET AJAX 扩展 UpdatePanel 控件是用途多样，并可以使用多种方法来确定应将导致其更新的控件事件。</span><span class="sxs-lookup"><span data-stu-id="da3cb-209">The ASP.NET AJAX Extensions UpdatePanel control is versatile, and can utilize a number of methods for identifying control events that should cause it to be updated.</span></span> <span data-ttu-id="da3cb-210">它支持子控件，通过自动更新，但也可以响应的页面上的其他位置的控件事件。</span><span class="sxs-lookup"><span data-stu-id="da3cb-210">It supports being updated automatically by its child controls, but can also respond to control events elsewhere on the page.</span></span>

<span data-ttu-id="da3cb-211">若要减少潜在的服务器处理负载，则建议`ChildrenAsTriggers`UpdatePanel 属性设置为`false`，事件会选择到而不是默认情况下包括和。</span><span class="sxs-lookup"><span data-stu-id="da3cb-211">To reduce potential for server processing load, it is recommended that the `ChildrenAsTriggers` property of an UpdatePanel be set to `false`, and that events be opted-into rather than included by default.</span></span> <span data-ttu-id="da3cb-212">这还可以防止不需要的任何事件导致可能不需要的效果，包括验证和更改的输入字段。</span><span class="sxs-lookup"><span data-stu-id="da3cb-212">This also prevents any unneeded events from causing potentially-unwanted effects, including validation, and changes to input fields.</span></span> <span data-ttu-id="da3cb-213">这些类型的错误可能很难隔离，因为该页给用户，会更新以透明方式和原因因此可能不易察觉。</span><span class="sxs-lookup"><span data-stu-id="da3cb-213">These types of bugs may be difficult to isolate, because the page updates transparently to the user, and the cause may therefore not be immediately obvious.</span></span>

<span data-ttu-id="da3cb-214">通过检查 ASP.NET AJAX 窗体的内部工作机制发布拦截模型，我们能够确定它利用 ASP.NET 已提供的框架。</span><span class="sxs-lookup"><span data-stu-id="da3cb-214">By examining the inner workings of the ASP.NET AJAX form post interception model, we were able to determine that it utilizes the framework already provided by ASP.NET.</span></span> <span data-ttu-id="da3cb-215">这样，它将保留与控件使用同一个框架，设计的最大兼容性并干扰最少为页面编写任何其他 javascript。</span><span class="sxs-lookup"><span data-stu-id="da3cb-215">In doing so, it preserves maximum compatibility with controls designed using the same framework, and intrudes minimally on any additional JavaScript written for the page.</span></span>

## <a name="bio"></a><span data-ttu-id="da3cb-216">个人简介</span><span class="sxs-lookup"><span data-stu-id="da3cb-216">Bio</span></span>

<span data-ttu-id="da3cb-217">Rob Paveza 是 Terralever 的高级.NET 应用程序开发人员 ([www.terralever.com](http://www.terralever.com))，在 Tempe，AZ.领先的交互式市场营销公司</span><span class="sxs-lookup"><span data-stu-id="da3cb-217">Rob Paveza is a senior .NET application developer at Terralever ([www.terralever.com](http://www.terralever.com)), a leading interactive marketing firm in Tempe, AZ.</span></span> <span data-ttu-id="da3cb-218">他可以到达[ robpaveza@gmail.com ](mailto:robpaveza@gmail.com)，和他的博客位于[ http://geekswithblogs.net/robp/ ](http://geekswithblogs.net/robp/)。</span><span class="sxs-lookup"><span data-stu-id="da3cb-218">He can be reached at [robpaveza@gmail.com](mailto:robpaveza@gmail.com), and his blog is located at [http://geekswithblogs.net/robp/](http://geekswithblogs.net/robp/).</span></span>

<span data-ttu-id="da3cb-219">Scott Cate 自 1997 年以来一直致力于 Microsoft Web 技术和 myKB.com 总裁 ([www.myKB.com](http://www.myKB.com)) 专门负责编写 ASP.NET 基于侧重于知识库软件解决方案的应用程序。</span><span class="sxs-lookup"><span data-stu-id="da3cb-219">Scott Cate has been working with Microsoft Web technologies since 1997 and is the President of myKB.com ([www.myKB.com](http://www.myKB.com)) where he specializes in writing ASP.NET based applications focused on Knowledge Base Software solutions.</span></span> <span data-ttu-id="da3cb-220">可以通过电子邮件联系 Scott [ scott.cate@myKB.com ](mailto:scott.cate@myKB.com)或他的博客[ScottCate.com](http://ScottCate.com)</span><span class="sxs-lookup"><span data-stu-id="da3cb-220">Scott can be contacted via email at [scott.cate@myKB.com](mailto:scott.cate@myKB.com) or his blog at [ScottCate.com](http://ScottCate.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="da3cb-221">[上一页](understanding-partial-page-updates-with-asp-net-ajax.md)
> [下一页](understanding-asp-net-ajax-authentication-and-profile-application-services.md)</span><span class="sxs-lookup"><span data-stu-id="da3cb-221">[Previous](understanding-partial-page-updates-with-asp-net-ajax.md)
[Next](understanding-asp-net-ajax-authentication-and-profile-application-services.md)</span></span>
