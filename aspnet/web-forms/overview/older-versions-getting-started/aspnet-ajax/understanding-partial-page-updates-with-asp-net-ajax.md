---
uid: web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-partial-page-updates-with-asp-net-ajax
title: 通过 ASP.NET AJAX 了解部分页面更新 |Microsoft Docs
author: scottcate
description: 也许，ASP.NET AJAX 扩展的最明显的功能是能够执行部分或增量页面更新，而无需执行到 t 的完整回发 。
ms.author: riande
ms.date: 03/28/2008
ms.assetid: 54d9df99-1161-4899-b4e8-2679c85915e7
msc.legacyurl: /web-forms/overview/older-versions-getting-started/aspnet-ajax/understanding-partial-page-updates-with-asp-net-ajax
msc.type: authoredcontent
ms.openlocfilehash: 4b87cb8f58dbd7f27b16bcb0d488ff361770d4fe
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/28/2019
ms.locfileid: "74623009"
---
# <a name="understanding-partial-page-updates-with-aspnet-ajax"></a><span data-ttu-id="0a4e2-103">了解使用 ASP.NET AJAX 的部分页面更新</span><span class="sxs-lookup"><span data-stu-id="0a4e2-103">Understanding Partial Page Updates with ASP.NET AJAX</span></span>

<span data-ttu-id="0a4e2-104">作者： [Scott Cate](https://github.com/scottcate)</span><span class="sxs-lookup"><span data-stu-id="0a4e2-104">by [Scott Cate](https://github.com/scottcate)</span></span>

[<span data-ttu-id="0a4e2-105">下载 PDF</span><span class="sxs-lookup"><span data-stu-id="0a4e2-105">Download PDF</span></span>](https://download.microsoft.com/download/C/1/9/C19A3451-1D14-477C-B703-54EF22E197EE/AJAX_tutorial01_Partial_Page_Updates_cs.pdf)

> <span data-ttu-id="0a4e2-106">也许，ASP.NET AJAX Extension 的最明显的功能是能够在不完全回发到服务器的情况下执行部分或增量页面更新，而无需更改代码和最小程度的标记更改。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-106">Perhaps the most visible feature of the ASP.NET AJAX Extensions is the ability to do a partial or incremental page updates without doing a full postback to the server, with no code changes and minimal markup changes.</span></span> <span data-ttu-id="0a4e2-107">优点非常多–多媒体的状态（如 Adobe Flash 或 Windows Media）保持不变，带宽成本降低，客户端不会遇到通常与回发关联的闪烁。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-107">The advantages are extensive – the state of your multimedia (such as Adobe Flash or Windows Media) is unchanged, bandwidth costs are reduced, and the client does not experience the flicker usually associated with a postback.</span></span>

## <a name="introduction"></a><span data-ttu-id="0a4e2-108">简介</span><span class="sxs-lookup"><span data-stu-id="0a4e2-108">Introduction</span></span>

<span data-ttu-id="0a4e2-109">Microsoft 的 ASP.NET 技术引入了面向对象的和事件驱动的编程模型，并将其与编译的代码的优势结合起来。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-109">Microsoft's ASP.NET technology brings an object-oriented and event-driven programming model and unites it with the benefits of compiled code.</span></span> <span data-ttu-id="0a4e2-110">不过，它的服务器端处理模型在技术上有一些固有的缺点：</span><span class="sxs-lookup"><span data-stu-id="0a4e2-110">However, its server-side processing model has several drawbacks inherent in the technology:</span></span>

- <span data-ttu-id="0a4e2-111">页面更新要求与服务器之间的往返，这需要刷新页面。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-111">Page updates require a round-trip to the server, which requires a page refresh.</span></span>
- <span data-ttu-id="0a4e2-112">往返不会保留 Javascript 或其他客户端技术（如 Adobe Flash）生成的任何影响。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-112">Round-trips do not persist any effects generated by Javascript or other client-side technology (such as Adobe Flash)</span></span>
- <span data-ttu-id="0a4e2-113">在回发期间，Microsoft Internet Explorer 以外的浏览器不支持自动还原滚动位置。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-113">During postback, browsers other than Microsoft Internet Explorer do not support automatically restoring the scroll position.</span></span> <span data-ttu-id="0a4e2-114">甚至在 Internet Explorer 中，在页面刷新时仍会出现闪烁。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-114">And even in Internet Explorer, there is still a flicker as the page is refreshed.</span></span>
- <span data-ttu-id="0a4e2-115">如果 \_\_VIEWSTATE 窗体字段可能会增长，则回发可能会涉及大量带宽，特别是在处理控件（如 GridView 控件或中继器）时。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-115">Postbacks may involve a high amount of bandwidth as the \_\_VIEWSTATE form field may grow, especially when dealing with controls such as the GridView control or repeaters.</span></span>
- <span data-ttu-id="0a4e2-116">通过 JavaScript 或其他客户端技术，没有用于访问 Web 服务的统一模型。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-116">There is no unified model for accessing Web Services through JavaScript or other client-side technology.</span></span>

<span data-ttu-id="0a4e2-117">输入 Microsoft 的 ASP.NET AJAX 扩展。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-117">Enter Microsoft's ASP.NET AJAX extensions.</span></span> <span data-ttu-id="0a4e2-118">AJAX**是指同步** **J** avaScript **a** nd **X** ML，是一种集成框架，可通过跨平台 JavaScript 提供增量页面更新，由包含 microsoft Ajax FRAMEWORK 的服务器端代码和称为 microsoft ajax 脚本库的脚本组件提供。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-118">AJAX, which stands for **A** synchronous **J** avaScript **A** nd **X** ML, is an integrated framework for providing incremental page updates via cross-platform JavaScript, composed of server-side code comprising the Microsoft AJAX Framework, and a script component called the Microsoft AJAX Script Library.</span></span> <span data-ttu-id="0a4e2-119">ASP.NET AJAX 扩展还提供跨平台支持，以便通过 JavaScript 访问 ASP.NET Web 服务。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-119">The ASP.NET AJAX extensions also provide cross-platform support for accessing ASP.NET Web Services via JavaScript.</span></span>

<span data-ttu-id="0a4e2-120">本白皮书检查 ASP.NET AJAX 扩展的部分页面更新功能，其中包括 ScriptManager 组件、UpdatePanel 控件和 UpdateProgress 控件，并考虑它们应该或不应处于的情况超载.</span><span class="sxs-lookup"><span data-stu-id="0a4e2-120">This whitepaper examines the partial page updates functionality of the ASP.NET AJAX Extensions, which includes the ScriptManager component, the UpdatePanel control, and the UpdateProgress control, and considers scenarios in which they should or should not be utilized.</span></span>

<span data-ttu-id="0a4e2-121">本白皮书基于 Visual Studio 2008 和 .NET Framework 3.5 的 Beta 2 版本，该版本将 ASP.NET AJAX 扩展集成到基类库中（以前是可用于 ASP.NET 2.0 的附加组件）。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-121">This whitepaper is based on the Beta 2 release of the Visual Studio 2008 and the .NET Framework 3.5, which integrates the ASP.NET AJAX Extensions into the Base Class Library (where it was previously an add-on component available for ASP.NET 2.0).</span></span> <span data-ttu-id="0a4e2-122">本白皮书还假设你使用的是 Visual Studio 2008，而不是 Visual Web Developer 速成版;引用的某些项目模板可能不适用于 Visual Web Developer Express 用户。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-122">This whitepaper also assumes that you are using Visual Studio 2008 and not Visual Web Developer Express Edition; some project templates that are referenced may not be available to Visual Web Developer Express users.</span></span>

## <a name="partial-page-updates"></a><span data-ttu-id="0a4e2-123">部分页面更新</span><span class="sxs-lookup"><span data-stu-id="0a4e2-123">Partial Page Updates</span></span>

<span data-ttu-id="0a4e2-124">也许，ASP.NET AJAX Extension 的最明显的功能是能够在不完全回发到服务器的情况下执行部分或增量页面更新，而无需更改代码和最小程度的标记更改。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-124">Perhaps the most visible feature of the ASP.NET AJAX Extensions is the ability to do a partial or incremental page updates without doing a full postback to the server, with no code changes and minimal markup changes.</span></span> <span data-ttu-id="0a4e2-125">优点非常广泛-多媒体的状态（如 Adobe Flash 或 Windows Media）保持不变，带宽成本降低，客户端不会遇到通常与回发关联的闪烁。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-125">The advantages are extensive - the state of your multimedia (such as Adobe Flash or Windows Media) is unchanged, bandwidth costs are reduced, and the client does not experience the flicker usually associated with a postback.</span></span>

<span data-ttu-id="0a4e2-126">集成部分页面呈现的功能集成到了 ASP.NET 中，对项目进行了最少的更改。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-126">The ability to integrate partial page rendering is integrated into ASP.NET with minimal changes into your project.</span></span>

## <a name="walkthrough-integrating-partial-rendering-into-an-existing-project"></a><span data-ttu-id="0a4e2-127">演练：将部分呈现集成到现有项目中</span><span class="sxs-lookup"><span data-stu-id="0a4e2-127">Walkthrough: Integrating Partial Rendering into an Existing Project</span></span>

1. <span data-ttu-id="0a4e2-128">在 Microsoft Visual Studio 2008 中，通过转到 "<em>文件</em><em>-" &gt; 新</em>的<em>-&gt;</em>网站并从对话框中选择 "ASP.NET" 网站来创建新的 ASP.NET 网站项目。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-128">In Microsoft Visual Studio 2008, create a new ASP.NET Web Site project by going to <em>File</em><em>-&gt; New</em><em>-&gt; Web Site</em> and selecting ASP.NET Web Site from the dialog.</span></span> <span data-ttu-id="0a4e2-129">可以将其命名为任何所需内容，并且可以将其安装到文件系统或 Internet Information Services （IIS）中。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-129">You can name it whatever you like, and you may install it either to the file system or into Internet Information Services (IIS).</span></span>
2. <span data-ttu-id="0a4e2-130">将显示具有基本 ASP.NET 标记（服务器端窗体和 `@Page` 指令）的空白默认页。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-130">You will be presented with the blank default page with basic ASP.NET markup (a server-side form and an `@Page` directive).</span></span> <span data-ttu-id="0a4e2-131">将名为 `Label1` 的标签和一个名为 `Button1` 的按钮拖到窗体元素中的页上。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-131">Drop a Label called `Label1` and a Button called `Button1` onto the page within the form element.</span></span> <span data-ttu-id="0a4e2-132">可以将其文本属性设置为所需的任何内容。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-132">You may set their text properties to whatever you like.</span></span>
3. <span data-ttu-id="0a4e2-133">在设计视图中，双击 "`Button1`" 生成代码隐藏事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-133">In Design view, double-click `Button1` to generate a code-behind event handler.</span></span> <span data-ttu-id="0a4e2-134">在此事件处理程序中，将 `Label1.Text` 设置为单击按钮！</span><span class="sxs-lookup"><span data-stu-id="0a4e2-134">Within this event handler, set `Label1.Text` to You clicked the button!</span></span> <span data-ttu-id="0a4e2-135">。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-135">.</span></span>

<span data-ttu-id="0a4e2-136">**列表1：启用部分呈现之前的默认 .aspx 标记**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-136">**Listing 1: Markup for default.aspx before partial rendering is enabled**</span></span>

[!code-aspx[Main](understanding-partial-page-updates-with-asp-net-ajax/samples/sample1.aspx)]

<span data-ttu-id="0a4e2-137">**列表2： default.aspx.cs 中的代码隐藏（已剪裁）**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-137">**Listing 2: Codebehind (trimmed) in default.aspx.cs**</span></span>

[!code-csharp[Main](understanding-partial-page-updates-with-asp-net-ajax/samples/sample2.cs)]

1. <span data-ttu-id="0a4e2-138">按 F5 启动您的网站。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-138">Press F5 to launch your web site.</span></span> <span data-ttu-id="0a4e2-139">Visual Studio 将提示你添加 web.config 文件以启用调试;执行此操作。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-139">Visual Studio will prompt you to add a web.config file to enable debugging; do so.</span></span> <span data-ttu-id="0a4e2-140">单击该按钮时，请注意，页面会刷新以更改标签中的文本，并且会在页面重绘时出现短暂的闪烁。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-140">When you click the button, notice that the page refreshes to change the text in the label, and there is a brief flicker as the page is redrawn.</span></span>
2. <span data-ttu-id="0a4e2-141">关闭浏览器窗口后，返回到 Visual Studio 并返回到标记页。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-141">After closing your browser window, return to Visual Studio and to the markup page.</span></span> <span data-ttu-id="0a4e2-142">在 Visual Studio "工具箱" 中向下滚动，找到标记为 "AJAX 扩展" 的选项卡。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-142">Scroll down in the Visual Studio toolbox, and find the tab labeled AJAX Extensions.</span></span> <span data-ttu-id="0a4e2-143">（如果你没有此选项卡，因为你使用的是较旧版本的 AJAX 或阿特拉斯扩展，请参阅本白皮书后面的注册 AJAX Extension 工具箱项演练，或安装 Windows Installer 可下载的当前版本从网站中）。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-143">(If you do not have this tab because you are using an older version of AJAX or Atlas extensions, refer to the walkthrough for registering the AJAX Extensions toolbox items later in this whitepaper, or install the current version with the Windows Installer downloadable from the website).</span></span>

[![](understanding-partial-page-updates-with-asp-net-ajax/_static/image2.png)](understanding-partial-page-updates-with-asp-net-ajax/_static/image1.png)

<span data-ttu-id="0a4e2-144">（[单击以查看完全大小的映像](understanding-partial-page-updates-with-asp-net-ajax/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="0a4e2-144">([Click to view full-size image](understanding-partial-page-updates-with-asp-net-ajax/_static/image3.png))</span></span>

1. <span data-ttu-id="0a4e2-145"><em>已知问题：</em>如果将 Visual Studio 2008 安装到已安装了具有 ASP.NET 2.0 AJAX 扩展的 Visual Studio 2005 的计算机上，则 Visual Studio 2008 将导入 AJAX Extension 工具箱项。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-145"><em>Known Issue:</em>If you install Visual Studio 2008 onto a computer that already has Visual Studio 2005 installed with the ASP.NET 2.0 AJAX Extensions, Visual Studio 2008 will import the AJAX Extensions toolbox items.</span></span> <span data-ttu-id="0a4e2-146">您可以通过检查组件的工具提示来确定是否是这种情况;它们应该会说版本3.5.0.0。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-146">You can determine whether this is the case by examining the tooltip of the components; they should say Version 3.5.0.0.</span></span> <span data-ttu-id="0a4e2-147">如果它们使用版本2.0.0.0，则已导入旧的工具箱项，需要使用 Visual Studio 中的 "选择工具箱项" 对话框手动导入它们。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-147">If they say Version 2.0.0.0, then you have imported your old toolbox items, and will need to manually import them by using the Choose Toolbox Items dialog in Visual Studio.</span></span> <span data-ttu-id="0a4e2-148">您将无法通过设计器添加版本2控件。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-148">You will be unable to add Version 2 controls via the designer.</span></span>

2. <span data-ttu-id="0a4e2-149">开始 `<asp:Label>` 标记之前，请创建一个空白行，然后双击工具箱中的 UpdatePanel 控件。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-149">Before the `<asp:Label>` tag begins, create a line of whitespace, and double-click on the UpdatePanel control in the toolbox.</span></span> <span data-ttu-id="0a4e2-150">请注意，新的 `@Register` 指令包含在页面顶部，指示应使用 `asp:` 前缀导入 System.web 命名空间中的控件。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-150">Note that a new `@Register` directive is included at the top of the page, indicating that controls within the System.Web.UI namespace should be imported using the `asp:` prefix.</span></span>
3. <span data-ttu-id="0a4e2-151">拖动结束标记元素末尾的结束 `</asp:UpdatePanel>` 标记，使元素的格式正确，并将标记和按钮控件换行。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-151">Drag the closing `</asp:UpdatePanel>` tag past the end of the Button element, so that the element is well-formed with the Label and Button controls wrapped.</span></span>
4. <span data-ttu-id="0a4e2-152">开始 `<asp:UpdatePanel>` 标记后，开始打开新标记。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-152">After the opening `<asp:UpdatePanel>` tag, begin opening a new tag.</span></span> <span data-ttu-id="0a4e2-153">请注意，IntelliSense 会提示你提供两个选项。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-153">Note that IntelliSense prompts you with two options.</span></span> <span data-ttu-id="0a4e2-154">在这种情况下，请创建 `<ContentTemplate>` 标记。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-154">In this case, create a `<ContentTemplate>` tag.</span></span> <span data-ttu-id="0a4e2-155">请确保将此标记环绕在标签和按钮上，使标记格式正确。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-155">Be sure to wrap this tag around your Label and Button so that the markup is well-formed.</span></span>

[![](understanding-partial-page-updates-with-asp-net-ajax/_static/image5.png)](understanding-partial-page-updates-with-asp-net-ajax/_static/image4.png)

<span data-ttu-id="0a4e2-156">（[单击以查看完全大小的映像](understanding-partial-page-updates-with-asp-net-ajax/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="0a4e2-156">([Click to view full-size image](understanding-partial-page-updates-with-asp-net-ajax/_static/image6.png))</span></span>

1. <span data-ttu-id="0a4e2-157">在 `<form>` 元素中的任意位置，通过双击工具箱中的 "`ScriptManager`" 项来包含 ScriptManager 控件。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-157">Anywhere within the `<form>` element, include a ScriptManager control by double-clicking on the `ScriptManager` item in the toolbox.</span></span>
2. <span data-ttu-id="0a4e2-158">编辑 `<asp:ScriptManager>` 标记，使其包含特性 `EnablePartialRendering= true`。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-158">Edit the `<asp:ScriptManager>` tag so that it includes the attribute `EnablePartialRendering= true`.</span></span>

<span data-ttu-id="0a4e2-159">**列表3：启用了部分呈现的默认 .aspx 标记**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-159">**Listing 3: Markup for default.aspx with partial rendering enabled**</span></span>

[!code-aspx[Main](understanding-partial-page-updates-with-asp-net-ajax/samples/sample3.aspx)]

1. <span data-ttu-id="0a4e2-160">打开 web.config 文件。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-160">Open your web.config file.</span></span> <span data-ttu-id="0a4e2-161">请注意，Visual Studio 已自动添加对 System.web 的编译引用。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-161">Notice that Visual Studio has automatically added a compilation reference to System.Web.Extensions.dll.</span></span>

1. <span data-ttu-id="0a4e2-162">Visual Studio 2008 中的新增功能： ASP.NET 网站项目模板附带的 web.config 会自动包含对 ASP.NET AJAX 扩展的所有必要引用，并包含配置信息的注释部分，这些信息可以取消注释以启用其他功能。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-162">What's New in Visual Studio 2008: The web.config that comes with the ASP.NET Web Site project templates automatically includes all necessary references to the ASP.NET AJAX Extensions, and includes commented sections of configuration information that can be un-commented to enable additional functionality.</span></span> <span data-ttu-id="0a4e2-163">安装 ASP.NET 2.0 AJAX 扩展时，Visual Studio 2005 具有类似的模板。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-163">Visual Studio 2005 had similar templates when ASP.NET 2.0 AJAX Extensions were installed.</span></span> <span data-ttu-id="0a4e2-164">但是，在 Visual Studio 2008 中，默认情况下将选择退出 AJAX 扩展（即，默认情况下将引用它们，但可以将其作为引用删除）。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-164">However, in Visual Studio 2008, the AJAX Extensions are opt-out by default (that is, they are referenced by default, but can be removed as references).</span></span>

[![](understanding-partial-page-updates-with-asp-net-ajax/_static/image8.png)](understanding-partial-page-updates-with-asp-net-ajax/_static/image7.png)

<span data-ttu-id="0a4e2-165">（[单击以查看完全大小的映像](understanding-partial-page-updates-with-asp-net-ajax/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="0a4e2-165">([Click to view full-size image](understanding-partial-page-updates-with-asp-net-ajax/_static/image9.png))</span></span>

1. <span data-ttu-id="0a4e2-166">按 F5 启动你的网站。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-166">Press F5 to launch your website.</span></span> <span data-ttu-id="0a4e2-167">请注意，不需要更改源代码即可支持仅限部分呈现的标记。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-167">Note how no source code changes were required to support partial rendering - only markup was changed.</span></span>

<span data-ttu-id="0a4e2-168">当你启动网站时，你应该会看到部分呈现已启用，因为当你单击按钮时，不会出现闪烁，页面滚动位置中也不会有任何变化（此示例不演示）。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-168">When you launch your website, you should see that partial rendering is now enabled, because when you click on the button there will be no flicker, nor will there be any change in the page scroll position (this example does not demonstrate that).</span></span> <span data-ttu-id="0a4e2-169">如果在单击按钮后查看页面的呈现源，它将确认是否确实发生了回发，因为原始标签文本仍是源标记的一部分，并且标签已通过 JavaScript 更改。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-169">If you were to look at the rendered source of the page after clicking the button, it will confirm that in fact a post-back has not occurred - the original label text is still part of the source markup, and the label has changed through JavaScript.</span></span>

<span data-ttu-id="0a4e2-170">Visual Studio 2008 似乎不带有预定义的模板，适用于启用 AJAX ASP.NET 的网站。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-170">Visual Studio 2008 does not appear to come with a pre-defined template for an ASP.NET AJAX-Enabled web site.</span></span> <span data-ttu-id="0a4e2-171">但是，如果安装了 Visual Studio 2005 和 ASP.NET 2.0 AJAX 扩展，则此类模板在 Visual Studio 2005 中提供。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-171">However, such a template was available within Visual Studio 2005 if the Visual Studio 2005 and ASP.NET 2.0 AJAX Extensions were installed.</span></span> <span data-ttu-id="0a4e2-172">因此，配置网站并从启用 AJAX 的网站模板开始可能会更容易，因为模板应包含完全配置的 web.config 文件（支持所有 ASP.NET AJAX 扩展，包括 Web 服务访问权限）和 JSON 序列化 JavaScript 对象表示法），并且默认情况下在主 Web 窗体页中包含一个 UpdatePanel 和 System.windows.controls.contentcontrol.contenttemplate。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-172">Consequently, configuring a web site and starting with the AJAX-Enabled Web Site template will likely be even easier, as the template should include a fully-configured web.config file (supporting all of the ASP.NET AJAX Extensions, including Web Services access and JSON serialization - JavaScript Object Notation) and includes an UpdatePanel and ContentTemplate within the main Web Forms page by default.</span></span> <span data-ttu-id="0a4e2-173">通过此默认页启用部分呈现只是与重新获得本演练中的步骤10和将控件放到页面上一样简单。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-173">Enabling partial rendering with this default page is as simple as revisiting Step 10 of this walkthrough and dropping controls onto the page.</span></span>

## <a name="the-scriptmanager-control"></a><span data-ttu-id="0a4e2-174">ScriptManager 控件</span><span class="sxs-lookup"><span data-stu-id="0a4e2-174">The ScriptManager Control</span></span>

## <a name="scriptmanager-control-reference"></a><span data-ttu-id="0a4e2-175">ScriptManager 控件引用</span><span class="sxs-lookup"><span data-stu-id="0a4e2-175">ScriptManager Control Reference</span></span>

<span data-ttu-id="0a4e2-176">启用标记的属性：</span><span class="sxs-lookup"><span data-stu-id="0a4e2-176">Markup-Enabled Properties:</span></span>

| <span data-ttu-id="0a4e2-177">**属性名称**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-177">**Property Name**</span></span> | <span data-ttu-id="0a4e2-178">**Type**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-178">**Type**</span></span> | <span data-ttu-id="0a4e2-179">**描述**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-179">**Description**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="0a4e2-180">AllowCustomErrors-重定向</span><span class="sxs-lookup"><span data-stu-id="0a4e2-180">AllowCustomErrors-Redirect</span></span> | <span data-ttu-id="0a4e2-181">Bool</span><span class="sxs-lookup"><span data-stu-id="0a4e2-181">Bool</span></span> | <span data-ttu-id="0a4e2-182">指定是否使用 web.config 文件的自定义错误部分来处理错误。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-182">Specifies whether to use the custom error section of the web.config file to handle errors.</span></span> |
| <span data-ttu-id="0a4e2-183">AsyncPostBackError-消息</span><span class="sxs-lookup"><span data-stu-id="0a4e2-183">AsyncPostBackError-Message</span></span> | <span data-ttu-id="0a4e2-184">字符串</span><span class="sxs-lookup"><span data-stu-id="0a4e2-184">String</span></span> | <span data-ttu-id="0a4e2-185">获取或设置在引发错误时发送给客户端的错误消息。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-185">Gets or sets the error message sent to the client if an error is raised.</span></span> |
| <span data-ttu-id="0a4e2-186">AsyncPostBack-超时</span><span class="sxs-lookup"><span data-stu-id="0a4e2-186">AsyncPostBack-Timeout</span></span> | <span data-ttu-id="0a4e2-187">Int32</span><span class="sxs-lookup"><span data-stu-id="0a4e2-187">Int32</span></span> | <span data-ttu-id="0a4e2-188">获取或设置客户端应等待异步请求完成的默认时间量。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-188">Gets or sets the default amount of a time a client should wait for the asynchronous request to complete.</span></span> |
| <span data-ttu-id="0a4e2-189">EnableScript-全球化</span><span class="sxs-lookup"><span data-stu-id="0a4e2-189">EnableScript-Globalization</span></span> | <span data-ttu-id="0a4e2-190">Bool</span><span class="sxs-lookup"><span data-stu-id="0a4e2-190">Bool</span></span> | <span data-ttu-id="0a4e2-191">获取或设置是否启用脚本全球化。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-191">Gets or sets whether script globalization is enabled.</span></span> |
| <span data-ttu-id="0a4e2-192">EnableScript-本地化</span><span class="sxs-lookup"><span data-stu-id="0a4e2-192">EnableScript-Localization</span></span> | <span data-ttu-id="0a4e2-193">Bool</span><span class="sxs-lookup"><span data-stu-id="0a4e2-193">Bool</span></span> | <span data-ttu-id="0a4e2-194">获取或设置是否启用脚本本地化。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-194">Gets or sets whether script localization is enabled.</span></span> |
| <span data-ttu-id="0a4e2-195">ScriptLoadTimeout</span><span class="sxs-lookup"><span data-stu-id="0a4e2-195">ScriptLoadTimeout</span></span> | <span data-ttu-id="0a4e2-196">Int32</span><span class="sxs-lookup"><span data-stu-id="0a4e2-196">Int32</span></span> | <span data-ttu-id="0a4e2-197">确定允许将脚本加载到客户端的秒数</span><span class="sxs-lookup"><span data-stu-id="0a4e2-197">Determines the number of seconds allowed for loading scripts into the client</span></span> |
| <span data-ttu-id="0a4e2-198">ScriptMode</span><span class="sxs-lookup"><span data-stu-id="0a4e2-198">ScriptMode</span></span> | <span data-ttu-id="0a4e2-199">Enum （自动、调试、发布、继承）</span><span class="sxs-lookup"><span data-stu-id="0a4e2-199">Enum (Auto, Debug, Release, Inherit)</span></span> | <span data-ttu-id="0a4e2-200">获取或设置是否呈现脚本的发布版本</span><span class="sxs-lookup"><span data-stu-id="0a4e2-200">Gets or sets whether to render release versions of scripts</span></span> |
| <span data-ttu-id="0a4e2-201">ScriptPath</span><span class="sxs-lookup"><span data-stu-id="0a4e2-201">ScriptPath</span></span> | <span data-ttu-id="0a4e2-202">字符串</span><span class="sxs-lookup"><span data-stu-id="0a4e2-202">String</span></span> | <span data-ttu-id="0a4e2-203">获取或设置指向要发送到客户端的脚本文件的位置的根路径。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-203">Gets or sets the root path to the location of script files to be sent to the client.</span></span> |

<span data-ttu-id="0a4e2-204">仅限代码的属性：</span><span class="sxs-lookup"><span data-stu-id="0a4e2-204">Code-Only Properties:</span></span>

| <span data-ttu-id="0a4e2-205">**属性名称**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-205">**Property Name**</span></span> | <span data-ttu-id="0a4e2-206">**Type**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-206">**Type**</span></span> | <span data-ttu-id="0a4e2-207">**描述**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-207">**Description**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="0a4e2-208">AuthenticationService</span><span class="sxs-lookup"><span data-stu-id="0a4e2-208">AuthenticationService</span></span> | <span data-ttu-id="0a4e2-209">AuthenticationService</span><span class="sxs-lookup"><span data-stu-id="0a4e2-209">AuthenticationService-Manager</span></span> | <span data-ttu-id="0a4e2-210">获取有关将发送到客户端的 ASP.NET Authentication 服务代理的详细信息。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-210">Gets details about the ASP.NET Authentication Service proxy that will be sent to the client.</span></span> |
| <span data-ttu-id="0a4e2-211">IsDebuggingEnabled</span><span class="sxs-lookup"><span data-stu-id="0a4e2-211">IsDebuggingEnabled</span></span> | <span data-ttu-id="0a4e2-212">Bool</span><span class="sxs-lookup"><span data-stu-id="0a4e2-212">Bool</span></span> | <span data-ttu-id="0a4e2-213">获取是否启用脚本和代码调试。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-213">Gets whether script and code debugging is enabled.</span></span> |
| <span data-ttu-id="0a4e2-214">IsInAsyncPostback</span><span class="sxs-lookup"><span data-stu-id="0a4e2-214">IsInAsyncPostback</span></span> | <span data-ttu-id="0a4e2-215">Bool</span><span class="sxs-lookup"><span data-stu-id="0a4e2-215">Bool</span></span> | <span data-ttu-id="0a4e2-216">获取页面当前是否处于异步回发请求。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-216">Gets whether the page is currently in an asynchronous post back request.</span></span> |
| <span data-ttu-id="0a4e2-217">ProfileService</span><span class="sxs-lookup"><span data-stu-id="0a4e2-217">ProfileService</span></span> | <span data-ttu-id="0a4e2-218">ProfileService</span><span class="sxs-lookup"><span data-stu-id="0a4e2-218">ProfileService-Manager</span></span> | <span data-ttu-id="0a4e2-219">获取有关将发送到客户端的 ASP.NET 分析服务代理的详细信息。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-219">Gets details about the ASP.NET Profiling Service proxy that will be sent to the client.</span></span> |
| <span data-ttu-id="0a4e2-220">脚本</span><span class="sxs-lookup"><span data-stu-id="0a4e2-220">Scripts</span></span> | <span data-ttu-id="0a4e2-221">&lt;脚本引用的集合&gt;</span><span class="sxs-lookup"><span data-stu-id="0a4e2-221">Collection&lt;Script-Reference&gt;</span></span> | <span data-ttu-id="0a4e2-222">获取将发送到客户端的脚本引用的集合。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-222">Gets a collection of script references that will be sent to the client.</span></span> |
| <span data-ttu-id="0a4e2-223">Services</span><span class="sxs-lookup"><span data-stu-id="0a4e2-223">Services</span></span> | <span data-ttu-id="0a4e2-224">集合&lt;服务引用&gt;</span><span class="sxs-lookup"><span data-stu-id="0a4e2-224">Collection&lt;Service-Reference&gt;</span></span> | <span data-ttu-id="0a4e2-225">获取将发送到客户端的 Web 服务代理引用的集合。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-225">Gets a collection of Web Service proxy references that will be sent to the client.</span></span> |
| <span data-ttu-id="0a4e2-226">SupportsPartialRendering</span><span class="sxs-lookup"><span data-stu-id="0a4e2-226">SupportsPartialRendering</span></span> | <span data-ttu-id="0a4e2-227">Bool</span><span class="sxs-lookup"><span data-stu-id="0a4e2-227">Bool</span></span> | <span data-ttu-id="0a4e2-228">获取当前客户端是否支持部分呈现。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-228">Gets whether the current client supports partial rendering.</span></span> <span data-ttu-id="0a4e2-229">如果此属性返回**false**，则所有页面请求均为标准回发。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-229">If this property returns **false**, then all page requests will be standard postbacks.</span></span> |

<span data-ttu-id="0a4e2-230">公共代码方法：</span><span class="sxs-lookup"><span data-stu-id="0a4e2-230">Public Code Methods:</span></span>

| <span data-ttu-id="0a4e2-231">**方法名称**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-231">**Method Name**</span></span> | <span data-ttu-id="0a4e2-232">**Type**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-232">**Type**</span></span> | <span data-ttu-id="0a4e2-233">**描述**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-233">**Description**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="0a4e2-234">SetFocus （string）</span><span class="sxs-lookup"><span data-stu-id="0a4e2-234">SetFocus(string)</span></span> | <span data-ttu-id="0a4e2-235">Void</span><span class="sxs-lookup"><span data-stu-id="0a4e2-235">Void</span></span> | <span data-ttu-id="0a4e2-236">当请求完成时，将客户端的焦点设置到特定控件。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-236">Sets the focus of the client to a particular control when the request has completed.</span></span> |

<span data-ttu-id="0a4e2-237">标记后代：</span><span class="sxs-lookup"><span data-stu-id="0a4e2-237">Markup Descendants:</span></span>

| <span data-ttu-id="0a4e2-238">**符**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-238">**Tag**</span></span> | <span data-ttu-id="0a4e2-239">**描述**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-239">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="0a4e2-240">&lt;AuthenticationService&gt;</span><span class="sxs-lookup"><span data-stu-id="0a4e2-240">&lt;AuthenticationService&gt;</span></span> | <span data-ttu-id="0a4e2-241">提供有关 ASP.NET authentication 服务的代理的详细信息。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-241">Provides details about the proxy to the ASP.NET authentication service.</span></span> |
| <span data-ttu-id="0a4e2-242">&lt;ProfileService&gt;</span><span class="sxs-lookup"><span data-stu-id="0a4e2-242">&lt;ProfileService&gt;</span></span> | <span data-ttu-id="0a4e2-243">提供有关 ASP.NET 分析服务代理的详细信息。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-243">Provides details about the proxy to the ASP.NET profiling service.</span></span> |
| <span data-ttu-id="0a4e2-244">&lt;脚本&gt;</span><span class="sxs-lookup"><span data-stu-id="0a4e2-244">&lt;Scripts&gt;</span></span> | <span data-ttu-id="0a4e2-245">提供其他脚本引用。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-245">Provides additional script references.</span></span> |
| <span data-ttu-id="0a4e2-246">&lt;asp： ScriptReference&gt;</span><span class="sxs-lookup"><span data-stu-id="0a4e2-246">&lt;asp:ScriptReference&gt;</span></span> | <span data-ttu-id="0a4e2-247">表示特定的脚本引用。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-247">Denotes a specific script reference.</span></span> |
| <span data-ttu-id="0a4e2-248">&lt;服务&gt;</span><span class="sxs-lookup"><span data-stu-id="0a4e2-248">&lt;Service&gt;</span></span> | <span data-ttu-id="0a4e2-249">提供将生成代理类的其他 Web 服务引用。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-249">Provides additional Web Service references which will have proxy classes generated.</span></span> |
| <span data-ttu-id="0a4e2-250">&lt;asp： ServiceReference&gt;</span><span class="sxs-lookup"><span data-stu-id="0a4e2-250">&lt;asp:ServiceReference&gt;</span></span> | <span data-ttu-id="0a4e2-251">表示特定的 Web 服务引用。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-251">Denotes a specific Web Service reference.</span></span> |

<span data-ttu-id="0a4e2-252">ScriptManager 控件是 ASP.NET AJAX 扩展的基本核心。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-252">The ScriptManager control is the essential core for the ASP.NET AJAX Extensions.</span></span> <span data-ttu-id="0a4e2-253">它提供对脚本库（包括广泛的客户端脚本类型系统）的访问权限，支持部分呈现，并为其他 ASP.NET 服务（例如身份验证和分析，以及其他 Web 服务）提供广泛支持。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-253">It provides access to the script library (including the extensive client-side script type system), supports partial rendering, and provides extensive support for additional ASP.NET services (such as authentication and profiling, but also other Web Services).</span></span> <span data-ttu-id="0a4e2-254">ScriptManager 控件还提供客户端脚本的全球化和本地化支持。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-254">The ScriptManager control also provides globalization and localization support for the client scripts.</span></span>

## <a name="providing-alternative-and-supplemental-scripts"></a><span data-ttu-id="0a4e2-255">提供备用和补充脚本</span><span class="sxs-lookup"><span data-stu-id="0a4e2-255">Providing Alternative and Supplemental Scripts</span></span>

<span data-ttu-id="0a4e2-256">尽管 Microsoft ASP.NET 2.0 AJAX 扩展包含调试版和发布版中的整个脚本代码（作为嵌入到引用程序集中的资源），但开发人员可随意将 ScriptManager 重定向到自定义脚本文件，并注册其他必需的脚本。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-256">While the Microsoft ASP.NET 2.0 AJAX Extensions include the entire script code in both debug and release editions as resources embedded in the referenced assemblies, developers are free to redirect the ScriptManager to customized script files, as well as register additional necessary scripts.</span></span>

<span data-ttu-id="0a4e2-257">若要覆盖通常包含的脚本（如支持 WebForms 命名空间和自定义类型系统的脚本）的默认绑定，可以注册 ScriptManager 类的 `ResolveScriptReference` 事件。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-257">To override the default binding for the typically-included scripts (such as those which support the Sys.WebForms namespace and the custom typing system), you can register for the `ResolveScriptReference` event of the ScriptManager class.</span></span> <span data-ttu-id="0a4e2-258">调用此方法时，事件处理程序有机会更改相关脚本文件的路径;然后，脚本管理器将不同或自定义的脚本副本发送到客户端。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-258">When this method is called, the event handler has the opportunity to change the path to the script file in question; the script manager will then send a different or customized copy of the scripts to the client.</span></span>

<span data-ttu-id="0a4e2-259">此外，脚本引用（由 `ScriptReference` 类表示）可以通过编程方式或通过标记进行包含。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-259">Additionally, script references (represented by the `ScriptReference` class) can be included programmatically or via markup.</span></span> <span data-ttu-id="0a4e2-260">为此，可以通过编程方式修改 `ScriptManager.Scripts` 集合，或在 `<Scripts>` 标记下包含 `<asp:ScriptReference>` 标记，该标记是 ScriptManager 控件的一级子控件。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-260">To do so, either programmatically modify the `ScriptManager.Scripts` collection, or include `<asp:ScriptReference>` tags under the `<Scripts>` tag, which is a first-level child of the ScriptManager control.</span></span>

## <a name="custom-error-handling-for-updatepanels"></a><span data-ttu-id="0a4e2-261">针对 UpdatePanels 的自定义错误处理</span><span class="sxs-lookup"><span data-stu-id="0a4e2-261">Custom Error Handling for UpdatePanels</span></span>

<span data-ttu-id="0a4e2-262">尽管更新由 UpdatePanel 控件指定的触发器处理，但对错误处理和自定义错误消息的支持由页面的 ScriptManager 控件实例处理。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-262">Although updates are handled by triggers specified by UpdatePanel controls, the support for error handling and custom error messages is handled by a page's ScriptManager control instance.</span></span> <span data-ttu-id="0a4e2-263">这是通过向页面公开事件 `AsyncPostBackError`来完成的，该事件可提供自定义异常处理逻辑。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-263">This is done by exposing an event, `AsyncPostBackError`, to the page which can then provide custom exception-handling logic.</span></span>

<span data-ttu-id="0a4e2-264">通过使用 AsyncPostBackError 事件，您可以指定 `AsyncPostBackErrorMessage` 属性，该属性随后会在回调完成后引发一个警报框。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-264">By consuming the AsyncPostBackError event, you may specify the `AsyncPostBackErrorMessage` property, which then causes an alert box to be raised upon completion of the callback.</span></span>

<span data-ttu-id="0a4e2-265">还可以使用客户端自定义，而不是使用默认警报框;例如，你可能想要显示自定义的 `<div>` 元素，而不是默认浏览器模式对话框。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-265">Client-side customization is also possible instead of using the default alert box; for instance, you may want to display a customized `<div>` element rather than the default browser modal dialog.</span></span> <span data-ttu-id="0a4e2-266">在这种情况下，可以处理客户端脚本中的错误：</span><span class="sxs-lookup"><span data-stu-id="0a4e2-266">In this case, you can handle the error in client script:</span></span>

<span data-ttu-id="0a4e2-267">**列表5：用于显示自定义错误的客户端脚本**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-267">**Listing 5: Client-side script to display custom errors**</span></span>

[!code-html[Main](understanding-partial-page-updates-with-asp-net-ajax/samples/sample4.html)]

<span data-ttu-id="0a4e2-268">简单地说，以上脚本在完成异步请求后，会向客户端 AJAX 运行时注册回调。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-268">Quite simply, the above script registers a callback with the client-side AJAX runtime for when the asynchronous request has been completed.</span></span> <span data-ttu-id="0a4e2-269">然后，它会检查是否报告了错误，如果是，则会处理它的详细信息，最后指示运行时在自定义脚本中处理错误。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-269">It then checks to see whether an error was reported, and if so, processes the details of it, finally indicating to the runtime that the error was handled in custom script.</span></span>

## <a name="globalization-and-localization-support"></a><span data-ttu-id="0a4e2-270">全球化和本地化支持</span><span class="sxs-lookup"><span data-stu-id="0a4e2-270">Globalization and Localization Support</span></span>

<span data-ttu-id="0a4e2-271">ScriptManager 控件为脚本字符串和用户界面组件的本地化提供了广泛的支持;但是，该主题超出了本白皮书的讨论范围。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-271">The ScriptManager control provides extensive support for localization of script strings and user interface components; however, that topic is outside of the scope of this whitepaper.</span></span> <span data-ttu-id="0a4e2-272">有关详细信息，请参阅白皮书： ASP.NET AJAX Extensions 中的全球化支持。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-272">For more information, see the whitepaper, Globalization Support in ASP.NET AJAX Extensions.</span></span>

## <a name="the-updatepanel-control"></a><span data-ttu-id="0a4e2-273">UpdatePanel 控件</span><span class="sxs-lookup"><span data-stu-id="0a4e2-273">The UpdatePanel Control</span></span>

## <a name="updatepanel-control-reference"></a><span data-ttu-id="0a4e2-274">UpdatePanel 控件引用</span><span class="sxs-lookup"><span data-stu-id="0a4e2-274">UpdatePanel Control Reference</span></span>

<span data-ttu-id="0a4e2-275">启用标记的属性：</span><span class="sxs-lookup"><span data-stu-id="0a4e2-275">Markup-Enabled Properties:</span></span>

| <span data-ttu-id="0a4e2-276">**属性名称**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-276">**Property Name**</span></span> | <span data-ttu-id="0a4e2-277">**Type**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-277">**Type**</span></span> | <span data-ttu-id="0a4e2-278">**描述**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-278">**Description**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="0a4e2-279">ChildrenAsTriggers</span><span class="sxs-lookup"><span data-stu-id="0a4e2-279">ChildrenAsTriggers</span></span> | <span data-ttu-id="0a4e2-280">布尔</span><span class="sxs-lookup"><span data-stu-id="0a4e2-280">bool</span></span> | <span data-ttu-id="0a4e2-281">指定子控件在回发时是否自动调用刷新。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-281">Specifies whether child controls automatically invoke refresh on postback.</span></span> |
| <span data-ttu-id="0a4e2-282">RenderMode</span><span class="sxs-lookup"><span data-stu-id="0a4e2-282">RenderMode</span></span> | <span data-ttu-id="0a4e2-283">enum （块，内联）</span><span class="sxs-lookup"><span data-stu-id="0a4e2-283">enum (Block, Inline)</span></span> | <span data-ttu-id="0a4e2-284">指定内容的直观显示方式。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-284">Specifies the way the content will be visually presented.</span></span> |
| <span data-ttu-id="0a4e2-285">UpdateMode</span><span class="sxs-lookup"><span data-stu-id="0a4e2-285">UpdateMode</span></span> | <span data-ttu-id="0a4e2-286">enum （Always，条件）</span><span class="sxs-lookup"><span data-stu-id="0a4e2-286">enum (Always, Conditional)</span></span> | <span data-ttu-id="0a4e2-287">指定 UpdatePanel 是否始终在部分呈现期间刷新，或是否仅在命中触发器时刷新。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-287">Specifies whether the UpdatePanel is always refreshed during a partial render or if it is only refreshed when a trigger is hit.</span></span> |

<span data-ttu-id="0a4e2-288">仅限代码的属性：</span><span class="sxs-lookup"><span data-stu-id="0a4e2-288">Code-Only Properties:</span></span>

| <span data-ttu-id="0a4e2-289">**属性名称**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-289">**Property Name**</span></span> | <span data-ttu-id="0a4e2-290">**Type**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-290">**Type**</span></span> | <span data-ttu-id="0a4e2-291">**描述**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-291">**Description**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="0a4e2-292">IsInPartialRendering</span><span class="sxs-lookup"><span data-stu-id="0a4e2-292">IsInPartialRendering</span></span> | <span data-ttu-id="0a4e2-293">布尔</span><span class="sxs-lookup"><span data-stu-id="0a4e2-293">bool</span></span> | <span data-ttu-id="0a4e2-294">获取 UpdatePanel 是否支持当前请求的部分呈现。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-294">Gets whether the UpdatePanel is supporting partial rendering for the current request.</span></span> |
| <span data-ttu-id="0a4e2-295">System.windows.controls.contentcontrol.contenttemplate</span><span class="sxs-lookup"><span data-stu-id="0a4e2-295">ContentTemplate</span></span> | <span data-ttu-id="0a4e2-296">ITemplate</span><span class="sxs-lookup"><span data-stu-id="0a4e2-296">ITemplate</span></span> | <span data-ttu-id="0a4e2-297">获取更新请求的标记模板。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-297">Gets the markup template for the update request.</span></span> |
| <span data-ttu-id="0a4e2-298">ContentTemplateContainer</span><span class="sxs-lookup"><span data-stu-id="0a4e2-298">ContentTemplateContainer</span></span> | <span data-ttu-id="0a4e2-299">控件</span><span class="sxs-lookup"><span data-stu-id="0a4e2-299">Control</span></span> | <span data-ttu-id="0a4e2-300">获取更新请求的编程模板。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-300">Gets the programmatic template for the update request.</span></span> |
| <span data-ttu-id="0a4e2-301">触发器</span><span class="sxs-lookup"><span data-stu-id="0a4e2-301">Triggers</span></span> | <span data-ttu-id="0a4e2-302">UpdatePanel-TriggerCollection</span><span class="sxs-lookup"><span data-stu-id="0a4e2-302">UpdatePanel- TriggerCollection</span></span> | <span data-ttu-id="0a4e2-303">获取与当前 UpdatePanel 关联的触发器的列表。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-303">Gets the list of triggers associated with the current UpdatePanel.</span></span> |

<span data-ttu-id="0a4e2-304">公共代码方法：</span><span class="sxs-lookup"><span data-stu-id="0a4e2-304">Public Code Methods:</span></span>

| <span data-ttu-id="0a4e2-305">**方法名称**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-305">**Method Name**</span></span> | <span data-ttu-id="0a4e2-306">**Type**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-306">**Type**</span></span> | <span data-ttu-id="0a4e2-307">**描述**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-307">**Description**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="0a4e2-308">Update （）</span><span class="sxs-lookup"><span data-stu-id="0a4e2-308">Update()</span></span> | <span data-ttu-id="0a4e2-309">Void</span><span class="sxs-lookup"><span data-stu-id="0a4e2-309">Void</span></span> | <span data-ttu-id="0a4e2-310">以编程方式更新指定的 UpdatePanel。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-310">Updates the specified UpdatePanel programmatically.</span></span> <span data-ttu-id="0a4e2-311">允许服务器请求触发存 UpdatePanel 的部分呈现。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-311">Allows a server request to trigger a partial render of an otherwise-untriggered UpdatePanel.</span></span> |

<span data-ttu-id="0a4e2-312">标记后代：</span><span class="sxs-lookup"><span data-stu-id="0a4e2-312">Markup Descendants:</span></span>

| <span data-ttu-id="0a4e2-313">**符**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-313">**Tag**</span></span> | <span data-ttu-id="0a4e2-314">**描述**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-314">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="0a4e2-315">&lt;System.windows.controls.contentcontrol.contenttemplate&gt;</span><span class="sxs-lookup"><span data-stu-id="0a4e2-315">&lt;ContentTemplate&gt;</span></span> | <span data-ttu-id="0a4e2-316">指定要用于呈现部分呈现结果的标记。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-316">Specifies the markup to be used to render the partial rendering result.</span></span> <span data-ttu-id="0a4e2-317">&lt;asp： UpdatePanel&gt;的子项。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-317">Child of &lt;asp:UpdatePanel&gt;.</span></span> |
| <span data-ttu-id="0a4e2-318">&lt;触发器&gt;</span><span class="sxs-lookup"><span data-stu-id="0a4e2-318">&lt;Triggers&gt;</span></span> | <span data-ttu-id="0a4e2-319">指定与更新此 UpdatePanel 关联的*n*个控件的集合。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-319">Specifies a collection of *n* controls associated with updating this UpdatePanel.</span></span> <span data-ttu-id="0a4e2-320">&lt;asp： UpdatePanel&gt;的子项。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-320">Child of &lt;asp:UpdatePanel&gt;.</span></span> |
| <span data-ttu-id="0a4e2-321">&lt;asp： AsyncPostBackTrigger&gt;</span><span class="sxs-lookup"><span data-stu-id="0a4e2-321">&lt;asp:AsyncPostBackTrigger&gt;</span></span> | <span data-ttu-id="0a4e2-322">指定一个触发器，该触发器调用给定 UpdatePanel 的部分页面呈现。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-322">Specifies a trigger that invokes a partial page render for the given UpdatePanel.</span></span> <span data-ttu-id="0a4e2-323">这可能是一个控件，也可能不是相关 UpdatePanel 的后代。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-323">This may or may not be a control as a descendant of the UpdatePanel in question.</span></span> <span data-ttu-id="0a4e2-324">精确到事件名称。&gt;&lt;触发器的子项。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-324">Granular to the event name.Child of &lt;Triggers&gt;.</span></span> |
| <span data-ttu-id="0a4e2-325">&lt;asp： PostBackTrigger&gt;</span><span class="sxs-lookup"><span data-stu-id="0a4e2-325">&lt;asp:PostBackTrigger&gt;</span></span> | <span data-ttu-id="0a4e2-326">指定使整个页面刷新的控件。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-326">Specifies a control that causes the entire page to refresh.</span></span> <span data-ttu-id="0a4e2-327">这可能是一个控件，也可能不是相关 UpdatePanel 的后代。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-327">This may or may not be a control as a descendant of the UpdatePanel in question.</span></span> <span data-ttu-id="0a4e2-328">精确到对象。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-328">Granular to the object.</span></span> <span data-ttu-id="0a4e2-329">&gt;&lt;触发器的子项。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-329">Child of &lt;Triggers&gt;.</span></span> |

<span data-ttu-id="0a4e2-330">`UpdatePanel` 控件是指分隔将参与 AJAX 扩展的部分呈现功能的服务器端内容的控件。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-330">The `UpdatePanel` control is the control that delimits the server-side content that will take part in the partial rendering functionality of the AJAX Extensions.</span></span> <span data-ttu-id="0a4e2-331">页面上可包含的 UpdatePanel 控件数没有限制，可以嵌套。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-331">There is no limit to the number of UpdatePanel controls that can be on a page, and they can be nested.</span></span> <span data-ttu-id="0a4e2-332">每个 UpdatePanel 都是独立的，因此每个 UpdatePanel 都可以独立工作（可以同时运行两个 UpdatePanels，从而呈现页面的不同部分，而不受页面的回发的影响）。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-332">Each UpdatePanel is isolated, so that each can work independently (you can have two UpdatePanels running at the same time, rendering different parts of the page, independent of the page's postback).</span></span>

<span data-ttu-id="0a4e2-333">UpdatePanel 控件主要用于处理控件触发器-默认情况下，将创建回发的 UpdatePanel `ContentTemplate` 中包含的任何控件注册为 UpdatePanel 的触发器。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-333">The UpdatePanel control primarily deals with control triggers - by default, any control contained within an UpdatePanel's `ContentTemplate` that creates a postback is registered as a trigger for the UpdatePanel.</span></span> <span data-ttu-id="0a4e2-334">这意味着，UpdatePanel 可以使用用户控件来处理默认数据绑定控件（如 GridView），并可以在脚本中对其进行编程。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-334">This means that the UpdatePanel can work with the default data-bound controls (such as the GridView), with user controls, and they can be programmed in script.</span></span>

<span data-ttu-id="0a4e2-335">默认情况下，当触发部分页面呈现时，将刷新页面上的所有 UpdatePanel 控件，无论 UpdatePanel 控件是否为此类操作定义了触发器。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-335">By default, when a partial page render is triggered, all UpdatePanel controls on the page will be refreshed, whether or not the UpdatePanel controls defined triggers for such action.</span></span> <span data-ttu-id="0a4e2-336">例如，如果一个 UpdatePanel 定义了一个按钮控件并且单击了该按钮控件，则默认情况下，该页面上的所有 UpdatePanel 控件都将刷新。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-336">For example, if one UpdatePanel defines a Button control, and that Button control is clicked, all UpdatePanel controls on that page will be refreshed by default.</span></span> <span data-ttu-id="0a4e2-337">这是因为，默认情况下，UpdatePanel 的 `UpdateMode` 属性设置为 `Always`。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-337">This is because, by default, the `UpdateMode` property of the UpdatePanel is set to `Always`.</span></span> <span data-ttu-id="0a4e2-338">或者，你可以将 UpdateMode 属性设置为 `Conditional`，这意味着仅当命中特定触发器时才会刷新 UpdatePanel。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-338">Alternatively, you may set the UpdateMode property to `Conditional`, which means that the UpdatePanel will only be refreshed if a specific trigger is hit.</span></span>

## <a name="custom-control-notes"></a><span data-ttu-id="0a4e2-339">自定义控件注释</span><span class="sxs-lookup"><span data-stu-id="0a4e2-339">Custom Control Notes</span></span>

<span data-ttu-id="0a4e2-340">可以向任何用户控件或自定义控件添加 UpdatePanel;但是，包含这些控件的页面还必须包含属性 EnablePartialRendering 设置为**true**的 ScriptManager 控件。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-340">An UpdatePanel can be added to any user control or custom control; however, the page on which these controls are included must also include a ScriptManager control with the property EnablePartialRendering set to **true**.</span></span>

<span data-ttu-id="0a4e2-341">在使用 Web 自定义控件时，您可以使用此方法来替代 `CompositeControl` 类的受保护的 `CreateChildControls()` 方法。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-341">One way in which you might account for this when using Web Custom Controls is to override the protected `CreateChildControls()` method of the `CompositeControl` class.</span></span> <span data-ttu-id="0a4e2-342">这样，如果确定页面支持部分呈现，则可以在控件的子控件与外部世界之间注入 UpdatePanel;否则，只需将子控件分层到容器 `Control` 实例即可。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-342">By doing so, you can inject an UpdatePanel between the control's children and the outside world if you determine the page supports partial rendering; otherwise, you can simply layer the child controls into a container `Control` instance.</span></span>

## <a name="updatepanel-considerations"></a><span data-ttu-id="0a4e2-343">UpdatePanel 注意事项</span><span class="sxs-lookup"><span data-stu-id="0a4e2-343">UpdatePanel Considerations</span></span>

<span data-ttu-id="0a4e2-344">UpdatePanel 在 JavaScript XMLHttpRequest 的上下文中以黑框 ASP.NET 的方式运行。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-344">The UpdatePanel operates as something of a black-box, wrapping ASP.NET postbacks within the context of a JavaScript XMLHttpRequest.</span></span> <span data-ttu-id="0a4e2-345">但是，在行为和速度方面，需要牢记重要的性能注意事项。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-345">However, there are significant performance considerations to bear in mind, both in terms of behavior and speed.</span></span> <span data-ttu-id="0a4e2-346">若要理解 UpdatePanel 的工作方式，以便您可以最好地决定何时使用合适的方法，应检查 AJAX exchange。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-346">To understand how the UpdatePanel works, so that you can best decide when its use is appropriate, you should examine the AJAX exchange.</span></span> <span data-ttu-id="0a4e2-347">下面的示例使用现有站点，并使用 Firebug 扩展（Firebug 捕获 XMLHttpRequest 数据）的 Mozilla Firefox。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-347">The following example uses an existing site and, Mozilla Firefox with the Firebug extension (Firebug captures XMLHttpRequest data).</span></span>

<span data-ttu-id="0a4e2-348">请考虑这样一种形式，其中的窗体中的邮政编码为 "邮政编码" 文本框，该文本框应填充窗体或控件上的 city 和 state 字段。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-348">Consider a form that, among other things, has a postal code textbox which is supposed to populate a city and state field on a form or control.</span></span> <span data-ttu-id="0a4e2-349">此窗体最终收集成员身份信息，其中包括用户的姓名、地址和联系人信息。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-349">This form ultimately collects membership information, including a user's name, address, and contact information.</span></span> <span data-ttu-id="0a4e2-350">根据特定项目的要求，需要考虑多个设计注意事项。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-350">There are many design considerations to take into account, based on the requirements of a specific project.</span></span>

[![](understanding-partial-page-updates-with-asp-net-ajax/_static/image11.png)](understanding-partial-page-updates-with-asp-net-ajax/_static/image10.png)

<span data-ttu-id="0a4e2-351">（[单击以查看完全大小的映像](understanding-partial-page-updates-with-asp-net-ajax/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="0a4e2-351">([Click to view full-size image](understanding-partial-page-updates-with-asp-net-ajax/_static/image12.png))</span></span>

[![](understanding-partial-page-updates-with-asp-net-ajax/_static/image14.png)](understanding-partial-page-updates-with-asp-net-ajax/_static/image13.png)

<span data-ttu-id="0a4e2-352">（[单击以查看完全大小的映像](understanding-partial-page-updates-with-asp-net-ajax/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="0a4e2-352">([Click to view full-size image](understanding-partial-page-updates-with-asp-net-ajax/_static/image15.png))</span></span>

<span data-ttu-id="0a4e2-353">在此应用程序的原始迭代中，构建了一个控件，该控件合并了整个用户注册数据，其中包括邮政编码、城市和省/市/自治区。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-353">In the original iteration of this application, a control was built that incorporated the entirety of the user registration data, including the postal code, city, and state.</span></span> <span data-ttu-id="0a4e2-354">整个控件被包装在 UpdatePanel 内并拖放到 Web 窗体上。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-354">The entire control was wrapped within an UpdatePanel and dropped onto a Web Form.</span></span> <span data-ttu-id="0a4e2-355">用户输入邮政编码时，UpdatePanel 会通过指定触发器或使用 ChildrenAsTriggers 属性设置为 true 来检测事件（后端中的相应 TextChanged 事件）。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-355">When the postal code is entered by the user, the UpdatePanel detects the event (the corresponding TextChanged event in the back-end, either by specifying triggers or by using the ChildrenAsTriggers property set to true).</span></span> <span data-ttu-id="0a4e2-356">AJAX 按照 FireBug 捕获的方式发布 UpdatePanel 中的所有字段（请参阅右侧的关系图）。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-356">AJAX posts all of the fields within the UpdatePanel, as captured by FireBug (see the diagram on the right).</span></span>

<span data-ttu-id="0a4e2-357">在屏幕截图指示的情况下，UpdatePanel 中每个控件的值（在本例中为空）和视图状态字段均为空。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-357">As the screen capture indicates, values from every control within the UpdatePanel are delivered (in this case, they are all empty), as well as the ViewState field.</span></span> <span data-ttu-id="0a4e2-358">发送的所有数据都是通过9kb 发送的，实际上只需要五个字节的数据就能进行此特定请求。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-358">All told, over 9kb of data is sent, when in fact only five bytes of data were needed to make this particular request.</span></span> <span data-ttu-id="0a4e2-359">响应更臃肿： total，57kb 将发送到客户端，只是更新文本字段和下拉字段。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-359">The response is even more bloated: in total, 57kb is sent to the client, simply to update a text field and a drop-down field.</span></span>

<span data-ttu-id="0a4e2-360">还需要了解 ASP.NET AJAX 如何更新演示。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-360">It may also be of interest to see how ASP.NET AJAX updates the presentation.</span></span> <span data-ttu-id="0a4e2-361">UpdatePanel 更新请求的响应部分显示在左侧的 Firebug 控制台中;它是由客户端脚本拆分并在页面上重新组合在一起的由客户端脚本分割的特殊的、以竖线分隔的字符串。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-361">The response portion of the UpdatePanel's update request is shown in the Firebug console display on the left; it is a specially-formulated pipe-delimited string that is broken up by the client script and then reassembled on the page.</span></span> <span data-ttu-id="0a4e2-362">具体而言，ASP.NET AJAX 设置代表您的 UpdatePanel 的客户端上的 HTML 元素的*innerHTML*属性。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-362">Specifically, ASP.NET AJAX sets the *innerHTML* property of the HTML element on the client that represents your UpdatePanel.</span></span> <span data-ttu-id="0a4e2-363">当浏览器重新生成 DOM 时，会稍微延迟，具体取决于需要处理的信息量。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-363">As the browser re-generates the DOM, there is a slight delay, depending on the amount of information that needs to be processed.</span></span>

<span data-ttu-id="0a4e2-364">重新生成 DOM 会触发许多其他问题：</span><span class="sxs-lookup"><span data-stu-id="0a4e2-364">The regeneration of the DOM triggers a number of additional issues:</span></span>

[![](understanding-partial-page-updates-with-asp-net-ajax/_static/image17.png)](understanding-partial-page-updates-with-asp-net-ajax/_static/image16.png)

<span data-ttu-id="0a4e2-365">（[单击以查看完全大小的映像](understanding-partial-page-updates-with-asp-net-ajax/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="0a4e2-365">([Click to view full-size image](understanding-partial-page-updates-with-asp-net-ajax/_static/image18.png))</span></span>

- <span data-ttu-id="0a4e2-366">如果焦点 HTML 元素在 UpdatePanel 内，则会失去焦点。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-366">If the focused HTML element is within the UpdatePanel, it will lose focus.</span></span> <span data-ttu-id="0a4e2-367">因此，对于按 Tab 键退出 "邮政编码" 文本框的用户，下一个目标是 "城市" 文本框。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-367">So, for users who pressed the Tab key to exit the postal code text box, their next destination would have been the City text box.</span></span> <span data-ttu-id="0a4e2-368">但是，当 UpdatePanel 刷新显示后，窗体将不再具有焦点，按 Tab 会开始突出显示焦点元素（如链接）。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-368">However, once the UpdatePanel refreshed the display, the form would no longer have had focus, and pressing Tab would have started highlighting the focus elements (such as links).</span></span>
- <span data-ttu-id="0a4e2-369">如果正在使用的任何类型的自定义客户端脚本访问 DOM 元素，则在部分回发后，函数保留的引用可能会失效。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-369">If any type of custom client-side script is in use that accesses DOM elements, references persisted by functions may become defunct after a partial postback.</span></span>

<span data-ttu-id="0a4e2-370">UpdatePanels 不应作为全部捕获解决方案。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-370">UpdatePanels are not intended to be catch-all solutions.</span></span> <span data-ttu-id="0a4e2-371">相反，它们为某些情况提供快速的解决方案（包括原型设计、小控制更新），并为可能熟悉 .NET 对象模型的开发人员和 DOM 提供熟悉的界面。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-371">Rather, they provide a quick solution for certain situations, including prototyping, small control updates, and provide a familiar interface to ASP.NET developers who might be familiar with the .NET object model but less-so with the DOM.</span></span> <span data-ttu-id="0a4e2-372">有多种方法可以提高性能，具体取决于应用程序方案：</span><span class="sxs-lookup"><span data-stu-id="0a4e2-372">There are a number of alternatives that may result in better performance, depending on the application scenario:</span></span>

- <span data-ttu-id="0a4e2-373">请考虑使用 PageMethods 和 JSON （JavaScript 对象表示法）允许开发人员在页面上调用静态方法，就像调用 web 服务调用一样。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-373">Consider using PageMethods and JSON (JavaScript Object Notation) allows the developer to invoke static methods on a page as if a web service call was being invoked.</span></span> <span data-ttu-id="0a4e2-374">由于这些方法是静态的，因此无需状态;脚本调用方提供参数，并以异步方式返回结果。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-374">Because the methods are static, no state is necessary; the script caller supplies the parameters, and the result is returned asynchronously.</span></span>
- <span data-ttu-id="0a4e2-375">如果需要在应用程序的多个位置使用单个控件，请考虑使用 Web 服务和 JSON。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-375">Consider using a Web Service and JSON if a single control needs to be used in several places across an application.</span></span> <span data-ttu-id="0a4e2-376">这又需要很少的特殊工作，并以异步方式运行。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-376">This again requires very little special work, and works asynchronously.</span></span>

<span data-ttu-id="0a4e2-377">通过 Web 服务或页方法引入功能也有缺点。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-377">Incorporating functionality through Web Services or Page Methods has drawbacks as well.</span></span> <span data-ttu-id="0a4e2-378">首先，ASP.NET 开发人员通常会在用户控件（.ascx 文件）中构建少量的功能组件。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-378">First and foremost, ASP.NET developers typically tend to build small components of functionality into user controls (.ascx files).</span></span> <span data-ttu-id="0a4e2-379">页面方法不能在这些文件中托管;它们必须托管在实际 .aspx 页类中。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-379">Page methods cannot be hosted in these files; they must be hosted within the actual .aspx page class.</span></span> <span data-ttu-id="0a4e2-380">同样，Web 服务必须承载于 .asmx 类中。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-380">Web services, similarly, must be hosted within the .asmx class.</span></span> <span data-ttu-id="0a4e2-381">根据应用程序的不同，此体系结构可能违反了单一责任原则，因为单个组件的功能现在分布在两个或更多物理组件中，这两个或多个物理组件可能几乎不存在或没有任何内聚性。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-381">Depending on the application, this architecture may violate the Single Responsibility Principle, in that the functionality for a single component is now spread across two or more physical components which may have little or no cohesive ties.</span></span>

<span data-ttu-id="0a4e2-382">最后，如果应用程序需要使用 UpdatePanels，请遵循以下准则，以帮助进行故障排除和维护。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-382">Finally, if an application requires that UpdatePanels are used, the following guidelines should assist with troubleshooting and maintenance.</span></span>

- <span data-ttu-id="0a4e2-383">**尽可能少嵌套 UpdatePanels，而不仅是在单位内，还可以跨代码单元嵌套。**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-383">**Nest UpdatePanels as little as possible, not only within-units, but also across units of code.**</span></span> <span data-ttu-id="0a4e2-384">例如，在某个页面上包含一个用于包装控件的 UpdatePanel，而该控件还包含一个 UpdatePanel，其中包含另一个包含 UpdatePanel 的控件，它是跨单元嵌套。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-384">For example, having an UpdatePanel on a Page that wraps a Control, while that Control also contains an UpdatePanel, which contains another Control that contains an UpdatePanel, is cross-unit nesting.</span></span> <span data-ttu-id="0a4e2-385">这可以帮助你清楚地了解哪些元素应该刷新，并防止意外刷新到子 UpdatePanels。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-385">This helps to keep clear which elements should be refreshing, and prevents unexpected refreshes to child UpdatePanels.</span></span>
- <span data-ttu-id="0a4e2-386">**将*ChildrenAsTriggers*属性设置为 false，并显式设置触发事件。**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-386">**Keep the *ChildrenAsTriggers* property set to false, and explicitly set triggering events.**</span></span> <span data-ttu-id="0a4e2-387">利用 `<Triggers>` 集合是处理事件的更清晰的方式，可能会阻止意外行为，从而帮助维护任务和强制开发人员选择加入事件。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-387">Utilizing the `<Triggers>` collection is a much clearer way to handle events, and may prevent unexpected behavior, helping with maintenance tasks and forcing a developer to opt-in for an event.</span></span>
- <span data-ttu-id="0a4e2-388">**使用最小的可能单位来实现功能。**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-388">**Use the smallest possible unit to achieve functionality.**</span></span> <span data-ttu-id="0a4e2-389">如邮政编码服务的讨论中所述，仅将最小值仅放在服务器上、总处理时间和客户端-服务器交换的占用量上，从而提高性能。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-389">As noted in the discussion of the postal code service, wrapping only the bare minimum reduces time to the server, total processing, and the footprint of the client-server exchange, enhancing performance.</span></span>

## <a name="the-updateprogress-control"></a><span data-ttu-id="0a4e2-390">UpdateProgress 控件</span><span class="sxs-lookup"><span data-stu-id="0a4e2-390">The UpdateProgress Control</span></span>

## <a name="updateprogress-control-reference"></a><span data-ttu-id="0a4e2-391">UpdateProgress 控件引用</span><span class="sxs-lookup"><span data-stu-id="0a4e2-391">UpdateProgress Control Reference</span></span>

<span data-ttu-id="0a4e2-392">启用标记的属性：</span><span class="sxs-lookup"><span data-stu-id="0a4e2-392">Markup-Enabled Properties:</span></span>

| <span data-ttu-id="0a4e2-393">**属性名称**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-393">**Property Name**</span></span> | <span data-ttu-id="0a4e2-394">**Type**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-394">**Type**</span></span> | <span data-ttu-id="0a4e2-395">**描述**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-395">**Description**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="0a4e2-396">AssociatedUpdate-PanelID</span><span class="sxs-lookup"><span data-stu-id="0a4e2-396">AssociatedUpdate-PanelID</span></span> | <span data-ttu-id="0a4e2-397">字符串</span><span class="sxs-lookup"><span data-stu-id="0a4e2-397">String</span></span> | <span data-ttu-id="0a4e2-398">指定此 UpdateProgress 应报告的 UpdatePanel 的 ID。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-398">Specifies the ID of the UpdatePanel that this UpdateProgress should report on.</span></span> |
| <span data-ttu-id="0a4e2-399">DisplayAfter</span><span class="sxs-lookup"><span data-stu-id="0a4e2-399">DisplayAfter</span></span> | <span data-ttu-id="0a4e2-400">Int</span><span class="sxs-lookup"><span data-stu-id="0a4e2-400">Int</span></span> | <span data-ttu-id="0a4e2-401">指定在异步请求开始后显示此控件之前的超时时间（以毫秒为单位）。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-401">Specifies the timeout in milliseconds before this control is displayed after the asynchronous request begins.</span></span> |
| <span data-ttu-id="0a4e2-402">DynamicLayout</span><span class="sxs-lookup"><span data-stu-id="0a4e2-402">DynamicLayout</span></span> | <span data-ttu-id="0a4e2-403">布尔</span><span class="sxs-lookup"><span data-stu-id="0a4e2-403">bool</span></span> | <span data-ttu-id="0a4e2-404">指定是否动态呈现进度。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-404">Specifies whether the progress is rendered dynamically.</span></span> |

<span data-ttu-id="0a4e2-405">标记后代：</span><span class="sxs-lookup"><span data-stu-id="0a4e2-405">Markup Descendants:</span></span>

| <span data-ttu-id="0a4e2-406">**符**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-406">**Tag**</span></span> | <span data-ttu-id="0a4e2-407">**描述**</span><span class="sxs-lookup"><span data-stu-id="0a4e2-407">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="0a4e2-408">&lt;ProgressTemplate&gt;</span><span class="sxs-lookup"><span data-stu-id="0a4e2-408">&lt;ProgressTemplate&gt;</span></span> | <span data-ttu-id="0a4e2-409">包含将与此控件一起显示的内容的控件模板集。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-409">Contains the control template set for the content that will be displayed with this control.</span></span> |

<span data-ttu-id="0a4e2-410">UpdateProgress 控件提供了一种反馈措施，可以在执行传输到服务器所需的工作时，使用户保持兴趣。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-410">The UpdateProgress control gives you a measure of feedback to keep your users' interest while doing the necessary work to transport to the server.</span></span> <span data-ttu-id="0a4e2-411">这可以帮助您的用户了解您正在执行的操作，尽管它可能并不明显，尤其是因为大多数用户都使用页面刷新并查看状态栏突出显示。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-411">This can help your users know that you're doing something even though it may not be apparent, especially since most users are used to the page refreshing and seeing the status bar highlight.</span></span>

<span data-ttu-id="0a4e2-412">请注意，UpdateProgress 控件可以出现在页层次结构上的任何位置。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-412">As a note, UpdateProgress controls can appear anywhere on a page hierarchy.</span></span> <span data-ttu-id="0a4e2-413">但是，在从子 UpdatePanel （其中，UpdatePanel 嵌套在另一个 UpdatePanel 内）启动部分回发的情况下，触发子 UpdatePanel 的回发将导致为子项显示 UpdateProgress 模板UpdatePanel 以及父 UpdatePanel。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-413">However, in cases in which a partial postback is initiated from a child UpdatePanel (where an UpdatePanel is nested within another UpdatePanel), postbacks that trigger the child UpdatePanel will cause UpdateProgress templates to be displayed for the child UpdatePanel as well as the parent UpdatePanel.</span></span> <span data-ttu-id="0a4e2-414">但如果触发器是父级 UpdatePanel 的直接子级，则只会显示与父级关联的 UpdateProgress 模板。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-414">But, if the trigger is a direct child of the parent UpdatePanel, then only the UpdateProgress templates associated with the parent will be displayed.</span></span>

## <a name="summary"></a><span data-ttu-id="0a4e2-415">总结</span><span class="sxs-lookup"><span data-stu-id="0a4e2-415">Summary</span></span>

<span data-ttu-id="0a4e2-416">Microsoft ASP.NET AJAX 扩展是一种复杂的产品，旨在帮助使 web 内容更易于访问，并为 web 应用程序提供更丰富的用户体验。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-416">The Microsoft ASP.NET AJAX extensions are sophisticated products designed to assist in making web content more accessible and to provide a richer user experience to your web applications.</span></span> <span data-ttu-id="0a4e2-417">作为 ASP.NET AJAX 扩展的一部分，部分页面呈现控件（包括 ScriptManager、UpdatePanel 和 UpdateProgress 控件）是该工具包的一些最明显的组件。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-417">As part of the ASP.NET AJAX Extensions, the partial page rendering controls, including the ScriptManager, the UpdatePanel, and UpdateProgress controls are some of the most visible components of the toolkit.</span></span>

<span data-ttu-id="0a4e2-418">ScriptManager 组件集成了用于扩展的客户端 JavaScript 的设置，并使各种服务器和客户端组件与最小开发投资一起工作。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-418">The ScriptManager component integrates the provision of client JavaScript for the Extensions, as well as enables the various server- and client-side components to work together with minimal development investment.</span></span>

<span data-ttu-id="0a4e2-419">UpdatePanel 控件是 UpdatePanel 中外观较强的标记，它可以包含服务器端代码隐藏，而不会触发页面刷新。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-419">The UpdatePanel control is the apparent magic box - markup within the UpdatePanel can have server-side Codebehind and not trigger a page refresh.</span></span> <span data-ttu-id="0a4e2-420">UpdatePanel 控件可以嵌套，并可依赖于其他 UpdatePanels 中的控件。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-420">UpdatePanel controls can be nested, and can be dependent on controls in other UpdatePanels.</span></span> <span data-ttu-id="0a4e2-421">默认情况下，UpdatePanels 处理由其后代控件调用的任何回发，不过，可以通过声明方式或编程方式对此功能进行微调。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-421">By default, UpdatePanels handle any postbacks invoked by their descendant controls, although this functionality can be finely tuned, either declaratively or programmatically.</span></span>

<span data-ttu-id="0a4e2-422">使用 UpdatePanel 控件时，开发人员应该知道可能会发生的性能影响。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-422">When using the UpdatePanel control, developers should be aware of the performance impact that could potentially arise.</span></span> <span data-ttu-id="0a4e2-423">可能的替代项包括 web 服务和页面方法，但应考虑应用程序的设计。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-423">Potential alternatives include web services and page methods, though the design of the application should be considered.</span></span>

<span data-ttu-id="0a4e2-424">UpdateProgress 控件使用户可以知道，她或他不会被忽略，并且在页面不会执行任何响应用户输入的情况下，后台请求将继续进行。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-424">The UpdateProgress control allows the user to know that she or he is not being ignored, and that the behind-the-scenes request is going on while the page is otherwise not doing anything to respond to the user input.</span></span> <span data-ttu-id="0a4e2-425">它还包括用于中止部分呈现结果的功能。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-425">It also includes the ability to abort partial rendering results.</span></span>

<span data-ttu-id="0a4e2-426">这些工具共同提供了丰富且无缝的用户体验，因为它使服务器对用户的影响更不明显，中断工作流。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-426">Together, these tools assist creating a rich and seamless user experience by making server work less apparent to the user and interrupting workflow less.</span></span>

## <a name="bio"></a><span data-ttu-id="0a4e2-427">Bio</span><span class="sxs-lookup"><span data-stu-id="0a4e2-427">Bio</span></span>

<span data-ttu-id="0a4e2-428">Scott Cate 一直在使用 Microsoft Web 技术，因为1997，是 myKB.com （[www.myKB.com](http://www.myKB.com)）的总裁，他致力于编写基于知识库软件解决方案的基于 ASP.NET 的应用程序。</span><span class="sxs-lookup"><span data-stu-id="0a4e2-428">Scott Cate has been working with Microsoft Web technologies since 1997 and is the President of myKB.com ([www.myKB.com](http://www.myKB.com)) where he specializes in writing ASP.NET based applications focused on Knowledge Base Software solutions.</span></span> <span data-ttu-id="0a4e2-429">可以通过电子邮件联系 Scott [scott.cate@myKB.com](mailto:scott.cate@myKB.com)或[ScottCate.com](http://ScottCate.com)上的博客</span><span class="sxs-lookup"><span data-stu-id="0a4e2-429">Scott can be contacted via email at [scott.cate@myKB.com](mailto:scott.cate@myKB.com) or his blog at [ScottCate.com](http://ScottCate.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="0a4e2-430">下一页</span><span class="sxs-lookup"><span data-stu-id="0a4e2-430">Next</span></span>](understanding-asp-net-ajax-updatepanel-triggers.md)
