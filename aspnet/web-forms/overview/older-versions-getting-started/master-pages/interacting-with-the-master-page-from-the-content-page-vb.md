---
uid: web-forms/overview/older-versions-getting-started/master-pages/interacting-with-the-master-page-from-the-content-page-vb
title: 与从内容页 (VB) 的母版页交互 |Microsoft Docs
author: rick-anderson
description: 探讨如何调用方法，从内容页中的代码中设置属性的母版页等。
ms.author: riande
ms.date: 07/11/2008
ms.assetid: 081fe010-ba0f-4e7d-b4ba-774840b601c2
msc.legacyurl: /web-forms/overview/older-versions-getting-started/master-pages/interacting-with-the-master-page-from-the-content-page-vb
msc.type: authoredcontent
ms.openlocfilehash: 04642dbcd62fe24d4e0fa379b90cbf4122c57066
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/06/2019
ms.locfileid: "65134081"
---
# <a name="interacting-with-the-master-page-from-the-content-page-vb"></a><span data-ttu-id="abba9-103">从内容页与母版页交互 (VB)</span><span class="sxs-lookup"><span data-stu-id="abba9-103">Interacting with the Master Page from the Content Page (VB)</span></span>

<span data-ttu-id="abba9-104">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="abba9-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="abba9-105">[下载代码](http://download.microsoft.com/download/1/8/4/184e24fa-fcc8-47fa-ac99-4b6a52d41e97/ASPNET_MasterPages_Tutorial_06_VB.zip)或[下载 PDF](http://download.microsoft.com/download/e/b/4/eb4abb10-c416-4ba4-9899-32577715b1bd/ASPNET_MasterPages_Tutorial_06_VB.pdf)</span><span class="sxs-lookup"><span data-stu-id="abba9-105">[Download Code](http://download.microsoft.com/download/1/8/4/184e24fa-fcc8-47fa-ac99-4b6a52d41e97/ASPNET_MasterPages_Tutorial_06_VB.zip) or [Download PDF](http://download.microsoft.com/download/e/b/4/eb4abb10-c416-4ba4-9899-32577715b1bd/ASPNET_MasterPages_Tutorial_06_VB.pdf)</span></span>

> <span data-ttu-id="abba9-106">探讨如何调用方法，从内容页中的代码中设置属性的母版页等。</span><span class="sxs-lookup"><span data-stu-id="abba9-106">Examines how to call methods, set properties, etc. of the Master Page from code in the Content Page.</span></span>

## <a name="introduction"></a><span data-ttu-id="abba9-107">介绍</span><span class="sxs-lookup"><span data-stu-id="abba9-107">Introduction</span></span>

<span data-ttu-id="abba9-108">在过去的过去的五个教程已介绍了如何创建主页面、 定义内容区域中，将 ASP.NET 页面绑定到母版页，和定义特定于页面的内容。</span><span class="sxs-lookup"><span data-stu-id="abba9-108">Over the course of the past five tutorials we have looked at how to create a master page, define content regions, bind ASP.NET pages to a master page, and define page-specific content.</span></span> <span data-ttu-id="abba9-109">当访问者请求特定的内容页面时，内容和母版页的标记融合在运行时，从而导致统一的控件层次结构的呈现。</span><span class="sxs-lookup"><span data-stu-id="abba9-109">When a visitor requests a particular content page, the content and master pages' markup are fused at runtime, resulting in the rendering of a unified control hierarchy.</span></span> <span data-ttu-id="abba9-110">因此，我们已经看到了一种方式的主页面，其内容页面的另一个可以进行交互： 拼写 transfuse 到母版页的 ContentPlaceHolder 控件的标记为内容页。</span><span class="sxs-lookup"><span data-stu-id="abba9-110">Therefore, we have already seen one way in which the master page and one of its content pages can interact: the content page spells out the markup to transfuse into the master page's ContentPlaceHolder controls.</span></span>

<span data-ttu-id="abba9-111">什么我们必须尚未检查是如何以编程方式交互的母版页和内容页。</span><span class="sxs-lookup"><span data-stu-id="abba9-111">What we have yet to examine is how the master page and content page can interact programmatically.</span></span> <span data-ttu-id="abba9-112">除了定义母版页的 ContentPlaceHolder 控件的标记，内容页可以将值分配到其主页面的公共属性和调用它的公共方法。</span><span class="sxs-lookup"><span data-stu-id="abba9-112">In addition to defining the markup for the master page's ContentPlaceHolder controls, a content page can also assign values to its master page's public properties and invoke its public methods.</span></span> <span data-ttu-id="abba9-113">同样，母版页可能会使用其内容页交互。</span><span class="sxs-lookup"><span data-stu-id="abba9-113">Similarly, a master page may interact with its content pages.</span></span> <span data-ttu-id="abba9-114">其声明性标记之间的交互比不太常见编程之间母版页和内容页交互时，有很多情况下需要此类编程交互的位置。</span><span class="sxs-lookup"><span data-stu-id="abba9-114">While programmatic interaction between a master and content page is less common than the interaction between their declarative markups, there are many scenarios where such programmatic interaction is needed.</span></span>

<span data-ttu-id="abba9-115">在本教程中我们介绍如何内容页面能以编程方式交互与其母版页;在下一教程将探讨如何母版页同样能与及其内容页交互。</span><span class="sxs-lookup"><span data-stu-id="abba9-115">In this tutorial we examine how a content page can programmatically interact with its master page; in the next tutorial we will look at how the master page can similarly interact with its content pages.</span></span>

## <a name="examples-of-programmatic-interaction-between-a-content-page-and-its-master-page"></a><span data-ttu-id="abba9-116">之间的内容页和其母版页编程交互的示例</span><span class="sxs-lookup"><span data-stu-id="abba9-116">Examples of Programmatic Interaction Between a Content Page and its Master Page</span></span>

<span data-ttu-id="abba9-117">当一个页面的特定区域需要按页根据配置时，我们使用 ContentPlaceHolder 控件。</span><span class="sxs-lookup"><span data-stu-id="abba9-117">When a particular region of a page needs to be configured on a page-by-page basis, we use a ContentPlaceHolder control.</span></span> <span data-ttu-id="abba9-118">但是情况下，大多数页需要发出特定输出，但少量的页面需要自定义，以便显示其他内容呢？</span><span class="sxs-lookup"><span data-stu-id="abba9-118">But what about situations where the majority of pages need to emit a certain output, but a small number of pages need to customize it to show something else?</span></span> <span data-ttu-id="abba9-119">此类一个中，我们探讨的示例[*多个 Contentplaceholder 和默认内容*](multiple-contentplaceholders-and-default-content-vb.md)教程中，涉及到每个页面上显示登录界面。</span><span class="sxs-lookup"><span data-stu-id="abba9-119">One such example, which we examined in the [*Multiple ContentPlaceHolders and Default Content*](multiple-contentplaceholders-and-default-content-vb.md) tutorial, involves displaying a login interface on each page.</span></span> <span data-ttu-id="abba9-120">虽然大多数页面应包含登录界面，它要抑制的少量的页面，如： 主登录页 (`Login.aspx`); 在创建帐户页和只是经过身份验证的用户可以访问其他页面。</span><span class="sxs-lookup"><span data-stu-id="abba9-120">While most pages should include a login interface, it should be suppressed for a handful of pages, such as: the main login page (`Login.aspx`); the Create Account page; and other pages that are only accessible to authenticated users.</span></span> <span data-ttu-id="abba9-121">[*多个 Contentplaceholder 和默认内容*](multiple-contentplaceholders-and-default-content-vb.md)教程介绍了如何为 ContentPlaceHolder 母版页中定义的默认内容和如何在这些重写该页面的位置不需要默认的内容。</span><span class="sxs-lookup"><span data-stu-id="abba9-121">The [*Multiple ContentPlaceHolders and Default Content*](multiple-contentplaceholders-and-default-content-vb.md) tutorial showed how to define the default content for a ContentPlaceHolder in the master page and then how to override it in those pages where the default content was not wanted.</span></span>

<span data-ttu-id="abba9-122">另一种方法是创建的公共属性或母版页，该值指示是否显示或隐藏登录界面中的方法。</span><span class="sxs-lookup"><span data-stu-id="abba9-122">Another option is to create a public property or method within the master page that indicates whether to show or hide the login interface.</span></span> <span data-ttu-id="abba9-123">例如，主页面可能包含名为的公共属性`ShowLoginUI`其值用于设置`Visible`母版页中的登录名控件的属性。</span><span class="sxs-lookup"><span data-stu-id="abba9-123">For example, the master page might include a public property named `ShowLoginUI` whose value was used to set the `Visible` property of the Login control in the master page.</span></span> <span data-ttu-id="abba9-124">然后可以以编程方式设置这些内容页面应取消显示登录用户界面`ShowLoginUI`属性设置为`False`。</span><span class="sxs-lookup"><span data-stu-id="abba9-124">Those content pages where the login user interface should be suppressed could then programmatically set the `ShowLoginUI` property to `False`.</span></span>

<span data-ttu-id="abba9-125">可能的数据显示在母版页需要某种操作已经在内容页中产生后刷新时发生内容与母版页交互的最常见的例子。</span><span class="sxs-lookup"><span data-stu-id="abba9-125">Perhaps the most common example of content and master page interaction occurs when data displayed in the master page needs to be refreshed after some action has transpired in the content page.</span></span> <span data-ttu-id="abba9-126">请考虑包括一个 GridView，显示 5 个最新的主页面从特定数据库表中添加记录和其内容页面的一个包含用于将新记录添加到同一个表的接口。</span><span class="sxs-lookup"><span data-stu-id="abba9-126">Consider a master page that includes a GridView that displays the five most recently added records from a particular database table, and that one of its content pages includes an interface for adding new records to that same table.</span></span>

<span data-ttu-id="abba9-127">当用户访问页后，可以添加新记录时，她会看到的五个最近添加的记录显示在母版页。</span><span class="sxs-lookup"><span data-stu-id="abba9-127">When a user visits the page to add a new record, she sees the five most recently added records displayed in the master page.</span></span> <span data-ttu-id="abba9-128">在填写新记录的列的值，她将提交窗体。</span><span class="sxs-lookup"><span data-stu-id="abba9-128">After filling in the values for the new record's columns, she submits the form.</span></span> <span data-ttu-id="abba9-129">假设在母版页中的这个 GridView 有其`EnableViewState`属性设置为 True （默认值），从视图状态重新加载其内容，并且即使只是较新记录添加到数据库，因此，显示 5 个同一个记录。</span><span class="sxs-lookup"><span data-stu-id="abba9-129">Assuming that the GridView in the master page has its `EnableViewState` property set to True (the default), its content is reloaded from view state and, consequently, the five same records are displayed even though a newer record was just added to the database.</span></span> <span data-ttu-id="abba9-130">这可能会使用户感到困惑。</span><span class="sxs-lookup"><span data-stu-id="abba9-130">This may confuse the user.</span></span>

> [!NOTE]
> <span data-ttu-id="abba9-131">即使禁用 GridView 的视图状态到在每个回发时其基础数据源重新绑定，它仍不会显示刚添加的记录因为数据绑定到 GridView 前面的页面生命周期比新记录添加到数据库时ase。</span><span class="sxs-lookup"><span data-stu-id="abba9-131">Even if you disable the GridView's view state so that it rebinds to its underlying data source on every postback, it still won't show the just-added record because the data is bound to the GridView earlier in the page lifecycle than when the new record is added to the database.</span></span>

<span data-ttu-id="abba9-132">若要解决此问题，以便刚添加的记录显示在母版页中的 GridView 在回发时我们需要指示 GridView 重新绑定到其数据源*后*新记录已添加到数据库。</span><span class="sxs-lookup"><span data-stu-id="abba9-132">To remedy this so that the just-added record is displayed in the master page's GridView on postback we need to instruct the GridView to rebind to its data source *after* the new record has been added to the database.</span></span> <span data-ttu-id="abba9-133">这需要的内容和主页面之间的交互，因为用于添加新记录 （和其事件处理程序） 都在内容页，但需要刷新 GridView 接口是在母版页中。</span><span class="sxs-lookup"><span data-stu-id="abba9-133">This requires interaction between the content and master pages because the interface for adding the new record (and its event handlers) are in the content page but the GridView that needs to be refreshed is in the master page.</span></span>

<span data-ttu-id="abba9-134">由于刷新从内容页中的事件处理程序的主页面的显示是一个对内容和母版页交互最常见的需求，我们来探讨本主题中更多详细信息。</span><span class="sxs-lookup"><span data-stu-id="abba9-134">Because refreshing the master page's display from an event handler in the content page is one of the most common needs for content and master page interaction, let's explore this topic in more detail.</span></span> <span data-ttu-id="abba9-135">本教程中下载内容还包括名为的 Microsoft SQL Server 2005 Express Edition 数据库`NORTHWIND.MDF`在网站的`App_Data`文件夹。</span><span class="sxs-lookup"><span data-stu-id="abba9-135">The download for this tutorial includes a Microsoft SQL Server 2005 Express Edition database named `NORTHWIND.MDF` in the website's `App_Data` folder.</span></span> <span data-ttu-id="abba9-136">Northwind 数据库存储产品、 员工和针对虚构公司，Northwind Traders 的销售信息。</span><span class="sxs-lookup"><span data-stu-id="abba9-136">The Northwind database stores product, employee, and sales information for a fictitious company, Northwind Traders.</span></span>

<span data-ttu-id="abba9-137">步骤 1 演练显示的五个最近在母版页中的 GridView 中添加产品。</span><span class="sxs-lookup"><span data-stu-id="abba9-137">Step 1 walks through displaying the five most recently added products in a GridView in the master page.</span></span> <span data-ttu-id="abba9-138">步骤 2 创建一个内容页面中添加新的产品。</span><span class="sxs-lookup"><span data-stu-id="abba9-138">Step 2 creates a content page for adding new products.</span></span> <span data-ttu-id="abba9-139">步骤 3 介绍如何创建主页面中的公共属性和方法和步骤 4 说明了如何以编程方式与这些属性和方法从内容页交互。</span><span class="sxs-lookup"><span data-stu-id="abba9-139">Step 3 looks at how to create public properties and methods in the master page, and Step 4 illustrates how to programmatically interface with these properties and methods from the content page.</span></span>

> [!NOTE]
> <span data-ttu-id="abba9-140">本教程不会不深入探讨在 ASP.NET 中使用数据的具体情况。</span><span class="sxs-lookup"><span data-stu-id="abba9-140">This tutorial does not delve into the specifics of working with data in ASP.NET.</span></span> <span data-ttu-id="abba9-141">设置主页面以显示数据和插入数据的内容页的步骤是完整的尚未轻松。</span><span class="sxs-lookup"><span data-stu-id="abba9-141">The steps for setting up the master page to display data and the content page for inserting data are complete, yet breezy.</span></span> <span data-ttu-id="abba9-142">显示和插入数据以及使用 SqlDataSource 和 GridView 控件的更深入信息，请在本教程末尾查阅中进一步读数部分资源。</span><span class="sxs-lookup"><span data-stu-id="abba9-142">For a more in-depth look at displaying and inserting data and using the SqlDataSource and GridView controls, consult the resources in the Further Readings section at the end of this tutorial.</span></span>

## <a name="step-1-displaying-the-five-most-recently-added-products-in-the-master-page"></a><span data-ttu-id="abba9-143">步骤 1：最近显示的五个母版页中添加产品</span><span class="sxs-lookup"><span data-stu-id="abba9-143">Step 1: Displaying the Five Most Recently Added Products in the Master Page</span></span>

<span data-ttu-id="abba9-144">打开 Site.master 母版页并添加一个标签和 GridView 控件与`leftContent` `<div>`。</span><span class="sxs-lookup"><span data-stu-id="abba9-144">Open the Site.master master page and add a Label and a GridView control to the `leftContent` `<div>`.</span></span> <span data-ttu-id="abba9-145">清除的标签`Text`属性，则设置其`EnableViewState`属性设置为`False`，并将其`ID`属性设置为`GridMessage`; 设置 GridView`ID`属性设置为`RecentProducts`。</span><span class="sxs-lookup"><span data-stu-id="abba9-145">Clear out the Label's `Text` property, set its `EnableViewState` property to `False`, and its `ID` property to `GridMessage`; set the GridView's `ID` property to `RecentProducts`.</span></span> <span data-ttu-id="abba9-146">接下来，从设计器中，展开 GridView 的智能标记，并选择将其绑定到新的数据源。</span><span class="sxs-lookup"><span data-stu-id="abba9-146">Next, from the Designer, expand the GridView's smart tag and choose to bind it to a new data source.</span></span> <span data-ttu-id="abba9-147">这将启动数据源配置向导。</span><span class="sxs-lookup"><span data-stu-id="abba9-147">This launches the Data Source Configuration wizard.</span></span> <span data-ttu-id="abba9-148">因为 Northwind 数据库中`App_Data`文件夹是 Microsoft SQL Server 数据库中，选择通过选择 （见图 1） 创建 SqlDataSource; 名称 SqlDataSource `RecentProductsDataSource`。</span><span class="sxs-lookup"><span data-stu-id="abba9-148">Because the Northwind database in the `App_Data` folder is a Microsoft SQL Server database, choose to create a SqlDataSource by selecting (see Figure 1); name the SqlDataSource `RecentProductsDataSource`.</span></span>

<span data-ttu-id="abba9-149">[![将 GridView 绑定到名为 RecentProductsDataSource SqlDataSource 控件](interacting-with-the-master-page-from-the-content-page-vb/_static/image2.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="abba9-149">[![Bind the GridView to a SqlDataSource Control Named RecentProductsDataSource](interacting-with-the-master-page-from-the-content-page-vb/_static/image2.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image1.png)</span></span>

<span data-ttu-id="abba9-150">**图 01**:将 GridView 绑定到 SqlDataSource 控件命名为`RecentProductsDataSource`([单击以查看实际尺寸的图像](interacting-with-the-master-page-from-the-content-page-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="abba9-150">**Figure 01**: Bind the GridView to a SqlDataSource Control Named `RecentProductsDataSource` ([Click to view full-size image](interacting-with-the-master-page-from-the-content-page-vb/_static/image3.png))</span></span>

<span data-ttu-id="abba9-151">下一步会要求我们指定要连接到内容数据库。</span><span class="sxs-lookup"><span data-stu-id="abba9-151">The next step asks us to specify what database to connect to.</span></span> <span data-ttu-id="abba9-152">选择`NORTHWIND.MDF`数据库文件从下拉列表中，单击下一步。</span><span class="sxs-lookup"><span data-stu-id="abba9-152">Choose the `NORTHWIND.MDF` database file from the drop-down list and click Next.</span></span> <span data-ttu-id="abba9-153">由于这是首次我们使用此数据库，该向导将提供用于存储连接字符串中的`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="abba9-153">Because this is the first time we've used this database, the wizard will offer to store the connection string in `Web.config`.</span></span> <span data-ttu-id="abba9-154">将其存储连接字符串使用名称`NorthwindConnectionString`。</span><span class="sxs-lookup"><span data-stu-id="abba9-154">Have it store the connection string using the name `NorthwindConnectionString`.</span></span>

<span data-ttu-id="abba9-155">[![连接到 Northwind 数据库](interacting-with-the-master-page-from-the-content-page-vb/_static/image5.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="abba9-155">[![Connect to the Northwind Database](interacting-with-the-master-page-from-the-content-page-vb/_static/image5.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image4.png)</span></span>

<span data-ttu-id="abba9-156">**图 02**:连接到 Northwind 数据库 ([单击此项可查看原尺寸图像](interacting-with-the-master-page-from-the-content-page-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="abba9-156">**Figure 02**: Connect to the Northwind Database  ([Click to view full-size image](interacting-with-the-master-page-from-the-content-page-vb/_static/image6.png))</span></span>

<span data-ttu-id="abba9-157">配置数据源向导提供了通过其中我们可以指定用于检索数据的查询的两个方法：</span><span class="sxs-lookup"><span data-stu-id="abba9-157">The Configure Data Source wizard provides two means by which we can specify the query used to retrieve data:</span></span>

- <span data-ttu-id="abba9-158">通过指定自定义 SQL 语句或存储的过程，或</span><span class="sxs-lookup"><span data-stu-id="abba9-158">By specifying a custom SQL statement or stored procedure, or</span></span>
- <span data-ttu-id="abba9-159">通过选择表或视图，然后指定要返回的列</span><span class="sxs-lookup"><span data-stu-id="abba9-159">By picking a table or view and then specifying the columns to return</span></span>

<span data-ttu-id="abba9-160">因为我们想要返回 5 个最新添加的产品，我们需要指定自定义 SQL 语句。</span><span class="sxs-lookup"><span data-stu-id="abba9-160">Because we want to return just the five most recently added products, we need to specify a custom SQL statement.</span></span> <span data-ttu-id="abba9-161">使用以下`SELECT`查询：</span><span class="sxs-lookup"><span data-stu-id="abba9-161">Use the following `SELECT` query:</span></span>

[!code-sql[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample1.sql)]

<span data-ttu-id="abba9-162">`TOP 5`关键字的查询返回只有前五个记录。</span><span class="sxs-lookup"><span data-stu-id="abba9-162">The `TOP 5` keyword returns only the first five records from the query.</span></span> <span data-ttu-id="abba9-163">`Products`表的主键`ProductID`，是`IDENTITY`列中，从而确保我们添加到表中每个新产品，将具有更大的值比以前的条目。</span><span class="sxs-lookup"><span data-stu-id="abba9-163">The `Products` table's primary key, `ProductID`, is an `IDENTITY` column, which assures us that each new product added to the table will have a larger value than the previous entry.</span></span> <span data-ttu-id="abba9-164">因此，对通过结果进行排序`ProductID`以降序返回从开始最新创建的产品。</span><span class="sxs-lookup"><span data-stu-id="abba9-164">Therefore, sorting the results by `ProductID` in descending order returns the products starting with the most recently created ones.</span></span>

<span data-ttu-id="abba9-165">[![返回最近添加的五种产品](interacting-with-the-master-page-from-the-content-page-vb/_static/image8.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="abba9-165">[![Return the Five Most Recently Added Products](interacting-with-the-master-page-from-the-content-page-vb/_static/image8.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image7.png)</span></span>

<span data-ttu-id="abba9-166">**图 03**:返回五种最最近添加的产品 ([单击此项可查看原尺寸图像](interacting-with-the-master-page-from-the-content-page-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="abba9-166">**Figure 03**: Return the Five Most Recently Added Products  ([Click to view full-size image](interacting-with-the-master-page-from-the-content-page-vb/_static/image9.png))</span></span>

<span data-ttu-id="abba9-167">完成向导后，Visual Studio 将生成的 GridView，其中显示两个 BoundFields`ProductName`和`UnitPrice`从数据库返回的字段。</span><span class="sxs-lookup"><span data-stu-id="abba9-167">After completing the wizard, Visual Studio generates two BoundFields for the GridView to display the `ProductName` and `UnitPrice` fields returned from the database.</span></span> <span data-ttu-id="abba9-168">此时主页面的声明性标记应包括标记类似于以下内容：</span><span class="sxs-lookup"><span data-stu-id="abba9-168">At this point your master page's declarative markup should include markup similar to the following:</span></span>

[!code-aspx[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample2.aspx)]

<span data-ttu-id="abba9-169">正如您所看到的包含标记： 标签 Web 控件 (`GridMessage`); GridView `RecentProducts`，两个 BoundFields; 并且返回的五个最近添加的产品使用 SqlDataSource 控件。</span><span class="sxs-lookup"><span data-stu-id="abba9-169">As you can see, the markup contains: the Label Web control (`GridMessage`); the GridView `RecentProducts`, with two BoundFields; and a SqlDataSource control that returns the five most recently added products.</span></span>

<span data-ttu-id="abba9-170">与此 GridView 创建和配置，其 SqlDataSource 控件访问网站，通过浏览器。</span><span class="sxs-lookup"><span data-stu-id="abba9-170">With this GridView created and its SqlDataSource control configured, visit the website through a browser.</span></span> <span data-ttu-id="abba9-171">如图 4 所示，你将看到其中列出了五个最近左下角中的一个网格添加产品。</span><span class="sxs-lookup"><span data-stu-id="abba9-171">As Figure 4 shows, you will see a grid in the lower left corner that lists the five most recently added products.</span></span>

<span data-ttu-id="abba9-172">[![GridView 显示五个最近添加的产品](interacting-with-the-master-page-from-the-content-page-vb/_static/image11.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="abba9-172">[![The GridView Displays the Five Most Recently Added Products](interacting-with-the-master-page-from-the-content-page-vb/_static/image11.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image10.png)</span></span>

<span data-ttu-id="abba9-173">**图 04**:GridView 显示五种最最近添加的产品 ([单击此项可查看原尺寸图像](interacting-with-the-master-page-from-the-content-page-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="abba9-173">**Figure 04**: The GridView Displays the Five Most Recently Added Products ([Click to view full-size image](interacting-with-the-master-page-from-the-content-page-vb/_static/image12.png))</span></span>

> [!NOTE]
> <span data-ttu-id="abba9-174">随意清理的 GridView 的外观。</span><span class="sxs-lookup"><span data-stu-id="abba9-174">Feel free to clean up the appearance of the GridView.</span></span> <span data-ttu-id="abba9-175">某些建议包括格式设置在显示`UnitPrice`值作为货币和使用背景颜色和字体以改善该网格的外观。</span><span class="sxs-lookup"><span data-stu-id="abba9-175">Some suggestions include formatting the displayed `UnitPrice` value as a currency and using background colors and fonts to improve the grid's appearance.</span></span>

## <a name="step-2-creating-a-content-page-to-add-new-products"></a><span data-ttu-id="abba9-176">步骤 2：创建要添加的新产品的内容页面</span><span class="sxs-lookup"><span data-stu-id="abba9-176">Step 2: Creating a Content Page to Add New Products</span></span>

<span data-ttu-id="abba9-177">我们的下一个任务是创建用户可以从其添加到新产品的内容页面`Products`表。</span><span class="sxs-lookup"><span data-stu-id="abba9-177">Our next task is to create a content page from which a user can add a new product to the `Products` table.</span></span> <span data-ttu-id="abba9-178">添加到新的内容页`Admin`名为的文件夹`AddProduct.aspx`，确保将将其绑定到`Site.master`母版页。</span><span class="sxs-lookup"><span data-stu-id="abba9-178">Add a new content page to the `Admin` folder named `AddProduct.aspx`, making sure to bind it to the `Site.master` master page.</span></span> <span data-ttu-id="abba9-179">此页添加到网站后，图 5 显示了在解决方案资源管理器。</span><span class="sxs-lookup"><span data-stu-id="abba9-179">Figure 5 shows the Solution Explorer after this page has been added to the website.</span></span>

<span data-ttu-id="abba9-180">[![向管理员文件夹添加新的 ASP.NET 页面](interacting-with-the-master-page-from-the-content-page-vb/_static/image14.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="abba9-180">[![Add a New ASP.NET Page to the Admin Folder](interacting-with-the-master-page-from-the-content-page-vb/_static/image14.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image13.png)</span></span>

<span data-ttu-id="abba9-181">**图 05**:添加到新的 ASP.NET 页`Admin`文件夹 ([单击以查看实际尺寸的图像](interacting-with-the-master-page-from-the-content-page-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="abba9-181">**Figure 05**: Add a New ASP.NET Page to the `Admin` Folder ([Click to view full-size image](interacting-with-the-master-page-from-the-content-page-vb/_static/image15.png))</span></span>

<span data-ttu-id="abba9-182">回想一下，在[*母版页中指定的标题、 元标记和其他 HTML 标头*](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-vb.md)教程中，我们创建一个名为的自定义基本页类`BasePage`如果它已生成了页面的标题未显式设置。</span><span class="sxs-lookup"><span data-stu-id="abba9-182">Recall that in the [*Specifying the Title, Meta Tags, and Other HTML Headers in the Master Page*](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-vb.md) tutorial we created a custom base page class named `BasePage` that generated the page's title if it was not explicitly set.</span></span> <span data-ttu-id="abba9-183">转到`AddProduct.aspx`页面的代码隐藏类，并将其派生`BasePage`(而不是从`System.Web.UI.Page`)。</span><span class="sxs-lookup"><span data-stu-id="abba9-183">Go to the `AddProduct.aspx` page's code-behind class and have it derive from `BasePage` (instead of from `System.Web.UI.Page`).</span></span>

<span data-ttu-id="abba9-184">最后，更新`Web.sitemap`文件以便包括本课程中的一个条目。</span><span class="sxs-lookup"><span data-stu-id="abba9-184">Finally, update the `Web.sitemap` file to include an entry for this lesson.</span></span> <span data-ttu-id="abba9-185">添加以下标记下方`<siteMapNode>`控件 ID 命名问题课程：</span><span class="sxs-lookup"><span data-stu-id="abba9-185">Add the following markup beneath the `<siteMapNode>` for the Control ID Naming Issues lesson:</span></span>

[!code-xml[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample3.xml)]

<span data-ttu-id="abba9-186">图 6 中，添加此中所示`<siteMapNode>`元素将反映在课程列表。</span><span class="sxs-lookup"><span data-stu-id="abba9-186">As shown in Figure 6, the addition of this `<siteMapNode>` element is reflected in the Lessons list.</span></span>

<span data-ttu-id="abba9-187">返回到`AddProduct.aspx`。</span><span class="sxs-lookup"><span data-stu-id="abba9-187">Return to `AddProduct.aspx`.</span></span> <span data-ttu-id="abba9-188">中的内容控件`MainContent`ContentPlaceHolder，添加的 DetailsView 控件并将其命名`NewProduct`。</span><span class="sxs-lookup"><span data-stu-id="abba9-188">In the Content control for the `MainContent` ContentPlaceHolder, add a DetailsView control and name it `NewProduct`.</span></span> <span data-ttu-id="abba9-189">绑定到名为的新 SqlDataSource 控件的 DetailsView `NewProductDataSource`。</span><span class="sxs-lookup"><span data-stu-id="abba9-189">Bind the DetailsView to a new SqlDataSource control named `NewProductDataSource`.</span></span> <span data-ttu-id="abba9-190">例如，使其使用 Northwind 数据库，则使用在步骤 1 中 SqlDataSource，配置向导和选择来指定自定义 SQL 语句。</span><span class="sxs-lookup"><span data-stu-id="abba9-190">Like with the SqlDataSource in Step 1, configure the wizard so that it uses the Northwind database and choose to specify a custom SQL statement.</span></span> <span data-ttu-id="abba9-191">由于 DetailsView 将用于将项添加到数据库，我们需要同时指定`SELECT`语句和一个`INSERT`语句。</span><span class="sxs-lookup"><span data-stu-id="abba9-191">Because the DetailsView will be used to add items to the database, we need to specify both a `SELECT` statement and an `INSERT` statement.</span></span> <span data-ttu-id="abba9-192">使用以下`SELECT`查询：</span><span class="sxs-lookup"><span data-stu-id="abba9-192">Use the following `SELECT` query:</span></span>

[!code-sql[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample4.sql)]

<span data-ttu-id="abba9-193">然后，从插入选项卡，添加以下`INSERT`语句：</span><span class="sxs-lookup"><span data-stu-id="abba9-193">Then, from the INSERT tab, add the following `INSERT` statement:</span></span>

[!code-sql[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample5.sql)]

<span data-ttu-id="abba9-194">完成向导后转到 DetailsView 的智能标记，并选中"启用插入"复选框。</span><span class="sxs-lookup"><span data-stu-id="abba9-194">After completing the wizard go to the DetailsView's smart tag and check the "Enable Inserting" checkbox.</span></span> <span data-ttu-id="abba9-195">这会向与 DetailsView 添加 CommandField 其`ShowInsertButton`属性设置为 True。</span><span class="sxs-lookup"><span data-stu-id="abba9-195">This adds a CommandField to the DetailsView with its `ShowInsertButton` property set to True.</span></span> <span data-ttu-id="abba9-196">由于此 DetailsView 将使用仅用于插入数据，因此设置 DetailsView`DefaultMode`属性设置为`Insert`。</span><span class="sxs-lookup"><span data-stu-id="abba9-196">Because this DetailsView will be used solely for inserting data, set the DetailsView's `DefaultMode` property to `Insert`.</span></span>

<span data-ttu-id="abba9-197">就这么简单！</span><span class="sxs-lookup"><span data-stu-id="abba9-197">That's all there is to it!</span></span> <span data-ttu-id="abba9-198">让我们来测试此页。</span><span class="sxs-lookup"><span data-stu-id="abba9-198">Let's test this page.</span></span> <span data-ttu-id="abba9-199">请访问`AddProduct.aspx`通过浏览器中，输入名称和价格 （请参见图 6）。</span><span class="sxs-lookup"><span data-stu-id="abba9-199">Visit `AddProduct.aspx` through a browser, enter a name and price (see Figure 6).</span></span>

<span data-ttu-id="abba9-200">[![向数据库添加一个新的产品](interacting-with-the-master-page-from-the-content-page-vb/_static/image17.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="abba9-200">[![Add a New Product to the Database](interacting-with-the-master-page-from-the-content-page-vb/_static/image17.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image16.png)</span></span>

<span data-ttu-id="abba9-201">**图 06**:向数据库添加一个新的产品 ([单击此项可查看原尺寸图像](interacting-with-the-master-page-from-the-content-page-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="abba9-201">**Figure 06**: Add a New Product to the Database  ([Click to view full-size image](interacting-with-the-master-page-from-the-content-page-vb/_static/image18.png))</span></span>

<span data-ttu-id="abba9-202">键入后的名称和新产品的价格中，单击插入按钮。</span><span class="sxs-lookup"><span data-stu-id="abba9-202">After typing in the name and price for your new product, click the Insert button.</span></span> <span data-ttu-id="abba9-203">这会导致窗体回发。</span><span class="sxs-lookup"><span data-stu-id="abba9-203">This causes the form to postback.</span></span> <span data-ttu-id="abba9-204">在回发时，SqlDataSource 控件的`INSERT`执行语句; 其两个参数都填入 DetailsView 的两个 TextBox 控件中的用户输入值。</span><span class="sxs-lookup"><span data-stu-id="abba9-204">On postback, the SqlDataSource control's `INSERT` statement is executed; its two parameters are populated with the user-entered values in the DetailsView's two TextBox controls.</span></span> <span data-ttu-id="abba9-205">遗憾的是，没有插入发生任何可视反馈。</span><span class="sxs-lookup"><span data-stu-id="abba9-205">Unfortunately, there is no visual feedback that an insert has occurred.</span></span> <span data-ttu-id="abba9-206">很高兴有消息显示，确认已添加新记录。</span><span class="sxs-lookup"><span data-stu-id="abba9-206">It would be nice to have a message displayed, confirming that a new record has been added.</span></span> <span data-ttu-id="abba9-207">我将此当作练习留给读者。</span><span class="sxs-lookup"><span data-stu-id="abba9-207">I leave this as an exercise for the reader.</span></span> <span data-ttu-id="abba9-208">此外，从 DetailsView 添加一条新记录后在母版页中的 GridView 仍显示相同的五个记录作为之前;它不包括刚添加的记录。</span><span class="sxs-lookup"><span data-stu-id="abba9-208">Also, after adding a new record from the DetailsView the GridView in the master page still shows the same five records as before; it does not include the just-added record.</span></span> <span data-ttu-id="abba9-209">我们将介绍如何解决此问题在即将发布的步骤。</span><span class="sxs-lookup"><span data-stu-id="abba9-209">We'll examine how to remedy this in the upcoming steps.</span></span>

> [!NOTE]
> <span data-ttu-id="abba9-210">除了添加某种形式的可视反馈，已成功插入，我建议您也更新 DetailsView 插入接口，以包括验证。</span><span class="sxs-lookup"><span data-stu-id="abba9-210">In addition to adding some form of visual feedback that the insert has succeeded, I'd encourage you to also update the DetailsView's inserting interface to include validation.</span></span> <span data-ttu-id="abba9-211">目前，没有任何验证。</span><span class="sxs-lookup"><span data-stu-id="abba9-211">Currently, there is no validation.</span></span> <span data-ttu-id="abba9-212">如果用户输入的值无效`UnitPrice`字段，如"过高，"时，系统尝试将该字符串转换成十进制数字，将在回发时引发异常。</span><span class="sxs-lookup"><span data-stu-id="abba9-212">If a user enters an invalid value for the `UnitPrice` field, such as "Too expensive," an exception will be thrown on postback when the system attempts to convert that string into a decimal.</span></span> <span data-ttu-id="abba9-213">有关自定义插入的详细信息的接口，请参阅[*自定义数据修改界面*教程](https://asp.net/learn/data-access/tutorial-20-vb.aspx)从我[使用数据教程系列](../../data-access/index.md).</span><span class="sxs-lookup"><span data-stu-id="abba9-213">For more information on customizing the inserting interface, refer to the [*Customizing the Data Modification Interface* tutorial](https://asp.net/learn/data-access/tutorial-20-vb.aspx) from my [Working with Data tutorial series](../../data-access/index.md).</span></span>

## <a name="step-3-creating-public-properties-and-methods-in-the-master-page"></a><span data-ttu-id="abba9-214">步骤 3：在母版页中创建的公共属性和方法</span><span class="sxs-lookup"><span data-stu-id="abba9-214">Step 3: Creating Public Properties and Methods in the Master Page</span></span>

<span data-ttu-id="abba9-215">步骤 1 中我们添加了一个名为标签 Web 控件`GridMessage`上面在母版页中 GridView。</span><span class="sxs-lookup"><span data-stu-id="abba9-215">In Step 1 we added a Label Web control named `GridMessage` above the GridView in the master page.</span></span> <span data-ttu-id="abba9-216">此标签用于根据需要显示一条消息。</span><span class="sxs-lookup"><span data-stu-id="abba9-216">This Label is intended to optionally display a message.</span></span> <span data-ttu-id="abba9-217">例如，在添加新记录到`Products`表中，我们可能想要显示一条消息："*ProductName*已添加到数据库。"</span><span class="sxs-lookup"><span data-stu-id="abba9-217">For example, after adding a new record to the `Products` table, we might want to show a message that reads: "*ProductName* has been added to the database."</span></span> <span data-ttu-id="abba9-218">而不是硬编码的母版页中的此标签的文本，我们可能想要通过内容页可自定义的消息。</span><span class="sxs-lookup"><span data-stu-id="abba9-218">Rather than hard-code the text for this Label in the master page, we might want the message to be customizable by the content page.</span></span>

<span data-ttu-id="abba9-219">因为它不能直接从内容页访问的母版页中的受保护的成员变量作为实现标签控件。</span><span class="sxs-lookup"><span data-stu-id="abba9-219">Because the Label control is implemented as a protected member variable within the master page it cannot be accessed directly from content pages.</span></span> <span data-ttu-id="abba9-220">我们需要在公开 Web 控件或充当其属性之一可以进行的代理的主页面中创建的公共属性才能使用母版页从内容页 （或，就此而言，母版页中的任何 Web 控件） 中的标签 访问。</span><span class="sxs-lookup"><span data-stu-id="abba9-220">In order to work with the Label within a master page from the content page (or, for that matter, any Web control in the master page) we need to create a public property in the master page that exposes the Web control or serves as a proxy by which one of its properties can be accessed.</span></span> <span data-ttu-id="abba9-221">将以下语法添加到主页面的代码隐藏类公开的标签`Text`属性：</span><span class="sxs-lookup"><span data-stu-id="abba9-221">Add the following syntax to the master page's code-behind class to expose the Label's `Text` property:</span></span>

[!code-vb[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample6.vb)]

<span data-ttu-id="abba9-222">当一条新记录添加到`Products`从内容页表`RecentProducts`母版页中的 GridView 需要重新绑定到其基础数据源。</span><span class="sxs-lookup"><span data-stu-id="abba9-222">When a new record is added to the `Products` table from a content page the `RecentProducts` GridView in the master page needs to rebind to its underlying data source.</span></span> <span data-ttu-id="abba9-223">若要重新绑定的 GridView 调用其`DataBind`方法。</span><span class="sxs-lookup"><span data-stu-id="abba9-223">To rebind the GridView call its `DataBind` method.</span></span> <span data-ttu-id="abba9-224">由于在母版页中的 GridView 不是以编程方式访问内容的页面，我们需要创建一个公共方法，主页面中，调用时，重新绑定到 GridView 数据。</span><span class="sxs-lookup"><span data-stu-id="abba9-224">Because the GridView in the master page is not programmatically accessible to the content pages, we need to create a public method in the master page that, when called, rebinds the data to the GridView.</span></span> <span data-ttu-id="abba9-225">将以下方法添加到主页面的代码隐藏类：</span><span class="sxs-lookup"><span data-stu-id="abba9-225">Add the following method to the master page's code-behind class:</span></span>

[!code-vb[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample7.vb)]

<span data-ttu-id="abba9-226">与`GridMessageText`属性和`RefreshRecentProductsGrid`方法准备就绪后的，任何内容的页面可以以编程方式设置或读取的值`GridMessage`标签的`Text`属性或重新绑定到数据`RecentProducts`GridView。</span><span class="sxs-lookup"><span data-stu-id="abba9-226">With the `GridMessageText` property and `RefreshRecentProductsGrid` method in place, any content page can programmatically set or read the value of the `GridMessage` Label's `Text` property or rebind the data to the `RecentProducts` GridView.</span></span> <span data-ttu-id="abba9-227">步骤 4 探讨如何从内容页访问母版页的公共属性和方法。</span><span class="sxs-lookup"><span data-stu-id="abba9-227">Step 4 examines how to access the master page's public properties and methods from a content page.</span></span>

> [!NOTE]
> <span data-ttu-id="abba9-228">别忘了将母版页的属性和方法作为标记`Public`。</span><span class="sxs-lookup"><span data-stu-id="abba9-228">Don't forget to mark the master page's properties and methods as `Public`.</span></span> <span data-ttu-id="abba9-229">如果您不显式表示这些属性和方法作为`Public`，它们将无法从内容页访问。</span><span class="sxs-lookup"><span data-stu-id="abba9-229">If you do not explicitly denote these properties and methods as `Public`, they will not be accessible from the content page.</span></span>

## <a name="step-4-calling-the-master-pages-public-members-from-a-content-page"></a><span data-ttu-id="abba9-230">步骤 4：从内容页调用母版页的公共成员</span><span class="sxs-lookup"><span data-stu-id="abba9-230">Step 4: Calling the Master Page's Public Members from a Content Page</span></span>

<span data-ttu-id="abba9-231">现在，主页面具有必要的公共属性和方法，我们已准备好调用这些属性和方法从`AddProduct.aspx`内容页。</span><span class="sxs-lookup"><span data-stu-id="abba9-231">Now that the master page has the necessary public properties and methods, we're ready to invoke these properties and methods from the `AddProduct.aspx` content page.</span></span> <span data-ttu-id="abba9-232">具体而言，我们需要设置的母版页`GridMessageText`属性并调用其`RefreshRecentProductsGrid`方法后已添加到数据库的新产品。</span><span class="sxs-lookup"><span data-stu-id="abba9-232">Specifically, we need to set the master page's `GridMessageText` property and call its `RefreshRecentProductsGrid` method after the new product has been added to the database.</span></span> <span data-ttu-id="abba9-233">所有 ASP.NET 数据 Web 控件都触发事件之前和之后完成各种任务，这样可以方便页面开发人员采取某些编程操作之前或之后的任务。</span><span class="sxs-lookup"><span data-stu-id="abba9-233">All the ASP.NET data Web controls fire events immediately before and after completing various tasks, which make it easy for page developers to take some programmatic action either before or after the task.</span></span> <span data-ttu-id="abba9-234">例如，当最终用户单击 DetailsView 的插入按钮，在回发，DetailsView 将引发其`ItemInserting`开始插入工作流之前的事件。</span><span class="sxs-lookup"><span data-stu-id="abba9-234">For example, when the end user clicks the DetailsView's Insert button, on postback the DetailsView raises its `ItemInserting` event before beginning the inserting workflow.</span></span> <span data-ttu-id="abba9-235">然后，它将记录插入到数据库。</span><span class="sxs-lookup"><span data-stu-id="abba9-235">It then inserts the record into the database.</span></span> <span data-ttu-id="abba9-236">接下来，DetailsView 引发其`ItemInserted`事件。</span><span class="sxs-lookup"><span data-stu-id="abba9-236">Following that, the DetailsView raises its `ItemInserted` event.</span></span> <span data-ttu-id="abba9-237">因此，若要添加的新产品后使用母版页，DetailsView 为创建事件处理程序`ItemInserted`事件。</span><span class="sxs-lookup"><span data-stu-id="abba9-237">Therefore, in order to work with the master page after the new product has been added, create an event handler for the DetailsView's `ItemInserted` event.</span></span>

<span data-ttu-id="abba9-238">有两种方法的内容页面以编程方式可通过使用其主页面：</span><span class="sxs-lookup"><span data-stu-id="abba9-238">There are two ways that a content page can programmatically interface with its master page:</span></span>

- <span data-ttu-id="abba9-239">使用`Page.Master`属性，它返回到母版页的松散类型化引用，或</span><span class="sxs-lookup"><span data-stu-id="abba9-239">Using the `Page.Master` property, which returns a loosely-typed reference to the master page, or</span></span>
- <span data-ttu-id="abba9-240">指定通过该页面的母版页类型或文件路径`@MasterType`指令; 这会自动将强类型属性添加到名为页`Master`。</span><span class="sxs-lookup"><span data-stu-id="abba9-240">Specify the page's master page type or file path via a `@MasterType` directive; this automatically adds a strongly-typed property to the page named `Master`.</span></span>

<span data-ttu-id="abba9-241">让我们看一下这两种方法。</span><span class="sxs-lookup"><span data-stu-id="abba9-241">Let's examine both approaches.</span></span>

### <a name="using-the-loosely-typedpagemasterproperty"></a><span data-ttu-id="abba9-242">使用松散类型`Page.Master`属性</span><span class="sxs-lookup"><span data-stu-id="abba9-242">Using the Loosely-Typed`Page.Master`Property</span></span>

<span data-ttu-id="abba9-243">所有 ASP.NET web 页面必须都派生自`Page`类，该类位于`System.Web.UI`命名空间。</span><span class="sxs-lookup"><span data-stu-id="abba9-243">All ASP.NET web pages must derive from the `Page` class, which is located in the `System.Web.UI` namespace.</span></span> <span data-ttu-id="abba9-244">`Page`类包括[`Master`属性](https://msdn.microsoft.com/library/system.web.ui.page.master.aspx)返回到页面的母版页的引用。</span><span class="sxs-lookup"><span data-stu-id="abba9-244">The `Page` class includes a [`Master` property](https://msdn.microsoft.com/library/system.web.ui.page.master.aspx) that returns a reference to the page's master page.</span></span> <span data-ttu-id="abba9-245">如果页面没有母版页`Master`返回`Nothing`。</span><span class="sxs-lookup"><span data-stu-id="abba9-245">If the page does not have a master page `Master` returns `Nothing`.</span></span>

<span data-ttu-id="abba9-246">`Master`属性返回类型的对象[ `MasterPage` ](https://msdn.microsoft.com/library/system.web.ui.masterpage.aspx) (也位于`System.Web.UI`命名空间) 这是所有的主页面中从其派生的基类型。</span><span class="sxs-lookup"><span data-stu-id="abba9-246">The `Master` property returns an object of type [`MasterPage`](https://msdn.microsoft.com/library/system.web.ui.masterpage.aspx) (also located in the `System.Web.UI` namespace) which is the base type from which all master pages derive from.</span></span> <span data-ttu-id="abba9-247">因此，若要使用公共属性或方法定义在我们网站的主页面，我们必须强制转换`MasterPage`返回对象`Master`为适当的类型的属性。</span><span class="sxs-lookup"><span data-stu-id="abba9-247">Therefore, to use public properties or methods defined in our website's master page we must cast the `MasterPage` object returned from the `Master` property to the appropriate type.</span></span> <span data-ttu-id="abba9-248">由于我们命名我们主控页文件，因此`Site.master`，代码隐藏类名为`Site`。</span><span class="sxs-lookup"><span data-stu-id="abba9-248">Because we named our master page file `Site.master`, the code-behind class was named `Site`.</span></span> <span data-ttu-id="abba9-249">因此，下面的代码的强制转换`Page.Master`指向的实例的属性`Site`类。</span><span class="sxs-lookup"><span data-stu-id="abba9-249">Therefore, the following code casts the `Page.Master` property to an instance of the `Site` class.</span></span>

[!code-vb[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample8.vb)]

<span data-ttu-id="abba9-250">现在，我们已强制转换后的松散类型`Page.Master`属性，我们可以为站点类型引用的属性和特定于站点的方法。</span><span class="sxs-lookup"><span data-stu-id="abba9-250">Now that we have casted the loosely-typed `Page.Master` property to the Site type we can reference the properties and methods specific to Site.</span></span> <span data-ttu-id="abba9-251">如图 7 所示，公共属性`GridMessageText`IntelliSense 下拉列表中显示。</span><span class="sxs-lookup"><span data-stu-id="abba9-251">As Figure 7 shows, the public property `GridMessageText` appears in the IntelliSense drop-down.</span></span>

<span data-ttu-id="abba9-252">[![IntelliSense 显示了我们的主页面的公共属性和方法](interacting-with-the-master-page-from-the-content-page-vb/_static/image20.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="abba9-252">[![IntelliSense Shows our Master Page's Public Properties and Methods](interacting-with-the-master-page-from-the-content-page-vb/_static/image20.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image19.png)</span></span>

<span data-ttu-id="abba9-253">**图 07**:IntelliSense 显示了我们的主页面的公共属性和方法 ([单击此项可查看原尺寸图像](interacting-with-the-master-page-from-the-content-page-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="abba9-253">**Figure 07**: IntelliSense Shows our Master Page's Public Properties and Methods ([Click to view full-size image](interacting-with-the-master-page-from-the-content-page-vb/_static/image21.png))</span></span>

> [!NOTE]
> <span data-ttu-id="abba9-254">如果您在主页面文件命名为`MasterPage.master`母版页的代码隐藏类名为`MasterPage`。</span><span class="sxs-lookup"><span data-stu-id="abba9-254">If you named your master page file `MasterPage.master` then the master page's code-behind class name is `MasterPage`.</span></span> <span data-ttu-id="abba9-255">这可能导致不明确的代码时的类型强制转换`System.Web.UI.MasterPage`到你`MasterPage`类。</span><span class="sxs-lookup"><span data-stu-id="abba9-255">This can lead to ambiguous code when casting from the type `System.Web.UI.MasterPage` to your `MasterPage` class.</span></span> <span data-ttu-id="abba9-256">简单地说，您需要完全限定的类型转换为，使用网站项目模型时，可以有点棘手。</span><span class="sxs-lookup"><span data-stu-id="abba9-256">In short, you need to fully qualify the type you are casting to, which can be a little tricky when using the Web Site Project model.</span></span> <span data-ttu-id="abba9-257">我的建议是要确保，创建主页面时将其命名名称不是`MasterPage.master`或甚至更好地创建主页面的强类型引用。</span><span class="sxs-lookup"><span data-stu-id="abba9-257">My suggestion would be to either make sure that when you create your master page you name it something other than `MasterPage.master` or, even better, create a strongly-typed reference to the master page.</span></span>

### <a name="creating-a-strongly-typed-reference-with-themastertypedirective"></a><span data-ttu-id="abba9-258">创建具有强类型化引用`@MasterType`指令</span><span class="sxs-lookup"><span data-stu-id="abba9-258">Creating a Strongly-Typed Reference with the`@MasterType`Directive</span></span>

<span data-ttu-id="abba9-259">如果您仔细查看您所见，ASP.NET 页面的代码隐藏类是分部类 (请注意`Partial`类定义中的关键字)。</span><span class="sxs-lookup"><span data-stu-id="abba9-259">If you look closely you can see that an ASP.NET page's code-behind class is a partial class (note the `Partial` keyword in the class definition).</span></span> <span data-ttu-id="abba9-260">分部类在 C# 和 Visual Basic 使用.net Framework 2.0 中引入，并简单地说，允许跨多个文件中定义的类的成员。</span><span class="sxs-lookup"><span data-stu-id="abba9-260">Partial classes were introduced in C# and Visual Basic with.NET Framework 2.0 and, in a nutshell, allow for a class's members to be defined across multiple files.</span></span> <span data-ttu-id="abba9-261">代码隐藏类文件- `AddProduct.aspx.vb`，例如-包含页面开发人员，我们创建的代码。</span><span class="sxs-lookup"><span data-stu-id="abba9-261">The code-behind class file - `AddProduct.aspx.vb`, for example - contains the code that we, the page developer, create.</span></span> <span data-ttu-id="abba9-262">除了我们代码中，ASP.NET 引擎会自动创建单独的类文件具有属性和事件处理程序中，将声明性标记转换为页的类层次结构。</span><span class="sxs-lookup"><span data-stu-id="abba9-262">In addition to our code, the ASP.NET engine automatically creates a separate class file with properties and event handlers in that translate the declarative markup into the page's class hierarchy.</span></span>

<span data-ttu-id="abba9-263">只要访问 ASP.NET 页面时就会发生的自动代码生成铺平了一些相当有趣且有用的可能性。</span><span class="sxs-lookup"><span data-stu-id="abba9-263">The automatic code generation that occurs whenever an ASP.NET page is visited paves the way for some rather interesting and useful possibilities.</span></span> <span data-ttu-id="abba9-264">对于主页面，如果我们告诉我们内容的页面正在使用哪些母版页的 ASP.NET 引擎就会生成强类型`Master`为我们的属性。</span><span class="sxs-lookup"><span data-stu-id="abba9-264">In the case of master pages, if we tell the ASP.NET engine what master page is being used by our content page it generates a strongly-typed `Master` property for us.</span></span>

<span data-ttu-id="abba9-265">使用[`@MasterType`指令](https://msdn.microsoft.com/library/ms228274.aspx)以通知 ASP.NET 引擎的内容页面的母版页类型。</span><span class="sxs-lookup"><span data-stu-id="abba9-265">Use the [`@MasterType` directive](https://msdn.microsoft.com/library/ms228274.aspx) to inform the ASP.NET engine of the content page's master page type.</span></span> <span data-ttu-id="abba9-266">`@MasterType`指令可以接受的母版页的类型名称或其文件路径。</span><span class="sxs-lookup"><span data-stu-id="abba9-266">The `@MasterType` directive can accept either the type name of the master page or its file path.</span></span> <span data-ttu-id="abba9-267">若要指定的`AddProduct.aspx`页上使用`Site.master`作为其主页面的顶部添加以下指令`AddProduct.aspx`:</span><span class="sxs-lookup"><span data-stu-id="abba9-267">To specify that the `AddProduct.aspx` page uses `Site.master` as its master page, add the following directive to the top of `AddProduct.aspx`:</span></span>

[!code-aspx[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample9.aspx)]

<span data-ttu-id="abba9-268">此指令指示要添加到名为的属性通过母版页的强类型化引用的 ASP.NET 引擎`Master`。</span><span class="sxs-lookup"><span data-stu-id="abba9-268">This directive instructs the ASP.NET engine to add a strongly-typed reference to the master page through a property named `Master`.</span></span> <span data-ttu-id="abba9-269">与`@MasterType`指令中的位置，我们可以调用`Site.master`主页面的公共属性和方法直接通过`Master`而无需任何强制转换的属性。</span><span class="sxs-lookup"><span data-stu-id="abba9-269">With the `@MasterType` directive in place, we can call the `Site.master` master page's public properties and methods directly through the `Master` property without any casts.</span></span>

> [!NOTE]
> <span data-ttu-id="abba9-270">如果省略`@MasterType`指令，语法`Page.Master`和`Master`返回相同的操作： 将松散类型化对象传递给页面的母版页。</span><span class="sxs-lookup"><span data-stu-id="abba9-270">If you omit the `@MasterType` directive, the syntax `Page.Master` and `Master` return the same thing: a loosely-typed object to the page's master page.</span></span> <span data-ttu-id="abba9-271">如果包括`@MasterType`指令然后`Master`返回对指定的母版页的强类型引用。</span><span class="sxs-lookup"><span data-stu-id="abba9-271">If you include the `@MasterType` directive then `Master` returns a strongly-typed reference to the specified master page.</span></span> <span data-ttu-id="abba9-272">`Page.Master`但是，仍然会返回一个松散类型化的引用。</span><span class="sxs-lookup"><span data-stu-id="abba9-272">`Page.Master`, however, still returns a loosely-typed reference.</span></span> <span data-ttu-id="abba9-273">如原因更全面地了解这种情况以及如何`Master`构造属性时`@MasterType`指令是包含，请参阅[K.Scott Allen](http://odetocode.com/blogs/scott/default.aspx)的博客文章[`@MasterType`在 ASP.NET 2.0](http://odetocode.com/Blogs/scott/archive/2005/07/16/1944.aspx).</span><span class="sxs-lookup"><span data-stu-id="abba9-273">For a more thorough look at why this is the case and how the `Master` property is constructed when the `@MasterType` directive is included, see [K. Scott Allen](http://odetocode.com/blogs/scott/default.aspx)'s blog entry [`@MasterType` in ASP.NET 2.0](http://odetocode.com/Blogs/scott/archive/2005/07/16/1944.aspx).</span></span>

### <a name="updating-the-master-page-after-adding-a-new-product"></a><span data-ttu-id="abba9-274">添加一个新的产品后更新母版页</span><span class="sxs-lookup"><span data-stu-id="abba9-274">Updating the Master Page After Adding a New Product</span></span>

<span data-ttu-id="abba9-275">既然我们知道如何调用主页面的公共属性和内容页面中的方法，我们就准备好更新`AddProduct.aspx`页，以便添加一个新的产品后刷新主页面。</span><span class="sxs-lookup"><span data-stu-id="abba9-275">Now that we know how to invoke a master page's public properties and methods from a content page, we're ready to update the `AddProduct.aspx` page so that the master page is refreshed after adding a new product.</span></span> <span data-ttu-id="abba9-276">我们的第 4 步开始处创建 DetailsView 控件的事件处理程序`ItemInserting`事件，新产品添加到数据库后立即执行。</span><span class="sxs-lookup"><span data-stu-id="abba9-276">At the beginning of Step 4 we created an event handler for the DetailsView control's `ItemInserting` event, which executes immediately after the new product has been added to the database.</span></span> <span data-ttu-id="abba9-277">将以下代码添加到该事件处理程序：</span><span class="sxs-lookup"><span data-stu-id="abba9-277">Add the following code to that event handler:</span></span>

[!code-vb[Main](interacting-with-the-master-page-from-the-content-page-vb/samples/sample10.vb)]

<span data-ttu-id="abba9-278">上述代码使用这两种松散类型化`Page.Master`属性的和强类型`Master`属性。</span><span class="sxs-lookup"><span data-stu-id="abba9-278">The above code uses both the loosely-typed `Page.Master` property and the strongly-typed `Master` property.</span></span> <span data-ttu-id="abba9-279">请注意，`GridMessageText`属性设置为"*ProductName*添加到网格..."刚添加产品的值是可通过访问`e.Values`集合; 正如您所看到的刚添加`ProductName`通过访问值`e.Values("ProductName")`。</span><span class="sxs-lookup"><span data-stu-id="abba9-279">Note that the `GridMessageText` property is set to "*ProductName* added to grid..." The just-added product's values are accessible through the `e.Values` collection; as you can see, the just-added `ProductName` value is accessed via `e.Values("ProductName")`.</span></span>

<span data-ttu-id="abba9-280">图 8 显示了`AddProduct.aspx`立即后一种新产品-Scott 的 Soda 的页已添加到数据库。</span><span class="sxs-lookup"><span data-stu-id="abba9-280">Figure 8 shows the `AddProduct.aspx` page immediately after a new product - Scott's Soda - has been added to the database.</span></span> <span data-ttu-id="abba9-281">请注意，刚添加的产品名称将其记录在母版页的标签和 GridView 刷新以包括产品和它的价格。</span><span class="sxs-lookup"><span data-stu-id="abba9-281">Note that the just-added product name is noted in the master page's Label and that the GridView has been refreshed to include the product and its price.</span></span>

<span data-ttu-id="abba9-282">[![母版页的标签和 GridView 显示刚添加产品](interacting-with-the-master-page-from-the-content-page-vb/_static/image23.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="abba9-282">[![The Master Page's Label and GridView Show the Just-Added Product](interacting-with-the-master-page-from-the-content-page-vb/_static/image23.png)](interacting-with-the-master-page-from-the-content-page-vb/_static/image22.png)</span></span>

<span data-ttu-id="abba9-283">**图 08**:母版页的标签和 GridView 显示 Just-Added 产品 ([单击此项可查看原尺寸图像](interacting-with-the-master-page-from-the-content-page-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="abba9-283">**Figure 08**: The Master Page's Label and GridView Show the Just-Added Product ([Click to view full-size image](interacting-with-the-master-page-from-the-content-page-vb/_static/image24.png))</span></span>

## <a name="summary"></a><span data-ttu-id="abba9-284">总结</span><span class="sxs-lookup"><span data-stu-id="abba9-284">Summary</span></span>

<span data-ttu-id="abba9-285">理想情况下，主页面和其内容的页面是从另一个完全独立，不需要交互的任何级别。</span><span class="sxs-lookup"><span data-stu-id="abba9-285">Ideally, a master page and its content pages are completely separate from one another and require no level of interaction.</span></span> <span data-ttu-id="abba9-286">母版页和内容页面应设计为具有该目标，虽然有多种常见方案中的内容页必须与其主页面。</span><span class="sxs-lookup"><span data-stu-id="abba9-286">While master pages and content pages should be designed with that goal in mind, there are a number of common scenarios in which a content page must interface with its master page.</span></span> <span data-ttu-id="abba9-287">最常见原因之一是围绕更新母版页显示根据在内容页中发生某些操作的特定部分。</span><span class="sxs-lookup"><span data-stu-id="abba9-287">One of the most common reasons centers around updating a particular portion of the master page display based on some action that transpired in the content page.</span></span>

<span data-ttu-id="abba9-288">好消息是，它是相对比较简单，在内容页面中以编程方式与其主页面进行交互。</span><span class="sxs-lookup"><span data-stu-id="abba9-288">The good news is that it's relatively straightforward to have a content page programmatically interact with its master page.</span></span> <span data-ttu-id="abba9-289">首先在封装的功能，需要调用的内容页面的母版页中创建公共属性或方法。</span><span class="sxs-lookup"><span data-stu-id="abba9-289">Start by creating public properties or methods in the master page that encapsulate the functionality that needs to be invoked by a content page.</span></span> <span data-ttu-id="abba9-290">然后，在内容页访问母版页的属性和方法通过松散类型化`Page.Master`属性或使用`@MasterType`指令来创建到母版页的强类型引用。</span><span class="sxs-lookup"><span data-stu-id="abba9-290">Then, in the content page, access the master page's properties and methods through the loosely-typed `Page.Master` property or use the `@MasterType` directive to create a strongly-typed reference to the master page.</span></span>

<span data-ttu-id="abba9-291">在下一步的教程中，我们将说明如何有母版页与内容页面之一以编程方式进行交互。</span><span class="sxs-lookup"><span data-stu-id="abba9-291">In the next tutorial we examine how to have the master page programmatically interact with one of its content pages.</span></span>

<span data-ttu-id="abba9-292">快乐编程 ！</span><span class="sxs-lookup"><span data-stu-id="abba9-292">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="abba9-293">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="abba9-293">Further Reading</span></span>

<span data-ttu-id="abba9-294">在本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="abba9-294">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="abba9-295">访问和更新在 ASP.NET 中的数据</span><span class="sxs-lookup"><span data-stu-id="abba9-295">Accessing and Updating Data in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/011106-1.aspx)
- [<span data-ttu-id="abba9-296">ASP.NET 母版页：提示、 技巧和陷阱</span><span class="sxs-lookup"><span data-stu-id="abba9-296">ASP.NET Master Pages: Tips, Tricks, and Traps</span></span>](http://www.odetocode.com/articles/450.aspx)
- [<span data-ttu-id="abba9-297">`@MasterType` 在 ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="abba9-297">`@MasterType` in ASP.NET 2.0</span></span>](http://odetocode.com/Blogs/scott/archive/2005/07/16/1944.aspx)
- [<span data-ttu-id="abba9-298">内容和母版页之间传递信息</span><span class="sxs-lookup"><span data-stu-id="abba9-298">Passing Information Between Content and Master Pages</span></span>](http://aspnet.4guysfromrolla.com/articles/013107-1.aspx)
- [<span data-ttu-id="abba9-299">在 ASP.NET 教程中使用的数据</span><span class="sxs-lookup"><span data-stu-id="abba9-299">Working with Data in ASP.NET Tutorials</span></span>](../../data-access/index.md)

### <a name="about-the-author"></a><span data-ttu-id="abba9-300">关于作者</span><span class="sxs-lookup"><span data-stu-id="abba9-300">About the Author</span></span>

<span data-ttu-id="abba9-301">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的多个部 asp/ASP.NET 书籍并创办了 4GuysFromRolla.com，一直从事 Microsoft Web 技术自 1998 年起。</span><span class="sxs-lookup"><span data-stu-id="abba9-301">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="abba9-302">Scott 是独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="abba9-302">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="abba9-303">他最新著作是[ *Sams Teach 自己 ASP.NET 3.5 24 小时内*](https://www.amazon.com/exec/obidos/ASIN/0672329972/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="abba9-303">His latest book is [*Sams Teach Yourself ASP.NET 3.5 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672329972/4guysfromrollaco).</span></span> <span data-ttu-id="abba9-304">可以在达到 Scott [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com)或通过他的博客[ http://ScottOnWriting.NET ](http://scottonwriting.net/)。</span><span class="sxs-lookup"><span data-stu-id="abba9-304">Scott can be reached at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="abba9-305">特别感谢</span><span class="sxs-lookup"><span data-stu-id="abba9-305">Special Thanks To</span></span>

<span data-ttu-id="abba9-306">很多有用的审阅者已评审本系列教程。</span><span class="sxs-lookup"><span data-stu-id="abba9-306">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="abba9-307">本教程中的潜在顾客审阅者已 Zack Jones。</span><span class="sxs-lookup"><span data-stu-id="abba9-307">Lead reviewer for this tutorial was Zack Jones.</span></span> <span data-ttu-id="abba9-308">是否有兴趣查看我即将推出的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="abba9-308">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="abba9-309">如果是这样，给我在行 [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="abba9-309">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="abba9-310">[上一页](control-id-naming-in-content-pages-vb.md)
> [下一页](interacting-with-the-content-page-from-the-master-page-vb.md)</span><span class="sxs-lookup"><span data-stu-id="abba9-310">[Previous](control-id-naming-in-content-pages-vb.md)
[Next](interacting-with-the-content-page-from-the-master-page-vb.md)</span></span>
