---
uid: web-forms/overview/older-versions-getting-started/master-pages/master-pages-and-asp-net-ajax-vb
title: 母版页和 ASP.NET AJAX （VB） |Microsoft Docs
author: rick-anderson
description: 讨论使用 ASP.NET AJAX 和母版页的选项。 查看使用 ScriptManagerProxy 类;讨论如何加载各种 JS 文件 dependi
ms.author: riande
ms.date: 07/11/2008
ms.assetid: 0ee9318c-29bb-4d58-b1dc-94e575b8ae10
msc.legacyurl: /web-forms/overview/older-versions-getting-started/master-pages/master-pages-and-asp-net-ajax-vb
msc.type: authoredcontent
ms.openlocfilehash: 7be4ff422b91321ff83ed1f1c731c9a0bfe768f1
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/06/2020
ms.locfileid: "78421814"
---
# <a name="master-pages-and-aspnet-ajax-vb"></a><span data-ttu-id="7bac4-104">母版页和 ASP.NET AJAX (VB)</span><span class="sxs-lookup"><span data-stu-id="7bac4-104">Master Pages and ASP.NET AJAX (VB)</span></span>

<span data-ttu-id="7bac4-105">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="7bac4-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="7bac4-106">[下载代码](https://download.microsoft.com/download/1/8/4/184e24fa-fcc8-47fa-ac99-4b6a52d41e97/ASPNET_MasterPages_Tutorial_08_VB.zip)或[下载 PDF](https://download.microsoft.com/download/e/b/4/eb4abb10-c416-4ba4-9899-32577715b1bd/ASPNET_MasterPages_Tutorial_08_VB.pdf)</span><span class="sxs-lookup"><span data-stu-id="7bac4-106">[Download Code](https://download.microsoft.com/download/1/8/4/184e24fa-fcc8-47fa-ac99-4b6a52d41e97/ASPNET_MasterPages_Tutorial_08_VB.zip) or [Download PDF](https://download.microsoft.com/download/e/b/4/eb4abb10-c416-4ba4-9899-32577715b1bd/ASPNET_MasterPages_Tutorial_08_VB.pdf)</span></span>

> <span data-ttu-id="7bac4-107">讨论使用 ASP.NET AJAX 和母版页的选项。</span><span class="sxs-lookup"><span data-stu-id="7bac4-107">Discusses options for using ASP.NET AJAX and master pages.</span></span> <span data-ttu-id="7bac4-108">查看使用 ScriptManagerProxy 类;讨论如何加载各种 JS 文件，具体取决于是否在母版页或内容页中使用了 ScriptManager。</span><span class="sxs-lookup"><span data-stu-id="7bac4-108">Looks at using the ScriptManagerProxy class; discusses how the various JS files are loaded depending on whether the ScriptManager is used in the Master page or Content page.</span></span>

## <a name="introduction"></a><span data-ttu-id="7bac4-109">简介</span><span class="sxs-lookup"><span data-stu-id="7bac4-109">Introduction</span></span>

<span data-ttu-id="7bac4-110">过去几年来，越来越多的开发人员构建了支持 AJAX 的 web 应用程序。</span><span class="sxs-lookup"><span data-stu-id="7bac4-110">Over the past several years, more and more developers have been building AJAX-enabled web applications.</span></span> <span data-ttu-id="7bac4-111">启用了 AJAX 的网站使用多种相关的 web 技术来提供更具响应能力的用户体验。</span><span class="sxs-lookup"><span data-stu-id="7bac4-111">An AJAX-enabled website uses a number of related web technologies to offer a more responsive user experience.</span></span> <span data-ttu-id="7bac4-112">由于 Microsoft 的 ASP.NET AJAX framework，创建启用 AJAX 的 ASP.NET 应用程序非常容易极为。</span><span class="sxs-lookup"><span data-stu-id="7bac4-112">Creating AJAX-enabled ASP.NET applications is amazingly easy thanks to Microsoft's ASP.NET AJAX framework.</span></span> <span data-ttu-id="7bac4-113">ASP.NET AJAX 内置于 ASP.NET 3.5 和 Visual Studio 2008;它还可作为 ASP.NET 2.0 应用程序的单独下载提供。</span><span class="sxs-lookup"><span data-stu-id="7bac4-113">ASP.NET AJAX is built into ASP.NET 3.5 and Visual Studio 2008; it is also available as a separate download for ASP.NET 2.0 applications.</span></span>

<span data-ttu-id="7bac4-114">使用 ASP.NET AJAX framework 生成启用了 AJAX 的网页时，必须将一个 ScriptManager 控件精确添加到使用该框架的每个页面。</span><span class="sxs-lookup"><span data-stu-id="7bac4-114">When building AJAX-enabled web pages with the ASP.NET AJAX framework, you must add precisely one ScriptManager control to each and every page that uses the framework.</span></span> <span data-ttu-id="7bac4-115">顾名思义，ScriptManager 管理启用了 AJAX 的网页中使用的客户端脚本。</span><span class="sxs-lookup"><span data-stu-id="7bac4-115">As its name implies, the ScriptManager manages the client-side script used in AJAX-enabled web pages.</span></span> <span data-ttu-id="7bac4-116">ScriptManager 至少会发出 HTML，指示浏览器下载构成 ASP.NET AJAX 客户端库的 JavaScript 文件。</span><span class="sxs-lookup"><span data-stu-id="7bac4-116">At a minimum, the ScriptManager emits HTML that instructs the browser to download the JavaScript files that makeup the ASP.NET AJAX Client Library.</span></span> <span data-ttu-id="7bac4-117">它还可用于注册自定义 JavaScript 文件、启用脚本的 web 服务以及自定义应用程序服务功能。</span><span class="sxs-lookup"><span data-stu-id="7bac4-117">It can also be used to register custom JavaScript files, script-enabled web services, and custom application service functionality.</span></span>

<span data-ttu-id="7bac4-118">如果你的网站使用的是母版页（如应有），则不一定需要将 ScriptManager 控件添加到每个单个内容页;相反，可以向母版页添加 ScriptManager 控件。</span><span class="sxs-lookup"><span data-stu-id="7bac4-118">If your site uses master pages (as it should), you do not necessarily need to add a ScriptManager control to every single content page; rather, you can add a ScriptManager control to the master page.</span></span> <span data-ttu-id="7bac4-119">本教程演示如何将 ScriptManager 控件添加到母版页。</span><span class="sxs-lookup"><span data-stu-id="7bac4-119">This tutorial shows how to add the ScriptManager control to the master page.</span></span> <span data-ttu-id="7bac4-120">还介绍了如何使用 ScriptManagerProxy 控件在特定内容页中注册自定义脚本和脚本服务。</span><span class="sxs-lookup"><span data-stu-id="7bac4-120">It also looks at how to use the ScriptManagerProxy control to register custom scripts and script services in a specific content page.</span></span>

> [!NOTE]
> <span data-ttu-id="7bac4-121">本教程不会探讨如何通过 ASP.NET AJAX framework 设计或构建支持 AJAX 的 web 应用程序。</span><span class="sxs-lookup"><span data-stu-id="7bac4-121">This tutorial does not explore designing or building AJAX-enabled web applications with the ASP.NET AJAX framework.</span></span> <span data-ttu-id="7bac4-122">有关使用 AJAX 的详细信息，请参阅 ASP.NET AJAX 视频和教程，以及本教程末尾的其他阅读部分中列出的那些资源。</span><span class="sxs-lookup"><span data-stu-id="7bac4-122">For more information on using AJAX consult the ASP.NET AJAX videos and tutorials, as well as those resources listed in the Further Reading section at the end of this tutorial.</span></span>

## <a name="examining-the-markup-emitted-by-the-scriptmanager-control"></a><span data-ttu-id="7bac4-123">检查 ScriptManager 控件发出的标记</span><span class="sxs-lookup"><span data-stu-id="7bac4-123">Examining the Markup Emitted by the ScriptManager Control</span></span>

<span data-ttu-id="7bac4-124">ScriptManager 控件发出标记，指示浏览器下载构成 ASP.NET AJAX 客户端库的 JavaScript 文件。</span><span class="sxs-lookup"><span data-stu-id="7bac4-124">The ScriptManager control emits markup that instructs the browser to download the JavaScript files that makeup the ASP.NET AJAX Client Library.</span></span> <span data-ttu-id="7bac4-125">它还会将一些内联 JavaScript 添加到初始化此库的页面。</span><span class="sxs-lookup"><span data-stu-id="7bac4-125">It also adds a bit of inline JavaScript to the page that initializes this library.</span></span> <span data-ttu-id="7bac4-126">以下标记显示了添加到包含 ScriptManager 控件的页面的呈现输出的内容：</span><span class="sxs-lookup"><span data-stu-id="7bac4-126">The following markup shows the content that is added to the rendered output of a page that includes a ScriptManager control:</span></span>

[!code-html[Main](master-pages-and-asp-net-ajax-vb/samples/sample1.html)]

<span data-ttu-id="7bac4-127">`<script src="url"></script>` 标记指示浏览器下载并执行*url*处的 JavaScript 文件。</span><span class="sxs-lookup"><span data-stu-id="7bac4-127">The `<script src="url"></script>` tags instruct the browser to download and execute the JavaScript file at *url*.</span></span> <span data-ttu-id="7bac4-128">ScriptManager 发出三个此类标记;一个引用 `WebResource.axd`文件，另一个引用文件 `ScriptResource.axd`。</span><span class="sxs-lookup"><span data-stu-id="7bac4-128">The ScriptManager emits three such tags; one references the file `WebResource.axd`, while the other two reference the file `ScriptResource.axd`.</span></span> <span data-ttu-id="7bac4-129">这些文件实际上并不作为文件存在于你的网站中。</span><span class="sxs-lookup"><span data-stu-id="7bac4-129">These files do not actually exist as files in your website.</span></span> <span data-ttu-id="7bac4-130">相反，当对其中任一文件的请求到达 web 服务器时，ASP.NET 引擎会检查 querystring 并返回相应的 JavaScript 内容。</span><span class="sxs-lookup"><span data-stu-id="7bac4-130">Instead, when a request for either one of these files arrives at the web server, the ASP.NET engine examines the querystring and returns the appropriate JavaScript content.</span></span> <span data-ttu-id="7bac4-131">这三个外部 JavaScript 文件提供的脚本构成了 ASP.NET AJAX framework 的客户端库。</span><span class="sxs-lookup"><span data-stu-id="7bac4-131">The script provided by these three external JavaScript files constitute the ASP.NET AJAX framework's Client Library.</span></span> <span data-ttu-id="7bac4-132">ScriptManager 发出的其他 `<script>` 标记包含用于初始化此库的内联脚本。</span><span class="sxs-lookup"><span data-stu-id="7bac4-132">The other `<script>` tags emitted by the ScriptManager include inline script that initializes this library.</span></span>

<span data-ttu-id="7bac4-133">ScriptManager 发出的外部脚本引用和内联脚本对于使用 ASP.NET AJAX framework 的页面是必不可少的，但对于不使用框架的页面不是必需的。</span><span class="sxs-lookup"><span data-stu-id="7bac4-133">The external script references and inline script emitted by the ScriptManager are essential for a page that uses the ASP.NET AJAX framework, but is not needed for pages that do not use the framework.</span></span> <span data-ttu-id="7bac4-134">因此，您可能会因为仅将 ScriptManager 添加到使用 ASP.NET AJAX framework 的页面。</span><span class="sxs-lookup"><span data-stu-id="7bac4-134">Therefore, you might reason that it is ideal to only add a ScriptManager to those pages that use the ASP.NET AJAX framework.</span></span> <span data-ttu-id="7bac4-135">这就足够了，但如果您有许多使用该框架的页面，最终会将 ScriptManager 控件添加到所有页面中，这是一个重复的任务。</span><span class="sxs-lookup"><span data-stu-id="7bac4-135">And this is sufficient, but if you have many pages that use the framework you'll end up adding the ScriptManager control to all pages - a repetitive task, to say the least.</span></span> <span data-ttu-id="7bac4-136">或者，你可以将 ScriptManager 添加到母版页，然后将此必要的脚本注入到所有内容页。</span><span class="sxs-lookup"><span data-stu-id="7bac4-136">Alternatively, you can add a ScriptManager to the master page, which then injects this necessary script into all content pages.</span></span> <span data-ttu-id="7bac4-137">使用此方法时，无需记得将 ScriptManager 添加到使用 ASP.NET AJAX framework 的新页面，因为该页面已经包含在母版页中。</span><span class="sxs-lookup"><span data-stu-id="7bac4-137">With this approach, you do not need to remember to add a ScriptManager to a new page that uses the ASP.NET AJAX framework because it is already included by the master page.</span></span> <span data-ttu-id="7bac4-138">步骤1演练如何向母版页添加 ScriptManager。</span><span class="sxs-lookup"><span data-stu-id="7bac4-138">Step 1 walks through adding a ScriptManager to the master page.</span></span>

> [!NOTE]
> <span data-ttu-id="7bac4-139">如果你计划在母版页的用户界面中包含 AJAX 功能，则不会有任何选择，因为你必须在母版页中包含 ScriptManager。</span><span class="sxs-lookup"><span data-stu-id="7bac4-139">If you plan on including AJAX functionality within the user interface of your master page, then you have no choice in the matter - you must include the ScriptManager in the master page.</span></span>

<span data-ttu-id="7bac4-140">将 ScriptManager 添加到母版页的一个缺点是，上面的脚本将在*每个*页面中发出，无论其是否需要。</span><span class="sxs-lookup"><span data-stu-id="7bac4-140">One downside of adding the ScriptManager to the master page is that the above script is emitted in *every* page, regardless of whether its needed.</span></span> <span data-ttu-id="7bac4-141">这显然会导致这些页面的带宽浪费在包含 ScriptManager （通过母版页）的页面上，但不会使用 ASP.NET AJAX framework 的任何功能。</span><span class="sxs-lookup"><span data-stu-id="7bac4-141">This clearly leads to wasted bandwidth for those pages that have the ScriptManager included (via the master page) yet don't use any features of the ASP.NET AJAX framework.</span></span> <span data-ttu-id="7bac4-142">但只是浪费了多少带宽呢？</span><span class="sxs-lookup"><span data-stu-id="7bac4-142">But just how much bandwidth is wasted?</span></span>

- <span data-ttu-id="7bac4-143">ScriptManager 所发出的实际内容（如上所示）的总计超过1KB。</span><span class="sxs-lookup"><span data-stu-id="7bac4-143">The actual content emitted by the ScriptManager (shown above) totals a little over 1KB.</span></span>
- <span data-ttu-id="7bac4-144">但 `<script>` 元素所引用的三个外部脚本文件，只包含未压缩的数据的 450KB;在使用 gzip 压缩的网站中，可以降低100KB 的总带宽。</span><span class="sxs-lookup"><span data-stu-id="7bac4-144">The three external script files referenced by the `<script>` element, however, comprise roughly 450KB of data uncompressed; in a website that uses gzip compression, this total bandwidth can be reduced near 100KB.</span></span> <span data-ttu-id="7bac4-145">但是，浏览器会缓存这些脚本文件一年，这意味着它们只需下载一次，然后在站点的其他页面上重复使用。</span><span class="sxs-lookup"><span data-stu-id="7bac4-145">However, these script files are cached by the browser for one year, meaning that they only need to be downloaded once and then can be reused in other pages on the site.</span></span>

<span data-ttu-id="7bac4-146">在最佳情况下，当缓存脚本文件时，总开销为1KB，这是可忽略的。</span><span class="sxs-lookup"><span data-stu-id="7bac4-146">In the best case, then, when the script files are cached, the total cost is 1KB, which is negligible.</span></span> <span data-ttu-id="7bac4-147">然而，在最坏的情况下，这种情况下，这种情况下，如果脚本文件尚未下载并且 web 服务器不使用任何形式的压缩，则带宽命中率为450KB，它可以将宽带连接上的一个或两个位置添加到长达一分钟的 通过拨号调制解调器的用户。</span><span class="sxs-lookup"><span data-stu-id="7bac4-147">In the worst case, however - which is when the script files have not yet been downloaded and the web server is not using any form of compression - the bandwidth hit is around 450KB, which can add anywhere from a second or two over a broadband connection to up to a minute for users over dial-up modems.</span></span> <span data-ttu-id="7bac4-148">好消息是因为外部脚本文件由浏览器进行缓存，所以这种最坏的情况很少出现。</span><span class="sxs-lookup"><span data-stu-id="7bac4-148">The good news is that because the external script files are cached by the browser, this worst case scenario occurs infrequently.</span></span>

> [!NOTE]
> <span data-ttu-id="7bac4-149">如果您仍不舒服将 ScriptManager 控件置于母版页中，请考虑 Web 窗体（母版页中 `<form runat="server">` 标记）。</span><span class="sxs-lookup"><span data-stu-id="7bac4-149">If you still feel uncomfortable placing the ScriptManager control in the master page, consider the Web Form (the `<form runat="server">` markup in the master page).</span></span> <span data-ttu-id="7bac4-150">使用回发模型的每个 ASP.NET 页必须精确包含一个 Web 窗体。</span><span class="sxs-lookup"><span data-stu-id="7bac4-150">Every ASP.NET page that uses the postback model must include precisely one Web Form.</span></span> <span data-ttu-id="7bac4-151">添加 Web 窗体后，会添加其他内容：多个隐藏的窗体字段、`<form>` 标记本身，以及用于从脚本启动回发的 JavaScript 函数（如有必要）。</span><span class="sxs-lookup"><span data-stu-id="7bac4-151">Adding a Web Form adds additional content: a number of hidden form fields, the `<form>` tag itself, and, if necessary, a JavaScript function for initiating a postback from script.</span></span> <span data-ttu-id="7bac4-152">不回发的页面不需要此标记。</span><span class="sxs-lookup"><span data-stu-id="7bac4-152">This markup is unnecessary for pages that don't postback.</span></span> <span data-ttu-id="7bac4-153">通过从母版页中删除 Web 窗体，然后将其手动添加到每个需要的内容页，可以消除此无关标记。</span><span class="sxs-lookup"><span data-stu-id="7bac4-153">This extraneous markup could be eliminated by removing the Web Form from the master page and manually adding it to each content page that needs one.</span></span> <span data-ttu-id="7bac4-154">不过，使 Web 窗体在母版页中的好处比不必要地将其添加到某些内容页中的缺点要大一些。</span><span class="sxs-lookup"><span data-stu-id="7bac4-154">However, the benefits of having the Web Form in the master page outweigh the disadvantages from having it added unnecessarily to certain content pages.</span></span>

## <a name="step-1-adding-a-scriptmanager-control-to-the-master-page"></a><span data-ttu-id="7bac4-155">步骤1：向母版页添加 ScriptManager 控件</span><span class="sxs-lookup"><span data-stu-id="7bac4-155">Step 1: Adding a ScriptManager Control to the Master Page</span></span>

<span data-ttu-id="7bac4-156">使用 ASP.NET AJAX framework 的每个网页必须精确包含一个 ScriptManager 控件。</span><span class="sxs-lookup"><span data-stu-id="7bac4-156">Every web page that uses the ASP.NET AJAX framework must contain precisely one ScriptManager control.</span></span> <span data-ttu-id="7bac4-157">由于这一要求，通常可以将单个 ScriptManager 控件置于母版页上，以便所有内容页都自动包含 ScriptManager 控件。</span><span class="sxs-lookup"><span data-stu-id="7bac4-157">Because of this requirement, it usually makes sense to place a single ScriptManager control on the master page so that all content pages have the ScriptManager control automatically included.</span></span> <span data-ttu-id="7bac4-158">此外，ScriptManager 必须位于 ASP.NET AJAX 服务器控件之前，如 UpdatePanel 和 UpdateProgress 控件。</span><span class="sxs-lookup"><span data-stu-id="7bac4-158">Furthermore, the ScriptManager must come before any of the ASP.NET AJAX server controls, such as the UpdatePanel and UpdateProgress controls.</span></span> <span data-ttu-id="7bac4-159">因此，最好将 ScriptManager 置于 Web 窗体中的任何 ContentPlaceHolder 控件之前。</span><span class="sxs-lookup"><span data-stu-id="7bac4-159">Therefore, it's best to put the ScriptManager before any ContentPlaceHolder controls within the Web Form.</span></span>

<span data-ttu-id="7bac4-160">打开 `Site.master` 母版页，并将 ScriptManager 控件添加到 Web 窗体中的页面，而不是添加到 `<div id="topContent">` 元素之前（参见图1）。</span><span class="sxs-lookup"><span data-stu-id="7bac4-160">Open the `Site.master` master page and add a ScriptManager control to the page within the Web Form, but before the `<div id="topContent">` element (see Figure 1).</span></span> <span data-ttu-id="7bac4-161">如果使用 Visual Web Developer 2008 或 Visual Studio 2008，则 ScriptManager 控件位于 "AJAX 扩展" 选项卡的 "工具箱" 中。如果使用的是 Visual Studio 2005，则需要首先安装 ASP.NET AJAX framework 并将控件添加到 "工具箱"。</span><span class="sxs-lookup"><span data-stu-id="7bac4-161">If you are using Visual Web Developer 2008 or Visual Studio 2008, the ScriptManager control is located in the Toolbox in the AJAX Extensions tab. If you are using Visual Studio 2005, you will need to first install the ASP.NET AJAX framework and add the controls to the Toolbox.</span></span> <span data-ttu-id="7bac4-162">请访问 ASP.NET AJAX 下载页，获取 ASP.NET 2.0 的框架。</span><span class="sxs-lookup"><span data-stu-id="7bac4-162">Visit the ASP.NET AJAX download page to get the framework for ASP.NET 2.0.</span></span>

<span data-ttu-id="7bac4-163">将 ScriptManager 添加到页面后，将其 `ID` 从 "`ScriptManager1`" 更改为 "`MyManager`"。</span><span class="sxs-lookup"><span data-stu-id="7bac4-163">After adding the ScriptManager to the page, change its `ID` from `ScriptManager1` to `MyManager`.</span></span>

<span data-ttu-id="7bac4-164">[![将 ScriptManager 添加到母版页](master-pages-and-asp-net-ajax-vb/_static/image2.png)](master-pages-and-asp-net-ajax-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="7bac4-164">[![Add the ScriptManager to the Master Page](master-pages-and-asp-net-ajax-vb/_static/image2.png)](master-pages-and-asp-net-ajax-vb/_static/image1.png)</span></span>

<span data-ttu-id="7bac4-165">**图 01**：向母版页添加 ScriptManager （[单击以查看完全大小的图像](master-pages-and-asp-net-ajax-vb/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="7bac4-165">**Figure 01**: Add the ScriptManager to the Master Page  ([Click to view full-size image](master-pages-and-asp-net-ajax-vb/_static/image3.png))</span></span>

## <a name="step-2-using-the-aspnet-ajax-framework-from-a-content-page"></a><span data-ttu-id="7bac4-166">步骤2：使用内容页中的 ASP.NET AJAX Framework</span><span class="sxs-lookup"><span data-stu-id="7bac4-166">Step 2: Using the ASP.NET AJAX Framework from a Content Page</span></span>

<span data-ttu-id="7bac4-167">将 ScriptManager 控件添加到母版页后，现在可以在任何内容页中添加 ASP.NET AJAX framework 功能。</span><span class="sxs-lookup"><span data-stu-id="7bac4-167">With the ScriptManager control added to the master page we can now add ASP.NET AJAX framework functionality to any content page.</span></span> <span data-ttu-id="7bac4-168">让我们创建一个新的 ASP.NET 页面，用于显示 Northwind 数据库中随机选择的产品。</span><span class="sxs-lookup"><span data-stu-id="7bac4-168">Let's create a new ASP.NET page that displays a randomly selected product from the Northwind database.</span></span> <span data-ttu-id="7bac4-169">我们将使用 ASP.NET AJAX framework 的计时器控件每15秒更新一次显示，并显示新产品。</span><span class="sxs-lookup"><span data-stu-id="7bac4-169">We'll use the ASP.NET AJAX framework's Timer control to update this display every 15 seconds, showing a new product.</span></span>

<span data-ttu-id="7bac4-170">首先在名为 `ShowRandomProduct.aspx`的根目录中创建一个新页面。</span><span class="sxs-lookup"><span data-stu-id="7bac4-170">Start by creating a new page in the root directory named `ShowRandomProduct.aspx`.</span></span> <span data-ttu-id="7bac4-171">别忘了将此新页绑定到 `Site.master` 母版页。</span><span class="sxs-lookup"><span data-stu-id="7bac4-171">Don't forget to bind this new page to the `Site.master` master page.</span></span>

<span data-ttu-id="7bac4-172">[![将新的 ASP.NET 页面添加到网站](master-pages-and-asp-net-ajax-vb/_static/image5.png)](master-pages-and-asp-net-ajax-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="7bac4-172">[![Add a New ASP.NET Page to the Website](master-pages-and-asp-net-ajax-vb/_static/image5.png)](master-pages-and-asp-net-ajax-vb/_static/image4.png)</span></span>

<span data-ttu-id="7bac4-173">**图 02**：向网站添加新的 "ASP.NET" 页（[单击以查看完全大小的图像](master-pages-and-asp-net-ajax-vb/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="7bac4-173">**Figure 02**: Add a New ASP.NET Page to the Website ([Click to view full-size image](master-pages-and-asp-net-ajax-vb/_static/image6.png))</span></span>

<span data-ttu-id="7bac4-174">请注意，在母版页中指定标题、Meta 标记和其他 HTML 标头 [SKM1] 教程中，我们创建了一个名为 `BasePage` 的自定义基类类，如果未显式设置该页面的标题，则生成该页面的标题。</span><span class="sxs-lookup"><span data-stu-id="7bac4-174">Recall that in the Specifying the Title, Meta Tags, and Other HTML Headers in the Master Page[SKM1] tutorial we created a custom base page class named `BasePage` that generated the page's title if it was not explicitly set.</span></span> <span data-ttu-id="7bac4-175">转到 "`ShowRandomProduct.aspx`" 页的代码隐藏类，并使其从 `BasePage` （而不是从 `System.Web.UI.Page`）派生。</span><span class="sxs-lookup"><span data-stu-id="7bac4-175">Go to the `ShowRandomProduct.aspx` page's code-behind class and have it derive from `BasePage` (instead of from `System.Web.UI.Page`).</span></span>

<span data-ttu-id="7bac4-176">最后，更新 `Web.sitemap` 文件以包含本课中的条目。</span><span class="sxs-lookup"><span data-stu-id="7bac4-176">Finally, update the `Web.sitemap` file to include an entry for this lesson.</span></span> <span data-ttu-id="7bac4-177">将以下标记添加到 "母版页到内容" 页面交互课程的 `<siteMapNode>` 下面：</span><span class="sxs-lookup"><span data-stu-id="7bac4-177">Add the following markup beneath the `<siteMapNode>` for the Master to Content Page Interaction lesson:</span></span>

[!code-xml[Main](master-pages-and-asp-net-ajax-vb/samples/sample2.xml)]

<span data-ttu-id="7bac4-178">此 `<siteMapNode>` 元素的添加将反映在课程列表中（见图5）。</span><span class="sxs-lookup"><span data-stu-id="7bac4-178">The addition of this `<siteMapNode>` element is reflected in the Lessons list (see Figure 5).</span></span>

### <a name="displaying-a-randomly-selected-product"></a><span data-ttu-id="7bac4-179">显示随机选择的产品</span><span class="sxs-lookup"><span data-stu-id="7bac4-179">Displaying a Randomly Selected Product</span></span>

<span data-ttu-id="7bac4-180">返回 `ShowRandomProduct.aspx`。</span><span class="sxs-lookup"><span data-stu-id="7bac4-180">Return to `ShowRandomProduct.aspx`.</span></span> <span data-ttu-id="7bac4-181">从设计器中，将 "UpdatePanel" 控件从 "工具箱" 拖动到 `MainContent` 内容控件，并将其 `ID` 属性设置为 "`ProductPanel`"。</span><span class="sxs-lookup"><span data-stu-id="7bac4-181">From the Designer, drag an UpdatePanel control from the Toolbox into the `MainContent` Content control and set its `ID` property to `ProductPanel`.</span></span> <span data-ttu-id="7bac4-182">UpdatePanel 表示屏幕上可通过部分页面回发异步更新的区域。</span><span class="sxs-lookup"><span data-stu-id="7bac4-182">The UpdatePanel represents a region on the screen that can be asynchronously updated through a partial page postback.</span></span>

<span data-ttu-id="7bac4-183">我们的第一个任务是在 UpdatePanel 内显示有关随机选择的产品的信息。</span><span class="sxs-lookup"><span data-stu-id="7bac4-183">Our first task is to display information about a randomly selected product within the UpdatePanel.</span></span> <span data-ttu-id="7bac4-184">首先，将 DetailsView 控件拖到 UpdatePanel 中。</span><span class="sxs-lookup"><span data-stu-id="7bac4-184">Start by dragging a DetailsView control into the UpdatePanel.</span></span> <span data-ttu-id="7bac4-185">将 DetailsView 控件的 `ID` 属性设置为 `ProductInfo` 并清除其 `Height` 和 `Width` 属性。</span><span class="sxs-lookup"><span data-stu-id="7bac4-185">Set the DetailsView control's `ID` property to `ProductInfo` and clear out its `Height` and `Width` properties.</span></span> <span data-ttu-id="7bac4-186">展开 DetailsView 的智能标记，然后从 "选择数据源" 下拉列表中，选择将 DetailsView 绑定到名为 `RandomProductDataSource`的新 SqlDataSource 控件。</span><span class="sxs-lookup"><span data-stu-id="7bac4-186">Expand the DetailsView's smart tag and, from the Choose Data Source drop-down list, choose to bind the DetailsView to a new SqlDataSource control named `RandomProductDataSource`.</span></span>

<span data-ttu-id="7bac4-187">[![将 DetailsView 绑定到新的 SqlDataSource 控件](master-pages-and-asp-net-ajax-vb/_static/image8.png)](master-pages-and-asp-net-ajax-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="7bac4-187">[![Bind the DetailsView to a New SqlDataSource Control](master-pages-and-asp-net-ajax-vb/_static/image8.png)](master-pages-and-asp-net-ajax-vb/_static/image7.png)</span></span>

<span data-ttu-id="7bac4-188">**图 03**：将 DetailsView 绑定到新的 SqlDataSource 控件（[单击以查看完全大小的图像](master-pages-and-asp-net-ajax-vb/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="7bac4-188">**Figure 03**: Bind the DetailsView to a New SqlDataSource Control  ([Click to view full-size image](master-pages-and-asp-net-ajax-vb/_static/image9.png))</span></span>

<span data-ttu-id="7bac4-189">将 SqlDataSource 控件配置为通过 "内容" 页上的 "与母版页交互" [SKM2] 教程中创建的 `NorthwindConnectionString` 连接到 Northwind 数据库。</span><span class="sxs-lookup"><span data-stu-id="7bac4-189">Configure the SqlDataSource control to connect to the Northwind database via the `NorthwindConnectionString` (which we created in the Interacting with the Master Page from the Content Page[SKM2] tutorial).</span></span> <span data-ttu-id="7bac4-190">配置 select 语句时，请选择指定自定义 SQL 语句，然后输入以下查询：</span><span class="sxs-lookup"><span data-stu-id="7bac4-190">When configuring the select statement choose to specify a custom SQL statement and then enter the following query:</span></span>

[!code-sql[Main](master-pages-and-asp-net-ajax-vb/samples/sample3.sql)]

<span data-ttu-id="7bac4-191">`SELECT` 子句中的 `TOP 1` 关键字只返回查询返回的第一条记录。</span><span class="sxs-lookup"><span data-stu-id="7bac4-191">The `TOP 1` keyword in the `SELECT` clause returns only the first record returned by the query.</span></span> <span data-ttu-id="7bac4-192">`NEWID()` 函数将生成一个新的全局唯一标识符值（GUID），并可以在 `ORDER BY` 子句中使用，以随机顺序返回表的记录。</span><span class="sxs-lookup"><span data-stu-id="7bac4-192">The `NEWID()` function generates a new globally unique identifier value (GUID) and can be used in an `ORDER BY` clause to return the table's records in a random order.</span></span>

<span data-ttu-id="7bac4-193">[![配置 SqlDataSource 以返回单个随机选择的记录](master-pages-and-asp-net-ajax-vb/_static/image11.png)](master-pages-and-asp-net-ajax-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="7bac4-193">[![Configure the SqlDataSource to Return a Single, Randomly Selected Record](master-pages-and-asp-net-ajax-vb/_static/image11.png)](master-pages-and-asp-net-ajax-vb/_static/image10.png)</span></span>

<span data-ttu-id="7bac4-194">**图 04**：配置 SqlDataSource 以返回单个随机选择的记录（[单击以查看完全大小的图像](master-pages-and-asp-net-ajax-vb/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="7bac4-194">**Figure 04**: Configure the SqlDataSource to Return a Single, Randomly Selected Record  ([Click to view full-size image](master-pages-and-asp-net-ajax-vb/_static/image12.png))</span></span>

<span data-ttu-id="7bac4-195">完成向导后，Visual Studio 将为上述查询返回的两个列创建一个 BoundField。</span><span class="sxs-lookup"><span data-stu-id="7bac4-195">After completing the wizard, Visual Studio creates a BoundField for the two columns returned by the above query.</span></span> <span data-ttu-id="7bac4-196">此时，页面的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="7bac4-196">At this point your page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](master-pages-and-asp-net-ajax-vb/samples/sample4.aspx)]

<span data-ttu-id="7bac4-197">图5显示了通过浏览器查看 `ShowRandomProduct.aspx` 页面。</span><span class="sxs-lookup"><span data-stu-id="7bac4-197">Figure 5 shows the `ShowRandomProduct.aspx` page when viewed through a browser.</span></span> <span data-ttu-id="7bac4-198">单击浏览器的 "刷新" 按钮以重新加载页面;应该会看到一个新的随机选定记录的 `ProductName` 和 `UnitPrice` 值。</span><span class="sxs-lookup"><span data-stu-id="7bac4-198">Click your browser's Refresh button to reload the page; you should see the `ProductName` and `UnitPrice` values for a new randomly selected record.</span></span>

<span data-ttu-id="7bac4-199">[显示 ![随机产品的名称和价格](master-pages-and-asp-net-ajax-vb/_static/image14.png)](master-pages-and-asp-net-ajax-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="7bac4-199">[![A Random Product's Name and Price is Displayed](master-pages-and-asp-net-ajax-vb/_static/image14.png)](master-pages-and-asp-net-ajax-vb/_static/image13.png)</span></span>

<span data-ttu-id="7bac4-200">**图 05**：显示随机产品的名称和价格（[单击查看完全大小的图像](master-pages-and-asp-net-ajax-vb/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="7bac4-200">**Figure 05**: A Random Product's Name and Price is Displayed  ([Click to view full-size image](master-pages-and-asp-net-ajax-vb/_static/image15.png))</span></span>

### <a name="automatically-displaying-a-new-product-every-15-seconds"></a><span data-ttu-id="7bac4-201">每15秒自动显示新产品</span><span class="sxs-lookup"><span data-stu-id="7bac4-201">Automatically Displaying a New Product Every 15 Seconds</span></span>

<span data-ttu-id="7bac4-202">ASP.NET AJAX 框架包含一个 Timer 控件，该控件在指定时间执行回发;回发时，引发计时器的 `Tick` 事件。</span><span class="sxs-lookup"><span data-stu-id="7bac4-202">The ASP.NET AJAX framework includes a Timer control that performs a postback at a specified time; on postback the Timer's `Tick` event is raised.</span></span> <span data-ttu-id="7bac4-203">如果计时器控件置于 UpdatePanel 内，则会触发部分页面回发，在此期间，我们可以将数据重新绑定到 DetailsView，以显示新的随机选择的产品。</span><span class="sxs-lookup"><span data-stu-id="7bac4-203">If the Timer control is placed within an UpdatePanel it triggers a partial page postback, during which we can rebind the data to the DetailsView to display a new randomly selected product.</span></span>

<span data-ttu-id="7bac4-204">若要实现此目的，请将计时器从工具箱拖放到 UpdatePanel 中。</span><span class="sxs-lookup"><span data-stu-id="7bac4-204">To accomplish this, drag a Timer from the Toolbox and drop it into the UpdatePanel.</span></span> <span data-ttu-id="7bac4-205">将计时器的 `ID` 从 `Timer1` 更改为 `ProductTimer`，并将其 `Interval` 属性从60000更改为15000。</span><span class="sxs-lookup"><span data-stu-id="7bac4-205">Change the Timer's `ID` from `Timer1` to `ProductTimer` and its `Interval` property from 60000 to 15000.</span></span> <span data-ttu-id="7bac4-206">`Interval` 属性指示回发之间的毫秒数;将其设置为15000将导致计时器每15秒触发部分页面回发。</span><span class="sxs-lookup"><span data-stu-id="7bac4-206">The `Interval` property indicates the number of milliseconds between postbacks; setting it to 15000 causes the Timer to trigger a partial page postback every 15 seconds.</span></span> <span data-ttu-id="7bac4-207">此时，计时器的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="7bac4-207">At this point your Timer's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](master-pages-and-asp-net-ajax-vb/samples/sample5.aspx)]

<span data-ttu-id="7bac4-208">为计时器的 `Tick` 事件创建事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="7bac4-208">Create an event handler for the Timer's `Tick` event.</span></span> <span data-ttu-id="7bac4-209">在此事件处理程序中，需要通过调用 DetailsView 的 `DataBind` 方法将数据重新绑定到 DetailsView。</span><span class="sxs-lookup"><span data-stu-id="7bac4-209">In this event handler we need to rebind the data to the DetailsView by calling the DetailsView's `DataBind` method.</span></span> <span data-ttu-id="7bac4-210">这样做会指示 DetailsView 重新检索其数据源控件中的数据，这将选择并显示新的随机选择的记录（就像通过单击浏览器的 "刷新" 按钮重新加载页面时）。</span><span class="sxs-lookup"><span data-stu-id="7bac4-210">Doing so instructs the DetailsView to re-retrieve the data from its data source control, which will select and display a new randomly selected record (just like when reloading the page by clicking the browser's Refresh button).</span></span>

[!code-vb[Main](master-pages-and-asp-net-ajax-vb/samples/sample6.vb)]

<span data-ttu-id="7bac4-211">就这么简单！</span><span class="sxs-lookup"><span data-stu-id="7bac4-211">That's all there is to it!</span></span> <span data-ttu-id="7bac4-212">通过浏览器重新访问页面。</span><span class="sxs-lookup"><span data-stu-id="7bac4-212">Revisit the page through a browser.</span></span> <span data-ttu-id="7bac4-213">最初，将显示随机产品的信息。</span><span class="sxs-lookup"><span data-stu-id="7bac4-213">Initially, a random product's information is displayed.</span></span> <span data-ttu-id="7bac4-214">如果你耐心观看屏幕，你会注意到，在15秒后，有关新产品的信息会神奇地替换现有的显示内容。</span><span class="sxs-lookup"><span data-stu-id="7bac4-214">If you patiently watch the screen you'll notice that, after 15 seconds, information about a new product magically replaces the existing display.</span></span>

<span data-ttu-id="7bac4-215">为了更好地了解此处发生的情况，让我们将 "标签" 控件添加到 UpdatePanel，以显示上次更新显示的时间。</span><span class="sxs-lookup"><span data-stu-id="7bac4-215">To better see what's happening here, let's add a Label control to the UpdatePanel that displays the time the display was last updated.</span></span> <span data-ttu-id="7bac4-216">在 UpdatePanel 中添加标签 Web 控件，将其 `ID` 设置为 `LastUpdateTime`，并清除其 `Text` 属性。</span><span class="sxs-lookup"><span data-stu-id="7bac4-216">Add a Label Web control within the UpdatePanel, set its `ID` to `LastUpdateTime`, and clear its `Text` property.</span></span> <span data-ttu-id="7bac4-217">接下来，为 UpdatePanel 的 `Load` 事件创建事件处理程序，并在标签中显示当前时间。</span><span class="sxs-lookup"><span data-stu-id="7bac4-217">Next, create an event handler for the UpdatePanel's `Load` event and display the current time in the Label.</span></span> <span data-ttu-id="7bac4-218">（UpdatePanel 的 `Load` 事件将在每次完全或部分页面回发时触发。）</span><span class="sxs-lookup"><span data-stu-id="7bac4-218">(The UpdatePanel's `Load` event is fired on every full or partial page postback.)</span></span>

[!code-vb[Main](master-pages-and-asp-net-ajax-vb/samples/sample7.vb)]

<span data-ttu-id="7bac4-219">完成此更改后，页面将包括当前显示的产品的加载时间。</span><span class="sxs-lookup"><span data-stu-id="7bac4-219">With this change complete, the page includes the time the currently displayed product was loaded.</span></span> <span data-ttu-id="7bac4-220">图6显示第一次访问的页面。</span><span class="sxs-lookup"><span data-stu-id="7bac4-220">Figure 6 shows the page when first visited.</span></span> <span data-ttu-id="7bac4-221">图7稍后显示了15秒的时间段，在计时器控件具有 "勾选" 后，UpdatePanel 已刷新以显示有关新产品的信息。</span><span class="sxs-lookup"><span data-stu-id="7bac4-221">Figure 7 shows the page 15 seconds later after the Timer control has "ticked" and the UpdatePanel has been refreshed to display information about a new product.</span></span>

<span data-ttu-id="7bac4-222">[![随机选择的产品显示在页面加载上](master-pages-and-asp-net-ajax-vb/_static/image17.png)](master-pages-and-asp-net-ajax-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="7bac4-222">[![A Randomly Selected Product is Displayed on Page Load](master-pages-and-asp-net-ajax-vb/_static/image17.png)](master-pages-and-asp-net-ajax-vb/_static/image16.png)</span></span>

<span data-ttu-id="7bac4-223">**图 06**：随机选择的产品显示在页面加载上（[单击以查看完全大小的图像](master-pages-and-asp-net-ajax-vb/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="7bac4-223">**Figure 06**: A Randomly Selected Product is Displayed on Page Load  ([Click to view full-size image](master-pages-and-asp-net-ajax-vb/_static/image18.png))</span></span>

<span data-ttu-id="7bac4-224">[每15秒 ![显示一个新随机选择的产品](master-pages-and-asp-net-ajax-vb/_static/image20.png)](master-pages-and-asp-net-ajax-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="7bac4-224">[![Every 15 Seconds a New Randomly Selected Product is Displayed](master-pages-and-asp-net-ajax-vb/_static/image20.png)](master-pages-and-asp-net-ajax-vb/_static/image19.png)</span></span>

<span data-ttu-id="7bac4-225">**图 07**：显示新随机选择的产品的每15秒（[单击以查看完全大小的图像](master-pages-and-asp-net-ajax-vb/_static/image21.png)）</span><span class="sxs-lookup"><span data-stu-id="7bac4-225">**Figure 07**: Every 15 Seconds a New Randomly Selected Product is Displayed  ([Click to view full-size image](master-pages-and-asp-net-ajax-vb/_static/image21.png))</span></span>

## <a name="step-3-using-the-scriptmanagerproxy-control"></a><span data-ttu-id="7bac4-226">步骤3：使用 ScriptManagerProxy 控件</span><span class="sxs-lookup"><span data-stu-id="7bac4-226">Step 3: Using the ScriptManagerProxy Control</span></span>

<span data-ttu-id="7bac4-227">除了包括 ASP.NET AJAX framework 客户端库所需的脚本外，ScriptManager 还可以注册自定义 JavaScript 文件、对启用脚本的 Web 服务的引用以及自定义的身份验证、授权和配置文件服务。</span><span class="sxs-lookup"><span data-stu-id="7bac4-227">Along with including the necessary script for the ASP.NET AJAX framework Client Library, the ScriptManager can also register custom JavaScript files, references to script-enabled Web Services, and custom authentication, authorization, and profile services.</span></span> <span data-ttu-id="7bac4-228">通常，此类自定义项特定于某个页面。</span><span class="sxs-lookup"><span data-stu-id="7bac4-228">Usually such customizations are specific to a certain page.</span></span> <span data-ttu-id="7bac4-229">但是，如果自定义脚本文件、Web 服务引用、身份验证、授权或配置文件服务在母版页的 ScriptManager 中被引用，则它们将包含在网站的所有页面中。</span><span class="sxs-lookup"><span data-stu-id="7bac4-229">However, if the custom script files, Web Service references, or authentication, authorization, or profile services are referenced in the ScriptManager in the master page then they are included in all pages in the website.</span></span>

<span data-ttu-id="7bac4-230">若要逐页添加 ScriptManager 相关自定义项，请使用 ScriptManagerProxy 控件。</span><span class="sxs-lookup"><span data-stu-id="7bac4-230">To add ScriptManager-related customizations on a page-by-page basis use the ScriptManagerProxy control.</span></span> <span data-ttu-id="7bac4-231">你可以将 ScriptManagerProxy 添加到内容页，然后从 ScriptManagerProxy 注册自定义 JavaScript 文件、Web 服务引用、身份验证、授权或配置文件服务;这就是为特定内容页注册这些服务的效果。</span><span class="sxs-lookup"><span data-stu-id="7bac4-231">You can add a ScriptManagerProxy to a content page and then register the custom JavaScript file, Web Service reference, or authentication, authorization, or profile service from the ScriptManagerProxy; this has the effect of registering these services for the particular content page.</span></span>

> [!NOTE]
> <span data-ttu-id="7bac4-232">ASP.NET 页只能有一个 ScriptManager 控件存在。</span><span class="sxs-lookup"><span data-stu-id="7bac4-232">An ASP.NET page can only have no more than one ScriptManager control present.</span></span> <span data-ttu-id="7bac4-233">因此，如果已在母版页中定义了 ScriptManager 控件，则无法将 ScriptManager 控件添加到内容页中。</span><span class="sxs-lookup"><span data-stu-id="7bac4-233">Therefore, you cannot add a ScriptManager control to a content page if the ScriptManager control is already defined in the master page.</span></span> <span data-ttu-id="7bac4-234">ScriptManagerProxy 的唯一目的是提供一种方法，使开发人员能够在母版页中定义 ScriptManager，但仍可以逐页添加 ScriptManager 自定义项。</span><span class="sxs-lookup"><span data-stu-id="7bac4-234">The sole purpose of the ScriptManagerProxy is to provide a way for developers to define the ScriptManager in the master page, but still have the ability to add ScriptManager customizations on a page-by-page basis.</span></span>

<span data-ttu-id="7bac4-235">若要查看 ScriptManagerProxy 控件的操作，请在 `ShowRandomProduct.aspx` 中增加 UpdatePanel，使其包含一个按钮，该按钮使用客户端脚本来暂停或继续计时器控件。</span><span class="sxs-lookup"><span data-stu-id="7bac4-235">To see the ScriptManagerProxy control in action, let's augment the UpdatePanel in `ShowRandomProduct.aspx` to include a button that uses client-side script to pause or resume the Timer control.</span></span> <span data-ttu-id="7bac4-236">计时器控件具有三个可用于实现所需功能的客户端方法：</span><span class="sxs-lookup"><span data-stu-id="7bac4-236">The Timer control has three client-side methods that we can use to achieve this desired functionality:</span></span>

- <span data-ttu-id="7bac4-237">`_startTimer()`-启动计时器控件</span><span class="sxs-lookup"><span data-stu-id="7bac4-237">`_startTimer()` - starts the Timer control</span></span>
- <span data-ttu-id="7bac4-238">`_raiseTick()`-使计时器控件 "计时"，从而在服务器上回发并引发其 Tick 事件</span><span class="sxs-lookup"><span data-stu-id="7bac4-238">`_raiseTick()` - causes the Timer control to "tick," thereby posting back and raising its Tick event on the server</span></span>
- <span data-ttu-id="7bac4-239">`_stopTimer()`-停止计时器控件</span><span class="sxs-lookup"><span data-stu-id="7bac4-239">`_stopTimer()` - stops the Timer control</span></span>

<span data-ttu-id="7bac4-240">让我们创建一个 JavaScript 文件，其中包含一个名为 `timerEnabled` 的变量和一个名为 `ToggleTimer`的函数。</span><span class="sxs-lookup"><span data-stu-id="7bac4-240">Let's create a JavaScript file with a variable named `timerEnabled` and a function named `ToggleTimer`.</span></span> <span data-ttu-id="7bac4-241">`timerEnabled` 变量指示当前是启用还是禁用计时器控件;默认值为 true。</span><span class="sxs-lookup"><span data-stu-id="7bac4-241">The `timerEnabled` variable indicates whether the Timer control is currently enabled or disabled; it defaults to true.</span></span> <span data-ttu-id="7bac4-242">`ToggleTimer` 函数接受两个输入参数：对计时器控件的 "暂停/继续" 按钮和客户端 `id` 值的引用。</span><span class="sxs-lookup"><span data-stu-id="7bac4-242">The `ToggleTimer` function accepts two input parameters: a reference to the Pause/Resume button and the client-side `id` value of the Timer control.</span></span> <span data-ttu-id="7bac4-243">此函数会切换 `timerEnabled`的值、获取对计时器控件的引用、启动或停止计时器（具体取决于 `timerEnabled`的值），并将按钮的显示文本更新为 "暂停" 或 "恢复"。</span><span class="sxs-lookup"><span data-stu-id="7bac4-243">This function toggles the value of `timerEnabled`, gets a reference to the Timer control, starts or stops the Timer (depending on the value of `timerEnabled`), and updates the button's display text to "Pause" or "Resume".</span></span> <span data-ttu-id="7bac4-244">只要单击 "暂停/继续" 按钮，就会调用此函数。</span><span class="sxs-lookup"><span data-stu-id="7bac4-244">This function will be called whenever the Pause/Resume button is clicked.</span></span>

<span data-ttu-id="7bac4-245">首先在名为 `Scripts`的网站中创建一个新文件夹。</span><span class="sxs-lookup"><span data-stu-id="7bac4-245">Start by creating a new folder in the website named `Scripts`.</span></span> <span data-ttu-id="7bac4-246">接下来，将新文件添加到类型为 JScript 文件的名为 `TimerScript.js` 的 Scripts 文件夹中。</span><span class="sxs-lookup"><span data-stu-id="7bac4-246">Next, add a new file to the Scripts folder named `TimerScript.js` of type JScript File.</span></span>

<span data-ttu-id="7bac4-247">[![将新的 JavaScript 文件添加到 Scripts 文件夹](master-pages-and-asp-net-ajax-vb/_static/image23.png)](master-pages-and-asp-net-ajax-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="7bac4-247">[![Add a New JavaScript File to the Scripts Folder](master-pages-and-asp-net-ajax-vb/_static/image23.png)](master-pages-and-asp-net-ajax-vb/_static/image22.png)</span></span>

<span data-ttu-id="7bac4-248">**图 08**：将新的 JavaScript 文件添加到 `Scripts` 文件夹（[单击查看完全大小的映像](master-pages-and-asp-net-ajax-vb/_static/image24.png)）</span><span class="sxs-lookup"><span data-stu-id="7bac4-248">**Figure 08**: Add a New JavaScript File to the `Scripts` Folder  ([Click to view full-size image](master-pages-and-asp-net-ajax-vb/_static/image24.png))</span></span>

<span data-ttu-id="7bac4-249">[已将新的 JavaScript 文件添加到网站 ![](master-pages-and-asp-net-ajax-vb/_static/image26.png)](master-pages-and-asp-net-ajax-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="7bac4-249">[![A New JavaScript File has been Added to the Website](master-pages-and-asp-net-ajax-vb/_static/image26.png)](master-pages-and-asp-net-ajax-vb/_static/image25.png)</span></span>

<span data-ttu-id="7bac4-250">**图 09**：已将新的 JavaScript 文件添加到网站（[单击查看完全大小的图像](master-pages-and-asp-net-ajax-vb/_static/image27.png)）</span><span class="sxs-lookup"><span data-stu-id="7bac4-250">**Figure 09**: A New JavaScript File has been Added to the Website ([Click to view full-size image](master-pages-and-asp-net-ajax-vb/_static/image27.png))</span></span>

<span data-ttu-id="7bac4-251">接下来，将以下脚本添加到 `TimerScript.js` 文件：</span><span class="sxs-lookup"><span data-stu-id="7bac4-251">Next, add the following scrip to the `TimerScript.js` file:</span></span>

[!code-csharp[Main](master-pages-and-asp-net-ajax-vb/samples/sample8.cs)]

<span data-ttu-id="7bac4-252">现在，我们需要在 `ShowRandomProduct.aspx`中注册此自定义 JavaScript 文件。</span><span class="sxs-lookup"><span data-stu-id="7bac4-252">We now need to register this custom JavaScript file in `ShowRandomProduct.aspx`.</span></span> <span data-ttu-id="7bac4-253">返回到 `ShowRandomProduct.aspx` 并向页面添加 ScriptManagerProxy 控件;将其 `ID` 设置为 `MyManagerProxy`。</span><span class="sxs-lookup"><span data-stu-id="7bac4-253">Return to `ShowRandomProduct.aspx` and add a ScriptManagerProxy control to the page; set its `ID` to `MyManagerProxy`.</span></span> <span data-ttu-id="7bac4-254">若要注册自定义 JavaScript 文件，请在设计器中选择 "ScriptManagerProxy" 控件，然后执行属性窗口。</span><span class="sxs-lookup"><span data-stu-id="7bac4-254">To register a custom JavaScript file select the ScriptManagerProxy control in the Designer and then go to the Properties window.</span></span> <span data-ttu-id="7bac4-255">其中一个属性的标题为 "脚本"。</span><span class="sxs-lookup"><span data-stu-id="7bac4-255">One of the properties is titled Scripts.</span></span> <span data-ttu-id="7bac4-256">选择此属性将显示如图10所示的 ScriptReference 集合编辑器。</span><span class="sxs-lookup"><span data-stu-id="7bac4-256">Selecting this property displays the ScriptReference Collection Editor shown in Figure 10.</span></span> <span data-ttu-id="7bac4-257">单击 "添加" 按钮以添加新的脚本引用，然后在 "路径" 属性： "`~/Scripts/TimerScript.js`中输入脚本文件的路径。</span><span class="sxs-lookup"><span data-stu-id="7bac4-257">Click the Add button to include a new script reference and then enter the path to the script file in the Path property: `~/Scripts/TimerScript.js`.</span></span>

<span data-ttu-id="7bac4-258">[![将脚本引用添加到 ScriptManagerProxy 控件](master-pages-and-asp-net-ajax-vb/_static/image29.png)](master-pages-and-asp-net-ajax-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="7bac4-258">[![Add a Script Reference to the ScriptManagerProxy Control](master-pages-and-asp-net-ajax-vb/_static/image29.png)](master-pages-and-asp-net-ajax-vb/_static/image28.png)</span></span>

<span data-ttu-id="7bac4-259">**图 10**：向 ScriptManagerProxy 控件添加脚本引用（[单击查看完全大小的图像](master-pages-and-asp-net-ajax-vb/_static/image30.png)）</span><span class="sxs-lookup"><span data-stu-id="7bac4-259">**Figure 10**: Add a Script Reference to the ScriptManagerProxy Control ([Click to view full-size image](master-pages-and-asp-net-ajax-vb/_static/image30.png))</span></span>

<span data-ttu-id="7bac4-260">添加脚本引用后，将更新 ScriptManagerProxy 控件的声明性标记，使其包含一个具有单个 `ScriptReference` 条目的 `<Scripts>` 集合，如以下标记片段所示：</span><span class="sxs-lookup"><span data-stu-id="7bac4-260">After adding the script reference the ScriptManagerProxy control's declarative markup is updated to include a `<Scripts>` collection with a single `ScriptReference` entry, as the following snippet of markup illustrates:</span></span>

[!code-aspx[Main](master-pages-and-asp-net-ajax-vb/samples/sample9.aspx)]

<span data-ttu-id="7bac4-261">`ScriptReference` 项指示 ScriptManagerProxy 在其呈现的标记中包含对 JavaScript 文件的引用。</span><span class="sxs-lookup"><span data-stu-id="7bac4-261">The `ScriptReference` entry instructs the ScriptManagerProxy to include a reference to the JavaScript file in its rendered markup.</span></span> <span data-ttu-id="7bac4-262">也就是说，通过将自定义脚本注册到 ScriptManagerProxy 中，`ShowRandomProduct.aspx` 页面呈现的输出现在包含另一个 `<script src="url"></script>` 标记： `<script src="Scripts/TimerScript.js" type="text/javascript"></script>`。</span><span class="sxs-lookup"><span data-stu-id="7bac4-262">That is, by registering the custom script in the ScriptManagerProxy the `ShowRandomProduct.aspx` page's rendered output now includes another `<script src="url"></script>` tag: `<script src="Scripts/TimerScript.js" type="text/javascript"></script>`.</span></span>

<span data-ttu-id="7bac4-263">现在，我们可以从 "`ShowRandomProduct.aspx`" 页中的客户端脚本调用在 `TimerScript.js` 中定义的 `ToggleTimer` 函数。</span><span class="sxs-lookup"><span data-stu-id="7bac4-263">We can now call the `ToggleTimer` function defined in `TimerScript.js` from the client script in the `ShowRandomProduct.aspx` page.</span></span> <span data-ttu-id="7bac4-264">在 UpdatePanel 中添加以下 HTML：</span><span class="sxs-lookup"><span data-stu-id="7bac4-264">Add the following HTML within the UpdatePanel:</span></span>

[!code-aspx[Main](master-pages-and-asp-net-ajax-vb/samples/sample10.aspx)]

<span data-ttu-id="7bac4-265">这会显示一个带有文本 "Pause" 的按钮。</span><span class="sxs-lookup"><span data-stu-id="7bac4-265">This displays a button with the text "Pause".</span></span> <span data-ttu-id="7bac4-266">只要单击该按钮，就会调用 JavaScript 函数 `ToggleTimer`，同时传递对该按钮的引用和 Timer 控件的 `id` 值（`ProductTimer`）。</span><span class="sxs-lookup"><span data-stu-id="7bac4-266">Whenever it is clicked, the JavaScript function `ToggleTimer` is called, passing in a reference to the button and the `id` value of the Timer control (`ProductTimer`).</span></span> <span data-ttu-id="7bac4-267">请注意用于获取计时器控件的 `id` 值的语法。</span><span class="sxs-lookup"><span data-stu-id="7bac4-267">Note the syntax for obtaining the `id` value of the Timer control.</span></span> <span data-ttu-id="7bac4-268">`<%=ProductTimer.ClientID%>` 发出 `ProductTimer` 计时器控件 `ClientID` 属性的值。</span><span class="sxs-lookup"><span data-stu-id="7bac4-268">`<%=ProductTimer.ClientID%>` emits the value of the `ProductTimer` Timer control's `ClientID` property.</span></span> <span data-ttu-id="7bac4-269">在内容页中的控件 ID 命名 [SKM3] 教程中，我们讨论了服务器端 `ID` 值和生成的客户端 `id` 值之间的差异，以及 `ClientID` 如何返回客户端 `id`。</span><span class="sxs-lookup"><span data-stu-id="7bac4-269">In the Control ID Naming in Content Pages[SKM3] tutorial we discussed the differences between the server-side `ID` value and the resulting client-side `id` value, and how `ClientID` returns the client-side `id`.</span></span>

<span data-ttu-id="7bac4-270">图11：首次通过浏览器访问时显示此页。</span><span class="sxs-lookup"><span data-stu-id="7bac4-270">Figure 11 shows this page when first visited through a browser.</span></span> <span data-ttu-id="7bac4-271">计时器当前正在运行，每15秒更新一次显示的产品信息。</span><span class="sxs-lookup"><span data-stu-id="7bac4-271">The Timer is currently running and updates the displayed product information every 15 seconds.</span></span> <span data-ttu-id="7bac4-272">图12在单击 "暂停" 按钮后显示屏幕。</span><span class="sxs-lookup"><span data-stu-id="7bac4-272">Figure 12 shows the screen after the Pause button has been clicked.</span></span> <span data-ttu-id="7bac4-273">单击 "暂停" 按钮将停止计时器，并将该按钮的文本更新为 "Resume"。</span><span class="sxs-lookup"><span data-stu-id="7bac4-273">Clicking the Pause button stops the Timer and updates the button's text to "Resume".</span></span> <span data-ttu-id="7bac4-274">用户单击 "继续" 后，将刷新产品信息（并每15秒刷新一次）。</span><span class="sxs-lookup"><span data-stu-id="7bac4-274">The product information will refresh (and continue to refresh every 15 seconds) once the user clicks Resume.</span></span>

<span data-ttu-id="7bac4-275">[![单击 "暂停" 按钮停止计时器控件](master-pages-and-asp-net-ajax-vb/_static/image32.png)](master-pages-and-asp-net-ajax-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="7bac4-275">[![Click the Pause Button to Stop the Timer Control](master-pages-and-asp-net-ajax-vb/_static/image32.png)](master-pages-and-asp-net-ajax-vb/_static/image31.png)</span></span>

<span data-ttu-id="7bac4-276">**图 11**：单击 "暂停" 按钮以停止计时器控件（[单击以查看完全大小的图像](master-pages-and-asp-net-ajax-vb/_static/image33.png)）</span><span class="sxs-lookup"><span data-stu-id="7bac4-276">**Figure 11**: Click the Pause Button to Stop the Timer Control  ([Click to view full-size image](master-pages-and-asp-net-ajax-vb/_static/image33.png))</span></span>

<span data-ttu-id="7bac4-277">[![单击 "继续" 按钮重新启动计时器](master-pages-and-asp-net-ajax-vb/_static/image35.png)](master-pages-and-asp-net-ajax-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="7bac4-277">[![Click the Resume Button to Restart the Timer](master-pages-and-asp-net-ajax-vb/_static/image35.png)](master-pages-and-asp-net-ajax-vb/_static/image34.png)</span></span>

<span data-ttu-id="7bac4-278">**图 12**：单击 "继续" 按钮以重新启动计时器（[单击以查看完全大小的映像](master-pages-and-asp-net-ajax-vb/_static/image36.png)）</span><span class="sxs-lookup"><span data-stu-id="7bac4-278">**Figure 12**: Click the Resume Button to Restart the Timer  ([Click to view full-size image](master-pages-and-asp-net-ajax-vb/_static/image36.png))</span></span>

## <a name="summary"></a><span data-ttu-id="7bac4-279">摘要</span><span class="sxs-lookup"><span data-stu-id="7bac4-279">Summary</span></span>

<span data-ttu-id="7bac4-280">使用 ASP.NET AJAX framework 生成启用 AJAX 的 web 应用程序时，必须确保每个启用 AJAX 的网页都包含 ScriptManager 控件。</span><span class="sxs-lookup"><span data-stu-id="7bac4-280">When building AJAX-enabled web applications using the ASP.NET AJAX framework it is imperative that every AJAX-enabled web page include a ScriptManager control.</span></span> <span data-ttu-id="7bac4-281">为简化此过程，我们可以将 ScriptManager 添加到母版页，而不必记得向每个内容页添加 ScriptManager。</span><span class="sxs-lookup"><span data-stu-id="7bac4-281">To facilitate this process, we can add a ScriptManager to the master page rather than having to remember to add a ScriptManager to each and every content page.</span></span> <span data-ttu-id="7bac4-282">步骤1说明了如何将 ScriptManager 添加到母版页，步骤2中介绍了如何实现内容页中的 AJAX 功能。</span><span class="sxs-lookup"><span data-stu-id="7bac4-282">Step 1 showed how to add the ScriptManager to the master page while Step 2 looked at implementing AJAX functionality in a content page.</span></span>

<span data-ttu-id="7bac4-283">如果需要向特定内容页添加自定义脚本、对启用了脚本的 Web 服务的引用或者自定义的身份验证、授权或配置文件服务，请将 ScriptManagerProxy 控件添加到内容页，然后配置自定义。</span><span class="sxs-lookup"><span data-stu-id="7bac4-283">If you need to add custom scripts, references to script-enabled Web Services, or customized authentication, authorization, or profile services to a particular content page, add a ScriptManagerProxy control to the content page and then configure the customizations there.</span></span> <span data-ttu-id="7bac4-284">步骤3检查了如何使用 ScriptManagerProxy 在特定内容页中注册自定义 JavaScript 文件。</span><span class="sxs-lookup"><span data-stu-id="7bac4-284">Step 3 examined how to use the ScriptManagerProxy to register a custom JavaScript file in a specific content page.</span></span>

<span data-ttu-id="7bac4-285">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="7bac4-285">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="7bac4-286">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="7bac4-286">Further Reading</span></span>

<span data-ttu-id="7bac4-287">有关本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="7bac4-287">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="7bac4-288">ASP.NET AJAX Framework</span><span class="sxs-lookup"><span data-stu-id="7bac4-288">ASP.NET AJAX Framework</span></span>](../../../../ajax/index.md)
- [<span data-ttu-id="7bac4-289">ASP.NET AJAX 教程</span><span class="sxs-lookup"><span data-stu-id="7bac4-289">ASP.NET AJAX Tutorials</span></span>](../aspnet-ajax/understanding-partial-page-updates-with-asp-net-ajax.md)
- [<span data-ttu-id="7bac4-290">ASP.NET AJAX 视频</span><span class="sxs-lookup"><span data-stu-id="7bac4-290">ASP.NET AJAX Videos</span></span>](../../../videos/aspnet-ajax/index.md)
- [<span data-ttu-id="7bac4-291">Microsoft ASP.NET AJAX 构建交互式用户界面</span><span class="sxs-lookup"><span data-stu-id="7bac4-291">Building Interactive User Interface with Microsoft ASP.NET AJAX</span></span>](http://aspnet.4guysfromrolla.com/articles/101007-1.aspx)
- [<span data-ttu-id="7bac4-292">使用 NEWID 对记录进行随机排序</span><span class="sxs-lookup"><span data-stu-id="7bac4-292">Using NEWID to Randomly Sort Records</span></span>](http://www.sqlteam.com/article/using-newid-to-randomly-sort-records)
- [<span data-ttu-id="7bac4-293">使用计时器控件</span><span class="sxs-lookup"><span data-stu-id="7bac4-293">Using the Timer Control</span></span>](http://aspnet.4guysfromrolla.com/articles/061808-1.aspx)

### <a name="about-the-author"></a><span data-ttu-id="7bac4-294">关于作者</span><span class="sxs-lookup"><span data-stu-id="7bac4-294">About the Author</span></span>

<span data-ttu-id="7bac4-295">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，创始人的多个 ASP/asp 和4GuysFromRolla.com 的作者已使用 Microsoft Web 技术，1998。</span><span class="sxs-lookup"><span data-stu-id="7bac4-295">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="7bac4-296">Scott 的工作方式是独立的顾问、培训师和撰稿人。</span><span class="sxs-lookup"><span data-stu-id="7bac4-296">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="7bac4-297">他的最新书籍是，[*在24小时内，sam ASP.NET 3.5*](https://www.amazon.com/exec/obidos/ASIN/0672329972/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="7bac4-297">His latest book is [*Sams Teach Yourself ASP.NET 3.5 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672329972/4guysfromrollaco).</span></span> <span data-ttu-id="7bac4-298">可以通过[http://ScottOnWriting.NET](http://scottonwriting.net/) [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)或通过他的博客访问 Scott。</span><span class="sxs-lookup"><span data-stu-id="7bac4-298">Scott can be reached at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="7bac4-299">特别感谢</span><span class="sxs-lookup"><span data-stu-id="7bac4-299">Special Thanks To</span></span>

<span data-ttu-id="7bac4-300">此教程系列由许多有用的审阅者查看。</span><span class="sxs-lookup"><span data-stu-id="7bac4-300">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="7bac4-301">想要查看我即将发布的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="7bac4-301">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="7bac4-302">如果是这样，请在[mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="7bac4-302">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="7bac4-303">[上一页](interacting-with-the-content-page-from-the-master-page-vb.md)
> [下一页](specifying-the-master-page-programmatically-vb.md)</span><span class="sxs-lookup"><span data-stu-id="7bac4-303">[Previous](interacting-with-the-content-page-from-the-master-page-vb.md)
[Next](specifying-the-master-page-programmatically-vb.md)</span></span>
