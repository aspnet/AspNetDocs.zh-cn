---
uid: web-forms/overview/older-versions-getting-started/master-pages/urls-in-master-pages-cs
title: 母版页中的 Url （C#） |Microsoft Docs
author: rick-anderson
description: 解决母版页中的 Url 如何中断，因为母版页文件与内容页在不同的相对目录中。 查看变基 。
ms.author: riande
ms.date: 06/10/2008
ms.assetid: 48b58a18-5ea4-468c-b326-f35331b3e1e9
msc.legacyurl: /web-forms/overview/older-versions-getting-started/master-pages/urls-in-master-pages-cs
msc.type: authoredcontent
ms.openlocfilehash: 2551a5361256234883bb37e46e794037284445a4
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/28/2019
ms.locfileid: "74640980"
---
# <a name="urls-in-master-pages-c"></a><span data-ttu-id="9a7b2-104">母版页中的 URL (C#)</span><span class="sxs-lookup"><span data-stu-id="9a7b2-104">URLs in Master Pages (C#)</span></span>

<span data-ttu-id="9a7b2-105">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="9a7b2-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="9a7b2-106">[下载代码](https://download.microsoft.com/download/e/e/f/eef369f5-743a-4a52-908f-b6532c4ce0a4/ASPNET_MasterPages_Tutorial_04_CS.zip)或[下载 PDF](https://download.microsoft.com/download/8/f/6/8f6349e4-6554-405a-bcd7-9b094ba5089a/ASPNET_MasterPages_Tutorial_04_CS.pdf)</span><span class="sxs-lookup"><span data-stu-id="9a7b2-106">[Download Code](https://download.microsoft.com/download/e/e/f/eef369f5-743a-4a52-908f-b6532c4ce0a4/ASPNET_MasterPages_Tutorial_04_CS.zip) or [Download PDF](https://download.microsoft.com/download/8/f/6/8f6349e4-6554-405a-bcd7-9b094ba5089a/ASPNET_MasterPages_Tutorial_04_CS.pdf)</span></span>

> <span data-ttu-id="9a7b2-107">解决母版页中的 Url 如何中断，因为母版页文件与内容页在不同的相对目录中。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-107">Addresses how URLs in the master page can break due to the master page file being in a different relative directory than the content page.</span></span> <span data-ttu-id="9a7b2-108">在声明性语法中通过 ~ 查看变基 Url，并以编程方式使用 ResolveUrl 和 ResolveClientUrl。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-108">Looks at rebasing URLs via ~ in the declarative syntax and using ResolveUrl and ResolveClientUrl programmatically.</span></span> <span data-ttu-id="9a7b2-109">（同时查看</span><span class="sxs-lookup"><span data-stu-id="9a7b2-109">(Also look at</span></span>

## <a name="introduction"></a><span data-ttu-id="9a7b2-110">简介</span><span class="sxs-lookup"><span data-stu-id="9a7b2-110">Introduction</span></span>

<span data-ttu-id="9a7b2-111">在我们目前已看到的所有示例中，母版页和内容页面都位于同一个文件夹（网站的根文件夹）中。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-111">In all the examples we've seen thus far, the master and content pages have been located in the same folder (the website's root folder).</span></span> <span data-ttu-id="9a7b2-112">但这并不是因为主页面和内容页必须在同一文件夹中。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-112">But there's no reason why the master and content pages must be in the same folder.</span></span> <span data-ttu-id="9a7b2-113">当然，你可以在子文件夹中创建内容页。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-113">You can certainly create content pages in subfolders.</span></span> <span data-ttu-id="9a7b2-114">同样，您也可以创建一个 `~/MasterPages/` 文件夹来放置站点的母版页。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-114">Similarly, you might create a `~/MasterPages/` folder where you place your site's master pages.</span></span>

<span data-ttu-id="9a7b2-115">将母版页和内容页面置于不同文件夹中的一个潜在问题涉及到一些断开的 Url。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-115">One potential issue with placing master and content pages in different folders involves broken URLs.</span></span> <span data-ttu-id="9a7b2-116">如果母版页在超链接、图像或其他元素中包含相对 Url，则该链接将对于驻留在其他文件夹中的内容页无效。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-116">If the master page contains relative URLs in hyperlinks, images, or other elements, the link will be invalid for content pages that reside in a different folder.</span></span> <span data-ttu-id="9a7b2-117">在本教程中，我们将探讨此问题的根源以及解决方法。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-117">In this tutorial we examine the source of this problem as well as workarounds.</span></span>

## <a name="the-problem-with-relative-urls"></a><span data-ttu-id="9a7b2-118">相对 Url 的问题</span><span class="sxs-lookup"><span data-stu-id="9a7b2-118">The Problem with Relative URLs</span></span>

<span data-ttu-id="9a7b2-119">如果网页上指向的资源的位置相对于网站的文件夹结构中网页的位置，则该网页上的 URL 称为*相对 url* 。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-119">A URL on a web page is said to be a *relative URL* if the location of the resource it points to is relative to the web page's location in the website's folder structure.</span></span> <span data-ttu-id="9a7b2-120">不以前导正斜杠（`/`）或协议（如 `http://`）开头的任何 URL 是相对的，因为浏览器会根据包含 URL 的网页的位置对其进行解析。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-120">Any URL that does not start with a leading forward slash (`/`) or a protocol (such as `http://`) is relative because it is resolved by the browser based on the location of the web page that contains the URL.</span></span>

<span data-ttu-id="9a7b2-121">例如，我们的网站有一个 `~/Images/` 文件夹，其中包含一个图像文件，`PoweredByASPNET.gif`。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-121">For example, our website has an `~/Images/` folder with a single image file, `PoweredByASPNET.gif`.</span></span> <span data-ttu-id="9a7b2-122">母版页文件 `Site.master` 在 `footerContent` 区域中有一个 `<img>` 元素，该元素具有以下标记：</span><span class="sxs-lookup"><span data-stu-id="9a7b2-122">The master page file `Site.master` has an `<img>` element in the `footerContent` region with the following markup:</span></span>

[!code-html[Main](urls-in-master-pages-cs/samples/sample1.html)]

<span data-ttu-id="9a7b2-123">`<img>` 元素中的 `src` 属性值是相对 URL，因为它不以 `/` 或 `http://`开头。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-123">The `src` attribute value in the `<img>` element is a relative URL because it does not start with `/` or `http://`.</span></span> <span data-ttu-id="9a7b2-124">简而言之，`src` 属性值通知浏览器在 `Images` 子文件夹中查找名为 "`PoweredByASPNET.gif`" 的文件。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-124">In short, the `src` attribute value tells the browser to look in the `Images` subfolder for a file named `PoweredByASPNET.gif`.</span></span>

<span data-ttu-id="9a7b2-125">在访问内容页时，上述标记将直接发送到浏览器。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-125">When visiting a content page, the above markup is sent directly to the browser.</span></span> <span data-ttu-id="9a7b2-126">请花点时间访问 `About.aspx` 并查看发送到浏览器的 HTML 源。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-126">Take a moment to visit `About.aspx` and view the HTML source sent to the browser.</span></span> <span data-ttu-id="9a7b2-127">您会发现，母版页中的标记完全相同。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-127">You will find that the exact same markup in the master page was sent to the browser.</span></span>

[!code-html[Main](urls-in-master-pages-cs/samples/sample2.html)]

<span data-ttu-id="9a7b2-128">如果内容页位于根文件夹中（如 `About.aspx`），则一切都按预期方式运行，因为相对于根文件夹有一个 `Images` 子文件夹。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-128">If the content page is in the root folder (as is `About.aspx`) everything works as expected because there is an `Images` subfolder relative to the root folder.</span></span> <span data-ttu-id="9a7b2-129">但是，如果内容页与母版页不在同一文件夹中，则会中断。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-129">However, things break down if the content page is in a different folder than the master page.</span></span> <span data-ttu-id="9a7b2-130">为了说明这一点，请创建一个名为 `Admin`的子文件夹。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-130">To illustrate this, create a subfolder named `Admin`.</span></span> <span data-ttu-id="9a7b2-131">接下来，将名为 `Default.aspx` 的内容页添加到 `Admin` 文件夹，并确保将新页绑定到 `Site.master` 母版页。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-131">Next, add a content page named `Default.aspx` to the `Admin` folder, making sure to bind the new page to the `Site.master` master page.</span></span>

> [!NOTE]
> <span data-ttu-id="9a7b2-132">在母版页教程的 "[*指定标题、Meta 标记和其他 HTML 标头*](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-cs.md)" 中，我们创建了一个名为 `BasePage` 的自定义基类类，该页面类自动设置内容页的标题（如果未显式分配）。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-132">In the [*Specifying the Title, Meta Tags, and Other HTML Headers in the Master Page*](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-cs.md) tutorial we created a custom base page class named `BasePage` that automatically set the content page's title (if it was not explicitly assigned).</span></span> <span data-ttu-id="9a7b2-133">别忘了，新创建的页的代码隐藏类派生自 `BasePage` 以便它可以利用此功能。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-133">Don't forget to have the newly created page's code-behind class derive from `BasePage` so that it can utilize this functionality.</span></span>

<span data-ttu-id="9a7b2-134">创建此内容页后，解决方案资源管理器应类似于图1。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-134">After you have created this content page, your Solution Explorer should look similar to Figure 1.</span></span>

![已向项目添加了一个新文件夹和 ASP.NET 页](urls-in-master-pages-cs/_static/image1.png)

<span data-ttu-id="9a7b2-136">**图 01**：已将新文件夹和 ASP.NET 页添加到项目中</span><span class="sxs-lookup"><span data-stu-id="9a7b2-136">**Figure 01**: A New Folder and ASP.NET Page Have Been Added to the Project</span></span>

<span data-ttu-id="9a7b2-137">接下来，更新 `Web.sitemap` 文件，为本课添加新的 `<siteMapNode>` 条目。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-137">Next, update the `Web.sitemap` file to include a new `<siteMapNode>` entry for this lesson.</span></span> <span data-ttu-id="9a7b2-138">下面的 XML 演示完整的 `Web.sitemap` 标记，该标记现在包含第三个 `<siteMapNode>` 元素的加法。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-138">The following XML shows the complete `Web.sitemap` markup, which now includes the addition of a third `<siteMapNode>` element.</span></span>

[!code-xml[Main](urls-in-master-pages-cs/samples/sample3.xml)]

<span data-ttu-id="9a7b2-139">新创建的 `Default.aspx` 页应具有四个与 `Site.master`中的四个 Contentplaceholder 相对应的内容控件。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-139">The newly created `Default.aspx` page should have four Content controls corresponding to the four ContentPlaceHolders in `Site.master`.</span></span> <span data-ttu-id="9a7b2-140">向引用 `MainContent` ContentPlaceHolder 的内容控件添加一些文本，然后通过浏览器访问该页面。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-140">Add some text to the Content control referencing the `MainContent` ContentPlaceHolder and then visit the page through a browser.</span></span> <span data-ttu-id="9a7b2-141">如图2所示，浏览器找不到 `PoweredByASPNET.gif` 的图像文件。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-141">As Figure 2 shows, the browser cannot find the `PoweredByASPNET.gif` image file.</span></span> <span data-ttu-id="9a7b2-142">这是怎么回事？</span><span class="sxs-lookup"><span data-stu-id="9a7b2-142">What's going on here?</span></span>

<span data-ttu-id="9a7b2-143">与 `About.aspx` 页面一样，为 `footerContent` 区域发送 `~/Admin/Default.aspx` 内容页：</span><span class="sxs-lookup"><span data-stu-id="9a7b2-143">The `~/Admin/Default.aspx` content page is sent the same HTML for the `footerContent` region as was the `About.aspx` page:</span></span>

[!code-html[Main](urls-in-master-pages-cs/samples/sample4.html)]

<span data-ttu-id="9a7b2-144">由于 `<img>` 元素的 `src` 属性是相对 URL，因此浏览器将尝试查找相对于网页文件夹位置的 `Images` 文件夹。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-144">Because the `<img>` element's `src` attribute is a relative URL, the browser attempts to look for an `Images` folder relative to the web page's folder location.</span></span> <span data-ttu-id="9a7b2-145">换句话说，浏览器正在查找 `Admin/Images/PoweredByASPNET.gif`的图像文件。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-145">In other words, the browser is looking for the image file `Admin/Images/PoweredByASPNET.gif`.</span></span>

<span data-ttu-id="9a7b2-146">[![找不到 PoweredByASPNET 映像文件](urls-in-master-pages-cs/_static/image3.png)](urls-in-master-pages-cs/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="9a7b2-146">[![The PoweredByASPNET.gif Image File Cannot Be Found](urls-in-master-pages-cs/_static/image3.png)](urls-in-master-pages-cs/_static/image2.png)</span></span>

<span data-ttu-id="9a7b2-147">**图 02**：找不到 `PoweredByASPNET.gif` 图像文件（[单击以查看完全大小的映像](urls-in-master-pages-cs/_static/image4.png)）</span><span class="sxs-lookup"><span data-stu-id="9a7b2-147">**Figure 02**: The `PoweredByASPNET.gif` Image File Cannot Be Found  ([Click to view full-size image](urls-in-master-pages-cs/_static/image4.png))</span></span>

### <a name="replacing-relative-urls-with-absolute-urls"></a><span data-ttu-id="9a7b2-148">用绝对 Url 替换相对 Url</span><span class="sxs-lookup"><span data-stu-id="9a7b2-148">Replacing Relative URLs with Absolute URLs</span></span>

<span data-ttu-id="9a7b2-149">相对 URL 的相对 URL 是*绝对 url*，该 url 以正斜杠（`/`）或协议（如 `http://`）开头。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-149">The opposite of a relative URL is an *absolute URL*, which is one that starts with a forward slash (`/`) or a protocol such as `http://`.</span></span> <span data-ttu-id="9a7b2-150">由于绝对 URL 指定了资源在已知的固定点的位置，因此，无论网页在网站的文件夹结构中的位置如何，同一绝对 URL 在任何网页中都有效。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-150">Because an absolute URL specifies the location of a resource from a known fixed point, the same absolute URL is valid in any web page, regardless of the web page's location in the website's folder structure.</span></span>

<span data-ttu-id="9a7b2-151">若要更正图2中所示的损坏图像，需要更新 `<img>` 元素的 `src` 属性，使其使用绝对 URL 而不是相对 URL。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-151">To remedy the broken image shown in Figure 2, we need to update the `<img>` element's `src` attribute so that it uses an absolute URL instead of a relative one.</span></span> <span data-ttu-id="9a7b2-152">若要确定正确的绝对 URL，请访问网站中的网页之一，然后检查地址栏。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-152">To determine the correct absolute URL, visit one of the web pages in your website and examine the Address bar.</span></span> <span data-ttu-id="9a7b2-153">图2中的地址栏显示了 web 应用程序的完全限定路径 `http://localhost:3908/ASPNET_MasterPages_Tutorial_04_CS/`。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-153">As the Address bar in Figure 2 shows, the fully qualified path to the web application is `http://localhost:3908/ASPNET_MasterPages_Tutorial_04_CS/`.</span></span> <span data-ttu-id="9a7b2-154">因此，我们可以将 `<img>` 元素的 `src` 属性更新为以下两个绝对 Url 之一：</span><span class="sxs-lookup"><span data-stu-id="9a7b2-154">Therefore, we could update the `<img>` element's `src` attribute to either of the following two absolute URLs:</span></span>

- `/ASPNET_MasterPages_Tutorial_04_CS/Images/PoweredByASPNET.gif`
- `http://localhost:3908/ASPNET_MasterPages_Tutorial_04_CS/Images/PoweredByASPNET.gif`

<span data-ttu-id="9a7b2-155">请花点时间使用上面所示的窗体之一将 `<img>` 元素的 `src` 属性更新为绝对 URL，然后通过浏览器访问 `~/Admin/Default.aspx` 页面。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-155">Take a moment to update the `<img>` element's `src` attribute to an absolute URL using one of the forms shown above and then visit the `~/Admin/Default.aspx` page through a browser.</span></span> <span data-ttu-id="9a7b2-156">这次，浏览器将正确查找并显示 `PoweredByASPNET.gif` 图像文件（请参阅图3）。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-156">This time the browser will correctly find and display the `PoweredByASPNET.gif` image file (see Figure 3).</span></span>

<span data-ttu-id="9a7b2-157">[![PoweredByASPNET 图像现在显示](urls-in-master-pages-cs/_static/image6.png)](urls-in-master-pages-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="9a7b2-157">[![The PoweredByASPNET.gif Image is Now Displayed](urls-in-master-pages-cs/_static/image6.png)](urls-in-master-pages-cs/_static/image5.png)</span></span>

<span data-ttu-id="9a7b2-158">**图 03**：此时将显示 `PoweredByASPNET.gif` 图像（[单击以查看完全大小的图像](urls-in-master-pages-cs/_static/image7.png)）</span><span class="sxs-lookup"><span data-stu-id="9a7b2-158">**Figure 03**: The `PoweredByASPNET.gif` Image is Now Displayed  ([Click to view full-size image](urls-in-master-pages-cs/_static/image7.png))</span></span>

<span data-ttu-id="9a7b2-159">虽然绝对 URL 中的硬编码工作正常，但它会将 HTML 紧密耦合到网站的服务器和文件夹位置，这可能会发生变化。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-159">While hard coding in the absolute URL works, it tightly couples your HTML to the website's server and folder location, which may change.</span></span> <span data-ttu-id="9a7b2-160">使用形式 `http://localhost:3908/...` 的绝对 URL 为脆弱，因为每次启动 Visual Studio 的内置 ASP.NET 开发 Web 服务器时，将自动选择前面 `localhost` 的端口号。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-160">Using an absolute URL of the form `http://localhost:3908/...` is brittle because the port number preceding `localhost` is selected automatically each time Visual Studio's built-in ASP.NET Development Web Server is started.</span></span> <span data-ttu-id="9a7b2-161">同样，`http://localhost` 部分仅在本地测试时才有效。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-161">Similarly, the `http://localhost` part is only valid when testing locally.</span></span> <span data-ttu-id="9a7b2-162">将代码部署到生产服务器后，URL 基准将更改为其他内容，如 `http://www.yourserver.com`。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-162">Once the code is deployed to a production server, the URL base will change to something else, like `http://www.yourserver.com`.</span></span> <span data-ttu-id="9a7b2-163">格式 `/ASPNET_MasterPages_Tutorial_04_CS/...` 的绝对 URL 也会受到相同的易受攻击，因为这种应用程序的路径在开发和生产服务器之间是不同的。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-163">The absolute URL in the form `/ASPNET_MasterPages_Tutorial_04_CS/...` also suffers from the same brittleness because oftentimes this application path differs between development and production servers.</span></span>

<span data-ttu-id="9a7b2-164">好消息是，ASP.NET 提供了一个方法，用于在运行时生成有效的相对 URL。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-164">The good news is that ASP.NET offers a method for generating a valid relative URL at runtime.</span></span>

## <a name="usingandresolveclienturl"></a><span data-ttu-id="9a7b2-165">使用`~`和`ResolveClientUrl`</span><span class="sxs-lookup"><span data-stu-id="9a7b2-165">Using`~`and`ResolveClientUrl`</span></span>

<span data-ttu-id="9a7b2-166">ASP.NET 使页面开发人员可以使用波形符（`~`）指示 web 应用程序的根，而不是硬编码为绝对 URL。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-166">Rather than hard code an absolute URL, ASP.NET allows page developers to use the tilde (`~`) to indicate the root of the web application.</span></span> <span data-ttu-id="9a7b2-167">例如，在本教程的前面部分，我使用了文本中的表示法 `~/Admin/Default.aspx` 引用 `Admin` 文件夹中的 `Default.aspx` 页。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-167">For example, earlier in this tutorial I used the notation `~/Admin/Default.aspx` in the text to refer to the `Default.aspx` page in the `Admin` folder.</span></span> <span data-ttu-id="9a7b2-168">`~` 指示 `Admin` 文件夹是 web 应用程序的根的子文件夹。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-168">The `~` indicates that the `Admin` folder is a subfolder of the web application's root.</span></span>

<span data-ttu-id="9a7b2-169">`Control` 类的[`ResolveClientUrl` 方法](https://msdn.microsoft.com/library/system.web.ui.control.resolveclienturl.aspx)采用 URL，并将其修改为适用于控件所在网页的相对 URL。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-169">The `Control` class's [`ResolveClientUrl` method](https://msdn.microsoft.com/library/system.web.ui.control.resolveclienturl.aspx) takes a URL and modifies it to a relative URL appropriate for the web page on which the control resides.</span></span> <span data-ttu-id="9a7b2-170">例如，从 `About.aspx` 调用 `ResolveClientUrl("~/Images/PoweredByASPNET.gif")` 会返回 `Images/PoweredByASPNET.gif`。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-170">For example, calling `ResolveClientUrl("~/Images/PoweredByASPNET.gif")` from `About.aspx` returns `Images/PoweredByASPNET.gif`.</span></span> <span data-ttu-id="9a7b2-171">但从 `~/Admin/Default.aspx`调用它将返回 `./Images/PoweredByASPNET.gif`。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-171">Calling it from `~/Admin/Default.aspx`, however, returns `../Images/PoweredByASPNET.gif`.</span></span>

> [!NOTE]
> <span data-ttu-id="9a7b2-172">由于所有 ASP.NET 服务器控件都派生自 `Control` 类，因此所有服务器控件都有权访问 `ResolveClientUrl` 方法。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-172">Because all ASP.NET server controls derive from the `Control` class, all server controls have access to the `ResolveClientUrl` method.</span></span> <span data-ttu-id="9a7b2-173">即使 `Page` 类派生自 `Control` 类，这意味着你可以直接从 ASP.NET 页面的代码隐藏类使用此方法。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-173">Even the `Page` class derives from the `Control` class, meaning that you can use this method directly from your ASP.NET pages' code-behind classes.</span></span>

### <a name="usingin-the-declarative-markup"></a><span data-ttu-id="9a7b2-174">在声明性标记中使用`~`</span><span class="sxs-lookup"><span data-stu-id="9a7b2-174">Using`~`in the Declarative Markup</span></span>

<span data-ttu-id="9a7b2-175">几个 ASP.NET Web 控件包括 URL 相关的属性： HyperLink 控件具有 `NavigateUrl` 属性;图像控件具有 `ImageUrl` 属性;依此类推。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-175">Several ASP.NET Web controls include URL-related properties: the HyperLink control has a `NavigateUrl` property; the Image control has an `ImageUrl` property; and so on.</span></span> <span data-ttu-id="9a7b2-176">呈现时，这些控件将与 URL 相关的属性值传递到 `ResolveClientUrl`。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-176">When rendered, these controls pass their URL-related property values to `ResolveClientUrl`.</span></span> <span data-ttu-id="9a7b2-177">因此，如果这些属性包含用于指示 web 应用程序的根的 `~`，则 URL 将修改为有效的相对 URL。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-177">Consequently, if these properties contain a `~` to indicate the root of the web application, the URL will be modified to a valid relative URL.</span></span>

<span data-ttu-id="9a7b2-178">请记住，只有 ASP.NET 服务器控件才能转换其 URL 相关属性中的 `~`。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-178">Keep in mind that only ASP.NET server controls transform the `~` in their URL-related properties.</span></span> <span data-ttu-id="9a7b2-179">如果 `~` 出现在静态 HTML 标记中，如 `<img src="~/Images/PoweredByASPNET.gif" />`，则 ASP.NET 引擎会将 `~` 连同 HTML 内容的其余部分一起发送到浏览器。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-179">If a `~` appears in static HTML markup, such as `<img src="~/Images/PoweredByASPNET.gif" />`, the ASP.NET engine sends the `~` to the browser along with the rest of the HTML content.</span></span> <span data-ttu-id="9a7b2-180">浏览器假定 `~` 是 URL 的一部分。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-180">The browser assumes that the `~` is part of the URL.</span></span> <span data-ttu-id="9a7b2-181">例如，如果浏览器收到标记 `<img src="~/Images/PoweredByASPNET.gif" />` 它假定存在一个名为 `~` 的子文件夹，该子文件夹 `Images` 包含图像文件 `PoweredByASPNET.gif`。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-181">For example, if the browser receives the markup `<img src="~/Images/PoweredByASPNET.gif" />` it assumes there is a subfolder named `~` with a subfolder `Images` that contains the image file `PoweredByASPNET.gif`.</span></span>

<span data-ttu-id="9a7b2-182">若要修复 `Site.master`中的图像标记，请使用 ASP.NET 图像 Web 控件替换现有的 `<img>` 元素。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-182">To fix the image markup in `Site.master`, replace the existing `<img>` element with an ASP.NET Image Web control.</span></span> <span data-ttu-id="9a7b2-183">将图像 Web 控件的 `ID` 设置为 `PoweredByImage`，其 `ImageUrl` 属性设置为 `~/Images/PoweredByASPNET.gif`，并将其 `AlternateText` 属性设置为 "ASP.NET！"</span><span class="sxs-lookup"><span data-stu-id="9a7b2-183">Set the Image Web control's `ID` to `PoweredByImage`, its `ImageUrl` property to `~/Images/PoweredByASPNET.gif`, and its `AlternateText` property to "Powered by ASP.NET!"</span></span>

[!code-aspx[Main](urls-in-master-pages-cs/samples/sample5.aspx)]

<span data-ttu-id="9a7b2-184">对母版页进行此更改后，再次重新访问 `~/Admin/Default.aspx` 页。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-184">After making this change to the master page, revisit the `~/Admin/Default.aspx` page again.</span></span> <span data-ttu-id="9a7b2-185">这次 `PoweredByASPNET.gif` 图像文件将显示在页面中（请参阅图3）。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-185">This time the `PoweredByASPNET.gif` image file appears in the page (see Figure 3).</span></span> <span data-ttu-id="9a7b2-186">呈现图像 Web 控件时，将使用 `ResolveClientUrl` 方法解析其 `ImageUrl` 属性值。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-186">When the Image Web control is rendered it uses the `ResolveClientUrl` method to resolve its `ImageUrl` property value.</span></span> <span data-ttu-id="9a7b2-187">在 `~/Admin/Default.aspx` 会将 `ImageUrl` 转换为相应的相对 URL，如 HTML 源的以下代码片段所示：</span><span class="sxs-lookup"><span data-stu-id="9a7b2-187">In `~/Admin/Default.aspx` the `ImageUrl` is converted into an appropriate relative URL, as the following snippet of HTML source shows:</span></span>

[!code-html[Main](urls-in-master-pages-cs/samples/sample6.html)]

> [!NOTE]
> <span data-ttu-id="9a7b2-188">除了在基于 URL 的 Web 控件属性中使用以外，还可以在调用 `Response.Redirect` 和 `Server.MapPath` 方法时使用 `~`。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-188">In addition to being used in URL-based Web control properties, the `~` can also be used when calling the `Response.Redirect` and `Server.MapPath` methods, among others.</span></span> <span data-ttu-id="9a7b2-189">此外，如果需要，还可以从 ASP.NET 或母版页的声明性标记中直接调用 `ResolveClientUrl` 方法;请参阅[Fritz 绘图纸](https://www.pluralsight.com/blogs/fritz/)的博客文章[，使用标记中的 `ResolveClientUrl`](https://www.pluralsight.com/blogs/fritz/archive/2006/02/06/18596.aspx)。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-189">Also, the `ResolveClientUrl` method may be invoked directly from an ASP.NET or master page's declarative markup, if needed; see [Fritz Onion](https://www.pluralsight.com/blogs/fritz/)'s blog entry [Using `ResolveClientUrl` in Markup](https://www.pluralsight.com/blogs/fritz/archive/2006/02/06/18596.aspx).</span></span>

## <a name="fixing-the-master-pages-remaining-relative-urls"></a><span data-ttu-id="9a7b2-190">修复母版页的其余相对 Url</span><span class="sxs-lookup"><span data-stu-id="9a7b2-190">Fixing the Master Page's Remaining Relative URLs</span></span>

<span data-ttu-id="9a7b2-191">除了我们刚刚修复的 `footerContent` 中的 `<img>` 元素外，母版页包含一个需要我们注意的相对 URL。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-191">In addition to the `<img>` element in the `footerContent` that we just fixed, the master page contains one more relative URL that requires our attention.</span></span> <span data-ttu-id="9a7b2-192">`topContent` 区域包括指向 `Default.aspx`的链接 "母版页教程"。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-192">The `topContent` region includes the link "Master Pages Tutorials," which points to `Default.aspx`.</span></span>

[!code-html[Main](urls-in-master-pages-cs/samples/sample7.html)]

<span data-ttu-id="9a7b2-193">由于此 URL 是相对的，因此它会将用户发送到他们所访问的内容页文件夹中的 "`Default.aspx`" 页。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-193">Because this URL is relative, it will send the user to the `Default.aspx` page in the folder of the content page they are visiting.</span></span> <span data-ttu-id="9a7b2-194">若要使此链接始终指向根文件夹中的 `Default.aspx`，需要将 `<a>` 元素替换为超链接 Web 控件，以便我们可以使用 `~` 表示法。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-194">To have this link always point to `Default.aspx` in the root folder we need to replace the `<a>` element with a HyperLink Web control so that we can use the `~` notation.</span></span>

<span data-ttu-id="9a7b2-195">删除 `<a>` 元素标记并在其位置添加超链接控件。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-195">Remove the `<a>` element markup and add a HyperLink control in its place.</span></span> <span data-ttu-id="9a7b2-196">将超链接的 `ID` 设置为 `lnkHome`，其 `NavigateUrl` 属性设置为 `~/Default.aspx`，并将其 `Text` 属性设置为 "母版页教程"。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-196">Set the HyperLink's `ID` to `lnkHome`, its `NavigateUrl` property to `~/Default.aspx`, and its `Text` property to "Master Pages Tutorials."</span></span>

[!code-aspx[Main](urls-in-master-pages-cs/samples/sample8.aspx)]

<span data-ttu-id="9a7b2-197">就是这样简单！</span><span class="sxs-lookup"><span data-stu-id="9a7b2-197">That's it!</span></span> <span data-ttu-id="9a7b2-198">此时，无论母版页和内容页面位于哪个文件夹，都可以根据内容页面呈现母版页中的所有 Url。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-198">At this point all the URLs in our master page are properly based when rendered by a content page regardless of what folders the master page and content page are located in.</span></span>

### <a name="automatic-url-resolution-in-theheadsection"></a><span data-ttu-id="9a7b2-199">`<head>`部分中的自动 URL 解析</span><span class="sxs-lookup"><span data-stu-id="9a7b2-199">Automatic URL Resolution in the`<head>`Section</span></span>

<span data-ttu-id="9a7b2-200">在[*使用母版页创建站点范围布局*](creating-a-site-wide-layout-using-master-pages-cs.md)教程中，我们在 `<head>` 区域中的 `Styles.css` 文件中添加了 `<link>`：</span><span class="sxs-lookup"><span data-stu-id="9a7b2-200">In the [*Creating a Site-Wide Layout Using Master Pages*](creating-a-site-wide-layout-using-master-pages-cs.md) tutorial we added a `<link>` to the `Styles.css` file in the `<head>` region:</span></span>

[!code-aspx[Main](urls-in-master-pages-cs/samples/sample9.aspx)]

<span data-ttu-id="9a7b2-201">虽然 `<link>` 元素的 `href` 属性是相对的，但它会在运行时自动转换为相应的路径。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-201">While the `<link>` element's `href` attribute is relative, it's automatically converted to an appropriate path at runtime.</span></span> <span data-ttu-id="9a7b2-202">正如我们在母版页教程中[*指定标题、元标记和其他 HTML 标题*](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-cs.md)中所述，`<head>` 区域实际上是服务器端控件，它使其能够在呈现时修改其内部控件的内容。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-202">As we discussed in the [*Specifying the Title, Meta Tags, and Other HTML Headers in the Master Page*](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-cs.md) tutorial, the `<head>` region is actually a server-side control, which enables it to modify the contents of its inner controls when it is rendered.</span></span>

<span data-ttu-id="9a7b2-203">若要验证这一点，请重新访问 `~/Admin/Default.aspx` 页面，并查看发送到浏览器的 HTML 源。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-203">To verify this, revisit the `~/Admin/Default.aspx` page and view the HTML source sent to the browser.</span></span> <span data-ttu-id="9a7b2-204">如下面的代码段所示，`<link>` 元素的 `href` 属性已自动修改为适当的相对 URL，`./Styles.css`。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-204">As the snippet below illustrates, the `<link>` element's `href` attribute has been automatically modified to an appropriate relative URL, `../Styles.css`.</span></span>

[!code-html[Main](urls-in-master-pages-cs/samples/sample10.html)]

## <a name="summary"></a><span data-ttu-id="9a7b2-205">总结</span><span class="sxs-lookup"><span data-stu-id="9a7b2-205">Summary</span></span>

<span data-ttu-id="9a7b2-206">母版页通常包含链接、图像和其他必须通过 URL 指定的外部资源。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-206">Master pages very often include links, images, and other external resources that must be specified via a URL.</span></span> <span data-ttu-id="9a7b2-207">由于同一文件夹中可能不存在母版页和内容页，因此 abstain 使用相对 Url 很重要。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-207">Because the master page and content pages might not exist in the same folder, it is important to abstain from using relative URLs.</span></span> <span data-ttu-id="9a7b2-208">尽管可以使用硬编码的绝对 Url，但这样做会将绝对 URL 紧密耦合到 web 应用程序。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-208">While it is possible to use hard coded absolute URLs, doing so tightly couples the absolute URL to the web application.</span></span> <span data-ttu-id="9a7b2-209">如果绝对 URL 发生更改，则在移动或部署 web 应用程序时通常会发生更改-您必须记得返回并更新绝对 Url。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-209">If the absolute URL changes - as it often does when moving or deploying a web application - you'll have to remember to go back and update the absolute URLs.</span></span>

<span data-ttu-id="9a7b2-210">理想的方法是使用波形符（`~`）来指示应用程序根目录。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-210">The ideal approach is to use the tilde (`~`) to indicate the application root.</span></span> <span data-ttu-id="9a7b2-211">包含与 URL 相关的属性的 ASP.NET Web 控件在运行时将 `~` 映射到应用程序根目录。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-211">ASP.NET Web controls that contain URL-related properties map the `~` to the application root at runtime.</span></span> <span data-ttu-id="9a7b2-212">在内部，Web 控件使用 `Control` 类的 `ResolveClientUrl` 方法来生成有效的相对 URL。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-212">Internally, the Web controls use the `Control` class's `ResolveClientUrl` method to generate a valid relative URL.</span></span> <span data-ttu-id="9a7b2-213">此方法是公共的，可从每个服务器控件（包括 `Page` 类）使用，因此，如果需要，你可以从代码隐藏类以编程方式使用它。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-213">This method is public and available from every server control (including the `Page` class), so you can use it programmatically from your code-behind classes, if needed.</span></span>

<span data-ttu-id="9a7b2-214">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="9a7b2-214">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="9a7b2-215">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="9a7b2-215">Further Reading</span></span>

<span data-ttu-id="9a7b2-216">有关本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="9a7b2-216">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="9a7b2-217">ASP.NET 中的母版页</span><span class="sxs-lookup"><span data-stu-id="9a7b2-217">Master Pages in ASP.NET</span></span>](http://www.odetocode.com/Articles/419.aspx)
- [<span data-ttu-id="9a7b2-218">母版页中的 URL 变基</span><span class="sxs-lookup"><span data-stu-id="9a7b2-218">URL Rebasing in a Master Page</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/masterpages/default.aspx#urls)
- [<span data-ttu-id="9a7b2-219">在标记中使用 `ResolveClientUrl`</span><span class="sxs-lookup"><span data-stu-id="9a7b2-219">Using `ResolveClientUrl` in Markup</span></span>](https://www.pluralsight.com/blogs/fritz/archive/2006/02/06/18596.aspx)

### <a name="about-the-author"></a><span data-ttu-id="9a7b2-220">关于作者</span><span class="sxs-lookup"><span data-stu-id="9a7b2-220">About the Author</span></span>

<span data-ttu-id="9a7b2-221">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，创始人的多个 ASP/asp 和4GuysFromRolla.com 的作者已使用 Microsoft Web 技术，1998。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-221">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="9a7b2-222">Scott 的工作方式是独立的顾问、培训师和撰稿人。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-222">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="9a7b2-223">他的最新书籍是，[*在24小时内，sam ASP.NET 3.5*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-223">His latest book is [*Sams Teach Yourself ASP.NET 3.5 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="9a7b2-224">可以通过[http://ScottOnWriting.NET](http://scottonwriting.net/) [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)或通过他的博客访问 Scott。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-224">Scott can be reached at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="9a7b2-225">特别感谢</span><span class="sxs-lookup"><span data-stu-id="9a7b2-225">Special Thanks To</span></span>

<span data-ttu-id="9a7b2-226">想要查看我即将发布的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="9a7b2-226">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="9a7b2-227">如果是这样，请在[mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)放置一行。</span><span class="sxs-lookup"><span data-stu-id="9a7b2-227">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="9a7b2-228">[上一页](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-cs.md)
> [下一页](control-id-naming-in-content-pages-cs.md)</span><span class="sxs-lookup"><span data-stu-id="9a7b2-228">[Previous](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-cs.md)
[Next](control-id-naming-in-content-pages-cs.md)</span></span>
