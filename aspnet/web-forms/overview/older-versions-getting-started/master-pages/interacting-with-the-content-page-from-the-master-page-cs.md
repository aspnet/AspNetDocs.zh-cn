---
uid: web-forms/overview/older-versions-getting-started/master-pages/interacting-with-the-content-page-from-the-master-page-cs
title: 与母版页（C#）中的内容页交互 |Microsoft Docs
author: rick-anderson
description: 检查如何从母版页中的代码调用内容页的方法、设置属性等。
ms.author: riande
ms.date: 07/11/2008
ms.assetid: 3282df5e-516c-4972-8666-313828b90fb5
msc.legacyurl: /web-forms/overview/older-versions-getting-started/master-pages/interacting-with-the-content-page-from-the-master-page-cs
msc.type: authoredcontent
ms.openlocfilehash: 2cf57665aa584285351d874267949d61db69c7fc
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/06/2020
ms.locfileid: "78501164"
---
# <a name="interacting-with-the-content-page-from-the-master-page-c"></a><span data-ttu-id="6ea5c-103">从母版页与内容页交互 (C#)</span><span class="sxs-lookup"><span data-stu-id="6ea5c-103">Interacting with the Content Page from the Master Page (C#)</span></span>

<span data-ttu-id="6ea5c-104">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="6ea5c-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="6ea5c-105">[下载代码](https://download.microsoft.com/download/1/8/4/184e24fa-fcc8-47fa-ac99-4b6a52d41e97/ASPNET_MasterPages_Tutorial_07_CS.zip)或[下载 PDF](https://download.microsoft.com/download/e/b/4/eb4abb10-c416-4ba4-9899-32577715b1bd/ASPNET_MasterPages_Tutorial_07_CS.pdf)</span><span class="sxs-lookup"><span data-stu-id="6ea5c-105">[Download Code](https://download.microsoft.com/download/1/8/4/184e24fa-fcc8-47fa-ac99-4b6a52d41e97/ASPNET_MasterPages_Tutorial_07_CS.zip) or [Download PDF](https://download.microsoft.com/download/e/b/4/eb4abb10-c416-4ba4-9899-32577715b1bd/ASPNET_MasterPages_Tutorial_07_CS.pdf)</span></span>

> <span data-ttu-id="6ea5c-106">检查如何从母版页中的代码调用内容页的方法、设置属性等。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-106">Examines how to call methods, set properties, etc. of the Content Page from code in the Master Page.</span></span>

## <a name="introduction"></a><span data-ttu-id="6ea5c-107">简介</span><span class="sxs-lookup"><span data-stu-id="6ea5c-107">Introduction</span></span>

<span data-ttu-id="6ea5c-108">前面的教程介绍了如何使内容页以编程方式与母版页交互。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-108">The preceding tutorial examined how to have the content page programmatically interact with its master page.</span></span> <span data-ttu-id="6ea5c-109">回忆一下，我们已将母版页更新为包含一个 GridView 控件，该控件列出了五个最近添加的产品。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-109">Recall that we updated the master page to include a GridView control that listed the five most recently added products.</span></span> <span data-ttu-id="6ea5c-110">然后，我们创建了一个内容页面，用户可在其中添加新产品。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-110">We then created a content page from which the user could add a new product.</span></span> <span data-ttu-id="6ea5c-111">添加新产品后，需指导母版页刷新其 GridView，使其包含刚添加的产品。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-111">Upon adding a new product, the content page needed to instruct the master page to refresh its GridView so that it would include the just-added product.</span></span> <span data-ttu-id="6ea5c-112">此功能的实现方法是：向母版页添加一个公共方法，该母版页刷新绑定到 GridView 的数据，然后从内容页中调用该方法。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-112">This functionality was accomplished by adding a public method to the master page that refreshed the data bound to the GridView, and then invoking that method from the content page.</span></span>

<span data-ttu-id="6ea5c-113">最常见的内容和母版页交互形式源自内容页。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-113">The most common form of content and master page interaction originates from the content page.</span></span> <span data-ttu-id="6ea5c-114">不过，母版页可能会将当前内容页 rouse 到操作中，如果母版页包含允许用户修改也显示在内容页上的数据的用户界面元素，则可能需要此类功能。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-114">However, it is possible for the master page to rouse the current content page into action, and such functionality may be needed if the master page contains user interface elements that enable users to modify data that is also displayed on the content page.</span></span> <span data-ttu-id="6ea5c-115">请考虑一个显示 GridView 控件中的产品信息的内容页，以及一个包含按钮控件的母版页，单击该按钮可将所有产品的价格加倍。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-115">Consider a content page that displays the products information in a GridView control and a master page that includes a Button control that, when clicked, doubles the prices of all products.</span></span> <span data-ttu-id="6ea5c-116">与上一教程中的示例非常类似，单击 "双重价格" 按钮后需要刷新 GridView，以便显示新的价格，但在此方案中，它是需要将内容页 rouse 到操作中的母版页。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-116">Much like the example in the preceding tutorial, the GridView needs to be refreshed after the double price Button is clicked so that it displays the new prices, but in this scenario it's the master page that needs to rouse the content page into action.</span></span>

<span data-ttu-id="6ea5c-117">本教程将探讨如何在 "内容" 页中定义母版页调用功能。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-117">This tutorial explores how to have the master page invoke functionality defined in the content page.</span></span>

### <a name="instigating-programmatic-interaction-via-an-event-and-event-handlers"></a><span data-ttu-id="6ea5c-118">通过事件和事件处理程序进行的 Instigating 编程交互</span><span class="sxs-lookup"><span data-stu-id="6ea5c-118">Instigating Programmatic Interaction via an Event and Event Handlers</span></span>

<span data-ttu-id="6ea5c-119">从母版页调用内容页功能比另一种方法更具挑战性。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-119">Invoking content page functionality from a master page is more challenging than the other way around.</span></span> <span data-ttu-id="6ea5c-120">由于内容页有一个母版页，因此当 instigating 从内容页进行编程交互时，我们知道哪些公共方法和属性是我们的处置方法。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-120">Because a content page has a single master page, when instigating the programmatic interaction from the content page we know what public methods and properties are at our disposal.</span></span> <span data-ttu-id="6ea5c-121">但是，母版页可以有许多不同的内容页，每个内容页都具有自己的一组属性和方法。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-121">A master page, however, can have many different content pages, each with its own set of properties and methods.</span></span> <span data-ttu-id="6ea5c-122">接下来，我们如何在母版页中编写代码，以在其内容页中执行某些操作，而在运行时之前不知道将调用哪个内容页？</span><span class="sxs-lookup"><span data-stu-id="6ea5c-122">How, then, can we write code in the master page to perform some action in its content page when we don't know what content page will be invoked until runtime?</span></span>

<span data-ttu-id="6ea5c-123">假设有一个 ASP.NET 的 Web 控件，如 Button 控件。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-123">Consider an ASP.NET Web control, such as the Button control.</span></span> <span data-ttu-id="6ea5c-124">按钮控件可以出现在任意数量的 ASP.NET 页面上并需要一种机制，通过该机制可以向页面发出警报。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-124">A Button control can appear on any number of ASP.NET pages and needs a mechanism by which it can alert the page that it has been clicked.</span></span> <span data-ttu-id="6ea5c-125">这是使用*事件*实现的。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-125">This is accomplished using *events*.</span></span> <span data-ttu-id="6ea5c-126">特别是，按钮控件在被单击时引发其 `Click` 事件;包含按钮的 "ASP.NET" 页可以选择通过*事件处理程序*来响应该通知。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-126">In particular, the Button control raises its `Click` event when it is clicked; the ASP.NET page that contains the Button can optionally respond to that notification via an *event handler*.</span></span>

<span data-ttu-id="6ea5c-127">此相同模式可用于在其内容页中拥有母版页触发器功能：</span><span class="sxs-lookup"><span data-stu-id="6ea5c-127">This same pattern can be used to have a master page trigger functionality in its content pages:</span></span>

1. <span data-ttu-id="6ea5c-128">向母版页添加一个事件。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-128">Add an event to the master page.</span></span>
2. <span data-ttu-id="6ea5c-129">每当母版页需要与其内容页通信时，引发事件。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-129">Raise the event whenever the master page needs to communicate with its content page.</span></span> <span data-ttu-id="6ea5c-130">例如，如果母版页需要提醒其内容页，用户已将价格增加了一倍，则在双倍价格后会立即引发事件。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-130">For example, if the master page needs to alert its content page that the user has doubled the prices, its event would be raised immediately after the prices have been doubled.</span></span>
3. <span data-ttu-id="6ea5c-131">在需要采取某种操作的内容页中创建事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-131">Create an event handler in those content pages that need to take some action.</span></span>

<span data-ttu-id="6ea5c-132">本教程的其余部分将实现简介中概述的示例;这是一个内容页，其中列出了数据库中的产品和一个母版页，其中包含一个按钮控件来使价格翻倍。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-132">This remainder of this tutorial implements the example outlined in the Introduction; namely, a content page that lists the products in the database and a master page that includes a Button control to double the prices.</span></span>

## <a name="step-1-displaying-products-in-a-content-page"></a><span data-ttu-id="6ea5c-133">步骤1：在内容页中显示产品</span><span class="sxs-lookup"><span data-stu-id="6ea5c-133">Step 1: Displaying Products in a Content Page</span></span>

<span data-ttu-id="6ea5c-134">我们的第一个业务顺序是创建一个内容页，该页面列出 Northwind 数据库中的产品。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-134">Our first order of business is to create a content page that lists the products from the Northwind database.</span></span> <span data-ttu-id="6ea5c-135">（我们将 Northwind 数据库添加到了前面教程中的项目，[*与内容页中的母版页交互*](interacting-with-the-master-page-from-the-content-page-cs.md)。）首先将新的 ASP.NET 页面添加到名为 `Products.aspx`的 `~/Admin` 文件夹中，并确保将其绑定到 `Site.master` 母版页。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-135">(We added the Northwind database to the project in the preceding tutorial, [*Interacting with the Master Page from the Content Page*](interacting-with-the-master-page-from-the-content-page-cs.md).) Start by adding a new ASP.NET page to the `~/Admin` folder named `Products.aspx`, making sure to bind it to the `Site.master` master page.</span></span> <span data-ttu-id="6ea5c-136">图1显示了将此页面添加到网站后解决方案资源管理器。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-136">Figure 1 shows the Solution Explorer after this page has been added to the website.</span></span>

<span data-ttu-id="6ea5c-137">[![将新的 ASP.NET 页面添加到管理文件夹](interacting-with-the-content-page-from-the-master-page-cs/_static/image2.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="6ea5c-137">[![Add a New ASP.NET Page to the Admin Folder](interacting-with-the-content-page-from-the-master-page-cs/_static/image2.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image1.png)</span></span>

<span data-ttu-id="6ea5c-138">**图 01**：将新的 "ASP.NET" 页添加到 `Admin` 文件夹（[单击查看完全大小的图像](interacting-with-the-content-page-from-the-master-page-cs/_static/image3.png)）</span><span class="sxs-lookup"><span data-stu-id="6ea5c-138">**Figure 01**: Add a New ASP.NET Page to the `Admin` Folder ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image3.png))</span></span>

<span data-ttu-id="6ea5c-139">请记住，在[*母版页教程中指定标题、Meta 标记和其他 HTML 标头*](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-cs.md)时，我们创建了一个名为 `BasePage` 的自定义基类类，如果未显式设置该页面的标题，则生成该页面的标题。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-139">Recall that in the [*Specifying the Title, Meta Tags, and Other HTML Headers in the Master Page*](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-cs.md) tutorial we created a custom base page class named `BasePage` that generates the page's title if it is not explicitly set.</span></span> <span data-ttu-id="6ea5c-140">转到 "`Products.aspx`" 页的代码隐藏类，并使其从 `BasePage` （而不是从 `System.Web.UI.Page`）派生。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-140">Go to the `Products.aspx` page's code-behind class and have it derive from `BasePage` (instead of from `System.Web.UI.Page`).</span></span>

<span data-ttu-id="6ea5c-141">最后，更新 `Web.sitemap` 文件以包含本课中的条目。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-141">Finally, update the `Web.sitemap` file to include an entry for this lesson.</span></span> <span data-ttu-id="6ea5c-142">将以下标记添加到内容到母版页交互课程的 `<siteMapNode>` 下面：</span><span class="sxs-lookup"><span data-stu-id="6ea5c-142">Add the following markup beneath the `<siteMapNode>` for the Content to Master Page Interaction lesson:</span></span>

[!code-xml[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample1.xml)]

<span data-ttu-id="6ea5c-143">此 `<siteMapNode>` 元素的添加将反映在课程列表中（见图5）。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-143">The addition of this `<siteMapNode>` element is reflected in the Lessons list (see Figure 5).</span></span>

<span data-ttu-id="6ea5c-144">返回 `Products.aspx`。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-144">Return to `Products.aspx`.</span></span> <span data-ttu-id="6ea5c-145">在 `MainContent`的内容控件中，添加 GridView 控件并将其命名为 `ProductsGrid`。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-145">In the Content control for `MainContent`, add a GridView control and name it `ProductsGrid`.</span></span> <span data-ttu-id="6ea5c-146">将 GridView 绑定到名为 `ProductsDataSource`的新 SqlDataSource 控件。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-146">Bind the GridView to a new SqlDataSource control named `ProductsDataSource`.</span></span>

<span data-ttu-id="6ea5c-147">[![将 GridView 绑定到新的 SqlDataSource 控件](interacting-with-the-content-page-from-the-master-page-cs/_static/image5.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="6ea5c-147">[![Bind the GridView to a New SqlDataSource Control](interacting-with-the-content-page-from-the-master-page-cs/_static/image5.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image4.png)</span></span>

<span data-ttu-id="6ea5c-148">**图 02**：将 GridView 绑定到新的 SqlDataSource 控件（[单击以查看完全大小的图像](interacting-with-the-content-page-from-the-master-page-cs/_static/image6.png)）</span><span class="sxs-lookup"><span data-stu-id="6ea5c-148">**Figure 02**: Bind the GridView to a New SqlDataSource Control  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image6.png))</span></span>

<span data-ttu-id="6ea5c-149">将向导配置为使用 Northwind 数据库。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-149">Configure the wizard so that it uses the Northwind database.</span></span> <span data-ttu-id="6ea5c-150">如果已完成上述教程，则在 `Web.config`中应该已经有一个名为 `NorthwindConnectionString` 的连接字符串。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-150">If you worked through the previous tutorial then you should already have a connection string named `NorthwindConnectionString` in `Web.config`.</span></span> <span data-ttu-id="6ea5c-151">从下拉列表中选择此连接字符串，如图3所示。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-151">Choose this connection string from the drop-down list, as shown in Figure 3.</span></span>

<span data-ttu-id="6ea5c-152">[![将 SqlDataSource 配置为使用 Northwind 数据库](interacting-with-the-content-page-from-the-master-page-cs/_static/image8.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="6ea5c-152">[![Configure the SqlDataSource to Use the Northwind Database](interacting-with-the-content-page-from-the-master-page-cs/_static/image8.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image7.png)</span></span>

<span data-ttu-id="6ea5c-153">**图 03**：将 SqlDataSource 配置为使用 Northwind 数据库（[单击查看完全大小的映像](interacting-with-the-content-page-from-the-master-page-cs/_static/image9.png)）</span><span class="sxs-lookup"><span data-stu-id="6ea5c-153">**Figure 03**: Configure the SqlDataSource to Use the Northwind Database  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image9.png))</span></span>

<span data-ttu-id="6ea5c-154">接下来，通过从下拉列表中选择 Products 表并返回 `ProductName` 和 `UnitPrice` 列来指定数据源控件的 `SELECT` 语句（参见图4）。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-154">Next, specify the data source control's `SELECT` statement by choosing the Products table from the drop-down list and returning the `ProductName` and `UnitPrice` columns (see Figure 4).</span></span> <span data-ttu-id="6ea5c-155">单击 "下一步"，然后单击 "完成" 完成配置数据源向导。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-155">Click Next and then Finish to complete the Configure Data Source wizard.</span></span>

<span data-ttu-id="6ea5c-156">[![从 Products 表中返回 "ProductName" 和 "单价" 字段](interacting-with-the-content-page-from-the-master-page-cs/_static/image11.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="6ea5c-156">[![Return the ProductName and UnitPrice Fields from the Products Table](interacting-with-the-content-page-from-the-master-page-cs/_static/image11.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image10.png)</span></span>

<span data-ttu-id="6ea5c-157">**图 04**：返回 `Products` 表中的 "`ProductName`" 和 "`UnitPrice`" 字段（[单击以查看完全大小的图像](interacting-with-the-content-page-from-the-master-page-cs/_static/image12.png)）</span><span class="sxs-lookup"><span data-stu-id="6ea5c-157">**Figure 04**: Return the `ProductName` and `UnitPrice` Fields from the `Products` Table  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image12.png))</span></span>

<span data-ttu-id="6ea5c-158">就这么简单！</span><span class="sxs-lookup"><span data-stu-id="6ea5c-158">That's all there is to it!</span></span> <span data-ttu-id="6ea5c-159">完成向导后，Visual Studio 会将两个 BoundFields 添加到 GridView，以反映 SqlDataSource 控件返回的两个字段。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-159">After completing the wizard Visual Studio adds two BoundFields to the GridView to mirror the two fields returned by the SqlDataSource control.</span></span> <span data-ttu-id="6ea5c-160">GridView 和 SqlDataSource 控件的标记如下所示。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-160">The GridView and SqlDataSource controls' markup follows.</span></span> <span data-ttu-id="6ea5c-161">图5显示了通过浏览器查看的结果。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-161">Figure 5 shows the results when viewed through a browser.</span></span>

[!code-aspx[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample2.aspx)]

<span data-ttu-id="6ea5c-162">[GridView 中列出了每个产品及其价格 ![](interacting-with-the-content-page-from-the-master-page-cs/_static/image14.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="6ea5c-162">[![Each Product and its Price is Listed in the GridView](interacting-with-the-content-page-from-the-master-page-cs/_static/image14.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image13.png)</span></span>

<span data-ttu-id="6ea5c-163">**图 05**：在 GridView 中列出了每个产品及其价格（[单击查看完全大小的图像](interacting-with-the-content-page-from-the-master-page-cs/_static/image15.png)）</span><span class="sxs-lookup"><span data-stu-id="6ea5c-163">**Figure 05**: Each Product and its Price is Listed in the GridView  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image15.png))</span></span>

> [!NOTE]
> <span data-ttu-id="6ea5c-164">随意清理 GridView 的外观。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-164">Feel free to clean up the appearance of the GridView.</span></span> <span data-ttu-id="6ea5c-165">某些建议包括将显示的 "单价" 值的格式设置为货币，并使用背景色和字体来改善网格的外观。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-165">Some suggestions include formatting the displayed UnitPrice value as a currency and using background colors and fonts to improve the grid's appearance.</span></span> <span data-ttu-id="6ea5c-166">有关在 ASP.NET 中显示和格式化数据的详细信息，请参阅[使用数据教程系列](../../data-access/index.md)。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-166">For more information on displaying and formatting data in ASP.NET, refer to my [Working with Data tutorial series](../../data-access/index.md).</span></span>

## <a name="step-2-adding-a-double-prices-button-to-the-master-page"></a><span data-ttu-id="6ea5c-167">步骤2：向母版页添加双重价格按钮</span><span class="sxs-lookup"><span data-stu-id="6ea5c-167">Step 2: Adding a Double Prices Button to the Master Page</span></span>

<span data-ttu-id="6ea5c-168">下一项任务是将按钮 Web 控件添加到母版页，单击该控件时，会将数据库中所有产品的价格翻倍。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-168">Our next task is to add a Button Web control to the master page that, when clicked, will double the price of all products in the database.</span></span> <span data-ttu-id="6ea5c-169">打开 `Site.master` 母版页，然后将一个按钮从工具箱拖动到设计器上，将其放在上一教程中添加的 `RecentProductsDataSource` SqlDataSource 控件下。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-169">Open the `Site.master` master page and drag a Button from the Toolbox onto the Designer, placing it beneath the `RecentProductsDataSource` SqlDataSource control we added in the previous tutorial.</span></span> <span data-ttu-id="6ea5c-170">将该按钮的 `ID` 属性设置为 `DoublePrice`，其 `Text` 属性设置为 "双积价格"。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-170">Set the Button's `ID` property to `DoublePrice` and its `Text` property to "Double Product Prices".</span></span>

<span data-ttu-id="6ea5c-171">接下来，将 SqlDataSource 控件添加到母版页，并 `DoublePricesDataSource`命名。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-171">Next, add a SqlDataSource control to the master page, naming it `DoublePricesDataSource`.</span></span> <span data-ttu-id="6ea5c-172">此 SqlDataSource 将用于执行 `UPDATE` 语句以将所有价格加倍。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-172">This SqlDataSource will be used to execute the `UPDATE` statement to double all prices.</span></span> <span data-ttu-id="6ea5c-173">具体而言，我们需要设置其 `ConnectionString`，并 `UpdateCommand` 属性设置为相应的连接字符串和 `UPDATE` 语句。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-173">Specifically, we need to set its `ConnectionString` and `UpdateCommand` properties to the appropriate connection string and `UPDATE` statement.</span></span> <span data-ttu-id="6ea5c-174">然后，需要在单击 "`DoublePrice`" 按钮时调用此 SqlDataSource 控件的 `Update` 方法。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-174">Then we need to call this SqlDataSource control's `Update` method when the `DoublePrice` Button is clicked.</span></span> <span data-ttu-id="6ea5c-175">若要设置 "`ConnectionString`" 和 "`UpdateCommand`" 属性，请选择 SqlDataSource 控件，然后选择 "属性窗口"。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-175">To set the `ConnectionString` and `UpdateCommand` properties, select the SqlDataSource control and then go to the Properties window.</span></span> <span data-ttu-id="6ea5c-176">`ConnectionString` 属性列出了已存储在下拉列表中 `Web.config` 的连接字符串;选择 "`NorthwindConnectionString`" 选项，如图6所示。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-176">The `ConnectionString` property lists those connection strings already stored in `Web.config` in a drop-down list; choose the `NorthwindConnectionString` option as shown in Figure 6.</span></span>

<span data-ttu-id="6ea5c-177">[![将 SqlDataSource 配置为使用 NorthwindConnectionString](interacting-with-the-content-page-from-the-master-page-cs/_static/image17.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="6ea5c-177">[![Configure the SqlDataSource to Use the NorthwindConnectionString](interacting-with-the-content-page-from-the-master-page-cs/_static/image17.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image16.png)</span></span>

<span data-ttu-id="6ea5c-178">**图 06**：将 SqlDataSource 配置为使用 `NorthwindConnectionString` （[单击查看完全大小的图像](interacting-with-the-content-page-from-the-master-page-cs/_static/image18.png)）</span><span class="sxs-lookup"><span data-stu-id="6ea5c-178">**Figure 06**: Configure the SqlDataSource to Use the `NorthwindConnectionString` ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image18.png))</span></span>

<span data-ttu-id="6ea5c-179">若要设置 `UpdateCommand` 属性，请在属性窗口中找到 UpdateQuery 选项。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-179">To set the `UpdateCommand` property, locate the UpdateQuery option in the Properties window.</span></span> <span data-ttu-id="6ea5c-180">此属性在选中时显示带有省略号的按钮;单击此按钮可显示图7中所示的 "命令和参数编辑器" 对话框。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-180">This property, when selected, displays a button with ellipses; click this button to display the Command and Parameter Editor dialog box shown in Figure 7.</span></span> <span data-ttu-id="6ea5c-181">在对话框的文本框中键入以下 `UPDATE` 语句：</span><span class="sxs-lookup"><span data-stu-id="6ea5c-181">Type the following `UPDATE` statement into the dialog box's textbox:</span></span>

[!code-sql[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample3.sql)]

<span data-ttu-id="6ea5c-182">执行此语句时，将为 `Products` 表中的每条记录将 `UnitPrice` 值加倍。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-182">This statement, when executed, will double the `UnitPrice` value for each record in the `Products` table.</span></span>

<span data-ttu-id="6ea5c-183">[![设置 SqlDataSource 的 UpdateCommand 属性](interacting-with-the-content-page-from-the-master-page-cs/_static/image20.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="6ea5c-183">[![Set SqlDataSource's UpdateCommand Property](interacting-with-the-content-page-from-the-master-page-cs/_static/image20.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image19.png)</span></span>

<span data-ttu-id="6ea5c-184">**图 07**：设置 SqlDataSource 的 `UpdateCommand` 属性（[单击以查看完全大小的图像](interacting-with-the-content-page-from-the-master-page-cs/_static/image21.png)）</span><span class="sxs-lookup"><span data-stu-id="6ea5c-184">**Figure 07**: Set SqlDataSource's `UpdateCommand` Property  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image21.png))</span></span>

<span data-ttu-id="6ea5c-185">设置这些属性之后，Button 和 SqlDataSource 控件的声明性标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="6ea5c-185">After setting these properties, your Button and SqlDataSource controls' declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample4.aspx)]

<span data-ttu-id="6ea5c-186">在单击 "`DoublePrice`" 按钮时，剩下的就是调用 `Update` 方法。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-186">All that remains is to call its `Update` method when the `DoublePrice` Button is clicked.</span></span> <span data-ttu-id="6ea5c-187">为 "`DoublePrice`" 按钮创建 `Click` 事件处理程序并添加以下代码：</span><span class="sxs-lookup"><span data-stu-id="6ea5c-187">Create a `Click` event handler for the `DoublePrice` Button and add the following code:</span></span>

[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample5.cs)]

<span data-ttu-id="6ea5c-188">若要测试此功能，请访问我们在步骤1中创建的 `~/Admin/Products.aspx` 页面，然后单击 "产品价格翻倍" 按钮。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-188">To test this functionality, visit the `~/Admin/Products.aspx` page we created in Step 1 and click the "Double Product Prices" button.</span></span> <span data-ttu-id="6ea5c-189">单击该按钮将导致回发，并执行 "`DoublePrice`" 按钮的 `Click` 事件处理程序，使所有产品的价格翻倍。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-189">Clicking the button causes a postback and executes the `DoublePrice` Button's `Click` event handler, doubling the prices of all products.</span></span> <span data-ttu-id="6ea5c-190">然后，将重新呈现页面，并在浏览器中返回并重新显示标记。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-190">The page is then re-rendered and the markup is returned and re-displayed in the browser.</span></span> <span data-ttu-id="6ea5c-191">但在 "内容" 页中，GridView 列出的价格与单击 "双积价格" 按钮之前的价格相同。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-191">The GridView in the content page, however, lists the same prices as before the "Double Product Prices" button was clicked.</span></span> <span data-ttu-id="6ea5c-192">这是因为，在 GridView 中最初加载的数据将其状态存储在视图状态中，因此除非另外说明，否则不会在回发时重新加载它。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-192">This is because the data initially loaded in the GridView had its state stored in view state, so it's not reloaded on postbacks unless instructed otherwise.</span></span> <span data-ttu-id="6ea5c-193">如果访问其他页面，然后返回 `~/Admin/Products.aspx` 页面，则会看到更新的价格。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-193">If you visit a different page and then return to the `~/Admin/Products.aspx` page you'll see the updated prices.</span></span>

## <a name="step-3-raising-an-event-when-the-prices-are-doubled"></a><span data-ttu-id="6ea5c-194">步骤3：当价格加倍时引发事件</span><span class="sxs-lookup"><span data-stu-id="6ea5c-194">Step 3: Raising an Event When the Prices are Doubled</span></span>

<span data-ttu-id="6ea5c-195">由于 "`~/Admin/Products.aspx`" 页中的 GridView 不会立即反映价格翻倍，因此用户可能会理解认为他们未单击 "产品价格" 按钮，或者该按钮不起作用。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-195">Because the GridView in the `~/Admin/Products.aspx` page does not immediately reflect the price doubling, a user may understandably think that they did not click the "Double Product Prices" button, or that it didn't work.</span></span> <span data-ttu-id="6ea5c-196">它们可能会多次尝试单击该按钮，并再次将该价格加倍。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-196">They may try clicking the button a few more times, doubling the prices again and again.</span></span> <span data-ttu-id="6ea5c-197">若要解决此问题，我们需要在 "内容" 页中的网格立即显示新价格。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-197">To fix this we need to have the grid in the content page display the new prices immediately after they are doubled.</span></span>

<span data-ttu-id="6ea5c-198">如本教程前面所述，每当用户单击 "`DoublePrice`" 按钮时，我们都需要在母版页中引发事件。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-198">As discussed earlier in this tutorial, we need to raise an event in the master page whenever the user clicks the `DoublePrice` Button.</span></span> <span data-ttu-id="6ea5c-199">事件是一种类（事件发布者）通知另一组其他有意义的类（事件订阅者）的方法。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-199">An event is a way for one class (an event publisher) to notify another a set of other classes (the event subscribers) that something interesting has occurred.</span></span> <span data-ttu-id="6ea5c-200">在此示例中，母版页是事件发布者;当单击 "`DoublePrice`" 按钮时，这些内容页是订阅服务器。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-200">In this example, the master page is the event publisher; those content pages that care about when the `DoublePrice` Button is clicked are the subscribers.</span></span>

<span data-ttu-id="6ea5c-201">类通过创建事件处理程序订阅事件，该*事件处理程序*是为响应所引发的事件而执行的方法。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-201">A class subscribes to an event by creating an *event handler*, which is a method that is executed in response to the event being raised.</span></span> <span data-ttu-id="6ea5c-202">发布者通过定义*事件委托*来定义他引发的事件。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-202">The publisher defines the events he raises by defining an *event delegate*.</span></span> <span data-ttu-id="6ea5c-203">事件委托指定事件处理程序必须接受的输入参数。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-203">The event delegate specifies what input parameters the event handler must accept.</span></span> <span data-ttu-id="6ea5c-204">在 .NET Framework 中，事件委托不返回任何值，并接受两个输入参数：</span><span class="sxs-lookup"><span data-stu-id="6ea5c-204">In the .NET Framework, event delegates do not return any value and accept two input parameters:</span></span>

- <span data-ttu-id="6ea5c-205">用于标识事件源的 `Object`，</span><span class="sxs-lookup"><span data-stu-id="6ea5c-205">An `Object`, which identifies the event source, and</span></span>
- <span data-ttu-id="6ea5c-206">派生自 `System.EventArgs` 的类</span><span class="sxs-lookup"><span data-stu-id="6ea5c-206">A class derived from `System.EventArgs`</span></span>

<span data-ttu-id="6ea5c-207">传递给事件处理程序的第二个参数可以包括有关事件的其他信息。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-207">The second parameter passed to an event handler can include additional information about the event.</span></span> <span data-ttu-id="6ea5c-208">虽然基 `EventArgs` 类未通过任何信息，但 .NET Framework 包含许多扩展 `EventArgs` 和包含附加属性的类。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-208">While the base `EventArgs` class does not pass along any information, the .NET Framework includes a number of classes that extend `EventArgs` and encompass additional properties.</span></span> <span data-ttu-id="6ea5c-209">例如，`CommandEventArgs` 实例将传递给响应 `Command` 事件的事件处理程序，并包括两个信息性属性： `CommandArgument` 和 `CommandName`。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-209">For example, a `CommandEventArgs` instance is passed to event handlers that respond to the `Command` event, and includes two informational properties: `CommandArgument` and `CommandName`.</span></span>

> [!NOTE]
> <span data-ttu-id="6ea5c-210">有关创建、引发和处理事件的详细信息，请参阅[采用简单英语的](http://www.codeproject.com/KB/cs/eventdelegates.aspx)[事件和委托](https://msdn.microsoft.com/library/17sde2xt.aspx)和事件委托。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-210">For more information on creating, raising, and handling events, see [Events and Delegates](https://msdn.microsoft.com/library/17sde2xt.aspx) and [Event Delegates in Simple English](http://www.codeproject.com/KB/cs/eventdelegates.aspx).</span></span>

<span data-ttu-id="6ea5c-211">若要定义事件，请使用以下语法：</span><span class="sxs-lookup"><span data-stu-id="6ea5c-211">To define an event use the following syntax:</span></span>

[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample6.cs)]

<span data-ttu-id="6ea5c-212">由于我们只需在用户单击 "`DoublePrice`" 按钮时对内容页发出警报，而无需通过其他任何其他信息传递，因此我们可以使用事件委托 `EventHandler`，它定义一个事件处理程序，该事件处理程序接受作为其第二个参数的类型 `System.EventArgs`的对象。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-212">Because we only need to alert the content page when the user has clicked the `DoublePrice` Button and do not need to pass along any other additional information, we can use the event delegate `EventHandler`, which defines an event handler that accepts as its second parameter an object of type `System.EventArgs`.</span></span> <span data-ttu-id="6ea5c-213">若要在母版页中创建事件，请将以下代码行添加到母版页的代码隐藏类：</span><span class="sxs-lookup"><span data-stu-id="6ea5c-213">To create the event in the master page, add the following line of code to the master page's code-behind class:</span></span>

[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample7.cs)]

<span data-ttu-id="6ea5c-214">上面的代码将一个公共事件添加到名为 `PricesDoubled`的母版页。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-214">The above code adds a public event to the master page named `PricesDoubled`.</span></span> <span data-ttu-id="6ea5c-215">现在，我们需要在价格翻倍后引发此事件。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-215">We now need to raise this event after the prices have been doubled.</span></span> <span data-ttu-id="6ea5c-216">若要引发事件，请使用以下语法：</span><span class="sxs-lookup"><span data-stu-id="6ea5c-216">To raise an event use the following syntax:</span></span>

[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample8.cs)]

<span data-ttu-id="6ea5c-217">其中，*发送方*和*eventArgs*是要传递到订阅服务器的事件处理程序的值。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-217">Where *sender* and *eventArgs* are the values you want to pass to the subscriber's event handler.</span></span>

<span data-ttu-id="6ea5c-218">将 `DoublePrice` `Click` 事件处理程序更新为以下代码：</span><span class="sxs-lookup"><span data-stu-id="6ea5c-218">Update the `DoublePrice` `Click` event handler with the following code:</span></span>

[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample9.cs)]

<span data-ttu-id="6ea5c-219">与之前一样，`Click` 事件处理程序首先调用 `DoublePricesDataSource` SqlDataSource 控件的 `Update` 方法，将所有产品的价格翻倍。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-219">As before, the `Click` event handler starts by calling the `DoublePricesDataSource` SqlDataSource control's `Update` method to double the prices of all products.</span></span> <span data-ttu-id="6ea5c-220">下面是对事件处理程序进行了两项添加。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-220">Following that there are two additions to the event handler.</span></span> <span data-ttu-id="6ea5c-221">首先，刷新 `RecentProducts` GridView 的数据。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-221">First, the `RecentProducts` GridView's data is refreshed.</span></span> <span data-ttu-id="6ea5c-222">此 GridView 添加到了前面教程中的母版页，并显示了五个最近添加的产品。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-222">This GridView was added to the master page in the preceding tutorial and displays the five most recently-added products.</span></span> <span data-ttu-id="6ea5c-223">我们需要刷新此网格，使其显示这5个产品的刚好翻倍的价格。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-223">We need to refresh this grid so that it shows the just-doubled prices for these five products.</span></span> <span data-ttu-id="6ea5c-224">之后，会引发 `PricesDoubled` 事件。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-224">Following that, the `PricesDoubled` event is raised.</span></span> <span data-ttu-id="6ea5c-225">对母版页本身（`this`）的引用将作为事件源发送到事件处理程序，并以事件参数的形式发送空的 `EventArgs` 对象。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-225">A reference to the master page itself (`this`) is sent to the event handler as the event source and an empty `EventArgs` object is sent as the event arguments.</span></span>

## <a name="step-4-handling-the-event-in-the-content-page"></a><span data-ttu-id="6ea5c-226">步骤4：处理内容页中的事件</span><span class="sxs-lookup"><span data-stu-id="6ea5c-226">Step 4: Handling the Event in the Content Page</span></span>

<span data-ttu-id="6ea5c-227">此时，只要单击 `DoublePrice` 按钮控件，母版页就会引发其 `PricesDoubled` 事件。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-227">At this point the master page raises its `PricesDoubled` event whenever the `DoublePrice` Button control is clicked.</span></span> <span data-ttu-id="6ea5c-228">但是，这只是工作的一半，我们仍需要处理订阅服务器上的事件。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-228">However, this is only half the battle - we still need to handle the event in the subscriber.</span></span> <span data-ttu-id="6ea5c-229">这涉及两个步骤：创建事件处理程序和添加事件布线代码，以便在引发事件时执行事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-229">This involves two steps: creating the event handler and adding event wiring code so that when the event is raised the event handler is executed.</span></span>

<span data-ttu-id="6ea5c-230">首先，创建一个名为 `Master_PricesDoubled`的事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-230">Start by creating an event handler named `Master_PricesDoubled`.</span></span> <span data-ttu-id="6ea5c-231">由于我们在母版页中定义了 `PricesDoubled` 事件，因此，事件处理程序的两个输入参数必须分别为 `Object` 和 `EventArgs`类型。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-231">Because of how we defined the `PricesDoubled` event in the master page the event handler's two input parameters must be of types `Object` and `EventArgs`, respectively.</span></span> <span data-ttu-id="6ea5c-232">在事件处理程序中，调用 `ProductsGrid` GridView 的 `DataBind` 方法将数据重新绑定到网格。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-232">In the event handler call the `ProductsGrid` GridView's `DataBind` method to rebind the data to the grid.</span></span>

[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample10.cs)]

<span data-ttu-id="6ea5c-233">事件处理程序的代码已完成，但我们尚未将母版页的 `PricesDoubled` 事件连接到此事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-233">The code for the event handler is complete but we've yet to wire the master page's `PricesDoubled` event to this event handler.</span></span> <span data-ttu-id="6ea5c-234">订阅服务器通过以下语法将事件线路到事件处理程序：</span><span class="sxs-lookup"><span data-stu-id="6ea5c-234">The subscriber wires an event to an event handler via the following syntax:</span></span>

[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample11.cs)]

<span data-ttu-id="6ea5c-235">*发布者*是对提供事件*名称*的对象的引用，"*方法*名称" 是在订阅服务器中定义的事件处理程序的名称，该事件处理程序的签名对应于*eventDelegate*。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-235">*publisher* is a reference to the object that offers the event *eventName*, and *methodName* is the name of the event handler defined in the subscriber that has a signature corresponding to the *eventDelegate*.</span></span> <span data-ttu-id="6ea5c-236">换言之，如果 `EventHandler`事件委托，*则方法名称必须是*订阅服务器中不返回值并分别接受两个类型 `Object` 和 `EventArgs`的输入参数的方法的名称。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-236">In other words, if the event delegate is `EventHandler`, then *methodName* must be the name of a method in the subscriber that does not return a value and accepts two input parameters of types `Object` and `EventArgs`, respectively.</span></span>

<span data-ttu-id="6ea5c-237">必须在第一页访问和后续回发中执行此事件布线代码，并应在页面生命周期中的某个时间点执行此事件布线。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-237">This event wiring code must be executed on the first page visit and subsequent postbacks and should occur at a point in the page lifecycle that precedes when the event may be raised.</span></span> <span data-ttu-id="6ea5c-238">添加事件布线代码的好时机是在 PreInit 阶段，这种情况在页面生命周期中非常早发生。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-238">A good time to add event wiring code is in the PreInit stage, which occurs very early in the page lifecycle.</span></span>

<span data-ttu-id="6ea5c-239">打开 `~/Admin/Products.aspx` 并创建 `Page_PreInit` 事件处理程序：</span><span class="sxs-lookup"><span data-stu-id="6ea5c-239">Open `~/Admin/Products.aspx` and create a `Page_PreInit` event handler:</span></span>

[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample12.cs)]

<span data-ttu-id="6ea5c-240">若要完成此布线代码，我们需要从内容页以编程方式引用母版页。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-240">In order to complete this wiring code we need a programmatic reference to the master page from the content page.</span></span> <span data-ttu-id="6ea5c-241">如前面的教程中所述，有两种方法可实现此目的：</span><span class="sxs-lookup"><span data-stu-id="6ea5c-241">As noted in the previous tutorial, there are two ways to do this:</span></span>

- <span data-ttu-id="6ea5c-242">通过将松类型 `Page.Master` 属性转换为相应的母版页类型，或</span><span class="sxs-lookup"><span data-stu-id="6ea5c-242">By casting the loosely-typed `Page.Master` property to the appropriate master page type, or</span></span>
- <span data-ttu-id="6ea5c-243">通过在 `.aspx` 页中添加一个 `@MasterType` 指令，然后使用强类型 `Master` 属性。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-243">By adding a `@MasterType` directive in the `.aspx` page and then using the strongly-typed `Master` property.</span></span>

<span data-ttu-id="6ea5c-244">使用后一种方法。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-244">Let's use the latter approach.</span></span> <span data-ttu-id="6ea5c-245">将以下 `@MasterType` 指令添加到页面的声明性标记的顶部：</span><span class="sxs-lookup"><span data-stu-id="6ea5c-245">Add the following `@MasterType` directive to the top of the page's declarative markup:</span></span>

[!code-aspx[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample13.aspx)]

<span data-ttu-id="6ea5c-246">然后在 `Page_PreInit` 事件处理程序中添加以下事件布线代码：</span><span class="sxs-lookup"><span data-stu-id="6ea5c-246">Then add the following event wiring code in the `Page_PreInit` event handler:</span></span>

[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample14.cs)]

<span data-ttu-id="6ea5c-247">将此代码放入后，只要单击 "`DoublePrice`" 按钮，内容页中的 GridView 就会被刷新。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-247">With this code in place, the GridView in the content page is refreshed whenever the `DoublePrice` Button is clicked.</span></span>

<span data-ttu-id="6ea5c-248">图8和9说明了此行为。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-248">Figures 8 and 9 illustrate this behavior.</span></span> <span data-ttu-id="6ea5c-249">图8显示第一次访问时的页面。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-249">Figure 8 shows the page when first visited.</span></span> <span data-ttu-id="6ea5c-250">请注意，`RecentProducts` GridView 中的价格值（在母版页的左栏中）和 `ProductsGrid` GridView （在 "内容" 页中）。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-250">Note that price values in both the `RecentProducts` GridView (in the left column of the master page) and the `ProductsGrid` GridView (in the content page).</span></span> <span data-ttu-id="6ea5c-251">图9显示了在单击 "`DoublePrice`" 按钮后立即显示的同一屏幕。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-251">Figure 9 shows the same screen immediately after the `DoublePrice` Button has been clicked.</span></span> <span data-ttu-id="6ea5c-252">正如您所看到的，这两个 GridViews 中的新价格会立即反映出来。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-252">As you can see, the new prices are instantaneously reflected in both GridViews.</span></span>

<span data-ttu-id="6ea5c-253">[![初始价格值](interacting-with-the-content-page-from-the-master-page-cs/_static/image23.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="6ea5c-253">[![The Initial Price Values](interacting-with-the-content-page-from-the-master-page-cs/_static/image23.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image22.png)</span></span>

<span data-ttu-id="6ea5c-254">**图 08**：初始价格值（[单击以查看完全大小的图像](interacting-with-the-content-page-from-the-master-page-cs/_static/image24.png)）</span><span class="sxs-lookup"><span data-stu-id="6ea5c-254">**Figure 08**: The Initial Price Values  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image24.png))</span></span>

<span data-ttu-id="6ea5c-255">[![在 GridViews 中显示双线价格](interacting-with-the-content-page-from-the-master-page-cs/_static/image26.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="6ea5c-255">[![The Just-Doubled Prices are Displayed in the GridViews](interacting-with-the-content-page-from-the-master-page-cs/_static/image26.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image25.png)</span></span>

<span data-ttu-id="6ea5c-256">**图 09**： GridViews 中显示最大的价格（[单击以查看完全大小的图像](interacting-with-the-content-page-from-the-master-page-cs/_static/image27.png)）</span><span class="sxs-lookup"><span data-stu-id="6ea5c-256">**Figure 09**: The Just-Doubled Prices are Displayed in the GridViews  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image27.png))</span></span>

## <a name="summary"></a><span data-ttu-id="6ea5c-257">摘要</span><span class="sxs-lookup"><span data-stu-id="6ea5c-257">Summary</span></span>

<span data-ttu-id="6ea5c-258">理想情况下，母版页及其内容页完全独立，无需交互。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-258">Ideally, a master page and its content pages are completely separate from one another and require no level of interaction.</span></span> <span data-ttu-id="6ea5c-259">但是，如果您有一个母版页或内容页，其中显示了可从母版页或内容页修改的数据，则在修改数据以便可以更新显示内容页时，您可能需要将母版页通知内容页（或相反）。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-259">However, if you have a master page or content page that displays data that can be modified from the master page or content page, then you may need to have the master page alert the content page (or vice-a-versa) when data is modified so that the display can be updated.</span></span> <span data-ttu-id="6ea5c-260">在前面的教程中，我们看到了如何使内容页以编程方式与母版页交互;在本教程中，我们介绍了如何使母版页启动交互。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-260">In the preceding tutorial we saw how to have a content page programmatically interact with its master page; in this tutorial we looked at how to have a master page initiate the interaction.</span></span>

<span data-ttu-id="6ea5c-261">尽管内容和母版页之间的编程交互可以来自内容或母版页，但使用的交互模式取决于源。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-261">While programmatic interaction between a content and master page can originate from either the content or master page, the interaction pattern used depends on the origination.</span></span> <span data-ttu-id="6ea5c-262">不同之处在于内容页有一个母版页，但一个母版页可以有许多不同的内容页。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-262">The differences are due to the fact that a content page has a single master page, but a master page can have many different content pages.</span></span> <span data-ttu-id="6ea5c-263">更好的方法是使母版页引发一个事件，以指示发生了某种操作，而不是让母版页直接与内容页交互。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-263">Rather than having a master page directly interact with a content page, a better approach is to have the master page raise an event to signal that some action has taken place.</span></span> <span data-ttu-id="6ea5c-264">关心此操作的那些内容页可以创建事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-264">Those content pages that care about the action can create event handlers.</span></span>

<span data-ttu-id="6ea5c-265">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="6ea5c-265">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="6ea5c-266">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="6ea5c-266">Further Reading</span></span>

<span data-ttu-id="6ea5c-267">有关本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="6ea5c-267">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="6ea5c-268">访问和更新 ASP.NET 中的数据</span><span class="sxs-lookup"><span data-stu-id="6ea5c-268">Accessing and Updating Data in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/011106-1.aspx)
- [<span data-ttu-id="6ea5c-269">事件和委托</span><span class="sxs-lookup"><span data-stu-id="6ea5c-269">Events and Delegates</span></span>](https://msdn.microsoft.com/library/17sde2xt.aspx)
- [<span data-ttu-id="6ea5c-270">在内容和母版页之间传递信息</span><span class="sxs-lookup"><span data-stu-id="6ea5c-270">Passing Information Between Content and Master Pages</span></span>](http://aspnet.4guysfromrolla.com/articles/013107-1.aspx)
- [<span data-ttu-id="6ea5c-271">使用 ASP.NET 教程中的数据</span><span class="sxs-lookup"><span data-stu-id="6ea5c-271">Working with Data in ASP.NET Tutorials</span></span>](../../data-access/index.md)

### <a name="about-the-author"></a><span data-ttu-id="6ea5c-272">关于作者</span><span class="sxs-lookup"><span data-stu-id="6ea5c-272">About the Author</span></span>

<span data-ttu-id="6ea5c-273">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，创始人的多个 ASP/asp 和4GuysFromRolla.com 的作者已使用 Microsoft Web 技术，1998。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-273">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="6ea5c-274">Scott 的工作方式是独立的顾问、培训师和撰稿人。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-274">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="6ea5c-275">他的最新书籍是，[*在24小时内，sam ASP.NET 3.5*](https://www.amazon.com/exec/obidos/ASIN/0672329972/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-275">His latest book is [*Sams Teach Yourself ASP.NET 3.5 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672329972/4guysfromrollaco).</span></span> <span data-ttu-id="6ea5c-276">可以通过[http://ScottOnWriting.NET](http://scottonwriting.net/) [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)或通过他的博客访问 Scott。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-276">Scott can be reached at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="6ea5c-277">特别感谢</span><span class="sxs-lookup"><span data-stu-id="6ea5c-277">Special Thanks To</span></span>

<span data-ttu-id="6ea5c-278">此教程系列由许多有用的审阅者查看。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-278">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="6ea5c-279">本教程的主管审查人员是 Suchi Banerjee。</span><span class="sxs-lookup"><span data-stu-id="6ea5c-279">Lead reviewer for this tutorial was Suchi Banerjee.</span></span> <span data-ttu-id="6ea5c-280">想要查看我即将发布的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="6ea5c-280">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="6ea5c-281">如果是这样，请在[mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="6ea5c-281">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="6ea5c-282">[上一页](interacting-with-the-master-page-from-the-content-page-cs.md)
> [下一页](master-pages-and-asp-net-ajax-cs.md)</span><span class="sxs-lookup"><span data-stu-id="6ea5c-282">[Previous](interacting-with-the-master-page-from-the-content-page-cs.md)
[Next](master-pages-and-asp-net-ajax-cs.md)</span></span>
