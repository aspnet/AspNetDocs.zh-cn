---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-a-website-that-uses-application-services-vb
title: 配置使用应用程序服务的网站（VB） |Microsoft Docs
author: rick-anderson
description: ASP.NET 版本2.0 引入了一系列应用程序服务，它们是 .NET Framework 的一部分，用作一套构建基块服务，
ms.author: riande
ms.date: 04/23/2009
ms.assetid: 9c31a42f-d8bb-4c0f-9ccc-597d4f70ac42
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-a-website-that-uses-application-services-vb
msc.type: authoredcontent
ms.openlocfilehash: 19e7258b558372259c7554a36c6ad73ce572dfa8
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/28/2019
ms.locfileid: "74588675"
---
# <a name="configuring-a-website-that-uses-application-services-vb"></a><span data-ttu-id="6bbbb-103">配置使用应用程序服务的网站 (VB)</span><span class="sxs-lookup"><span data-stu-id="6bbbb-103">Configuring a Website that Uses Application Services (VB)</span></span>

<span data-ttu-id="6bbbb-104">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="6bbbb-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="6bbbb-105">[下载代码](https://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_09_VB.zip)或[下载 PDF](https://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial09_AppServicesConfig_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="6bbbb-105">[Download Code](https://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_09_VB.zip) or [Download PDF](https://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial09_AppServicesConfig_vb.pdf)</span></span>

> <span data-ttu-id="6bbbb-106">ASP.NET 版本2.0 引入了一系列应用程序服务，它们是 .NET Framework 的一部分，可用作构建基块服务套件，你可以使用这些服务将丰富的功能添加到你的 web 应用程序。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-106">ASP.NET version 2.0 introduced a series of application services, which are part of the .NET Framework and serve as a suite of building block services that you can use to add rich functionality to your web application.</span></span> <span data-ttu-id="6bbbb-107">本教程介绍如何在生产环境中配置网站以使用应用程序服务，并解决在生产环境中管理用户帐户和角色时遇到的常见问题。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-107">This tutorial explores how to configure a website in the production environment to use application services and addresses common issues with managing user accounts and roles on the production environment.</span></span>

## <a name="introduction"></a><span data-ttu-id="6bbbb-108">简介</span><span class="sxs-lookup"><span data-stu-id="6bbbb-108">Introduction</span></span>

<span data-ttu-id="6bbbb-109">ASP.NET 版本2.0 引入了一系列*应用程序服务*，它们是 .NET Framework 的一部分，可用作构建基块服务套件，你可以使用这些服务将丰富的功能添加到你的 web 应用程序。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-109">ASP.NET version 2.0 introduced a series of *application services*, which are part of the .NET Framework and serve as a suite of building block services that you can use to add rich functionality to your web application.</span></span> <span data-ttu-id="6bbbb-110">应用程序服务包括：</span><span class="sxs-lookup"><span data-stu-id="6bbbb-110">The application services include:</span></span>

- <span data-ttu-id="6bbbb-111">**成员身份**-用于创建和管理用户帐户的 API。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-111">**Membership** - an API for creating and managing user accounts.</span></span>
- <span data-ttu-id="6bbbb-112">**角色**-用于将用户分组到组中的 API。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-112">**Roles** - an API for categorizing users into groups.</span></span>
- <span data-ttu-id="6bbbb-113">**Profile** -用于存储自定义的特定于用户的内容的 API。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-113">**Profile** - an API for storing custom, user-specific content.</span></span>
- <span data-ttu-id="6bbbb-114">**站点地图**-一种 API，用于以层次结构的形式定义站点的逻辑结构，然后可以通过导航控件（如菜单和痕迹导航）显示该结构。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-114">**Site Map** - an API for defining a site s logical structure in the form of a hierarchy, which can then be displayed via navigation controls, such as menus and breadcrumbs.</span></span>
- <span data-ttu-id="6bbbb-115">**个性化设置**-用于维护自定义首选项的 API，最常用于[*webpart*](https://msdn.microsoft.com/library/e0s9t4ck.aspx)。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-115">**Personalization** - an API for maintaining customization preferences, most often used with [*WebParts*](https://msdn.microsoft.com/library/e0s9t4ck.aspx).</span></span>
- <span data-ttu-id="6bbbb-116">**运行状况监视**-一种 API，用于监视正在运行的 web 应用程序的性能、安全性、错误和其他系统运行状况指标。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-116">**Health Monitoring** - an API for monitoring performance, security, errors, and other system health metrics for a running web application.</span></span>

<span data-ttu-id="6bbbb-117">应用程序服务 Api 不与特定的实现相关联。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-117">The application services APIs are not tied to a specific implementation.</span></span> <span data-ttu-id="6bbbb-118">相反，您需要指示应用程序服务使用特定的*提供程序*，并且该提供程序使用特定的技术实现该服务。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-118">Instead, you instruct the application services to use a particular *provider*, and that provider implements the service using a particular technology.</span></span> <span data-ttu-id="6bbbb-119">Web 托管公司托管的基于 Internet 的 web 应用程序最常用的提供程序是使用 SQL Server 数据库实现的提供程序。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-119">The most commonly used providers for Internet-based web applications hosted at a web hosting company are those providers that use a SQL Server database implementation.</span></span> <span data-ttu-id="6bbbb-120">例如，`SqlMembershipProvider` 是在 Microsoft SQL Server 数据库中存储用户帐户信息的成员资格 API 的提供程序。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-120">For example, the `SqlMembershipProvider` is a provider for the Membership API that stores user account information in a Microsoft SQL Server database.</span></span>

<span data-ttu-id="6bbbb-121">在部署应用程序时，使用应用程序服务和 SQL Server 提供程序会增加一些挑战。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-121">Using the application services and SQL Server providers adds some challenges when deploying the application.</span></span> <span data-ttu-id="6bbbb-122">对于初学者，必须在开发和生产数据库中正确地创建应用程序服务数据库对象，并进行相应的初始化。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-122">For starters, the application services database objects must be properly created on both the development and production databases and appropriately initialized.</span></span> <span data-ttu-id="6bbbb-123">还需要进行重要的配置设置。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-123">There are also important configuration settings that need to be made.</span></span>

> [!NOTE]
> <span data-ttu-id="6bbbb-124">应用程序服务 Api 是使用[*提供程序模型*](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)设计的，该设计模式允许在运行时提供 API s 实现细节。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-124">The application services APIs were designed using the [*provider model*](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx), a design pattern that allows for an API s implementation details to be provided at runtime.</span></span> <span data-ttu-id="6bbbb-125">.NET Framework 附带了许多可供使用的应用程序服务提供程序，如 `SqlMembershipProvider` 和 `SqlRoleProvider`，它们是使用 SQL Server 数据库实现的成员身份和角色 Api 的提供程序。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-125">The .NET Framework ships with a number of application service providers that can be used, such as the `SqlMembershipProvider` and `SqlRoleProvider`, which are providers for the Membership and Roles APIs that use a SQL Server database implementation.</span></span> <span data-ttu-id="6bbbb-126">你还可以创建自定义提供程序并将其插入。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-126">You can also create and plug-in a custom provider.</span></span> <span data-ttu-id="6bbbb-127">事实上，书籍评论 web 应用程序已经包含站点地图 API （`ReviewSiteMapProvider`）的自定义提供程序，该提供程序将从数据库中的 `Genres` 和 `Books` 表中的数据构造站点地图。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-127">In fact, the Book Reviews web application already contains a custom provider for the Site Map API (`ReviewSiteMapProvider`), which constructs the site map from the data in the `Genres` and `Books` tables in the database.</span></span>

<span data-ttu-id="6bbbb-128">本教程首先介绍如何扩展书籍评论 web 应用程序以使用成员身份和角色 Api。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-128">This tutorial starts with a look at how I extended the Book Reviews web application to use the Membership and Roles APIs.</span></span> <span data-ttu-id="6bbbb-129">然后，它将指导您部署一个使用应用程序服务和 SQL Server 数据库实现的 web 应用程序，并解决在生产环境中管理用户帐户和角色的常见问题。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-129">It then walks through deploying a web application that uses application services with a SQL Server database implementation, and concludes by addressing common issues with managing user accounts and roles on the production environment.</span></span>

## <a name="updates-to-the-book-reviews-application"></a><span data-ttu-id="6bbbb-130">书籍的更新评审应用程序</span><span class="sxs-lookup"><span data-stu-id="6bbbb-130">Updates to the Book Reviews Application</span></span>

<span data-ttu-id="6bbbb-131">在过去的几个教程中，书籍回顾 web 应用程序已从静态网站更新为动态、数据驱动的 web 应用程序，其中包含一组管理流派和评审的管理页面。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-131">Over the past couple tutorials the Book Reviews web application was updated from a static website to a dynamic, data-driven web application complete with a set of administration pages for managing genres and reviews.</span></span> <span data-ttu-id="6bbbb-132">但是，此管理部分当前不受保护-任何知道（或猜测）管理页 URL 的用户都可以在我们的站点上 waltz 和创建、编辑或删除评论。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-132">However, this administration section is currently not protected - any user who knows (or guesses) the administration page URL can waltz in and create, edit, or delete reviews on our site.</span></span> <span data-ttu-id="6bbbb-133">保护网站特定部分的常见方法是实现用户帐户，然后使用 URL 授权规则限制对某些用户或角色的访问。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-133">A common way to protect certain portions of a website is to implement user accounts and then use URL authorization rules to restrict access to certain users or roles.</span></span> <span data-ttu-id="6bbbb-134">本教程介绍可供下载的书籍检查 web 应用程序支持用户帐户和角色。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-134">The Book Reviews web application available for download with this tutorial supports user accounts and roles.</span></span> <span data-ttu-id="6bbbb-135">它有一个名为 "管理员" 的角色，并且只有此角色中的用户才能访问 "管理" 页。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-135">It has a single role defined named Admin and only users in this role can access the administration pages.</span></span>

> [!NOTE]
> <span data-ttu-id="6bbbb-136">我在一本书中创建了三个用户帐户。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-136">I ve created three user accounts in the Book Reviews web application: Scott, Jisun, and Alice.</span></span> <span data-ttu-id="6bbbb-137">所有三个用户都具有相同的密码： **password！**</span><span class="sxs-lookup"><span data-stu-id="6bbbb-137">All three users have the same password: **password!**</span></span> <span data-ttu-id="6bbbb-138">Scott 和 Jisun 是管理员角色，Alice 不是。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-138">Scott and Jisun are in the Admin role, Alice is not.</span></span> <span data-ttu-id="6bbbb-139">匿名用户仍可访问站点的非管理页面。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-139">The site s non-administration pages are still accessible to anonymous users.</span></span> <span data-ttu-id="6bbbb-140">也就是说，你无需登录即可访问站点，除非你想要管理它，在这种情况下，你必须以 "管理员" 角色中的用户身份登录。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-140">That is, you do not need to sign in to visit the site, unless you want to administer it, in which case you must sign in as a user in the Admin role.</span></span>

<span data-ttu-id="6bbbb-141">书籍 "查看应用程序" 母版页已更新，可为经过身份验证的用户和匿名用户提供不同的用户界面。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-141">The Book Reviews application s master page has been updated to include a different user interface for authenticated and anonymous users.</span></span> <span data-ttu-id="6bbbb-142">如果匿名用户访问该站点，她看到的是右上角的 "登录" 链接。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-142">If an anonymous user visits the site she sees a Login link in the upper right corner.</span></span> <span data-ttu-id="6bbbb-143">经过身份验证的用户将看到消息 "欢迎回来， *username*！"</span><span class="sxs-lookup"><span data-stu-id="6bbbb-143">An authenticated user sees the message, "Welcome back, *username*!"</span></span> <span data-ttu-id="6bbbb-144">和一个用于注销的链接。还有一个登录页（`~/Login.aspx`），其中包含一个登录 Web 控件，该控件提供用户界面和用于验证访问者的逻辑。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-144">and a link to log out. There s also a login page (`~/Login.aspx`), which contains a Login Web control that provides the user interface and logic for authenticating a visitor.</span></span> <span data-ttu-id="6bbbb-145">只有管理员才能创建新帐户。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-145">Only administrators can create new accounts.</span></span> <span data-ttu-id="6bbbb-146">（在 `~/Admin` 文件夹中有用于创建和管理用户帐户的页面。）</span><span class="sxs-lookup"><span data-stu-id="6bbbb-146">(There are pages for creating and managing user accounts in the `~/Admin` folder.)</span></span>

### <a name="configuring-the-membership-and-roles-apis"></a><span data-ttu-id="6bbbb-147">配置成员资格和角色 Api</span><span class="sxs-lookup"><span data-stu-id="6bbbb-147">Configuring the Membership and Roles APIs</span></span>

<span data-ttu-id="6bbbb-148">本书回顾 web 应用程序使用成员身份和角色 Api 来支持用户帐户，并将这些用户分组为角色（即管理员角色）。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-148">The Book Reviews web application uses the Membership and Roles APIs to support user accounts and to group those users into roles (namely, the Admin role).</span></span> <span data-ttu-id="6bbbb-149">使用 `SqlMembershipProvider` 和 `SqlRoleProvider` 提供程序类，因为我们想要将帐户和角色信息存储在 SQL Server 数据库中。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-149">The `SqlMembershipProvider` and `SqlRoleProvider` provider classes are used because we want to store account and role information in a SQL Server database.</span></span>

> [!NOTE]
> <span data-ttu-id="6bbbb-150">本教程并未详细介绍如何配置 web 应用程序以支持成员身份和角色 Api。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-150">This tutorial is not intended to be a detailed examination at configuring a web application to support the Membership and Roles APIs.</span></span> <span data-ttu-id="6bbbb-151">若要全面了解这些 Api 以及配置网站以使用它们所需执行的步骤，请阅读[*网站安全教程*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-151">For a thorough look at these APIs and the steps you need to take to configure a website to use them, please read my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

<span data-ttu-id="6bbbb-152">若要将应用程序服务用于 SQL Server 数据库，必须首先将这些提供程序使用的数据库对象添加到要在其中存储用户帐户和角色信息的数据库。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-152">To use the application services with a SQL Server database you must first add the database objects used by these providers to the database where you want the user account and role information stored.</span></span> <span data-ttu-id="6bbbb-153">这些必要的数据库对象包括各种表、视图和存储过程。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-153">These requisite database objects include a variety of tables, views, and stored procedures.</span></span> <span data-ttu-id="6bbbb-154">除非另外指定，否则 `SqlMembershipProvider` 和 `SqlRoleProvider` 提供程序类将使用位于应用程序 `App_Data` 文件夹中名为 `ASPNETDB` SQL Server Express Edition 数据库;如果此类数据库不存在，则会在运行时使用这些访问接口的必要数据库对象自动创建它。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-154">Unless specified otherwise, the `SqlMembershipProvider` and `SqlRoleProvider` provider classes use a SQL Server Express Edition database named `ASPNETDB` located in the application s `App_Data` folder; if such a database does not exist, it is automatically created with the necessary database objects by these providers at runtime.</span></span>

<span data-ttu-id="6bbbb-155">通常，在存储特定于应用程序的数据的数据库中创建应用程序服务数据库对象是可行的，通常是理想的选择。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-155">It is possible, and usually ideal, to create the application services database objects in the same database where the website s application-specific data is stored.</span></span> <span data-ttu-id="6bbbb-156">该 .NET Framework 附带了一个名为 `aspnet_regsql.exe` 的工具，该工具在指定的数据库上安装数据库对象。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-156">The .NET Framework ships with a tool named `aspnet_regsql.exe` that installs the database objects on a specified database.</span></span> <span data-ttu-id="6bbbb-157">我事先使用此工具将这些对象添加到 `App_Data` 文件夹（开发数据库）中的 `Reviews.mdf` 数据库。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-157">I have gone ahead and used this tool to add these objects to the `Reviews.mdf` database in the `App_Data` folder (the development database).</span></span> <span data-ttu-id="6bbbb-158">我们将在本教程的后面部分介绍如何使用此工具，将这些对象添加到生产数据库中。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-158">We'll see how to use this tool later in this tutorial when we add these objects to the production database.</span></span>

<span data-ttu-id="6bbbb-159">如果将应用程序服务数据库对象添加到 `ASPNETDB` 以外的数据库，则需要自定义 `SqlMembershipProvider` 和 `SqlRoleProvider` 提供程序类配置，使其使用适当的数据库。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-159">If you add the application services database objects to a database other than `ASPNETDB` you will need to customize the `SqlMembershipProvider` and `SqlRoleProvider` provider classes configurations so that they use the appropriate database.</span></span> <span data-ttu-id="6bbbb-160">若要自定义成员资格提供程序，请在 `Web.config`中的 `<system.web>` 节内添加[ *&lt;成员身份&gt; 元素*](https://msdn.microsoft.com/library/1b9hw62f.aspx)。使用[ *&lt;roleManager&gt; 元素*](https://msdn.microsoft.com/library/ms164660.aspx)配置角色提供程序。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-160">To customize the Membership provider add a [*&lt;membership&gt; element*](https://msdn.microsoft.com/library/1b9hw62f.aspx) within the `<system.web>` section in `Web.config`; use the [*&lt;roleManager&gt; element*](https://msdn.microsoft.com/library/ms164660.aspx) to configure the Roles provider.</span></span> <span data-ttu-id="6bbbb-161">以下代码片段取自 `Web.config` 的书籍查看应用程序，并显示成员身份和角色 Api 的配置设置。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-161">The following snippet is taken from the Book Reviews application s `Web.config` and shows the configure settings for the Membership and Roles APIs.</span></span> <span data-ttu-id="6bbbb-162">请注意，两个注册新的提供程序 `ReviewMembership` 和 `ReviewRole`，分别使用 `SqlMembershipProvider` 和 `SqlRoleProvider` 提供程序。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-162">Note that both register a new provider - `ReviewMembership` and `ReviewRole` - that use the `SqlMembershipProvider` and `SqlRoleProvider` providers, respectively.</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-vb/samples/sample1.xml)]

<span data-ttu-id="6bbbb-163">`Web.config` 文件 s `<authentication>` 元素也已配置为支持基于窗体的身份验证。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-163">The `Web.config` file s `<authentication>` element has also been configured to support forms-based authentication.</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-vb/samples/sample2.xml)]

### <a name="limiting-access-to-the-administration-pages"></a><span data-ttu-id="6bbbb-164">限制对管理页的访问</span><span class="sxs-lookup"><span data-stu-id="6bbbb-164">Limiting Access to the Administration Pages</span></span>

<span data-ttu-id="6bbbb-165">通过 ASP.NET，可以轻松地按用户或按角色的*URL 授权*功能授予或拒绝对特定文件或文件夹的访问权限。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-165">ASP.NET makes it easy to grant or deny access to a particular file or folder by user or by role via its *URL authorization* feature.</span></span> <span data-ttu-id="6bbbb-166">（我们会在*iis 与 ASP.NET 开发服务器教程之间*简要介绍了 url 授权，并说明了 iis 和 ASP.NET 开发服务器如何以不同的方式针对静态内容和动态内容应用 url 授权规则。）由于我们希望禁止访问 "管理员" 角色中的用户以外的 `~/Admin` 文件夹，因此需要将 URL 授权规则添加到此文件夹。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-166">(We briefly discussed URL authorization in the *Core Differences Between IIS and the ASP.NET Development Server* tutorial and showed how IIS and the ASP.NET Development Server apply URL authorization rules differently for static versus dynamic content.) Because we want to prohibit access to the `~/Admin` folder except for those users in the Admin role, we need to add URL authorization rules to this folder.</span></span> <span data-ttu-id="6bbbb-167">具体而言，URL 授权规则需要允许管理员角色中的用户拒绝所有其他用户。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-167">Specifically, the URL authorization rules need to allow users in the Admin role and deny all other users.</span></span> <span data-ttu-id="6bbbb-168">为此，可将 `Web.config` 文件添加到 `~/Admin` 文件夹中，其中包含以下内容：</span><span class="sxs-lookup"><span data-stu-id="6bbbb-168">This is accomplished by adding a `Web.config` file to the `~/Admin` folder with the following contents:</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-vb/samples/sample3.xml)]

<span data-ttu-id="6bbbb-169">若要详细了解 ASP.NET s URL 授权功能以及如何使用它来拼写用户和角色的授权规则，请务必阅读[*网站安全教程*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)中的[*基于用户的授权*](../../older-versions-security/membership/user-based-authorization-vb.md)和[*基于角色的授权*](../../older-versions-security/roles/role-based-authorization-vb.md)教程。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-169">For more information on ASP.NET s URL authorization feature and how to use it to spell out authorization rules for users and for roles, be sure to read the [*User-Based Authorization*](../../older-versions-security/membership/user-based-authorization-vb.md) and [*Role-Based Authorization*](../../older-versions-security/roles/role-based-authorization-vb.md) tutorials from my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

## <a name="deploying-a-web-application-that-uses-application-services"></a><span data-ttu-id="6bbbb-170">部署使用应用程序服务的 Web 应用程序</span><span class="sxs-lookup"><span data-stu-id="6bbbb-170">Deploying a Web Application That Uses Application Services</span></span>

<span data-ttu-id="6bbbb-171">在部署使用应用程序服务的网站和在数据库中存储应用程序服务信息的提供程序时，必须在生产数据库中创建应用程序服务所需的数据库对象。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-171">When deploying a website that uses application services and a provider that stores the application services information in a database, it is imperative that the database objects needed by the application services be created on the production database.</span></span> <span data-ttu-id="6bbbb-172">最初，生产数据库不包含这些对象，因此，在首次部署应用程序时（或在添加应用程序服务后首次部署应用程序时），您必须执行额外的步骤以在生产数据库。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-172">Initially the production database does not contain these objects, so when the application is first deployed (or when it is deployed for the first time after application services have been added), you must take extra steps to get these requisite database objects on the production database.</span></span>

<span data-ttu-id="6bbbb-173">如果要将在开发环境中创建的用户帐户复制到生产环境，则在部署使用应用程序服务的网站时可能会出现另一项挑战。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-173">Another challenge can arise when deploying a website that uses application services if you intend to replicate the user accounts created in the development environment to the production environment.</span></span> <span data-ttu-id="6bbbb-174">即使你将在开发环境中创建的用户帐户成功地复制到生产数据库中，但这些用户无法在生产环境中登录到 web 应用程序，具体取决于成员身份和角色配置。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-174">Depending on the Membership and Roles configuration, it is possible that even if you successfully copy the user accounts that were created in the development environment to the production database, these users cannot sign into the web application in production.</span></span> <span data-ttu-id="6bbbb-175">我们将查看此问题的原因并讨论如何防止发生此问题。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-175">We'll look at the cause of this issue and discuss how to prevent it from happening.</span></span>

<span data-ttu-id="6bbbb-176">ASP.NET 附带了一个不错的[*网站管理工具（WSAT）* ](https://msdn.microsoft.com/library/yy40ytx0.aspx) ，可从 Visual Studio 启动，并允许通过基于 Web 的界面管理用户帐户、角色和授权规则。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-176">ASP.NET ships with a nice [*Web Site Administration Tool (WSAT)*](https://msdn.microsoft.com/library/yy40ytx0.aspx) that can be launched from Visual Studio and allows the user account, roles, and authorization rules to be managed through a web-based interface.</span></span> <span data-ttu-id="6bbbb-177">遗憾的是，WSAT 仅适用于本地网站，这意味着它不能用于远程管理生产环境中 web 应用程序的用户帐户、角色和授权规则。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-177">Unfortunately, the WSAT only works for local websites, meaning that it cannot be used to remotely manage user accounts, roles, and authorization rules for the web application in the production environment.</span></span> <span data-ttu-id="6bbbb-178">我们将看看如何通过不同的方式实现生产网站中类似于 WSAT 的行为。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-178">We'll look at different ways to implement WSAT-like behavior from your production website.</span></span>

### <a name="adding-the-database-objects-using-aspnet_regsqlexe"></a><span data-ttu-id="6bbbb-179">使用 aspnet\_regsql 添加数据库对象</span><span class="sxs-lookup"><span data-stu-id="6bbbb-179">Adding the Database Objects Using aspnet\_regsql.exe</span></span>

<span data-ttu-id="6bbbb-180">*部署数据库*教程介绍了如何将表和数据从开发数据库复制到生产数据库，当然，这些技术也可以用来将应用程序服务数据库对象复制到生产数据库中。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-180">The *Deploying a Database* tutorial showed how to copy the tables and data from the development database to the production database, and these techniques can certainly be used to copy the application services database objects to the production database.</span></span> <span data-ttu-id="6bbbb-181">另一个选项是 `aspnet_regsql.exe` 工具，它可在数据库中添加或删除应用程序服务数据库对象。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-181">Another option is the `aspnet_regsql.exe` tool, which adds or removes the application services database objects from a database.</span></span>

> [!NOTE]
> <span data-ttu-id="6bbbb-182">`aspnet_regsql.exe` 工具在指定的数据库上创建数据库对象。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-182">The `aspnet_regsql.exe` tool creates the database objects on a specified database.</span></span> <span data-ttu-id="6bbbb-183">它不会将这些数据库对象中的数据从开发数据库迁移到生产数据库。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-183">It does not migrate data in those database objects from the development database to the production database.</span></span> <span data-ttu-id="6bbbb-184">如果要将开发数据库中的用户帐户和角色信息复制到生产数据库，请使用*部署数据库*教程中所述的方法。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-184">If you mean to copy the user account and role information in the development database to the production database use the techniques covered in the *Deploying a Database* tutorial.</span></span>

<span data-ttu-id="6bbbb-185">让我们看看如何使用 `aspnet_regsql.exe` 工具将数据库对象添加到生产数据库中。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-185">Let s look at how to add the database objects to the production database using the `aspnet_regsql.exe` tool.</span></span> <span data-ttu-id="6bbbb-186">首先打开 Windows 资源管理器并导航到计算机上的 .NET Framework 2.0 版目录，% WINDIR% \NET\Framework\v2.0.50727。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-186">Start by opening Windows Explorer and navigating to the .NET Framework version 2.0 directory on your computer, %WINDIR%\ Microsoft.NET\Framework\v2.0.50727.</span></span> <span data-ttu-id="6bbbb-187">你应找到 `aspnet_regsql.exe` 工具。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-187">There you should find the `aspnet_regsql.exe` tool.</span></span> <span data-ttu-id="6bbbb-188">此工具可从命令行使用，但它还包括图形用户界面;双击 `aspnet_regsql.exe` 文件以启动其图形组件。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-188">This tool can be used from the command-line, but it also includes a graphical user interface; double-click the `aspnet_regsql.exe` file to launch its graphical component.</span></span>

<span data-ttu-id="6bbbb-189">该工具首先显示初始屏幕，其中说明了其用途。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-189">The tool starts by displaying a splash screen explaining its purpose.</span></span> <span data-ttu-id="6bbbb-190">单击 "下一步" 转到 "选择安装选项" 屏幕，如图1所示。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-190">Click Next to advance to the "Select a Setup Option" screen, which is shown in Figure 1.</span></span> <span data-ttu-id="6bbbb-191">从这里，你可以选择添加应用程序服务数据库对象或从数据库中删除它们。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-191">From here you can choose to add the application services database objects or remove them from a database.</span></span> <span data-ttu-id="6bbbb-192">由于我们要将这些对象添加到生产数据库，因此请选择 "为应用程序服务配置 SQL Server" 选项，然后单击 "下一步"。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-192">Because we want to add these objects to the production database, select the "Configure SQL Server for application services" option and click Next.</span></span>

<span data-ttu-id="6bbbb-193">[![选择为应用程序服务配置 SQL Server](configuring-a-website-that-uses-application-services-vb/_static/image2.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image1.jpg)</span><span class="sxs-lookup"><span data-stu-id="6bbbb-193">[![Choose to Configure SQL Server for Application Services](configuring-a-website-that-uses-application-services-vb/_static/image2.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image1.jpg)</span></span>

<span data-ttu-id="6bbbb-194">**图 1**：选择为应用程序服务配置 SQL Server （[单击查看完全大小的图像](configuring-a-website-that-uses-application-services-vb/_static/image3.jpg)）</span><span class="sxs-lookup"><span data-stu-id="6bbbb-194">**Figure 1**: Choose to Configure SQL Server for Application Services ([Click to view full-size image](configuring-a-website-that-uses-application-services-vb/_static/image3.jpg))</span></span>

<span data-ttu-id="6bbbb-195">在 "选择服务器和数据库" 屏幕上，提示输入连接到数据库的信息。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-195">In "Select the Server and Database" screen prompts for information to connect to the database.</span></span> <span data-ttu-id="6bbbb-196">输入 web 托管公司提供的数据库服务器、安全凭据和数据库名称，然后单击 "下一步"。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-196">Enter the database server, the security credentials, and the database name supplied to you by your web hosting company and click Next.</span></span>

> [!NOTE]
> <span data-ttu-id="6bbbb-197">输入数据库服务器和凭据后，展开 "数据库" 下拉列表时可能会出现错误。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-197">After entering your database server and credentials you may get an error when expanding the database drop-down list.</span></span> <span data-ttu-id="6bbbb-198">`aspnet_regsql.exe` 工具将查询 `sysdatabases` 系统表以检索服务器上的数据库列表，但某些 web 宿主公司会锁定其数据库服务器，以便此信息不会公开提供。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-198">The `aspnet_regsql.exe` tool queries the `sysdatabases` system table to retrieve a list of databases on the server, but some web hosting companies lock down their database servers so that this information is not publicly available.</span></span> <span data-ttu-id="6bbbb-199">如果收到此错误，可以直接在下拉列表中键入数据库名称。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-199">If you get this error you can type the database name directly into the drop-down list.</span></span>

<span data-ttu-id="6bbbb-200">[![为该工具提供数据库的连接信息](configuring-a-website-that-uses-application-services-vb/_static/image5.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image4.jpg)</span><span class="sxs-lookup"><span data-stu-id="6bbbb-200">[![Supply the Tool With Your Database s Connection Information](configuring-a-website-that-uses-application-services-vb/_static/image5.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image4.jpg)</span></span>

<span data-ttu-id="6bbbb-201">**图 2**：向该工具提供数据库的连接信息（[单击以查看完全大小的映像](configuring-a-website-that-uses-application-services-vb/_static/image6.jpg)）</span><span class="sxs-lookup"><span data-stu-id="6bbbb-201">**Figure 2**: Supply the Tool With Your Database s Connection Information ([Click to view full-size image](configuring-a-website-that-uses-application-services-vb/_static/image6.jpg))</span></span>

<span data-ttu-id="6bbbb-202">后续屏幕汇总了即将发生的操作，即应用程序服务数据库对象将添加到指定的数据库。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-202">The subsequent screen summarizes the actions that are about to take place, namely that the application services database objects are going to be added to the specified database.</span></span> <span data-ttu-id="6bbbb-203">单击 "下一步" 完成此操作。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-203">Click Next to complete this action.</span></span> <span data-ttu-id="6bbbb-204">几分钟后，将显示最后一个屏幕，指出已添加数据库对象（请参阅图3）。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-204">After a few moments, the final screen is displayed, noting that the database objects have been added (see Figure 3).</span></span>

<span data-ttu-id="6bbbb-205">[![成功！应用程序服务数据库对象已添加到生产数据库中](configuring-a-website-that-uses-application-services-vb/_static/image8.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image7.jpg)</span><span class="sxs-lookup"><span data-stu-id="6bbbb-205">[![Success! The Application Services Database Objects Were Added to the Production Database](configuring-a-website-that-uses-application-services-vb/_static/image8.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image7.jpg)</span></span>

<span data-ttu-id="6bbbb-206">**图 3**：成功！</span><span class="sxs-lookup"><span data-stu-id="6bbbb-206">**Figure 3**: Success!</span></span> <span data-ttu-id="6bbbb-207">应用程序服务数据库对象已添加到生产数据库（[单击查看完全大小的映像](configuring-a-website-that-uses-application-services-vb/_static/image9.jpg)）</span><span class="sxs-lookup"><span data-stu-id="6bbbb-207">The Application Services Database Objects Were Added to the Production Database ([Click to view full-size image](configuring-a-website-that-uses-application-services-vb/_static/image9.jpg))</span></span>

<span data-ttu-id="6bbbb-208">若要验证应用程序服务数据库对象是否已成功添加到生产数据库，请打开 SQL Server Management Studio 并连接到生产数据库。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-208">To verify that the application services database objects were successfully added to the production database, open SQL Server Management Studio and connect to your production database.</span></span> <span data-ttu-id="6bbbb-209">如图4所示，你现在应看到数据库中的应用程序服务数据库表、`aspnet_Applications`、`aspnet_Membership`、`aspnet_Users`等。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-209">As Figure 4 shows, you should now see the application services database tables in your database, `aspnet_Applications`, `aspnet_Membership`, `aspnet_Users`, and so forth.</span></span>

<span data-ttu-id="6bbbb-210">[![确认数据库对象已添加到生产数据库中](configuring-a-website-that-uses-application-services-vb/_static/image11.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image10.jpg)</span><span class="sxs-lookup"><span data-stu-id="6bbbb-210">[![Confirm That the Database Objects Were Added to the Production Database](configuring-a-website-that-uses-application-services-vb/_static/image11.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image10.jpg)</span></span>

<span data-ttu-id="6bbbb-211">**图 4**：确认数据库对象已添加到生产数据库（[单击查看完全大小的映像](configuring-a-website-that-uses-application-services-vb/_static/image12.jpg)）</span><span class="sxs-lookup"><span data-stu-id="6bbbb-211">**Figure 4**: Confirm That the Database Objects Were Added to the Production Database ([Click to view full-size image](configuring-a-website-that-uses-application-services-vb/_static/image12.jpg))</span></span>

<span data-ttu-id="6bbbb-212">仅在首次部署 web 应用程序时，或在开始使用应用程序服务后首次使用时，才需要使用 `aspnet_regsql.exe` 工具。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-212">You will only need to use the `aspnet_regsql.exe` tool when deploying your web application for the first time or for the first time after you have started using the application services.</span></span> <span data-ttu-id="6bbbb-213">一旦这些数据库对象位于生产数据库中，就不需要重新添加或修改它们。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-213">Once these database objects are on the production database they won't need to be re-added or modified.</span></span>

### <a name="copying-user-accounts-from-development-to-production"></a><span data-ttu-id="6bbbb-214">将用户帐户从开发复制到生产</span><span class="sxs-lookup"><span data-stu-id="6bbbb-214">Copying User Accounts from Development to Production</span></span>

<span data-ttu-id="6bbbb-215">使用 `SqlMembershipProvider` 和 `SqlRoleProvider` 提供程序类将应用程序服务信息存储在 SQL Server 数据库中时，用户帐户和角色信息将存储在不同的数据库表中，这些表包括 `aspnet_Users`、`aspnet_Membership`、`aspnet_Roles`和 `aspnet_UsersInRoles`等。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-215">When using the `SqlMembershipProvider` and `SqlRoleProvider` provider classes to store the application services information in a SQL Server database, the user account and role information is stored in a variety of database tables, including `aspnet_Users`, `aspnet_Membership`, `aspnet_Roles`, and `aspnet_UsersInRoles`, among others.</span></span> <span data-ttu-id="6bbbb-216">如果在开发过程中，您在开发环境中创建用户帐户，则可以通过从相应数据库表复制相应的记录，在生产环境中复制这些用户帐户。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-216">If during development you create user accounts in the development environment you can replicate those user accounts in production by copying the corresponding records from the applicable database tables.</span></span> <span data-ttu-id="6bbbb-217">如果你使用数据库发布向导来部署应用程序服务数据库对象，则可能还选择复制记录，这将导致在开发期间创建的用户帐户也会在生产环境中进行。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-217">If you used the Database Publishing Wizard to deploy the application services database objects you may have also elected to copy the records, which would result in the user accounts created in development to also be on production.</span></span> <span data-ttu-id="6bbbb-218">但是，根据您的配置设置，您可能会发现，在开发中创建并复制到生产的帐户的用户无法从生产网站登录。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-218">But, depending on your configuration settings, you may find that those users whose accounts were created in development and copied to production are unable to login from the production website.</span></span> <span data-ttu-id="6bbbb-219">提供了哪些功能？</span><span class="sxs-lookup"><span data-stu-id="6bbbb-219">What gives?</span></span>

<span data-ttu-id="6bbbb-220">`SqlMembershipProvider` 和 `SqlRoleProvider` 提供程序类的设计使单个数据库可以充当多个应用程序的用户存储，因此，每个应用程序理论上都有一个具有相同名称的重叠用户名和角色的用户。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-220">The `SqlMembershipProvider` and `SqlRoleProvider` provider classes were designed such that a single database could serve as a user store for multiple applications, where each application could, in theory, have users with overlapping usernames and roles with the same name.</span></span> <span data-ttu-id="6bbbb-221">为了实现这种灵活性，数据库将维护 `aspnet_Applications` 表中的应用程序列表，并且每个用户与其中一个应用程序相关联。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-221">To allow for this flexibility, the database maintains a list of applications in the `aspnet_Applications` table, and each user is associated with one of these applications.</span></span> <span data-ttu-id="6bbbb-222">具体而言，`aspnet_Users` 表有一个 `ApplicationId` 列，该列将每个用户与 `aspnet_Applications` 表中的一条记录联系起来。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-222">Specifically, the `aspnet_Users` table has an `ApplicationId` column that ties each user to a record in the `aspnet_Applications` table.</span></span>

<span data-ttu-id="6bbbb-223">除了 `ApplicationId` 列外，`aspnet_Applications` 表还包含一个 `ApplicationName` 列，该列为应用程序提供了更友好的名称。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-223">In addition to the `ApplicationId` column, the `aspnet_Applications` table also includes an `ApplicationName` column, which provides a more human-friendly name for the application.</span></span> <span data-ttu-id="6bbbb-224">当网站尝试使用用户帐户（如从登录页验证用户凭据）时，它必须告知 `SqlMembershipProvider` 类要使用的应用程序。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-224">When a website attempts to work with a user account, such as validating a user s credentials from the login page, it must tell the `SqlMembershipProvider` class what application to work with.</span></span> <span data-ttu-id="6bbbb-225">通常通过提供应用程序名称来实现此功能，此值来自 `Web.config` 中的提供程序配置（具体来说是通过 `applicationName` 属性进行）。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-225">It usually does this by supplying the application name, and the this value comes from the provider s configuration in `Web.config` - specifically via the `applicationName` attribute.</span></span>

<span data-ttu-id="6bbbb-226">但是，如果未在 `Web.config`中指定 `applicationName` 特性，会发生什么情况呢？</span><span class="sxs-lookup"><span data-stu-id="6bbbb-226">But what happens if the `applicationName` attribute is not specified in `Web.config`?</span></span> <span data-ttu-id="6bbbb-227">在这种情况下，成员资格系统使用应用程序根路径作为 `applicationName` 值。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-227">In such a case the Membership system uses the application root path as the `applicationName` value.</span></span> <span data-ttu-id="6bbbb-228">如果未在 `Web.config`中显式设置 `applicationName` 属性，则开发环境和生产环境可能会使用不同的应用程序根目录，因此会与应用程序服务中的不同应用程序名称关联。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-228">If the `applicationName` attribute is not explicitly set in `Web.config`, then, there is the possibility that the development environment and production environment use a different application root and therefore will be associated with different application names in the application services.</span></span> <span data-ttu-id="6bbbb-229">如果发生这种不匹配，则在开发环境中创建的用户将有与生产环境的 `ApplicationId` 值不匹配的 `ApplicationId` 值。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-229">If such a mismatch occurs then those users created in the development environment will have an `ApplicationId` value that does not match with the `ApplicationId` value for the production environment.</span></span> <span data-ttu-id="6bbbb-230">最终结果是，这些用户将无法登录。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-230">The net result is that those users won't be able to login.</span></span>

> [!NOTE]
> <span data-ttu-id="6bbbb-231">如果你发现自己在这种情况下，将用户帐户复制到生产时使用不匹配的 `ApplicationId` 值，则可以编写一个查询，将这些错误的 `ApplicationId` 值更新为在生产环境中使用的 `ApplicationId`。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-231">If you find yourself in this situation - with user accounts copied to production with a mismatched `ApplicationId` value - you could write a query to update these incorrect `ApplicationId` values to the `ApplicationId` used on production.</span></span> <span data-ttu-id="6bbbb-232">更新之后，在开发环境中创建帐户的用户现在可以登录到生产环境中的 web 应用程序。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-232">Once updated, the users whose accounts were created on the development environment would now be able to sign into the web application on production.</span></span>

<span data-ttu-id="6bbbb-233">好消息是，你可以执行一个简单的步骤来确保两个环境使用相同的 `ApplicationId`-在 `Web.config` 中为所有应用程序服务提供程序显式设置 `applicationName` 特性。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-233">The good news is that there is a simple step you can take to ensure that the two environments use the same `ApplicationId` - explicitly set the `applicationName` attribute in `Web.config` for all of your application services providers.</span></span> <span data-ttu-id="6bbbb-234">我在 `<membership>` 和 `<roleManager>` 元素中显式将 `applicationName` 特性设置为 "BookReviews"，这是 `Web.config` 所示的此代码段。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-234">I explicitly set the `applicationName` attribute to "BookReviews" in the `<membership>` and `<roleManager>` elements as this snippet from `Web.config` shows.</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-vb/samples/sample4.xml)]

<span data-ttu-id="6bbbb-235">若要深入了解如何设置 `applicationName` 属性及其背后的基本原理，请参阅[*Scott Guthrie*](https://weblogs.asp.net/scottgu/) s 博客文章：[*配置 ASP.NET 成员身份和其他提供程序时，请始终设置 applicationName 属性*](https://weblogs.asp.net/scottgu/443634)。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-235">For more discussion on setting the `applicationName` attribute and the rationale behind it, refer to [*Scott Guthrie*](https://weblogs.asp.net/scottgu/) s blog post, [*Always set the applicationName property when configuring ASP.NET Membership and other Providers*](https://weblogs.asp.net/scottgu/443634).</span></span>

### <a name="managing-user-accounts-in-the-production-environment"></a><span data-ttu-id="6bbbb-236">在生产环境中管理用户帐户</span><span class="sxs-lookup"><span data-stu-id="6bbbb-236">Managing User Accounts in the Production Environment</span></span>

<span data-ttu-id="6bbbb-237">使用 ASP.NET 网站管理工具（WSAT），可以轻松创建和管理用户帐户、定义和应用角色，以及拼写用户和基于角色的授权规则。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-237">The ASP.NET Web Site Administration Tool (WSAT) makes it easy to create and manage user accounts, define and apply roles, and spell out user- and role-based authorization rules.</span></span> <span data-ttu-id="6bbbb-238">可以通过转到 "解决方案资源管理器" 并单击 "ASP.NET" "配置" 图标，或转到 "网站" 或 "项目" 菜单，然后选择 "ASP.NET" 配置菜单项，从 Visual Studio 启动 WSAT。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-238">You can launch the WSAT from Visual Studio by going to the Solution Explorer and clicking the ASP.NET Configuration icon or by going to the Website or Project menus and selecting the ASP.NET Configuration menu item.</span></span> <span data-ttu-id="6bbbb-239">遗憾的是，WSAT 只能用于本地网站。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-239">Unfortunately, the WSAT can only work with local websites.</span></span> <span data-ttu-id="6bbbb-240">因此，不能使用工作站中的 WSAT 来管理生产环境中的网站。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-240">Therefore, you cannot use the WSAT from your workstation to manage the website in the production environment.</span></span>

<span data-ttu-id="6bbbb-241">好消息是，WSAT 提供的所有功能都通过成员身份和角色 Api 以编程方式提供;此外，许多 WSAT 屏幕都使用标准的 ASP.NET 登录相关控件。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-241">The good news is that all of the functionality exposed provided by the WSAT is available programmatically through the Membership and Roles APIs; furthermore, many of the WSAT screens use the standard ASP.NET Login-related controls.</span></span> <span data-ttu-id="6bbbb-242">简而言之，你可以将 ASP.NET 页面添加到你的网站，该网站提供必要的管理功能。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-242">In short, you can add ASP.NET pages to your website that offer the necessary management capabilities.</span></span>

<span data-ttu-id="6bbbb-243">请记住，更早的教程已将书籍评论 web 应用程序更新为包含 `~/Admin` 文件夹，此文件夹已配置为仅允许管理员角色中的用户使用。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-243">Recall that an earlier tutorial updated the Book Reviews web application to include an `~/Admin` folder, and this folder has been configured to only allow users in the Admin role.</span></span> <span data-ttu-id="6bbbb-244">我向此文件夹添加了一个名为 `CreateAccount.aspx` 的页面，管理员可从中创建新的用户帐户。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-244">I added a page to that folder named `CreateAccount.aspx` from which an administrator can create a new user account.</span></span> <span data-ttu-id="6bbbb-245">此页面使用 CreateUserWizard 控件显示用于创建新用户帐户的用户界面和后端逻辑。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-245">This page uses the CreateUserWizard control to display the user interface and backend logic for creating a new user account.</span></span> <span data-ttu-id="6bbbb-246">另外，我自定义了控件以包含一个复选框，该复选框会提示是否还应将新用户添加到管理员角色中（请参阅图5）。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-246">What s more, I customized the control to include a CheckBox that prompts whether the new user should also be added to the Admin role (see Figure 5).</span></span> <span data-ttu-id="6bbbb-247">通过少许工作，您可以构建一组自定义页面，用于实现用户和角色管理相关的任务，这些任务将由 WSAT 提供。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-247">With a little bit of work you can build a custom set of pages that implements the user and role management-related tasks that would otherwise be provided by the WSAT.</span></span>

> [!NOTE]
> <span data-ttu-id="6bbbb-248">若要详细了解如何结合使用成员身份和角色 Api 以及与登录相关的 ASP.NET Web 控件，请参阅[*网站安全教程*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-248">For more information on using the Membership and Roles APIs along with the Login-related ASP.NET Web controls, be sure to read my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span> <span data-ttu-id="6bbbb-249">有关自定义 CreateUserWizard 控件的详细信息，请参阅[*创建用户帐户*](../../older-versions-security/membership/creating-user-accounts-vb.md)和[*存储其他用户信息*](../../older-versions-security/membership/storing-additional-user-information-vb.md)教程，或查看[*Erich Peterson*](http://www.erichpeterson.com/) s 文章，[*自定义 CreateUserWizard 控件*](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx)。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-249">For more on customizing the CreateUserWizard control refer to the [*Creating User Accounts*](../../older-versions-security/membership/creating-user-accounts-vb.md) and [*Storing Additional User Information*](../../older-versions-security/membership/storing-additional-user-information-vb.md) tutorials, or check out [*Erich Peterson*](http://www.erichpeterson.com/) s article, [*Customizing the CreateUserWizard Control*](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx).</span></span>

<span data-ttu-id="6bbbb-250">[![管理员可以创建新的用户帐户](configuring-a-website-that-uses-application-services-vb/_static/image14.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image13.jpg)</span><span class="sxs-lookup"><span data-stu-id="6bbbb-250">[![Administrators Can Create New User Accounts](configuring-a-website-that-uses-application-services-vb/_static/image14.jpg)](configuring-a-website-that-uses-application-services-vb/_static/image13.jpg)</span></span>

<span data-ttu-id="6bbbb-251">**图 5**：管理员可以创建新的用户帐户（[单击查看完全大小的映像](configuring-a-website-that-uses-application-services-vb/_static/image15.jpg)）</span><span class="sxs-lookup"><span data-stu-id="6bbbb-251">**Figure 5**: Administrators Can Create New User Accounts ([Click to view full-size image](configuring-a-website-that-uses-application-services-vb/_static/image15.jpg))</span></span>

<span data-ttu-id="6bbbb-252">如果需要 WSAT 的全部功能，请使用 "查看[*自己的网站管理工具*](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)"，其中作者 Dan Clem 逐步完成构建自定义 WSAT 工具的过程。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-252">If you need the full functionality of the WSAT check out [*Rolling Your Own Web Site Administration Tool*](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx), in which author Dan Clem walks through the process of building a custom WSAT-like tool.</span></span> <span data-ttu-id="6bbbb-253">Dan 共享其应用程序的源代码（在C#中），并提供将其添加到托管网站的分步说明。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-253">Dan shares his application s source code (in C#) and provides step-by-step instructions for adding it to your hosted website.</span></span>

## <a name="summary"></a><span data-ttu-id="6bbbb-254">总结</span><span class="sxs-lookup"><span data-stu-id="6bbbb-254">Summary</span></span>

<span data-ttu-id="6bbbb-255">部署使用应用程序服务数据库实现的 web 应用程序时，必须首先确保生产数据库具有必要的数据库对象。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-255">When deploying a web application that uses the application services database implementation you must first ensure that the production database has the requisite database objects.</span></span> <span data-ttu-id="6bbbb-256">可以使用在 "*部署数据库*" 教程中讨论的技术来添加这些对象。或者，您可以使用 `aspnet_regsql.exe` 工具，如本教程中所述。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-256">These objects can be added using the techniques discussed in the *Deploying a Database* tutorial; alternatively, you can use the `aspnet_regsql.exe` tool, as we saw in this tutorial.</span></span> <span data-ttu-id="6bbbb-257">我们围绕的其他挑战：同步开发环境和生产环境中使用的应用程序名称（如果您希望在开发环境中创建的用户和角色在生产环境中有效，这一点很重要）和技术管理生产环境中的用户和角色。</span><span class="sxs-lookup"><span data-stu-id="6bbbb-257">Other challenges we touched on center around synchronizing the application name used in the development and production environments (which is important if you want users and roles created in the development environment to be valid on production) and techniques for managing the users and roles in the production environment.</span></span>

<span data-ttu-id="6bbbb-258">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="6bbbb-258">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="6bbbb-259">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="6bbbb-259">Further Reading</span></span>

<span data-ttu-id="6bbbb-260">有关本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="6bbbb-260">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="6bbbb-261">*ASP.NET SQL Server 注册工具（aspnet_regsql .exe）* </span><span class="sxs-lookup"><span data-stu-id="6bbbb-261">*ASP.NET SQL Server Registration Tool (aspnet_regsql.exe)*</span></span>](https://msdn.microsoft.com/library/ms229862.aspx)
- [<span data-ttu-id="6bbbb-262">*为 SQL Server 创建应用程序服务数据库*</span><span class="sxs-lookup"><span data-stu-id="6bbbb-262">*Creating the Application Services Database for SQL Server*</span></span>](https://msdn.microsoft.com/library/x28wfk74.aspx)
- [<span data-ttu-id="6bbbb-263">*在 SQL Server 中创建成员身份架构*</span><span class="sxs-lookup"><span data-stu-id="6bbbb-263">*Creating the Membership Schema in SQL Server*</span></span>](../../older-versions-security/membership/creating-the-membership-schema-in-sql-server-vb.md)
- [<span data-ttu-id="6bbbb-264">*检查 ASP.NET 的成员资格、角色和配置文件*</span><span class="sxs-lookup"><span data-stu-id="6bbbb-264">*Examining ASP.NET s Membership, Roles, and Profile*</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="6bbbb-265">*滚动你自己的网站管理工具*</span><span class="sxs-lookup"><span data-stu-id="6bbbb-265">*Rolling Your Own Web Site Administration Tool*</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)
- [<span data-ttu-id="6bbbb-266">*网站安全教程*</span><span class="sxs-lookup"><span data-stu-id="6bbbb-266">*Website Security Tutorials*</span></span>](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)
- [<span data-ttu-id="6bbbb-267">*网站管理工具概述*</span><span class="sxs-lookup"><span data-stu-id="6bbbb-267">*Web Site Administration Tool Overview*</span></span>](https://msdn.microsoft.com/library/yy40ytx0.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="6bbbb-268">[上一页](configuring-the-production-web-application-to-use-the-production-database-vb.md)
> [下一页](strategies-for-database-development-and-deployment-vb.md)</span><span class="sxs-lookup"><span data-stu-id="6bbbb-268">[Previous](configuring-the-production-web-application-to-use-the-production-database-vb.md)
[Next](strategies-for-database-development-and-deployment-vb.md)</span></span>
