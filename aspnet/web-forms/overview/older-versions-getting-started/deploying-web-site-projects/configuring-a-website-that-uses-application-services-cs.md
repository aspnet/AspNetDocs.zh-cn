---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-a-website-that-uses-application-services-cs
title: 配置网站使用应用程序服务 (C#) |Microsoft Docs
author: rick-anderson
description: ASP.NET 2.0 版引入了一系列的应用程序服务，这是.NET Framework 的一部分，作为构建基块的一套服务 yo...
ms.author: riande
ms.date: 04/23/2009
ms.assetid: 1e33d1c6-3f9f-4c26-81e2-2a8f8907bb05
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-a-website-that-uses-application-services-cs
msc.type: authoredcontent
ms.openlocfilehash: b9488a294de8f23ecd2b22812d728a5904a8ef18
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/06/2019
ms.locfileid: "65106861"
---
# <a name="configuring-a-website-that-uses-application-services-c"></a><span data-ttu-id="d449b-103">配置使用应用程序服务的网站 (C#)</span><span class="sxs-lookup"><span data-stu-id="d449b-103">Configuring a Website that Uses Application Services (C#)</span></span>

<span data-ttu-id="d449b-104">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="d449b-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="d449b-105">[下载代码](http://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_09_CS.zip)或[下载 PDF](http://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial09_AppServicesConfig_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="d449b-105">[Download Code](http://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_09_CS.zip) or [Download PDF](http://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial09_AppServicesConfig_cs.pdf)</span></span>

> <span data-ttu-id="d449b-106">ASP.NET 2.0 版引入了一系列的应用程序服务，这是.NET Framework 的一部分，作为一套可用于将丰富的功能添加到 web 应用程序的构建基块服务。</span><span class="sxs-lookup"><span data-stu-id="d449b-106">ASP.NET version 2.0 introduced a series of application services, which are part of the .NET Framework and serve as a suite of building block services that you can use to add rich functionality to your web application.</span></span> <span data-ttu-id="d449b-107">本教程探讨了如何在要使用应用程序服务的生产环境中配置一个网站，并解决了管理用户帐户和角色在生产环境的常见问题。</span><span class="sxs-lookup"><span data-stu-id="d449b-107">This tutorial explores how to configure a website in the production environment to use application services and addresses common issues with managing user accounts and roles on the production environment.</span></span>

## <a name="introduction"></a><span data-ttu-id="d449b-108">介绍</span><span class="sxs-lookup"><span data-stu-id="d449b-108">Introduction</span></span>

<span data-ttu-id="d449b-109">ASP.NET 2.0 版引入了一系列*应用程序服务*，这是.NET Framework 的一部分，作为构建基块的一套服务可用于对 web 应用程序添加丰富的功能。</span><span class="sxs-lookup"><span data-stu-id="d449b-109">ASP.NET version 2.0 introduced a series of *application services*, which are part of the .NET Framework and serve as a suite of building block services that you can use to add rich functionality to your web application.</span></span> <span data-ttu-id="d449b-110">应用程序服务包括：</span><span class="sxs-lookup"><span data-stu-id="d449b-110">The application services include:</span></span>

- <span data-ttu-id="d449b-111">**成员资格**-用于创建和管理用户帐户的 API。</span><span class="sxs-lookup"><span data-stu-id="d449b-111">**Membership** - an API for creating and managing user accounts.</span></span>
- <span data-ttu-id="d449b-112">**角色**-用于将用户分类为组的 API。</span><span class="sxs-lookup"><span data-stu-id="d449b-112">**Roles** - an API for categorizing users into groups.</span></span>
- <span data-ttu-id="d449b-113">**配置文件**-用于存储自定义的特定于用户的内容的 API。</span><span class="sxs-lookup"><span data-stu-id="d449b-113">**Profile** - an API for storing custom, user-specific content.</span></span>
- <span data-ttu-id="d449b-114">**站点地图**-用于在层次结构，则可以通过导航控件，如菜单和痕迹导航栏显示的窗体中定义站点 s 逻辑结构的 API。</span><span class="sxs-lookup"><span data-stu-id="d449b-114">**Site Map** - an API for defining a site s logical structure in the form of a hierarchy, which can then be displayed via navigation controls, such as menus and breadcrumbs.</span></span>
- <span data-ttu-id="d449b-115">**个性化**-用于维护自定义项首选项，通常与一起使用的 API [ *web 部件*](https://msdn.microsoft.com/library/e0s9t4ck.aspx)。</span><span class="sxs-lookup"><span data-stu-id="d449b-115">**Personalization** - an API for maintaining customization preferences, most often used with [*WebParts*](https://msdn.microsoft.com/library/e0s9t4ck.aspx).</span></span>
- <span data-ttu-id="d449b-116">**运行状况监视**-用于监视性能、 安全性、 错误和运行的 web 应用程序其他系统运行状况指标的 API。</span><span class="sxs-lookup"><span data-stu-id="d449b-116">**Health Monitoring** - an API for monitoring performance, security, errors, and other system health metrics for a running web application.</span></span>

<span data-ttu-id="d449b-117">应用程序服务 Api 不受限于特定的实现。</span><span class="sxs-lookup"><span data-stu-id="d449b-117">The application services APIs are not tied to a specific implementation.</span></span> <span data-ttu-id="d449b-118">相反，指示要使用特定的应用程序服务*提供程序*，并且该提供程序实现使用特定技术的服务。</span><span class="sxs-lookup"><span data-stu-id="d449b-118">Instead, you instruct the application services to use a particular *provider*, and that provider implements the service using a particular technology.</span></span> <span data-ttu-id="d449b-119">在 web 托管公司托管的基于 Internet 的 web 应用程序最常使用的提供商将使用 SQL Server 数据库实现这些提供程序。</span><span class="sxs-lookup"><span data-stu-id="d449b-119">The most commonly used providers for Internet-based web applications hosted at a web hosting company are those providers that use a SQL Server database implementation.</span></span> <span data-ttu-id="d449b-120">例如，`SqlMembershipProvider`是将用户帐户信息存储在 Microsoft SQL Server 数据库中的成员身份 API 的提供程序。</span><span class="sxs-lookup"><span data-stu-id="d449b-120">For example, the `SqlMembershipProvider` is a provider for the Membership API that stores user account information in a Microsoft SQL Server database.</span></span>

<span data-ttu-id="d449b-121">部署应用程序时使用的应用程序服务和 SQL Server 提供程序添加一些挑战。</span><span class="sxs-lookup"><span data-stu-id="d449b-121">Using the application services and SQL Server providers adds some challenges when deploying the application.</span></span> <span data-ttu-id="d449b-122">对于初学者而言，必须正确地开发和生产数据库上创建应用程序服务数据库对象并将其正确地初始化。</span><span class="sxs-lookup"><span data-stu-id="d449b-122">For starters, the application services database objects must be properly created on both the development and production databases and appropriately initialized.</span></span> <span data-ttu-id="d449b-123">也有不需要进行重要的配置设置。</span><span class="sxs-lookup"><span data-stu-id="d449b-123">There are also important configuration settings that need to be made.</span></span>

> [!NOTE]
> <span data-ttu-id="d449b-124">Api 设计使用的应用程序服务[*提供程序模型*](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)，允许 API s 的实现详细信息，以在运行时提供的设计模式。</span><span class="sxs-lookup"><span data-stu-id="d449b-124">The application services APIs were designed using the [*provider model*](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx), a design pattern that allows for an API s implementation details to be provided at runtime.</span></span> <span data-ttu-id="d449b-125">.NET Framework 提供了很多的应用程序服务提供程序可以使用，如`SqlMembershipProvider`和`SqlRoleProvider`、 哪些是提供程序的成员身份和角色 Api，使用 SQL Server 数据库实现。</span><span class="sxs-lookup"><span data-stu-id="d449b-125">The .NET Framework ships with a number of application service providers that can be used, such as the `SqlMembershipProvider` and `SqlRoleProvider`, which are providers for the Membership and Roles APIs that use a SQL Server database implementation.</span></span> <span data-ttu-id="d449b-126">此外可以创建插件和自定义提供程序。</span><span class="sxs-lookup"><span data-stu-id="d449b-126">You can also create and plug-in a custom provider.</span></span> <span data-ttu-id="d449b-127">事实上，书评 web 应用程序已包含站点映射 API 的自定义提供程序 (`ReviewSiteMapProvider`)，该构造中的数据从站点地图`Genres`和`Books`数据库中的表。</span><span class="sxs-lookup"><span data-stu-id="d449b-127">In fact, the Book Reviews web application already contains a custom provider for the Site Map API (`ReviewSiteMapProvider`), which constructs the site map from the data in the `Genres` and `Books` tables in the database.</span></span>

<span data-ttu-id="d449b-128">本教程开始，看我如何扩展书评 web 应用程序以使用成员资格和角色 Api。</span><span class="sxs-lookup"><span data-stu-id="d449b-128">This tutorial starts with a look at how I extended the Book Reviews web application to use the Membership and Roles APIs.</span></span> <span data-ttu-id="d449b-129">它然后演示如何部署应用程序服务使用 SQL Server 数据库实现，并通过解决常见的问题管理用户帐户和角色在生产环境以结束的 web 应用程序。</span><span class="sxs-lookup"><span data-stu-id="d449b-129">It then walks through deploying a web application that uses application services with a SQL Server database implementation, and concludes by addressing common issues with managing user accounts and roles on the production environment.</span></span>

## <a name="updates-to-the-book-reviews-application"></a><span data-ttu-id="d449b-130">通讯簿评审应用程序的更新</span><span class="sxs-lookup"><span data-stu-id="d449b-130">Updates to the Book Reviews Application</span></span>

<span data-ttu-id="d449b-131">过去的几通讯簿评审 web 应用程序已更新从静态网站，以动态、 数据驱动的 web 应用程序的教程使用一组管理页用于管理流派和评审完成。</span><span class="sxs-lookup"><span data-stu-id="d449b-131">Over the past couple tutorials the Book Reviews web application was updated from a static website to a dynamic, data-driven web application complete with a set of administration pages for managing genres and reviews.</span></span> <span data-ttu-id="d449b-132">但是，本部分中管理当前不受保护-任何用户都知道 （或猜测） 管理页面的 URL 可以 waltz 中和创建、 编辑或删除我们的网站上的评论。</span><span class="sxs-lookup"><span data-stu-id="d449b-132">However, this administration section is currently not protected - any user who knows (or guesses) the administration page URL can waltz in and create, edit, or delete reviews on our site.</span></span> <span data-ttu-id="d449b-133">若要保护的网站的某些部分的常用方法是实现用户帐户，然后使用 URL 授权规则来限制对特定用户或角色的访问。</span><span class="sxs-lookup"><span data-stu-id="d449b-133">A common way to protect certain portions of a website is to implement user accounts and then use URL authorization rules to restrict access to certain users or roles.</span></span> <span data-ttu-id="d449b-134">可供下载与本教程中的书评 web 应用程序支持用户帐户和角色。</span><span class="sxs-lookup"><span data-stu-id="d449b-134">The Book Reviews web application available for download with this tutorial supports user accounts and roles.</span></span> <span data-ttu-id="d449b-135">它具有单个角色定义名为管理员和只有此角色中的用户可以访问的管理页面。</span><span class="sxs-lookup"><span data-stu-id="d449b-135">It has a single role defined named Admin and only users in this role can access the administration pages.</span></span>

> [!NOTE]
> <span data-ttu-id="d449b-136">我 ve 书评 web 应用程序中创建三个用户帐户：Scott、 Jisun 和 Alice。</span><span class="sxs-lookup"><span data-stu-id="d449b-136">I ve created three user accounts in the Book Reviews web application: Scott, Jisun, and Alice.</span></span> <span data-ttu-id="d449b-137">所有三个用户具有相同的密码：**密码 ！**</span><span class="sxs-lookup"><span data-stu-id="d449b-137">All three users have the same password: **password!**</span></span> <span data-ttu-id="d449b-138">Scott 和 Jisun 是管理员角色中，Alice 不是。</span><span class="sxs-lookup"><span data-stu-id="d449b-138">Scott and Jisun are in the Admin role, Alice is not.</span></span> <span data-ttu-id="d449b-139">仍可供匿名用户访问站点 s 非管理页面。</span><span class="sxs-lookup"><span data-stu-id="d449b-139">The site s non-administration pages are still accessible to anonymous users.</span></span> <span data-ttu-id="d449b-140">也就是说，不需要登录以访问站点，除非你想要管理它，这种情况下您必须登录为管理员角色中的用户。</span><span class="sxs-lookup"><span data-stu-id="d449b-140">That is, you do not need to sign in to visit the site, unless you want to administer it, in which case you must sign in as a user in the Admin role.</span></span>

<span data-ttu-id="d449b-141">书评应用程序的母版页进行已更新，包括已经过身份验证和匿名用户的不同的用户界面。</span><span class="sxs-lookup"><span data-stu-id="d449b-141">The Book Reviews application s master page has been updated to include a different user interface for authenticated and anonymous users.</span></span> <span data-ttu-id="d449b-142">如果匿名用户访问该网站她会看到右上角的登录链接。</span><span class="sxs-lookup"><span data-stu-id="d449b-142">If an anonymous user visits the site she sees a Login link in the upper right corner.</span></span> <span data-ttu-id="d449b-143">身份验证的用户将看到此消息，"欢迎回来，*用户名*！"</span><span class="sxs-lookup"><span data-stu-id="d449b-143">An authenticated user sees the message, "Welcome back, *username*!"</span></span> <span data-ttu-id="d449b-144">并将其注销的链接。此处 s 还登录页 (`~/Login.aspx`)，其中包含提供用户界面和逻辑，用于对访问者进行身份验证的登录名 Web 控件。</span><span class="sxs-lookup"><span data-stu-id="d449b-144">and a link to log out. There s also a login page (`~/Login.aspx`), which contains a Login Web control that provides the user interface and logic for authenticating a visitor.</span></span> <span data-ttu-id="d449b-145">只有管理员才能创建新帐户。</span><span class="sxs-lookup"><span data-stu-id="d449b-145">Only administrators can create new accounts.</span></span> <span data-ttu-id="d449b-146">(用于创建和管理中的用户帐户的页面`~/Admin`文件夹。)</span><span class="sxs-lookup"><span data-stu-id="d449b-146">(There are pages for creating and managing user accounts in the `~/Admin` folder.)</span></span>

### <a name="configuring-the-membership-and-roles-apis"></a><span data-ttu-id="d449b-147">配置成员资格和角色 Api</span><span class="sxs-lookup"><span data-stu-id="d449b-147">Configuring the Membership and Roles APIs</span></span>

<span data-ttu-id="d449b-148">书评 web 应用程序使用的成员身份和角色 Api 以支持用户帐户并向角色 （即管理员角色） 对这些用户进行分组。</span><span class="sxs-lookup"><span data-stu-id="d449b-148">The Book Reviews web application uses the Membership and Roles APIs to support user accounts and to group those users into roles (namely, the Admin role).</span></span> <span data-ttu-id="d449b-149">`SqlMembershipProvider`和`SqlRoleProvider`使用提供程序类是因为我们想要在 SQL Server 数据库中存储帐户和角色的信息。</span><span class="sxs-lookup"><span data-stu-id="d449b-149">The `SqlMembershipProvider` and `SqlRoleProvider` provider classes are used because we want to store account and role information in a SQL Server database.</span></span>

> [!NOTE]
> <span data-ttu-id="d449b-150">本教程不是要在 web 应用程序配置为支持的成员身份和角色 Api 进行详尽。</span><span class="sxs-lookup"><span data-stu-id="d449b-150">This tutorial is not intended to be a detailed examination at configuring a web application to support the Membership and Roles APIs.</span></span> <span data-ttu-id="d449b-151">有关这些 Api，需要配置网站以使用它们所采取的步骤的全面信息，请阅读我[*网站安全教程*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)。</span><span class="sxs-lookup"><span data-stu-id="d449b-151">For a thorough look at these APIs and the steps you need to take to configure a website to use them, please read my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

<span data-ttu-id="d449b-152">若要使用 SQL Server 数据库使用的应用程序服务必须首先添加使用这些提供程序到数据库用户帐户所需的数据库对象和存储角色信息。</span><span class="sxs-lookup"><span data-stu-id="d449b-152">To use the application services with a SQL Server database you must first add the database objects used by these providers to the database where you want the user account and role information stored.</span></span> <span data-ttu-id="d449b-153">这些必要的数据库对象包括各种表、 视图和存储的过程。</span><span class="sxs-lookup"><span data-stu-id="d449b-153">These requisite database objects include a variety of tables, views, and stored procedures.</span></span> <span data-ttu-id="d449b-154">除非另有指定，`SqlMembershipProvider`并`SqlRoleProvider`提供程序类使用名为的 SQL Server Express Edition 数据库`ASPNETDB`位于应用程序的`App_Data`文件夹; 如果此类数据库不存在，它将自动创建通过在运行时这些提供程序的必要的数据库对象。</span><span class="sxs-lookup"><span data-stu-id="d449b-154">Unless specified otherwise, the `SqlMembershipProvider` and `SqlRoleProvider` provider classes use a SQL Server Express Edition database named `ASPNETDB` located in the application s `App_Data` folder; if such a database does not exist, it is automatically created with the necessary database objects by these providers at runtime.</span></span>

<span data-ttu-id="d449b-155">可能实现，且通常的理想之选，创建应用程序服务网站 s 特定于应用程序数据的存储位置在同一数据库中的数据库对象。</span><span class="sxs-lookup"><span data-stu-id="d449b-155">It is possible, and usually ideal, to create the application services database objects in the same database where the website s application-specific data is stored.</span></span> <span data-ttu-id="d449b-156">.NET Framework 附带了一个名为工具`aspnet_regsql.exe`用于指定数据库上安装的数据库对象。</span><span class="sxs-lookup"><span data-stu-id="d449b-156">The .NET Framework ships with a tool named `aspnet_regsql.exe` that installs the database objects on a specified database.</span></span> <span data-ttu-id="d449b-157">我已提前，并使用此工具将添加到这些对象`Reviews.mdf`数据库中`App_Data`文件夹 （开发数据库）。</span><span class="sxs-lookup"><span data-stu-id="d449b-157">I have gone ahead and used this tool to add these objects to the `Reviews.mdf` database in the `App_Data` folder (the development database).</span></span> <span data-ttu-id="d449b-158">我们将了解如何在本教程后面使用此工具，当我们将这些对象添加到生产数据库。</span><span class="sxs-lookup"><span data-stu-id="d449b-158">We'll see how to use this tool later in this tutorial when we add these objects to the production database.</span></span>

<span data-ttu-id="d449b-159">如果应用程序服务数据库的数据库对象而不添加`ASPNETDB`将需要自定义`SqlMembershipProvider`和`SqlRoleProvider`提供程序类配置，以便他们使用相应的数据库。</span><span class="sxs-lookup"><span data-stu-id="d449b-159">If you add the application services database objects to a database other than `ASPNETDB` you will need to customize the `SqlMembershipProvider` and `SqlRoleProvider` provider classes configurations so that they use the appropriate database.</span></span> <span data-ttu-id="d449b-160">若要自定义成员资格提供程序添加[ *&lt;成员身份&gt;元素*](https://msdn.microsoft.com/library/1b9hw62f.aspx)内`<system.web>`中`Web.config`; 使用[ *&lt;roleManager&gt;元素*](https://msdn.microsoft.com/library/ms164660.aspx)配置角色提供程序。</span><span class="sxs-lookup"><span data-stu-id="d449b-160">To customize the Membership provider add a [*&lt;membership&gt; element*](https://msdn.microsoft.com/library/1b9hw62f.aspx) within the `<system.web>` section in `Web.config`; use the [*&lt;roleManager&gt; element*](https://msdn.microsoft.com/library/ms164660.aspx) to configure the Roles provider.</span></span> <span data-ttu-id="d449b-161">以下代码片段取自书评应用程序的`Web.config`和显示了成员资格和角色 Api 的配置设置。</span><span class="sxs-lookup"><span data-stu-id="d449b-161">The following snippet is taken from the Book Reviews application s `Web.config` and shows the configure settings for the Membership and Roles APIs.</span></span> <span data-ttu-id="d449b-162">请注意，同时注册新的提供程序-`ReviewMembership`并`ReviewRole`-使用`SqlMembershipProvider`和`SqlRoleProvider`提供程序，分别。</span><span class="sxs-lookup"><span data-stu-id="d449b-162">Note that both register a new provider - `ReviewMembership` and `ReviewRole` - that use the `SqlMembershipProvider` and `SqlRoleProvider` providers, respectively.</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-cs/samples/sample1.xml)]

<span data-ttu-id="d449b-163">`Web.config`文件的`<authentication>`元素同时已配置为支持基于窗体的身份验证。</span><span class="sxs-lookup"><span data-stu-id="d449b-163">The `Web.config` file s `<authentication>` element has also been configured to support forms-based authentication.</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-cs/samples/sample2.xml)]

### <a name="limiting-access-to-the-administration-pages"></a><span data-ttu-id="d449b-164">限制对管理页的访问</span><span class="sxs-lookup"><span data-stu-id="d449b-164">Limiting Access to the Administration Pages</span></span>

<span data-ttu-id="d449b-165">ASP.NET 可以轻松授予或拒绝访问特定文件或文件夹由用户或角色通过其*URL 授权*功能。</span><span class="sxs-lookup"><span data-stu-id="d449b-165">ASP.NET makes it easy to grant or deny access to a particular file or folder by user or by role via its *URL authorization* feature.</span></span> <span data-ttu-id="d449b-166">(我们简要讨论了中的 URL 授权*核心 IIS 之间的差异和 ASP.NET Development Server*教程介绍了 IIS 和 ASP.NET Development Server 将以不同的方式为静态的 URL 授权规则的应用与动态内容。）因为我们想要禁止访问`~/Admin`除管理员角色的用户文件夹中，我们需要将 URL 授权规则添加到此文件夹。</span><span class="sxs-lookup"><span data-stu-id="d449b-166">(We briefly discussed URL authorization in the *Core Differences Between IIS and the ASP.NET Development Server* tutorial and showed how IIS and the ASP.NET Development Server apply URL authorization rules differently for static versus dynamic content.) Because we want to prohibit access to the `~/Admin` folder except for those users in the Admin role, we need to add URL authorization rules to this folder.</span></span> <span data-ttu-id="d449b-167">具体而言，URL 授权规则需要允许管理员角色中的用户并拒绝所有其他用户。</span><span class="sxs-lookup"><span data-stu-id="d449b-167">Specifically, the URL authorization rules need to allow users in the Admin role and deny all other users.</span></span> <span data-ttu-id="d449b-168">这可以通过添加`Web.config`文件为`~/Admin`文件夹包含以下内容：</span><span class="sxs-lookup"><span data-stu-id="d449b-168">This is accomplished by adding a `Web.config` file to the `~/Admin` folder with the following contents:</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-cs/samples/sample3.xml)]

<span data-ttu-id="d449b-169">有关 ASP.NET 的 URL 授权功能以及如何使用它为用户和角色的授权规则明确说明的详细信息请阅读[*基于用户的授权*](../../older-versions-security/membership/user-based-authorization-cs.md)和[*基于角色的授权*](../../older-versions-security/roles/role-based-authorization-cs.md)教程从我[*网站安全教程*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)。</span><span class="sxs-lookup"><span data-stu-id="d449b-169">For more information on ASP.NET s URL authorization feature and how to use it to spell out authorization rules for users and for roles, be sure to read the [*User-Based Authorization*](../../older-versions-security/membership/user-based-authorization-cs.md) and [*Role-Based Authorization*](../../older-versions-security/roles/role-based-authorization-cs.md) tutorials from my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

## <a name="deploying-a-web-application-that-uses-application-services"></a><span data-ttu-id="d449b-170">部署 Web 应用程序使用应用程序服务</span><span class="sxs-lookup"><span data-stu-id="d449b-170">Deploying a Web Application That Uses Application Services</span></span>

<span data-ttu-id="d449b-171">在部署时使用应用程序服务和应用程序服务信息存储在数据库中的提供程序的网站，它是命令性，在生产数据库中创建所需的应用程序服务的数据库对象。</span><span class="sxs-lookup"><span data-stu-id="d449b-171">When deploying a website that uses application services and a provider that stores the application services information in a database, it is imperative that the database objects needed by the application services be created on the production database.</span></span> <span data-ttu-id="d449b-172">最初生产数据库不包含这些对象，因此首次部署应用程序时 （或第一次后添加的应用程序服务部署时），必须采取额外步骤来获取这些必备项的数据库对象上生产数据库。</span><span class="sxs-lookup"><span data-stu-id="d449b-172">Initially the production database does not contain these objects, so when the application is first deployed (or when it is deployed for the first time after application services have been added), you must take extra steps to get these requisite database objects on the production database.</span></span>

<span data-ttu-id="d449b-173">部署使用应用程序服务，如果你想要复制到生产环境在开发环境中创建的用户帐户的网站时，可能会发生另一项挑战。</span><span class="sxs-lookup"><span data-stu-id="d449b-173">Another challenge can arise when deploying a website that uses application services if you intend to replicate the user accounts created in the development environment to the production environment.</span></span> <span data-ttu-id="d449b-174">根据成员资格和角色的配置，就可以，即使在成功复制到生产数据库在开发环境中创建的用户帐户，这些用户将无法登录到在生产环境中的 web 应用程序。</span><span class="sxs-lookup"><span data-stu-id="d449b-174">Depending on the Membership and Roles configuration, it is possible that even if you successfully copy the user accounts that were created in the development environment to the production database, these users cannot sign into the web application in production.</span></span> <span data-ttu-id="d449b-175">我们将看一下此问题的原因，并讨论如何避免这种情况发生。</span><span class="sxs-lookup"><span data-stu-id="d449b-175">We'll look at the cause of this issue and discuss how to prevent it from happening.</span></span>

<span data-ttu-id="d449b-176">ASP.NET 附带有效果很好[*网站管理工具 (WSAT)* ](https://msdn.microsoft.com/library/yy40ytx0.aspx) ，可以从 Visual Studio 启动，并允许用户通过基于 web 的管理帐户、 角色和授权规则接口。</span><span class="sxs-lookup"><span data-stu-id="d449b-176">ASP.NET ships with a nice [*Web Site Administration Tool (WSAT)*](https://msdn.microsoft.com/library/yy40ytx0.aspx) that can be launched from Visual Studio and allows the user account, roles, and authorization rules to be managed through a web-based interface.</span></span> <span data-ttu-id="d449b-177">遗憾的是，WSAT 仅适用于本地网站，这意味着它不能用于远程管理用户帐户、 角色和 web 应用程序在生产环境中的授权规则。</span><span class="sxs-lookup"><span data-stu-id="d449b-177">Unfortunately, the WSAT only works for local websites, meaning that it cannot be used to remotely manage user accounts, roles, and authorization rules for the web application in the production environment.</span></span> <span data-ttu-id="d449b-178">我们将介绍不同的方式来实现从你的生产网站 WSAT 类似的行为。</span><span class="sxs-lookup"><span data-stu-id="d449b-178">We'll look at different ways to implement WSAT-like behavior from your production website.</span></span>

### <a name="adding-the-database-objects-using-aspnetregsqlexe"></a><span data-ttu-id="d449b-179">添加数据库对象使用 aspnet\_regsql.exe</span><span class="sxs-lookup"><span data-stu-id="d449b-179">Adding the Database Objects Using aspnet\_regsql.exe</span></span>

<span data-ttu-id="d449b-180">*部署数据库*教程介绍了如何将表和数据开发数据库复制到生产数据库，以及这些技术确实可以用来复制到的应用程序服务数据库对象生产数据库。</span><span class="sxs-lookup"><span data-stu-id="d449b-180">The *Deploying a Database* tutorial showed how to copy the tables and data from the development database to the production database, and these techniques can certainly be used to copy the application services database objects to the production database.</span></span> <span data-ttu-id="d449b-181">另一个选项是`aspnet_regsql.exe`工具，它将添加或从数据库中删除应用程序服务数据库对象。</span><span class="sxs-lookup"><span data-stu-id="d449b-181">Another option is the `aspnet_regsql.exe` tool, which adds or removes the application services database objects from a database.</span></span>

> [!NOTE]
> <span data-ttu-id="d449b-182">`aspnet_regsql.exe`工具指定数据库上创建数据库对象。</span><span class="sxs-lookup"><span data-stu-id="d449b-182">The `aspnet_regsql.exe` tool creates the database objects on a specified database.</span></span> <span data-ttu-id="d449b-183">但不会对生产数据库从开发数据库迁移这些数据库对象中的数据。</span><span class="sxs-lookup"><span data-stu-id="d449b-183">It does not migrate data in those database objects from the development database to the production database.</span></span> <span data-ttu-id="d449b-184">如果你是想将开发数据库中的用户帐户和角色信息复制到生产数据库使用中介绍的技术*部署数据库*教程。</span><span class="sxs-lookup"><span data-stu-id="d449b-184">If you mean to copy the user account and role information in the development database to the production database use the techniques covered in the *Deploying a Database* tutorial.</span></span>

<span data-ttu-id="d449b-185">让我们来看看如何将数据库对象添加到生产数据库使用`aspnet_regsql.exe`工具。</span><span class="sxs-lookup"><span data-stu-id="d449b-185">Let s look at how to add the database objects to the production database using the `aspnet_regsql.exe` tool.</span></span> <span data-ttu-id="d449b-186">首先，打开 Windows 资源管理器并导航到 %WINDIR%\ 您的计算机上的.NET Framework 2.0 版目录Microsoft.NET\Framework\v2.0.50727。</span><span class="sxs-lookup"><span data-stu-id="d449b-186">Start by opening Windows Explorer and navigating to the .NET Framework version 2.0 directory on your computer, %WINDIR%\ Microsoft.NET\Framework\v2.0.50727.</span></span> <span data-ttu-id="d449b-187">会显示`aspnet_regsql.exe`工具。</span><span class="sxs-lookup"><span data-stu-id="d449b-187">There you should find the `aspnet_regsql.exe` tool.</span></span> <span data-ttu-id="d449b-188">可以使用此工具从命令行中，但它还包括图形用户界面;双击`aspnet_regsql.exe`文件以启动其图形组件。</span><span class="sxs-lookup"><span data-stu-id="d449b-188">This tool can be used from the command-line, but it also includes a graphical user interface; double-click the `aspnet_regsql.exe` file to launch its graphical component.</span></span>

<span data-ttu-id="d449b-189">该工具首先会显示初始屏幕，说明其用途。</span><span class="sxs-lookup"><span data-stu-id="d449b-189">The tool starts by displaying a splash screen explaining its purpose.</span></span> <span data-ttu-id="d449b-190">单击旁边转到"选择安装程序选项"屏幕中，图 1 所示。</span><span class="sxs-lookup"><span data-stu-id="d449b-190">Click Next to advance to the "Select a Setup Option" screen, which is shown in Figure 1.</span></span> <span data-ttu-id="d449b-191">从此处可以选择要添加的应用程序服务数据库对象或从数据库中删除它们。</span><span class="sxs-lookup"><span data-stu-id="d449b-191">From here you can choose to add the application services database objects or remove them from a database.</span></span> <span data-ttu-id="d449b-192">因为我们想要将这些对象添加到生产数据库，选择"配置应用程序服务的 SQL Server"选项，并单击下一步。</span><span class="sxs-lookup"><span data-stu-id="d449b-192">Because we want to add these objects to the production database, select the "Configure SQL Server for application services" option and click Next.</span></span>

<span data-ttu-id="d449b-193">[![选择 SQL Server 配置为应用程序服务](configuring-a-website-that-uses-application-services-cs/_static/image2.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image1.jpg)</span><span class="sxs-lookup"><span data-stu-id="d449b-193">[![Choose to Configure SQL Server for Application Services](configuring-a-website-that-uses-application-services-cs/_static/image2.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image1.jpg)</span></span>

<span data-ttu-id="d449b-194">**图 1**:配置 SQL server 选择的应用程序服务 ([单击此项可查看原尺寸图像](configuring-a-website-that-uses-application-services-cs/_static/image3.jpg))</span><span class="sxs-lookup"><span data-stu-id="d449b-194">**Figure 1**: Choose to Configure SQL Server for Application Services ([Click to view full-size image](configuring-a-website-that-uses-application-services-cs/_static/image3.jpg))</span></span>

<span data-ttu-id="d449b-195">在"选择服务器和数据库"屏幕提示输入信息以连接到数据库。</span><span class="sxs-lookup"><span data-stu-id="d449b-195">In "Select the Server and Database" screen prompts for information to connect to the database.</span></span> <span data-ttu-id="d449b-196">输入数据库服务器、 安全凭据，并为您提供您的 web 托管公司的数据库名称，然后单击下一步。</span><span class="sxs-lookup"><span data-stu-id="d449b-196">Enter the database server, the security credentials, and the database name supplied to you by your web hosting company and click Next.</span></span>

> [!NOTE]
> <span data-ttu-id="d449b-197">输入您的数据库服务器和凭据后可能会遇到错误，展开数据库下拉列表时。</span><span class="sxs-lookup"><span data-stu-id="d449b-197">After entering your database server and credentials you may get an error when expanding the database drop-down list.</span></span> <span data-ttu-id="d449b-198">`aspnet_regsql.exe`工具查询`sysdatabases`系统表检索的数据库服务器，但一些 web 托管公司锁定其数据库服务器，以便此信息不是公用的列表。</span><span class="sxs-lookup"><span data-stu-id="d449b-198">The `aspnet_regsql.exe` tool queries the `sysdatabases` system table to retrieve a list of databases on the server, but some web hosting companies lock down their database servers so that this information is not publicly available.</span></span> <span data-ttu-id="d449b-199">如果收到此错误可以直接在下拉列表中键入数据库名称。</span><span class="sxs-lookup"><span data-stu-id="d449b-199">If you get this error you can type the database name directly into the drop-down list.</span></span>

<span data-ttu-id="d449b-200">[![提供你的数据库的连接信息的工具](configuring-a-website-that-uses-application-services-cs/_static/image5.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image4.jpg)</span><span class="sxs-lookup"><span data-stu-id="d449b-200">[![Supply the Tool With Your Database s Connection Information](configuring-a-website-that-uses-application-services-cs/_static/image5.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image4.jpg)</span></span>

<span data-ttu-id="d449b-201">**图 2**:提供的工具与您的数据库 s 连接信息 ([单击此项可查看原尺寸图像](configuring-a-website-that-uses-application-services-cs/_static/image6.jpg))</span><span class="sxs-lookup"><span data-stu-id="d449b-201">**Figure 2**: Supply the Tool With Your Database s Connection Information ([Click to view full-size image](configuring-a-website-that-uses-application-services-cs/_static/image6.jpg))</span></span>

<span data-ttu-id="d449b-202">随后出现的屏幕总结了要执行的位置，即操作将应用程序服务数据库对象添加到指定的数据库。</span><span class="sxs-lookup"><span data-stu-id="d449b-202">The subsequent screen summarizes the actions that are about to take place, namely that the application services database objects are going to be added to the specified database.</span></span> <span data-ttu-id="d449b-203">单击旁边完成此操作。</span><span class="sxs-lookup"><span data-stu-id="d449b-203">Click Next to complete this action.</span></span> <span data-ttu-id="d449b-204">几分钟后的最后一个屏幕将显示，注意数据库对象已添加了 （参见图 3）。</span><span class="sxs-lookup"><span data-stu-id="d449b-204">After a few moments, the final screen is displayed, noting that the database objects have been added (see Figure 3).</span></span>

<span data-ttu-id="d449b-205">[![成功 ！应用程序服务数据库对象已添加到生产数据库](configuring-a-website-that-uses-application-services-cs/_static/image8.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image7.jpg)</span><span class="sxs-lookup"><span data-stu-id="d449b-205">[![Success! The Application Services Database Objects Were Added to the Production Database](configuring-a-website-that-uses-application-services-cs/_static/image8.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image7.jpg)</span></span>

<span data-ttu-id="d449b-206">**图 3**:成功！</span><span class="sxs-lookup"><span data-stu-id="d449b-206">**Figure 3**: Success!</span></span> <span data-ttu-id="d449b-207">应用程序服务数据库对象已添加到生产数据库 ([单击此项可查看原尺寸图像](configuring-a-website-that-uses-application-services-cs/_static/image9.jpg))</span><span class="sxs-lookup"><span data-stu-id="d449b-207">The Application Services Database Objects Were Added to the Production Database ([Click to view full-size image](configuring-a-website-that-uses-application-services-cs/_static/image9.jpg))</span></span>

<span data-ttu-id="d449b-208">若要验证应用程序服务数据库对象已成功添加到生产数据库，请打开 SQL Server Management Studio 并连接到您的生产数据库。</span><span class="sxs-lookup"><span data-stu-id="d449b-208">To verify that the application services database objects were successfully added to the production database, open SQL Server Management Studio and connect to your production database.</span></span> <span data-ttu-id="d449b-209">如图 4 所示，你应看到应用程序服务数据库表在数据库中， `aspnet_Applications`， `aspnet_Membership`， `aspnet_Users`，依次类推。</span><span class="sxs-lookup"><span data-stu-id="d449b-209">As Figure 4 shows, you should now see the application services database tables in your database, `aspnet_Applications`, `aspnet_Membership`, `aspnet_Users`, and so forth.</span></span>

<span data-ttu-id="d449b-210">[![确认数据库对象已添加到生产数据库](configuring-a-website-that-uses-application-services-cs/_static/image11.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image10.jpg)</span><span class="sxs-lookup"><span data-stu-id="d449b-210">[![Confirm That the Database Objects Were Added to the Production Database](configuring-a-website-that-uses-application-services-cs/_static/image11.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image10.jpg)</span></span>

<span data-ttu-id="d449b-211">**图 4**:确认数据库对象已添加到生产数据库 ([单击此项可查看原尺寸图像](configuring-a-website-that-uses-application-services-cs/_static/image12.jpg))</span><span class="sxs-lookup"><span data-stu-id="d449b-211">**Figure 4**: Confirm That the Database Objects Were Added to the Production Database ([Click to view full-size image](configuring-a-website-that-uses-application-services-cs/_static/image12.jpg))</span></span>

<span data-ttu-id="d449b-212">您只需要使用`aspnet_regsql.exe`工具时部署 web 应用程序第一次或首次使用应用程序服务启动后。</span><span class="sxs-lookup"><span data-stu-id="d449b-212">You will only need to use the `aspnet_regsql.exe` tool when deploying your web application for the first time or for the first time after you have started using the application services.</span></span> <span data-ttu-id="d449b-213">一旦这些数据库对象而无需重新添加或修改在生产数据库上。</span><span class="sxs-lookup"><span data-stu-id="d449b-213">Once these database objects are on the production database they won't need to be re-added or modified.</span></span>

### <a name="copying-user-accounts-from-development-to-production"></a><span data-ttu-id="d449b-214">复制从开发到生产环境的用户帐户</span><span class="sxs-lookup"><span data-stu-id="d449b-214">Copying User Accounts from Development to Production</span></span>

<span data-ttu-id="d449b-215">使用时`SqlMembershipProvider`并`SqlRoleProvider`提供程序类，以将应用程序服务信息存储在 SQL Server 数据库中，用户帐户和角色信息存储在数据库表，其中包括各种`aspnet_Users`， `aspnet_Membership`，`aspnet_Roles`，和`aspnet_UsersInRoles`，等等。</span><span class="sxs-lookup"><span data-stu-id="d449b-215">When using the `SqlMembershipProvider` and `SqlRoleProvider` provider classes to store the application services information in a SQL Server database, the user account and role information is stored in a variety of database tables, including `aspnet_Users`, `aspnet_Membership`, `aspnet_Roles`, and `aspnet_UsersInRoles`, among others.</span></span> <span data-ttu-id="d449b-216">如果在开发过程中创建用户帐户在开发环境中，可以通过将相应的记录复制适用数据库表中复制这些用户帐户在生产环境中。</span><span class="sxs-lookup"><span data-stu-id="d449b-216">If during development you create user accounts in the development environment you can replicate those user accounts in production by copying the corresponding records from the applicable database tables.</span></span> <span data-ttu-id="d449b-217">如果使用数据库发布向导来部署您可能还选择要复制的记录，这将导致在开发也是在生产环境中创建的用户帐户的应用程序服务数据库对象。</span><span class="sxs-lookup"><span data-stu-id="d449b-217">If you used the Database Publishing Wizard to deploy the application services database objects you may have also elected to copy the records, which would result in the user accounts created in development to also be on production.</span></span> <span data-ttu-id="d449b-218">但是，具体取决于您的配置设置，您可能会发现其帐户已在开发过程中创建并复制到生产这些用户将无法从生产网站登录。</span><span class="sxs-lookup"><span data-stu-id="d449b-218">But, depending on your configuration settings, you may find that those users whose accounts were created in development and copied to production are unable to login from the production website.</span></span> <span data-ttu-id="d449b-219">代表什么意思？</span><span class="sxs-lookup"><span data-stu-id="d449b-219">What gives?</span></span>

<span data-ttu-id="d449b-220">`SqlMembershipProvider`和`SqlRoleProvider`设计提供程序类，以便单一数据库可用作用户存储多个应用程序，其中每个应用程序可以从理论上讲，具有重叠的用户名的用户和角色具有相同名称。</span><span class="sxs-lookup"><span data-stu-id="d449b-220">The `SqlMembershipProvider` and `SqlRoleProvider` provider classes were designed such that a single database could serve as a user store for multiple applications, where each application could, in theory, have users with overlapping usernames and roles with the same name.</span></span> <span data-ttu-id="d449b-221">若要允许这种灵活性，数据库将保留一系列中的应用程序`aspnet_Applications`表和每个用户都使用其中一个应用程序相关联。</span><span class="sxs-lookup"><span data-stu-id="d449b-221">To allow for this flexibility, the database maintains a list of applications in the `aspnet_Applications` table, and each user is associated with one of these applications.</span></span> <span data-ttu-id="d449b-222">具体而言，`aspnet_Users`表中有`ApplicationId`列中的记录到每个用户关联在一起`aspnet_Applications`表。</span><span class="sxs-lookup"><span data-stu-id="d449b-222">Specifically, the `aspnet_Users` table has an `ApplicationId` column that ties each user to a record in the `aspnet_Applications` table.</span></span>

<span data-ttu-id="d449b-223">除了`ApplicationId`列中，`aspnet_Applications`该表还包括`ApplicationName`列中，它提供应用程序的更多的用户友好名称。</span><span class="sxs-lookup"><span data-stu-id="d449b-223">In addition to the `ApplicationId` column, the `aspnet_Applications` table also includes an `ApplicationName` column, which provides a more human-friendly name for the application.</span></span> <span data-ttu-id="d449b-224">当网站试图使用用户帐户，如验证从登录页上，用户的凭据必须告知`SqlMembershipProvider`类要使用的应用程序。</span><span class="sxs-lookup"><span data-stu-id="d449b-224">When a website attempts to work with a user account, such as validating a user s credentials from the login page, it must tell the `SqlMembershipProvider` class what application to work with.</span></span> <span data-ttu-id="d449b-225">它通常会通过提供应用程序名称，这并此值来自中的提供程序的配置`Web.config`-具体通过`applicationName`属性。</span><span class="sxs-lookup"><span data-stu-id="d449b-225">It usually does this by supplying the application name, and the this value comes from the provider s configuration in `Web.config` - specifically via the `applicationName` attribute.</span></span>

<span data-ttu-id="d449b-226">但会发生什么情况`applicationName`属性中未指定`Web.config`？</span><span class="sxs-lookup"><span data-stu-id="d449b-226">But what happens if the `applicationName` attribute is not specified in `Web.config`?</span></span> <span data-ttu-id="d449b-227">这种情况下成员资格系统使用的应用程序根路径为`applicationName`值。</span><span class="sxs-lookup"><span data-stu-id="d449b-227">In such a case the Membership system uses the application root path as the `applicationName` value.</span></span> <span data-ttu-id="d449b-228">如果`applicationName`属性中未显式设置`Web.config`，然后，则可能会开发环境和生产环境使用不同的应用程序的根，因此将无法与不同的应用程序相关联应用程序服务中的名称。</span><span class="sxs-lookup"><span data-stu-id="d449b-228">If the `applicationName` attribute is not explicitly set in `Web.config`, then, there is the possibility that the development environment and production environment use a different application root and therefore will be associated with different application names in the application services.</span></span> <span data-ttu-id="d449b-229">如果出现这种不匹配，则在开发环境中创建这些用户将具有`ApplicationId`与不匹配的值`ApplicationId`生产环境的值。</span><span class="sxs-lookup"><span data-stu-id="d449b-229">If such a mismatch occurs then those users created in the development environment will have an `ApplicationId` value that does not match with the `ApplicationId` value for the production environment.</span></span> <span data-ttu-id="d449b-230">最终结果是，这些用户将无法登录。</span><span class="sxs-lookup"><span data-stu-id="d449b-230">The net result is that those users won't be able to login.</span></span>

> [!NOTE]
> <span data-ttu-id="d449b-231">如果您发现自己处于这种情况下-使用用户帐户复制到生产环境且不匹配`ApplicationId`值-可以编写查询以更新这些不正确`ApplicationId`值到`ApplicationId`用于生产。</span><span class="sxs-lookup"><span data-stu-id="d449b-231">If you find yourself in this situation - with user accounts copied to production with a mismatched `ApplicationId` value - you could write a query to update these incorrect `ApplicationId` values to the `ApplicationId` used on production.</span></span> <span data-ttu-id="d449b-232">更新后，请在开发环境中创建的帐户的用户现在将能够登录到生产上的 web 应用程序。</span><span class="sxs-lookup"><span data-stu-id="d449b-232">Once updated, the users whose accounts were created on the development environment would now be able to sign into the web application on production.</span></span>

<span data-ttu-id="d449b-233">好消息是可用于确保两个环境使用相同的简单步骤`ApplicationId`-显式设置`applicationName`属性中`Web.config`所有应用程序服务提供程序。</span><span class="sxs-lookup"><span data-stu-id="d449b-233">The good news is that there is a simple step you can take to ensure that the two environments use the same `ApplicationId` - explicitly set the `applicationName` attribute in `Web.config` for all of your application services providers.</span></span> <span data-ttu-id="d449b-234">我显式设置`applicationName`属性为"BookReviews"中`<membership>`并`<roleManager>`元素中此代码片段作为`Web.config`显示。</span><span class="sxs-lookup"><span data-stu-id="d449b-234">I explicitly set the `applicationName` attribute to "BookReviews" in the `<membership>` and `<roleManager>` elements as this snippet from `Web.config` shows.</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-cs/samples/sample4.xml)]

<span data-ttu-id="d449b-235">有关设置的详细讨论`applicationName`属性和的基本原理，请参阅[ *Scott Guthrie* ](https://weblogs.asp.net/scottgu/) s 博客文章[*始终设置应用程序名称配置 ASP.NET 成员资格和其他提供程序时的属性*](https://weblogs.asp.net/scottgu/443634)。</span><span class="sxs-lookup"><span data-stu-id="d449b-235">For more discussion on setting the `applicationName` attribute and the rationale behind it, refer to [*Scott Guthrie*](https://weblogs.asp.net/scottgu/) s blog post, [*Always set the applicationName property when configuring ASP.NET Membership and other Providers*](https://weblogs.asp.net/scottgu/443634).</span></span>

### <a name="managing-user-accounts-in-the-production-environment"></a><span data-ttu-id="d449b-236">管理生产环境中的用户帐户</span><span class="sxs-lookup"><span data-stu-id="d449b-236">Managing User Accounts in the Production Environment</span></span>

<span data-ttu-id="d449b-237">ASP.NET 网站管理工具 (WSAT) 轻松创建和管理用户帐户、 定义和应用角色和拼写出基于用户和角色的授权规则。</span><span class="sxs-lookup"><span data-stu-id="d449b-237">The ASP.NET Web Site Administration Tool (WSAT) makes it easy to create and manage user accounts, define and apply roles, and spell out user- and role-based authorization rules.</span></span> <span data-ttu-id="d449b-238">通过转到解决方案资源管理器并单击 ASP.NET 配置图标，或通过转到网站或项目菜单并选择 ASP.NET 配置菜单项，可以启动从 Visual Studio WSAT。</span><span class="sxs-lookup"><span data-stu-id="d449b-238">You can launch the WSAT from Visual Studio by going to the Solution Explorer and clicking the ASP.NET Configuration icon or by going to the Website or Project menus and selecting the ASP.NET Configuration menu item.</span></span> <span data-ttu-id="d449b-239">遗憾的是，WSAT 可以仅适用于本地网站。</span><span class="sxs-lookup"><span data-stu-id="d449b-239">Unfortunately, the WSAT can only work with local websites.</span></span> <span data-ttu-id="d449b-240">因此，不能从工作站使用 WSAT 管理生产环境中的网站。</span><span class="sxs-lookup"><span data-stu-id="d449b-240">Therefore, you cannot use the WSAT from your workstation to manage the website in the production environment.</span></span>

<span data-ttu-id="d449b-241">好消息是功能的公开的所有提供的 WSAT 是功能的以编程方式通过成员资格和角色 Api;此外，许多 WSAT 屏幕使用标准 ASP.NET 登录相关控件。</span><span class="sxs-lookup"><span data-stu-id="d449b-241">The good news is that all of the functionality exposed provided by the WSAT is available programmatically through the Membership and Roles APIs; furthermore, many of the WSAT screens use the standard ASP.NET Login-related controls.</span></span> <span data-ttu-id="d449b-242">简单地说，您可以将 ASP.NET 页面添加到你提供了必需的管理功能的网站。</span><span class="sxs-lookup"><span data-stu-id="d449b-242">In short, you can add ASP.NET pages to your website that offer the necessary management capabilities.</span></span>

<span data-ttu-id="d449b-243">回想一下前面的教程中，更新书评 web 应用程序以包括`~/Admin`文件夹，以及此文件夹具有已配置为仅允许用户管理员角色中。</span><span class="sxs-lookup"><span data-stu-id="d449b-243">Recall that an earlier tutorial updated the Book Reviews web application to include an `~/Admin` folder, and this folder has been configured to only allow users in the Admin role.</span></span> <span data-ttu-id="d449b-244">我添加一个页面名为该文件夹`CreateAccount.aspx`从该管理员可以创建新的用户帐户。</span><span class="sxs-lookup"><span data-stu-id="d449b-244">I added a page to that folder named `CreateAccount.aspx` from which an administrator can create a new user account.</span></span> <span data-ttu-id="d449b-245">此页使用 CreateUserWizard 控件来显示用于创建新的用户帐户的用户界面和后端逻辑。</span><span class="sxs-lookup"><span data-stu-id="d449b-245">This page uses the CreateUserWizard control to display the user interface and backend logic for creating a new user account.</span></span> <span data-ttu-id="d449b-246">新增更多，我自定义控件以包含一个复选框，提示是否还应添加到管理员角色的新用户 （请参见图 5）。</span><span class="sxs-lookup"><span data-stu-id="d449b-246">What s more, I customized the control to include a CheckBox that prompts whether the new user should also be added to the Admin role (see Figure 5).</span></span> <span data-ttu-id="d449b-247">使用很少的工作可以构建自定义的一组页面实现的用户和角色管理相关任务 WSAT 否则会提供。</span><span class="sxs-lookup"><span data-stu-id="d449b-247">With a little bit of work you can build a custom set of pages that implements the user and role management-related tasks that would otherwise be provided by the WSAT.</span></span>

> [!NOTE]
> <span data-ttu-id="d449b-248">有关与登录相关的 ASP.NET Web 控件一起使用的成员身份和角色 Api 的详细信息请阅读我[*网站安全教程*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)。</span><span class="sxs-lookup"><span data-stu-id="d449b-248">For more information on using the Membership and Roles APIs along with the Login-related ASP.NET Web controls, be sure to read my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span> <span data-ttu-id="d449b-249">有关自定义 CreateUserWizard 控件的详细信息，请参阅[*创建用户帐户*](../../older-versions-security/membership/creating-user-accounts-cs.md)并[*存储的其他用户信息*](../../older-versions-security/membership/storing-additional-user-information-cs.md)教程中或查看[ *Erich Peterson* ](http://www.erichpeterson.com/) s 文章[*自定义 CreateUserWizard 控件*](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="d449b-249">For more on customizing the CreateUserWizard control refer to the [*Creating User Accounts*](../../older-versions-security/membership/creating-user-accounts-cs.md) and [*Storing Additional User Information*](../../older-versions-security/membership/storing-additional-user-information-cs.md) tutorials, or check out [*Erich Peterson*](http://www.erichpeterson.com/) s article, [*Customizing the CreateUserWizard Control*](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx).</span></span>

<span data-ttu-id="d449b-250">[![管理员可以创建新的用户帐户](configuring-a-website-that-uses-application-services-cs/_static/image14.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image13.jpg)</span><span class="sxs-lookup"><span data-stu-id="d449b-250">[![Administrators Can Create New User Accounts](configuring-a-website-that-uses-application-services-cs/_static/image14.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image13.jpg)</span></span>

<span data-ttu-id="d449b-251">**图 5**:管理员可以创建新的用户帐户 ([单击此项可查看原尺寸图像](configuring-a-website-that-uses-application-services-cs/_static/image15.jpg))</span><span class="sxs-lookup"><span data-stu-id="d449b-251">**Figure 5**: Administrators Can Create New User Accounts ([Click to view full-size image](configuring-a-website-that-uses-application-services-cs/_static/image15.jpg))</span></span>

<span data-ttu-id="d449b-252">如果您需要的全部功能的 WSAT 签出[*滚动你自己网站管理工具*](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)，在作者 Dan Clem 逐步构建自定义 WSAT 类似的工具的过程。</span><span class="sxs-lookup"><span data-stu-id="d449b-252">If you need the full functionality of the WSAT check out [*Rolling Your Own Web Site Administration Tool*](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx), in which author Dan Clem walks through the process of building a custom WSAT-like tool.</span></span> <span data-ttu-id="d449b-253">Dan 共享应用程序的源代码 （在 C# 中)，并提供有关将其添加到托管网站的分步说明。</span><span class="sxs-lookup"><span data-stu-id="d449b-253">Dan shares his application s source code (in C#) and provides step-by-step instructions for adding it to your hosted website.</span></span>

## <a name="summary"></a><span data-ttu-id="d449b-254">总结</span><span class="sxs-lookup"><span data-stu-id="d449b-254">Summary</span></span>

<span data-ttu-id="d449b-255">部署使用的应用程序服务数据库实现的 web 应用程序时必须首先确保的生产数据库都有必要的数据库对象。</span><span class="sxs-lookup"><span data-stu-id="d449b-255">When deploying a web application that uses the application services database implementation you must first ensure that the production database has the requisite database objects.</span></span> <span data-ttu-id="d449b-256">可以使用中讨论的技术添加这些对象*部署的数据库*教程; 或者，可以使用`aspnet_regsql.exe`工具，如我们在本教程中看到。</span><span class="sxs-lookup"><span data-stu-id="d449b-256">These objects can be added using the techniques discussed in the *Deploying a Database* tutorial; alternatively, you can use the `aspnet_regsql.exe` tool, as we saw in this tutorial.</span></span> <span data-ttu-id="d449b-257">以同步 （这是重要信息： 如果你想要在生产中无效的用户和开发环境中创建的角色） 的开发和生产环境和技术中使用的应用程序名称为中心，我们介绍其他挑战管理用户和生产环境中的角色。</span><span class="sxs-lookup"><span data-stu-id="d449b-257">Other challenges we touched on center around synchronizing the application name used in the development and production environments (which is important if you want users and roles created in the development environment to be valid on production) and techniques for managing the users and roles in the production environment.</span></span>

<span data-ttu-id="d449b-258">快乐编程 ！</span><span class="sxs-lookup"><span data-stu-id="d449b-258">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="d449b-259">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="d449b-259">Further Reading</span></span>

<span data-ttu-id="d449b-260">在本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="d449b-260">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="d449b-261">*ASP.NET SQL Server 注册工具 (aspnet_regsql.exe)*</span><span class="sxs-lookup"><span data-stu-id="d449b-261">*ASP.NET SQL Server Registration Tool (aspnet_regsql.exe)*</span></span>](https://msdn.microsoft.com/library/ms229862.aspx)
- [<span data-ttu-id="d449b-262">*为 SQL Server 中创建应用程序服务数据库*</span><span class="sxs-lookup"><span data-stu-id="d449b-262">*Creating the Application Services Database for SQL Server*</span></span>](https://msdn.microsoft.com/library/x28wfk74.aspx)
- [<span data-ttu-id="d449b-263">*SQL Server 中创建成员身份架构*</span><span class="sxs-lookup"><span data-stu-id="d449b-263">*Creating the Membership Schema in SQL Server*</span></span>](../../older-versions-security/membership/creating-the-membership-schema-in-sql-server-cs.md)
- [<span data-ttu-id="d449b-264">*检查 ASP.NET s 成员资格、 角色和配置文件*</span><span class="sxs-lookup"><span data-stu-id="d449b-264">*Examining ASP.NET s Membership, Roles, and Profile*</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="d449b-265">*滚动你自己的网站管理工具*</span><span class="sxs-lookup"><span data-stu-id="d449b-265">*Rolling Your Own Web Site Administration Tool*</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)
- [<span data-ttu-id="d449b-266">*网站安全教程*</span><span class="sxs-lookup"><span data-stu-id="d449b-266">*Website Security Tutorials*</span></span>](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)
- [<span data-ttu-id="d449b-267">*网站管理工具概述*</span><span class="sxs-lookup"><span data-stu-id="d449b-267">*Web Site Administration Tool Overview*</span></span>](https://msdn.microsoft.com/library/yy40ytx0.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="d449b-268">[上一页](configuring-the-production-web-application-to-use-the-production-database-cs.md)
> [下一页](strategies-for-database-development-and-deployment-cs.md)</span><span class="sxs-lookup"><span data-stu-id="d449b-268">[Previous](configuring-the-production-web-application-to-use-the-production-database-cs.md)
[Next](strategies-for-database-development-and-deployment-cs.md)</span></span>
