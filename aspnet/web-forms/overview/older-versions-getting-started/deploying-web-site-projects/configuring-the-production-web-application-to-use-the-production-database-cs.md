---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-the-production-web-application-to-use-the-production-database-cs
title: 配置生产 Web 应用程序以使用生产数据库（C#） |Microsoft Docs
author: rick-anderson
description: 如前面的教程中所述，在开发环境和生产环境之间的配置信息不是很常见。 这是 es 。
ms.author: riande
ms.date: 04/23/2009
ms.assetid: 0177dabd-d888-449f-91b2-24190cf5e842
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-the-production-web-application-to-use-the-production-database-cs
msc.type: authoredcontent
ms.openlocfilehash: 89941bb6db52316a259ad5f5577721e36f19bd84
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/28/2019
ms.locfileid: "74635916"
---
# <a name="configuring-the-production-web-application-to-use-the-production-database-c"></a><span data-ttu-id="a30ff-104">配置生产 Web 应用程序以使用生产数据库 (C#)</span><span class="sxs-lookup"><span data-stu-id="a30ff-104">Configuring the Production Web Application to Use the Production Database (C#)</span></span>

<span data-ttu-id="a30ff-105">作者： [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="a30ff-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="a30ff-106">[下载代码](https://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_08_CS.zip)或[下载 PDF](https://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial08_DBConfig_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="a30ff-106">[Download Code](https://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_08_CS.zip) or [Download PDF](https://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial08_DBConfig_cs.pdf)</span></span>

> <span data-ttu-id="a30ff-107">如前面的教程中所述，在开发环境和生产环境之间的配置信息不是很常见。</span><span class="sxs-lookup"><span data-stu-id="a30ff-107">As discussed in earlier tutorials, it is not uncommon for configuration information to differ between the development and production environments.</span></span> <span data-ttu-id="a30ff-108">这对于数据驱动的 web 应用程序尤其如此，因为开发环境和生产环境之间的数据库连接字符串不同。</span><span class="sxs-lookup"><span data-stu-id="a30ff-108">This is especially true for data-driven web applications, as the database connection strings differ between the development and production environments.</span></span> <span data-ttu-id="a30ff-109">本教程探讨如何配置生产环境以更详细地包含适当的连接字符串。</span><span class="sxs-lookup"><span data-stu-id="a30ff-109">This tutorial explores ways to configure the production environment to include the appropriate connection string in more detail.</span></span>

## <a name="introduction"></a><span data-ttu-id="a30ff-110">简介</span><span class="sxs-lookup"><span data-stu-id="a30ff-110">Introduction</span></span>

<span data-ttu-id="a30ff-111">在开发时，数据驱动的 web 应用程序通常使用不同的数据库，而不是在生产环境中。</span><span class="sxs-lookup"><span data-stu-id="a30ff-111">Data-driven web applications usually use a different database when in development than when in production.</span></span> <span data-ttu-id="a30ff-112">对于由 web 宿主提供程序托管并在本地开发的应用程序，开发数据库通常驻留在开发人员计算机上，而生产数据库承载在 web 托管公司的网站上的数据库服务器上。</span><span class="sxs-lookup"><span data-stu-id="a30ff-112">For applications hosted by a web host provider and developed locally, the development database typically resides on the developer s computer while the production database is hosted on a database server at the web hosting company s facility.</span></span> <span data-ttu-id="a30ff-113">部署数据驱动的 web 应用程序需要将开发数据库复制到生产数据库服务器。</span><span class="sxs-lookup"><span data-stu-id="a30ff-113">Deploying a data-driven web application entails copying the development database to the production database server.</span></span> <span data-ttu-id="a30ff-114">在上一教程中，我们介绍了完成此步骤的方法。</span><span class="sxs-lookup"><span data-stu-id="a30ff-114">In the previous tutorial we looked at ways to accomplish this step.</span></span>

<span data-ttu-id="a30ff-115">Web 应用程序使用*连接字符串*中的信息建立与数据库的连接。</span><span class="sxs-lookup"><span data-stu-id="a30ff-115">The web application uses the information in a *connection string* to establish a connection with the database.</span></span> <span data-ttu-id="a30ff-116">连接字符串通常存储在 `Web.config`中，指定数据库服务器名称、数据库名称、安全上下文和其他信息。</span><span class="sxs-lookup"><span data-stu-id="a30ff-116">The connection string, which is typically stored in `Web.config`, specifies the database server name, the name of the database, the security context, and other information.</span></span> <span data-ttu-id="a30ff-117">由于 web 应用程序使用的数据库取决于 web 应用程序是在开发环境还是在生产环境中运行，因此，两种环境之间的连接字符串必须不同。</span><span class="sxs-lookup"><span data-stu-id="a30ff-117">Because the database used by the web application depends on whether the web application is running in the development or production environments, the connection strings must differ between the two environments.</span></span>

<span data-ttu-id="a30ff-118">开发环境和生产环境之间的配置信息不同，这种情况并不常见。</span><span class="sxs-lookup"><span data-stu-id="a30ff-118">It is not uncommon for configuration information to differ between the development and production environments.</span></span> <span data-ttu-id="a30ff-119">*开发和生产教程之间的常见配置差异*讨论了在这两个环境之间维护单独的配置信息的方法，以及对数据库连接字符串的简要讨论。</span><span class="sxs-lookup"><span data-stu-id="a30ff-119">The *Common Configuration Differences Between Development and Production* tutorial discussed techniques for maintaining separate configuration information between these two environments, as well as a brief discussion on database connection strings.</span></span> <span data-ttu-id="a30ff-120">本教程探讨如何配置生产环境以更详细地包含适当的连接字符串。</span><span class="sxs-lookup"><span data-stu-id="a30ff-120">This tutorial explores ways to configure the production environment to include the appropriate connection string in more detail.</span></span>

## <a name="examining-the-connection-string-information"></a><span data-ttu-id="a30ff-121">检查连接字符串信息</span><span class="sxs-lookup"><span data-stu-id="a30ff-121">Examining the Connection String Information</span></span>

<span data-ttu-id="a30ff-122">书籍审阅 web 应用程序使用的连接字符串存储在应用程序的配置文件中，`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="a30ff-122">The connection string used by the Book Reviews web application is stored in the application s configuration file, `Web.config`.</span></span> <span data-ttu-id="a30ff-123">`Web.config` 包含用于存储连接字符串的特殊部分，其名称为[&lt;connectionStrings&gt;](https://msdn.microsoft.com/library/bf7sd233.aspx)名称正好。</span><span class="sxs-lookup"><span data-stu-id="a30ff-123">`Web.config` includes a special section for storing connection strings, aptly named [&lt;connectionStrings&gt;](https://msdn.microsoft.com/library/bf7sd233.aspx).</span></span> <span data-ttu-id="a30ff-124">书籍审阅网站的 `Web.config` 文件中有一个名为 `ReviewsConnectionString`的此部分中定义的连接字符串：</span><span class="sxs-lookup"><span data-stu-id="a30ff-124">The `Web.config` file for the Book Reviews website has one connection string defined in this section named `ReviewsConnectionString`:</span></span>

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-cs/samples/sample1.xml)]

<span data-ttu-id="a30ff-125">连接字符串-Data Source = .\SQLEXPRESS;AttachDbFilename = |DataDirectory | \Reviews.mdf; 集成安全性 = True;User Instance = True-由多个选项和值组成，选项/值对由分号分隔，每个选项和值用等号分隔。</span><span class="sxs-lookup"><span data-stu-id="a30ff-125">The connection string - Data Source=.\SQLEXPRESS;AttachDbFilename=|DataDirectory|\Reviews.mdf;Integrated Security=True;User Instance=True - is composed of a number of options and values, with option/value pairs delimited by a semicolon and each option and value delimited by an equals sign.</span></span> <span data-ttu-id="a30ff-126">此连接字符串中使用的四个选项为：</span><span class="sxs-lookup"><span data-stu-id="a30ff-126">The four options used in this connection string are:</span></span>

- <span data-ttu-id="a30ff-127">`Data Source`-指定数据库服务器和数据库服务器实例名称（如果有）的位置。</span><span class="sxs-lookup"><span data-stu-id="a30ff-127">`Data Source` - specifies the location of the database server and the database server instance name (if any).</span></span> <span data-ttu-id="a30ff-128">`.\SQLEXPRESS`的值就是一个包含数据库服务器和实例名称的示例。</span><span class="sxs-lookup"><span data-stu-id="a30ff-128">The value, `.\SQLEXPRESS`, is an example where there is a database server and an instance name.</span></span> <span data-ttu-id="a30ff-129">句点指定数据库服务器与应用程序在同一台计算机上;实例名称为 `SQLEXPRESS`。</span><span class="sxs-lookup"><span data-stu-id="a30ff-129">The period specifies that the database server is on the same computer as the application; the instance name is `SQLEXPRESS`.</span></span>
- <span data-ttu-id="a30ff-130">`AttachDbFilename`-指定数据库文件的位置。</span><span class="sxs-lookup"><span data-stu-id="a30ff-130">`AttachDbFilename` - specifies the location of the database file.</span></span> <span data-ttu-id="a30ff-131">值包含占位符 `|DataDirectory|`，它在运行时解析为应用程序的完整路径 `App_Data` 文件夹。</span><span class="sxs-lookup"><span data-stu-id="a30ff-131">The value contains the placeholder `|DataDirectory|`, which is resolved to the full path of the application s `App_Data` folder at runtime.</span></span>
- <span data-ttu-id="a30ff-132">`Integrated Security`-一个布尔值，该值指示在连接到数据库时是否使用指定的用户名/密码（false）或当前的 Windows 帐户凭据（true）。</span><span class="sxs-lookup"><span data-stu-id="a30ff-132">`Integrated Security` - a Boolean value that indicates whether to use a specified username/password when connecting to the database (false) or the current Windows account credentials (true).</span></span>
- <span data-ttu-id="a30ff-133">`User Instance`-特定于 SQL Server Express 版本的配置选项，用于指示是否允许本地计算机上的非管理用户附加和连接到 SQL Server Express 版数据库。</span><span class="sxs-lookup"><span data-stu-id="a30ff-133">`User Instance` - a configuration option specific to the SQL Server Express Editions that indicates whether to allow non-Administrative users on the local computer attach and connect to a SQL Server Express Edition database.</span></span> <span data-ttu-id="a30ff-134">有关此设置的详细信息，请参阅[SQL Server Express 用户实例](https://msdn.microsoft.com/library/ms254504.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a30ff-134">See [SQL Server Express User Instances](https://msdn.microsoft.com/library/ms254504.aspx) for more information on this setting.</span></span>

<span data-ttu-id="a30ff-135">允许的连接字符串选项取决于要连接到的数据库和正在使用的 ADO.NET 数据库提供程序。</span><span class="sxs-lookup"><span data-stu-id="a30ff-135">The allowable connection string options depend on the database you are connecting to and the ADO.NET database provider being used.</span></span> <span data-ttu-id="a30ff-136">例如，用于连接到 Microsoft SQL Server 数据库的连接字符串不同于用于连接到 Oracle 数据库的连接字符串。</span><span class="sxs-lookup"><span data-stu-id="a30ff-136">For example, the connection string for connecting to a Microsoft SQL Server database differs from that used to connect to an Oracle database.</span></span> <span data-ttu-id="a30ff-137">同样，使用 SqlClient 提供程序连接到 Microsoft SQL Server 数据库时，使用的连接字符串与使用 OLE DB 访问接口时使用的字符串不同。</span><span class="sxs-lookup"><span data-stu-id="a30ff-137">Likewise, connecting to a Microsoft SQL Server database using the SqlClient provider uses a different connection string than when using the OLE-DB provider.</span></span>

<span data-ttu-id="a30ff-138">你可以手动构建数据库连接字符串，方法是使用[ConnectionStrings.com](http://www.connectionstrings.com/)作为资源来处理可用的选项。</span><span class="sxs-lookup"><span data-stu-id="a30ff-138">You can build the database connection string by hand using a site like [ConnectionStrings.com](http://www.connectionstrings.com/) as a resource for what options are available.</span></span> <span data-ttu-id="a30ff-139">但是，更简单的方法是将数据库添加到 Visual Studio 中的服务器资源管理器，然后从属性窗口中获取连接字符串。</span><span class="sxs-lookup"><span data-stu-id="a30ff-139">However, an easier approach is to add the database to the Server Explorer in Visual Studio and then to grab the connection string from the Properties window.</span></span> <span data-ttu-id="a30ff-140">使用后一种方法将连接字符串构造到生产数据库服务器。</span><span class="sxs-lookup"><span data-stu-id="a30ff-140">Let s use this latter technique for constructing the connection string to the production database server.</span></span>

<span data-ttu-id="a30ff-141">打开 Visual Studio，然后导航到 "服务器资源管理器" 窗口（在 Visual Web Developer 中，此窗口称为 "数据库资源管理器）"。</span><span class="sxs-lookup"><span data-stu-id="a30ff-141">Open Visual Studio and then navigate to the Server Explorer window (in Visual Web Developer, this window is called Database Explorer).</span></span> <span data-ttu-id="a30ff-142">右键单击 "数据连接" 选项，然后从上下文菜单中选择 "添加连接" 选项。</span><span class="sxs-lookup"><span data-stu-id="a30ff-142">Right-click on the Data Connections option and choose the Add Connection option from the context menu.</span></span> <span data-ttu-id="a30ff-143">此时将打开图1所示的向导。</span><span class="sxs-lookup"><span data-stu-id="a30ff-143">This brings up the wizard shown in Figure 1.</span></span> <span data-ttu-id="a30ff-144">选择适当的数据源，然后单击 "继续"。</span><span class="sxs-lookup"><span data-stu-id="a30ff-144">Choose the appropriate data source and click Continue.</span></span>

<span data-ttu-id="a30ff-145">[![选择将新数据库添加到服务器资源管理器](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image2.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image1.jpg)</span><span class="sxs-lookup"><span data-stu-id="a30ff-145">[![Choose to Add a New Database to the Server Explorer](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image2.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image1.jpg)</span></span> 

<span data-ttu-id="a30ff-146">**图 1**：选择将新数据库添加到服务器资源管理器（[单击以查看完全大小的映像](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image3.jpg)）</span><span class="sxs-lookup"><span data-stu-id="a30ff-146">**Figure 1**: Choose to Add a New Database to the Server Explorer ([Click to view full-size image](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image3.jpg))</span></span>

<span data-ttu-id="a30ff-147">接下来，指定不同的数据库连接信息（参见图2）。</span><span class="sxs-lookup"><span data-stu-id="a30ff-147">Next, specify the various database connection information (see Figure 2).</span></span> <span data-ttu-id="a30ff-148">注册到 web 托管公司时，他们应该已经提供了有关如何连接到数据库的信息，即数据库服务器名称、数据库名称、用于连接到数据库的用户名和密码等。</span><span class="sxs-lookup"><span data-stu-id="a30ff-148">When you signed up with your web hosting company they should have provided information on how to connect to the database - the database server name, the database name, the username and password to use to connect to the database, and so on.</span></span> <span data-ttu-id="a30ff-149">输入此信息后，请单击 "确定" 以完成该向导并将数据库添加到服务器资源管理器。</span><span class="sxs-lookup"><span data-stu-id="a30ff-149">After entering this information click OK to complete this wizard and to add the database to the Server Explorer.</span></span>

<span data-ttu-id="a30ff-150">[![指定数据库连接信息](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image5.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image4.jpg)</span><span class="sxs-lookup"><span data-stu-id="a30ff-150">[![Specify the Database Connection Information](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image5.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image4.jpg)</span></span> 

<span data-ttu-id="a30ff-151">**图 2**：指定数据库连接信息（[单击以查看完全大小的映像](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image6.jpg)）</span><span class="sxs-lookup"><span data-stu-id="a30ff-151">**Figure 2**: Specify the Database Connection Information ([Click to view full-size image](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image6.jpg))</span></span>

<span data-ttu-id="a30ff-152">生产环境数据库现在应在服务器资源管理器中列出。</span><span class="sxs-lookup"><span data-stu-id="a30ff-152">The production environment database should now be listed in the Server Explorer.</span></span> <span data-ttu-id="a30ff-153">从服务器资源管理器中选择数据库并中转到属性窗口。</span><span class="sxs-lookup"><span data-stu-id="a30ff-153">Select the database from the Server Explorer and go to the Properties window.</span></span> <span data-ttu-id="a30ff-154">在这里，你将看到一个名为 "连接字符串" 的属性，其中包含数据库的连接字符串。</span><span class="sxs-lookup"><span data-stu-id="a30ff-154">There you will find a property named Connection String with the database s connection string.</span></span> <span data-ttu-id="a30ff-155">假设你在生产环境和 SqlClient 提供程序上使用 Microsoft SQL Server 数据库，则连接字符串应如下所示：</span><span class="sxs-lookup"><span data-stu-id="a30ff-155">Assuming you are using a Microsoft SQL Server database on production and the SqlClient provider your connection string should look similar to the following:</span></span>

<span data-ttu-id="a30ff-156"><strong>数据源 =<em>serverName</em>;初始目录 =<em>databaseName</em>;持久性安全信息 = True;User ID =<em>username</em>;密码 =*密码</strong>*</span><span class="sxs-lookup"><span data-stu-id="a30ff-156"><strong>Data Source=<em>serverName</em>; Initial Catalog=<em>databaseName</em>; Persist Security Info=True; User ID=<em>username</em>; Password=*password</strong>*</span></span>

<span data-ttu-id="a30ff-157">其中*serverName*、 *databaseName*、 *username*和*password*均为数据库服务器名称、数据库名称以及 web 主机公司提供给你的用户名和密码的值。</span><span class="sxs-lookup"><span data-stu-id="a30ff-157">Where *serverName*, *databaseName*, *username*, and *password* are with the values for the database server name, the database name, and the username and password supplied to you by your web host company.</span></span>

## <a name="deploying-the-book-reviews-web-application"></a><span data-ttu-id="a30ff-158">部署书籍评审 Web 应用程序</span><span class="sxs-lookup"><span data-stu-id="a30ff-158">Deploying the Book Reviews Web Application</span></span>

<span data-ttu-id="a30ff-159">以上教程逐步介绍了如何将开发数据库复制到生产环境中，但未探索如何部署数据驱动的应用程序。</span><span class="sxs-lookup"><span data-stu-id="a30ff-159">The preceding tutorial stepped through copying the development database to the production environment, but did not explore deploying the data-driven application.</span></span> <span data-ttu-id="a30ff-160">此时，生产环境包含数据库，但使用的是书籍的版本通过静态审核检查应用程序。</span><span class="sxs-lookup"><span data-stu-id="a30ff-160">At this point the production environment contains the database but is using the version of the Book Reviews application with static reviews.</span></span> <span data-ttu-id="a30ff-161">需要将新的、数据驱动的应用程序部署到生产服务器，以及更新的配置信息。</span><span class="sxs-lookup"><span data-stu-id="a30ff-161">We need to deploy the new, data-driven application to the production server along with the updated configuration information.</span></span>

<span data-ttu-id="a30ff-162">花点时间将数据驱动的应用程序从开发环境部署到生产环境。</span><span class="sxs-lookup"><span data-stu-id="a30ff-162">Take a moment to deploy the data-driven application from the development environment to production.</span></span> <span data-ttu-id="a30ff-163">之前的教程中详细介绍了此过程。</span><span class="sxs-lookup"><span data-stu-id="a30ff-163">This process was covered in detail in previous tutorials.</span></span> <span data-ttu-id="a30ff-164">如果需要刷新程序，请参阅*使用 FTP 客户端部署网站*或*使用 Visual Studio 部署网站*教程。</span><span class="sxs-lookup"><span data-stu-id="a30ff-164">If you need a refresher, see the *Deploying Your Website Using an FTP Client* or the *Deploying Your Website Using Visual Studio* tutorials.</span></span> <span data-ttu-id="a30ff-165">你将需要确保生产数据库连接字符串与生产环境中使用的字符串相同，这意味着必须部署备用的 `Web.config` 文件。</span><span class="sxs-lookup"><span data-stu-id="a30ff-165">You will need to ensure that the production database connection string is the one used in the production environment, which means that an alternate `Web.config` file must be deployed.</span></span> <span data-ttu-id="a30ff-166">具体而言，此修改后的 `Web.config` 文件 s `<connectionStrings>` 元素需要包含生产数据库连接字符串，应如下所示：</span><span class="sxs-lookup"><span data-stu-id="a30ff-166">Specifically, this modified `Web.config` file s `<connectionStrings>` element needs to contain the production database connection string and should look similar to the following:</span></span>

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-cs/samples/sample2.xml)]

<span data-ttu-id="a30ff-167">请注意，`<connectionStrings>` 元素中的连接字符串的名称相同（`ReviewsConnectionString`），但现在包含生产数据库连接字符串而不是开发数据库连接字符串。</span><span class="sxs-lookup"><span data-stu-id="a30ff-167">Note that the connection string in the `<connectionStrings>` element is named the same (`ReviewsConnectionString`), but now contains the production database connection string instead of the development database connection string.</span></span>

<span data-ttu-id="a30ff-168">除非您具有更正规的部署工作流，否则请手动修改 `Web.config` 文件，以便在部署之前使用生产数据库连接字符串（请记住将其恢复回使用开发数据库连接字符串），或维护单独的 `Web.config` 文件，其中包含将作为部署过程的一部分上载到生产环境的生产环境配置信息。</span><span class="sxs-lookup"><span data-stu-id="a30ff-168">Unless you have a more formalized deployment workflow, either manually modify the `Web.config` file to use the production database connection string before deploying (remembering to revert it back to using the development database connection string afterwards) or maintain a separate `Web.config` file with the production environment configuration information that gets uploaded to the production environment as part of the deployment process.</span></span>

> [!NOTE]
> <span data-ttu-id="a30ff-169">如果意外部署了包含开发数据库连接字符串的 `Web.config` 文件，则当生产中的应用程序尝试连接到数据库时，将会出现错误。</span><span class="sxs-lookup"><span data-stu-id="a30ff-169">If you accidentally deploy a `Web.config` file that contains the development database connection string then there will be an error when the application on production attempts to connect to the database.</span></span> <span data-ttu-id="a30ff-170">此错误将作为 `SqlException`，其中包含一条消息，报告服务器找不到或无法访问。</span><span class="sxs-lookup"><span data-stu-id="a30ff-170">This error manifests as a `SqlException` with a message reporting that the server was not found or was not accessible.</span></span>

<span data-ttu-id="a30ff-171">将站点部署到生产环境后，请通过浏览器访问生产站点。</span><span class="sxs-lookup"><span data-stu-id="a30ff-171">Once the site has been deployed to production, visit the production site through your browser.</span></span> <span data-ttu-id="a30ff-172">你应看到并获得与在本地运行数据驱动的应用程序相同的用户体验。</span><span class="sxs-lookup"><span data-stu-id="a30ff-172">You should see and enjoy the same user experience as when running the data-driven application locally.</span></span> <span data-ttu-id="a30ff-173">当然，在生产环境中访问该网站时，该站点由生产数据库服务器提供支持，而访问开发环境中的网站则使用开发环境中的数据库。</span><span class="sxs-lookup"><span data-stu-id="a30ff-173">Of course when you visit the website on production the site is powered by the production database server, whereas visiting the website in the development environment uses the database in development.</span></span> <span data-ttu-id="a30ff-174">图3显示了在生产环境中从网站向*自己 ASP.NET 3.5 的24小时*检查页面（请注意浏览器地址栏中的 URL）。</span><span class="sxs-lookup"><span data-stu-id="a30ff-174">Figure 3 shows the *Teach Yourself ASP.NET 3.5 in 24 Hours* review page from the website in the production environment (note the URL in the browser s Address bar).</span></span>

<span data-ttu-id="a30ff-175">[![数据驱动的应用程序现在可以在生产环境中使用！](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image8.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image7.jpg)</span><span class="sxs-lookup"><span data-stu-id="a30ff-175">[![The Data-Driven Application is Now Available On Production!](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image8.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image7.jpg)</span></span> 

<span data-ttu-id="a30ff-176">**图 3**：数据驱动的应用程序现在可以在生产环境中使用！</span><span class="sxs-lookup"><span data-stu-id="a30ff-176">**Figure 3**: The Data-Driven Application is Now Available On Production!</span></span> <span data-ttu-id="a30ff-177">（[单击以查看完全大小的映像](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image9.jpg)）</span><span class="sxs-lookup"><span data-stu-id="a30ff-177">([Click to view full-size image](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image9.jpg))</span></span>

### <a name="storing-connection-strings-in-a-separate-configuration-file"></a><span data-ttu-id="a30ff-178">在单独的配置文件中存储连接字符串</span><span class="sxs-lookup"><span data-stu-id="a30ff-178">Storing Connection Strings in a Separate Configuration File</span></span>

<span data-ttu-id="a30ff-179">在开发和生产环境中维护单独的配置信息的一种常用方法是使用 `Web.config`的两个版本：一个用于开发环境，另一个用于生产环境。</span><span class="sxs-lookup"><span data-stu-id="a30ff-179">A common technique for maintaining separate configuration information on the development and production environments is to have two versions of the `Web.config`: one for the development environment and one for production.</span></span> <span data-ttu-id="a30ff-180">在部署时，可以将适当的 `Web.config` 版本复制到生产环境中。</span><span class="sxs-lookup"><span data-stu-id="a30ff-180">At deploy-time the appropriate `Web.config` version can be copied to the production environment.</span></span> <span data-ttu-id="a30ff-181">理想情况下，此过程将作为部署工作流的一部分自动执行。</span><span class="sxs-lookup"><span data-stu-id="a30ff-181">Ideally, this process would be automated as part of the deployment workflow.</span></span>

<span data-ttu-id="a30ff-182">您可以根据需要维护两个单独的 `Web.config` 文件，而不是提供更精细的差别。</span><span class="sxs-lookup"><span data-stu-id="a30ff-182">Instead of maintaining two separate `Web.config` files you can, optionally, provide more granular differences.</span></span> <span data-ttu-id="a30ff-183">可在 `Web.config` 文件中引用的外部配置文件中定义构成 `Web.config` 文件的元素。</span><span class="sxs-lookup"><span data-stu-id="a30ff-183">The elements that make up the `Web.config` file can be defined in an external configuration files that are then referenced in the `Web.config` file.</span></span> <span data-ttu-id="a30ff-184">简言之，两种环境都可以有一个 `Web.config` 文件，该文件将包含应用程序使用的连接字符串，并且对于每个环境都是唯一的。</span><span class="sxs-lookup"><span data-stu-id="a30ff-184">In a nutshell you can have one `Web.config` file for both environments that references a databaseConnectionStrings.config file, which would contain the connection strings used by the application and would be unique for each environment.</span></span> <span data-ttu-id="a30ff-185">我发现，将不同的配置信息分隔到单独的文件中提供了整齐和更简单的 `Web.config` 文件，并且更清晰地概述了开发和生产环境之间的配置差异。</span><span class="sxs-lookup"><span data-stu-id="a30ff-185">I find that separating the differing configuration information into separate files provides a tidier and simpler `Web.config` file and more clearly outlines the configuration differences between the development and production environments.</span></span>

<span data-ttu-id="a30ff-186">若要使用此方法，请首先在名为 `ConfigSections`的 web 应用程序中创建一个新文件夹。</span><span class="sxs-lookup"><span data-stu-id="a30ff-186">To use this technique, start by creating a new folder in the web application named `ConfigSections`.</span></span> <span data-ttu-id="a30ff-187">接下来，将两个文件添加到名为 "databaseConnectionStrings" 和 "databaseConnectionStrings" 的新文件夹中。接下来，将 `Web.config` 中的 `<connectionStrings>` 元素复制到 databaseConnectionStrings 和 databaseConnectionStrings 文件中，然后修改 databaseConnectionStrings 文件中的连接字符串，使其指定生产数据库连接字符串。</span><span class="sxs-lookup"><span data-stu-id="a30ff-187">Next, add two files to this new folder named databaseConnectionStrings.dev.config and databaseConnectionStrings.production.config. Next, copy the `<connectionStrings>` element from `Web.config` into the databaseConnectionStrings.dev.config and databaseConnectionStrings.production.config files, and then modify the connection string in the databaseConnectionStrings.production.config file so that it specifies the production database connection string.</span></span> <span data-ttu-id="a30ff-188">例如，databaseConnectionStrings 文件只应包含具有引用开发数据库的连接字符串的 `<connectionStrings>` 元素：</span><span class="sxs-lookup"><span data-stu-id="a30ff-188">For example, the databaseConnectionStrings.dev.config file should contain just the `<connectionStrings>` element with a connection string that references the development database:</span></span>

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-cs/samples/sample3.xml)]

<span data-ttu-id="a30ff-189">同样，databaseConnectionStrings 文件应该只包含一个 `<connectionStrings>` 元素，但是一个包含生产数据库连接字符串的元素。</span><span class="sxs-lookup"><span data-stu-id="a30ff-189">Similarly, the databaseConnectionStrings.production.config file should contain just a `<connectionStrings>` element, but one that has the production database connection string.</span></span>

<span data-ttu-id="a30ff-190">创建 databaseConnectionStrings 文件的副本，并将其命名为 databaseConnectionStrings。</span><span class="sxs-lookup"><span data-stu-id="a30ff-190">Make a copy of the databaseConnectionStrings.dev.config file and name it databaseConnectionStrings.config.</span></span>

> [!NOTE]
> <span data-ttu-id="a30ff-191">如果需要，你可以将配置文件命名为除 databaseConnectionStrings 以外的其他内容，如 `connectionStrings.config` 或 `dbInfo.config`。</span><span class="sxs-lookup"><span data-stu-id="a30ff-191">You can name the configuration file something other than databaseConnectionStrings.config, if you d like, such as `connectionStrings.config` or `dbInfo.config`.</span></span> <span data-ttu-id="a30ff-192">但是，请务必使用 `.config` 扩展名命名文件，因为默认情况下，ASP.NET 引擎不提供 `.config` 文件。</span><span class="sxs-lookup"><span data-stu-id="a30ff-192">However, be sure to name the file with a `.config` extension as `.config` files are, by default, not served by the ASP.NET engine.</span></span> <span data-ttu-id="a30ff-193">如果你将该文件命名为其他内容（如 `connectionStrings.txt`），则用户可以将其浏览器指向[www.yoursite.com/ConfigSettings/connectionStrings.txt](http://www.yoursite.com/ConfigSettings/connectionStrings.txt)并查看该文件的内容！</span><span class="sxs-lookup"><span data-stu-id="a30ff-193">If you name the file something else, like `connectionStrings.txt`, a user could point their browser to [www.yoursite.com/ConfigSettings/connectionStrings.txt](http://www.yoursite.com/ConfigSettings/connectionStrings.txt) and view the contents of the file!</span></span>

<span data-ttu-id="a30ff-194">此时，`ConfigSections` 文件夹应包含三个文件（请参阅图4）。</span><span class="sxs-lookup"><span data-stu-id="a30ff-194">At this point the `ConfigSections` folder should contain three files (see Figure 4).</span></span> <span data-ttu-id="a30ff-195">DatabaseConnectionStrings 和 databaseConnectionStrings 文件分别包含适用于开发环境和生产环境的连接字符串。</span><span class="sxs-lookup"><span data-stu-id="a30ff-195">The databaseConnectionStrings.dev.config and databaseConnectionStrings.production.config files contain the connection strings for the development and production environments, respectively.</span></span> <span data-ttu-id="a30ff-196">DatabaseConnectionStrings 文件包含 web 应用程序在运行时将使用的连接字符串信息。</span><span class="sxs-lookup"><span data-stu-id="a30ff-196">The databaseConnectionStrings.config file contains the connection string information that will be used by the web application at runtime.</span></span> <span data-ttu-id="a30ff-197">因此，databaseConnectionStrings 文件应与开发环境中的 databaseConnectionStrings 文件相同，而在生产环境中，databaseConnectionStrings 文件应等同于databaseConnectionStrings。</span><span class="sxs-lookup"><span data-stu-id="a30ff-197">Consequently, the databaseConnectionStrings.config file should be identical to the databaseConnectionStrings.dev.config file in the development environment, whereas on production the databaseConnectionStrings.config file should be identical to databaseConnectionStrings.production.config.</span></span>

<span data-ttu-id="a30ff-198">[![ConfigSections](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image11.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image10.jpg)</span><span class="sxs-lookup"><span data-stu-id="a30ff-198">[![ConfigSections](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image11.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image10.jpg)</span></span> 

<span data-ttu-id="a30ff-199">**图 4**： ConfigSections （[单击查看完全尺寸的图像](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image12.jpg)）</span><span class="sxs-lookup"><span data-stu-id="a30ff-199">**Figure 4**: ConfigSections ([Click to view full-size image](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image12.jpg))</span></span>

<span data-ttu-id="a30ff-200">现在，我们需要指示 `Web.config` 为其连接字符串存储使用 databaseConnectionStrings 文件。</span><span class="sxs-lookup"><span data-stu-id="a30ff-200">We now need to instruct `Web.config` to use the databaseConnectionStrings.config file for its connection string store.</span></span> <span data-ttu-id="a30ff-201">打开 `Web.config` 并将现有 `<connectionStrings>` 元素替换为以下内容：</span><span class="sxs-lookup"><span data-stu-id="a30ff-201">Open `Web.config` and replace the existing `<connectionStrings>` element with the following:</span></span>

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-cs/samples/sample4.xml)]

<span data-ttu-id="a30ff-202">`configSource` 特性指定相对于 `Web.config` 文件的物理路径。</span><span class="sxs-lookup"><span data-stu-id="a30ff-202">The `configSource` attribute specifies a physical path relative to the `Web.config` file.</span></span> <span data-ttu-id="a30ff-203">如果外部 `.config` 文件与 `Web.config` 在同一目录中，则将此属性设置为 `.config` 文件的文件名。</span><span class="sxs-lookup"><span data-stu-id="a30ff-203">If the external `.config` file is in the same directory as `Web.config` then set this attribute to the file name of the `.config` file.</span></span> <span data-ttu-id="a30ff-204">如果它在子目录中，就像 databaseConnectionStrings 一样，使用反斜杠指定该子文件夹，以分隔文件夹和文件名，例如 ConfigSections\databaseConnectionStrings.config。</span><span class="sxs-lookup"><span data-stu-id="a30ff-204">If it s in a subdirectory, as is the case with databaseConnectionStrings.config, specify the subfolder using a backslash to delimit the folder and file names, like ConfigSections\databaseConnectionStrings.config.</span></span>

<span data-ttu-id="a30ff-205">进行此修改后，开发和生产环境包含相同的 `Web.config` 文件。</span><span class="sxs-lookup"><span data-stu-id="a30ff-205">With this modification, the development and production environments contain the same `Web.config` file.</span></span> <span data-ttu-id="a30ff-206">现在，唯一的区别在于 databaseConnectionStrings 文件。</span><span class="sxs-lookup"><span data-stu-id="a30ff-206">Now the only difference is the databaseConnectionStrings.config file.</span></span> <span data-ttu-id="a30ff-207">将 databaseConnectionStrings 文件复制到生产，并将其重命名为 databaseConnectionStrings。如果以后对生产数据库连接字符串进行了更改，则需要将其提供给 databaseConnectionStrings 文件，然后将该文件上载到生产，并将其重命名为 databaseConnectionStrings。</span><span class="sxs-lookup"><span data-stu-id="a30ff-207">Copy the databaseConnectionStrings.production.config file to production and rename it to databaseConnectionStrings.config. If, in the future, there are changes to the production database connection string you will need to make them to the databaseConnectionStrings.production.config file and then upload that file to production, renaming it databaseConnectionStrings.config.</span></span>

> [!NOTE]
> <span data-ttu-id="a30ff-208">您可以在单独的文件中指定任何 `Web.config` 元素的信息，然后使用 `configSource` 属性从 `Web.config`中引用该文件。</span><span class="sxs-lookup"><span data-stu-id="a30ff-208">You may specify the information for any `Web.config` element in a separate file and use the `configSource` attribute to reference that file from within `Web.config`.</span></span>

## <a name="summary"></a><span data-ttu-id="a30ff-209">总结</span><span class="sxs-lookup"><span data-stu-id="a30ff-209">Summary</span></span>

<span data-ttu-id="a30ff-210">数据驱动的应用程序通常在开发和生产环境中使用不同的数据库。</span><span class="sxs-lookup"><span data-stu-id="a30ff-210">Data-driven applications usually use different databases in the development and production environments.</span></span> <span data-ttu-id="a30ff-211">因此，存储在 web 应用程序中的数据库连接字符串在每个环境中必须是唯一的。</span><span class="sxs-lookup"><span data-stu-id="a30ff-211">Consequently, the database connection strings stored in the web application s configuration must be unique per environment.</span></span> <span data-ttu-id="a30ff-212">在本教程中，我们将介绍如何确定生产数据库连接字符串，以及在两个环境中维护唯一连接字符串信息的方法。</span><span class="sxs-lookup"><span data-stu-id="a30ff-212">In this tutorial we looked at how to determine the production database connection string and ways to maintain unique connection string information in the two environments.</span></span>

<span data-ttu-id="a30ff-213">很高兴编程！</span><span class="sxs-lookup"><span data-stu-id="a30ff-213">Happy Programming!</span></span>

#### <a name="further-reading"></a><span data-ttu-id="a30ff-214">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="a30ff-214">Further Reading</span></span>

<span data-ttu-id="a30ff-215">有关本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="a30ff-215">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="a30ff-216">连接字符串和配置文件</span><span class="sxs-lookup"><span data-stu-id="a30ff-216">Connection Strings and Configuration Files</span></span>](https://msdn.microsoft.com/library/ms254494.aspx)
- [<span data-ttu-id="a30ff-217">数据库配置字符串信息 @ ConnectionStrings.com</span><span class="sxs-lookup"><span data-stu-id="a30ff-217">Database Configuration Strings Information @ ConnectionStrings.com</span></span>](http://www.connectionstrings.com/)
- [<span data-ttu-id="a30ff-218">将设置移出 web.config 文件</span><span class="sxs-lookup"><span data-stu-id="a30ff-218">Move Settings Out of the Web.config File</span></span>](http://www.asp101.com/tips/index.asp?id=154)
- [<span data-ttu-id="a30ff-219">&lt;connectionStrings&gt; 元素的技术文档</span><span class="sxs-lookup"><span data-stu-id="a30ff-219">Technical Documentation for the &lt;connectionStrings&gt; Element</span></span>](https://msdn.microsoft.com/library/bf7sd233.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="a30ff-220">[上一页](deploying-a-database-cs.md)
> [下一页](configuring-a-website-that-uses-application-services-cs.md)</span><span class="sxs-lookup"><span data-stu-id="a30ff-220">[Previous](deploying-a-database-cs.md)
[Next](configuring-a-website-that-uses-application-services-cs.md)</span></span>
