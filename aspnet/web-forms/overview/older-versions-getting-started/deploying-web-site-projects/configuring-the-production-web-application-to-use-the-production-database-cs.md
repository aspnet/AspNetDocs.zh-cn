---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-the-production-web-application-to-use-the-production-database-cs
title: 配置生产 Web 应用程序以使用生产数据库 (C#) |Microsoft Docs
author: rick-anderson
description: 如之前教程中所述，它不是常见的配置信息以在开发和生产环境之间存在差异。 这是 es...
ms.author: riande
ms.date: 04/23/2009
ms.assetid: 0177dabd-d888-449f-91b2-24190cf5e842
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-the-production-web-application-to-use-the-production-database-cs
msc.type: authoredcontent
ms.openlocfilehash: fa05645db9d43a836cc75b399153dd2e2c288f7c
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/09/2019
ms.locfileid: "59388752"
---
# <a name="configuring-the-production-web-application-to-use-the-production-database-c"></a><span data-ttu-id="85b65-104">配置生产 Web 应用程序以使用生产数据库 (C#)</span><span class="sxs-lookup"><span data-stu-id="85b65-104">Configuring the Production Web Application to Use the Production Database (C#)</span></span>

<span data-ttu-id="85b65-105">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="85b65-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="85b65-106">[下载代码](http://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_08_CS.zip)或[下载 PDF](http://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial08_DBConfig_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="85b65-106">[Download Code](http://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_08_CS.zip) or [Download PDF](http://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial08_DBConfig_cs.pdf)</span></span>

> <span data-ttu-id="85b65-107">如之前教程中所述，它不是常见的配置信息以在开发和生产环境之间存在差异。</span><span class="sxs-lookup"><span data-stu-id="85b65-107">As discussed in earlier tutorials, it is not uncommon for configuration information to differ between the development and production environments.</span></span> <span data-ttu-id="85b65-108">因为数据库连接字符串的开发和生产环境之间存在差异，这是对于数据驱动的 web 应用程序，尤其如此。</span><span class="sxs-lookup"><span data-stu-id="85b65-108">This is especially true for data-driven web applications, as the database connection strings differ between the development and production environments.</span></span> <span data-ttu-id="85b65-109">本教程探讨了如何配置在生产环境中更多详细信息包括适当的连接字符串。</span><span class="sxs-lookup"><span data-stu-id="85b65-109">This tutorial explores ways to configure the production environment to include the appropriate connection string in more detail.</span></span>


## <a name="introduction"></a><span data-ttu-id="85b65-110">介绍</span><span class="sxs-lookup"><span data-stu-id="85b65-110">Introduction</span></span>

<span data-ttu-id="85b65-111">数据驱动的 web 应用程序通常在生产环境中使用不同的数据库时比开发中。</span><span class="sxs-lookup"><span data-stu-id="85b65-111">Data-driven web applications usually use a different database when in development than when in production.</span></span> <span data-ttu-id="85b65-112">对于应用程序由 web 主机提供商托管和本地开发，开发数据库通常驻留在开发人员的计算机上的生产数据库托管在 web 托管公司的设施的数据库服务器上时。</span><span class="sxs-lookup"><span data-stu-id="85b65-112">For applications hosted by a web host provider and developed locally, the development database typically resides on the developer s computer while the production database is hosted on a database server at the web hosting company s facility.</span></span> <span data-ttu-id="85b65-113">部署数据驱动的 web 应用程序时，需要将开发数据库复制到生产数据库服务器。</span><span class="sxs-lookup"><span data-stu-id="85b65-113">Deploying a data-driven web application entails copying the development database to the production database server.</span></span> <span data-ttu-id="85b65-114">上一教程中我们介绍了如何完成此步骤。</span><span class="sxs-lookup"><span data-stu-id="85b65-114">In the previous tutorial we looked at ways to accomplish this step.</span></span>

<span data-ttu-id="85b65-115">Web 应用程序使用中的信息*连接字符串*建立与数据库的连接。</span><span class="sxs-lookup"><span data-stu-id="85b65-115">The web application uses the information in a *connection string* to establish a connection with the database.</span></span> <span data-ttu-id="85b65-116">连接字符串，通常存储在`Web.config`，指定数据库服务器名称、 数据库、 安全上下文中和其他信息的名称。</span><span class="sxs-lookup"><span data-stu-id="85b65-116">The connection string, which is typically stored in `Web.config`, specifies the database server name, the name of the database, the security context, and other information.</span></span> <span data-ttu-id="85b65-117">因为 web 应用程序使用的数据库依赖于是否在开发或生产环境中运行 web 应用程序，连接字符串必须在两种环境之间有所不同。</span><span class="sxs-lookup"><span data-stu-id="85b65-117">Because the database used by the web application depends on whether the web application is running in the development or production environments, the connection strings must differ between the two environments.</span></span>

<span data-ttu-id="85b65-118">不常见的配置信息以在开发和生产环境之间存在差异。</span><span class="sxs-lookup"><span data-stu-id="85b65-118">It is not uncommon for configuration information to differ between the development and production environments.</span></span> <span data-ttu-id="85b65-119">*常见配置差异之间开发和生产*教程讨论了用于上维护单独的配置之间这两种环境以及简要介绍的信息的方法数据库连接字符串。</span><span class="sxs-lookup"><span data-stu-id="85b65-119">The *Common Configuration Differences Between Development and Production* tutorial discussed techniques for maintaining separate configuration information between these two environments, as well as a brief discussion on database connection strings.</span></span> <span data-ttu-id="85b65-120">本教程探讨了如何配置在生产环境中更多详细信息包括适当的连接字符串。</span><span class="sxs-lookup"><span data-stu-id="85b65-120">This tutorial explores ways to configure the production environment to include the appropriate connection string in more detail.</span></span>

## <a name="examining-the-connection-string-information"></a><span data-ttu-id="85b65-121">检查连接字符串信息</span><span class="sxs-lookup"><span data-stu-id="85b65-121">Examining the Connection String Information</span></span>

<span data-ttu-id="85b65-122">书评 web 应用程序使用的连接字符串存储在应用程序的配置文件， `Web.config`。</span><span class="sxs-lookup"><span data-stu-id="85b65-122">The connection string used by the Book Reviews web application is stored in the application s configuration file, `Web.config`.</span></span> `Web.config` <span data-ttu-id="85b65-123">包括用于存储连接字符串，正如其名为某个特殊部分[ &lt;connectionStrings&gt;](https://msdn.microsoft.com/library/bf7sd233.aspx)。</span><span class="sxs-lookup"><span data-stu-id="85b65-123">includes a special section for storing connection strings, aptly named [&lt;connectionStrings&gt;](https://msdn.microsoft.com/library/bf7sd233.aspx).</span></span> <span data-ttu-id="85b65-124">`Web.config`书评网站有一个名为本部分中定义的连接字符串文件`ReviewsConnectionString`:</span><span class="sxs-lookup"><span data-stu-id="85b65-124">The `Web.config` file for the Book Reviews website has one connection string defined in this section named `ReviewsConnectionString`:</span></span>

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-cs/samples/sample1.xml)]

<span data-ttu-id="85b65-125">连接字符串的数据源 =。 \SQLEXPRESS;AttachDbFilename = |DataDirectory|\Reviews.mdf;Integrated Security = True;用户实例 = True-是组成大量的选项和值，使用选项/值对由分号和每个选项分隔和由等号分隔的值。</span><span class="sxs-lookup"><span data-stu-id="85b65-125">The connection string - Data Source=.\SQLEXPRESS;AttachDbFilename=|DataDirectory|\Reviews.mdf;Integrated Security=True;User Instance=True - is composed of a number of options and values, with option/value pairs delimited by a semicolon and each option and value delimited by an equals sign.</span></span> <span data-ttu-id="85b65-126">此连接字符串中使用的四个选项是：</span><span class="sxs-lookup"><span data-stu-id="85b65-126">The four options used in this connection string are:</span></span>

- `Data Source` <span data-ttu-id="85b65-127">-指定数据库服务器和数据库服务器实例名称的位置 （如果有）。</span><span class="sxs-lookup"><span data-stu-id="85b65-127">- specifies the location of the database server and the database server instance name (if any).</span></span> <span data-ttu-id="85b65-128">值， `.\SQLEXPRESS`，是一个示例的数据库服务器和实例名称。</span><span class="sxs-lookup"><span data-stu-id="85b65-128">The value, `.\SQLEXPRESS`, is an example where there is a database server and an instance name.</span></span> <span data-ttu-id="85b65-129">周期指定数据库服务器是作为该应用程序; 在同一计算机上实例名称是`SQLEXPRESS`。</span><span class="sxs-lookup"><span data-stu-id="85b65-129">The period specifies that the database server is on the same computer as the application; the instance name is `SQLEXPRESS`.</span></span>
- `AttachDbFilename` <span data-ttu-id="85b65-130">-指定数据库文件的位置。</span><span class="sxs-lookup"><span data-stu-id="85b65-130">- specifies the location of the database file.</span></span> <span data-ttu-id="85b65-131">值包含占位符`|DataDirectory|`，这是解析为 s 的应用程序的完整路径`App_Data`在运行时文件夹。</span><span class="sxs-lookup"><span data-stu-id="85b65-131">The value contains the placeholder `|DataDirectory|`, which is resolved to the full path of the application s `App_Data` folder at runtime.</span></span>
- `Integrated Security` <span data-ttu-id="85b65-132">-一个布尔值，该值指示是否使用指定的用户名/密码连接到数据库 (false) 或当前的 Windows 帐户凭据 (true) 时。</span><span class="sxs-lookup"><span data-stu-id="85b65-132">- a Boolean value that indicates whether to use a specified username/password when connecting to the database (false) or the current Windows account credentials (true).</span></span>
- `User Instance` <span data-ttu-id="85b65-133">-特定于 SQL Server Express 版本，该值指示是否允许在本地计算机上的非管理用户附加并连接到 SQL Server Express Edition 数据库的配置选项。</span><span class="sxs-lookup"><span data-stu-id="85b65-133">- a configuration option specific to the SQL Server Express Editions that indicates whether to allow non-Administrative users on the local computer attach and connect to a SQL Server Express Edition database.</span></span> <span data-ttu-id="85b65-134">请参阅[SQL Server Express 用户实例](https://msdn.microsoft.com/library/ms254504.aspx)有关此设置的详细信息。</span><span class="sxs-lookup"><span data-stu-id="85b65-134">See [SQL Server Express User Instances](https://msdn.microsoft.com/library/ms254504.aspx) for more information on this setting.</span></span>
  

<span data-ttu-id="85b65-135">允许的连接字符串选项取决于要连接到的数据库和正在使用的 ADO.NET 数据库提供程序。</span><span class="sxs-lookup"><span data-stu-id="85b65-135">The allowable connection string options depend on the database you are connecting to and the ADO.NET database provider being used.</span></span> <span data-ttu-id="85b65-136">例如，用于连接到 Microsoft SQL Server 数据库具有不同的用来连接到 Oracle 数据库连接字符串。</span><span class="sxs-lookup"><span data-stu-id="85b65-136">For example, the connection string for connecting to a Microsoft SQL Server database differs from that used to connect to an Oracle database.</span></span> <span data-ttu-id="85b65-137">同样，连接到使用 SqlClient 提供程序的 Microsoft SQL Server 数据库使用不同的连接字符串比时使用的 OLE DB 访问接口。</span><span class="sxs-lookup"><span data-stu-id="85b65-137">Likewise, connecting to a Microsoft SQL Server database using the SqlClient provider uses a different connection string than when using the OLE-DB provider.</span></span>

<span data-ttu-id="85b65-138">可以通过使用之类的站点的手动生成的数据库连接字符串[ConnectionStrings.com](http://www.connectionstrings.com/)为哪些选项是可用的资源。</span><span class="sxs-lookup"><span data-stu-id="85b65-138">You can build the database connection string by hand using a site like [ConnectionStrings.com](http://www.connectionstrings.com/) as a resource for what options are available.</span></span> <span data-ttu-id="85b65-139">但是，较简单的方法是将数据库添加到 Visual Studio 中的服务器资源管理器，然后获取属性窗口中的连接字符串。</span><span class="sxs-lookup"><span data-stu-id="85b65-139">However, an easier approach is to add the database to the Server Explorer in Visual Studio and then to grab the connection string from the Properties window.</span></span> <span data-ttu-id="85b65-140">让我们来使用后一技术用于构造生产数据库服务器的连接字符串。</span><span class="sxs-lookup"><span data-stu-id="85b65-140">Let s use this latter technique for constructing the connection string to the production database server.</span></span>

<span data-ttu-id="85b65-141">打开 Visual Studio，然后导航到服务器资源管理器窗口 （在 Visual Web Developer 中，此窗口被称为数据库资源管理器）。</span><span class="sxs-lookup"><span data-stu-id="85b65-141">Open Visual Studio and then navigate to the Server Explorer window (in Visual Web Developer, this window is called Database Explorer).</span></span> <span data-ttu-id="85b65-142">右键单击数据连接选项，然后从上下文菜单中选择添加连接选项。</span><span class="sxs-lookup"><span data-stu-id="85b65-142">Right-click on the Data Connections option and choose the Add Connection option from the context menu.</span></span> <span data-ttu-id="85b65-143">此时将显示在图 1 中所示的向导。</span><span class="sxs-lookup"><span data-stu-id="85b65-143">This brings up the wizard shown in Figure 1.</span></span> <span data-ttu-id="85b65-144">选择适当的数据源并单击继续。</span><span class="sxs-lookup"><span data-stu-id="85b65-144">Choose the appropriate data source and click Continue.</span></span>


[![C<span data-ttu-id="85b65-145">选择要将新数据库添加到服务器资源管理器]</span><span class="sxs-lookup"><span data-stu-id="85b65-145">hoose to Add a New Database to the Server Explorer]</span></span>(configuring-the-production-web-application-to-use-the-production-database-cs/_static/image2.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image1.jpg) 

<span data-ttu-id="85b65-146">**图 1**:选择将新的数据库添加到服务器资源管理器 ([单击此项可查看原尺寸图像](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image3.jpg))</span><span class="sxs-lookup"><span data-stu-id="85b65-146">**Figure 1**: Choose to Add a New Database to the Server Explorer ([Click to view full-size image](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image3.jpg))</span></span>


<span data-ttu-id="85b65-147">接下来，指定的各种数据库连接信息 （请参见图 2）。</span><span class="sxs-lookup"><span data-stu-id="85b65-147">Next, specify the various database connection information (see Figure 2).</span></span> <span data-ttu-id="85b65-148">当您使用您的 web 托管公司注册它们应如何连接到数据库的数据库服务器名称、 数据库名称、 用户名和密码用于连接到数据库，依次类推提供了信息。</span><span class="sxs-lookup"><span data-stu-id="85b65-148">When you signed up with your web hosting company they should have provided information on how to connect to the database - the database server name, the database name, the username and password to use to connect to the database, and so on.</span></span> <span data-ttu-id="85b65-149">输入此信息后，单击确定以完成此向导并将数据库添加到服务器资源管理器。</span><span class="sxs-lookup"><span data-stu-id="85b65-149">After entering this information click OK to complete this wizard and to add the database to the Server Explorer.</span></span>


[![S<span data-ttu-id="85b65-150">指定数据库连接信息]</span><span class="sxs-lookup"><span data-stu-id="85b65-150">pecify the Database Connection Information]</span></span>(configuring-the-production-web-application-to-use-the-production-database-cs/_static/image5.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image4.jpg) 

<span data-ttu-id="85b65-151">**图 2**:指定数据库连接信息 ([单击此项可查看原尺寸图像](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image6.jpg))</span><span class="sxs-lookup"><span data-stu-id="85b65-151">**Figure 2**: Specify the Database Connection Information ([Click to view full-size image](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image6.jpg))</span></span>


<span data-ttu-id="85b65-152">生产环境数据库现在应在服务器资源管理器中列出。</span><span class="sxs-lookup"><span data-stu-id="85b65-152">The production environment database should now be listed in the Server Explorer.</span></span> <span data-ttu-id="85b65-153">从服务器资源管理器中选择数据库并转到属性窗口。</span><span class="sxs-lookup"><span data-stu-id="85b65-153">Select the database from the Server Explorer and go to the Properties window.</span></span> <span data-ttu-id="85b65-154">可以在其中找到一个名为使用数据库 s 的连接字符串的连接字符串属性。</span><span class="sxs-lookup"><span data-stu-id="85b65-154">There you will find a property named Connection String with the database s connection string.</span></span> <span data-ttu-id="85b65-155">假设在生产和 SqlClient 提供程序上使用的 Microsoft SQL Server 数据库连接字符串应类似于下面：</span><span class="sxs-lookup"><span data-stu-id="85b65-155">Assuming you are using a Microsoft SQL Server database on production and the SqlClient provider your connection string should look similar to the following:</span></span>

<strong><span data-ttu-id="85b65-156">数据源 =<em>serverName</em>;初始目录 =<em>databaseName</em>;持久性安全信息 = True;用户 ID =<em>用户名</em>;密码 =\*密码</strong></span><span class="sxs-lookup"><span data-stu-id="85b65-156">Data Source=<em>serverName</em>; Initial Catalog=<em>databaseName</em>; Persist Security Info=True; User ID=<em>username</em>; Password=\*password</strong></span></span>*

<span data-ttu-id="85b65-157">其中*serverName*， *databaseName*，*用户名*，以及*密码*都替换为数据库服务器名称，该数据库的值名称，以及用户名和密码提供给你的 web 主机公司。</span><span class="sxs-lookup"><span data-stu-id="85b65-157">Where *serverName*, *databaseName*, *username*, and *password* are with the values for the database server name, the database name, and the username and password supplied to you by your web host company.</span></span>

## <a name="deploying-the-book-reviews-web-application"></a><span data-ttu-id="85b65-158">通讯簿评审 Web 应用程序部署</span><span class="sxs-lookup"><span data-stu-id="85b65-158">Deploying the Book Reviews Web Application</span></span>

<span data-ttu-id="85b65-159">前面的教程分步说明了将开发数据库复制到生产环境中，但无法浏览部署数据驱动应用程序。</span><span class="sxs-lookup"><span data-stu-id="85b65-159">The preceding tutorial stepped through copying the development database to the production environment, but did not explore deploying the data-driven application.</span></span> <span data-ttu-id="85b65-160">此时在生产环境包含的数据库，但正在使用静态评审使用通讯簿评审应用程序的版本。</span><span class="sxs-lookup"><span data-stu-id="85b65-160">At this point the production environment contains the database but is using the version of the Book Reviews application with static reviews.</span></span> <span data-ttu-id="85b65-161">我们需要新的数据驱动应用程序部署到生产服务器以及更新的配置信息。</span><span class="sxs-lookup"><span data-stu-id="85b65-161">We need to deploy the new, data-driven application to the production server along with the updated configuration information.</span></span>

<span data-ttu-id="85b65-162">请花费片刻时间部署数据驱动应用程序从开发环境到生产环境。</span><span class="sxs-lookup"><span data-stu-id="85b65-162">Take a moment to deploy the data-driven application from the development environment to production.</span></span> <span data-ttu-id="85b65-163">此过程已在前面的教程中详细介绍。</span><span class="sxs-lookup"><span data-stu-id="85b65-163">This process was covered in detail in previous tutorials.</span></span> <span data-ttu-id="85b65-164">如果你需要复习，请参阅*部署在网站中使用 FTP 客户端*或*部署您的网站使用的 Visual Studio*教程。</span><span class="sxs-lookup"><span data-stu-id="85b65-164">If you need a refresher, see the *Deploying Your Website Using an FTP Client* or the *Deploying Your Website Using Visual Studio* tutorials.</span></span> <span data-ttu-id="85b65-165">您将需要确保生产数据库连接字符串是一个用于生产环境，这意味着备用`Web.config`文件必须部署。</span><span class="sxs-lookup"><span data-stu-id="85b65-165">You will need to ensure that the production database connection string is the one used in the production environment, which means that an alternate `Web.config` file must be deployed.</span></span> <span data-ttu-id="85b65-166">具体而言，此修改`Web.config`文件的`<connectionStrings>`元素需要包含生产数据库连接字符串且应类似于以下：</span><span class="sxs-lookup"><span data-stu-id="85b65-166">Specifically, this modified `Web.config` file s `<connectionStrings>` element needs to contain the production database connection string and should look similar to the following:</span></span>

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-cs/samples/sample2.xml)]

<span data-ttu-id="85b65-167">请注意，该连接字符串中`<connectionStrings>`元素的名称 (`ReviewsConnectionString`)，但现在包含生产数据库连接字符串而不是开发数据库连接字符串。</span><span class="sxs-lookup"><span data-stu-id="85b65-167">Note that the connection string in the `<connectionStrings>` element is named the same (`ReviewsConnectionString`), but now contains the production database connection string instead of the development database connection string.</span></span>

<span data-ttu-id="85b65-168">除非有更正式的部署工作流，请手动修改`Web.config`文件部署 （请记住要恢复为使用开发的数据库连接字符串之前使用生产数据库连接字符串之后） 或维护一个单独`Web.config`获取作为部署过程的一部分上载到生产环境的生产环境配置信息的文件。</span><span class="sxs-lookup"><span data-stu-id="85b65-168">Unless you have a more formalized deployment workflow, either manually modify the `Web.config` file to use the production database connection string before deploying (remembering to revert it back to using the development database connection string afterwards) or maintain a separate `Web.config` file with the production environment configuration information that gets uploaded to the production environment as part of the deployment process.</span></span>

> [!NOTE]
> <span data-ttu-id="85b65-169">如果意外地部署`Web.config`包含开发数据库连接字符串，则当对生产应用程序尝试连接到数据库将处于错误的文件。</span><span class="sxs-lookup"><span data-stu-id="85b65-169">If you accidentally deploy a `Web.config` file that contains the development database connection string then there will be an error when the application on production attempts to connect to the database.</span></span> <span data-ttu-id="85b65-170">此错误表现为`SqlException`reporting 服务器找不到或无法访问的消息。</span><span class="sxs-lookup"><span data-stu-id="85b65-170">This error manifests as a `SqlException` with a message reporting that the server was not found or was not accessible.</span></span>


<span data-ttu-id="85b65-171">在站点部署到生产环境后，请访问生产站点，通过浏览器。</span><span class="sxs-lookup"><span data-stu-id="85b65-171">Once the site has been deployed to production, visit the production site through your browser.</span></span> <span data-ttu-id="85b65-172">应查看，并在本地运行数据驱动的应用程序时享受相同的用户体验。</span><span class="sxs-lookup"><span data-stu-id="85b65-172">You should see and enjoy the same user experience as when running the data-driven application locally.</span></span> <span data-ttu-id="85b65-173">当然生产上访问该网站时该站点由提供支持，生产数据库服务器上，而在开发过程中访问网站开发环境中的使用的数据库。</span><span class="sxs-lookup"><span data-stu-id="85b65-173">Of course when you visit the website on production the site is powered by the production database server, whereas visiting the website in the development environment uses the database in development.</span></span> <span data-ttu-id="85b65-174">图 3 显示了*教您自己 ASP.NET 3.5 24 小时内*查看页上从生产环境 （请注意浏览器的地址栏中的 URL） 中的网站。</span><span class="sxs-lookup"><span data-stu-id="85b65-174">Figure 3 shows the *Teach Yourself ASP.NET 3.5 in 24 Hours* review page from the website in the production environment (note the URL in the browser s Address bar).</span></span>


[![T<span data-ttu-id="85b65-175">他数据驱动应用程序是现在可在生产] ！</span><span class="sxs-lookup"><span data-stu-id="85b65-175">he Data-Driven Application is Now Available On Production!]</span></span>(configuring-the-production-web-application-to-use-the-production-database-cs/_static/image8.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image7.jpg) 

<span data-ttu-id="85b65-176">**图 3**:数据驱动应用程序已在现在可在生产环境 ！</span><span class="sxs-lookup"><span data-stu-id="85b65-176">**Figure 3**: The Data-Driven Application is Now Available On Production!</span></span> <span data-ttu-id="85b65-177">([单击此项可查看原尺寸图像](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image9.jpg))</span><span class="sxs-lookup"><span data-stu-id="85b65-177">([Click to view full-size image](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image9.jpg))</span></span>


### <a name="storing-connection-strings-in-a-separate-configuration-file"></a><span data-ttu-id="85b65-178">将连接字符串存储在单独的配置文件</span><span class="sxs-lookup"><span data-stu-id="85b65-178">Storing Connection Strings in a Separate Configuration File</span></span>

<span data-ttu-id="85b65-179">维护开发和生产环境的单独的配置信息的常用技术是具有两个版本的`Web.config`： 一个用于开发环境，另一个用于生产。</span><span class="sxs-lookup"><span data-stu-id="85b65-179">A common technique for maintaining separate configuration information on the development and production environments is to have two versions of the `Web.config`: one for the development environment and one for production.</span></span> <span data-ttu-id="85b65-180">在部署时相应`Web.config`版本可以复制到生产环境。</span><span class="sxs-lookup"><span data-stu-id="85b65-180">At deploy-time the appropriate `Web.config` version can be copied to the production environment.</span></span> <span data-ttu-id="85b65-181">理想情况下，将作为部署工作流的一部分自动执行此过程。</span><span class="sxs-lookup"><span data-stu-id="85b65-181">Ideally, this process would be automated as part of the deployment workflow.</span></span>

<span data-ttu-id="85b65-182">而不是维护两个单独`Web.config`文件 （可选） 可以提供更精细的差异。</span><span class="sxs-lookup"><span data-stu-id="85b65-182">Instead of maintaining two separate `Web.config` files you can, optionally, provide more granular differences.</span></span> <span data-ttu-id="85b65-183">元素构成`Web.config`然后在中引用的外部配置文件中，可以定义文件`Web.config`文件。</span><span class="sxs-lookup"><span data-stu-id="85b65-183">The elements that make up the `Web.config` file can be defined in an external configuration files that are then referenced in the `Web.config` file.</span></span> <span data-ttu-id="85b65-184">在简单地说有一个`Web.config`文件引用 databaseConnectionStrings.config 文件，将包含连接字符串这两个环境使用的应用程序，并且将是唯一的每个环境。</span><span class="sxs-lookup"><span data-stu-id="85b65-184">In a nutshell you can have one `Web.config` file for both environments that references a databaseConnectionStrings.config file, which would contain the connection strings used by the application and would be unique for each environment.</span></span> <span data-ttu-id="85b65-185">找到分离到单独的文件的不同配置信息提供整洁且更简单`Web.config`文件和详细清晰地概述了开发和生产环境之间的配置差异。</span><span class="sxs-lookup"><span data-stu-id="85b65-185">I find that separating the differing configuration information into separate files provides a tidier and simpler `Web.config` file and more clearly outlines the configuration differences between the development and production environments.</span></span>

<span data-ttu-id="85b65-186">若要使用此方法，开始通过在名为 web 应用程序中创建一个新文件夹`ConfigSections`。</span><span class="sxs-lookup"><span data-stu-id="85b65-186">To use this technique, start by creating a new folder in the web application named `ConfigSections`.</span></span> <span data-ttu-id="85b65-187">接下来，将两个文件添加到名为 databaseConnectionStrings.dev.config 和 databaseConnectionStrings.production.config 此新文件夹。接下来，复制`<connectionStrings>`元素从`Web.config`databaseConnectionStrings.dev.config 和 databaseConnectionStrings.production.config 文件，然后修改中的连接字符串databaseConnectionStrings.production.config 文件，以便指定要生产数据库连接字符串。</span><span class="sxs-lookup"><span data-stu-id="85b65-187">Next, add two files to this new folder named databaseConnectionStrings.dev.config and databaseConnectionStrings.production.config. Next, copy the `<connectionStrings>` element from `Web.config` into the databaseConnectionStrings.dev.config and databaseConnectionStrings.production.config files, and then modify the connection string in the databaseConnectionStrings.production.config file so that it specifies the production database connection string.</span></span> <span data-ttu-id="85b65-188">例如，databaseConnectionStrings.dev.config 文件应包含只`<connectionStrings>`引用开发数据库的连接字符串的元素：</span><span class="sxs-lookup"><span data-stu-id="85b65-188">For example, the databaseConnectionStrings.dev.config file should contain just the `<connectionStrings>` element with a connection string that references the development database:</span></span>

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-cs/samples/sample3.xml)]

<span data-ttu-id="85b65-189">同样，databaseConnectionStrings.production.config 文件应只包含`<connectionStrings>`元素，但具有生产数据库连接字符串。</span><span class="sxs-lookup"><span data-stu-id="85b65-189">Similarly, the databaseConnectionStrings.production.config file should contain just a `<connectionStrings>` element, but one that has the production database connection string.</span></span>

<span data-ttu-id="85b65-190">制作一份 databaseConnectionStrings.dev.config 文件并将其命名 databaseConnectionStrings.config。</span><span class="sxs-lookup"><span data-stu-id="85b65-190">Make a copy of the databaseConnectionStrings.dev.config file and name it databaseConnectionStrings.config.</span></span>

> [!NOTE]
> <span data-ttu-id="85b65-191">您可以将配置文件名称以外的 databaseConnectionStrings.config，如 d，如`connectionStrings.config`或`dbInfo.config`。</span><span class="sxs-lookup"><span data-stu-id="85b65-191">You can name the configuration file something other than databaseConnectionStrings.config, if you d like, such as `connectionStrings.config` or `dbInfo.config`.</span></span> <span data-ttu-id="85b65-192">但是，请确保使用该文件命名`.config`扩展插件作为`.config`文件，默认情况下，不是由 ASP.NET 引擎。</span><span class="sxs-lookup"><span data-stu-id="85b65-192">However, be sure to name the file with a `.config` extension as `.config` files are, by default, not served by the ASP.NET engine.</span></span> <span data-ttu-id="85b65-193">如果其他名称为该文件命名，例如`connectionStrings.txt`，用户无法对其浏览器指向[www.yoursite.com/ConfigSettings/connectionStrings.txt](http://www.yoursite.com/ConfigSettings/connectionStrings.txt)并查看该文件的内容 ！</span><span class="sxs-lookup"><span data-stu-id="85b65-193">If you name the file something else, like `connectionStrings.txt`, a user could point their browser to [www.yoursite.com/ConfigSettings/connectionStrings.txt](http://www.yoursite.com/ConfigSettings/connectionStrings.txt) and view the contents of the file!</span></span>


<span data-ttu-id="85b65-194">此时`ConfigSections`文件夹应包含三个文件 （请参阅图 4）。</span><span class="sxs-lookup"><span data-stu-id="85b65-194">At this point the `ConfigSections` folder should contain three files (see Figure 4).</span></span> <span data-ttu-id="85b65-195">DatabaseConnectionStrings.dev.config 和 databaseConnectionStrings.production.config 文件分别包含开发和生产环境中，连接字符串。</span><span class="sxs-lookup"><span data-stu-id="85b65-195">The databaseConnectionStrings.dev.config and databaseConnectionStrings.production.config files contain the connection strings for the development and production environments, respectively.</span></span> <span data-ttu-id="85b65-196">DatabaseConnectionStrings.config 文件包含将由 web 应用程序在运行时的连接字符串信息。</span><span class="sxs-lookup"><span data-stu-id="85b65-196">The databaseConnectionStrings.config file contains the connection string information that will be used by the web application at runtime.</span></span> <span data-ttu-id="85b65-197">因此，databaseConnectionStrings.config 文件应为与在开发环境中，databaseConnectionStrings.dev.config 文件相同而 databaseConnectionStrings.config 文件应在生产上的相同databaseConnectionStrings.production.config。</span><span class="sxs-lookup"><span data-stu-id="85b65-197">Consequently, the databaseConnectionStrings.config file should be identical to the databaseConnectionStrings.dev.config file in the development environment, whereas on production the databaseConnectionStrings.config file should be identical to databaseConnectionStrings.production.config.</span></span>


[![C<span data-ttu-id="85b65-198">onfigSections]</span><span class="sxs-lookup"><span data-stu-id="85b65-198">onfigSections]</span></span>(configuring-the-production-web-application-to-use-the-production-database-cs/_static/image11.jpg)](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image10.jpg) 

<span data-ttu-id="85b65-199">**图 4**:ConfigSections ([单击此项可查看原尺寸图像](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image12.jpg))</span><span class="sxs-lookup"><span data-stu-id="85b65-199">**Figure 4**: ConfigSections ([Click to view full-size image](configuring-the-production-web-application-to-use-the-production-database-cs/_static/image12.jpg))</span></span>


<span data-ttu-id="85b65-200">现在，我们需要指示`Web.config`要 databaseConnectionStrings.config 文件用于其连接字符串存储区。</span><span class="sxs-lookup"><span data-stu-id="85b65-200">We now need to instruct `Web.config` to use the databaseConnectionStrings.config file for its connection string store.</span></span> <span data-ttu-id="85b65-201">打开 `Web.config` 并将现有 `<connectionStrings>` 元素替换为以下内容：</span><span class="sxs-lookup"><span data-stu-id="85b65-201">Open `Web.config` and replace the existing `<connectionStrings>` element with the following:</span></span>

[!code-xml[Main](configuring-the-production-web-application-to-use-the-production-database-cs/samples/sample4.xml)]

<span data-ttu-id="85b65-202">`configSource`属性指定相对于的物理路径`Web.config`文件。</span><span class="sxs-lookup"><span data-stu-id="85b65-202">The `configSource` attribute specifies a physical path relative to the `Web.config` file.</span></span> <span data-ttu-id="85b65-203">如果外部`.config`文件位于与相同的目录`Web.config`然后将此属性设置为的文件名称`.config`文件。</span><span class="sxs-lookup"><span data-stu-id="85b65-203">If the external `.config` file is in the same directory as `Web.config` then set this attribute to the file name of the `.config` file.</span></span> <span data-ttu-id="85b65-204">如果它在一个子目录，s databaseConnectionStrings.config，使用这种情况指定使用反斜杠来分隔文件夹和文件的名称，如 ConfigSections\databaseConnectionStrings.config 的子文件夹。</span><span class="sxs-lookup"><span data-stu-id="85b65-204">If it s in a subdirectory, as is the case with databaseConnectionStrings.config, specify the subfolder using a backslash to delimit the folder and file names, like ConfigSections\databaseConnectionStrings.config.</span></span>

<span data-ttu-id="85b65-205">通过这种修改，在开发和生产环境包含相同`Web.config`文件。</span><span class="sxs-lookup"><span data-stu-id="85b65-205">With this modification, the development and production environments contain the same `Web.config` file.</span></span> <span data-ttu-id="85b65-206">现在唯一的区别是 databaseConnectionStrings.config 文件。</span><span class="sxs-lookup"><span data-stu-id="85b65-206">Now the only difference is the databaseConnectionStrings.config file.</span></span> <span data-ttu-id="85b65-207">将 databaseConnectionStrings.production.config 文件复制到生产环境并将它重命名为 databaseConnectionStrings.config。如果在将来，有对生产数据库连接字符串的更改将需要使到 databaseConnectionStrings.production.config 文件，然后将该文件上载到生产环境中，重命名 databaseConnectionStrings.config。</span><span class="sxs-lookup"><span data-stu-id="85b65-207">Copy the databaseConnectionStrings.production.config file to production and rename it to databaseConnectionStrings.config. If, in the future, there are changes to the production database connection string you will need to make them to the databaseConnectionStrings.production.config file and then upload that file to production, renaming it databaseConnectionStrings.config.</span></span>

> [!NOTE]
> <span data-ttu-id="85b65-208">可以指定的任何信息`Web.config`在单独的文件，并使用元素`configSource`属性中引用该文件`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="85b65-208">You may specify the information for any `Web.config` element in a separate file and use the `configSource` attribute to reference that file from within `Web.config`.</span></span>


## <a name="summary"></a><span data-ttu-id="85b65-209">总结</span><span class="sxs-lookup"><span data-stu-id="85b65-209">Summary</span></span>

<span data-ttu-id="85b65-210">数据驱动的应用程序通常在开发和生产环境中使用不同的数据库。</span><span class="sxs-lookup"><span data-stu-id="85b65-210">Data-driven applications usually use different databases in the development and production environments.</span></span> <span data-ttu-id="85b65-211">因此，存储在 web 应用程序配置中的数据库连接字符串必须是唯一每个环境。</span><span class="sxs-lookup"><span data-stu-id="85b65-211">Consequently, the database connection strings stored in the web application s configuration must be unique per environment.</span></span> <span data-ttu-id="85b65-212">在本教程中我们介绍了如何确定了生产数据库连接字符串以及维护两种环境中的唯一连接字符串信息的方式。</span><span class="sxs-lookup"><span data-stu-id="85b65-212">In this tutorial we looked at how to determine the production database connection string and ways to maintain unique connection string information in the two environments.</span></span>

<span data-ttu-id="85b65-213">快乐编程 ！</span><span class="sxs-lookup"><span data-stu-id="85b65-213">Happy Programming!</span></span>

#### <a name="further-reading"></a><span data-ttu-id="85b65-214">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="85b65-214">Further Reading</span></span>

<span data-ttu-id="85b65-215">在本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="85b65-215">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="85b65-216">连接字符串和配置文件</span><span class="sxs-lookup"><span data-stu-id="85b65-216">Connection Strings and Configuration Files</span></span>](https://msdn.microsoft.com/library/ms254494.aspx)
- [<span data-ttu-id="85b65-217">数据库配置字符串信息 @ ConnectionStrings.com</span><span class="sxs-lookup"><span data-stu-id="85b65-217">Database Configuration Strings Information @ ConnectionStrings.com</span></span>](http://www.connectionstrings.com/)
- [<span data-ttu-id="85b65-218">移出 Web.config 文件的设置</span><span class="sxs-lookup"><span data-stu-id="85b65-218">Move Settings Out of the Web.config File</span></span>](http://www.asp101.com/tips/index.asp?id=154)
- [<span data-ttu-id="85b65-219">技术文档&lt;connectionStrings&gt;元素</span><span class="sxs-lookup"><span data-stu-id="85b65-219">Technical Documentation for the &lt;connectionStrings&gt; Element</span></span>](https://msdn.microsoft.com/library/bf7sd233.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="85b65-220">[上一页](deploying-a-database-cs.md)
> [下一页](configuring-a-website-that-uses-application-services-cs.md)</span><span class="sxs-lookup"><span data-stu-id="85b65-220">[Previous](deploying-a-database-cs.md)
[Next](configuring-a-website-that-uses-application-services-cs.md)</span></span>
