---
uid: web-forms/overview/older-versions-security/admin/recovering-and-changing-passwords-cs
title: 恢复和更改密码 (C#) |Microsoft Docs
author: rick-anderson
description: ASP.NET 包括用于帮助恢复和更改密码的两个 Web 控件。 PasswordRecovery 控件启用访问者恢复他丢失的 pa...
ms.author: riande
ms.date: 04/01/2008
ms.assetid: 19c4d042-4e34-4b44-9f1d-6bf2253ba366
msc.legacyurl: /web-forms/overview/older-versions-security/admin/recovering-and-changing-passwords-cs
msc.type: authoredcontent
ms.openlocfilehash: e3e097663568b21ee3f84c7006a0bd89718ac6c2
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/09/2019
ms.locfileid: "59380270"
---
# <a name="recovering-and-changing-passwords-c"></a><span data-ttu-id="90288-104">恢复和更改密码 (C#)</span><span class="sxs-lookup"><span data-stu-id="90288-104">Recovering and Changing Passwords (C#)</span></span>

<span data-ttu-id="90288-105">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="90288-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="90288-106">[下载代码](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.13.zip)或[下载 PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial13_ChangingPasswords_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="90288-106">[Download Code](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.13.zip) or [Download PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial13_ChangingPasswords_cs.pdf)</span></span>

> <span data-ttu-id="90288-107">ASP.NET 包括用于帮助恢复和更改密码的两个 Web 控件。</span><span class="sxs-lookup"><span data-stu-id="90288-107">ASP.NET includes two Web controls for assisting with recovering and changing passwords.</span></span> <span data-ttu-id="90288-108">PasswordRecovery 控件，以恢复丢失的密码的访问者。</span><span class="sxs-lookup"><span data-stu-id="90288-108">The PasswordRecovery control enables a visitor to recover his lost password.</span></span> <span data-ttu-id="90288-109">ChangePassword 控件允许用户更新其密码。</span><span class="sxs-lookup"><span data-stu-id="90288-109">The ChangePassword control allows the user to update his password.</span></span> <span data-ttu-id="90288-110">与其他与登录相关 Web 控件类似情况下，我们已了解在本系列教程的 PasswordRecovery 整个和 ChangePassword 控件使用成员资格框架在后台重置或修改用户的密码。</span><span class="sxs-lookup"><span data-stu-id="90288-110">Like the other Login-related Web controls we've seen throughout this tutorial series, the PasswordRecovery and ChangePassword controls work with the Membership framework behind the scenes to reset or modify users' passwords.</span></span>


## <a name="introduction"></a><span data-ttu-id="90288-111">介绍</span><span class="sxs-lookup"><span data-stu-id="90288-111">Introduction</span></span>

<span data-ttu-id="90288-112">之间的我的银行、 公用事业公司、 电话公司、 电子邮件帐户和个性化的 web 门户网站，I，与大多数人一样使用了多个要记住的不同密码。</span><span class="sxs-lookup"><span data-stu-id="90288-112">Between the websites for my bank, utility company, phone company, email accounts, and personalized web portals, I, like most people, have dozens of different passwords to remember.</span></span> <span data-ttu-id="90288-113">使用凭据这么多，记住这些天，不常见的忘记了密码。</span><span class="sxs-lookup"><span data-stu-id="90288-113">With so many credentials to memorize these days, it's not uncommon for people to forget their password.</span></span> <span data-ttu-id="90288-114">若要考虑到这一点，需要包括一种方法来恢复其密码的用户提供用户帐户的网站。</span><span class="sxs-lookup"><span data-stu-id="90288-114">To account for this, websites that offer user accounts need to include a way for a user to recover his password.</span></span> <span data-ttu-id="90288-115">此过程通常涉及生成一个新的随机密码和文件的用户的电子邮件地址通过电子邮件发送。</span><span class="sxs-lookup"><span data-stu-id="90288-115">This process typically involves generating a new, random password and emailing it to the user's email address on file.</span></span> <span data-ttu-id="90288-116">接收新密码后大多数用户返回到该站点并到一个更容易记住的随机生成一个从更改其密码。</span><span class="sxs-lookup"><span data-stu-id="90288-116">After receiving their new password most users return to the site and change their password from the randomly generated one to a more memorable one.</span></span>

<span data-ttu-id="90288-117">ASP.NET 包括用于帮助恢复和更改密码的两个 Web 控件。</span><span class="sxs-lookup"><span data-stu-id="90288-117">ASP.NET includes two Web controls for assisting with recovering and changing passwords.</span></span> <span data-ttu-id="90288-118">PasswordRecovery 控件，以恢复丢失的密码的访问者。</span><span class="sxs-lookup"><span data-stu-id="90288-118">The PasswordRecovery control enables a visitor to recover his lost password.</span></span> <span data-ttu-id="90288-119">ChangePassword 控件允许用户更新其密码。</span><span class="sxs-lookup"><span data-stu-id="90288-119">The ChangePassword control allows the user to update his password.</span></span> <span data-ttu-id="90288-120">与其他与登录相关 Web 控件类似情况下，我们已了解在本系列教程的 PasswordRecovery 整个和 ChangePassword 控件使用成员资格框架在后台重置或修改用户的密码。</span><span class="sxs-lookup"><span data-stu-id="90288-120">Like the other Login-related Web controls we've seen throughout this tutorial series, the PasswordRecovery and ChangePassword controls work with the Membership framework behind the scenes to reset or modify users' passwords.</span></span>

<span data-ttu-id="90288-121">在本教程中，我们将说明使用这两个控件。</span><span class="sxs-lookup"><span data-stu-id="90288-121">In this tutorial we will examine using these two controls.</span></span> <span data-ttu-id="90288-122">我们还将了解如何以编程方式更改和重置用户的密码，通过`MembershipUser`类的`ChangePassword`和`ResetPassword`方法。</span><span class="sxs-lookup"><span data-stu-id="90288-122">We will also see how to programmatically change and reset a user's password via the `MembershipUser` class's `ChangePassword` and `ResetPassword` methods.</span></span>

## <a name="step-1-helping-users-recover-lost-passwords"></a><span data-ttu-id="90288-123">步骤 1：帮助用户恢复丢失密码</span><span class="sxs-lookup"><span data-stu-id="90288-123">Step 1: Helping Users Recover Lost Passwords</span></span>

<span data-ttu-id="90288-124">支持用户帐户的所有网站都需要向用户提供一些机制来恢复其遗忘的密码。</span><span class="sxs-lookup"><span data-stu-id="90288-124">All websites that support user accounts need to provide users with some mechanism for recovering their forgotten passwords.</span></span> <span data-ttu-id="90288-125">好消息是，在 ASP.NET 中实现此类功能是由于 PasswordRecovery Web 控件变得轻而易举。</span><span class="sxs-lookup"><span data-stu-id="90288-125">The good news is that implementing such functionality in ASP.NET is a breeze thanks to the PasswordRecovery Web control.</span></span> <span data-ttu-id="90288-126">PasswordRecovery 控件呈现提示用户输入其用户名的接口并根据需要其安全问题答案。</span><span class="sxs-lookup"><span data-stu-id="90288-126">The PasswordRecovery control renders an interface that prompts the user for their username and, if needed, the answer to their security question.</span></span> <span data-ttu-id="90288-127">它然后通过电子邮件发送用户其密码。</span><span class="sxs-lookup"><span data-stu-id="90288-127">It then emails the user their password.</span></span>

> [!NOTE]
> <span data-ttu-id="90288-128">由于电子邮件消息传输通过网络传输纯文本有安全风险所涉及的发送电子邮件的用户的密码。</span><span class="sxs-lookup"><span data-stu-id="90288-128">Because email messages are transmitted over the wire in plain-text there are security risks involved with sending a user's password via email.</span></span>


<span data-ttu-id="90288-129">PasswordRecovery 控件包含三个视图：</span><span class="sxs-lookup"><span data-stu-id="90288-129">The PasswordRecovery control consists of three views:</span></span>

- <span data-ttu-id="90288-130">**用户名**-会提示他们的用户名的访问者。</span><span class="sxs-lookup"><span data-stu-id="90288-130">**UserName** - prompts the visitor for their username.</span></span> <span data-ttu-id="90288-131">这是初始视图。</span><span class="sxs-lookup"><span data-stu-id="90288-131">This is the initial view.</span></span>
- <span data-ttu-id="90288-132">**问题**-显示为文本，以及用户输入其安全问题答案文本框的用户的用户名和安全问题。</span><span class="sxs-lookup"><span data-stu-id="90288-132">**Question**- displays the user's username and security question as text, along with a TextBox for the user to enter the answer to his security question.</span></span>
- <span data-ttu-id="90288-133">**成功**-显示一条消息，通知用户其密码已发送电子邮件。</span><span class="sxs-lookup"><span data-stu-id="90288-133">**Success**- displays a message informing the user that his password has been emailed.</span></span>

<span data-ttu-id="90288-134">显示视图，并由 PasswordRecovery 控件执行的操作取决于以下的成员身份配置设置：</span><span class="sxs-lookup"><span data-stu-id="90288-134">The views displayed and actions performed by the PasswordRecovery control depend upon the following Membership configuration settings:</span></span>

- `RequiresQuestionAndAnswer`
- `EnablePasswordRetrieval`
- `EnablePasswordReset`

<span data-ttu-id="90288-135">成员资格框架`RequiresQuestionAndAnswer`设置指示用户是否必须指定一个安全提示问题和答案时注册的帐户。</span><span class="sxs-lookup"><span data-stu-id="90288-135">The Membership framework's `RequiresQuestionAndAnswer` setting indicates whether users must specify a security question and answer when registering for an account.</span></span> <span data-ttu-id="90288-136">如中所述<a id="_msoanchor_1"> </a> [*创建用户帐户*](../membership/creating-user-accounts-cs.md)教程中，如果`RequiresQuestionAndAnswer`为 True （默认值），则 CreateUserWizard 的接口包含文本框控件的新用户的安全问题和答案;如果`RequiresQuestionAndAnswer`为 False 时，会收集任何此类信息。</span><span class="sxs-lookup"><span data-stu-id="90288-136">As we discussed in the <a id="_msoanchor_1"></a>[*Creating User Accounts*](../membership/creating-user-accounts-cs.md) tutorial, if `RequiresQuestionAndAnswer` is True (the default) then the CreateUserWizard's interface includes TextBox controls for the new user's security question and answer; if `RequiresQuestionAndAnswer` is False, no such information is collected.</span></span> <span data-ttu-id="90288-137">同样，如果`RequiresQuestionAndAnswer`为 True，则问题查看用户输入其用户名后 PasswordRecovery 控件显示; 仅当在用户输入正确的安全答案为其恢复密码。</span><span class="sxs-lookup"><span data-stu-id="90288-137">Similarly, if `RequiresQuestionAndAnswer` is True, then the PasswordRecovery control displays the Question view after the user has entered their username; the password is recovered only if the user enters the correct security answer.</span></span> <span data-ttu-id="90288-138">如果`RequiresQuestionAndAnswer`为 False，但是，取回控件将直接从用户名视图移到成功视图。</span><span class="sxs-lookup"><span data-stu-id="90288-138">If `RequiresQuestionAndAnswer` is False, however, the PasswordRecovery control moves straight from the UserName view to the Success view.</span></span>

<span data-ttu-id="90288-139">用户已提供其用户名的或其用户名和安全的答案，如果后`RequiresQuestionAndAnswer`为 PasswordRecovery 的 True-其密码的电子邮件用户。</span><span class="sxs-lookup"><span data-stu-id="90288-139">After the user has provided his username - or his username and security answer, if `RequiresQuestionAndAnswer` is True - the PasswordRecovery emails the user his password.</span></span> <span data-ttu-id="90288-140">如果`EnablePasswordRetrieval`选项设置为 True，则用户电子邮件通知他们当前的密码。</span><span class="sxs-lookup"><span data-stu-id="90288-140">If the `EnablePasswordRetrieval` option is set to True, then the user is emailed their current password.</span></span> <span data-ttu-id="90288-141">如果设置为 False 和`EnablePasswordReset`设置为 True，则 PasswordRecovery 控件生成一个新的随机密码，对于用户，并发送电子邮件向其此新密码。</span><span class="sxs-lookup"><span data-stu-id="90288-141">If it is set to False and `EnablePasswordReset` is set to True, then the PasswordRecovery control generates a new, random password for the user, and emails this new password to them.</span></span> <span data-ttu-id="90288-142">如果这两个`EnablePasswordRetrieval`和`EnablePasswordReset`均为 False，则 PasswordRecovery 控件将引发异常。</span><span class="sxs-lookup"><span data-stu-id="90288-142">If both `EnablePasswordRetrieval` and `EnablePasswordReset` are False, the PasswordRecovery control throws an exception.</span></span>

> [!NOTE]
> <span data-ttu-id="90288-143">请记住，`SqlMembershipProvider`将用户的密码存储在三种格式之一：清除、 哈希 （默认值） 或加密。</span><span class="sxs-lookup"><span data-stu-id="90288-143">Recall that the `SqlMembershipProvider` stores users' passwords in one of three formats: Clear, Hashed (the default), or Encrypted.</span></span> <span data-ttu-id="90288-144">使用的存储机制取决于成员身份配置设置;演示应用程序使用 Hashed 密码格式。</span><span class="sxs-lookup"><span data-stu-id="90288-144">The storage mechanism used depends on the Membership configuration settings; the demo application uses the Hashed password format.</span></span> <span data-ttu-id="90288-145">使用 Hashed 密码格式时`EnablePasswordRetrieval`选项必须设置为 False，因为系统将无法确定从数据库中存储的哈希版本的用户的实际密码。</span><span class="sxs-lookup"><span data-stu-id="90288-145">When using the Hashed password format the `EnablePasswordRetrieval` option must be set to False because the system cannot determine the user's actual password from the hashed version stored in the database.</span></span>


<span data-ttu-id="90288-146">图 1 说明 PasswordRecovery 的接口和行为的成员身份配置影响。</span><span class="sxs-lookup"><span data-stu-id="90288-146">Figure 1 illustrates how the PasswordRecovery's interface and behavior is influenced by the Membership configuration.</span></span>


[![T<span data-ttu-id="90288-147">他 RequiresQuestionAndAnswer、 EnablePasswordRetrieval 和 EnablePasswordReset 影响 PasswordRecovery 控件的外观和行为]</span><span class="sxs-lookup"><span data-stu-id="90288-147">he RequiresQuestionAndAnswer, EnablePasswordRetrieval, and EnablePasswordReset Influence the PasswordRecovery control's Appearance and Behavior]</span></span>(recovering-and-changing-passwords-cs/_static/image2.png)](recovering-and-changing-passwords-cs/_static/image1.png)

<span data-ttu-id="90288-148">**图 1**:`RequiresQuestionAndAnswer`， `EnablePasswordRetrieval`，并`EnablePasswordReset`影响 PasswordRecovery 控件的外观和行为 ([单击以查看实际尺寸的图像](recovering-and-changing-passwords-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="90288-148">**Figure 1**: The `RequiresQuestionAndAnswer`, `EnablePasswordRetrieval`, and `EnablePasswordReset` Influence the PasswordRecovery control's Appearance and Behavior  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image3.png))</span></span>


> [!NOTE]
> <span data-ttu-id="90288-149">在中<a id="_msoanchor_2"> </a> [ *SQL Server 中创建成员身份架构*](../membership/creating-the-membership-schema-in-sql-server-cs.md)我们通过设置来配置成员资格提供程序的教程`RequiresQuestionAndAnswer`为 True，`EnablePasswordRetrieval`到为 false，和`EnablePasswordReset`为 True。</span><span class="sxs-lookup"><span data-stu-id="90288-149">In the <a id="_msoanchor_2"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-cs.md) tutorial we configured the Membership provider by setting `RequiresQuestionAndAnswer` to True, `EnablePasswordRetrieval` to False, and `EnablePasswordReset` to True.</span></span>


### <a name="using-the-passwordrecovery-control"></a><span data-ttu-id="90288-150">使用 PasswordRecovery 控件</span><span class="sxs-lookup"><span data-stu-id="90288-150">Using the PasswordRecovery Control</span></span>

<span data-ttu-id="90288-151">让我们看看在 ASP.NET 页面中使用 PasswordRecovery 控件。</span><span class="sxs-lookup"><span data-stu-id="90288-151">Let's look at using the PasswordRecovery control in an ASP.NET page.</span></span> <span data-ttu-id="90288-152">打开`RecoverPassword.aspx`并拖动和删除取回控件从工具箱拖到设计器; 设置其`ID`到`RecoverPwd`。</span><span class="sxs-lookup"><span data-stu-id="90288-152">Open `RecoverPassword.aspx` and drag and drop a PasswordRecovery control from the Toolbox onto the Designer; set its `ID` to `RecoverPwd`.</span></span> <span data-ttu-id="90288-153">登录名和 CreateUserWizard Web 控件，如 PasswordRecovery 控件的视图呈现丰富的复合界面，其中包括标签、 文本框、 按钮和验证控件。</span><span class="sxs-lookup"><span data-stu-id="90288-153">Like the Login and CreateUserWizard Web controls, the PasswordRecovery control's views render a rich composite interface that includes Labels, TextBoxes, Buttons, and validation controls.</span></span> <span data-ttu-id="90288-154">您可以自定义视图通过控件的样式属性或通过将视图转换为模板的外观。</span><span class="sxs-lookup"><span data-stu-id="90288-154">You can customize the appearance of the views through the control's style properties or by converting the views into templates.</span></span> <span data-ttu-id="90288-155">我将此作为练习留给感读取器。</span><span class="sxs-lookup"><span data-stu-id="90288-155">I leave this as an exercise for the interested reader.</span></span>

<span data-ttu-id="90288-156">当用户访问此页她将输入其用户名，然后单击提交按钮。</span><span class="sxs-lookup"><span data-stu-id="90288-156">When a user visits this page she will enter her username and click the Submit button.</span></span> <span data-ttu-id="90288-157">因为我们已经设置了`RequiresQuestionAndAnswer`控制将属性设置为在我们的成员身份配置设置中，PasswordRecovery True，则显示问题视图。</span><span class="sxs-lookup"><span data-stu-id="90288-157">Because we have set the `RequiresQuestionAndAnswer` property to True in our Membership configuration settings, the PasswordRecovery control will then display the Question view.</span></span> <span data-ttu-id="90288-158">用户输入其正确的安全答案，并单击提交后，如何将用户的密码更新为一个随机生成的活动，和电子邮件上文件的电子邮件地址的此密码。</span><span class="sxs-lookup"><span data-stu-id="90288-158">After the user enters her correct security answer and clicks Submit, the PasswordRecovery control will update the user's password to a randomly-generated one, and email this password to the email address on file.</span></span> <span data-ttu-id="90288-159">所有这些都是没有我们无需编写一行代码 ！</span><span class="sxs-lookup"><span data-stu-id="90288-159">All of this was possible without us having to write a single line of code!</span></span>

<span data-ttu-id="90288-160">测试此页之前，还有最后一项要倾向于配置的： 我们需要指定中的邮件传递设置`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="90288-160">Before you test this page, there's one final piece of configuration to tend to: we need to specify the mail delivery settings in `Web.config`.</span></span> <span data-ttu-id="90288-161">PasswordRecovery 控件依赖这些设置用于发送电子邮件。</span><span class="sxs-lookup"><span data-stu-id="90288-161">The PasswordRecovery control relies on these settings for sending the email.</span></span>

<span data-ttu-id="90288-162">通过指定的邮件传递配置[`<system.net>`元素](https://msdn.microsoft.com/library/6484zdc1.aspx)的[`<mailSettings>`元素](https://msdn.microsoft.com/library/w355a94k.aspx)。</span><span class="sxs-lookup"><span data-stu-id="90288-162">The mail delivery configuration is specified through the [`<system.net>` element](https://msdn.microsoft.com/library/6484zdc1.aspx)'s [`<mailSettings>` element](https://msdn.microsoft.com/library/w355a94k.aspx).</span></span> <span data-ttu-id="90288-163">使用[`<smtp>`元素](https://msdn.microsoft.com/library/ms164240.aspx)以指示传递方法和发件人地址默认值。</span><span class="sxs-lookup"><span data-stu-id="90288-163">Use the [`<smtp>` element](https://msdn.microsoft.com/library/ms164240.aspx) to indicate the delivery method and the default From address.</span></span> <span data-ttu-id="90288-164">以下标记将使用名为的网络 SMTP 服务器邮件设置配置为`smtp.example.com`在端口 25 上并使用用户名/密码凭据的用户名和密码。</span><span class="sxs-lookup"><span data-stu-id="90288-164">The following markup configures mail settings to use a network SMTP server named `smtp.example.com` on port 25 and with username/password credentials of username and password.</span></span>

> [!NOTE]
> `<system.net>` <span data-ttu-id="90288-165">是根的子元素`<configuration>`元素和的同级`<system.web>`。</span><span class="sxs-lookup"><span data-stu-id="90288-165">is a child element of the root `<configuration>` element and a sibling of `<system.web>`.</span></span> <span data-ttu-id="90288-166">因此，不要将放`<system.net>`元素内的`<system.web>`元素; 而是将其放在同一级别上。</span><span class="sxs-lookup"><span data-stu-id="90288-166">Therefore, do not put the `<system.net>` element within the `<system.web>` element; instead, put it at the same level.</span></span>


[!code-xml[Main](recovering-and-changing-passwords-cs/samples/sample1.xml)]

<span data-ttu-id="90288-167">除了在网络上使用的 SMTP 服务器，或者可以指定其中应存放要发送的电子邮件的拾取目录。</span><span class="sxs-lookup"><span data-stu-id="90288-167">In addition to using an SMTP server on the network, you can alternatively specify a pickup directory where email messages to be sent should be deposited.</span></span>

<span data-ttu-id="90288-168">一旦已配置的 SMTP 设置，请访问`RecoverPassword.aspx`通过浏览器的页。</span><span class="sxs-lookup"><span data-stu-id="90288-168">Once you have configured the SMTP settings, visit the `RecoverPassword.aspx` page through a browser.</span></span> <span data-ttu-id="90288-169">首先，请尝试输入的用户名的用户存储中不存在。</span><span class="sxs-lookup"><span data-stu-id="90288-169">First try entering a username that doesn't exist in the user store.</span></span> <span data-ttu-id="90288-170">如图 2 所示，PasswordRecovery 控件将显示一条消息指出无法访问用户信息。</span><span class="sxs-lookup"><span data-stu-id="90288-170">As Figure 2 shows, the PasswordRecovery control displays a message indicating that the user information could not be accessed.</span></span> <span data-ttu-id="90288-171">可以通过控件的自定义消息的文本[`UserNameFailureText`属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.usernamefailuretext.aspx)。</span><span class="sxs-lookup"><span data-stu-id="90288-171">The text of the message can be customized through the control's [`UserNameFailureText` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.usernamefailuretext.aspx).</span></span>


[![A<span data-ttu-id="90288-172">如果输入无效的用户名，显示 n 个错误消息]</span><span class="sxs-lookup"><span data-stu-id="90288-172">n Error Message is Displayed if an Invalid Username is Entered]</span></span>(recovering-and-changing-passwords-cs/_static/image5.png)](recovering-and-changing-passwords-cs/_static/image4.png)

<span data-ttu-id="90288-173">**图 2**:如果输入无效的用户名显示一条错误消息 ([单击此项可查看原尺寸图像](recovering-and-changing-passwords-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="90288-173">**Figure 2**: An Error Message is Displayed if an Invalid Username is Entered  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image6.png))</span></span>


<span data-ttu-id="90288-174">现在，输入用户名。</span><span class="sxs-lookup"><span data-stu-id="90288-174">Now enter a username.</span></span> <span data-ttu-id="90288-175">使用知道的电子邮件地址可以访问和回答其安全系统中的帐户的用户名。</span><span class="sxs-lookup"><span data-stu-id="90288-175">Use the username of an account in the system with an email address that you can access and whose security answer you know.</span></span> <span data-ttu-id="90288-176">输入用户名并单击提交后, PasswordRecovery 控件显示其问题的视图。</span><span class="sxs-lookup"><span data-stu-id="90288-176">After entering the username and clicking Submit, the PasswordRecovery control displays its Question view.</span></span> <span data-ttu-id="90288-177">作为使用用户名视图中，如果输入不正确回答 PasswordRecovery 控件显示错误消息 （请参见图 3）。</span><span class="sxs-lookup"><span data-stu-id="90288-177">As with the UserName view, if you enter an incorrect answer the PasswordRecovery control displays an error message (see Figure 3).</span></span> <span data-ttu-id="90288-178">使用[`QuestionFailureText`属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.questionfailuretext.aspx)自定义此错误消息。</span><span class="sxs-lookup"><span data-stu-id="90288-178">Use the [`QuestionFailureText` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.questionfailuretext.aspx) to customize this error message.</span></span>


[![A<span data-ttu-id="90288-179">如果用户输入无效的安全提示问题答案，显示 n 个错误消息]</span><span class="sxs-lookup"><span data-stu-id="90288-179">n Error Message is Displayed if the User Enters an Invalid Security Answer]</span></span>(recovering-and-changing-passwords-cs/_static/image8.png)](recovering-and-changing-passwords-cs/_static/image7.png)

<span data-ttu-id="90288-180">**图 3**:如果用户输入无效的安全提示问题答案显示一条错误消息 ([单击此项可查看原尺寸图像](recovering-and-changing-passwords-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="90288-180">**Figure 3**: An Error Message is Displayed if the User Enters an Invalid Security Answer  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image9.png))</span></span>


<span data-ttu-id="90288-181">最后，输入正确的安全答案，并单击提交。</span><span class="sxs-lookup"><span data-stu-id="90288-181">Finally, enter the correct security answer and click Submit.</span></span> <span data-ttu-id="90288-182">在后台，PasswordRecovery 控制将生成随机密码，将其分配给用户帐户，将发送一封电子邮件，通知其新密码的用户 （请参阅图 4），然后显示成功视图。</span><span class="sxs-lookup"><span data-stu-id="90288-182">Behind the scenes, the PasswordRecovery control generates a random password, assigns it to the user account, sends an email informing the user of their new password (see Figure 4), and then displays the Success view.</span></span>


[![T<span data-ttu-id="90288-183">他用户发送一封电子邮件使用 His 的新密码]</span><span class="sxs-lookup"><span data-stu-id="90288-183">he User is Sent an Email with His New Password]</span></span>(recovering-and-changing-passwords-cs/_static/image11.png)](recovering-and-changing-passwords-cs/_static/image10.png)

<span data-ttu-id="90288-184">**图 4**:向用户发送一封电子邮件使用 His 的新密码 ([单击此项可查看原尺寸图像](recovering-and-changing-passwords-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="90288-184">**Figure 4**: The User is Sent an Email with His New Password  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image12.png))</span></span>


### <a name="customizing-the-email"></a><span data-ttu-id="90288-185">自定义电子邮件</span><span class="sxs-lookup"><span data-stu-id="90288-185">Customizing the Email</span></span>

<span data-ttu-id="90288-186">发送由 PasswordRecovery 控件的默认电子邮件是相当乏味 （请参阅图 4）。</span><span class="sxs-lookup"><span data-stu-id="90288-186">The default email sent by the PasswordRecovery control is rather dull (see Figure 4).</span></span> <span data-ttu-id="90288-187">默认情况下，邮件中指定的帐户从`<smtp>`元素的`from`具有使用者密码属性和纯文本正文：</span><span class="sxs-lookup"><span data-stu-id="90288-187">The message is sent from the account specified in the `<smtp>` element's `from` attribute with the subject Password and the plain-text body:</span></span>

<span data-ttu-id="90288-188">请返回到该站点，然后使用以下信息登录。</span><span class="sxs-lookup"><span data-stu-id="90288-188">Please return to the site and log in using the following information.</span></span>

<span data-ttu-id="90288-189">用户名：*用户名*</span><span class="sxs-lookup"><span data-stu-id="90288-189">User Name: *username*</span></span>

<span data-ttu-id="90288-190">密码：*密码*</span><span class="sxs-lookup"><span data-stu-id="90288-190">Password: *password*</span></span>

<span data-ttu-id="90288-191">此消息都可以通过为 PasswordRecovery 控件的事件处理程序以编程方式自定义[`SendingMail`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.sendingmail.aspx)，或以声明方式通过[`MailDefinition`属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.maildefinition.aspx)。</span><span class="sxs-lookup"><span data-stu-id="90288-191">This message can be customized programmatically through an event handler for the PasswordRecovery control's [`SendingMail` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.sendingmail.aspx), or declaratively through the [`MailDefinition` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.passwordrecovery.maildefinition.aspx).</span></span> <span data-ttu-id="90288-192">我们来探讨这两种选项。</span><span class="sxs-lookup"><span data-stu-id="90288-192">Let's explore both of these options.</span></span>

<span data-ttu-id="90288-193">`SendingMail`电子邮件消息发送，并且是我们最后一次机会来以编程方式调整的电子邮件消息之前触发事件。</span><span class="sxs-lookup"><span data-stu-id="90288-193">The `SendingMail` event is fired right before the email message is sent and is our last chance to programmatically adjust the email message.</span></span> <span data-ttu-id="90288-194">当引发此事件时，事件处理程序传递类型的对象[ `MailMessageEventArgs` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.mailmessageeventargs.aspx)，其`Message`属性包含对要发送的电子邮件的引用。</span><span class="sxs-lookup"><span data-stu-id="90288-194">When this event is raised, the event handler is passed an object of type [`MailMessageEventArgs`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.mailmessageeventargs.aspx), whose `Message` property contains a reference to the email about to be sent.</span></span>

<span data-ttu-id="90288-195">创建事件处理程序`SendingMail`事件，并添加以下代码，以便以编程方式添加`webmaster@example.com`到抄送列表。</span><span class="sxs-lookup"><span data-stu-id="90288-195">Create an event handler for the `SendingMail` event and add the following code, which programmatically adds `webmaster@example.com` to the CC list.</span></span>

[!code-csharp[Main](recovering-and-changing-passwords-cs/samples/sample2.cs)]

<span data-ttu-id="90288-196">此外可以通过声明性方式配置电子邮件。</span><span class="sxs-lookup"><span data-stu-id="90288-196">The email message can also be configured through declarative means.</span></span> <span data-ttu-id="90288-197">PasswordRecovery`MailDefinition`属性是一个对象类型[ `MailDefinition` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.aspx)。</span><span class="sxs-lookup"><span data-stu-id="90288-197">The PasswordRecovery's `MailDefinition` property is an object of type [`MailDefinition`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.aspx).</span></span> <span data-ttu-id="90288-198">`MailDefinition`类提供了一系列电子邮件相关的属性，包括`From`， `CC`， `Priority`， `Subject`， `IsBodyHtml`， `BodyFileName`，等等。</span><span class="sxs-lookup"><span data-stu-id="90288-198">The `MailDefinition` class offers a host of email-related properties, including `From`, `CC`, `Priority`, `Subject`, `IsBodyHtml`, `BodyFileName`, and others.</span></span> <span data-ttu-id="90288-199">对于初学者而言，设置[`Subject`属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.subject.aspx)为更具描述性比默认情况下 （密码），如你的密码已重置使用...</span><span class="sxs-lookup"><span data-stu-id="90288-199">For starters, set the [`Subject` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.subject.aspx) to something more descriptive than the one used by default ( Password ), such as Your password has been reset...</span></span>

<span data-ttu-id="90288-200">若要自定义我们需要创建单独的电子邮件模板文件的电子邮件的正文包含正文的内容。</span><span class="sxs-lookup"><span data-stu-id="90288-200">To customize the body of the email message we need to create a separate email template file that contains the body's contents.</span></span> <span data-ttu-id="90288-201">首先创建一个新的文件夹中名为的网站`EmailTemplates`。</span><span class="sxs-lookup"><span data-stu-id="90288-201">Start by creating a new folder in the website named `EmailTemplates`.</span></span> <span data-ttu-id="90288-202">接下来，将新的文本文件添加到此文件夹名为`PasswordRecovery.txt`并添加以下内容：</span><span class="sxs-lookup"><span data-stu-id="90288-202">Next, add a new text file to this folder named `PasswordRecovery.txt` and add the following content:</span></span>

[!code-aspx[Main](recovering-and-changing-passwords-cs/samples/sample3.aspx)]

<span data-ttu-id="90288-203">请注意，使用占位符`<%UserName%>`和`<%Password%>`。</span><span class="sxs-lookup"><span data-stu-id="90288-203">Note the use of the placeholders `<%UserName%>` and `<%Password%>`.</span></span> <span data-ttu-id="90288-204">使用用户的用户名和已恢复的密码在发送电子邮件前将取回控件自动替换这些两个占位符。</span><span class="sxs-lookup"><span data-stu-id="90288-204">The PasswordRecovery control automatically replaces these two placeholders with the user's username and recovered password prior to sending the email.</span></span>

<span data-ttu-id="90288-205">最后，点`MailDefinition`的[`BodyFileName`属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx)到我们刚刚创建的电子邮件模板 (`~/EmailTemplates/PasswordRecovery.txt`)。</span><span class="sxs-lookup"><span data-stu-id="90288-205">Lastly, point the `MailDefinition`'s [`BodyFileName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx) to the email template we just created (`~/EmailTemplates/PasswordRecovery.txt`).</span></span>

<span data-ttu-id="90288-206">执行这些更改重新访问后`RecoverPassword.aspx`页，并输入用户名和安全答案。</span><span class="sxs-lookup"><span data-stu-id="90288-206">After making these changes revisit the `RecoverPassword.aspx` page and enter your username and security answer.</span></span> <span data-ttu-id="90288-207">你收到应如图 5 中所示的电子邮件。</span><span class="sxs-lookup"><span data-stu-id="90288-207">You receive should an email that looks like the one in Figure 5.</span></span> <span data-ttu-id="90288-208">请注意，`webmaster@example.com`已经将抄送和，已更新的主题和正文。</span><span class="sxs-lookup"><span data-stu-id="90288-208">Note that `webmaster@example.com` has been CC'd and that the subject and body have been updated.</span></span>


[![T<span data-ttu-id="90288-209">他主题、 正文和抄送列表已更新]</span><span class="sxs-lookup"><span data-stu-id="90288-209">he Subject, Body, and CC List Have Been Updated]</span></span>(recovering-and-changing-passwords-cs/_static/image14.png)](recovering-and-changing-passwords-cs/_static/image13.png)

<span data-ttu-id="90288-210">**图 5**:主题、 正文和抄送已更新列表 ([单击此项可查看原尺寸图像](recovering-and-changing-passwords-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="90288-210">**Figure 5**: The Subject, Body, and CC List Have Been Updated  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image15.png))</span></span>


<span data-ttu-id="90288-211">若要发送 HTML 格式的电子邮件设置[ `IsBodyHtml` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.isbodyhtml.aspx)为 True （默认值为 False），并且更新电子邮件模板包含 HTML。</span><span class="sxs-lookup"><span data-stu-id="90288-211">To send an HTML-formatted email set [`IsBodyHtml`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.maildefinition.isbodyhtml.aspx) to True (the default is False) and update the email template to include HTML.</span></span>

<span data-ttu-id="90288-212">`MailDefinition`属性不是唯一的 PasswordRecovery 类。</span><span class="sxs-lookup"><span data-stu-id="90288-212">The `MailDefinition` property is not unique to the PasswordRecovery class.</span></span> <span data-ttu-id="90288-213">我们将在步骤 2 中看到的 ChangePassword 控件还提供了`MailDefinition`属性。</span><span class="sxs-lookup"><span data-stu-id="90288-213">As we will see in Step 2, the ChangePassword control also offers a `MailDefinition` property.</span></span> <span data-ttu-id="90288-214">此外，CreateUserWizard 控件包括这样的属性，您可以配置自动向新用户发送欢迎电子邮件消息。</span><span class="sxs-lookup"><span data-stu-id="90288-214">Moreover, the CreateUserWizard control includes such a property that you can configure to automatically send a welcome email message to new users.</span></span>

> [!NOTE]
> <span data-ttu-id="90288-215">当前没有任何链接在左侧导航栏中达到`RecoverPassword.aspx`页。</span><span class="sxs-lookup"><span data-stu-id="90288-215">Currently there are no links in the left-hand navigation for reaching the `RecoverPassword.aspx` page.</span></span> <span data-ttu-id="90288-216">用户仅有兴趣在如果她已成功登录到该站点无法访问此页。</span><span class="sxs-lookup"><span data-stu-id="90288-216">A user would only be interested in visiting this page if she was unable to successfully log on to the site.</span></span> <span data-ttu-id="90288-217">因此，更新`Login.aspx`页以包含一个指向`RecoverPassword.aspx`页。</span><span class="sxs-lookup"><span data-stu-id="90288-217">Therefore, update the `Login.aspx` page to include a link to the `RecoverPassword.aspx` page.</span></span>


### <a name="programmatically-resetting-a-users-password"></a><span data-ttu-id="90288-218">以编程方式重置用户的密码</span><span class="sxs-lookup"><span data-stu-id="90288-218">Programmatically Resetting a User's Password</span></span>

<span data-ttu-id="90288-219">当重置用户的密码 PasswordRecovery 控制调用`MembershipUser`对象的[`ResetPassword`方法](https://msdn.microsoft.com/library/system.web.security.membershipuser.resetpassword.aspx)。</span><span class="sxs-lookup"><span data-stu-id="90288-219">When resetting a user's password the PasswordRecovery control calls the `MembershipUser` object's [`ResetPassword` method](https://msdn.microsoft.com/library/system.web.security.membershipuser.resetpassword.aspx).</span></span> <span data-ttu-id="90288-220">此方法有两个重载：</span><span class="sxs-lookup"><span data-stu-id="90288-220">This method has two overloads:</span></span>

- <span data-ttu-id="90288-221">**[`ResetPassword`](https://msdn.microsoft.com/library/d94bdzz2.aspx)** -重置用户的密码。</span><span class="sxs-lookup"><span data-stu-id="90288-221">**[`ResetPassword`](https://msdn.microsoft.com/library/d94bdzz2.aspx)** - resets a user's password.</span></span> <span data-ttu-id="90288-222">如果使用此重载`RequiresQuestionAndAnswer`为 False。</span><span class="sxs-lookup"><span data-stu-id="90288-222">Use this overload if `RequiresQuestionAndAnswer` is False.</span></span>
- <span data-ttu-id="90288-223">**[`ResetPassword(securityAnswer)`](https://msdn.microsoft.com/library/d90zte4w.aspx)** -重置用户的密码仅当提供*securityAnswer*正确无误。</span><span class="sxs-lookup"><span data-stu-id="90288-223">**[`ResetPassword(securityAnswer)`](https://msdn.microsoft.com/library/d90zte4w.aspx)** - resets a user's password only if the supplied *securityAnswer* is correct.</span></span> <span data-ttu-id="90288-224">如果使用此重载`RequiresQuestionAndAnswer`为 True。</span><span class="sxs-lookup"><span data-stu-id="90288-224">Use this overload if `RequiresQuestionAndAnswer` is True.</span></span>

<span data-ttu-id="90288-225">这两个重载将返回随机生成的新密码。</span><span class="sxs-lookup"><span data-stu-id="90288-225">Both overloads return the new, randomly-generated password.</span></span>

<span data-ttu-id="90288-226">使用成员资格框架中的其他方法等`ResetPassword`方法委托给配置的提供程序。</span><span class="sxs-lookup"><span data-stu-id="90288-226">Like with the other methods in the Membership framework, the `ResetPassword` method delegates to the configured provider.</span></span> <span data-ttu-id="90288-227">`SqlMembershipProvider`调用`aspnet_Membership_ResetPassword`传递存储过程，在用户的用户名、 新密码和其他字段中提供的密码答案。</span><span class="sxs-lookup"><span data-stu-id="90288-227">The `SqlMembershipProvider` invokes the `aspnet_Membership_ResetPassword` stored procedure, passing in the user's username, the new password, and the supplied password answer, among other fields.</span></span> <span data-ttu-id="90288-228">存储的过程可确保密码提示问题答案与匹配，并更新用户的密码。</span><span class="sxs-lookup"><span data-stu-id="90288-228">The stored procedure ensures that the password answer matches and then updates the user's password.</span></span>

<span data-ttu-id="90288-229">几个低级别实现说明：</span><span class="sxs-lookup"><span data-stu-id="90288-229">A couple of low-level implementation notes:</span></span>

- <span data-ttu-id="90288-230">锁定的用户无法重置其密码。</span><span class="sxs-lookup"><span data-stu-id="90288-230">A locked out user cannot reset her password.</span></span> <span data-ttu-id="90288-231">但是，可能会未经批准的用户。</span><span class="sxs-lookup"><span data-stu-id="90288-231">However, an unapproved user may.</span></span> <span data-ttu-id="90288-232">我们将讨论锁定出和批准状态中更详细地<a id="_msoanchor_3"> </a> [ *Unlocking 和批准用户*](unlocking-and-approving-user-accounts-cs.md)帐户教程。</span><span class="sxs-lookup"><span data-stu-id="90288-232">We will discuss the locked out and approved states in more detail in the <a id="_msoanchor_3"></a>[*Unlocking and Approving User*](unlocking-and-approving-user-accounts-cs.md) Accounts tutorial.</span></span>
- <span data-ttu-id="90288-233">如果密码提示问题答案不正确，用户的失败的密码答案尝试计数将递增。</span><span class="sxs-lookup"><span data-stu-id="90288-233">If the password answer is incorrect, the user's failed password answer attempt count is incremented.</span></span> <span data-ttu-id="90288-234">如果指定的时间范围内发生指定的数量的无效的安全提示问题答案尝试，用户被锁定。</span><span class="sxs-lookup"><span data-stu-id="90288-234">If a specified number of invalid security answer attempts occur within a specified time window, the user is locked out.</span></span>

### <a name="a-word-on-how-the-random-passwords-are-generated"></a><span data-ttu-id="90288-235">有关如何的随机密码生成</span><span class="sxs-lookup"><span data-stu-id="90288-235">A Word on How the Random Passwords are Generated</span></span>

<span data-ttu-id="90288-236">图 4 和 5 中的电子邮件中所示的随机生成的密码创建的成员资格类[`GeneratePassword`方法](https://msdn.microsoft.com/library/system.web.security.membership.generatepassword.aspx)。</span><span class="sxs-lookup"><span data-stu-id="90288-236">The randomly-generated passwords shown in the email messages in Figures 4 and 5 are created by the Membership class's [`GeneratePassword` method](https://msdn.microsoft.com/library/system.web.security.membership.generatepassword.aspx).</span></span> <span data-ttu-id="90288-237">此方法接受两个整数输入的参数-*长度*并*numberOfNonAlphanumericCharacters* -并至少返回一个字符串*长度*在长时间使用字符至少*numberOfNonAlphanumericCharacters*非字母数字字符数。</span><span class="sxs-lookup"><span data-stu-id="90288-237">This method accepts two integer input paramters - *length* and *numberOfNonAlphanumericCharacters* - and returns a string at least *length* characters long with at least *numberOfNonAlphanumericCharacters* number of non-alphanumeric characters.</span></span> <span data-ttu-id="90288-238">当此方法的调用时从成员资格类或与登录相关 Web 控件中时，将这两个参数的值由成员身份配置`MinRequiredPasswordLength`和`MinRequiredNonalphanumericCharacters`属性，我们分别设置为 7 和 1。</span><span class="sxs-lookup"><span data-stu-id="90288-238">When this method is called from within the Membership classes or Login-related Web controls, the values for these two parameters are determined by the Membership configuration's `MinRequiredPasswordLength` and `MinRequiredNonalphanumericCharacters` properties, which we set to 7 and 1, respectively.</span></span>

<span data-ttu-id="90288-239">`GeneratePassword`方法使用强加密型随机数生成器来确保中会选择哪些随机字符无偏差。</span><span class="sxs-lookup"><span data-stu-id="90288-239">The `GeneratePassword` method uses a cryptographically strong random number generator to ensure that there is no bias in what random characters are selected.</span></span> <span data-ttu-id="90288-240">此外，`GeneratePassword`是`public`，这意味着，您可以使用它直接从 ASP.NET 应用程序如果需要生成随机字符串或密码。</span><span class="sxs-lookup"><span data-stu-id="90288-240">Furthermore, `GeneratePassword` is `public`, meaning that you can use it directly from your ASP.NET application if you need to generate random strings or passwords.</span></span>

> [!NOTE]
> <span data-ttu-id="90288-241">`SqlMembershipProvider`类始终生成随机密码至少为 14 个字符，因此，如果`MinRequiredPasswordLength`小于 14 就会忽略其值。</span><span class="sxs-lookup"><span data-stu-id="90288-241">The `SqlMembershipProvider` class always generates a random password at least 14 characters long, so if `MinRequiredPasswordLength` is less than 14 then its value is ignored.</span></span>


## <a name="step-2-changing-passwords"></a><span data-ttu-id="90288-242">步骤 2：更改密码</span><span class="sxs-lookup"><span data-stu-id="90288-242">Step 2: Changing Passwords</span></span>

<span data-ttu-id="90288-243">随机生成密码很难记住。</span><span class="sxs-lookup"><span data-stu-id="90288-243">The randomly-generated passwords are difficult to remember.</span></span> <span data-ttu-id="90288-244">图 4 所示的密码，请考虑： `WWGUZv(f2yM:Bd`。</span><span class="sxs-lookup"><span data-stu-id="90288-244">Consider the password shown in Figure 4: `WWGUZv(f2yM:Bd`.</span></span> <span data-ttu-id="90288-245">请尝试提交的内存 ！</span><span class="sxs-lookup"><span data-stu-id="90288-245">Try committing that to memory!</span></span> <span data-ttu-id="90288-246">不用说，向用户发送此类随机生成的密码后，她需要的密码更改为更容易记住的内容。</span><span class="sxs-lookup"><span data-stu-id="90288-246">Needless to say, after a user is sent a randomly-generated password of this sort, she'll want to change the password to something more memorable.</span></span>

<span data-ttu-id="90288-247">使用 ChangePassword 控件创建一个接口，使用户能够更改其密码。</span><span class="sxs-lookup"><span data-stu-id="90288-247">Use the ChangePassword control to create an interface for a user to change her password.</span></span> <span data-ttu-id="90288-248">更类似于 PasswordRecovery 控件 ChangePassword 控件包含两个视图：更改密码和成功。</span><span class="sxs-lookup"><span data-stu-id="90288-248">Much like the PasswordRecovery control, the ChangePassword control consists of two views: Change Password and Success.</span></span> <span data-ttu-id="90288-249">更改密码视图会提示用户输入其旧的和新密码。</span><span class="sxs-lookup"><span data-stu-id="90288-249">The Change Password view prompts the user for their old and new passwords.</span></span> <span data-ttu-id="90288-250">在提供正确的旧密码和新密码满足最小长度和非字母数字字符要求，ChangePassword 控件更新用户的密码，并显示成功视图。</span><span class="sxs-lookup"><span data-stu-id="90288-250">Upon supplying the correct old password and a new password that meets the minimum length and non-alphanumeric character requirements, the ChangePassword control updates the user's password and displays the Success view.</span></span>

> [!NOTE]
> <span data-ttu-id="90288-251">ChangePassword 控件通过调用修改用户的密码`MembershipUser`对象的[`ChangePassword`方法](https://msdn.microsoft.com/library/system.web.security.membershipuser.changepassword.aspx)。</span><span class="sxs-lookup"><span data-stu-id="90288-251">The ChangePassword control modifies the user's password by invoking the `MembershipUser` object's [`ChangePassword` method](https://msdn.microsoft.com/library/system.web.security.membershipuser.changepassword.aspx).</span></span> <span data-ttu-id="90288-252">ChangePassword 方法接受两个`string`输入参数的*oldPassword*并*newPassword*的和更新用户的帐户与*newPassword*，假定提供*oldPassword*正确无误。</span><span class="sxs-lookup"><span data-stu-id="90288-252">The ChangePassword method accepts two `string` input parameters - *oldPassword* and *newPassword*- and updates the user's account with the *newPassword*, assuming the supplied *oldPassword* is correct.</span></span>


<span data-ttu-id="90288-253">打开`ChangePassword.aspx`页上，并将 ChangePassword 控件添加到页上，其命名为`ChangePwd`。</span><span class="sxs-lookup"><span data-stu-id="90288-253">Open the `ChangePassword.aspx` page and add a ChangePassword control to the page, naming it `ChangePwd`.</span></span> <span data-ttu-id="90288-254">此时，设计视图应显示更改密码查看 （请参阅图 6）。</span><span class="sxs-lookup"><span data-stu-id="90288-254">At this point, the Design view should show the Change Password view (see Figure 6).</span></span> <span data-ttu-id="90288-255">如 PasswordRecovery 控件后，你可以在视图之间切换通过控件的智能标记。</span><span class="sxs-lookup"><span data-stu-id="90288-255">Like with the PasswordRecovery control, you can toggle between the views via the control's Smart Tag.</span></span> <span data-ttu-id="90288-256">此外，这些视图的外观是通过各种类型的样式属性或将它们转换为模板，可自定义。</span><span class="sxs-lookup"><span data-stu-id="90288-256">Furthermore, these views' appearances are customizable through the assorted style properties or by converting them to a template.</span></span>


[![A<span data-ttu-id="90288-257">dd ChangePassword 控件与页]</span><span class="sxs-lookup"><span data-stu-id="90288-257">dd a ChangePassword Control to the Page]</span></span>(recovering-and-changing-passwords-cs/_static/image17.png)](recovering-and-changing-passwords-cs/_static/image16.png)

<span data-ttu-id="90288-258">**图 6**:ChangePassword 控件添加到页 ([单击此项可查看原尺寸图像](recovering-and-changing-passwords-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="90288-258">**Figure 6**: Add a ChangePassword Control to the Page  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image18.png))</span></span>


<span data-ttu-id="90288-259">ChangePassword 控件可以更新当前已登录的用户的密码*或*另一个，指定用户的密码。</span><span class="sxs-lookup"><span data-stu-id="90288-259">The ChangePassword control can update the currently logged in user's password *or* the password of another, specified user.</span></span> <span data-ttu-id="90288-260">如图 6 所示，默认更改密码视图呈现只是三个文本框控件： 一个用于旧密码，两个新密码。</span><span class="sxs-lookup"><span data-stu-id="90288-260">As Figure 6 shows, the default Change Password view renders just three TextBox controls: one for the old password and two for the new password.</span></span> <span data-ttu-id="90288-261">此默认接口用于更新当前已登录的用户的密码。</span><span class="sxs-lookup"><span data-stu-id="90288-261">This default interface is used to update the currently logged on user's password.</span></span>

<span data-ttu-id="90288-262">若要使用 ChangePassword 控件更新其他用户的密码，设置控件的[`DisplayUserName`属性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.changepassword.displayusername.aspx)为 True。</span><span class="sxs-lookup"><span data-stu-id="90288-262">To use the ChangePassword control to update another user's password, set the control's [`DisplayUserName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.changepassword.displayusername.aspx) to True.</span></span> <span data-ttu-id="90288-263">执行此操作将第四个文本框添加到页上，若要更改其密码提示输入用户的用户名。</span><span class="sxs-lookup"><span data-stu-id="90288-263">Doing so adds a fourth TextBox to the page, prompting for the username of the user whose password to change.</span></span>

<span data-ttu-id="90288-264">设置`DisplayUserName`到，如果你想要让已注销用户而无需登录时更改其密码有用则为 True。</span><span class="sxs-lookup"><span data-stu-id="90288-264">Setting `DisplayUserName` to True is useful if you want to let a logged out user change her password without having to log in.</span></span> <span data-ttu-id="90288-265">就个人而言，我认为没有什么不妥允许用户更改其密码前需登录到用户。</span><span class="sxs-lookup"><span data-stu-id="90288-265">Personally, I think there's nothing wrong with requiring a user to login before allowing her to change her password.</span></span> <span data-ttu-id="90288-266">因此，请让`DisplayUserName`设置为 False （其默认值）。</span><span class="sxs-lookup"><span data-stu-id="90288-266">Therefore, leave `DisplayUserName` set to False (its default).</span></span> <span data-ttu-id="90288-267">在做出此决策，但是，我们实质上不包括匿名用户访问此页。</span><span class="sxs-lookup"><span data-stu-id="90288-267">In making this decision, however, we essentially are barring anonymous users from reaching this page.</span></span> <span data-ttu-id="90288-268">更新站点的 URL 授权规则以拒绝匿名用户访问从`ChangePassword.aspx`。</span><span class="sxs-lookup"><span data-stu-id="90288-268">Update the site's URL authorization rules so as to deny anonymous users from visiting `ChangePassword.aspx`.</span></span> <span data-ttu-id="90288-269">如果你需要刷新你的 URL 授权规则语法上的内存，回头<a id="_msoanchor_4"> </a> [*基于用户的授权*](../membership/user-based-authorization-cs.md)教程。</span><span class="sxs-lookup"><span data-stu-id="90288-269">If you need to refresh your memory on the URL authorization rule syntax, refer back to the <a id="_msoanchor_4"></a>[*User-Based Authorization*](../membership/user-based-authorization-cs.md) tutorial.</span></span>

> [!NOTE]
> <span data-ttu-id="90288-270">它可能看起来的`DisplayUserName`属性可用于允许管理员更改其他用户的密码。</span><span class="sxs-lookup"><span data-stu-id="90288-270">It may seem that the `DisplayUserName` property is useful for allowing administrators to change other users' passwords.</span></span> <span data-ttu-id="90288-271">但是，即使`DisplayUserName`设置为 True 必须知道并输入正确的旧密码。</span><span class="sxs-lookup"><span data-stu-id="90288-271">However, even when `DisplayUserName` is set to True the correct old password must be known and entered.</span></span> <span data-ttu-id="90288-272">我们将讨论从而使管理员可以更改在步骤 3 中的用户的密码的方法。</span><span class="sxs-lookup"><span data-stu-id="90288-272">We will talk about techniques for allowing administrators to change users' passwords in Step 3.</span></span>


<span data-ttu-id="90288-273">请访问`ChangePassword.aspx`通过浏览器页并更改你的密码。</span><span class="sxs-lookup"><span data-stu-id="90288-273">Visit the `ChangePassword.aspx` page through a browser and change your password.</span></span> <span data-ttu-id="90288-274">请注意，是否输入不能满足密码长度和成员身份配置中指定的非字母数字字符要求的新密码将显示一条错误消息 （请参阅图 7）。</span><span class="sxs-lookup"><span data-stu-id="90288-274">Note that an error message is displayed if you enter a new password that fails to meet the password length and non-alphanumeric character requirements specified in the Membership configuration (see Figure 7).</span></span>


[![A<span data-ttu-id="90288-275">dd ChangePassword 控件与页]</span><span class="sxs-lookup"><span data-stu-id="90288-275">dd a ChangePassword Control to the Page]</span></span>(recovering-and-changing-passwords-cs/_static/image20.png)](recovering-and-changing-passwords-cs/_static/image19.png)

<span data-ttu-id="90288-276">**图 7**:ChangePassword 控件添加到页 ([单击此项可查看原尺寸图像](recovering-and-changing-passwords-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="90288-276">**Figure 7**: Add a ChangePassword Control to the Page  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image21.png))</span></span>


<span data-ttu-id="90288-277">在输入正确的旧密码和有效新密码，已登录用户的密码已更改，显示成功视图。</span><span class="sxs-lookup"><span data-stu-id="90288-277">Upon entering the correct old password and a valid new password, the logged on user's password is changed and the Success view displayed.</span></span>

### <a name="sending-a-confirmation-email"></a><span data-ttu-id="90288-278">发送确认电子邮件</span><span class="sxs-lookup"><span data-stu-id="90288-278">Sending a Confirmation Email</span></span>

<span data-ttu-id="90288-279">默认情况下，ChangePassword 控件不到刚刚更新了其密码的用户发送一封电子邮件。</span><span class="sxs-lookup"><span data-stu-id="90288-279">By default, the ChangePassword control does not send an email message to the user whose password was just updated.</span></span> <span data-ttu-id="90288-280">如果你想要将发送一封电子邮件，只需配置该控件的`MailDefinition`属性。</span><span class="sxs-lookup"><span data-stu-id="90288-280">If you'd like to send an email, simply configure the control's `MailDefinition` property.</span></span> <span data-ttu-id="90288-281">让我们配置 ChangePassword 控件，以便向用户发送包含其新密码的 HTML 格式电子邮件。</span><span class="sxs-lookup"><span data-stu-id="90288-281">Let's configure the ChangePassword control so that the user is sent an HTML-formatted email that contains their new password.</span></span>

<span data-ttu-id="90288-282">首先，创建的新文件中`EmailTemplates`文件夹名为`ChangePassword.htm`。</span><span class="sxs-lookup"><span data-stu-id="90288-282">Start by creating a new file in the `EmailTemplates` folder named `ChangePassword.htm`.</span></span> <span data-ttu-id="90288-283">添加以下标记：</span><span class="sxs-lookup"><span data-stu-id="90288-283">Add the following markup:</span></span>

[!code-html[Main](recovering-and-changing-passwords-cs/samples/sample4.html)]

<span data-ttu-id="90288-284">接下来，设置 ChangePassword 控件`MailDefinition`属性的`BodyFileName`， `IsBodyHtml`，和`Subject`属性设置为 ~ / EmailTemplates/ChangePassword.htm，True 和你的密码已更改 ！ 分别。</span><span class="sxs-lookup"><span data-stu-id="90288-284">Next, set the ChangePassword control's `MailDefinition` property's `BodyFileName`, `IsBodyHtml`, and `Subject` properties to ~/EmailTemplates/ChangePassword.htm, True, and Your password has changed!, respectively.</span></span>

<span data-ttu-id="90288-285">进行这些更改之后, 重新访问该页并再次更改密码。</span><span class="sxs-lookup"><span data-stu-id="90288-285">After making these changes, revisit the page and change your password again.</span></span> <span data-ttu-id="90288-286">这一次，ChangePassword 控件将发送到用户的电子邮件地址上文件的自定义的 HTML 格式的电子邮件 （请参阅图 8）。</span><span class="sxs-lookup"><span data-stu-id="90288-286">This time, the ChangePassword control sends a customized, HTML-formatted email to the user's email address on file (see Figure 8).</span></span>


[![A<span data-ttu-id="90288-287">n 个电子邮件消息通知后更改了用户，他们的密码]</span><span class="sxs-lookup"><span data-stu-id="90288-287">n Email Message Informs the User That Their Password has Changed]</span></span>(recovering-and-changing-passwords-cs/_static/image23.png)](recovering-and-changing-passwords-cs/_static/image22.png)

<span data-ttu-id="90288-288">**图 8**:电子邮件消息通知用户，他们的密码已更改 ([单击此项可查看原尺寸图像](recovering-and-changing-passwords-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="90288-288">**Figure 8**: An Email Message Informs the User That Their Password has Changed  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image24.png))</span></span>


## <a name="step-3-allowing-administrators-to-change-users-passwords"></a><span data-ttu-id="90288-289">步骤 3：从而使管理员可以更改用户的密码</span><span class="sxs-lookup"><span data-stu-id="90288-289">Step 3: Allowing Administrators to Change Users' Passwords</span></span>

<span data-ttu-id="90288-290">在支持用户帐户的应用程序中的一个常见功能是管理用户，以更改其他用户的密码的功能。</span><span class="sxs-lookup"><span data-stu-id="90288-290">A common feature in applications that support user accounts is the ability for an administrative user to change other users' passwords.</span></span> <span data-ttu-id="90288-291">有时此功能是必需的因为系统不具备用户更改其自己的密码的功能。</span><span class="sxs-lookup"><span data-stu-id="90288-291">Sometimes this functionality is required because the system lacks the ability for users to change their own passwords.</span></span> <span data-ttu-id="90288-292">在这种情况下，恢复其忘记了的密码的用户的唯一方法会让管理员将其分配新密码。</span><span class="sxs-lookup"><span data-stu-id="90288-292">In such a case, the only way for a user to recover their forgotten password would be for the administrator to assign them a new password.</span></span> <span data-ttu-id="90288-293">PasswordRecovery 和 ChangePassword 控件，但是，管理用户需要不忙本身与更改用户的密码，因为用户能够执行此本身。</span><span class="sxs-lookup"><span data-stu-id="90288-293">With the PasswordRecovery and ChangePassword controls, however, administrative users need not busy themselves with changing users' passwords, as users are capable of doing this themselves.</span></span>

<span data-ttu-id="90288-294">但是，如果您的客户端坚持管理用户应该能够更改其他用户的密码？</span><span class="sxs-lookup"><span data-stu-id="90288-294">But what if your client insists that administrative users should be able to change other users' passwords?</span></span> <span data-ttu-id="90288-295">遗憾的是，添加此功能可以是一些工作。</span><span class="sxs-lookup"><span data-stu-id="90288-295">Unfortunately, adding this functionality can be a bit of work.</span></span> <span data-ttu-id="90288-296">若要更改用户的密码，旧的和新密码必须提供给`MembershipUser`对象的`ChangePassword`方法，但管理员无需知道用户的密码，才能对其进行修改。</span><span class="sxs-lookup"><span data-stu-id="90288-296">To change a user's password, both the old and new password must be supplied to the `MembershipUser` object's `ChangePassword` method, but an administrator shouldn't have to know a user's password in order to modify it.</span></span>

<span data-ttu-id="90288-297">一种解决办法是首先重置用户的密码，然后将其更改为使用如下所示的代码的新密码：</span><span class="sxs-lookup"><span data-stu-id="90288-297">One workaround is to first reset the user's password and then change it to the new password using code like the following:</span></span>

[!code-aspx[Main](recovering-and-changing-passwords-cs/samples/sample5.aspx)]

<span data-ttu-id="90288-298">此代码首先会检索有关的信息*用户名*，这是管理员想要更改其密码的用户。</span><span class="sxs-lookup"><span data-stu-id="90288-298">This code starts by retrieving information about *username*, which is the user whose password the administrator wishes to change.</span></span> <span data-ttu-id="90288-299">下一步，`ResetPassword`调用方法时，哪些分配和用户的新的随机密码。</span><span class="sxs-lookup"><span data-stu-id="90288-299">Next, the `ResetPassword` method is invoked, which assigns and the user a new, random password.</span></span> <span data-ttu-id="90288-300">方法返回此随机生成的密码并将其存储在变量`resetPwd`。</span><span class="sxs-lookup"><span data-stu-id="90288-300">This randomly-generated password is returned by the method and stored in the variable `resetPwd`.</span></span> <span data-ttu-id="90288-301">现在，我们知道用户的密码，我们可以将其更改通过调用`ChangePassword`。</span><span class="sxs-lookup"><span data-stu-id="90288-301">Now that we know the user's password, we can change it via a call to `ChangePassword`.</span></span>

<span data-ttu-id="90288-302">问题是，此代码仅适用如果成员资格系统配置设置，以便`RequiresQuestionAndAnswer`为 False。</span><span class="sxs-lookup"><span data-stu-id="90288-302">The problem is that this code only works if the Membership system configuration is set such that `RequiresQuestionAndAnswer` is False.</span></span> <span data-ttu-id="90288-303">如果`RequiresQuestionAndAnswer`为 True，这一点与我们的应用程序，则`ResetPassword`方法需要传递的安全答案，否则它将引发异常。</span><span class="sxs-lookup"><span data-stu-id="90288-303">If `RequiresQuestionAndAnswer` is True, as it is with our application, then the `ResetPassword` method needs to be passed the security answer, otherwise it will throw an exception.</span></span>

<span data-ttu-id="90288-304">如果成员资格框架配置为要求安全问题和答案，和你的客户端尚未坚持，管理员必须能够更改用户的密码，则有三个选项：</span><span class="sxs-lookup"><span data-stu-id="90288-304">If the Membership framework is configured to require a security question and answer, and yet your client insists that administrators be able to change users' passwords, you have three options:</span></span>

- <span data-ttu-id="90288-305">在空中运动引发手，告诉你的客户端，这是不能做的只是一件事。</span><span class="sxs-lookup"><span data-stu-id="90288-305">Throw your hands in the air and tell your client that this is just one thing that cannot be done.</span></span>
- <span data-ttu-id="90288-306">设置`RequiresQuestionAndAnswer`为 False。</span><span class="sxs-lookup"><span data-stu-id="90288-306">Set `RequiresQuestionAndAnswer` to False.</span></span> <span data-ttu-id="90288-307">这会导致安全级别较低的应用程序。</span><span class="sxs-lookup"><span data-stu-id="90288-307">This results in a less secure application.</span></span> <span data-ttu-id="90288-308">假设恶意用户获得了对其他用户的电子邮件收件箱的访问。</span><span class="sxs-lookup"><span data-stu-id="90288-308">Imagine that a nefarious user has gained access to another user's email inbox.</span></span> <span data-ttu-id="90288-309">可能被入侵的用户已离开其办公桌去享用午餐，没有锁定其工作站，或可能是从公共终端访问其电子邮件和未注销。在任一情况下，恶意用户可以访问`RecoverPassword.aspx`页，并输入用户的用户名。</span><span class="sxs-lookup"><span data-stu-id="90288-309">Perhaps the compromised user has left their desk to go to lunch and didn't lock their workstation, or maybe they accessed their email from a public terminal and didn't sign out. In either case, the nefarious user can visit the `RecoverPassword.aspx` page and enter the user's username.</span></span> <span data-ttu-id="90288-310">系统将通过电子邮件发送的已恢复的密码而不提示的安全答案。</span><span class="sxs-lookup"><span data-stu-id="90288-310">The system will then email the recovered password without prompting for the security answer.</span></span>
- <span data-ttu-id="90288-311">跳过创建的成员资格框架和直接使用 SQL Server 数据库的抽象层。</span><span class="sxs-lookup"><span data-stu-id="90288-311">Bypass the abstraction layer created by the Membership framework and work directly with the SQL Server database.</span></span> <span data-ttu-id="90288-312">成员身份架构包括一个名为的存储的过程`aspnet_Membership_SetPassword`，设置用户的密码，并且不需要的安全答案或旧密码的完成其任务。</span><span class="sxs-lookup"><span data-stu-id="90288-312">The Membership schema includes a stored procedure named `aspnet_Membership_SetPassword` that sets a user's password and does not require the security answer or old password in order to accomplish its task.</span></span>

<span data-ttu-id="90288-313">这些选项都不是特别有吸引力，但这是开发人员的生活有时出现的方式。</span><span class="sxs-lookup"><span data-stu-id="90288-313">None of these options are particularly appealing, but that's how the life of a developer goes sometimes.</span></span>

<span data-ttu-id="90288-314">下来，实现第三种方法，编写代码时绕过`Membership`并`MembershipUser`类，并直接对其操作`SecurityTutorials`数据库。</span><span class="sxs-lookup"><span data-stu-id="90288-314">I went ahead and implemented the third approach, writing code that bypasses the `Membership` and `MembershipUser` classes and operates directly against the `SecurityTutorials` database.</span></span>

> [!NOTE]
> <span data-ttu-id="90288-315">通过直接使用数据库，提供的成员资格框架的封装已被破坏。</span><span class="sxs-lookup"><span data-stu-id="90288-315">By working directly with the database, the encapsulation provided by the Membership framework is shattered.</span></span> <span data-ttu-id="90288-316">此决定会绑定到我们`SqlMembershipProvider`，从而使我们更少可移植的代码。</span><span class="sxs-lookup"><span data-stu-id="90288-316">This decision ties us to the `SqlMembershipProvider`, making our code less portable.</span></span> <span data-ttu-id="90288-317">此外，此代码可能无法按预期在将来版本的 ASP.NET 中，如果成员身份架构发生更改。</span><span class="sxs-lookup"><span data-stu-id="90288-317">Furthermore, this code may not work as expected in future versions of ASP.NET if the Membership schema changes.</span></span> <span data-ttu-id="90288-318">这种方法是一种解决方法，并像大多数解决方法，不是最佳做法的示例。</span><span class="sxs-lookup"><span data-stu-id="90288-318">This approach is a workaround and, like most workarounds, is not an example of best practices.</span></span>


<span data-ttu-id="90288-319">代码具有一些不严重的位，非常长。</span><span class="sxs-lookup"><span data-stu-id="90288-319">The code has some unattractive bits and is quite lengthy.</span></span> <span data-ttu-id="90288-320">因此，我不想使本教程中使用它的深入探讨变得混乱。</span><span class="sxs-lookup"><span data-stu-id="90288-320">Therefore, I don't want to clutter this tutorial with an in-depth examination of it.</span></span> <span data-ttu-id="90288-321">如果您有兴趣学习的详细信息，下载的代码对于此教程，请访问`~/Administration/ManageUsers.aspx`页。</span><span class="sxs-lookup"><span data-stu-id="90288-321">If you are interested in learning more, download the code for this tutorial and visit the `~/Administration/ManageUsers.aspx` page.</span></span> <span data-ttu-id="90288-322">此页上，我们在中创建<a id="_msoanchor_5"> </a>[前面的教程](building-an-interface-to-select-one-user-account-from-many-cs.md)，列出了每个用户。</span><span class="sxs-lookup"><span data-stu-id="90288-322">This page, which we created in the <a id="_msoanchor_5"></a>[preceding tutorial](building-an-interface-to-select-one-user-account-from-many-cs.md), lists each user.</span></span> <span data-ttu-id="90288-323">我更新了 GridView，其中包含一个指向`UserInformation.aspx`页上，将传递查询字符串通过所选的用户的用户名。</span><span class="sxs-lookup"><span data-stu-id="90288-323">I've updated the GridView to include a link to the `UserInformation.aspx` page, passing the selected user's username through the querystring.</span></span> <span data-ttu-id="90288-324">`UserInformation.aspx`页显示有关所选的用户和文本框的信息用于更改其密码 （请参阅图 9）。</span><span class="sxs-lookup"><span data-stu-id="90288-324">The `UserInformation.aspx` page displays information about the selected user and TextBoxes for changing their password (see Figure 9).</span></span>

<span data-ttu-id="90288-325">输入新密码，在第二个文本框中，确认，并单击更新用户按钮后，才会回发和`aspnet_Membership_SetPassword`调用存储的过程时，更新用户的密码。</span><span class="sxs-lookup"><span data-stu-id="90288-325">After entering the new password, confirming it in the second TextBox, and clicking the Update User Button, a postback ensues and the `aspnet_Membership_SetPassword` stored procedure is invoked, updating the user's password.</span></span> <span data-ttu-id="90288-326">建议对此功能感兴趣的这些读取器进一步熟悉代码，然后重扩展的功能，包括将一封电子邮件发送到已更改其密码的用户。</span><span class="sxs-lookup"><span data-stu-id="90288-326">I encourage those readers interested in this functionality to become more familiar with the code and try extending the functionality to include sending an email to the user whose password was changed.</span></span>


[![A<span data-ttu-id="90288-327">n 管理员可更改用户的密码]</span><span class="sxs-lookup"><span data-stu-id="90288-327">n Administrator May Change a User's Password]</span></span>(recovering-and-changing-passwords-cs/_static/image26.png)](recovering-and-changing-passwords-cs/_static/image25.png)

<span data-ttu-id="90288-328">**图 9**:管理员可能会更改用户的密码 ([单击此项可查看原尺寸图像](recovering-and-changing-passwords-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="90288-328">**Figure 9**: An Administrator May Change a User's Password  ([Click to view full-size image](recovering-and-changing-passwords-cs/_static/image27.png))</span></span>


> [!NOTE]
> <span data-ttu-id="90288-329">`UserInformation.aspx`网页当前仅适用，如果成员资格框架配置为以清除或哈希格式存储密码。</span><span class="sxs-lookup"><span data-stu-id="90288-329">The `UserInformation.aspx` page currently only works if the Membership framework is configured to store passwords in Clear or Hashed format.</span></span> <span data-ttu-id="90288-330">尽管你受邀添加此功能，它缺少代码的新密码进行加密。</span><span class="sxs-lookup"><span data-stu-id="90288-330">It lacks the code to encrypt the new password, although you are invited to add this functionality.</span></span> <span data-ttu-id="90288-331">我建议将添加所需的代码的方法是使用如反编译程序[Reflector](http://www.aisto.com/roeder/dotnet/)来检查.NET Framework; 中的方法的源代码先检查`SqlMembershipProvider`类的`ChangePassword`方法。</span><span class="sxs-lookup"><span data-stu-id="90288-331">The way I recommend adding the necessary code is to use a decompiler like [Reflector](http://www.aisto.com/roeder/dotnet/) to examine the source code for methods in the .NET Framework; start by examining the `SqlMembershipProvider` class's `ChangePassword` method.</span></span> <span data-ttu-id="90288-332">这是密码的我用来编写用于创建哈希代码的技术。</span><span class="sxs-lookup"><span data-stu-id="90288-332">This is the technique I used to write the code for creating a hash of the password.</span></span>


## <a name="summary"></a><span data-ttu-id="90288-333">总结</span><span class="sxs-lookup"><span data-stu-id="90288-333">Summary</span></span>

<span data-ttu-id="90288-334">ASP.NET 提供了两个控件，帮助用户管理其密码。</span><span class="sxs-lookup"><span data-stu-id="90288-334">ASP.NET offers two controls to help users manage their password.</span></span> <span data-ttu-id="90288-335">PasswordRecovery 控件可用于用户忘记其密码。</span><span class="sxs-lookup"><span data-stu-id="90288-335">The PasswordRecovery control is useful for those who have forgotten their passwords.</span></span> <span data-ttu-id="90288-336">根据成员资格框架的配置，用户可以通过电子邮件用户现有的密码或随机生成的新密码。</span><span class="sxs-lookup"><span data-stu-id="90288-336">Depending on the Membership framework's configuration, the user is either emailed their existing password or a new, randomly-generated password.</span></span> <span data-ttu-id="90288-337">ChangePassword 控件使用户能够更新其密码。</span><span class="sxs-lookup"><span data-stu-id="90288-337">The ChangePassword control enables a user to update their password.</span></span>

<span data-ttu-id="90288-338">登录名和 CreateUserWizard 控件，如 PasswordRecovery 和 ChangePassword 控件呈现丰富的用户界面而无需编写一丁点声明性标记或代码行。</span><span class="sxs-lookup"><span data-stu-id="90288-338">Like the Login and CreateUserWizard controls, the PasswordRecovery and ChangePassword controls render a rich user interface without having to write a lick of declarative markup or line of code.</span></span> <span data-ttu-id="90288-339">如果默认用户界面不满足您的需要，可以自定义它通过各种样式属性。</span><span class="sxs-lookup"><span data-stu-id="90288-339">If the default user interface doesn't meet your needs, you can customize it through a variety of style properties.</span></span> <span data-ttu-id="90288-340">或者，控件的接口可能会转换为模板，为更精细的控制。</span><span class="sxs-lookup"><span data-stu-id="90288-340">Alternatively, the controls' interfaces may be converted into templates, for an even finer degree of control.</span></span> <span data-ttu-id="90288-341">这些控件使用成员资格 API，在后台调用`MembershipUser`对象的`ResetPassword`和`ChangePassword`方法。</span><span class="sxs-lookup"><span data-stu-id="90288-341">Behind the scenes these controls use the Membership API, invoking the `MembershipUser` object's `ResetPassword` and `ChangePassword` methods.</span></span>

<span data-ttu-id="90288-342">快乐编程 ！</span><span class="sxs-lookup"><span data-stu-id="90288-342">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="90288-343">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="90288-343">Further Reading</span></span>

<span data-ttu-id="90288-344">在本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="90288-344">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="90288-345">ChangePassword 控件快速入门</span><span class="sxs-lookup"><span data-stu-id="90288-345">ChangePassword Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/changepassword.aspx)
- [<span data-ttu-id="90288-346">PasswordRecovery 控件快速入门</span><span class="sxs-lookup"><span data-stu-id="90288-346">PasswordRecovery Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/passwordrecovery.aspx)
- [<span data-ttu-id="90288-347">在 ASP.NET 中发送电子邮件</span><span class="sxs-lookup"><span data-stu-id="90288-347">Sending Email in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)
- [`System.Net.Mail` <span data-ttu-id="90288-348">常见问题解答</span><span class="sxs-lookup"><span data-stu-id="90288-348">FAQs</span></span>](http://www.systemnetmail.com/)

### <a name="about-the-author"></a><span data-ttu-id="90288-349">关于作者</span><span class="sxs-lookup"><span data-stu-id="90288-349">About the Author</span></span>

<span data-ttu-id="90288-350">自 1998 年以来，Scott Mitchell，多部 asp/ASP.NET 书籍的作者及 4GuysFromRolla.com 的已从事 Microsoft Web 技术工作。</span><span class="sxs-lookup"><span data-stu-id="90288-350">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="90288-351">Scott 是独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="90288-351">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="90288-352">他最新著作是 *[Sams Teach 自己 ASP.NET 2.0 24 小时内](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*。</span><span class="sxs-lookup"><span data-stu-id="90288-352">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="90288-353">可以在达到 Scott [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com)或通过他的博客[ http://ScottOnWriting.NET ](http://scottonwriting.net/)。</span><span class="sxs-lookup"><span data-stu-id="90288-353">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="90288-354">特别感谢</span><span class="sxs-lookup"><span data-stu-id="90288-354">Special Thanks To</span></span>

<span data-ttu-id="90288-355">很多有用的审阅者已评审本系列教程。</span><span class="sxs-lookup"><span data-stu-id="90288-355">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="90288-356">本教程中的潜在顾客审阅者包括 Michael Emmings 和 Suchi Banerjee。</span><span class="sxs-lookup"><span data-stu-id="90288-356">Lead reviewers for this tutorial include Michael Emmings and Suchi Banerjee.</span></span> <span data-ttu-id="90288-357">是否有兴趣查看我即将推出的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="90288-357">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="90288-358">如果是这样，给我在行 [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="90288-358">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="90288-359">[上一页](building-an-interface-to-select-one-user-account-from-many-cs.md)
> [下一页](unlocking-and-approving-user-accounts-cs.md)</span><span class="sxs-lookup"><span data-stu-id="90288-359">[Previous](building-an-interface-to-select-one-user-account-from-many-cs.md)
[Next](unlocking-and-approving-user-accounts-cs.md)</span></span>
