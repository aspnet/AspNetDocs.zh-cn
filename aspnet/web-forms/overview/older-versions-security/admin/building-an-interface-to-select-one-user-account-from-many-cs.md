---
uid: web-forms/overview/older-versions-security/admin/building-an-interface-to-select-one-user-account-from-many-cs
title: 构建一个界面，用于从很多的 (C#) 中选择一个用户帐户 |Microsoft Docs
author: rick-anderson
description: 在本教程中我们将生成具有分页、 筛选网格的用户界面。 具体而言，我们的用户界面将包含一系列的 Linkbutton 的...
ms.author: riande
ms.date: 04/01/2008
ms.assetid: 9e4e687c-b4ec-434f-a4ef-edb0b8f365e4
msc.legacyurl: /web-forms/overview/older-versions-security/admin/building-an-interface-to-select-one-user-account-from-many-cs
msc.type: authoredcontent
ms.openlocfilehash: ede2bf737464fde47e304e23255349599c1ea663
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/06/2019
ms.locfileid: "65116289"
---
# <a name="building-an-interface-to-select-one-user-account-from-many-c"></a><span data-ttu-id="a5f6d-104">生成用于从多个用户帐户中选择一个帐户的界面 (C#)</span><span class="sxs-lookup"><span data-stu-id="a5f6d-104">Building an Interface to Select One User Account from Many (C#)</span></span>

<span data-ttu-id="a5f6d-105">通过[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="a5f6d-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="a5f6d-106">[下载代码](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.12.zip)或[下载 PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial12_SelectUser_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="a5f6d-106">[Download Code](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/CS.12.zip) or [Download PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial12_SelectUser_cs.pdf)</span></span>

> <span data-ttu-id="a5f6d-107">在本教程中我们将生成具有分页、 筛选网格的用户界面。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-107">In this tutorial we will build a user interface with a paged, filterable grid.</span></span> <span data-ttu-id="a5f6d-108">具体而言，我们的用户界面将包含的一系列的 Linkbutton 筛选基于用户名和 GridView 控件以显示匹配的用户的起始字母对结果。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-108">In particular, our user interface will consist of a series of LinkButtons for filtering the results based on the starting letter of the username, and a GridView control to show the matching users.</span></span> <span data-ttu-id="a5f6d-109">我们将开始通过列出所有 GridView 中的用户帐户。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-109">We'll start by listing all of the user accounts in a GridView.</span></span> <span data-ttu-id="a5f6d-110">然后，在步骤 3 中，我们将添加筛选器 Linkbutton。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-110">Then, in Step 3, we will add the filter LinkButtons.</span></span> <span data-ttu-id="a5f6d-111">步骤 4 来看待分页筛选的结果。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-111">Step 4 looks at paging the filtered results.</span></span> <span data-ttu-id="a5f6d-112">构造在步骤 2 到 4 的接口将在后续教程中，用于为特定用户帐户执行管理任务。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-112">The interface constructed in Steps 2 through 4 will be used in the subsequent tutorials to perform administrative tasks for a particular user account.</span></span>

## <a name="introduction"></a><span data-ttu-id="a5f6d-113">介绍</span><span class="sxs-lookup"><span data-stu-id="a5f6d-113">Introduction</span></span>

<span data-ttu-id="a5f6d-114">在中<a id="_msoanchor_1"> </a> [*向用户分配角色*](../roles/assigning-roles-to-users-cs.md)教程中，我们创建的管理员可以选择用户和管理其角色的基本接口。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-114">In the <a id="_msoanchor_1"></a>[*Assigning Roles to Users*](../roles/assigning-roles-to-users-cs.md) tutorial, we created a rudimentary interface for an administrator to select a user and manage her roles.</span></span> <span data-ttu-id="a5f6d-115">具体而言，该接口显示下拉列表的所有用户的管理员。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-115">Specifically, the interface presented the administrator with a drop-down list of all of the users.</span></span> <span data-ttu-id="a5f6d-116">此类接口适合，在存在但十几用户帐户，但难以处理针对包含数百或数千个帐户的网站。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-116">Such an interface is suitable when there are but a dozen or so user accounts, but is unwieldy for sites with hundreds or thousands of accounts.</span></span> <span data-ttu-id="a5f6d-117">分页、 筛选网格是具有大型用户群的网站的更适合用户界面。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-117">A paged, filterable grid is more suitable user interface for websites with large user bases.</span></span>

<span data-ttu-id="a5f6d-118">在本教程中我们将生成此类的用户界面。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-118">In this tutorial we will build such a user interface.</span></span> <span data-ttu-id="a5f6d-119">具体而言，我们的用户界面将包含的一系列的 Linkbutton 筛选基于用户名和 GridView 控件以显示匹配的用户的起始字母对结果。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-119">In particular, our user interface will consist of a series of LinkButtons for filtering the results based on the starting letter of the username, and a GridView control to show the matching users.</span></span> <span data-ttu-id="a5f6d-120">我们将开始通过列出所有 GridView 中的用户帐户。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-120">We'll start by listing all of the user accounts in a GridView.</span></span> <span data-ttu-id="a5f6d-121">然后，在步骤 3 中，我们将添加筛选器 Linkbutton。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-121">Then, in Step 3, we will add the filter LinkButtons.</span></span> <span data-ttu-id="a5f6d-122">步骤 4 来看待分页筛选的结果。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-122">Step 4 looks at paging the filtered results.</span></span> <span data-ttu-id="a5f6d-123">构造在步骤 2 到 4 的接口将在后续教程中，用于为特定用户帐户执行管理任务。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-123">The interface constructed in Steps 2 through 4 will be used in the subsequent tutorials to perform administrative tasks for a particular user account.</span></span>

<span data-ttu-id="a5f6d-124">让我们进入正题！</span><span class="sxs-lookup"><span data-stu-id="a5f6d-124">Let's get started!</span></span>

## <a name="step-1-adding-new-aspnet-pages"></a><span data-ttu-id="a5f6d-125">步骤 1：添加新的 ASP.NET 页面</span><span class="sxs-lookup"><span data-stu-id="a5f6d-125">Step 1: Adding New ASP.NET Pages</span></span>

<span data-ttu-id="a5f6d-126">我们将在本教程并下一步的两个检查各种与管理相关的函数和功能。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-126">In this tutorial and the next two we will be examining various administration-related functions and capabilities.</span></span> <span data-ttu-id="a5f6d-127">我们将需要一系列的 ASP.NET 页面实现检查在这些教程中的主题。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-127">We will need a series of ASP.NET pages to implement the topics examined throughout these tutorials.</span></span> <span data-ttu-id="a5f6d-128">让我们来创建这些页面和更新的站点映射。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-128">Let's create these pages and update the site map.</span></span>

<span data-ttu-id="a5f6d-129">首先，创建一个新的文件夹在项目中名为`Administration`。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-129">Start by creating a new folder in the project named `Administration`.</span></span> <span data-ttu-id="a5f6d-130">接下来，将两个新的 ASP.NET 页面添加到的文件夹中，链接与每个页面`Site.master`母版页。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-130">Next, add two new ASP.NET pages to the folder, linking each page with the `Site.master` master page.</span></span> <span data-ttu-id="a5f6d-131">命名页：</span><span class="sxs-lookup"><span data-stu-id="a5f6d-131">Name the pages:</span></span>

- `ManageUsers.aspx`
- `UserInformation.aspx`

<span data-ttu-id="a5f6d-132">此外将两个页面添加到网站的根目录：`ChangePassword.aspx`和`RecoverPassword.aspx`。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-132">Also add two pages to the website's root directory: `ChangePassword.aspx` and `RecoverPassword.aspx`.</span></span>

<span data-ttu-id="a5f6d-133">这四个页面，此时，应有两个内容控件，另一个用于每个母版页的 Contentplaceholder:`MainContent`和`LoginContent`。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-133">These four pages should, at this point, have two Content controls, one for each of the master page's ContentPlaceHolders: `MainContent` and `LoginContent`.</span></span>

[!code-aspx[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample1.aspx)]

<span data-ttu-id="a5f6d-134">我们想要显示的主页面的默认标记`LoginContent`ContentPlaceHolder 为这些页面。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-134">We want to show the master page's default markup for the `LoginContent` ContentPlaceHolder for these pages.</span></span> <span data-ttu-id="a5f6d-135">因此，删除的声明性标记`Content2`内容控件。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-135">Therefore, remove the declarative markup for the `Content2` Content control.</span></span> <span data-ttu-id="a5f6d-136">这样做之后，页的标记应只包含一个内容控件。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-136">After doing so, the pages' markup should contain just one Content control.</span></span>

<span data-ttu-id="a5f6d-137">ASP.NET 页`Administration`文件夹仅供管理用户。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-137">The ASP.NET pages in the `Administration` folder are intended solely for administrative users.</span></span> <span data-ttu-id="a5f6d-138">我们添加到中的系统管理员角色<a id="_msoanchor_2"> </a> [*创建和管理角色*](../roles/creating-and-managing-roles-cs.md)教程; 限制对这两页向此角色的访问。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-138">We added an Administrators role to the system in the <a id="_msoanchor_2"></a>[*Creating and Managing Roles*](../roles/creating-and-managing-roles-cs.md) tutorial; restrict access to these two pages to this role.</span></span> <span data-ttu-id="a5f6d-139">若要完成此操作，添加`Web.config`的文件`Administration`文件夹并配置其`<authorization>`承认管理员角色中的用户，拒绝所有其他元素。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-139">To accomplish this, add a `Web.config` file to the `Administration` folder and configure its `<authorization>` element to admit users in the Administrators role and to deny all others.</span></span>

[!code-xml[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample2.xml)]

<span data-ttu-id="a5f6d-140">此时您的项目的解决方案资源管理器应类似于屏幕截图中图 1 所示。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-140">At this point your project's Solution Explorer should look similar to the screen shot shown in Figure 1.</span></span>

<span data-ttu-id="a5f6d-141">[![四个新的网页和 Web.config 文件已添加到网站](building-an-interface-to-select-one-user-account-from-many-cs/_static/image2.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="a5f6d-141">[![Four New Pages and a Web.config File Have Been Added to the Website](building-an-interface-to-select-one-user-account-from-many-cs/_static/image2.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image1.png)</span></span>

<span data-ttu-id="a5f6d-142">**图 1**:四个新页面和一个`Web.config`文件已添加到网站 ([单击以查看实际尺寸的图像](building-an-interface-to-select-one-user-account-from-many-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="a5f6d-142">**Figure 1**: Four New Pages and a `Web.config` File Have Been Added to the Website  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image3.png))</span></span>

<span data-ttu-id="a5f6d-143">最后，更新站点图 (`Web.sitemap`) 包含在进入`ManageUsers.aspx`页。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-143">Finally, update the site map (`Web.sitemap`) to include an entry to the `ManageUsers.aspx` page.</span></span> <span data-ttu-id="a5f6d-144">添加以下 XML 之后`<siteMapNode>`我们添加了有关角色的教程。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-144">Add the following XML after the `<siteMapNode>` we added for the Roles tutorials.</span></span>

[!code-xml[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample3.xml)]

<span data-ttu-id="a5f6d-145">使用更新的站点映射，请访问通过浏览器的站点。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-145">With the site map updated, visit the site through a browser.</span></span> <span data-ttu-id="a5f6d-146">如图 2 所示，在左侧的导航窗格现在为管理教程包括项。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-146">As Figure 2 shows, the navigation on the left now includes items for the Administration tutorials.</span></span>

<span data-ttu-id="a5f6d-147">[![站点图包括一个标题为用户管理的节点](building-an-interface-to-select-one-user-account-from-many-cs/_static/image5.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="a5f6d-147">[![The Site Map Includes a Node Titled User Administration](building-an-interface-to-select-one-user-account-from-many-cs/_static/image5.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image4.png)</span></span>

<span data-ttu-id="a5f6d-148">**图 2**:站点图包括节点标题为的用户管理 ([单击此项可查看原尺寸图像](building-an-interface-to-select-one-user-account-from-many-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="a5f6d-148">**Figure 2**: The Site Map Includes a Node Titled User Administration  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image6.png))</span></span>

## <a name="step-2-listing-all-user-accounts-in-a-gridview"></a><span data-ttu-id="a5f6d-149">步骤 2：列出在 GridView 中的所有用户帐户</span><span class="sxs-lookup"><span data-stu-id="a5f6d-149">Step 2: Listing All User Accounts in a GridView</span></span>

<span data-ttu-id="a5f6d-150">本教程中我们最终目标是创建一个分页、 筛选网格，通过该管理员可以选择要管理的用户帐户。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-150">Our end goal for this tutorial is to create a paged, filterable grid through which an administrator can select a user account to manage.</span></span> <span data-ttu-id="a5f6d-151">让我们首先列出*所有*GridView 中的用户。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-151">Let's start by listing *all* users in a GridView.</span></span> <span data-ttu-id="a5f6d-152">完成此操作，我们将添加筛选和分页界面和功能。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-152">Once this is complete, we will add the filtering and paging interfaces and functionality.</span></span>

<span data-ttu-id="a5f6d-153">打开`ManageUsers.aspx`页中`Administration`文件夹并添加一个 GridView，设置其`ID`到`UserAccounts`。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-153">Open the `ManageUsers.aspx` page in the `Administration` folder and add a GridView, setting its `ID` to `UserAccounts`.</span></span> <span data-ttu-id="a5f6d-154">稍后，我们将编写代码以将用户帐户的组绑定到 GridView 使用`Membership`类的`GetAllUsers`方法。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-154">In a moment, we will write code to bind the set of user accounts to the GridView using the `Membership` class's `GetAllUsers` method.</span></span> <span data-ttu-id="a5f6d-155">当之前的教程中所述，GetAllUsers 方法返回`MembershipUserCollection`对象，它是集合的`MembershipUser`对象。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-155">As discussed in earlier tutorials, the GetAllUsers method returns a `MembershipUserCollection` object, which is a collection of `MembershipUser` objects.</span></span> <span data-ttu-id="a5f6d-156">每个`MembershipUser`集合中包含属性，如`UserName`， `Email`， `IsApproved`，依次类推。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-156">Each `MembershipUser` in the collection includes properties like `UserName`, `Email`, `IsApproved`, and so on.</span></span>

<span data-ttu-id="a5f6d-157">为了 GridView 中显示所需的用户帐户信息，请设置 GridView`AutoGenerateColumns`属性设置为 False，并添加有关 BoundFields `UserName`， `Email`，和`Comment`属性和为 CheckBoxFields `IsApproved`，`IsLockedOut`，和`IsOnline`属性。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-157">In order to display the desired user account information in the GridView, set the GridView's `AutoGenerateColumns` property to False and add BoundFields for the `UserName`, `Email`, and `Comment` properties and CheckBoxFields for the `IsApproved`, `IsLockedOut`, and `IsOnline` properties.</span></span> <span data-ttu-id="a5f6d-158">通过该控件声明性标记或字段对话框中，可以应用此配置。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-158">This configuration can be applied through the control's declarative markup or via the Fields dialog box.</span></span> <span data-ttu-id="a5f6d-159">图 3 显示的屏幕截图的字段对话框的自动生成字段复选框已取消选中并添加并配置 BoundFields 和 CheckBoxFields 后。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-159">Figure 3 shows a screen shot of the Fields dialog box after the Auto-generate fields checkbox has been unchecked and the BoundFields and CheckBoxFields have been added and configured.</span></span>

<span data-ttu-id="a5f6d-160">[![将三个 BoundFields 和三个 CheckBoxFields 添加到 GridView](building-an-interface-to-select-one-user-account-from-many-cs/_static/image8.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="a5f6d-160">[![Add Three BoundFields and Three CheckBoxFields to the GridView](building-an-interface-to-select-one-user-account-from-many-cs/_static/image8.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image7.png)</span></span>

<span data-ttu-id="a5f6d-161">**图 3**:将三个 BoundFields 和三个 CheckBoxFields 添加到 GridView ([单击此项可查看原尺寸图像](building-an-interface-to-select-one-user-account-from-many-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="a5f6d-161">**Figure 3**: Add Three BoundFields and Three CheckBoxFields to the GridView  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image9.png))</span></span>

<span data-ttu-id="a5f6d-162">在配置后你 GridView，请确保其声明性标记类似于以下：</span><span class="sxs-lookup"><span data-stu-id="a5f6d-162">After configuring your GridView, ensure that its declarative markup resembles the following:</span></span>

[!code-aspx[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample4.aspx)]

<span data-ttu-id="a5f6d-163">接下来，我们需要编写代码，将用户帐户绑定到 GridView。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-163">Next, we need to write code that binds the user accounts to the GridView.</span></span> <span data-ttu-id="a5f6d-164">创建一个名为方法`BindUserAccounts`若要执行此任务，然后调用它从`Page_Load`上第一次的页面访问事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-164">Create a method named `BindUserAccounts` to perform this task and then call it from the `Page_Load` event handler on the first page visit.</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample5.cs)]

<span data-ttu-id="a5f6d-165">请花费片刻时间来测试通过浏览器页面。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-165">Take a moment to test the page through a browser.</span></span> <span data-ttu-id="a5f6d-166">如图 4 所示， `UserAccounts` GridView 用户名、 电子邮件地址和所有用户的其他相关帐户信息列出了系统中。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-166">As Figure 4 shows, the `UserAccounts` GridView lists the username, email address, and other pertinent account information for all users in the system.</span></span>

<span data-ttu-id="a5f6d-167">[![用户帐户已列出 GridView 中](building-an-interface-to-select-one-user-account-from-many-cs/_static/image11.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="a5f6d-167">[![The User Accounts are Listed in the GridView](building-an-interface-to-select-one-user-account-from-many-cs/_static/image11.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image10.png)</span></span>

<span data-ttu-id="a5f6d-168">**图 4**:用户帐户已列出 GridView 中 ([单击此项可查看原尺寸图像](building-an-interface-to-select-one-user-account-from-many-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="a5f6d-168">**Figure 4**: The User Accounts are Listed in the GridView  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image12.png))</span></span>

## <a name="step-3-filtering-the-results-by-the-first-letter-of-the-username"></a><span data-ttu-id="a5f6d-169">步骤 3：筛选结果的第一个字母的用户名</span><span class="sxs-lookup"><span data-stu-id="a5f6d-169">Step 3: Filtering the Results by the First Letter of the Username</span></span>

<span data-ttu-id="a5f6d-170">目前`UserAccounts`GridView 显示*所有*的用户帐户。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-170">Currently the `UserAccounts` GridView shows *all* of the user accounts.</span></span> <span data-ttu-id="a5f6d-171">对于包含数百或数千个用户帐户的网站，因此务必该用户能够迅速缩小显示的帐户。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-171">For websites with hundreds or thousands of user accounts, it is imperative that user be able to quickly pare down the displayed accounts.</span></span> <span data-ttu-id="a5f6d-172">这可以通过添加到页筛选 Linkbutton。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-172">This can be accomplished by adding filtering LinkButtons to the page.</span></span> <span data-ttu-id="a5f6d-173">让我们向页面添加 27 Linkbutton： 一个标题为所有以及一个 LinkButton 的字母表中的每个字母。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-173">Let's add 27 LinkButtons to the page: one titled All along with one LinkButton for each letter of the alphabet.</span></span> <span data-ttu-id="a5f6d-174">如果访问者单击所有 LinkButton，GridView 将显示的所有用户。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-174">If a visitor clicks the All LinkButton, the GridView will show all of the users.</span></span> <span data-ttu-id="a5f6d-175">如果他们单击特定字母时，将显示只有其用户名以所选的字母开头的用户。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-175">If they click a particular letter, only those users whose username starts with the selected letter will be displayed.</span></span>

<span data-ttu-id="a5f6d-176">我们的第一个任务是添加 27 LinkButton 控件。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-176">Our first task is to add the 27 LinkButton controls.</span></span> <span data-ttu-id="a5f6d-177">一种方法就是以声明方式，创建的 27 Linkbutton 一次一个。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-177">One option would be to create the 27 LinkButtons declaratively, one at a time.</span></span> <span data-ttu-id="a5f6d-178">更灵活的方法是使用具有的 Repeater 控件`ItemTemplate`，它呈现 LinkButton 并且然后将筛选选项绑定到作为 Repeater`string`数组。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-178">A more flexible approach is to use a Repeater control with an `ItemTemplate` that renders a LinkButton and then binds the filtering options to the Repeater as a `string` array.</span></span>

<span data-ttu-id="a5f6d-179">通过将 Repeater 控件添加到上述页面开始`UserAccounts`GridView。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-179">Start by adding a Repeater control to the page above the `UserAccounts` GridView.</span></span> <span data-ttu-id="a5f6d-180">设置 Repeater`ID`属性设置为`FilteringUI`。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-180">Set the Repeater's `ID` property to `FilteringUI`.</span></span> <span data-ttu-id="a5f6d-181">配置转发器的模板，以便其`ItemTemplate`呈现 LinkButton 其`Text`和`CommandName`属性绑定到当前数组元素。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-181">Configure the Repeater's templates so that its `ItemTemplate` renders a LinkButton whose `Text` and `CommandName` properties are bound to the current array element.</span></span> <span data-ttu-id="a5f6d-182">中可以看到<a id="_msoanchor_3"> </a> [*向用户分配角色*](../roles/assigning-roles-to-users-cs.md)教程中，可以使用完成这`Container.DataItem`数据绑定语法。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-182">As we saw in the <a id="_msoanchor_3"></a>[*Assigning Roles to Users*](../roles/assigning-roles-to-users-cs.md) tutorial, this can be accomplished using the `Container.DataItem` databinding syntax.</span></span> <span data-ttu-id="a5f6d-183">使用 Repeater 的`SeparatorTemplate`以显示每个链接之间的竖直线。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-183">Use the Repeater's `SeparatorTemplate` to display a vertical line between each link.</span></span>

[!code-aspx[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample6.aspx)]

<span data-ttu-id="a5f6d-184">若要填充此 Repeater 具有所需的筛选选项，创建一个名为方法`BindFilteringUI`。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-184">To populate this Repeater with the desired filtering options, create a method named `BindFilteringUI`.</span></span> <span data-ttu-id="a5f6d-185">请务必调用此方法从`Page_Load`上第一次的页面加载事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-185">Be sure to call this method from the `Page_Load` event handler on the first page load.</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample7.cs)]

<span data-ttu-id="a5f6d-186">此方法为中的元素指定的筛选选项`string`数组`filterOptions`。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-186">This method specifies the filtering options as elements in the `string` array `filterOptions`.</span></span> <span data-ttu-id="a5f6d-187">Repeater 将以使用 LinkButton 呈现对于数组中每个元素，其`Text`和`CommandName`属性分配给数组元素的值。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-187">For each element in the array, the Repeater will render a LinkButton with its `Text` and `CommandName` properties assigned to the value of the array element.</span></span>

<span data-ttu-id="a5f6d-188">图 5 显示了`ManageUsers.aspx`页面的浏览器查看时。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-188">Figure 5 shows the `ManageUsers.aspx` page when viewed through a browser.</span></span>

<span data-ttu-id="a5f6d-189">[![Repeater 列出了 27 筛选 Linkbutton](building-an-interface-to-select-one-user-account-from-many-cs/_static/image14.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="a5f6d-189">[![The Repeater Lists 27 Filtering LinkButtons](building-an-interface-to-select-one-user-account-from-many-cs/_static/image14.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image13.png)</span></span>

<span data-ttu-id="a5f6d-190">**图 5**:Repeater 列出了 27 筛选 Linkbutton ([单击此项可查看原尺寸图像](building-an-interface-to-select-one-user-account-from-many-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="a5f6d-190">**Figure 5**: The Repeater Lists 27 Filtering LinkButtons  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image15.png))</span></span>

> [!NOTE]
> <span data-ttu-id="a5f6d-191">用户名可能开始任何字符，包括数字和标点符号。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-191">Usernames may start with any character, including numbers and punctuation.</span></span> <span data-ttu-id="a5f6d-192">若要查看这些帐户，管理员将需要使用所有 LinkButton 选项。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-192">In order to view these accounts, the administrator will have to use the All LinkButton option.</span></span> <span data-ttu-id="a5f6d-193">或者，可以添加 LinkButton 返回以数字开头的所有用户帐户。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-193">Alternatively, you could add a LinkButton to return all user accounts that start with a number.</span></span> <span data-ttu-id="a5f6d-194">我将此当作练习留给读者。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-194">I leave this as an exercise for the reader.</span></span>

<span data-ttu-id="a5f6d-195">单击任意筛选 Linkbutton 导致回发并引发 Repeater 的`ItemCommand`事件，但有在网格中的任何更改，因为我们尚未为编写任何代码来筛选结果。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-195">Clicking any of the filtering LinkButtons causes a postback and raises the Repeater's `ItemCommand` event, but there's no change in the grid because we've yet to write any code to filter the results.</span></span> <span data-ttu-id="a5f6d-196">`Membership`类包括[`FindUsersByName`方法](https://technet.microsoft.com/library/system.web.security.membership.findusersbyname.aspx)返回其用户名与指定的搜索模式匹配这些用户帐户。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-196">The `Membership` class includes a [`FindUsersByName` method](https://technet.microsoft.com/library/system.web.security.membership.findusersbyname.aspx) that returns those user accounts whose username matches a specified search pattern.</span></span> <span data-ttu-id="a5f6d-197">我们可以使用此方法以检索其用户名与指定的字母开头的那些用户帐户`CommandName`筛选 LinkButton 被单击。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-197">We can use this method to retrieve just those user accounts whose usernames start with the letter specified by the `CommandName` of the filtered LinkButton that was clicked.</span></span>

<span data-ttu-id="a5f6d-198">通过更新开始`ManageUser.aspx`页面的代码隐藏类以使其包括一个名为属性`UsernameToMatch`。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-198">Start by updating the `ManageUser.aspx` page's code-behind class so that it includes a property named `UsernameToMatch`.</span></span> <span data-ttu-id="a5f6d-199">此属性在回发之间保持用户名筛选器字符串：</span><span class="sxs-lookup"><span data-stu-id="a5f6d-199">This property persists the username filter string across postbacks:</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample8.cs)]

<span data-ttu-id="a5f6d-200">`UsernameToMatch`属性将其分配到其值存储`ViewState`使用 UsernameToMatch 的键的集合。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-200">The `UsernameToMatch` property stores its value it is assigned into the `ViewState` collection using the key UsernameToMatch.</span></span> <span data-ttu-id="a5f6d-201">当读取此属性的值时，它会检查以查看是否存在某个值在`ViewState`集合; 如果不正确，则返回默认值为空字符串。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-201">When this property's value is read, it checks to see if a value exists in the `ViewState` collection; if not, it returns the default value, an empty string.</span></span> <span data-ttu-id="a5f6d-202">`UsernameToMatch`属性表现出一种常见模式，即持久保存一个值，以查看状态，以便在回发之间保留对该属性的任何更改。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-202">The `UsernameToMatch` property exhibits a common pattern, namely persisting a value to view state so that any changes to the property are persisted across postbacks.</span></span> <span data-ttu-id="a5f6d-203">此模式的详细信息，请阅读[Understanding ASP.NET View State](https://msdn.microsoft.com/library/ms972976.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-203">For more information on this pattern, read [Understanding ASP.NET View State](https://msdn.microsoft.com/library/ms972976.aspx).</span></span>

<span data-ttu-id="a5f6d-204">接下来，更新`BindUserAccounts`方法的调用以代替`Membership.GetAllUsers`，它将调用`Membership.FindUsersByName`，并传递的值中`UsernameToMatch`追加 SQL 通配符字符开头的属性 %。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-204">Next, update the `BindUserAccounts` method so that instead of calling `Membership.GetAllUsers`, it calls `Membership.FindUsersByName`, passing in the value of the `UsernameToMatch` property appended with the SQL wildcard character, %.</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample9.cs)]

<span data-ttu-id="a5f6d-205">若要显示其用户名以字母 A 开头的那些用户，请设置`UsernameToMatch`属性设置为一个，然后调用`BindUserAccounts`。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-205">To display just those users whose username starts with the letter A, set the `UsernameToMatch` property to A and then call `BindUserAccounts`.</span></span> <span data-ttu-id="a5f6d-206">这将导致调用`Membership.FindUsersByName("A%")`，这将返回所有用户的用户名与 A.同样，若要都返回启动*所有*用户，将分配到一个空字符串`UsernameToMatch`属性，以便`BindUserAccounts`方法将调用`Membership.FindUsersByName("%")`，从而返回所有用户帐户。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-206">This would result in a call to `Membership.FindUsersByName("A%")`, which will return all users whose username starts with A. Likewise, to return *all* users, assign an empty string to the `UsernameToMatch` property so that the `BindUserAccounts` method will invoke `Membership.FindUsersByName("%")`, thereby returning all user accounts.</span></span>

<span data-ttu-id="a5f6d-207">为 Repeater 的创建事件处理程序`ItemCommand`事件。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-207">Create an event handler for the Repeater's `ItemCommand` event.</span></span> <span data-ttu-id="a5f6d-208">单击某一筛选器 Linkbutton 时; 时将引发此事件它传递已单击的 LinkButton`CommandName`通过值`RepeaterCommandEventArgs`对象。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-208">This event is raised whenever one of the filter LinkButtons is clicked; it is passed the clicked LinkButton's `CommandName` value through the `RepeaterCommandEventArgs` object.</span></span> <span data-ttu-id="a5f6d-209">我们需要将相应的值赋给`UsernameToMatch`属性，然后调用`BindUserAccounts`方法。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-209">We need to assign the appropriate value to the `UsernameToMatch` property and then call the `BindUserAccounts` method.</span></span> <span data-ttu-id="a5f6d-210">如果`CommandName`为 All，将分配到一个空字符串`UsernameToMatch`，以便显示所有用户帐户。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-210">If the `CommandName` is All, assign an empty string to `UsernameToMatch` so that all user accounts are displayed.</span></span> <span data-ttu-id="a5f6d-211">否则，将分配`CommandName`值设为`UsernameToMatch`。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-211">Otherwise, assign the `CommandName` value to `UsernameToMatch`.</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample10.cs)]

<span data-ttu-id="a5f6d-212">利用此代码，测试筛选功能。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-212">With this code in place, test out the filtering functionality.</span></span> <span data-ttu-id="a5f6d-213">当首次访问页面时，显示所有用户帐户 （回头查看图 5）。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-213">When the page is first visited, all user accounts are displayed (refer back to Figure 5).</span></span> <span data-ttu-id="a5f6d-214">单击 LinkButton 导致回发，并筛选结果，显示以 A 开头这些用户帐户。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-214">Clicking the A LinkButton causes a postback and filters the results, displaying only those user accounts that start with A .</span></span>

<span data-ttu-id="a5f6d-215">[![使用筛选的 Linkbutton 来显示其用户名以某些字母开头的用户](building-an-interface-to-select-one-user-account-from-many-cs/_static/image17.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="a5f6d-215">[![Use the Filtering LinkButtons to Display those Users Whose Username Starts with a Certain Letter](building-an-interface-to-select-one-user-account-from-many-cs/_static/image17.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image16.png)</span></span>

<span data-ttu-id="a5f6d-216">**图 6**:使用筛选 Linkbutton 来显示这些用户其用户名以特定字母开头 ([单击此项可查看原尺寸图像](building-an-interface-to-select-one-user-account-from-many-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="a5f6d-216">**Figure 6**: Use the Filtering LinkButtons to Display those Users Whose Username Starts with a Certain Letter  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image18.png))</span></span>

## <a name="step-4-updating-the-gridview-to-use-paging"></a><span data-ttu-id="a5f6d-217">步骤 4：正在更新 GridView，其中使用的分页</span><span class="sxs-lookup"><span data-stu-id="a5f6d-217">Step 4: Updating the GridView to Use Paging</span></span>

<span data-ttu-id="a5f6d-218">图 5 和 6 中所示 GridView 列出了从返回的记录的所有`FindUsersByName`方法。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-218">The GridView shown in Figures 5 and 6 lists all of the records returned from the `FindUsersByName` method.</span></span> <span data-ttu-id="a5f6d-219">如果有数百或数千个用户帐户这可以查看的所有帐户 （如单击所有 LinkButton 时或当最初访问页面时都是如此） 时导致信息过载。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-219">If there are hundreds or thousands of user accounts this can lead to information overload when viewing all of the accounts (as is the case when clicking the All LinkButton or when initially visiting the page).</span></span> <span data-ttu-id="a5f6d-220">为了帮助更易于管理的块中存在的用户帐户，让我们配置 GridView，其中每次显示 10 个用户帐户。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-220">To help present the user accounts in more manageable chunks, let's configure the GridView to display 10 user accounts at a time.</span></span>

<span data-ttu-id="a5f6d-221">GridView 控件提供了两种类型的分页：</span><span class="sxs-lookup"><span data-stu-id="a5f6d-221">The GridView control offers two types of paging:</span></span>

- <span data-ttu-id="a5f6d-222">**默认分页**-容易实现，但效率低下。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-222">**Default paging** - easy to implement, but inefficient.</span></span> <span data-ttu-id="a5f6d-223">简单地说，默认值分页 GridView 期望*所有*从其数据源的记录。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-223">In a nutshell, with default paging the GridView expects *all* of the records from its data source.</span></span> <span data-ttu-id="a5f6d-224">然后仅显示记录的相应页。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-224">It then only displays the appropriate page of records.</span></span>
- <span data-ttu-id="a5f6d-225">**自定义分页**-需要更多工作来实现，但比默认分页因为使用自定义分页数据源返回只精确的可显示的记录集更高效。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-225">**Custom paging** - requires more work to implement, but is more efficient than default paging because with custom paging the data source returns only the precise set of records to display.</span></span>

<span data-ttu-id="a5f6d-226">分页浏览几千条记录时，可以极大地默认和自定义分页的性能差异。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-226">The performance difference between default and custom paging can be quite substantial when paging through thousands of records.</span></span> <span data-ttu-id="a5f6d-227">由于我们要构建假定此接口可能是数百或数千个用户帐户，让我们使用自定义分页。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-227">Because we are building this interface assuming that there may be hundreds or thousands of user accounts, let's use custom paging.</span></span>

> [!NOTE]
> <span data-ttu-id="a5f6d-228">有关默认和自定义分页，以及实现自定义分页所面临的挑战之间的区别的更深入讨论，请参阅[有效地分页通过大容量数据的](https://asp.net/learn/data-access/tutorial-25-cs.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-228">For a more thorough discussion on the differences between default and custom paging, as well as the challenges involved in implementing custom paging, refer to [Efficiently Paging Through Large Amounts of Data](https://asp.net/learn/data-access/tutorial-25-cs.aspx).</span></span> <span data-ttu-id="a5f6d-229">默认和自定义分页的性能差异一些分析，请参阅[结合使用 ASP.NET 和 SQL Server 2005 中的自定义分页](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-229">For some analysis of the performance difference between default and custom paging, see [Custom Paging in ASP.NET with SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx).</span></span>

<span data-ttu-id="a5f6d-230">若要实现自定义分页我们首先需要某些机制，通过其检索 GridView 显示的记录的精确的子集。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-230">To implement custom paging we first need some mechanism by which to retrieve the precise subset of records being displayed by the GridView.</span></span> <span data-ttu-id="a5f6d-231">值得高兴的是`Membership`类的`FindUsersByName`方法具有重载方法，可用于指定的页索引和页大小，并返回在记录该范围内这些用户帐户。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-231">The good news is that the `Membership` class's `FindUsersByName` method has an overload that allows us to specify the page index and page size, and returns only those user accounts that fall within that range of records.</span></span>

<span data-ttu-id="a5f6d-232">具体而言，此重载具有以下签名： [ `FindUsersByName(usernameToMatch, pageIndex, pageSize, totalRecords)` ](https://msdn.microsoft.com/library/fa5st8b2.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-232">In particular, this overload has the following signature: [`FindUsersByName(usernameToMatch, pageIndex, pageSize, totalRecords)`](https://msdn.microsoft.com/library/fa5st8b2.aspx).</span></span>

<span data-ttu-id="a5f6d-233">*PageIndex*参数指定要返回; 用户帐户的页*pageSize*指示每页显示的记录数。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-233">The *pageIndex* parameter specifies the page of user accounts to return; *pageSize* indicates how many records to display per page.</span></span> <span data-ttu-id="a5f6d-234">*Totalrecords 信息*参数是`out`参数，它在用户存储区返回的总用户帐户数。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-234">The *totalRecords* parameter is an `out` parameter that returns the number of total user accounts in the user store.</span></span>

> [!NOTE]
> <span data-ttu-id="a5f6d-235">返回的数据`FindUsersByName`按 username; 不能自定义排序条件。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-235">The data returned by `FindUsersByName` is sorted by username; the sort criteria cannot be customized.</span></span>

<span data-ttu-id="a5f6d-236">GridView 可以配置为使用自定义分页，但仅当绑定到对象数据源控件。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-236">The GridView can be configured to utilize custom paging, but only when bound to an ObjectDataSource control.</span></span> <span data-ttu-id="a5f6d-237">要实现自定义分页的 ObjectDataSource 控件，它需要两个方法： 一个传递给起始行索引和记录，若要显示，最大数目，并返回该范围内; 内的记录的精确子集和通过分页所返回的记录总数的方法。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-237">For the ObjectDataSource control to implement custom paging, it requires two methods: one that is passed a start row index and the maximum number of records to display, and returns the precise subset of records that fall within that span; and a method that returns the total number of records being paged through.</span></span> <span data-ttu-id="a5f6d-238">`FindUsersByName`重载接受的页索引和页面大小，并返回通过记录总数`out`参数。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-238">The `FindUsersByName` overload accepts a page index and page size, and returns the total number of records through an `out` parameter.</span></span> <span data-ttu-id="a5f6d-239">因此，此处接口不匹配。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-239">So there is an interface mismatch here.</span></span>

<span data-ttu-id="a5f6d-240">一种方法就是创建代理类公开的接口 ObjectDataSource 期望，并在内部调用`FindUsersByName`方法。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-240">One option would be to create a proxy class that exposes the interface the ObjectDataSource expects, and then internally calls the `FindUsersByName` method.</span></span> <span data-ttu-id="a5f6d-241">另一种方法-，另一个我们将对此项目使用的是创建我们自己分页接口，并使用，而不是 GridView 的内置分页界面。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-241">Another option - and the one we'll use for this article - is to create our own paging interface and use that instead of the GridView's built-in paging interface.</span></span>

### <a name="creating-a-first-previous-next-last-paging-interface"></a><span data-ttu-id="a5f6d-242">创建第一个上, 一条、 下一步，最后一个分页界面</span><span class="sxs-lookup"><span data-stu-id="a5f6d-242">Creating a First, Previous, Next, Last Paging Interface</span></span>

<span data-ttu-id="a5f6d-243">让我们构建第一个、 上一步、 下一步，与最后一个 Linkbutton 分页界面。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-243">Let's build a paging interface with First, Previous, Next, and Last LinkButtons.</span></span> <span data-ttu-id="a5f6d-244">第一个 LinkButton，单击时，将用户转到第一页数据，而上一步将返回与他联系到前一页。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-244">The First LinkButton, when clicked, will take the user to the first page of data, whereas Previous will return him to the previous page.</span></span> <span data-ttu-id="a5f6d-245">同样地下, 一步和上一次将用户移到下一步和最后一页中，分别。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-245">Likewise, Next and Last will move the user to the next and last page, respectively.</span></span> <span data-ttu-id="a5f6d-246">添加下面的四个 LinkButton 控件`UserAccounts`GridView。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-246">Add the four LinkButton controls beneath the `UserAccounts` GridView.</span></span>

[!code-aspx[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample11.aspx)]

<span data-ttu-id="a5f6d-247">接下来，创建一个事件处理程序的 LinkButton 的每个`Click`事件。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-247">Next, create an event handler for each of the LinkButton's `Click` events.</span></span>

<span data-ttu-id="a5f6d-248">图 7 显示了四个 Linkbutton 时通过 Visual Web Developer 设计视图查看。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-248">Figure 7 shows the four LinkButtons when viewed through the Visual Web Developer Design view.</span></span>

<span data-ttu-id="a5f6d-249">[![接下来，添加第一个、 上一个、 和最后一个 Linkbutton 下 GridView](building-an-interface-to-select-one-user-account-from-many-cs/_static/image20.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="a5f6d-249">[![Add First, Previous, Next, and Last LinkButtons Beneath the GridView](building-an-interface-to-select-one-user-account-from-many-cs/_static/image20.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image19.png)</span></span>

<span data-ttu-id="a5f6d-250">**图 7**:首先，添加上一步、 下一步，和最后一个 Linkbutton 下方的 GridView ([单击此项可查看原尺寸图像](building-an-interface-to-select-one-user-account-from-many-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="a5f6d-250">**Figure 7**: Add First, Previous, Next, and Last LinkButtons Beneath the GridView  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image21.png))</span></span>

### <a name="keeping-track-of-the-current-page-index"></a><span data-ttu-id="a5f6d-251">跟踪的当前页索引</span><span class="sxs-lookup"><span data-stu-id="a5f6d-251">Keeping Track of the Current Page Index</span></span>

<span data-ttu-id="a5f6d-252">当用户第一次访问`ManageUsers.aspx`页或单击任一筛选按钮，我们想要在 GridView 中显示数据的第一页。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-252">When a user first visits the `ManageUsers.aspx` page or clicks one of the filtering buttons, we want to display the first page of data in the GridView.</span></span> <span data-ttu-id="a5f6d-253">当用户单击其中一个导航 Linkbutton 时，但是，我们需要更新的页索引。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-253">When the user clicks one of the navigation LinkButtons, however, we need to update the page index.</span></span> <span data-ttu-id="a5f6d-254">若要维护的页索引和要每页显示的记录数，添加到页面的代码隐藏类的以下两个属性：</span><span class="sxs-lookup"><span data-stu-id="a5f6d-254">To maintain the page index and the number of records to display per page, add the following two properties to the page's code-behind class:</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample12.cs)]

<span data-ttu-id="a5f6d-255">像`UsernameToMatch`属性，`PageIndex`属性保持其视图状态的值。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-255">Like the `UsernameToMatch` property, the `PageIndex` property persists its value to view state.</span></span> <span data-ttu-id="a5f6d-256">只读的`PageSize`属性返回 10 的硬编码值。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-256">The read-only `PageSize` property returns a hard-coded value, 10.</span></span> <span data-ttu-id="a5f6d-257">我邀请感的读取器来更新此属性，以使用相同的模式`PageIndex`，然后以增加`ManageUsers.aspx`页上，以便访问的页面的人员可以指定多少个用户帐户以显示每个页上。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-257">I invite the interested reader to update this property to use the same pattern as `PageIndex`, and then to augment the `ManageUsers.aspx` page such that the person visiting the page can specify how many user accounts to display per page.</span></span>

### <a name="retrieving-just-the-current-pages-records-updating-the-page-index-and-enabling-and-disabling-the-paging-interface-linkbuttons"></a><span data-ttu-id="a5f6d-258">检索只是当前页的记录，更新页索引，并启用和禁用分页界面 Linkbutton</span><span class="sxs-lookup"><span data-stu-id="a5f6d-258">Retrieving Just the Current Page's Records, Updating the Page Index, and Enabling and Disabling the Paging Interface LinkButtons</span></span>

<span data-ttu-id="a5f6d-259">使用就地分页接口和`PageIndex`和`PageSize`添加属性，我们已准备好更新`BindUserAccounts`方法，以便使用相应`FindUsersByName`重载。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-259">With the paging interface in place and the `PageIndex` and `PageSize` properties added, we are ready to update the `BindUserAccounts` method so that it uses the appropriate `FindUsersByName` overload.</span></span> <span data-ttu-id="a5f6d-260">此外，我们需要将此方法启用或禁用分页界面，具体取决于要显示哪些页。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-260">Additionally, we need to have this method enable or disable the paging interface depending on what page is being displayed.</span></span> <span data-ttu-id="a5f6d-261">在查看数据的第一页时，应禁用第一个和上一步链接;查看最后一页时，应禁用下一步和最后一次。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-261">When viewing the first page of data, the First and Previous links should be disabled; Next and Last should be disabled when viewing the last page.</span></span>

<span data-ttu-id="a5f6d-262">使用以下代码更新 `BindUserAccounts` 方法：</span><span class="sxs-lookup"><span data-stu-id="a5f6d-262">Update the `BindUserAccounts` method with the following code:</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample13.cs)]

<span data-ttu-id="a5f6d-263">请注意，通过的最后一个参数确定正在通过用寻呼发送的记录总数`FindUsersByName`方法。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-263">Note that the total number of records being paged through is determined by the last parameter of the `FindUsersByName` method.</span></span> <span data-ttu-id="a5f6d-264">这是`out`参数，因此我们需要首先声明一个变量来保存此值 (`totalRecords`)，然后将其与前缀`out`关键字。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-264">This is an `out` parameter, so we need to first declare a variable to hold this value (`totalRecords`) and then prefix it with the `out` keyword.</span></span>

<span data-ttu-id="a5f6d-265">返回指定的页的用户帐户后，四个 Linkbutton 可以启用或禁用，具体取决于是否正在查看数据的第一个或最后一页。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-265">After the specified page of user accounts are returned, the four LinkButtons are either enabled or disabled, depending on whether the first or last page of data is being viewed.</span></span>

<span data-ttu-id="a5f6d-266">最后一步是编写代码的四个 Linkbutton`Click`事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-266">The last step is to write the code for the four LinkButtons' `Click` event handlers.</span></span> <span data-ttu-id="a5f6d-267">这些事件处理程序需要更新`PageIndex`属性，然后重新绑定到通过调用 GridView 数据`BindUserAccounts`。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-267">These event handlers need to update the `PageIndex` property and then rebind the data to the GridView via a call to `BindUserAccounts`.</span></span> <span data-ttu-id="a5f6d-268">第一个、 上一步和下一个事件处理程序是非常简单。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-268">The First, Previous, and Next event handlers are very simple.</span></span> <span data-ttu-id="a5f6d-269">`Click`最后一个 LinkButton，事件处理程序，但稍微有些复杂因为我们需要确定多少条记录显示以确定最后一页索引。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-269">The `Click` event handler for the Last LinkButton, however, is a bit more complex because we need to determine how many records are being displayed in order to determine the last page index.</span></span>

[!code-csharp[Main](building-an-interface-to-select-one-user-account-from-many-cs/samples/sample14.cs)]

<span data-ttu-id="a5f6d-270">图 8 和 9 在操作中展示的自定义分页界面。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-270">Figures 8 and 9 show the custom paging interface in action.</span></span> <span data-ttu-id="a5f6d-271">图 8 显示了`ManageUsers.aspx`页上查看所有用户帐户的数据的第一页时。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-271">Figure 8 shows the `ManageUsers.aspx` page when viewing the first page of data for all user accounts.</span></span> <span data-ttu-id="a5f6d-272">请注意，仅有 10 的 13 帐户会显示。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-272">Note that only 10 of the 13 accounts are displayed.</span></span> <span data-ttu-id="a5f6d-273">单击下一步或最后一个链接会导致回发时，更新`PageIndex`为 1，第二页的用户帐户添加到网格中的绑定 （请参阅图 9）。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-273">Clicking the Next or Last link causes a postback, updates the `PageIndex` to 1, and binds the second page of user accounts to the grid (see Figure 9).</span></span>

<span data-ttu-id="a5f6d-274">[![显示第一个 10 用户帐户](building-an-interface-to-select-one-user-account-from-many-cs/_static/image23.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="a5f6d-274">[![The First 10 User Accounts are Displayed](building-an-interface-to-select-one-user-account-from-many-cs/_static/image23.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image22.png)</span></span>

<span data-ttu-id="a5f6d-275">**图 8**:显示第一个 10 用户帐户 ([单击此项可查看原尺寸图像](building-an-interface-to-select-one-user-account-from-many-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="a5f6d-275">**Figure 8**: The First 10 User Accounts are Displayed  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image24.png))</span></span>

<span data-ttu-id="a5f6d-276">[![单击下一步链接显示用户帐户的第二的页](building-an-interface-to-select-one-user-account-from-many-cs/_static/image26.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="a5f6d-276">[![Clicking the Next Link Displays the Second Page of User Accounts](building-an-interface-to-select-one-user-account-from-many-cs/_static/image26.png)](building-an-interface-to-select-one-user-account-from-many-cs/_static/image25.png)</span></span>

<span data-ttu-id="a5f6d-277">**图 9**:单击下一步链接显示的第二个页面的用户帐户 ([单击此项可查看原尺寸图像](building-an-interface-to-select-one-user-account-from-many-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="a5f6d-277">**Figure 9**: Clicking the Next Link Displays the Second Page of User Accounts  ([Click to view full-size image](building-an-interface-to-select-one-user-account-from-many-cs/_static/image27.png))</span></span>

## <a name="summary"></a><span data-ttu-id="a5f6d-278">总结</span><span class="sxs-lookup"><span data-stu-id="a5f6d-278">Summary</span></span>

<span data-ttu-id="a5f6d-279">管理员通常需要从帐户列表中选择用户。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-279">Administrators often need to select a user from the list of accounts.</span></span> <span data-ttu-id="a5f6d-280">在前面的教程探讨了使用下拉列表填充用户，但这种方法可伸缩性差。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-280">In previous tutorials we looked at using a drop-down list populated with the users, but this approach does not scale well.</span></span> <span data-ttu-id="a5f6d-281">在本教程中我们探讨了更好的选择： 分页 GridView 中显示其结果的可筛选接口。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-281">In this tutorial we explored a better alternative: a filterable interface whose results are displayed in a paged GridView.</span></span> <span data-ttu-id="a5f6d-282">与此用户界面，管理员可以快速高效地找到并选择在千位之间的一个用户帐户。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-282">With this user interface, administrators can quickly and efficiently locate and select one user account among thousands.</span></span>

<span data-ttu-id="a5f6d-283">快乐编程 ！</span><span class="sxs-lookup"><span data-stu-id="a5f6d-283">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="a5f6d-284">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="a5f6d-284">Further Reading</span></span>

<span data-ttu-id="a5f6d-285">在本教程中讨论的主题的详细信息，请参阅以下资源：</span><span class="sxs-lookup"><span data-stu-id="a5f6d-285">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="a5f6d-286">在 ASP.NET 中使用 SQL Server 2005 的自定义分页</span><span class="sxs-lookup"><span data-stu-id="a5f6d-286">Custom Paging in ASP.NET with SQL Server 2005</span></span>](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx)
- [<span data-ttu-id="a5f6d-287">通过大量的数据有效分页</span><span class="sxs-lookup"><span data-stu-id="a5f6d-287">Efficiently Paging Through Large Amounts of Data</span></span>](https://asp.net/learn/data-access/tutorial-25-cs.aspx)
- [<span data-ttu-id="a5f6d-288">滚动你自己的网站管理工具</span><span class="sxs-lookup"><span data-stu-id="a5f6d-288">Rolling Your Own Website Administration Tool</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)

### <a name="about-the-author"></a><span data-ttu-id="a5f6d-289">关于作者</span><span class="sxs-lookup"><span data-stu-id="a5f6d-289">About the Author</span></span>

<span data-ttu-id="a5f6d-290">自 1998 年以来，Scott Mitchell，多部 asp/ASP.NET 书籍的作者及 4GuysFromRolla.com 的已从事 Microsoft Web 技术工作。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-290">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="a5f6d-291">Scott 是独立的顾问、 培训师和编写器。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-291">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="a5f6d-292">他最新著作是 *[Sams Teach 自己 ASP.NET 2.0 24 小时内](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-292">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="a5f6d-293">可以在达到 Scott [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com)或通过他的博客[ http://ScottOnWriting.NET ](http://scottonwriting.net/)。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-293">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="a5f6d-294">特别感谢</span><span class="sxs-lookup"><span data-stu-id="a5f6d-294">Special Thanks To</span></span>

<span data-ttu-id="a5f6d-295">很多有用的审阅者已评审本系列教程。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-295">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="a5f6d-296">本教程中的潜在顾客审阅者已 Alicja Maziarz。</span><span class="sxs-lookup"><span data-stu-id="a5f6d-296">Lead reviewer for this tutorial was Alicja Maziarz.</span></span> <span data-ttu-id="a5f6d-297">是否有兴趣查看我即将推出的 MSDN 文章？</span><span class="sxs-lookup"><span data-stu-id="a5f6d-297">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="a5f6d-298">如果是这样，给我在行 [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a5f6d-298">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="a5f6d-299">下一页</span><span class="sxs-lookup"><span data-stu-id="a5f6d-299">Next</span></span>](recovering-and-changing-passwords-cs.md)
