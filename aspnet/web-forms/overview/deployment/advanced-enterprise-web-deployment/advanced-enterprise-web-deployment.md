---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/advanced-enterprise-web-deployment
title: 高级企业 Web 部署 |Microsoft Docs
author: jrjlee
description: 本教程将向您演示如何在许多企业部署方案中执行所需的各种任务。 对于意大利语 translati 。
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 7dcaba80-f2ec-4db3-ad98-daadc3afdb49
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/advanced-enterprise-web-deployment
msc.type: authoredcontent
ms.openlocfilehash: bf4c7d021763017592483df35cb717295c4924aa
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/06/2020
ms.locfileid: "78474956"
---
# <a name="advanced-enterprise-web-deployment"></a><span data-ttu-id="19414-104">高级企业 Web 部署</span><span class="sxs-lookup"><span data-stu-id="19414-104">Advanced Enterprise Web Deployment</span></span>

<span data-ttu-id="19414-105">作者： [Jason](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="19414-105">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="19414-106">下载 PDF</span><span class="sxs-lookup"><span data-stu-id="19414-106">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="19414-107">本教程将向您演示如何在许多企业部署方案中执行所需的各种任务。</span><span class="sxs-lookup"><span data-stu-id="19414-107">This tutorial will show you how to perform various tasks that are required or desirable in a lot of enterprise deployment scenarios.</span></span>
> 
> <span data-ttu-id="19414-108">有关这些教程的意大利语翻译，请访问[http://www.lucamorelli.it](http://www.lucamorelli.it)。</span><span class="sxs-lookup"><span data-stu-id="19414-108">For an Italian translation of these tutorials, visit [http://www.lucamorelli.it](http://www.lucamorelli.it).</span></span>

<span data-ttu-id="19414-109">这构成了一系列教程的一部分，这些教程基于名为 Fabrikam，Inc. 的虚构公司的企业部署要求。本教程系列使用一个示例解决方案&#x2014;，该解决方案使用&#x2014;[联系人管理器](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)解决方案来表示具有真实复杂性级别的 WEB 应用程序，包括 ASP.NET MVC 3 应用程序、Windows Communication Foundation （WCF）服务和数据库项目。</span><span class="sxs-lookup"><span data-stu-id="19414-109">This forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) solution&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="19414-110">这些教程核心的部署方法基于[理解生成过程](../web-deployment-in-the-enterprise/understanding-the-build-process.md)中所述的拆分项目文件方法，其中，生成过程由两个项目文件&#x2014;控制，其中一个包含适用于每个目标环境的生成说明，另一个包含特定于环境的生成和部署设置。</span><span class="sxs-lookup"><span data-stu-id="19414-110">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Build Process](../web-deployment-in-the-enterprise/understanding-the-build-process.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="19414-111">在生成时，特定于环境的项目文件将合并到环境无关的项目文件中，以形成一组完整的生成说明。</span><span class="sxs-lookup"><span data-stu-id="19414-111">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="scenario-overview"></a><span data-ttu-id="19414-112">方案概述</span><span class="sxs-lookup"><span data-stu-id="19414-112">Scenario Overview</span></span>

<span data-ttu-id="19414-113">[企业 Web 部署：方案概述](../deploying-web-applications-in-enterprise-scenarios/enterprise-web-deployment-scenario-overview.md)中介绍了这些教程的高级方案。</span><span class="sxs-lookup"><span data-stu-id="19414-113">The high-level scenario for these tutorials is described in [Enterprise Web Deployment: Scenario Overview](../deploying-web-applications-in-enterprise-scenarios/enterprise-web-deployment-scenario-overview.md).</span></span> <span data-ttu-id="19414-114">建议你在开始学习本教程之前查看此主题。</span><span class="sxs-lookup"><span data-stu-id="19414-114">We recommend that you review this topic before you get started on this tutorial.</span></span>

## <a name="how-to-use-this-tutorial"></a><span data-ttu-id="19414-115">如何使用本教程</span><span class="sxs-lookup"><span data-stu-id="19414-115">How to Use This Tutorial</span></span>

- <span data-ttu-id="19414-116">本教程中的每个主题都是独立的，它解决了企业部署方案中发生的特定挑战或问题。</span><span class="sxs-lookup"><span data-stu-id="19414-116">Each of the topics in this tutorial is self-contained and addresses a particular challenge or problem that occurs in enterprise deployment scenarios.</span></span> <span data-ttu-id="19414-117">不需要按任何特定顺序处理这些主题。</span><span class="sxs-lookup"><span data-stu-id="19414-117">You don't need to work through these topics in any particular order.</span></span> <span data-ttu-id="19414-118">不过，本教程介绍了一些高级任务。</span><span class="sxs-lookup"><span data-stu-id="19414-118">However, this tutorial covers some advanced tasks.</span></span> <span data-ttu-id="19414-119">因此，您应熟悉[企业教程中的 Web 部署](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md)所涉及的概念和技术，以便充分利用此内容。</span><span class="sxs-lookup"><span data-stu-id="19414-119">As such, you should familiarize yourself with the concepts and techniques that the [Web Deployment in the Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md) tutorial covers in order to gain the most benefit from this content.</span></span>
- <span data-ttu-id="19414-120">本教程包括以下主题：</span><span class="sxs-lookup"><span data-stu-id="19414-120">This tutorial includes these topics:</span></span>
- <span data-ttu-id="19414-121">[执行 "What If" 部署](performing-a-what-if-deployment.md)。</span><span class="sxs-lookup"><span data-stu-id="19414-121">[Performing a "What If" Deployment](performing-a-what-if-deployment.md).</span></span> <span data-ttu-id="19414-122">在许多情况下，你需要在实际进行任何更改之前，确定在目标环境或任何现有内容上建议的部署的影响。</span><span class="sxs-lookup"><span data-stu-id="19414-122">In a lot of scenarios, you'll want to determine the impact of a proposed deployment on a target environment or any existing content before you actually make any changes.</span></span> <span data-ttu-id="19414-123">本主题介绍如何运行 "假设" 部署来生成日志文件和数据库更新脚本，就好像已将内容部署到目标环境一样，无需进行任何更改。</span><span class="sxs-lookup"><span data-stu-id="19414-123">This topic describes how you can run a "what if" deployment to generate log files and database update scripts as if you had deployed content to a target environment, without actually making any changes.</span></span> <span data-ttu-id="19414-124">分析这些资源可帮助你在实时部署之前发现任何潜在问题。</span><span class="sxs-lookup"><span data-stu-id="19414-124">Analyzing these resources can help you to spot any potential problems in advance of a live deployment.</span></span>
- <span data-ttu-id="19414-125">[自定义多个环境的数据库部署](customizing-database-deployments-for-multiple-environments.md)。</span><span class="sxs-lookup"><span data-stu-id="19414-125">[Customizing Database Deployments for Multiple Environments](customizing-database-deployments-for-multiple-environments.md).</span></span> <span data-ttu-id="19414-126">将数据库项目部署到多个目标时，通常需要为每个目标环境自定义部署属性。</span><span class="sxs-lookup"><span data-stu-id="19414-126">When you deploy a database project to multiple destinations, you'll often want to customize the deployment properties for each target environment.</span></span> <span data-ttu-id="19414-127">例如，在测试环境中，您通常会在每次部署时重新创建数据库，而在过渡环境或生产环境中，您更有可能进行增量更新以保留数据。</span><span class="sxs-lookup"><span data-stu-id="19414-127">For example, in test environments you'd typically recreate the database on every deployment, whereas in staging or production environments you'd be a lot more likely to make incremental updates to preserve your data.</span></span> <span data-ttu-id="19414-128">本主题介绍如何通过为每个目标环境创建环境特定的部署配置（sqldeployment）文件，将这些属性更改合并到部署逻辑中。</span><span class="sxs-lookup"><span data-stu-id="19414-128">This topic describes how you can incorporate these property changes into your deployment logic by creating an environment-specific deployment configuration (.sqldeployment) file for each target environment.</span></span>
- <span data-ttu-id="19414-129">将数据库角色成员身份部署到测试环境。</span><span class="sxs-lookup"><span data-stu-id="19414-129">Deploying Database Role Memberships to Test Environments.</span></span> <span data-ttu-id="19414-130">当你在每次部署&#x2014;时重新创建数据库时（例如，作为持续集成（CI）生成并部署到测试环境&#x2014;的一部分），通常需要每次配置数据库角色成员身份。</span><span class="sxs-lookup"><span data-stu-id="19414-130">When you recreate a database on every deployment&#x2014;for example, as part of a continuous integration (CI) build and deploy to a test environment&#x2014;you'll typically need to configure database role memberships every time.</span></span> <span data-ttu-id="19414-131">例如，你通常需要向与你的 web 应用程序关联的应用程序池标识授予权限。</span><span class="sxs-lookup"><span data-stu-id="19414-131">For example, you'll usually need to grant permissions to the application pool identity associated with your web application.</span></span> <span data-ttu-id="19414-132">本主题介绍如何通过向部署逻辑添加后期部署 SQL 脚本来自动执行此过程。</span><span class="sxs-lookup"><span data-stu-id="19414-132">This topic describes how you can automate this process by adding a post-deployment SQL script to your deployment logic.</span></span>
- <span data-ttu-id="19414-133">[将成员资格数据库部署到企业环境](deploying-membership-databases-to-enterprise-environments.md)。</span><span class="sxs-lookup"><span data-stu-id="19414-133">[Deploying Membership Databases to Enterprise Environments](deploying-membership-databases-to-enterprise-environments.md).</span></span> <span data-ttu-id="19414-134">ASP.NET 成员资格数据库具有各种特征，这会使部署过程复杂化。</span><span class="sxs-lookup"><span data-stu-id="19414-134">ASP.NET membership databases have various characteristics that can complicate the deployment process.</span></span> <span data-ttu-id="19414-135">例如，仅限架构的部署将使数据库处于不可操作状态。</span><span class="sxs-lookup"><span data-stu-id="19414-135">For example, a schema-only deployment will leave the database in a non-operational state.</span></span> <span data-ttu-id="19414-136">在大多数情况下，最好直接在每个目标环境中创建成员资格数据库。</span><span class="sxs-lookup"><span data-stu-id="19414-136">In most scenarios, it's preferable to create a membership database directly in each destination environment.</span></span> <span data-ttu-id="19414-137">但是，如果您确实需要部署成员资格数据库，则本主题将介绍一些可用于满足固有挑战的方法。</span><span class="sxs-lookup"><span data-stu-id="19414-137">However, if you do have to deploy a membership database, this topic describes some of the approaches you can use to meet the inherent challenges.</span></span>
- <span data-ttu-id="19414-138">[从部署中排除文件和文件夹](excluding-files-and-folders-from-deployment.md)。</span><span class="sxs-lookup"><span data-stu-id="19414-138">[Excluding Files and Folders from Deployment](excluding-files-and-folders-from-deployment.md).</span></span> <span data-ttu-id="19414-139">在某些情况下，你需要将 web 包的内容定制为特定的目标环境。</span><span class="sxs-lookup"><span data-stu-id="19414-139">In some scenarios, you'll want to tailor the contents of your web package to specific destination environments.</span></span> <span data-ttu-id="19414-140">例如，你可能想要在部署到测试环境时包括所有版本的 JavaScript 库，以支持客户端调试，但在部署到过渡环境或生产环境时，请使用缩小版本的库。</span><span class="sxs-lookup"><span data-stu-id="19414-140">For example, you might want to include full versions of JavaScript libraries when you deploy to a test environment, to support client-side debugging, but use minified versions of the libraries when you deploy to a staging or production environment.</span></span> <span data-ttu-id="19414-141">本主题介绍如何在包创建过程中排除特定的文件和文件夹。</span><span class="sxs-lookup"><span data-stu-id="19414-141">This topic describes how you can exclude specific files and folders from the package creation process.</span></span>
- <span data-ttu-id="19414-142">使[Web 应用程序脱机，并 Web 部署](taking-web-applications-offline-with-web-deploy.md)。</span><span class="sxs-lookup"><span data-stu-id="19414-142">[Taking Web Applications Offline with Web Deploy](taking-web-applications-offline-with-web-deploy.md).</span></span> <span data-ttu-id="19414-143">将解决方案部署到过渡环境或生产环境时，通常需要在部署过程中使 web 应用程序处于脱机状态。</span><span class="sxs-lookup"><span data-stu-id="19414-143">When you deploy solutions to a staging or production environment, you'll often want to take your web applications offline for the duration of the deployment process.</span></span> <span data-ttu-id="19414-144">本主题介绍如何在部署过程开始时将*应用\_脱机 .htm*文件添加到 web 应用程序，并将其删除。</span><span class="sxs-lookup"><span data-stu-id="19414-144">This topic describes how you can add an *App\_offline.htm* file to your web application at the start of the deployment process and remove it at the end.</span></span> <span data-ttu-id="19414-145">当*应用\_脱机 .htm*文件时，浏览 web 应用程序的任何用户将自动重定向到*应用\_脱机 .htm*文件。</span><span class="sxs-lookup"><span data-stu-id="19414-145">While the *App\_offline.htm* file is in place, any users who browse to the web application are automatically redirected to the *App\_offline.htm* file.</span></span>
- <span data-ttu-id="19414-146">[从 MSBuild 运行 Windows PowerShell 脚本](running-windows-powershell-scripts-from-msbuild-project-files.md)。</span><span class="sxs-lookup"><span data-stu-id="19414-146">[Running Windows PowerShell Scripts from MSBuild](running-windows-powershell-scripts-from-msbuild-project-files.md).</span></span> <span data-ttu-id="19414-147">许多部署方案需要更复杂的部署后操作，例如将自定义事件源添加到注册表或在 SQL Server 实例之间配置复制。</span><span class="sxs-lookup"><span data-stu-id="19414-147">Many deployment scenarios require more complex post-deployment actions, like adding custom event sources to the registry or configuring replication between SQL Server instances.</span></span> <span data-ttu-id="19414-148">通常通过 Windows PowerShell 脚本来完成这些操作。</span><span class="sxs-lookup"><span data-stu-id="19414-148">These actions are often accomplished through Windows PowerShell scripts.</span></span> <span data-ttu-id="19414-149">本主题介绍如何在生成和部署过程中从 Microsoft 生成引擎（MSBuild）项目文件中运行 Windows PowerShell 脚本。</span><span class="sxs-lookup"><span data-stu-id="19414-149">This topic describes how to run Windows PowerShell scripts from a Microsoft Build Engine (MSBuild) project file as part of the build and deployment process.</span></span>
- <span data-ttu-id="19414-150">[排查打包过程问题](troubleshooting-the-packaging-process.md)。</span><span class="sxs-lookup"><span data-stu-id="19414-150">[Troubleshooting the Packaging Process](troubleshooting-the-packaging-process.md).</span></span> <span data-ttu-id="19414-151">Web 发布管道（WPP）定义了一个名为**EnablePackageProcessLoggingAndAssert**的 MSBuild 属性，可用于生成有关 Web 应用程序项目打包过程的详细信息。</span><span class="sxs-lookup"><span data-stu-id="19414-151">The Web Publishing Pipeline (WPP) defines an MSBuild property named **EnablePackageProcessLoggingAndAssert** that you can use to generate in-depth information about the packaging process for web application projects.</span></span> <span data-ttu-id="19414-152">本主题介绍属性的作用以及如何使用它。</span><span class="sxs-lookup"><span data-stu-id="19414-152">This topic describes what the property does and how to use it.</span></span>

## <a name="key-technologies"></a><span data-ttu-id="19414-153">关键技术</span><span class="sxs-lookup"><span data-stu-id="19414-153">Key Technologies</span></span>

<span data-ttu-id="19414-154">本教程重点介绍如何使用这些产品和技术来支持自动生成和 web 部署：</span><span class="sxs-lookup"><span data-stu-id="19414-154">This tutorial focuses on how to use these products and technologies to support automated build and web deployment:</span></span>

- <span data-ttu-id="19414-155">Visual Studio 2010 和 Team Foundation Server （TFS）2010</span><span class="sxs-lookup"><span data-stu-id="19414-155">Visual Studio 2010 and Team Foundation Server (TFS) 2010</span></span>
- <span data-ttu-id="19414-156">MSBuild 和 TFS Team Build</span><span class="sxs-lookup"><span data-stu-id="19414-156">MSBuild and TFS Team Build</span></span>
- <span data-ttu-id="19414-157">Internet Information Services （IIS）7。5</span><span class="sxs-lookup"><span data-stu-id="19414-157">Internet Information Services (IIS) 7.5</span></span>
- <span data-ttu-id="19414-158">IIS Web 部署工具（Web 部署）2。1</span><span class="sxs-lookup"><span data-stu-id="19414-158">IIS Web Deployment Tool (Web Deploy) 2.1</span></span>
- <span data-ttu-id="19414-159">VSDBCMD 数据库部署实用工具</span><span class="sxs-lookup"><span data-stu-id="19414-159">The VSDBCMD.exe database deployment utility</span></span>

## <a name="other-tutorials-in-this-series"></a><span data-ttu-id="19414-160">本系列中的其他教程</span><span class="sxs-lookup"><span data-stu-id="19414-160">Other Tutorials in This Series</span></span>

<span data-ttu-id="19414-161">这构成了一系列有关企业级 web 部署的五个教程的组成部分。</span><span class="sxs-lookup"><span data-stu-id="19414-161">This forms part of a series of five tutorials on enterprise-scale web deployment.</span></span> <span data-ttu-id="19414-162">这些是系列中的其他教程：</span><span class="sxs-lookup"><span data-stu-id="19414-162">These are other tutorials in the series:</span></span>

- <span data-ttu-id="19414-163">[在企业方案中部署 Web 应用程序](../deploying-web-applications-in-enterprise-scenarios/deploying-web-applications-in-enterprise-scenarios.md)。</span><span class="sxs-lookup"><span data-stu-id="19414-163">[Deploying Web Applications in Enterprise Scenarios](../deploying-web-applications-in-enterprise-scenarios/deploying-web-applications-in-enterprise-scenarios.md).</span></span> <span data-ttu-id="19414-164">此介绍性内容为教程系列提供了上下文背景。</span><span class="sxs-lookup"><span data-stu-id="19414-164">This introductory content provides the contextual background for the tutorial series.</span></span> <span data-ttu-id="19414-165">它介绍了教程方案，并说明了整个系列中描述的任务和演练如何适应更广泛的应用程序生命周期管理（ALM）过程。</span><span class="sxs-lookup"><span data-stu-id="19414-165">It describes the tutorial scenario, and it illustrates how the tasks and walkthroughs described throughout the series fit into a broader Application Lifecycle Management (ALM) process.</span></span>
- <span data-ttu-id="19414-166">[企业中的 Web 部署](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md)。</span><span class="sxs-lookup"><span data-stu-id="19414-166">[Web Deployment in the Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md).</span></span> <span data-ttu-id="19414-167">本教程介绍了 MSBuild 项目文件、WPP、Web 部署和其他相关技术。</span><span class="sxs-lookup"><span data-stu-id="19414-167">This tutorial provides a conceptual introduction to MSBuild project files, the WPP, Web Deploy, and other related technologies.</span></span> <span data-ttu-id="19414-168">它说明了如何使用这些工具来管理复杂的部署过程。</span><span class="sxs-lookup"><span data-stu-id="19414-168">It explains how you can use these tools together to manage complex deployment processes.</span></span>
- <span data-ttu-id="19414-169">[配置用于 Web 部署的服务器环境](../configuring-server-environments-for-web-deployment/configuring-server-environments-for-web-deployment.md)。</span><span class="sxs-lookup"><span data-stu-id="19414-169">[Configuring Server Environments for Web Deployment](../configuring-server-environments-for-web-deployment/configuring-server-environments-for-web-deployment.md).</span></span> <span data-ttu-id="19414-170">本教程介绍如何配置 Windows server 以支持各种部署方案，包括使用 Web 部署代理服务（远程代理）或 Web 部署处理程序和远程数据库部署的远程 web 包部署。</span><span class="sxs-lookup"><span data-stu-id="19414-170">This tutorial describes how to configure Windows servers to support various deployment scenarios, including remote web package deployment using the Web Deployment Agent Service (the remote agent) or the Web Deploy Handler and remote database deployment.</span></span> <span data-ttu-id="19414-171">本指南提供了有关为自己的环境选择适当的部署方法的指导，并介绍了如何使用 Web 场框架（WFF）在服务器场中的所有 web 服务器之间复制已部署的 web 应用程序。</span><span class="sxs-lookup"><span data-stu-id="19414-171">It provides guidance on choosing the appropriate deployment method for your own environment, and it describes how to use the Web Farm Framework (WFF) to replicate deployed web applications across all the web servers in a server farm.</span></span>
- <span data-ttu-id="19414-172">[为 Web 部署配置 Team Foundation Server](../configuring-team-foundation-server-for-web-deployment/configuring-team-foundation-server-for-web-deployment.md)。</span><span class="sxs-lookup"><span data-stu-id="19414-172">[Configuring Team Foundation Server for Web Deployment](../configuring-team-foundation-server-for-web-deployment/configuring-team-foundation-server-for-web-deployment.md).</span></span> <span data-ttu-id="19414-173">本教程介绍如何配置 TFS 以支持各种部署方案，包括作为 CI 过程的一部分自动部署和手动触发特定生成的部署。</span><span class="sxs-lookup"><span data-stu-id="19414-173">This tutorial describes how to configure TFS to support various deployment scenarios, including automated deployment as part of a CI process and manually triggered deployments of specific builds.</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="19414-174">下一部分</span><span class="sxs-lookup"><span data-stu-id="19414-174">Next</span></span>](performing-a-what-if-deployment.md)
