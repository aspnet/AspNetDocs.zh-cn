---
uid: web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-database-projects
title: 部署数据库项目 |Microsoft Docs
author: jrjlee
description: 注意：在许多企业部署方案中，需要能够将增量更新发布到已部署的数据库。 替代方法是重新创建 。
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 832f226a-1aa3-4093-8c29-ce4196793259
msc.legacyurl: /web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-database-projects
msc.type: authoredcontent
ms.openlocfilehash: 221808758492aedb8e8329364e511df28fd11105
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/06/2020
ms.locfileid: "78514940"
---
# <a name="deploying-database-projects"></a><span data-ttu-id="92004-104">部署数据库项目</span><span class="sxs-lookup"><span data-stu-id="92004-104">Deploying Database Projects</span></span>

<span data-ttu-id="92004-105">作者： [Jason](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="92004-105">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="92004-106">下载 PDF</span><span class="sxs-lookup"><span data-stu-id="92004-106">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> [!NOTE]
> <span data-ttu-id="92004-107">在许多企业部署方案中，需要能够将增量更新发布到已部署的数据库。</span><span class="sxs-lookup"><span data-stu-id="92004-107">In lots of enterprise deployment scenarios, you need the ability to publish incremental updates to a deployed database.</span></span> <span data-ttu-id="92004-108">替代方法是在每次部署时重新创建数据库，这意味着会丢失现有数据库中的所有数据。</span><span class="sxs-lookup"><span data-stu-id="92004-108">The alternative is to recreate the database on every deployment, which means you lose any data in the existing database.</span></span> <span data-ttu-id="92004-109">使用 Visual Studio 2010 时，建议使用 VSDBCMD 作为增量数据库发布的建议方法。</span><span class="sxs-lookup"><span data-stu-id="92004-109">When you work with Visual Studio 2010, using VSDBCMD is the recommended approach to incremental database publishing.</span></span> <span data-ttu-id="92004-110">不过，下一版本的 Visual Studio 和 Web 发布管道（WPP）将包括支持直接增量发布的工具。</span><span class="sxs-lookup"><span data-stu-id="92004-110">However, the next version of Visual Studio and the Web Publishing Pipeline (WPP) will include tooling that supports incremental publishing directly.</span></span>

<span data-ttu-id="92004-111">如果在 Visual Studio 2010 中打开联系人管理器示例解决方案，则会看到数据库项目包含一个包含四个文件的 Properties 文件夹。</span><span class="sxs-lookup"><span data-stu-id="92004-111">If you open the Contact Manager sample solution in Visual Studio 2010, you'll see that the database project includes a Properties folder that contains four files.</span></span>

![](deploying-database-projects/_static/image1.png)

<span data-ttu-id="92004-112">与项目文件（在本例中为*ContactManager* ）一起，这些文件控制生成和部署过程的各个方面：</span><span class="sxs-lookup"><span data-stu-id="92004-112">Together with the project file (*ContactManager.Database.dbproj* in this case), these files control various aspects of the build and deployment process:</span></span>

- <span data-ttu-id="92004-113">*Sqlcmdvars*文件提供部署项目时使用的任何 SQLCMD 变量的值。</span><span class="sxs-lookup"><span data-stu-id="92004-113">The *Database.sqlcmdvars* file provides values for any SQLCMD variables you use when you deploy the project.</span></span> <span data-ttu-id="92004-114">每个解决方案配置（例如，调试和发布）都可以指定一个不同的 sqlcmdvars 文件。</span><span class="sxs-lookup"><span data-stu-id="92004-114">Each solution configuration (for example, debug and release) can specify a different .sqlcmdvars file.</span></span>
- <span data-ttu-id="92004-115">*Sqldeployment*文件提供特定于部署的设置，例如，是使用项目中定义的排序规则还是目标服务器的排序规则，无论是每次重新创建目标数据库，还是只是修改现有数据库以使其保持最新状态等。</span><span class="sxs-lookup"><span data-stu-id="92004-115">The *Database.sqldeployment* file provides deployment-specific settings, like whether to use the collation defined in your project or the collation of the destination server, whether to recreate the destination database every time or simply amend the existing database to bring it up to date, and so on.</span></span> <span data-ttu-id="92004-116">每个解决方案配置都可以指定一个不同的 sqldeployment 文件。</span><span class="sxs-lookup"><span data-stu-id="92004-116">Each solution configuration can specify a different .sqldeployment file.</span></span>
- <span data-ttu-id="92004-117">*Sqlpermissions*文件是一个 XML 文档，可用于定义要添加到目标数据库的任何权限。</span><span class="sxs-lookup"><span data-stu-id="92004-117">The *Database.sqlpermissions* file is an XML document that you can use to define any permissions you want to add to the target database.</span></span> <span data-ttu-id="92004-118">所有解决方案配置共享相同的 sqlpermissions 文件。</span><span class="sxs-lookup"><span data-stu-id="92004-118">All solution configurations share the same .sqlpermissions file.</span></span>
- <span data-ttu-id="92004-119">*Sqlsettings*文件指定创建数据库时要使用的数据库级属性，如要使用的排序规则、比较运算符的行为，等等。</span><span class="sxs-lookup"><span data-stu-id="92004-119">The *Database.sqlsettings* file specifies the database-level properties to use when creating the database, like the collation to use, the behavior of comparison operators, and so on.</span></span> <span data-ttu-id="92004-120">所有解决方案配置共享相同的 sqlsettings 文件。</span><span class="sxs-lookup"><span data-stu-id="92004-120">All solution configurations share the same .sqlsettings file.</span></span>

<span data-ttu-id="92004-121">值得一段时间在 Visual Studio 中打开这些文件并熟悉内容。</span><span class="sxs-lookup"><span data-stu-id="92004-121">It's worth taking a moment to open these files in Visual Studio and familiarize yourself with the contents.</span></span>

<span data-ttu-id="92004-122">生成数据库项目时，生成过程将创建两个文件：</span><span class="sxs-lookup"><span data-stu-id="92004-122">When you build a database project, the build process creates two files:</span></span>

- <span data-ttu-id="92004-123">*数据库架构*（.dbschema 文件）。</span><span class="sxs-lookup"><span data-stu-id="92004-123">A *database schema* (.dbschema file).</span></span> <span data-ttu-id="92004-124">这将描述要以 XML 格式创建的数据库的架构。</span><span class="sxs-lookup"><span data-stu-id="92004-124">This describes the schema of the database you want to create in XML format.</span></span>
- <span data-ttu-id="92004-125">*部署清单*（deploymanifest 文件）。</span><span class="sxs-lookup"><span data-stu-id="92004-125">A *deployment manifest* (.deploymanifest file).</span></span> <span data-ttu-id="92004-126">这包含创建和部署数据库所需的所有信息。</span><span class="sxs-lookup"><span data-stu-id="92004-126">This contains all the information required to create and deploy your database.</span></span> <span data-ttu-id="92004-127">它引用 .dbschema 文件以及其他资源，例如部署说明（sqldeployment 文件）和任何预先部署或后期部署 SQL 脚本。</span><span class="sxs-lookup"><span data-stu-id="92004-127">It references the .dbschema file along with other resources, like the deployment instructions (the .sqldeployment file) and any pre-deployment or post-deployment SQL scripts.</span></span>

<span data-ttu-id="92004-128">这会显示这些资源之间的关系：</span><span class="sxs-lookup"><span data-stu-id="92004-128">This shows the relationship between these resources:</span></span>

![](deploying-database-projects/_static/image2.png)

<span data-ttu-id="92004-129">如您所见，sqlsettings 文件和 sqlpermissions 文件是生成过程的输入。</span><span class="sxs-lookup"><span data-stu-id="92004-129">As you can see, the .sqlsettings file and the .sqlpermissions file are inputs to the build process.</span></span> <span data-ttu-id="92004-130">除了数据库项目文件，这些文件用于创建数据库架构文件。</span><span class="sxs-lookup"><span data-stu-id="92004-130">Along with the database project file, these files are used to create the database schema file.</span></span> <span data-ttu-id="92004-131">Sqldeployment 文件和 sqlcmdvars 文件通过了不变的生成过程。</span><span class="sxs-lookup"><span data-stu-id="92004-131">The .sqldeployment file and the .sqlcmdvars file pass through the build process unchanged.</span></span> <span data-ttu-id="92004-132">部署清单指示数据库架构的位置、sqldeployment 文件、sqlcmdvars 文件以及任何预先部署或后期部署 SQL 脚本。</span><span class="sxs-lookup"><span data-stu-id="92004-132">The deployment manifest indicates the location of the database schema, the .sqldeployment file, the .sqlcmdvars file, and any pre-deployment or post-deployment SQL scripts.</span></span>

## <a name="why-use-vsdbcmd-to-deploy-a-database-project"></a><span data-ttu-id="92004-133">为什么使用 VSDBCMD 部署数据库项目？</span><span class="sxs-lookup"><span data-stu-id="92004-133">Why Use VSDBCMD to Deploy a Database Project?</span></span>

<span data-ttu-id="92004-134">可以通过多种不同的方法来部署数据库项目。</span><span class="sxs-lookup"><span data-stu-id="92004-134">There are various different approaches to deploying database projects.</span></span> <span data-ttu-id="92004-135">但是，并不是所有它们都适用于将数据库项目部署到企业环境中的远程服务器。</span><span class="sxs-lookup"><span data-stu-id="92004-135">However, not all of them are suitable for deploying a database project to remote servers in an enterprise environment.</span></span> <span data-ttu-id="92004-136">考虑数据库项目部署的所需内容。</span><span class="sxs-lookup"><span data-stu-id="92004-136">Consider what you want from a database project deployment.</span></span> <span data-ttu-id="92004-137">在企业部署方案中，您可能需要：</span><span class="sxs-lookup"><span data-stu-id="92004-137">In enterprise deployment scenarios, you're likely to want:</span></span>

- <span data-ttu-id="92004-138">能够从远程位置部署数据库项目。</span><span class="sxs-lookup"><span data-stu-id="92004-138">The ability to deploy the database project from a remote location.</span></span>
- <span data-ttu-id="92004-139">能够对现有数据库进行增量更新。</span><span class="sxs-lookup"><span data-stu-id="92004-139">The ability to make incremental updates to an existing database.</span></span>
- <span data-ttu-id="92004-140">包括预先部署脚本或后期部署脚本的功能。</span><span class="sxs-lookup"><span data-stu-id="92004-140">The ability to include pre-deployment scripts or post-deployment scripts.</span></span>
- <span data-ttu-id="92004-141">为多个目标环境定制部署的能力。</span><span class="sxs-lookup"><span data-stu-id="92004-141">The ability to tailor the deployment to multiple destination environments.</span></span>
- <span data-ttu-id="92004-142">将数据库项目部署为更大的、通常已编写脚本的单步解决方案部署的一部分。</span><span class="sxs-lookup"><span data-stu-id="92004-142">The ability to deploy the database project as part of a larger, typically scripted, single-step solution deployment.</span></span>

<span data-ttu-id="92004-143">可以使用以下三种主要方法来部署数据库项目：</span><span class="sxs-lookup"><span data-stu-id="92004-143">There are three main approaches you can use to deploy a database project:</span></span>

- <span data-ttu-id="92004-144">你可以在 Visual Studio 2010 中将部署功能与数据库项目类型一起使用。</span><span class="sxs-lookup"><span data-stu-id="92004-144">You can use the deployment functionality with the database project type in Visual Studio 2010.</span></span> <span data-ttu-id="92004-145">在 Visual Studio 2010 中生成和部署数据库项目时，部署过程使用部署清单来生成特定于生成配置的基于 SQL 的部署文件。</span><span class="sxs-lookup"><span data-stu-id="92004-145">When you build and deploy a database project in Visual Studio 2010, the deployment process uses the deployment manifest to generate a SQL-based deployment file specific to the build configuration.</span></span> <span data-ttu-id="92004-146">如果数据库尚不存在，则将创建数据库，如果数据库已存在，则将对其进行必要的更改。</span><span class="sxs-lookup"><span data-stu-id="92004-146">This will create the database if it doesn't already exist or make any necessary changes to the database if it does already exist.</span></span> <span data-ttu-id="92004-147">可以使用 SQLCMD 在目标服务器上运行此文件，也可以设置 Visual Studio 来创建和运行文件。</span><span class="sxs-lookup"><span data-stu-id="92004-147">You can use SQLCMD.exe to run this file on your destination server, or you can set Visual Studio to create and run the file.</span></span> <span data-ttu-id="92004-148">此方法的缺点是，你只对部署设置的控制受到限制。</span><span class="sxs-lookup"><span data-stu-id="92004-148">The disadvantage of this approach is that you have only limited control over the deployment settings.</span></span> <span data-ttu-id="92004-149">你可能还需要修改 SQL 部署文件以提供特定于环境的变量值。</span><span class="sxs-lookup"><span data-stu-id="92004-149">You may often also need to modify the SQL deployment file to provide environment-specific variable values.</span></span> <span data-ttu-id="92004-150">你只能在安装了 Visual Studio 2010 的计算机上使用此方法，开发人员需要了解并提供适用于所有目标环境的连接字符串和凭据。</span><span class="sxs-lookup"><span data-stu-id="92004-150">You can only use this approach from a computer with Visual Studio 2010 installed, and the developer would need to know and provide connection strings and credentials for all destination environments.</span></span>
- <span data-ttu-id="92004-151">您可以使用 Internet Information Services （IIS） Web 部署工具（Web 部署）将[数据库部署为 Web 应用程序项目的一部分](https://msdn.microsoft.com/library/dd465343.aspx)。</span><span class="sxs-lookup"><span data-stu-id="92004-151">You can use the Internet Information Services (IIS) Web Deployment Tool (Web Deploy) to [deploy a database as part of a web application project](https://msdn.microsoft.com/library/dd465343.aspx).</span></span> <span data-ttu-id="92004-152">但是，如果你想要部署数据库项目而不是只是复制目标服务器上的现有本地数据库，则此方法要复杂得多。</span><span class="sxs-lookup"><span data-stu-id="92004-152">However, this approach is a lot more complex if you want to deploy a database project rather than simply replicate an existing local database on a destination server.</span></span> <span data-ttu-id="92004-153">您可以将 Web 部署配置为运行数据库项目生成的 SQL 部署脚本，但为了实现此目的，您需要为 Web 应用程序项目创建自定义 WPP 目标文件。</span><span class="sxs-lookup"><span data-stu-id="92004-153">You can configure Web Deploy to run the SQL deployment script that the database project generates, but in order to do this, you need to create a custom WPP targets file for your web application project.</span></span> <span data-ttu-id="92004-154">这会增加部署过程的复杂程度。</span><span class="sxs-lookup"><span data-stu-id="92004-154">This adds a substantial amount of complexity to the deployment process.</span></span> <span data-ttu-id="92004-155">此外，Web 部署不直接支持对现有数据库进行增量更新。</span><span class="sxs-lookup"><span data-stu-id="92004-155">In addition, Web Deploy does not directly support incremental updates to existing databases.</span></span> <span data-ttu-id="92004-156">有关此方法的详细信息，请参阅[将 Web 发布管道扩展到包数据库项目部署的 SQL 文件](https://go.microsoft.com/?linkid=9805121)。</span><span class="sxs-lookup"><span data-stu-id="92004-156">For more information on this approach, see [Extending the Web Publishing Pipeline to package database project deployed SQL file](https://go.microsoft.com/?linkid=9805121).</span></span>
- <span data-ttu-id="92004-157">您可以使用 VSDBCMD 实用程序来部署数据库，方法是使用数据库架构还是部署清单。</span><span class="sxs-lookup"><span data-stu-id="92004-157">You can use the VSDBCMD utility to deploy the database, using either the database schema or the deployment manifest.</span></span> <span data-ttu-id="92004-158">可以从 MSBuild 目标调用 VSDBCMD，这使你可以在更大的脚本化部署过程中发布数据库。</span><span class="sxs-lookup"><span data-stu-id="92004-158">You can call VSDBCMD.exe from an MSBuild target, which lets you publish databases as part of a larger, scripted deployment process.</span></span> <span data-ttu-id="92004-159">你可以从 VSDBCMD 命令重写 sqlcmdvars 文件中的变量和其他许多数据库属性，这使你可以针对不同的环境自定义部署，而无需创建多个生成配置。</span><span class="sxs-lookup"><span data-stu-id="92004-159">You can override the variables in your .sqlcmdvars file and lots of other database properties from a VSDBCMD command, which allows you to customize your deployment for different environments without creating multiple build configurations.</span></span> <span data-ttu-id="92004-160">VSDBCMD 提供了与众不同的功能，这意味着它将仅进行必要的更改，使目标数据库与你的数据库架构相一致。</span><span class="sxs-lookup"><span data-stu-id="92004-160">VSDBCMD provides differentiation functionality, which means it will make only the necessary changes to align a destination database with your database schema.</span></span> <span data-ttu-id="92004-161">VSDBCMD 还提供了各种命令行选项，使你可以精细地控制部署过程。</span><span class="sxs-lookup"><span data-stu-id="92004-161">VSDBCMD also offers a wide range of command-line options, which give you fine-grained control over the deployment process.</span></span>

<span data-ttu-id="92004-162">从此概述中，你可以看到，将 VSDBCMD 与 MSBuild 结合使用最适合于典型的企业部署方案：</span><span class="sxs-lookup"><span data-stu-id="92004-162">From this overview, you can see that using VSDBCMD with MSBuild is the approach best suited to a typical enterprise deployment scenario:</span></span>

|  | <span data-ttu-id="92004-163">Visual Studio 2010</span><span class="sxs-lookup"><span data-stu-id="92004-163">Visual Studio 2010</span></span> | <span data-ttu-id="92004-164">Web 部署 2.0</span><span class="sxs-lookup"><span data-stu-id="92004-164">Web Deploy 2.0</span></span> | <span data-ttu-id="92004-165">VSDBCMD.exe</span><span class="sxs-lookup"><span data-stu-id="92004-165">VSDBCMD.exe</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="92004-166">是否支持远程部署？</span><span class="sxs-lookup"><span data-stu-id="92004-166">Supports remote deployment?</span></span> | <span data-ttu-id="92004-167">是</span><span class="sxs-lookup"><span data-stu-id="92004-167">Yes</span></span> | <span data-ttu-id="92004-168">是</span><span class="sxs-lookup"><span data-stu-id="92004-168">Yes</span></span> | <span data-ttu-id="92004-169">是</span><span class="sxs-lookup"><span data-stu-id="92004-169">Yes</span></span> |
| <span data-ttu-id="92004-170">支持增量更新？</span><span class="sxs-lookup"><span data-stu-id="92004-170">Supports incremental updates?</span></span> | <span data-ttu-id="92004-171">是</span><span class="sxs-lookup"><span data-stu-id="92004-171">Yes</span></span> | <span data-ttu-id="92004-172">No</span><span class="sxs-lookup"><span data-stu-id="92004-172">No</span></span> | <span data-ttu-id="92004-173">是</span><span class="sxs-lookup"><span data-stu-id="92004-173">Yes</span></span> |
| <span data-ttu-id="92004-174">支持预先部署/后期部署脚本？</span><span class="sxs-lookup"><span data-stu-id="92004-174">Supports pre/post-deployment scripts?</span></span> | <span data-ttu-id="92004-175">是</span><span class="sxs-lookup"><span data-stu-id="92004-175">Yes</span></span> | <span data-ttu-id="92004-176">是</span><span class="sxs-lookup"><span data-stu-id="92004-176">Yes</span></span> | <span data-ttu-id="92004-177">是</span><span class="sxs-lookup"><span data-stu-id="92004-177">Yes</span></span> |
| <span data-ttu-id="92004-178">支持多环境部署？</span><span class="sxs-lookup"><span data-stu-id="92004-178">Supports multi-environment deployment?</span></span> | <span data-ttu-id="92004-179">有限</span><span class="sxs-lookup"><span data-stu-id="92004-179">Limited</span></span> | <span data-ttu-id="92004-180">有限</span><span class="sxs-lookup"><span data-stu-id="92004-180">Limited</span></span> | <span data-ttu-id="92004-181">是</span><span class="sxs-lookup"><span data-stu-id="92004-181">Yes</span></span> |
| <span data-ttu-id="92004-182">支持脚本部署？</span><span class="sxs-lookup"><span data-stu-id="92004-182">Supports scripted deployment?</span></span> | <span data-ttu-id="92004-183">有限</span><span class="sxs-lookup"><span data-stu-id="92004-183">Limited</span></span> | <span data-ttu-id="92004-184">是</span><span class="sxs-lookup"><span data-stu-id="92004-184">Yes</span></span> | <span data-ttu-id="92004-185">是</span><span class="sxs-lookup"><span data-stu-id="92004-185">Yes</span></span> |

<span data-ttu-id="92004-186">本主题的其余部分介绍了如何将 VSDBCMD 与 MSBuild 结合使用来部署数据库项目。</span><span class="sxs-lookup"><span data-stu-id="92004-186">The remainder of this topic describes the use of VSDBCMD with MSBuild to deploy database projects.</span></span>

## <a name="understanding-the-deployment-process"></a><span data-ttu-id="92004-187">了解部署过程</span><span class="sxs-lookup"><span data-stu-id="92004-187">Understanding the Deployment Process</span></span>

<span data-ttu-id="92004-188">使用 VSDBCMD 实用工具，可以使用数据库架构（.dbschema 文件）或部署清单（deploymanifest 文件）来部署数据库。</span><span class="sxs-lookup"><span data-stu-id="92004-188">The VSDBCMD utility lets you deploy a database using either the database schema (the .dbschema file) or the deployment manifest (the .deploymanifest file).</span></span> <span data-ttu-id="92004-189">在实践中，你几乎始终使用部署清单，因为部署清单允许你为各种部署属性提供默认值，并确定要运行的任何预先部署或后期部署 SQL 脚本。</span><span class="sxs-lookup"><span data-stu-id="92004-189">In practice, you'll almost always use the deployment manifest, as the deployment manifest lets you provide default values for various deployment properties and identify any pre-deployment or post-deployment SQL scripts you want to run.</span></span> <span data-ttu-id="92004-190">例如，此 VSDBCMD 命令用于在测试环境中将**ContactManager**数据库部署到数据库服务器：</span><span class="sxs-lookup"><span data-stu-id="92004-190">For example, this VSDBCMD command is used to deploy the **ContactManager** database to a database server in a test environment:</span></span>

[!code-console[Main](deploying-database-projects/samples/sample1.cmd)]

<span data-ttu-id="92004-191">这种情况下：</span><span class="sxs-lookup"><span data-stu-id="92004-191">In this case:</span></span>

- <span data-ttu-id="92004-192">**/A** （或 **/Action**）开关指定要 VSDBCMD 执行的操作。</span><span class="sxs-lookup"><span data-stu-id="92004-192">The **/a** (or **/Action**) switch specifies what you want VSDBCMD to do.</span></span> <span data-ttu-id="92004-193">你可以将其设置为 "**导入**" 或 "**部署**"。</span><span class="sxs-lookup"><span data-stu-id="92004-193">You can set this to **Import** or **Deploy**.</span></span> <span data-ttu-id="92004-194">**导入**选项用于基于现有数据库生成 .dbschema 文件，"**部署**" 选项用于将 .dbschema 文件部署到目标数据库。</span><span class="sxs-lookup"><span data-stu-id="92004-194">The **Import** option is used to generate a .dbschema file from an existing database, and the **Deploy** option is used to deploy a .dbschema file to a target database.</span></span>
- <span data-ttu-id="92004-195">**/Manifest** （或 **/ManifestFile**）开关标识你想要部署的 deploymanifest 文件。</span><span class="sxs-lookup"><span data-stu-id="92004-195">The **/manifest** (or **/ManifestFile**) switch identifies the .deploymanifest file you want to deploy.</span></span> <span data-ttu-id="92004-196">如果要改为使用 .dbschema 文件，请使用 **/model** （或 **/ModelFile**）开关。</span><span class="sxs-lookup"><span data-stu-id="92004-196">If you wanted to use the .dbschema file instead, you'd use the **/model** (or **/ModelFile**) switch.</span></span>
- <span data-ttu-id="92004-197">**/Cs** （或 **/ConnectionString**）开关提供目标数据库服务器的连接字符串。</span><span class="sxs-lookup"><span data-stu-id="92004-197">The **/cs** (or **/ConnectionString**) switch provides the connection string for the target database server.</span></span> <span data-ttu-id="92004-198">请注意，这不包括连接到服务器以&#x2014;创建数据库所需的数据库 VSDBCMD 的名称;不需要连接到单个数据库。</span><span class="sxs-lookup"><span data-stu-id="92004-198">Note that this doesn't include the name of the database&#x2014;VSDBCMD needs to connect to the server to create the database; it doesn't need to connect to an individual database.</span></span> <span data-ttu-id="92004-199">如果你的 deploymanifest 文件包含一个连接字符串，则可以省略此开关。</span><span class="sxs-lookup"><span data-stu-id="92004-199">If your .deploymanifest file includes a connection string, you can omit this switch.</span></span> <span data-ttu-id="92004-200">如果仍使用此开关，则开关值将覆盖. deploymanifest 值。</span><span class="sxs-lookup"><span data-stu-id="92004-200">If you use the switch anyway, the switch value will override the .deploymanifest value.</span></span>
- <span data-ttu-id="92004-201"><strong>/P： TargetDatabase</strong>属性提供要在创建时分配给目标数据库的名称。</span><span class="sxs-lookup"><span data-stu-id="92004-201">The <strong>/p:TargetDatabase</strong> property provides the name you want to assign to the target database on creation.</span></span> <span data-ttu-id="92004-202">这会重写 deploymanifest 文件中的<strong>TargetDatabase</strong>属性的值。</span><span class="sxs-lookup"><span data-stu-id="92004-202">This overrides the value of the <strong>TargetDatabase</strong> property in the .deploymanifest file.</span></span> <span data-ttu-id="92004-203">您可以使用<strong>/p：</strong> <em>[property name]</em>语法来设置各种部署属性，并覆盖在 sqlcmdvars 文件中声明的任何 SQLCMD 变量。</span><span class="sxs-lookup"><span data-stu-id="92004-203">You can use the <strong>/p:</strong> <em>[property name]</em>syntax to set a wide variety of deployment properties and to override any SQLCMD variables declared in your .sqlcmdvars file.</span></span>
- <span data-ttu-id="92004-204">**/Dd +** （或 **/DeployToDatabase +** ）开关指示你要创建部署并将其部署到目标环境。</span><span class="sxs-lookup"><span data-stu-id="92004-204">The **/dd+** (or **/DeployToDatabase+**) switch indicates that you want to create a deployment and deploy it to the target environment.</span></span> <span data-ttu-id="92004-205">如果指定 **/dd-** 或省略开关，VSDBCMD 将生成部署脚本，但不会将其部署到目标环境。</span><span class="sxs-lookup"><span data-stu-id="92004-205">If you specify **/dd-**, or omit the switch, VSDBCMD will generate a deployment script but will not deploy it to the target environment.</span></span> <span data-ttu-id="92004-206">此开关通常会造成混淆，下一部分将对此进行更详细的介绍。</span><span class="sxs-lookup"><span data-stu-id="92004-206">This switch is often the source of confusion and is explained in more detail in the next section.</span></span>
- <span data-ttu-id="92004-207">**/Script** （或 **/DeploymentScriptFile**）开关指定要在何处生成部署脚本。</span><span class="sxs-lookup"><span data-stu-id="92004-207">The **/script** (or **/DeploymentScriptFile**) switch specifies where you want to generate the deployment script.</span></span> <span data-ttu-id="92004-208">此值不影响部署过程。</span><span class="sxs-lookup"><span data-stu-id="92004-208">This value does not affect the deployment process.</span></span>

<span data-ttu-id="92004-209">有关 VSDBCMD 的详细信息，请参阅[VSDBCMD 的命令行参考。EXE （部署和架构导入）](https://msdn.microsoft.com/library/dd193283.aspx)和[如何：使用 VSDBCMD 从命令提示符准备要部署的数据库。EXE](https://msdn.microsoft.com/library/dd193258.aspx)。</span><span class="sxs-lookup"><span data-stu-id="92004-209">For more information on VSDBCMD, see [Command-Line Reference for VSDBCMD.EXE (Deployment and Schema Import)](https://msdn.microsoft.com/library/dd193283.aspx) and [How to: Prepare a Database for Deployment From a Command Prompt by Using VSDBCMD.EXE](https://msdn.microsoft.com/library/dd193258.aspx).</span></span>

<span data-ttu-id="92004-210">有关如何在 MSBuild 项目文件中使用 VSDBCMD 的示例，请参阅[了解生成过程](understanding-the-build-process.md)。</span><span class="sxs-lookup"><span data-stu-id="92004-210">For an example of how you can use VSDBCMD from an MSBuild project file, see [Understanding the Build Process](understanding-the-build-process.md).</span></span> <span data-ttu-id="92004-211">有关如何为多个环境配置数据库部署设置的示例，请参阅[自定义多个环境的数据库](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md)部署。</span><span class="sxs-lookup"><span data-stu-id="92004-211">For examples of how to configure database deployment settings for multiple environments, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span>

## <a name="understanding-the-deploytodatabase-switch"></a><span data-ttu-id="92004-212">了解 DeployToDatabase 开关</span><span class="sxs-lookup"><span data-stu-id="92004-212">Understanding the DeployToDatabase Switch</span></span>

<span data-ttu-id="92004-213">**/Dd**或 **/DeployToDatabase**开关的行为取决于是否对 .dbschema 文件或 deploymanifest 文件使用 VSDBCMD。</span><span class="sxs-lookup"><span data-stu-id="92004-213">The behavior of the **/dd** or **/DeployToDatabase** switch depends on whether you're using VSDBCMD with a .dbschema file or a .deploymanifest file.</span></span> <span data-ttu-id="92004-214">如果使用的是 .dbschema 文件，则行为相当简单：</span><span class="sxs-lookup"><span data-stu-id="92004-214">If you're using a .dbschema file, the behavior is fairly straightforward:</span></span>

- <span data-ttu-id="92004-215">如果指定 **/dd +** 或 **/Dd**，则 VSDBCMD 将生成部署脚本并部署数据库。</span><span class="sxs-lookup"><span data-stu-id="92004-215">If you specify **/dd+** or **/dd**, VSDBCMD will generate a deployment script and deploy the database.</span></span>
- <span data-ttu-id="92004-216">如果指定 **/dd-** 或省略开关，则 VSDBCMD 将仅生成部署脚本。</span><span class="sxs-lookup"><span data-stu-id="92004-216">If you specify **/dd-** or omit the switch, VSDBCMD will generate a deployment script only.</span></span>

<span data-ttu-id="92004-217">如果使用的是 deploymanifest 文件，则行为会更复杂一些。</span><span class="sxs-lookup"><span data-stu-id="92004-217">If you're using a .deploymanifest file, the behavior is a lot more complicated.</span></span> <span data-ttu-id="92004-218">这是因为，deploymanifest 文件包含属性名称**DeployToDatabase** ，该属性还可确定是否部署了数据库。</span><span class="sxs-lookup"><span data-stu-id="92004-218">This is because the .deploymanifest file contains a property name **DeployToDatabase** that also determines whether the database is deployed.</span></span>

[!code-xml[Main](deploying-database-projects/samples/sample2.xml)]

<span data-ttu-id="92004-219">根据数据库项目的属性设置此属性的值。</span><span class="sxs-lookup"><span data-stu-id="92004-219">The value of this property is set according to the properties of the database project.</span></span> <span data-ttu-id="92004-220">如果将 "**部署" 操作**设置为 "**创建部署脚本（.sql）** "，则此值将为**False**。</span><span class="sxs-lookup"><span data-stu-id="92004-220">If you set the **Deploy action** to **Create a deployment script (.sql)**, the value will be **False**.</span></span> <span data-ttu-id="92004-221">如果将 "**部署" 操作**设置为 "**创建部署脚本（.sql）" 并将其部署到数据库**，则值为**True**。</span><span class="sxs-lookup"><span data-stu-id="92004-221">If you set the **Deploy action** to **Create a deployment script (.sql) and deploy to the database**, the value will be **True**.</span></span>

> [!NOTE]
> <span data-ttu-id="92004-222">这些设置与特定的生成配置和平台相关联。</span><span class="sxs-lookup"><span data-stu-id="92004-222">These settings are associated with a specific build configuration and platform.</span></span> <span data-ttu-id="92004-223">例如，如果你配置了 "**调试**" 配置的设置，然后使用 "**发布**" 配置发布，则将不使用你的设置。</span><span class="sxs-lookup"><span data-stu-id="92004-223">For example, if you configure settings for the **Debug** configuration and then publish using the **Release** configuration, your settings will not be used.</span></span>

![](deploying-database-projects/_static/image3.png)

> [!NOTE]
> <span data-ttu-id="92004-224">在此方案中，应始终将 "**部署" 操作**设置为**创建部署脚本（.sql）** ，因为您不希望 Visual Studio 2010 部署您的数据库。</span><span class="sxs-lookup"><span data-stu-id="92004-224">In this scenario, the **Deploy action** should always be set to **Create a deployment script (.sql)**, because you don't want Visual Studio 2010 to deploy your database.</span></span> <span data-ttu-id="92004-225">换言之， **DeployToDatabase**属性应始终为**False**。</span><span class="sxs-lookup"><span data-stu-id="92004-225">In other words, the **DeployToDatabase** property should always be **False**.</span></span>

<span data-ttu-id="92004-226">指定**DeployToDatabase**属性后，如果属性值为**false**，则 **/dd**开关将仅重写属性：</span><span class="sxs-lookup"><span data-stu-id="92004-226">When a **DeployToDatabase** property is specified, the **/dd** switch will only override the property if the property value is **false**:</span></span>

- <span data-ttu-id="92004-227">如果**DeployToDatabase**属性为**False**，并且指定了 **/dd +** 或 **/dd**，则 VSDBCMD 将覆盖**DeployToDatabase**属性并部署数据库。</span><span class="sxs-lookup"><span data-stu-id="92004-227">If the **DeployToDatabase** property is **False**, and you specify **/dd+** or **/dd**, VSDBCMD will override the **DeployToDatabase** property and deploy the database.</span></span>
- <span data-ttu-id="92004-228">如果**DeployToDatabase**属性为**False**，则指定 **/dd-** 或省略开关时，VSDBCMD 将不会部署数据库。</span><span class="sxs-lookup"><span data-stu-id="92004-228">If the **DeployToDatabase** property is **False**, and you specify **/dd-** or omit the switch, VSDBCMD will not deploy the database.</span></span>
- <span data-ttu-id="92004-229">如果**DeployToDatabase**属性为**True**，则 VSDBCMD 将忽略此开关并部署数据库。</span><span class="sxs-lookup"><span data-stu-id="92004-229">If the **DeployToDatabase** property is **True**, VSDBCMD will ignore the switch and deploy the database.</span></span>
- <span data-ttu-id="92004-230">不管是否也要部署数据库，都将在每种情况下生成一个部署脚本。</span><span class="sxs-lookup"><span data-stu-id="92004-230">A deployment script is generated in each case, regardless of whether you're deploying the database as well.</span></span>

## <a name="conclusion"></a><span data-ttu-id="92004-231">结束语</span><span class="sxs-lookup"><span data-stu-id="92004-231">Conclusion</span></span>

<span data-ttu-id="92004-232">本主题概述了 Visual Studio 2010 中数据库项目的生成和部署过程。</span><span class="sxs-lookup"><span data-stu-id="92004-232">This topic provided an overview of the build and deployment process for database projects in Visual Studio 2010.</span></span> <span data-ttu-id="92004-233">还介绍了如何将 VSDBCMD 与 MSBuild 结合使用来支持企业规模的数据库部署。</span><span class="sxs-lookup"><span data-stu-id="92004-233">It also described how you can use VSDBCMD.exe with MSBuild to support enterprise-scale database deployment.</span></span>

<span data-ttu-id="92004-234">有关如何在实践中工作的详细信息，请参阅[自定义多个环境的数据库部署](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md)。</span><span class="sxs-lookup"><span data-stu-id="92004-234">For more information on how this works in practice, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span>

## <a name="further-reading"></a><span data-ttu-id="92004-235">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="92004-235">Further Reading</span></span>

<span data-ttu-id="92004-236">若要了解如何通过为每个环境创建单独的部署配置文件来自定义数据库部署，请参阅[自定义多个环境的数据库部署](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md)。</span><span class="sxs-lookup"><span data-stu-id="92004-236">For information on how to customize database deployments by creating a separate deployment configuration file for each environment, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span> <span data-ttu-id="92004-237">有关如何通过运行后期部署脚本来配置数据库角色成员身份的指导，请参阅将[数据库角色成员身份部署到测试环境](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md)。</span><span class="sxs-lookup"><span data-stu-id="92004-237">For guidance on how to configure database role memberships by running a post-deployment script, see [Deploying Database Role Memberships to Test Environments](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md).</span></span> <span data-ttu-id="92004-238">有关管理成员资格数据库所施加的一些独特挑战的指导，请参阅[将成员资格数据库部署到企业环境](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md)。</span><span class="sxs-lookup"><span data-stu-id="92004-238">For guidance on managing some of the unique challenges that membership databases impose, see [Deploying Membership Databases to Enterprise Environments](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md).</span></span>

<span data-ttu-id="92004-239">MSDN 上的这些主题提供了有关 Visual Studio 数据库项目和数据库部署过程的更广泛的指导和背景信息：</span><span class="sxs-lookup"><span data-stu-id="92004-239">These topics on MSDN provide broader guidance and background information on Visual Studio database projects and the database deployment process:</span></span>

- [<span data-ttu-id="92004-240">Visual Studio 2010 SQL Server 数据库项目</span><span class="sxs-lookup"><span data-stu-id="92004-240">Visual Studio 2010 SQL Server Database Projects</span></span>](https://msdn.microsoft.com/library/ff678491.aspx)
- [<span data-ttu-id="92004-241">管理数据库更改</span><span class="sxs-lookup"><span data-stu-id="92004-241">Managing Database Change</span></span>](https://msdn.microsoft.com/library/aa833404.aspx)
- [<span data-ttu-id="92004-242">如何：使用 VSDBCMD 从命令提示符准备要部署的数据库.EXE</span><span class="sxs-lookup"><span data-stu-id="92004-242">How to: Prepare a Database for Deployment From a Command Prompt by Using VSDBCMD.EXE</span></span>](https://msdn.microsoft.com/library/dd193258.aspx)
- [<span data-ttu-id="92004-243">数据库生成和部署概述</span><span class="sxs-lookup"><span data-stu-id="92004-243">An Overview of Database Build and Deployment</span></span>](https://msdn.microsoft.com/library/aa833165.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="92004-244">[上一页](deploying-web-packages.md)
> [下一页](creating-and-running-a-deployment-command-file.md)</span><span class="sxs-lookup"><span data-stu-id="92004-244">[Previous](deploying-web-packages.md)
[Next](creating-and-running-a-deployment-command-file.md)</span></span>
