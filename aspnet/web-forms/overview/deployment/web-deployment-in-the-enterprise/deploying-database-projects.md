---
uid: web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-database-projects
title: 部署数据库项目 |Microsoft Docs
author: jrjlee
description: 注意:在许多企业部署情况下，您需要能够将增量更新发布到已部署的数据库。 替代方法是重新创建...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 832f226a-1aa3-4093-8c29-ce4196793259
msc.legacyurl: /web-forms/overview/deployment/web-deployment-in-the-enterprise/deploying-database-projects
msc.type: authoredcontent
ms.openlocfilehash: f5b7cecdd1a8dbd9be1bd781cec31c53c9096546
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/09/2019
ms.locfileid: "59383214"
---
# <a name="deploying-database-projects"></a><span data-ttu-id="a72fd-104">部署数据库项目</span><span class="sxs-lookup"><span data-stu-id="a72fd-104">Deploying Database Projects</span></span>

<span data-ttu-id="a72fd-105">通过[Jason Lee](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="a72fd-105">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="a72fd-106">下载 PDF</span><span class="sxs-lookup"><span data-stu-id="a72fd-106">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> [!NOTE]
> <span data-ttu-id="a72fd-107">在许多企业部署情况下，您需要能够将增量更新发布到已部署的数据库。</span><span class="sxs-lookup"><span data-stu-id="a72fd-107">In lots of enterprise deployment scenarios, you need the ability to publish incremental updates to a deployed database.</span></span> <span data-ttu-id="a72fd-108">替代方法是重新创建每个部署，这意味着您丢失现有的数据库中的任何数据上的数据库。</span><span class="sxs-lookup"><span data-stu-id="a72fd-108">The alternative is to recreate the database on every deployment, which means you lose any data in the existing database.</span></span> <span data-ttu-id="a72fd-109">使用 Visual Studio 2010 时，使用 VSDBCMD 是增量数据库发布到建议的方法。</span><span class="sxs-lookup"><span data-stu-id="a72fd-109">When you work with Visual Studio 2010, using VSDBCMD is the recommended approach to incremental database publishing.</span></span> <span data-ttu-id="a72fd-110">但是，Visual Studio 和 Web 发布管道 (WPP) 的下一版本将包括支持增量发布直接的工具。</span><span class="sxs-lookup"><span data-stu-id="a72fd-110">However, the next version of Visual Studio and the Web Publishing Pipeline (WPP) will include tooling that supports incremental publishing directly.</span></span>


<span data-ttu-id="a72fd-111">如果您在 Visual Studio 2010 中打开联系人管理器示例解决方案，您将看到数据库项目包括一个包含四个文件的属性文件夹。</span><span class="sxs-lookup"><span data-stu-id="a72fd-111">If you open the Contact Manager sample solution in Visual Studio 2010, you'll see that the database project includes a Properties folder that contains four files.</span></span>

![](deploying-database-projects/_static/image1.png)

<span data-ttu-id="a72fd-112">与项目文件 (*ContactManager.Database.dbproj*这种情况下)，这些文件控制的生成和部署过程的各个方面：</span><span class="sxs-lookup"><span data-stu-id="a72fd-112">Together with the project file (*ContactManager.Database.dbproj* in this case), these files control various aspects of the build and deployment process:</span></span>

- <span data-ttu-id="a72fd-113">*Database.sqlcmdvars*文件提供在部署项目时使用的任何 SQLCMD 变量的值。</span><span class="sxs-lookup"><span data-stu-id="a72fd-113">The *Database.sqlcmdvars* file provides values for any SQLCMD variables you use when you deploy the project.</span></span> <span data-ttu-id="a72fd-114">每个解决方案配置 （例如，调试和发布） 可以指定不同.sqlcmdvars 文件。</span><span class="sxs-lookup"><span data-stu-id="a72fd-114">Each solution configuration (for example, debug and release) can specify a different .sqlcmdvars file.</span></span>
- <span data-ttu-id="a72fd-115">*Database.sqldeployment*文件提供了特定于部署的设置，例如是否使用在你的项目或目标服务器的排序规则中定义的排序规则是否要重新创建目标数据库。 每个时间，或者只需修改现有的数据库，以使其最新状态，等等。</span><span class="sxs-lookup"><span data-stu-id="a72fd-115">The *Database.sqldeployment* file provides deployment-specific settings, like whether to use the collation defined in your project or the collation of the destination server, whether to recreate the destination database every time or simply amend the existing database to bring it up to date, and so on.</span></span> <span data-ttu-id="a72fd-116">每个解决方案配置可以指定不同.sqldeployment 文件。</span><span class="sxs-lookup"><span data-stu-id="a72fd-116">Each solution configuration can specify a different .sqldeployment file.</span></span>
- <span data-ttu-id="a72fd-117">*Database.sqlpermissions*文件是可用于定义你想要添加到目标数据库的任何权限的 XML 文档。</span><span class="sxs-lookup"><span data-stu-id="a72fd-117">The *Database.sqlpermissions* file is an XML document that you can use to define any permissions you want to add to the target database.</span></span> <span data-ttu-id="a72fd-118">所有解决方案配置将都共享同一.sqlpermissions 文件。</span><span class="sxs-lookup"><span data-stu-id="a72fd-118">All solution configurations share the same .sqlpermissions file.</span></span>
- <span data-ttu-id="a72fd-119">*Database.sqlsettings*文件指定要创建的数据库，如要使用的比较运算符的行为和其他操作的排序规则时使用的数据库级别属性。</span><span class="sxs-lookup"><span data-stu-id="a72fd-119">The *Database.sqlsettings* file specifies the database-level properties to use when creating the database, like the collation to use, the behavior of comparison operators, and so on.</span></span> <span data-ttu-id="a72fd-120">所有解决方案配置将都共享同一.sqlsettings 文件。</span><span class="sxs-lookup"><span data-stu-id="a72fd-120">All solution configurations share the same .sqlsettings file.</span></span>

<span data-ttu-id="a72fd-121">有必要先了解一段时间来在 Visual Studio 中打开这些文件并使自己熟悉的内容。</span><span class="sxs-lookup"><span data-stu-id="a72fd-121">It's worth taking a moment to open these files in Visual Studio and familiarize yourself with the contents.</span></span>

<span data-ttu-id="a72fd-122">生成数据库项目时，生成过程创建两个文件：</span><span class="sxs-lookup"><span data-stu-id="a72fd-122">When you build a database project, the build process creates two files:</span></span>

- <span data-ttu-id="a72fd-123">一个*数据库架构*（.dbschema 文件）。</span><span class="sxs-lookup"><span data-stu-id="a72fd-123">A *database schema* (.dbschema file).</span></span> <span data-ttu-id="a72fd-124">这说明您想要以 XML 格式创建的数据库的架构。</span><span class="sxs-lookup"><span data-stu-id="a72fd-124">This describes the schema of the database you want to create in XML format.</span></span>
- <span data-ttu-id="a72fd-125">一个*部署清单*（.deploymanifest 文件）。</span><span class="sxs-lookup"><span data-stu-id="a72fd-125">A *deployment manifest* (.deploymanifest file).</span></span> <span data-ttu-id="a72fd-126">其中包含创建和部署你的数据库所需的所有信息。</span><span class="sxs-lookup"><span data-stu-id="a72fd-126">This contains all the information required to create and deploy your database.</span></span> <span data-ttu-id="a72fd-127">它引用.dbschema 文件以及其他资源，如部署说明 （.sqldeployment 文件） 和任何预先部署或后期部署 SQL 脚本。</span><span class="sxs-lookup"><span data-stu-id="a72fd-127">It references the .dbschema file along with other resources, like the deployment instructions (the .sqldeployment file) and any pre-deployment or post-deployment SQL scripts.</span></span>

<span data-ttu-id="a72fd-128">这显示了这些资源之间的关系：</span><span class="sxs-lookup"><span data-stu-id="a72fd-128">This shows the relationship between these resources:</span></span>

![](deploying-database-projects/_static/image2.png)

<span data-ttu-id="a72fd-129">如您所见，.sqlsettings 文件和.sqlpermissions 文件将是生成过程的输入。</span><span class="sxs-lookup"><span data-stu-id="a72fd-129">As you can see, the .sqlsettings file and the .sqlpermissions file are inputs to the build process.</span></span> <span data-ttu-id="a72fd-130">数据库项目文件，以及这些文件用于创建数据库架构文件。</span><span class="sxs-lookup"><span data-stu-id="a72fd-130">Along with the database project file, these files are used to create the database schema file.</span></span> <span data-ttu-id="a72fd-131">.Sqldeployment 文件和.sqlcmdvars 文件传递整个生成过程保持不变。</span><span class="sxs-lookup"><span data-stu-id="a72fd-131">The .sqldeployment file and the .sqlcmdvars file pass through the build process unchanged.</span></span> <span data-ttu-id="a72fd-132">部署清单指示的数据库架构、.sqldeployment 文件、.sqlcmdvars 文件和任何预先部署或后期部署 SQL 脚本的位置。</span><span class="sxs-lookup"><span data-stu-id="a72fd-132">The deployment manifest indicates the location of the database schema, the .sqldeployment file, the .sqlcmdvars file, and any pre-deployment or post-deployment SQL scripts.</span></span>

## <a name="why-use-vsdbcmd-to-deploy-a-database-project"></a><span data-ttu-id="a72fd-133">为什么使用 VSDBCMD 来部署数据库项目？</span><span class="sxs-lookup"><span data-stu-id="a72fd-133">Why Use VSDBCMD to Deploy a Database Project?</span></span>

<span data-ttu-id="a72fd-134">有各种不同方法可用于部署数据库项目。</span><span class="sxs-lookup"><span data-stu-id="a72fd-134">There are various different approaches to deploying database projects.</span></span> <span data-ttu-id="a72fd-135">但是，并非所有都适用于将数据库项目部署到企业环境中的远程服务器。</span><span class="sxs-lookup"><span data-stu-id="a72fd-135">However, not all of them are suitable for deploying a database project to remote servers in an enterprise environment.</span></span> <span data-ttu-id="a72fd-136">请考虑希望从数据库项目部署。</span><span class="sxs-lookup"><span data-stu-id="a72fd-136">Consider what you want from a database project deployment.</span></span> <span data-ttu-id="a72fd-137">在企业部署方案中，您可能希望：</span><span class="sxs-lookup"><span data-stu-id="a72fd-137">In enterprise deployment scenarios, you're likely to want:</span></span>

- <span data-ttu-id="a72fd-138">部署数据库项目从远程位置的功能。</span><span class="sxs-lookup"><span data-stu-id="a72fd-138">The ability to deploy the database project from a remote location.</span></span>
- <span data-ttu-id="a72fd-139">向现有数据库进行增量更新的功能。</span><span class="sxs-lookup"><span data-stu-id="a72fd-139">The ability to make incremental updates to an existing database.</span></span>
- <span data-ttu-id="a72fd-140">包含预先部署脚本或后期部署脚本功能。</span><span class="sxs-lookup"><span data-stu-id="a72fd-140">The ability to include pre-deployment scripts or post-deployment scripts.</span></span>
- <span data-ttu-id="a72fd-141">能够定制部署到多个目标环境。</span><span class="sxs-lookup"><span data-stu-id="a72fd-141">The ability to tailor the deployment to multiple destination environments.</span></span>
- <span data-ttu-id="a72fd-142">部署数据库项目的较大、 一部分的能力通常编写脚本，单步执行解决方案部署。</span><span class="sxs-lookup"><span data-stu-id="a72fd-142">The ability to deploy the database project as part of a larger, typically scripted, single-step solution deployment.</span></span>

<span data-ttu-id="a72fd-143">有三种主要方法可用于部署数据库项目：</span><span class="sxs-lookup"><span data-stu-id="a72fd-143">There are three main approaches you can use to deploy a database project:</span></span>

- <span data-ttu-id="a72fd-144">可使用 Visual Studio 2010 中的数据库项目类型的部署功能。</span><span class="sxs-lookup"><span data-stu-id="a72fd-144">You can use the deployment functionality with the database project type in Visual Studio 2010.</span></span> <span data-ttu-id="a72fd-145">当生成和部署数据库项目在 Visual Studio 2010 中的时，部署过程将使用部署清单来生成特定于生成配置的基于 SQL 的部署文件。</span><span class="sxs-lookup"><span data-stu-id="a72fd-145">When you build and deploy a database project in Visual Studio 2010, the deployment process uses the deployment manifest to generate a SQL-based deployment file specific to the build configuration.</span></span> <span data-ttu-id="a72fd-146">如果它已不存在，或者如果已存在对数据库进行任何必要的更改，这将创建数据库。</span><span class="sxs-lookup"><span data-stu-id="a72fd-146">This will create the database if it doesn't already exist or make any necessary changes to the database if it does already exist.</span></span> <span data-ttu-id="a72fd-147">可以使用 SQLCMD.exe 来运行此文件在目标服务器上，或者可以设置 Visual Studio 创建和运行该文件。</span><span class="sxs-lookup"><span data-stu-id="a72fd-147">You can use SQLCMD.exe to run this file on your destination server, or you can set Visual Studio to create and run the file.</span></span> <span data-ttu-id="a72fd-148">此方法的缺点是，你只能有限地控制部署设置。</span><span class="sxs-lookup"><span data-stu-id="a72fd-148">The disadvantage of this approach is that you have only limited control over the deployment settings.</span></span> <span data-ttu-id="a72fd-149">通常还可能需要修改 SQL 部署文件，以提供特定于环境的变量值。</span><span class="sxs-lookup"><span data-stu-id="a72fd-149">You may often also need to modify the SQL deployment file to provide environment-specific variable values.</span></span> <span data-ttu-id="a72fd-150">使用 Visual Studio 2010 安装，只能使用此方法从一台计算机，而开发人员需要知道并为所有目标环境中提供连接字符串和凭据。</span><span class="sxs-lookup"><span data-stu-id="a72fd-150">You can only use this approach from a computer with Visual Studio 2010 installed, and the developer would need to know and provide connection strings and credentials for all destination environments.</span></span>
- <span data-ttu-id="a72fd-151">您可以使用 Internet 信息服务 (IIS) Web 部署工具 （Web 部署） 到[将数据库部署为 web 应用程序项目的一部分](https://msdn.microsoft.com/library/dd465343.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a72fd-151">You can use the Internet Information Services (IIS) Web Deployment Tool (Web Deploy) to [deploy a database as part of a web application project](https://msdn.microsoft.com/library/dd465343.aspx).</span></span> <span data-ttu-id="a72fd-152">但是，这种方法是更复杂，如果你想要部署数据库项目而不只是复制的目标服务器上的现有本地数据库。</span><span class="sxs-lookup"><span data-stu-id="a72fd-152">However, this approach is a lot more complex if you want to deploy a database project rather than simply replicate an existing local database on a destination server.</span></span> <span data-ttu-id="a72fd-153">可以配置 Web 部署运行的 SQL 部署脚本中生成数据库项目，但是，为了执行此操作，您需要创建你的 web 应用程序项目的自定义 WPP 目标文件。</span><span class="sxs-lookup"><span data-stu-id="a72fd-153">You can configure Web Deploy to run the SQL deployment script that the database project generates, but in order to do this, you need to create a custom WPP targets file for your web application project.</span></span> <span data-ttu-id="a72fd-154">这将添加大量复杂的部署过程。</span><span class="sxs-lookup"><span data-stu-id="a72fd-154">This adds a substantial amount of complexity to the deployment process.</span></span> <span data-ttu-id="a72fd-155">此外，Web 部署不直接支持增量更新到现有的数据库。</span><span class="sxs-lookup"><span data-stu-id="a72fd-155">In addition, Web Deploy does not directly support incremental updates to existing databases.</span></span> <span data-ttu-id="a72fd-156">这种方法的详细信息，请参阅[扩展到包的数据库项目的 Web 发布管道部署 SQL 文件](https://go.microsoft.com/?linkid=9805121)。</span><span class="sxs-lookup"><span data-stu-id="a72fd-156">For more information on this approach, see [Extending the Web Publishing Pipeline to package database project deployed SQL file](https://go.microsoft.com/?linkid=9805121).</span></span>
- <span data-ttu-id="a72fd-157">VSDBCMD 实用程序可用于部署的数据库，使用数据库架构或部署清单。</span><span class="sxs-lookup"><span data-stu-id="a72fd-157">You can use the VSDBCMD utility to deploy the database, using either the database schema or the deployment manifest.</span></span> <span data-ttu-id="a72fd-158">可以从 MSBuild 目标，这样就可以将数据库发布作为较大的脚本化部署过程的一部分调用 VSDBCMD.exe。</span><span class="sxs-lookup"><span data-stu-id="a72fd-158">You can call VSDBCMD.exe from an MSBuild target, which lets you publish databases as part of a larger, scripted deployment process.</span></span> <span data-ttu-id="a72fd-159">您可以重写.sqlcmdvars 文件和大量 VSDBCMD 命令，以便您可以自定义而无需创建多个生成配置的不同环境的部署中其他数据库的属性中的变量。</span><span class="sxs-lookup"><span data-stu-id="a72fd-159">You can override the variables in your .sqlcmdvars file and lots of other database properties from a VSDBCMD command, which allows you to customize your deployment for different environments without creating multiple build configurations.</span></span> <span data-ttu-id="a72fd-160">VSDBCMD 提供差异化功能，这意味着它将仅对齐具有您的数据库架构的目标数据库的必要更改。</span><span class="sxs-lookup"><span data-stu-id="a72fd-160">VSDBCMD provides differentiation functionality, which means it will make only the necessary changes to align a destination database with your database schema.</span></span> <span data-ttu-id="a72fd-161">VSDBCMD 还提供了各种命令行选项，让你精细控制部署过程。</span><span class="sxs-lookup"><span data-stu-id="a72fd-161">VSDBCMD also offers a wide range of command-line options, which give you fine-grained control over the deployment process.</span></span>

<span data-ttu-id="a72fd-162">此概述中，从您所见，MSBuild 中使用 VSDBCMD 是典型的企业部署方案最适合的方法：</span><span class="sxs-lookup"><span data-stu-id="a72fd-162">From this overview, you can see that using VSDBCMD with MSBuild is the approach best suited to a typical enterprise deployment scenario:</span></span>

|  | <span data-ttu-id="a72fd-163">Visual Studio 2010</span><span class="sxs-lookup"><span data-stu-id="a72fd-163">Visual Studio 2010</span></span> | <span data-ttu-id="a72fd-164">Web Deploy 2.0</span><span class="sxs-lookup"><span data-stu-id="a72fd-164">Web Deploy 2.0</span></span> | <span data-ttu-id="a72fd-165">VSDBCMD.exe</span><span class="sxs-lookup"><span data-stu-id="a72fd-165">VSDBCMD.exe</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="a72fd-166">支持远程部署？</span><span class="sxs-lookup"><span data-stu-id="a72fd-166">Supports remote deployment?</span></span> | <span data-ttu-id="a72fd-167">是</span><span class="sxs-lookup"><span data-stu-id="a72fd-167">Yes</span></span> | <span data-ttu-id="a72fd-168">是</span><span class="sxs-lookup"><span data-stu-id="a72fd-168">Yes</span></span> | <span data-ttu-id="a72fd-169">是</span><span class="sxs-lookup"><span data-stu-id="a72fd-169">Yes</span></span> |
| <span data-ttu-id="a72fd-170">支持增量更新？</span><span class="sxs-lookup"><span data-stu-id="a72fd-170">Supports incremental updates?</span></span> | <span data-ttu-id="a72fd-171">是</span><span class="sxs-lookup"><span data-stu-id="a72fd-171">Yes</span></span> | <span data-ttu-id="a72fd-172">No</span><span class="sxs-lookup"><span data-stu-id="a72fd-172">No</span></span> | <span data-ttu-id="a72fd-173">是</span><span class="sxs-lookup"><span data-stu-id="a72fd-173">Yes</span></span> |
| <span data-ttu-id="a72fd-174">支持预先部署/后期部署脚本？</span><span class="sxs-lookup"><span data-stu-id="a72fd-174">Supports pre/post-deployment scripts?</span></span> | <span data-ttu-id="a72fd-175">是</span><span class="sxs-lookup"><span data-stu-id="a72fd-175">Yes</span></span> | <span data-ttu-id="a72fd-176">是</span><span class="sxs-lookup"><span data-stu-id="a72fd-176">Yes</span></span> | <span data-ttu-id="a72fd-177">是</span><span class="sxs-lookup"><span data-stu-id="a72fd-177">Yes</span></span> |
| <span data-ttu-id="a72fd-178">支持多环境部署？</span><span class="sxs-lookup"><span data-stu-id="a72fd-178">Supports multi-environment deployment?</span></span> | <span data-ttu-id="a72fd-179">有限</span><span class="sxs-lookup"><span data-stu-id="a72fd-179">Limited</span></span> | <span data-ttu-id="a72fd-180">有限</span><span class="sxs-lookup"><span data-stu-id="a72fd-180">Limited</span></span> | <span data-ttu-id="a72fd-181">是</span><span class="sxs-lookup"><span data-stu-id="a72fd-181">Yes</span></span> |
| <span data-ttu-id="a72fd-182">支持脚本化的部署？</span><span class="sxs-lookup"><span data-stu-id="a72fd-182">Supports scripted deployment?</span></span> | <span data-ttu-id="a72fd-183">有限</span><span class="sxs-lookup"><span data-stu-id="a72fd-183">Limited</span></span> | <span data-ttu-id="a72fd-184">是</span><span class="sxs-lookup"><span data-stu-id="a72fd-184">Yes</span></span> | <span data-ttu-id="a72fd-185">是</span><span class="sxs-lookup"><span data-stu-id="a72fd-185">Yes</span></span> |

<span data-ttu-id="a72fd-186">此主题的其余部分介绍如何使用 MSBuild 来部署数据库项目 VSDBCMD 使用。</span><span class="sxs-lookup"><span data-stu-id="a72fd-186">The remainder of this topic describes the use of VSDBCMD with MSBuild to deploy database projects.</span></span>

## <a name="understanding-the-deployment-process"></a><span data-ttu-id="a72fd-187">了解部署过程</span><span class="sxs-lookup"><span data-stu-id="a72fd-187">Understanding the Deployment Process</span></span>

<span data-ttu-id="a72fd-188">VSDBCMD 实用程序允许你部署使用的数据库架构 （.dbschema 文件） 或部署清单 （.deploymanifest 文件） 的数据库。</span><span class="sxs-lookup"><span data-stu-id="a72fd-188">The VSDBCMD utility lets you deploy a database using either the database schema (the .dbschema file) or the deployment manifest (the .deploymanifest file).</span></span> <span data-ttu-id="a72fd-189">在实践中，您几乎总是将使用部署清单，如部署清单允许您为部署的各种属性提供默认值并确定你想要运行任何预先部署或后期部署 SQL 脚本。</span><span class="sxs-lookup"><span data-stu-id="a72fd-189">In practice, you'll almost always use the deployment manifest, as the deployment manifest lets you provide default values for various deployment properties and identify any pre-deployment or post-deployment SQL scripts you want to run.</span></span> <span data-ttu-id="a72fd-190">例如，使用此 VSDBCMD 命令来部署**ContactManager**数据库添加到测试环境中的数据库服务器：</span><span class="sxs-lookup"><span data-stu-id="a72fd-190">For example, this VSDBCMD command is used to deploy the **ContactManager** database to a database server in a test environment:</span></span>


[!code-console[Main](deploying-database-projects/samples/sample1.cmd)]


<span data-ttu-id="a72fd-191">这种情况下：</span><span class="sxs-lookup"><span data-stu-id="a72fd-191">In this case:</span></span>

- <span data-ttu-id="a72fd-192">**/A** (或 **/Action**) 开关可指定希望 VSDBCMD 来执行操作。</span><span class="sxs-lookup"><span data-stu-id="a72fd-192">The **/a** (or **/Action**) switch specifies what you want VSDBCMD to do.</span></span> <span data-ttu-id="a72fd-193">可以将此设置为**导入**或**部署**。</span><span class="sxs-lookup"><span data-stu-id="a72fd-193">You can set this to **Import** or **Deploy**.</span></span> <span data-ttu-id="a72fd-194">**导入**选项用于生成.dbschema 文件从现有数据库，并**部署**选项用于将.dbschema 文件部署到目标数据库。</span><span class="sxs-lookup"><span data-stu-id="a72fd-194">The **Import** option is used to generate a .dbschema file from an existing database, and the **Deploy** option is used to deploy a .dbschema file to a target database.</span></span>
- <span data-ttu-id="a72fd-195">**/Manifest** (或**了 /ManifestFile**) 开关标识你想要部署的.deploymanifest 文件。</span><span class="sxs-lookup"><span data-stu-id="a72fd-195">The **/manifest** (or **/ManifestFile**) switch identifies the .deploymanifest file you want to deploy.</span></span> <span data-ttu-id="a72fd-196">如果你想要改为使用.dbschema 文件，则可以使用 **/model** (或 **/ModelFile**) 切换。</span><span class="sxs-lookup"><span data-stu-id="a72fd-196">If you wanted to use the .dbschema file instead, you'd use the **/model** (or **/ModelFile**) switch.</span></span>
- <span data-ttu-id="a72fd-197">**/Cs** (或 **/ConnectionString**) 交换机提供对目标数据库服务器的连接字符串。</span><span class="sxs-lookup"><span data-stu-id="a72fd-197">The **/cs** (or **/ConnectionString**) switch provides the connection string for the target database server.</span></span> <span data-ttu-id="a72fd-198">请注意，这并不包含的数据库的名称&#x2014;VSDBCMD 需要连接到服务器，以创建该数据库。它不需要连接到单个数据库。</span><span class="sxs-lookup"><span data-stu-id="a72fd-198">Note that this doesn't include the name of the database&#x2014;VSDBCMD needs to connect to the server to create the database; it doesn't need to connect to an individual database.</span></span> <span data-ttu-id="a72fd-199">如果.deploymanifest 文件包括一个连接字符串，则可以省略此开关。</span><span class="sxs-lookup"><span data-stu-id="a72fd-199">If your .deploymanifest file includes a connection string, you can omit this switch.</span></span> <span data-ttu-id="a72fd-200">如果您仍要使用开关，开关值将覆盖.deploymanifest 值。</span><span class="sxs-lookup"><span data-stu-id="a72fd-200">If you use the switch anyway, the switch value will override the .deploymanifest value.</span></span>
- <span data-ttu-id="a72fd-201"><strong>/P:TargetDatabase</strong>属性提供你想要分配到目标数据库上创建的名称。</span><span class="sxs-lookup"><span data-stu-id="a72fd-201">The <strong>/p:TargetDatabase</strong> property provides the name you want to assign to the target database on creation.</span></span> <span data-ttu-id="a72fd-202">这会重写的值<strong>TargetDatabase</strong> .deploymanifest 文件中的属性。</span><span class="sxs-lookup"><span data-stu-id="a72fd-202">This overrides the value of the <strong>TargetDatabase</strong> property in the .deploymanifest file.</span></span> <span data-ttu-id="a72fd-203">可以使用<strong>/p:</strong> <em>[属性名称]</em>.sqlcmdvars 文件中声明的语法来设置各种部署属性并覆盖任何 SQLCMD 变量。</span><span class="sxs-lookup"><span data-stu-id="a72fd-203">You can use the <strong>/p:</strong> <em>[property name]</em>syntax to set a wide variety of deployment properties and to override any SQLCMD variables declared in your .sqlcmdvars file.</span></span>
- <span data-ttu-id="a72fd-204">**/Dd+** (或 **/DeployToDatabase+**) 开关指示你想要创建部署，并将其部署到目标环境。</span><span class="sxs-lookup"><span data-stu-id="a72fd-204">The **/dd+** (or **/DeployToDatabase+**) switch indicates that you want to create a deployment and deploy it to the target environment.</span></span> <span data-ttu-id="a72fd-205">如果指定 **/dd-**，或省略开关，VSDBCMD 将生成部署脚本，但将不将其部署到目标环境。</span><span class="sxs-lookup"><span data-stu-id="a72fd-205">If you specify **/dd-**, or omit the switch, VSDBCMD will generate a deployment script but will not deploy it to the target environment.</span></span> <span data-ttu-id="a72fd-206">此开关通常是困惑的源下, 一节中更详细地介绍。</span><span class="sxs-lookup"><span data-stu-id="a72fd-206">This switch is often the source of confusion and is explained in more detail in the next section.</span></span>
- <span data-ttu-id="a72fd-207">**/Script** (或 **/DeploymentScriptFile**) 开关指定你想要生成部署脚本。</span><span class="sxs-lookup"><span data-stu-id="a72fd-207">The **/script** (or **/DeploymentScriptFile**) switch specifies where you want to generate the deployment script.</span></span> <span data-ttu-id="a72fd-208">此值不会影响部署过程。</span><span class="sxs-lookup"><span data-stu-id="a72fd-208">This value does not affect the deployment process.</span></span>

<span data-ttu-id="a72fd-209">VSDBCMD 的详细信息，请参阅[VSDBCMD 的命令行参考。EXE （部署和架构导入）](https://msdn.microsoft.com/library/dd193283.aspx)和[如何：为准备数据库部署从命令提示符下使用 VSDBCMD。EXE](https://msdn.microsoft.com/library/dd193258.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a72fd-209">For more information on VSDBCMD, see [Command-Line Reference for VSDBCMD.EXE (Deployment and Schema Import)](https://msdn.microsoft.com/library/dd193283.aspx) and [How to: Prepare a Database for Deployment From a Command Prompt by Using VSDBCMD.EXE](https://msdn.microsoft.com/library/dd193258.aspx).</span></span>

<span data-ttu-id="a72fd-210">有关如何使用 VSDBCMD 从 MSBuild 项目文件的示例，请参阅[了解构建过程](understanding-the-build-process.md)。</span><span class="sxs-lookup"><span data-stu-id="a72fd-210">For an example of how you can use VSDBCMD from an MSBuild project file, see [Understanding the Build Process](understanding-the-build-process.md).</span></span> <span data-ttu-id="a72fd-211">有关如何配置数据库部署设置多个环境的示例，请参阅[多个环境自定义数据库部署](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md)。</span><span class="sxs-lookup"><span data-stu-id="a72fd-211">For examples of how to configure database deployment settings for multiple environments, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span>

## <a name="understanding-the-deploytodatabase-switch"></a><span data-ttu-id="a72fd-212">了解 DeployToDatabase 开关</span><span class="sxs-lookup"><span data-stu-id="a72fd-212">Understanding the DeployToDatabase Switch</span></span>

<span data-ttu-id="a72fd-213">行为 **/dd**或 **/DeployToDatabase**开关取决于是否使用 VSDBCMD.dbschema 文件或.deploymanifest 文件。</span><span class="sxs-lookup"><span data-stu-id="a72fd-213">The behavior of the **/dd** or **/DeployToDatabase** switch depends on whether you're using VSDBCMD with a .dbschema file or a .deploymanifest file.</span></span> <span data-ttu-id="a72fd-214">如果您使用.dbschema 文件，则行为是非常简单：</span><span class="sxs-lookup"><span data-stu-id="a72fd-214">If you're using a .dbschema file, the behavior is fairly straightforward:</span></span>

- <span data-ttu-id="a72fd-215">如果指定 **/dd+** 或 **/dd**，VSDBCMD 将生成部署脚本和部署数据库。</span><span class="sxs-lookup"><span data-stu-id="a72fd-215">If you specify **/dd+** or **/dd**, VSDBCMD will generate a deployment script and deploy the database.</span></span>
- <span data-ttu-id="a72fd-216">如果指定 **/dd-** 或省略开关，VSDBCMD 将生成部署脚本。</span><span class="sxs-lookup"><span data-stu-id="a72fd-216">If you specify **/dd-** or omit the switch, VSDBCMD will generate a deployment script only.</span></span>

<span data-ttu-id="a72fd-217">如果您使用.deploymanifest 文件，则行为是复杂得多。</span><span class="sxs-lookup"><span data-stu-id="a72fd-217">If you're using a .deploymanifest file, the behavior is a lot more complicated.</span></span> <span data-ttu-id="a72fd-218">这是因为.deploymanifest 文件包含属性名称**DeployToDatabase** ，它还确定是否部署该数据库。</span><span class="sxs-lookup"><span data-stu-id="a72fd-218">This is because the .deploymanifest file contains a property name **DeployToDatabase** that also determines whether the database is deployed.</span></span>


[!code-xml[Main](deploying-database-projects/samples/sample2.xml)]


<span data-ttu-id="a72fd-219">根据数据库项目的属性设置此属性的值。</span><span class="sxs-lookup"><span data-stu-id="a72fd-219">The value of this property is set according to the properties of the database project.</span></span> <span data-ttu-id="a72fd-220">如果您设置**部署操作**到**创建部署脚本 (.sql)**，值将是**False**。</span><span class="sxs-lookup"><span data-stu-id="a72fd-220">If you set the **Deploy action** to **Create a deployment script (.sql)**, the value will be **False**.</span></span> <span data-ttu-id="a72fd-221">如果您设置**部署操作**到**创建部署脚本 (.sql) 并将其部署到数据库**，值将是**True**。</span><span class="sxs-lookup"><span data-stu-id="a72fd-221">If you set the **Deploy action** to **Create a deployment script (.sql) and deploy to the database**, the value will be **True**.</span></span>

> [!NOTE]
> <span data-ttu-id="a72fd-222">这些设置与相关联的特定生成配置和平台。</span><span class="sxs-lookup"><span data-stu-id="a72fd-222">These settings are associated with a specific build configuration and platform.</span></span> <span data-ttu-id="a72fd-223">例如，如果你配置的设置**调试**配置，然后将发布使用**发行**配置中，不会使用你的设置。</span><span class="sxs-lookup"><span data-stu-id="a72fd-223">For example, if you configure settings for the **Debug** configuration and then publish using the **Release** configuration, your settings will not be used.</span></span>


![](deploying-database-projects/_static/image3.png)

> [!NOTE]
> <span data-ttu-id="a72fd-224">在此方案中，**部署操作**应始终设置为**创建部署脚本 (.sql)**，因为您不希望 Visual Studio 2010 将数据库部署。</span><span class="sxs-lookup"><span data-stu-id="a72fd-224">In this scenario, the **Deploy action** should always be set to **Create a deployment script (.sql)**, because you don't want Visual Studio 2010 to deploy your database.</span></span> <span data-ttu-id="a72fd-225">换而言之， **DeployToDatabase**属性应始终为**False**。</span><span class="sxs-lookup"><span data-stu-id="a72fd-225">In other words, the **DeployToDatabase** property should always be **False**.</span></span>


<span data-ttu-id="a72fd-226">当**DeployToDatabase**指定属性，则 **/dd**开关将仅重写属性的属性值是否**false**:</span><span class="sxs-lookup"><span data-stu-id="a72fd-226">When a **DeployToDatabase** property is specified, the **/dd** switch will only override the property if the property value is **false**:</span></span>

- <span data-ttu-id="a72fd-227">如果**DeployToDatabase**属性是**False**，并指定 **/dd+** 或 **/dd**，将覆盖 VSDBCMD **DeployToDatabase**属性并将其部署数据库。</span><span class="sxs-lookup"><span data-stu-id="a72fd-227">If the **DeployToDatabase** property is **False**, and you specify **/dd+** or **/dd**, VSDBCMD will override the **DeployToDatabase** property and deploy the database.</span></span>
- <span data-ttu-id="a72fd-228">如果**DeployToDatabase**属性是**False**，并指定 **/dd-** 或省略开关，VSDBCMD 不会将部署数据库。</span><span class="sxs-lookup"><span data-stu-id="a72fd-228">If the **DeployToDatabase** property is **False**, and you specify **/dd-** or omit the switch, VSDBCMD will not deploy the database.</span></span>
- <span data-ttu-id="a72fd-229">如果**DeployToDatabase**属性是**True**，VSDBCMD 将忽略此开关并将数据库部署。</span><span class="sxs-lookup"><span data-stu-id="a72fd-229">If the **DeployToDatabase** property is **True**, VSDBCMD will ignore the switch and deploy the database.</span></span>
- <span data-ttu-id="a72fd-230">每种情况下，而不考虑是否要部署数据库以及生成部署脚本。</span><span class="sxs-lookup"><span data-stu-id="a72fd-230">A deployment script is generated in each case, regardless of whether you're deploying the database as well.</span></span>

## <a name="conclusion"></a><span data-ttu-id="a72fd-231">结束语</span><span class="sxs-lookup"><span data-stu-id="a72fd-231">Conclusion</span></span>

<span data-ttu-id="a72fd-232">本主题提供有关 Visual Studio 2010 中的数据库项目生成和部署过程的概述。</span><span class="sxs-lookup"><span data-stu-id="a72fd-232">This topic provided an overview of the build and deployment process for database projects in Visual Studio 2010.</span></span> <span data-ttu-id="a72fd-233">它还介绍了如何使用 VSDBCMD.exe 使用 MSBuild 来支持企业级数据库部署。</span><span class="sxs-lookup"><span data-stu-id="a72fd-233">It also described how you can use VSDBCMD.exe with MSBuild to support enterprise-scale database deployment.</span></span>

<span data-ttu-id="a72fd-234">这在实践中的工作方式的详细信息，请参阅[多个环境自定义数据库部署](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md)。</span><span class="sxs-lookup"><span data-stu-id="a72fd-234">For more information on how this works in practice, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span>

## <a name="further-reading"></a><span data-ttu-id="a72fd-235">其他阅读材料</span><span class="sxs-lookup"><span data-stu-id="a72fd-235">Further Reading</span></span>

<span data-ttu-id="a72fd-236">有关如何通过创建单独的部署配置文件为每个环境自定义数据库部署的信息，请参阅[多个环境自定义数据库部署](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md)。</span><span class="sxs-lookup"><span data-stu-id="a72fd-236">For information on how to customize database deployments by creating a separate deployment configuration file for each environment, see [Customizing Database Deployments for Multiple Environments](../advanced-enterprise-web-deployment/customizing-database-deployments-for-multiple-environments.md).</span></span> <span data-ttu-id="a72fd-237">有关如何通过运行后期部署脚本来配置数据库角色成员身份的指导，请参阅[到测试环境中部署数据库角色成员](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md)。</span><span class="sxs-lookup"><span data-stu-id="a72fd-237">For guidance on how to configure database role memberships by running a post-deployment script, see [Deploying Database Role Memberships to Test Environments](../advanced-enterprise-web-deployment/deploying-database-role-memberships-to-test-environments.md).</span></span> <span data-ttu-id="a72fd-238">数据库施加有关该成员身份管理一些独特的挑战的指南，请参阅[的成员资格数据库部署到企业环境](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md)。</span><span class="sxs-lookup"><span data-stu-id="a72fd-238">For guidance on managing some of the unique challenges that membership databases impose, see [Deploying Membership Databases to Enterprise Environments](../advanced-enterprise-web-deployment/deploying-membership-databases-to-enterprise-environments.md).</span></span>

<span data-ttu-id="a72fd-239">MSDN 上的以下主题提供更广泛的指南和 Visual Studio 数据库项目的背景信息和数据库部署过程：</span><span class="sxs-lookup"><span data-stu-id="a72fd-239">These topics on MSDN provide broader guidance and background information on Visual Studio database projects and the database deployment process:</span></span>

- [<span data-ttu-id="a72fd-240">Visual Studio 2010 SQL Server 数据库项目</span><span class="sxs-lookup"><span data-stu-id="a72fd-240">Visual Studio 2010 SQL Server Database Projects</span></span>](https://msdn.microsoft.com/library/ff678491.aspx)
- [<span data-ttu-id="a72fd-241">管理数据库更改</span><span class="sxs-lookup"><span data-stu-id="a72fd-241">Managing Database Change</span></span>](https://msdn.microsoft.com/library/aa833404.aspx)
- [<span data-ttu-id="a72fd-242">如何：为准备数据库部署从命令提示符下使用 VSDBCMD。EXE</span><span class="sxs-lookup"><span data-stu-id="a72fd-242">How to: Prepare a Database for Deployment From a Command Prompt by Using VSDBCMD.EXE</span></span>](https://msdn.microsoft.com/library/dd193258.aspx)
- [<span data-ttu-id="a72fd-243">数据库生成和部署的概述</span><span class="sxs-lookup"><span data-stu-id="a72fd-243">An Overview of Database Build and Deployment</span></span>](https://msdn.microsoft.com/library/aa833165.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="a72fd-244">[上一页](deploying-web-packages.md)
> [下一页](creating-and-running-a-deployment-command-file.md)</span><span class="sxs-lookup"><span data-stu-id="a72fd-244">[Previous](deploying-web-packages.md)
[Next](creating-and-running-a-deployment-command-file.md)</span></span>
