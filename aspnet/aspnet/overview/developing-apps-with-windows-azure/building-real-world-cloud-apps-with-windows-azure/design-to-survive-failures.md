---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/design-to-survive-failures
title: 在出现故障时进行设计（通过 Azure 构建实际的云应用） |Microsoft Docs
author: MikeWasson
description: 使用 Azure 电子书构建真实的云应用基于 Scott Guthrie 开发的演示文稿。 它介绍了13种模式和实践，
ms.author: riande
ms.date: 06/12/2014
ms.assetid: 364ce84e-5af8-4e08-afc9-75a512b01f84
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/design-to-survive-failures
msc.type: authoredcontent
ms.openlocfilehash: 9bf9acb8b4f8521d03c053c124c5fc4a07d6cb9a
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/28/2019
ms.locfileid: "74585657"
---
# <a name="design-to-survive-failures-building-real-world-cloud-apps-with-azure"></a><span data-ttu-id="20556-104">设计为可经受故障（通过 Azure 构建实际的云应用）</span><span class="sxs-lookup"><span data-stu-id="20556-104">Design to Survive Failures (Building Real-World Cloud Apps with Azure)</span></span>

<span data-ttu-id="20556-105">作者： [Mike Wasson](https://github.com/MikeWasson)， [Rick Anderson]((https://twitter.com/RickAndMSFT))， [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="20556-105">by [Mike Wasson](https://github.com/MikeWasson), [Rick Anderson]((https://twitter.com/RickAndMSFT)), [Tom Dykstra](https://github.com/tdykstra)</span></span>

<span data-ttu-id="20556-106">[下载 Fix It 项目](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4)或[下载电子书](https://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)</span><span class="sxs-lookup"><span data-stu-id="20556-106">[Download Fix It Project](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) or [Download E-book](https://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)</span></span>

> <span data-ttu-id="20556-107">**使用 Azure 电子书构建真实的云应用**基于 Scott Guthrie 开发的演示文稿。</span><span class="sxs-lookup"><span data-stu-id="20556-107">The **Building Real World Cloud Apps with Azure** e-book is based on a presentation developed by Scott Guthrie.</span></span> <span data-ttu-id="20556-108">它介绍了可帮助你成功开发云的 web 应用的13种模式和实践。</span><span class="sxs-lookup"><span data-stu-id="20556-108">It explains 13 patterns and practices that can help you be successful developing web apps for the cloud.</span></span> <span data-ttu-id="20556-109">有关电子书的信息，请参阅[第一章](introduction.md)。</span><span class="sxs-lookup"><span data-stu-id="20556-109">For information about the e-book, see [the first chapter](introduction.md).</span></span>

<span data-ttu-id="20556-110">在构建任意类型的应用程序时必须考虑的一个问题是，特别是在云中运行的应用程序，它是如何设计应用程序，以便能够正确地处理故障并继续提供价值，可以.</span><span class="sxs-lookup"><span data-stu-id="20556-110">One of the things you have to think about when you build any type of application, but especially one that will run in the cloud where lots of people will be using it, is how to design the app so that it can gracefully handle failures and continue to deliver value as much as possible.</span></span> <span data-ttu-id="20556-111">只要有足够的时间，在任何环境或任何软件系统中都会出错。</span><span class="sxs-lookup"><span data-stu-id="20556-111">Given enough time, things are going to go wrong in any environment or any software system.</span></span> <span data-ttu-id="20556-112">你的应用如何处理这些情况确定你的客户将获得的不确定程度，以及你需要花费多少时间来分析和解决问题。</span><span class="sxs-lookup"><span data-stu-id="20556-112">How your app handles those situations determines how upset your customers will get and how much time you have to spend analyzing and fixing problems.</span></span>

## <a name="types-of-failures"></a><span data-ttu-id="20556-113">失败类型</span><span class="sxs-lookup"><span data-stu-id="20556-113">Types of failures</span></span>

<span data-ttu-id="20556-114">你需要以不同方式处理两种基本类别的故障：</span><span class="sxs-lookup"><span data-stu-id="20556-114">There are two basic categories of failures that you'll want to handle differently:</span></span>

- <span data-ttu-id="20556-115">暂时性的自我修复故障，例如间歇性网络连接问题。</span><span class="sxs-lookup"><span data-stu-id="20556-115">Transient, self-healing failures such as intermittent network connectivity issues.</span></span>
- <span data-ttu-id="20556-116">需要干预的持久故障。</span><span class="sxs-lookup"><span data-stu-id="20556-116">Enduring failures that require intervention.</span></span>

<span data-ttu-id="20556-117">对于暂时性故障，你可以实施重试策略，以确保应用程序在大多数情况下快速自动恢复。</span><span class="sxs-lookup"><span data-stu-id="20556-117">For transient failures, you can implement a retry policy to ensure that most of the time the app recovers quickly and automatically.</span></span> <span data-ttu-id="20556-118">你的客户可能会注意到响应时间稍长，否则不会受到影响。</span><span class="sxs-lookup"><span data-stu-id="20556-118">Your customers might notice slightly longer response time, but otherwise they won't be affected.</span></span> <span data-ttu-id="20556-119">我们将在[暂时性故障处理一章](transient-fault-handling.md)中介绍一些处理这些错误的方法。</span><span class="sxs-lookup"><span data-stu-id="20556-119">We'll show some ways to handle these errors in the [Transient Fault Handling chapter](transient-fault-handling.md).</span></span>

<span data-ttu-id="20556-120">对于持久故障，你可以实施监视和日志记录功能，以便在出现问题时及时通知你，从而促进根本原因分析。</span><span class="sxs-lookup"><span data-stu-id="20556-120">For enduring failures, you can implement monitoring and logging functionality that notifies you promptly when issues arise and that facilitates root cause analysis.</span></span> <span data-ttu-id="20556-121">我们将介绍一些方法，帮助你在 "[监视和遥测" 一章](monitoring-and-telemetry.md)中了解这些类型的错误。</span><span class="sxs-lookup"><span data-stu-id="20556-121">We'll show some ways to help you stay on top of these kinds of errors in the [Monitoring and Telemetry chapter](monitoring-and-telemetry.md).</span></span>

## <a name="failure-scope"></a><span data-ttu-id="20556-122">故障范围</span><span class="sxs-lookup"><span data-stu-id="20556-122">Failure scope</span></span>

<span data-ttu-id="20556-123">还必须考虑故障范围–是否影响单个计算机、整个服务（如 SQL 数据库或存储）或整个区域。</span><span class="sxs-lookup"><span data-stu-id="20556-123">You also have to think about failure scope – whether a single machine is affected, a whole service such as SQL Database or Storage, or an entire region.</span></span>

![故障范围](design-to-survive-failures/_static/image1.png)

### <a name="machine-failures"></a><span data-ttu-id="20556-125">计算机故障</span><span class="sxs-lookup"><span data-stu-id="20556-125">Machine failures</span></span>

<span data-ttu-id="20556-126">在 Azure 中，发生故障的服务器自动替换为新的服务器，并且设计良好的云应用会自动、快速地从这种类型的故障中恢复。</span><span class="sxs-lookup"><span data-stu-id="20556-126">In Azure, a failed server is automatically replaced by a new one, and a well-designed cloud app recovers from this kind of failure automatically and quickly.</span></span> <span data-ttu-id="20556-127">更早地，我们增加了无状态 web 层的可伸缩性优势，并且从故障的服务器中轻松恢复是情形的另一个优点。</span><span class="sxs-lookup"><span data-stu-id="20556-127">Earlier we stressed the scalability benefits of a stateless web tier, and ease of recovery from a failed server is another benefit of statelessness.</span></span> <span data-ttu-id="20556-128">轻松恢复也是平台即服务（PaaS）功能（如 SQL 数据库和 Azure App Service Web 应用）的优点之一。</span><span class="sxs-lookup"><span data-stu-id="20556-128">Ease of recovery is also one of the benefits of platform-as-a-service (PaaS) features such as SQL Database and Azure App Service Web Apps.</span></span> <span data-ttu-id="20556-129">硬件故障很少见，但当它们发生时，这些服务会自动处理它们;在使用其中一种服务时，甚至无需编写代码来处理计算机故障。</span><span class="sxs-lookup"><span data-stu-id="20556-129">Hardware failures are rare, but when they occur these services handle them automatically; you don't even have to write code to handle machine failures when you're using one of these services.</span></span>

### <a name="service-failures"></a><span data-ttu-id="20556-130">服务故障</span><span class="sxs-lookup"><span data-stu-id="20556-130">Service failures</span></span>

<span data-ttu-id="20556-131">通常，云应用程序使用多个服务。</span><span class="sxs-lookup"><span data-stu-id="20556-131">Cloud apps typically use multiple services.</span></span> <span data-ttu-id="20556-132">例如，Fix It 应用程序使用 SQL 数据库服务，存储服务和 web 应用程序部署到 Azure App Service。</span><span class="sxs-lookup"><span data-stu-id="20556-132">For example, the Fix It app uses the SQL Database service, the Storage service, and the web app is deployed to Azure App Service.</span></span> <span data-ttu-id="20556-133">如果你所依赖的服务之一发生故障，你的应用程序会执行什么操作？</span><span class="sxs-lookup"><span data-stu-id="20556-133">What will your app do if one of the services you depend on fails?</span></span> <span data-ttu-id="20556-134">对于某些服务失败，"很抱歉，请稍后再试" 消息可能是最佳做法。</span><span class="sxs-lookup"><span data-stu-id="20556-134">For some service failures a friendly "sorry, try again later" message might be the best you can do.</span></span> <span data-ttu-id="20556-135">但在许多情况下，您可以更好地执行操作。</span><span class="sxs-lookup"><span data-stu-id="20556-135">But in many scenarios you can do better.</span></span> <span data-ttu-id="20556-136">例如，当后端数据存储关闭时，可以接受用户输入，显示 "你的请求已收到"，并暂时将输入存储在其他位置;然后，当需要的服务再次运行时，可以检索并处理输入。</span><span class="sxs-lookup"><span data-stu-id="20556-136">For example, when your back-end data store is down, you can accept user input, display "your request has been received," and store the input someplace else temporarily; then when the service you need is operational again, you can retrieve the input and process it.</span></span>

<span data-ttu-id="20556-137">以[队列为中心的工作模式](queue-centric-work-pattern.md)一章介绍了处理此方案的一种方法。</span><span class="sxs-lookup"><span data-stu-id="20556-137">The [Queue-centric Work Pattern](queue-centric-work-pattern.md) chapter shows one way to handle this scenario.</span></span> <span data-ttu-id="20556-138">Fix It 应用将任务存储在 SQL 数据库中，但在 SQL 数据库关闭时，无需退出工作。</span><span class="sxs-lookup"><span data-stu-id="20556-138">The Fix It app stores tasks in SQL Database, but it doesn't have to quit working when SQL Database is down.</span></span> <span data-ttu-id="20556-139">在本章中，我们将了解如何将任务的用户输入存储在队列中，以及如何使用工作进程读取队列和更新任务。</span><span class="sxs-lookup"><span data-stu-id="20556-139">In that chapter we'll see how to store user input for a task in a queue, and use a worker process to read the queue and update the task.</span></span> <span data-ttu-id="20556-140">如果 SQL 已关闭，创建 Fix It 任务的功能不受影响;当 SQL 数据库可用时，工作进程可以等待并处理新的任务。</span><span class="sxs-lookup"><span data-stu-id="20556-140">If SQL is down, the ability to create Fix It tasks is unaffected; the worker process can wait and process new tasks when SQL Database is available.</span></span>

### <a name="region-failures"></a><span data-ttu-id="20556-141">区域故障</span><span class="sxs-lookup"><span data-stu-id="20556-141">Region failures</span></span>

<span data-ttu-id="20556-142">整个区域可能会失败。</span><span class="sxs-lookup"><span data-stu-id="20556-142">Entire regions may fail.</span></span> <span data-ttu-id="20556-143">自然灾害可能会损坏数据中心，它可能会被 meteor 平展，farmer burying 可以使用 backhoe 等来剪切数据中心的干线行。如果你的应用程序托管在 stricken 数据中心，你该做什么？</span><span class="sxs-lookup"><span data-stu-id="20556-143">A natural disaster might destroy a data center, it might get flattened by a meteor, the trunk line into the datacenter could be cut by a farmer burying a cow with a backhoe, etc. If your app is hosted in the stricken datacenter what do you do?</span></span> <span data-ttu-id="20556-144">可以将 Azure 中的应用设置为同时在多个区域中运行，以便在某个区域发生灾难时，你可以继续在另一个区域中运行。</span><span class="sxs-lookup"><span data-stu-id="20556-144">It's possible to set up your app in Azure to run in multiple regions simultaneously so that if there's a disaster in one, you continue running in another region.</span></span> <span data-ttu-id="20556-145">此类故障非常罕见，大多数应用程序都不会经历必要的阻碍，以确保通过此类故障的服务不中断。</span><span class="sxs-lookup"><span data-stu-id="20556-145">Such failures are extremely rare occurrences, and most apps don't jump through the hoops necessary to ensure uninterrupted service through failures of this sort.</span></span> <span data-ttu-id="20556-146">请参阅本章末尾的资源部分，了解有关如何通过区域故障使应用保持可用的信息。</span><span class="sxs-lookup"><span data-stu-id="20556-146">See the Resources section at the end of the chapter for information about how to keep your app available even through a region failure.</span></span>

<span data-ttu-id="20556-147">Azure 的目标是更轻松地处理所有这些类型的故障，你将在以下章节中看到有关如何执行此操作的一些示例。</span><span class="sxs-lookup"><span data-stu-id="20556-147">A goal of Azure is to make handling all of these kinds of failures a lot easier, and you'll see some examples of how we're doing that in the following chapters.</span></span>

## <a name="slas"></a><span data-ttu-id="20556-148">协议</span><span class="sxs-lookup"><span data-stu-id="20556-148">SLAs</span></span>

<span data-ttu-id="20556-149">人们通常会在云环境中获悉服务级别协议（Sla）。</span><span class="sxs-lookup"><span data-stu-id="20556-149">People often hear about service-level agreements (SLAs) in the cloud environment.</span></span> <span data-ttu-id="20556-150">实质上，它们承诺公司对服务的可靠性。</span><span class="sxs-lookup"><span data-stu-id="20556-150">Basically these are promises that companies make about how reliable their service is.</span></span> <span data-ttu-id="20556-151">99.9% 的 SLA 表示预计服务将在99.9% 的时间运行。</span><span class="sxs-lookup"><span data-stu-id="20556-151">A 99.9% SLA means you should expect the service to be working correctly 99.9% of the time.</span></span> <span data-ttu-id="20556-152">这是 SLA 的一个相当典型的值，并且听起来非常多，但你可能不会认识到多少个停机时间的实际数量为0.1%。</span><span class="sxs-lookup"><span data-stu-id="20556-152">That's a fairly typical value for an SLA and it sounds like a very high number, but you might not realize how much down time .1% actually amounts to.</span></span> <span data-ttu-id="20556-153">下面是一个表，其中显示了不同的 SLA 百分比在一年、一个月和一周内的停机时间。</span><span class="sxs-lookup"><span data-stu-id="20556-153">Here's a table that shows how much downtime various SLA percentages amount to over a year, a month, and a week.</span></span>

![SLA 表](design-to-survive-failures/_static/image2.png)

<span data-ttu-id="20556-155">因此，99.9% 的 SLA 表示你的服务可能会在一年或每月43.2 分钟后关闭8.76 小时。</span><span class="sxs-lookup"><span data-stu-id="20556-155">So a 99.9% SLA means your service could be down 8.76 hours a year or 43.2 minutes a month.</span></span> <span data-ttu-id="20556-156">这比大多数人都认识到的时间更多。</span><span class="sxs-lookup"><span data-stu-id="20556-156">That's more down time than most people realize.</span></span> <span data-ttu-id="20556-157">因此，作为开发人员，您需要注意一定的停机时间，并以合理的方式对其进行处理。</span><span class="sxs-lookup"><span data-stu-id="20556-157">So as a developer you want to be aware that a certain amount of down time is possible and handle it in a graceful way.</span></span> <span data-ttu-id="20556-158">有人将使用您的应用程序，而服务即将关闭，并且您想要将该客户的负面影响降至最低。</span><span class="sxs-lookup"><span data-stu-id="20556-158">At some point someone is going to be using your app, and a service is going to be down, and you want to minimize the negative impact of that on the customer.</span></span>

<span data-ttu-id="20556-159">你应了解的有关 SLA 的一项内容是它所引用的时间框架：每周、每月还是每年都会重置时钟？</span><span class="sxs-lookup"><span data-stu-id="20556-159">One thing you should know about an SLA is what time-frame it refers to: does the clock get reset every week, every month, or every year?</span></span> <span data-ttu-id="20556-160">在 Azure 中，我们每月重置一次时钟，这比每年的 SLA 更好，因为每年 SLA 可以通过将它们偏移一系列好月份来隐藏错误月份。</span><span class="sxs-lookup"><span data-stu-id="20556-160">In Azure we reset the clock every month, which is better for you than a yearly SLA, since a yearly SLA could hide bad months by offsetting them with a series of good months.</span></span>

<span data-ttu-id="20556-161">当然，我们总是比 SLA 努力做到更好;通常，您的工作时间比此小得多。</span><span class="sxs-lookup"><span data-stu-id="20556-161">Of course we always aspire to do better than the SLA; usually you'll be down much less than that.</span></span> <span data-ttu-id="20556-162">承诺是，如果我们的运行时间超过了你可以要求花钱回来的最长时间。</span><span class="sxs-lookup"><span data-stu-id="20556-162">The promise is that if we're ever down for longer than the maximum down time you can ask for money back.</span></span> <span data-ttu-id="20556-163">您取回的资金量可能并不能完全补偿您对超出时间的业务影响，但 SLA 的这一环节将充当强制策略，并让您知道我们确实要认真对待。</span><span class="sxs-lookup"><span data-stu-id="20556-163">The amount of money you get back probably wouldn't fully compensate you for the business impact of the excess down time, but that aspect of the SLA acts as an enforcement policy and lets you know that we do take it very seriously.</span></span>

### <a name="composite-slas"></a><span data-ttu-id="20556-164">复合 Sla</span><span class="sxs-lookup"><span data-stu-id="20556-164">Composite SLAs</span></span>

<span data-ttu-id="20556-165">查看 Sla 时，需要考虑的一个重要事项是在应用中使用多个服务的影响，每个服务都有一个单独的 SLA。</span><span class="sxs-lookup"><span data-stu-id="20556-165">An important thing to think about when you're looking at SLAs is the impact of using multiple services in an app, with each service having a separate SLA.</span></span> <span data-ttu-id="20556-166">例如，Fix It 应用使用 Azure App Service Web 应用、Azure 存储和 SQL 数据库。</span><span class="sxs-lookup"><span data-stu-id="20556-166">For example, the Fix It app uses Azure App Service Web Apps, Azure Storage, and SQL Database.</span></span> <span data-ttu-id="20556-167">下面是此电子书在2013年12月撰写的日期：</span><span class="sxs-lookup"><span data-stu-id="20556-167">Here are their SLA numbers as of the date this e-book is being written in December, 2013:</span></span>

![SLA 网站、存储、SQL 数据库](design-to-survive-failures/_static/image3.png)

<span data-ttu-id="20556-169">基于这些服务 Sla，应用的最大停机时间是多少？</span><span class="sxs-lookup"><span data-stu-id="20556-169">What is the maximum down time you would expect for the app based on these service SLAs?</span></span> <span data-ttu-id="20556-170">您可能认为停机时间等于最差的 SLA 百分比，在这种情况下，可能为99.9%。</span><span class="sxs-lookup"><span data-stu-id="20556-170">You might think that your down time would be equal to the worst SLA percentage, or 99.9% in this case.</span></span> <span data-ttu-id="20556-171">如果所有三个服务始终都出现故障，但这并不是实际发生的情况，则会为 true。</span><span class="sxs-lookup"><span data-stu-id="20556-171">That would be true if all three services always failed at the same time, but that isn't necessarily what actually happens.</span></span> <span data-ttu-id="20556-172">每个服务可能会在不同时间独立失败，因此，你必须通过将各个 SLA 编号相乘来计算复合 SLA。</span><span class="sxs-lookup"><span data-stu-id="20556-172">Each service may fail independently at different times, so you have to calculate the composite SLA by multiplying the individual SLA numbers.</span></span>

![复合 SLA](design-to-survive-failures/_static/image4.png)

<span data-ttu-id="20556-174">因此，你的应用程序可能不会在每月43.2 分钟，而是每月3倍，每月108分钟–并且仍处于 Azure SLA 限制范围内。</span><span class="sxs-lookup"><span data-stu-id="20556-174">So your app could be down not just 43.2 minutes a month but 3 times that amount, 108 minutes a month – and still be within the Azure SLA limits.</span></span>

<span data-ttu-id="20556-175">此问题在 Azure 中不是唯一的。</span><span class="sxs-lookup"><span data-stu-id="20556-175">This issue is not unique to Azure.</span></span> <span data-ttu-id="20556-176">我们实际上提供了任何可用云服务的最佳云 Sla，如果你使用任何供应商的云服务，你将遇到类似的问题。</span><span class="sxs-lookup"><span data-stu-id="20556-176">We actually provide the best cloud SLAs of any cloud service available, and you'll have similar issues to deal with if you use any vendor's cloud services.</span></span> <span data-ttu-id="20556-177">重点介绍如何设计你的应用程序以合理地处理不可避免的服务故障，这一点非常重要，因为它们可能会经常发生，以影响你的客户或用户。</span><span class="sxs-lookup"><span data-stu-id="20556-177">What this highlights is the importance of thinking about how you can design your app to handle the inevitable service failures gracefully, because they might happen often enough to impact your customers or users.</span></span>

### <a name="cloud-slas-compared-to-enterprise-down-time-experience"></a><span data-ttu-id="20556-178">与企业停机体验相比的云 Sla</span><span class="sxs-lookup"><span data-stu-id="20556-178">Cloud SLAs compared to enterprise down-time experience</span></span>

<span data-ttu-id="20556-179">人们有时会说： "在我的企业应用程序中，我从未遇到过这些问题。"</span><span class="sxs-lookup"><span data-stu-id="20556-179">People sometimes say, "In my enterprise app I never have these problems."</span></span> <span data-ttu-id="20556-180">如果你询问一个月的停机时间，他们通常会说： "当然，这是偶尔发生的。"</span><span class="sxs-lookup"><span data-stu-id="20556-180">If you ask how much down time a month they actually have, they usually say, "Well, it happens occasionally."</span></span> <span data-ttu-id="20556-181">如果你询问的频率如何，他们将承认 "有时我们需要备份或安装新的服务器或更新软件"。</span><span class="sxs-lookup"><span data-stu-id="20556-181">And if you ask how often, they admit that "Sometimes we do need to back up or install a new server or update software."</span></span> <span data-ttu-id="20556-182">当然，这会计为关闭时间。</span><span class="sxs-lookup"><span data-stu-id="20556-182">Of course, that counts as down time.</span></span> <span data-ttu-id="20556-183">大多数企业应用程序（除非它们特别是任务关键型应用程序）实际上已超过服务 Sla 允许的时间量。</span><span class="sxs-lookup"><span data-stu-id="20556-183">Most enterprise apps unless they are especially mission-critical are actually down for more than the amount of time allowed by our service SLAs.</span></span> <span data-ttu-id="20556-184">但是，当它是您的服务器和您的基础结构，并对其进行控制时，您的 angst 的时间可能不太大。</span><span class="sxs-lookup"><span data-stu-id="20556-184">But when it's your server and your infrastructure and you're responsible for it and in control of it, you tend to feel less angst about down times.</span></span> <span data-ttu-id="20556-185">在云环境中，你依赖于其他人，并且你不知道发生了什么情况，因此你可能会担心更多的担心。</span><span class="sxs-lookup"><span data-stu-id="20556-185">In a cloud environment you're dependent on someone else and you don't know what's going on, so you might tend to get more worried about it.</span></span>

<span data-ttu-id="20556-186">当企业实现比从云 SLA 获取更多的时间百分比时，他们可以通过在硬件上花费更多资金来实现此目的。</span><span class="sxs-lookup"><span data-stu-id="20556-186">When an enterprise achieves a greater up-time percentage than you get from a cloud SLA, they do it by spending a lot more money on hardware.</span></span> <span data-ttu-id="20556-187">云服务可以这样做，但必须对其服务进行更多的收费。</span><span class="sxs-lookup"><span data-stu-id="20556-187">A cloud service could do that but would have to charge much more for its services.</span></span> <span data-ttu-id="20556-188">相反，你可以利用经济高效的服务并设计你的软件，使你的客户无法实现最小中断。</span><span class="sxs-lookup"><span data-stu-id="20556-188">Instead, you take advantage of a cost-effective service and design your software so that the inevitable failures cause minimum disruption to your customers.</span></span> <span data-ttu-id="20556-189">作为云应用设计器，你的工作并不太多，无法避免发生灾难，并通过关注软件（而不是硬件）来实现此目的。</span><span class="sxs-lookup"><span data-stu-id="20556-189">Your job as a cloud app designer is not so much to avoid failure as to avoid catastrophe, and you do that by focusing on software, not on hardware.</span></span> <span data-ttu-id="20556-190">尽管企业应用会尽力最大限度地减少故障之间的平均时间，但云应用会尽力缩短平均恢复时间。</span><span class="sxs-lookup"><span data-stu-id="20556-190">Whereas enterprise apps strive to maximize mean time between failures, cloud apps strive to minimize mean time to recover.</span></span>

### <a name="not-all-cloud-services-have-slas"></a><span data-ttu-id="20556-191">并非所有云服务都具有 Sla</span><span class="sxs-lookup"><span data-stu-id="20556-191">Not all cloud services have SLAs</span></span>

<span data-ttu-id="20556-192">还要注意，并非每个云服务都具有 SLA。</span><span class="sxs-lookup"><span data-stu-id="20556-192">Be aware also that not every cloud service even has an SLA.</span></span> <span data-ttu-id="20556-193">如果你的应用程序依赖于一个没有时间保证的服务，你可能会比你想像的时间更长。</span><span class="sxs-lookup"><span data-stu-id="20556-193">If your app is dependent on a service with no up-time guarantee, you could be down far longer than you might imagine.</span></span> <span data-ttu-id="20556-194">例如，如果使用 Facebook 或 Twitter 等社交提供程序启用登录到你的网站，请与服务提供商联系，以了解是否存在 SLA，你可能会发现没有 SLA。</span><span class="sxs-lookup"><span data-stu-id="20556-194">For example, if you enable log-in to your site using a social provider such as Facebook or Twitter, check with the service provider to find out if there is an SLA, and you might find out there isn't one.</span></span> <span data-ttu-id="20556-195">但是，如果身份验证服务出现故障，或者不能支持您在其上抛出的请求量，则您的客户将被锁定在您的应用程序之外。</span><span class="sxs-lookup"><span data-stu-id="20556-195">But if the authentication service goes down or is unable to support the volume of requests you throw at it, your customers are locked out of your app.</span></span> <span data-ttu-id="20556-196">你可能会关闭几天或更长时间。</span><span class="sxs-lookup"><span data-stu-id="20556-196">You could be down for days or longer.</span></span> <span data-ttu-id="20556-197">一个新应用程序的创建者预计数以百计的下载并依赖于 Facebook 身份验证，但在进行实时操作之前，不会与 Facebook 交互，因为这种服务没有 SLA。</span><span class="sxs-lookup"><span data-stu-id="20556-197">The creators of one new app expected hundreds of millions of downloads and took a dependency on Facebook authentication – but didn't talk to Facebook before going live and discovered too late that there was no SLA for that service.</span></span>

### <a name="not-all-downtime-counts-toward-slas"></a><span data-ttu-id="20556-198">并非所有停机时间都会计入 Sla</span><span class="sxs-lookup"><span data-stu-id="20556-198">Not all downtime counts toward SLAs</span></span>

<span data-ttu-id="20556-199">如果你的应用程序过度使用，某些云服务可能会有意拒绝服务。</span><span class="sxs-lookup"><span data-stu-id="20556-199">Some cloud services may deliberately deny service if your app over-uses them.</span></span> <span data-ttu-id="20556-200">这称为*限制*。</span><span class="sxs-lookup"><span data-stu-id="20556-200">This is called *throttling*.</span></span> <span data-ttu-id="20556-201">如果服务具有 SLA，则它应声明你可能会受到限制的条件，并且你的应用程序设计应避免出现这些情况，并在发生此限制时正确地做出响应。</span><span class="sxs-lookup"><span data-stu-id="20556-201">If a service has an SLA, it should state the conditions under which you might be throttled, and your app design should avoid those conditions and react appropriately to the throttling if it happens.</span></span> <span data-ttu-id="20556-202">例如，如果在超过特定数量的每秒时，对服务的请求将开始失败，则需要确保自动重试不会快速进行，因为它们会导致限制继续。</span><span class="sxs-lookup"><span data-stu-id="20556-202">For example, if requests to a service start to fail when you exceed a certain number per second, you want to make sure automatic retries don't happen so fast that they cause the throttling to continue.</span></span> <span data-ttu-id="20556-203">在[暂时性故障处理一章](transient-fault-handling.md)中，我们将详细介绍限制。</span><span class="sxs-lookup"><span data-stu-id="20556-203">We'll have more to say about throttling in the [Transient Fault Handling chapter](transient-fault-handling.md).</span></span>

## <a name="summary"></a><span data-ttu-id="20556-204">总结</span><span class="sxs-lookup"><span data-stu-id="20556-204">Summary</span></span>

<span data-ttu-id="20556-205">本章已尝试帮助你认识到现实世界的云应用程序不能正常工作的原因。</span><span class="sxs-lookup"><span data-stu-id="20556-205">This chapter has tried to help you realize why a real world cloud app has to be designed to survive failures gracefully.</span></span> <span data-ttu-id="20556-206">从[下一章](monitoring-and-telemetry.md)开始，本系列中的其余模式将更详细地介绍一些可用于执行此操作的策略：</span><span class="sxs-lookup"><span data-stu-id="20556-206">Starting with the [next chapter](monitoring-and-telemetry.md), the remaining patterns in this series go into more detail about some strategies you can use to do that:</span></span>

- <span data-ttu-id="20556-207">具有良好的[监视和遥测](monitoring-and-telemetry.md)，使你能够快速找到需要干预的故障，并提供足够的信息来解决这些问题。</span><span class="sxs-lookup"><span data-stu-id="20556-207">Have good [monitoring and telemetry](monitoring-and-telemetry.md), so that you find out quickly about failures that require intervention, and you have sufficient information to resolve them.</span></span>
- <span data-ttu-id="20556-208">通过实现智能重试逻辑来[处理暂时性故障](transient-fault-handling.md)，以便您的应用程序在不能时自动恢复，并回退到[断路](transient-fault-handling.md#circuitbreakers)器逻辑。</span><span class="sxs-lookup"><span data-stu-id="20556-208">[Handle transient faults](transient-fault-handling.md) by implementing intelligent retry logic, so that your app recovers automatically when it can and falls back to [circuit breaker](transient-fault-handling.md#circuitbreakers) logic when it can't.</span></span>
- <span data-ttu-id="20556-209">使用[分布式缓存](distributed-caching.md)来最大程度地减少数据库访问的吞吐量、延迟和连接问题。</span><span class="sxs-lookup"><span data-stu-id="20556-209">Use [distributed caching](distributed-caching.md) in order to minimize throughput, latency, and connection problems with database access.</span></span>
- <span data-ttu-id="20556-210">通过以[队列为中心的工作模式](queue-centric-work-pattern.md)实现松散耦合，以便在后端停止时应用前端可以继续工作。</span><span class="sxs-lookup"><span data-stu-id="20556-210">Implement loose coupling via the [queue-centric work pattern](queue-centric-work-pattern.md), so that your app front end can continue to work when the back end is down.</span></span>

## <a name="resources"></a><span data-ttu-id="20556-211">资源</span><span class="sxs-lookup"><span data-stu-id="20556-211">Resources</span></span>

<span data-ttu-id="20556-212">有关详细信息，请参阅此电子书中的后续章节和以下资源。</span><span class="sxs-lookup"><span data-stu-id="20556-212">For more information, see later chapters in this e-book and the following resources.</span></span>

<span data-ttu-id="20556-213">文档：</span><span class="sxs-lookup"><span data-stu-id="20556-213">Documentation:</span></span>

- <span data-ttu-id="20556-214">[防故障：弹性云体系结构的指南](https://msdn.microsoft.com/library/windowsazure/jj853352.aspx)。</span><span class="sxs-lookup"><span data-stu-id="20556-214">[Failsafe: Guidance for Resilient Cloud Architectures](https://msdn.microsoft.com/library/windowsazure/jj853352.aspx).</span></span> <span data-ttu-id="20556-215">白皮书 by Marc Mercuri、Ulrich Homann 和 Andrew Townhill。</span><span class="sxs-lookup"><span data-stu-id="20556-215">White paper by Marc Mercuri, Ulrich Homann, and Andrew Townhill.</span></span> <span data-ttu-id="20556-216">防故障视频系列的网页版本。</span><span class="sxs-lookup"><span data-stu-id="20556-216">Web page version of the FailSafe video series.</span></span>
- <span data-ttu-id="20556-217">[在 Azure 云服务上设计大规模服务的最佳实践](https://msdn.microsoft.com/library/windowsazure/jj717232.aspx)。</span><span class="sxs-lookup"><span data-stu-id="20556-217">[Best Practices for the Design of Large-Scale Services on Azure Cloud Services](https://msdn.microsoft.com/library/windowsazure/jj717232.aspx).</span></span> <span data-ttu-id="20556-218">通过标记 Simm 和 Michael Thomassy 的白皮书。</span><span class="sxs-lookup"><span data-stu-id="20556-218">White paper by Mark Simms and Michael Thomassy.</span></span>
- <span data-ttu-id="20556-219">[Azure 业务连续性技术指南](https://msdn.microsoft.com/library/windowsazure/hh873027.aspx)。</span><span class="sxs-lookup"><span data-stu-id="20556-219">[Azure Business Continuity Technical Guidance](https://msdn.microsoft.com/library/windowsazure/hh873027.aspx).</span></span> <span data-ttu-id="20556-220">白皮书： Wickline 和 Jason Roth。</span><span class="sxs-lookup"><span data-stu-id="20556-220">White paper by Patrick Wickline and Jason Roth.</span></span>
- <span data-ttu-id="20556-221">[Azure 应用程序的灾难恢复和高可用性](https://msdn.microsoft.com/library/windowsazure/dn251004.aspx)。</span><span class="sxs-lookup"><span data-stu-id="20556-221">[Disaster Recovery and High Availability for Azure Applications](https://msdn.microsoft.com/library/windowsazure/dn251004.aspx).</span></span> <span data-ttu-id="20556-222">白皮书： Michael McKeown、Hanu Kommalapati 和 Jason Roth。</span><span class="sxs-lookup"><span data-stu-id="20556-222">White paper by Michael McKeown, Hanu Kommalapati, and Jason Roth.</span></span>
- <span data-ttu-id="20556-223">[Microsoft 模式和实践-Azure 指南](https://msdn.microsoft.com/library/dn568099.aspx)。</span><span class="sxs-lookup"><span data-stu-id="20556-223">[Microsoft Patterns and Practices - Azure Guidance](https://msdn.microsoft.com/library/dn568099.aspx).</span></span> <span data-ttu-id="20556-224">请参阅多个数据中心部署指南，断路器模式。</span><span class="sxs-lookup"><span data-stu-id="20556-224">See Multi Data Center Deployment guidance, Circuit breaker pattern.</span></span>
- <span data-ttu-id="20556-225">[Azure 支持-服务级别协议](https://azure.microsoft.com/support/legal/sla/)。</span><span class="sxs-lookup"><span data-stu-id="20556-225">[Azure Support - Service Level Agreements](https://azure.microsoft.com/support/legal/sla/).</span></span>
- <span data-ttu-id="20556-226">[AZURE SQL Database 中的业务连续性](https://msdn.microsoft.com/library/windowsazure/hh852669.aspx)。</span><span class="sxs-lookup"><span data-stu-id="20556-226">[Business Continuity in Azure SQL Database](https://msdn.microsoft.com/library/windowsazure/hh852669.aspx).</span></span> <span data-ttu-id="20556-227">有关 SQL 数据库高可用性和灾难恢复功能的文档。</span><span class="sxs-lookup"><span data-stu-id="20556-227">Documentation about SQL Database high availability and disaster recovery features.</span></span>
- <span data-ttu-id="20556-228">[Azure 虚拟机中 SQL Server 的高可用性和灾难恢复](https://msdn.microsoft.com/library/windowsazure/jj870962.aspx)。</span><span class="sxs-lookup"><span data-stu-id="20556-228">[High Availability and Disaster Recovery for SQL Server in Azure Virtual Machines](https://msdn.microsoft.com/library/windowsazure/jj870962.aspx).</span></span>

<span data-ttu-id="20556-229">视频：</span><span class="sxs-lookup"><span data-stu-id="20556-229">Videos:</span></span>

- <span data-ttu-id="20556-230">[故障安全：构建可缩放且可复原的云服务](https://channel9.msdn.com/Series/FailSafe)。</span><span class="sxs-lookup"><span data-stu-id="20556-230">[FailSafe: Building Scalable, Resilient Cloud Services](https://channel9.msdn.com/Series/FailSafe).</span></span> <span data-ttu-id="20556-231">九部分系列： Ulrich Homann、Marc Mercuri 和 Mark Simm。</span><span class="sxs-lookup"><span data-stu-id="20556-231">Nine-part series by Ulrich Homann, Marc Mercuri, and Mark Simms.</span></span> <span data-ttu-id="20556-232">以一种易于访问且有趣的方式展示高级概念和体系结构原则，其中的情景是通过 Microsoft 客户咨询团队（CAT）的实际客户体验。</span><span class="sxs-lookup"><span data-stu-id="20556-232">Presents high-level concepts and architectural principles in a very accessible and interesting way, with stories drawn from Microsoft Customer Advisory Team (CAT) experience with actual customers.</span></span> <span data-ttu-id="20556-233">集1和8深入探讨了设计云应用程序以保持故障的原因。</span><span class="sxs-lookup"><span data-stu-id="20556-233">Episodes 1 and 8 go in depth into the reasons for designing cloud apps to survive failures.</span></span> <span data-ttu-id="20556-234">另请参阅有关从49:57 开始的剧集2中的限制的后续讨论，请参阅第2点中的故障点和故障模式（从56:05 开始）讨论，并讨论从40:55 开始的剧集3中的断路熔断器。</span><span class="sxs-lookup"><span data-stu-id="20556-234">See also the follow-up discussion of throttling in episode 2 starting at 49:57, the discussion of failure points and failure modes in episode 2 starting at 56:05, and the discussion of circuit breakers in episode 3 starting at 40:55.</span></span>
- <span data-ttu-id="20556-235">[构建大：从 Azure 客户获得的课程-第二部分](https://channel9.msdn.com/Events/Build/2012/3-030)。</span><span class="sxs-lookup"><span data-stu-id="20556-235">[Building Big: Lessons learned from Azure customers - Part II](https://channel9.msdn.com/Events/Build/2012/3-030).</span></span> <span data-ttu-id="20556-236">标记 Simm 讨论了如何针对故障进行设计并检测所有内容。</span><span class="sxs-lookup"><span data-stu-id="20556-236">Mark Simms talks about designing for failure and instrumenting everything.</span></span> <span data-ttu-id="20556-237">与故障保护系列类似，但更详细地介绍了更多操作方法。</span><span class="sxs-lookup"><span data-stu-id="20556-237">Similar to the Failsafe series but goes into more how-to details.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="20556-238">[上一页](unstructured-blob-storage.md)
> [下一页](monitoring-and-telemetry.md)</span><span class="sxs-lookup"><span data-stu-id="20556-238">[Previous](unstructured-blob-storage.md)
[Next](monitoring-and-telemetry.md)</span></span>
