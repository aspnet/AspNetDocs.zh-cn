---
uid: web-pages/overview/data/7-displaying-data-in-a-chart
title: 在具有 ASP.NET Web Pages (Razor) 的图表中显示数据 |Microsoft Docs
author: microsoft
description: 这一章介绍了如何在图表中显示数据。 在上一章节中，您学习了如何以手动，并在网格中显示数据。 这一章介绍了...
ms.author: riande
ms.date: 05/22/2012
ms.assetid: f889fd46-4dac-4ecb-83d8-60e64c22036e
msc.legacyurl: /web-pages/overview/data/7-displaying-data-in-a-chart
msc.type: authoredcontent
ms.openlocfilehash: f97f214abeaeb88634dd10aaebacc0d58e91ab84
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/09/2019
ms.locfileid: "59422455"
---
# <a name="displaying-data-in-a-chart-with-aspnet-web-pages-razor"></a><span data-ttu-id="6e3e5-105">在具有 ASP.NET 网页 (Razor) 的图表中显示数据</span><span class="sxs-lookup"><span data-stu-id="6e3e5-105">Displaying Data in a Chart with ASP.NET Web Pages (Razor)</span></span>

<span data-ttu-id="6e3e5-106">by [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="6e3e5-106">by [Microsoft](https://github.com/microsoft)</span></span>

> <span data-ttu-id="6e3e5-107">本文介绍如何使用图表来使用 ASP.NET Web Pages (Razor) 网站中显示数据`Chart`帮助器。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-107">This article explains how to use a chart to display data in an ASP.NET Web Pages (Razor) website by using the `Chart` helper.</span></span>
> 
> <span data-ttu-id="6e3e5-108">**你将了解**:</span><span class="sxs-lookup"><span data-stu-id="6e3e5-108">**What you'll learn**:</span></span>
> 
> - <span data-ttu-id="6e3e5-109">如何在图表中显示数据。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-109">How to display data in a chart.</span></span>
> - <span data-ttu-id="6e3e5-110">如何设置图表使用内置的主题的样式。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-110">How to style charts using built-in themes.</span></span>
> - <span data-ttu-id="6e3e5-111">如何保存图表以及如何其缓存以提高性能。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-111">How to save charts and how to cache them for better performance.</span></span>
> 
> <span data-ttu-id="6e3e5-112">这些是 ASP.NET 编程一文中引入的功能：</span><span class="sxs-lookup"><span data-stu-id="6e3e5-112">These are the ASP.NET programming features introduced in the article:</span></span>
> 
> - <span data-ttu-id="6e3e5-113">`Chart`帮助器。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-113">The `Chart` helper.</span></span>
> 
> > [!NOTE]
> > <span data-ttu-id="6e3e5-114">在本文中的信息适用于 ASP.NET Web Pages 1.0 和 Web Pages 2。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-114">The information in this article applies to ASP.NET Web Pages 1.0 and Web Pages 2.</span></span>


<a id="The_Chart_Helper"></a>
## <a name="the-chart-helper"></a><span data-ttu-id="6e3e5-115">图表帮助程序</span><span class="sxs-lookup"><span data-stu-id="6e3e5-115">The Chart Helper</span></span>

<span data-ttu-id="6e3e5-116">当你想要以图形方式显示数据时，可以使用`Chart`帮助器。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-116">When you want to display your data in graphical form, you can use `Chart` helper.</span></span> <span data-ttu-id="6e3e5-117">`Chart`帮助器可以呈现在不同的图表类型中显示数据的图像。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-117">The `Chart` helper can render an image that displays data in a variety of chart types.</span></span> <span data-ttu-id="6e3e5-118">格式设置和标签，它支持很多选项。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-118">It supports many options for formatting and labeling.</span></span> <span data-ttu-id="6e3e5-119">`Chart`帮助器可以呈现 30 多个类型的图表，其中包括所有类型的图表，您可能熟悉的 Microsoft Excel 或其他工具&#8212;面积图、 条形图、 柱形图、 折线图和饼图中，以及的详细信息专用的图表，如股价图。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-119">The `Chart` helper can render more than 30 types of charts, including all the types of charts that you might be familiar with from Microsoft Excel or other tools &#8212; area charts, bar charts, column charts, line charts, and pie charts, along with more specialized charts like stock charts.</span></span>

| <span data-ttu-id="6e3e5-120">**面积图**![说明：面积图类型的图片</span><span class="sxs-lookup"><span data-stu-id="6e3e5-120">**Area chart** ![Description: Picture of the Area chart type</span></span>](7-displaying-data-in-a-chart/_static/image1.jpg) | <span data-ttu-id="6e3e5-121">**条形图**![说明：条形图类型的图片</span><span class="sxs-lookup"><span data-stu-id="6e3e5-121">**Bar chart** ![Description: Picture of the Bar chart type</span></span>](7-displaying-data-in-a-chart/_static/image2.jpg) |
| --- | --- |
| <span data-ttu-id="6e3e5-122">**柱形图**![说明：柱形图类型的图片</span><span class="sxs-lookup"><span data-stu-id="6e3e5-122">**Column chart** ![Description: Picture of the Column chart type</span></span>](7-displaying-data-in-a-chart/_static/image3.jpg) | <span data-ttu-id="6e3e5-123">**折线图**![说明：折线图类型的图片</span><span class="sxs-lookup"><span data-stu-id="6e3e5-123">**Line chart** ![Description: Picture of the Line chart type</span></span>](7-displaying-data-in-a-chart/_static/image4.jpg) |
| <span data-ttu-id="6e3e5-124">**饼图**![说明：饼图类型的图片</span><span class="sxs-lookup"><span data-stu-id="6e3e5-124">**Pie chart** ![Description: Picture of the Pie chart type</span></span>](7-displaying-data-in-a-chart/_static/image5.jpg) | <span data-ttu-id="6e3e5-125">**股价图**![说明：股价图类型的图片</span><span class="sxs-lookup"><span data-stu-id="6e3e5-125">**Stock chart** ![Description: Picture of the Stock chart type</span></span>](7-displaying-data-in-a-chart/_static/image6.jpg) |

### <a name="chart-elements"></a><span data-ttu-id="6e3e5-126">图表元素</span><span class="sxs-lookup"><span data-stu-id="6e3e5-126">Chart Elements</span></span>

<span data-ttu-id="6e3e5-127">图表显示数据和其他元素，如图例、 轴、 系列和等等。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-127">Charts show data and additional elements like legends, axes, series, and so on.</span></span> <span data-ttu-id="6e3e5-128">下图显示了许多你可以自定义时使用的图表元素`Chart`帮助器。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-128">The following picture shows many of the chart elements that you can customize when you use the `Chart` helper.</span></span> <span data-ttu-id="6e3e5-129">本文演示如何设置一些 （并非所有） 的这些元素。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-129">This article shows you how to set some (not all) of these elements.</span></span>

![描述：显示图表元素的图片](7-displaying-data-in-a-chart/_static/image7.jpg)

<a id="Creating_a_Chart"></a>
## <a name="creating-a-chart-from-data"></a><span data-ttu-id="6e3e5-131">从数据创建图表</span><span class="sxs-lookup"><span data-stu-id="6e3e5-131">Creating a Chart from Data</span></span>

<span data-ttu-id="6e3e5-132">在图表中显示的数据可以是从一个数组，从数据库中，从返回的结果或从 XML 文件中的数据。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-132">The data you display in a chart can be from an array, from the results returned from a database, or from data that's in an XML file.</span></span>

### <a name="using-an-array"></a><span data-ttu-id="6e3e5-133">使用数组</span><span class="sxs-lookup"><span data-stu-id="6e3e5-133">Using an Array</span></span>

<span data-ttu-id="6e3e5-134">中所述[ASP.NET Web Pages 编程使用 Razor 语法简介](https://go.microsoft.com/fwlink/?LinkId=202890)，数组可让您在单个变量中存储类似项的集合。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-134">As explained in [Introduction to ASP.NET Web Pages Programming Using the Razor Syntax](https://go.microsoft.com/fwlink/?LinkId=202890), an array lets you store a collection of similar items in a single variable.</span></span> <span data-ttu-id="6e3e5-135">可以使用数组以包含你想要在图表中包括的数据。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-135">You can use arrays to contain the data that you want to include in your chart.</span></span>

<span data-ttu-id="6e3e5-136">此过程演示如何创建图表数据在数组中，从使用默认图表类型。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-136">This procedure shows how you can create a chart from data in arrays, using the default chart type.</span></span> <span data-ttu-id="6e3e5-137">它还演示如何显示在页面内的图表。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-137">It also shows how to display the chart within the page.</span></span>

1. <span data-ttu-id="6e3e5-138">创建一个名为的新文件*ChartArrayBasic.cshtml*。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-138">Create a new file named *ChartArrayBasic.cshtml*.</span></span>
2. <span data-ttu-id="6e3e5-139">使用以下内容替换现有内容：</span><span class="sxs-lookup"><span data-stu-id="6e3e5-139">Replace the existing content with the following:</span></span> 

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample1.cshtml)]

    <span data-ttu-id="6e3e5-140">代码首先创建一个新图表，并设置其宽度和高度。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-140">The code first creates a new chart and sets its width and height.</span></span> <span data-ttu-id="6e3e5-141">使用指定图表标题`AddTitle`方法。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-141">You specify the chart title by using the `AddTitle` method.</span></span> <span data-ttu-id="6e3e5-142">若要添加数据，请使用`AddSeries`方法。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-142">To add data, you use the `AddSeries` method.</span></span> <span data-ttu-id="6e3e5-143">在此示例中，使用`name`， `xValue`，并`yValues`的参数`AddSeries`方法。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-143">In this example, you use the `name`, `xValue`, and `yValues` parameters of the `AddSeries` method.</span></span> <span data-ttu-id="6e3e5-144">`name`参数显示在图表图例中。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-144">The `name` parameter is displayed in the chart legend.</span></span> <span data-ttu-id="6e3e5-145">`xValue`参数包含沿图表水平轴显示的数据的数组。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-145">The `xValue` parameter contains an array of data that's displayed along the horizontal axis of the chart.</span></span> <span data-ttu-id="6e3e5-146">`yValues`参数包含用于绘制图表的垂直点的数据的数组。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-146">The `yValues` parameter contains an array of data that's used to plot the vertical points of the chart.</span></span>

    <span data-ttu-id="6e3e5-147">`Write`方法实际将呈现图表。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-147">The `Write` method actually renders the chart.</span></span> <span data-ttu-id="6e3e5-148">在这种情况下，这是因为未指定图表类型，`Chart`帮助器将呈现其默认图表，这是柱形图。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-148">In this case, because you didn't specify a chart type, the `Chart` helper renders its default chart, which is a column chart.</span></span>
3. <span data-ttu-id="6e3e5-149">在浏览器中运行页。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-149">Run the page in the browser.</span></span> <span data-ttu-id="6e3e5-150">浏览器将显示图表。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-150">The browser displays the chart.</span></span> 

    ![](7-displaying-data-in-a-chart/_static/image8.jpg)

### <a name="using-a-database-query-for-chart-data"></a><span data-ttu-id="6e3e5-151">使用图表数据的数据库查询</span><span class="sxs-lookup"><span data-stu-id="6e3e5-151">Using a Database Query for Chart Data</span></span>

<span data-ttu-id="6e3e5-152">如果要制作图表的信息是在数据库中，您可以运行数据库查询，然后使用结果中的数据创建图表。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-152">If the information you want to chart is in a database, you can run a database query and then use data from the results to create the chart.</span></span> <span data-ttu-id="6e3e5-153">此过程演示如何读取和显示项目中创建的数据库中的数据[使用 ASP.NET Web Pages 站点中的数据库简介](https://go.microsoft.com/fwlink/?LinkId=202893)。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-153">This procedure shows you how to read and display the data from the database created in the article [Introduction to Working with a Database in ASP.NET Web Pages Sites](https://go.microsoft.com/fwlink/?LinkId=202893).</span></span>

1. <span data-ttu-id="6e3e5-154">添加*应用程序\_数据*如果文件夹尚不存在的网站的根文件夹。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-154">Add an *App\_Data* folder to the root of the website if the folder does not already exist.</span></span>
2. <span data-ttu-id="6e3e5-155">在中*应用程序\_数据*文件夹中，添加名为的数据库文件*SmallBakery.sdf*中描述的[使用 ASP.NET Web Pages 站点中的数据库简介](https://go.microsoft.com/fwlink/?LinkId=202893).</span><span class="sxs-lookup"><span data-stu-id="6e3e5-155">In the *App\_Data* folder, add the database file named *SmallBakery.sdf* that's described in [Introduction to Working with a Database in ASP.NET Web Pages Sites](https://go.microsoft.com/fwlink/?LinkId=202893).</span></span>
3. <span data-ttu-id="6e3e5-156">创建一个名为的新文件*ChartDataQuery.cshtml*。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-156">Create a new file named *ChartDataQuery.cshtml*.</span></span>
4. <span data-ttu-id="6e3e5-157">使用以下内容替换现有内容：</span><span class="sxs-lookup"><span data-stu-id="6e3e5-157">Replace the existing content with the following:</span></span>   

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample2.cshtml)]

    <span data-ttu-id="6e3e5-158">该代码首先打开 SmallBakery 数据库，并将其分配给一个名为变量`db`。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-158">The code first opens the SmallBakery database and assigns it to a variable named `db`.</span></span> <span data-ttu-id="6e3e5-159">此变量表示`Database`可用于读取和写入到数据库的对象。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-159">This variable represents a `Database` object that can be used to read from and write to the database.</span></span> <span data-ttu-id="6e3e5-160">接下来，代码将运行 SQL 查询以获取名称和每个产品的价格。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-160">Next, the code runs a SQL query to get the name and price of each product.</span></span> <span data-ttu-id="6e3e5-161">该代码创建一个新图表，并向其传递数据库查询，通过调用图表的`DataBindTable`方法。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-161">The code creates a new chart and passes the database query to it by calling the chart's `DataBindTable` method.</span></span> <span data-ttu-id="6e3e5-162">此方法采用两个参数：`dataSource`参数是用于查询中的数据和`xField`参数允许您设置的数据列用于图表的 x 轴。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-162">This method takes two parameters: the `dataSource` parameter is for the data from the query, and the `xField` parameter lets you set which data column is used for the chart's x-axis.</span></span>

    <span data-ttu-id="6e3e5-163">为使用的替代方法`DataBindTable`方法中，可以使用`AddSeries`方法的`Chart`帮助器。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-163">As an alternative to using the `DataBindTable` method, you can use the `AddSeries` method of the `Chart` helper.</span></span> <span data-ttu-id="6e3e5-164">`AddSeries`方法允许您设置`xValue`和`yValues`参数。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-164">The `AddSeries` method lets you set the `xValue` and `yValues` parameters.</span></span> <span data-ttu-id="6e3e5-165">例如，而不是使用`DataBindTable`方法如下：</span><span class="sxs-lookup"><span data-stu-id="6e3e5-165">For example, instead of using the `DataBindTable` method like this:</span></span>

    [!code-css[Main](7-displaying-data-in-a-chart/samples/sample3.css)]

    <span data-ttu-id="6e3e5-166">可以使用`AddSeries`方法如下：</span><span class="sxs-lookup"><span data-stu-id="6e3e5-166">You can use the `AddSeries` method like this:</span></span>

    [!code-html[Main](7-displaying-data-in-a-chart/samples/sample4.html)]

    <span data-ttu-id="6e3e5-167">都呈现相同的结果。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-167">Both render the same results.</span></span> <span data-ttu-id="6e3e5-168">`AddSeries`方法是更灵活，因为你可以更明确指定的图表类型和数据，但`DataBindTable`方法可更轻松地使用如果不需要额外的灵活性。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-168">The `AddSeries` method is more flexible because you can specify the chart type and data more explicitly, but the `DataBindTable` method is easier to use if you don't need the extra flexibility.</span></span>
5. <span data-ttu-id="6e3e5-169">在浏览器中运行页。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-169">Run the page in a browser.</span></span> 

    ![](7-displaying-data-in-a-chart/_static/image9.jpg)

### <a name="using-xml-data"></a><span data-ttu-id="6e3e5-170">使用 XML 数据</span><span class="sxs-lookup"><span data-stu-id="6e3e5-170">Using XML Data</span></span>

<span data-ttu-id="6e3e5-171">用于绘制图表的第三个选项是一个 XML 文件用作图表的数据。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-171">The third option for charting is to use an XML file as the data for the chart.</span></span> <span data-ttu-id="6e3e5-172">这要求 XML 文件还具有某一架构文件 (*.xsd*文件) 描述的 XML 结构。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-172">This requires that the XML file also have a schema file (*.xsd* file) that describes the XML structure.</span></span> <span data-ttu-id="6e3e5-173">此过程演示如何从 XML 文件读取数据。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-173">This procedure shows you how to read data from an XML file.</span></span>

1. <span data-ttu-id="6e3e5-174">在中*应用程序\_数据*文件夹中，创建名为的新 XML 文件*data.xml*。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-174">In the *App\_Data* folder, create a new XML file named *data.xml*.</span></span>
2. <span data-ttu-id="6e3e5-175">现有的 XML 替换为以下内容，这是一个虚构的公司中的员工有关的一些 XML 数据。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-175">Replace the existing XML with the following, which is some XML data about employees in a fictional company.</span></span> 

    [!code-xml[Main](7-displaying-data-in-a-chart/samples/sample5.xml)]
3. <span data-ttu-id="6e3e5-176">在中*应用程序\_数据*文件夹中，创建名为的新 XML 文件*data.xsd*。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-176">In the *App\_Data* folder, create a new XML file named *data.xsd*.</span></span> <span data-ttu-id="6e3e5-177">(请注意，扩展此时间是 *.xsd*。)</span><span class="sxs-lookup"><span data-stu-id="6e3e5-177">(Note that the extension this time is *.xsd*.)</span></span>
4. <span data-ttu-id="6e3e5-178">使用以下内容替换现有的 XML:</span><span class="sxs-lookup"><span data-stu-id="6e3e5-178">Replace the existing XML with the following:</span></span> 

    [!code-xml[Main](7-displaying-data-in-a-chart/samples/sample6.xml)]
5. <span data-ttu-id="6e3e5-179">在该网站的根目录中创建名为的新文件*ChartDataXML.cshtml*。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-179">In the root of the website, create a new file named *ChartDataXML.cshtml*.</span></span>
6. <span data-ttu-id="6e3e5-180">使用以下内容替换现有内容：</span><span class="sxs-lookup"><span data-stu-id="6e3e5-180">Replace the existing content with the following:</span></span> 

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample7.cshtml)]

    <span data-ttu-id="6e3e5-181">代码首先创建`DataSet`对象。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-181">The code first creates a `DataSet` object.</span></span> <span data-ttu-id="6e3e5-182">此对象用于管理的数据，从 XML 文件中读取并将其组织根据架构文件中的信息。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-182">This object is used to manage the data that's read from the XML file and organize it according to the information in the schema file.</span></span> <span data-ttu-id="6e3e5-183">(请注意，代码的顶部包含该语句`using SystemData`。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-183">(Notice that the top of the code includes the statement `using SystemData`.</span></span> <span data-ttu-id="6e3e5-184">这必需的可以使用`DataSet`对象。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-184">This is required in order to be able to work with the `DataSet` object.</span></span> <span data-ttu-id="6e3e5-185">有关详细信息，请参阅[ &quot;Using&quot;语句和完全限定的名称](#SB_UsingStatements)这篇文章中更高版本。)</span><span class="sxs-lookup"><span data-stu-id="6e3e5-185">For more information, see [&quot;Using&quot; Statements and Fully Qualified Names](#SB_UsingStatements) later in this article.)</span></span>

    <span data-ttu-id="6e3e5-186">接下来，该代码会创建`DataView`对象基于数据集。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-186">Next, the code creates a `DataView` object based on the dataset.</span></span> <span data-ttu-id="6e3e5-187">数据视图提供了一个对象，该图表可以绑定到&#8212;，它是读取，并绘制。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-187">The data view provides an object that the chart can bind to &#8212; that is, read and plot.</span></span> <span data-ttu-id="6e3e5-188">图表绑定到数据`AddSeries`方法中，为你前面看到的图表数组数据，不同之处在于这一次时`xValue`并`yValues`参数设置为`DataView`对象。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-188">The chart binds to the data using the `AddSeries` method, as you saw earlier when charting the array data, except that this time the `xValue` and `yValues` parameters are set to the `DataView` object.</span></span>

    <span data-ttu-id="6e3e5-189">此示例还演示了如何指定特定图表类型。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-189">This example also shows you how to specify a particular chart type.</span></span> <span data-ttu-id="6e3e5-190">在添加数据时`AddSeries`方法，`chartType`参数也设置为显示饼图。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-190">When the data is added in the `AddSeries` method, the `chartType` parameter is also set to display a pie chart.</span></span>
7. <span data-ttu-id="6e3e5-191">在浏览器中运行页。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-191">Run the page in a browser.</span></span> 

    ![](7-displaying-data-in-a-chart/_static/image10.jpg)

> [!TIP]
> 
> <a id="SB_UsingStatements"></a>
> ### <a name="using-statements-and-fully-qualified-names"></a><span data-ttu-id="6e3e5-192">"Using"语句和完全限定的名称</span><span class="sxs-lookup"><span data-stu-id="6e3e5-192">"Using" Statements and Fully Qualified Names</span></span>
> 
> <span data-ttu-id="6e3e5-193">使用 Razor 语法的 ASP.NET Web Pages 基于.NET Framework 包含数以千计的组件 （类）。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-193">The .NET Framework that ASP.NET Web Pages with Razor syntax is based on consists of many thousands of components (classes).</span></span> <span data-ttu-id="6e3e5-194">若要对它进行管理，可以使用所有这些类，它们的结构到*命名空间*，哪些是有些类似于库。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-194">To make it manageable to work with all these classes, they're organized into *namespaces*, which are somewhat like libraries.</span></span> <span data-ttu-id="6e3e5-195">例如，`System.Web`命名空间包含支持浏览器/服务器通信的类`System.Xml`命名空间包含用于创建和读取 XML 文件的类和`System.Data`命名空间包含用于工作的类使用数据。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-195">For example, the `System.Web` namespace contains classes that support browser/server communication, the `System.Xml` namespace contains classes that are used to create and read XML files, and the `System.Data` namespace contains classes that let you work with data.</span></span>
> 
> <span data-ttu-id="6e3e5-196">若要访问.NET Framework 中的任何给定的类，代码需要知道不只是类名，但还的类的命名空间。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-196">In order to access any given class in the .NET Framework, code needs to know not just the class name, but also the namespace that the class is in.</span></span> <span data-ttu-id="6e3e5-197">例如，若要使用`Chart`帮助器，代码需要查找`System.Web.Helpers.Chart`类，它结合了命名空间 (`System.Web.Helpers`) 与类名称 (`Chart`)。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-197">For example, in order to use the `Chart` helper, code needs to find the `System.Web.Helpers.Chart` class, which combines the namespace (`System.Web.Helpers`) with the class name (`Chart`).</span></span> <span data-ttu-id="6e3e5-198">这称为类的*完全限定*名称&#8212;其完整、 明确位置 vastness 中的.NET framework。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-198">This is known as the class's *fully-qualified* name &#8212; its complete, unambiguous location within the vastness of the .NET Framework.</span></span> <span data-ttu-id="6e3e5-199">在代码中，这将显示如下：</span><span class="sxs-lookup"><span data-stu-id="6e3e5-199">In code, this would look like the following:</span></span>
> 
> `var myChart = new System.Web.Helpers.Chart(width: 600, height: 400) // etc.`
> 
> <span data-ttu-id="6e3e5-200">但是，非常麻烦 （和容易出错） 必须使用这些长、 完全限定的名称，每次想要引用的类或帮助器。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-200">However, it's cumbersome (and error prone) to have to use these long, fully-qualified names every time you want to refer to a class or helper.</span></span> <span data-ttu-id="6e3e5-201">因此，若要使其更易于使用的类名，您可以*导入*你感兴趣，这通常是命名空间是只需少量从.NET Framework 中的多个命名空间。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-201">Therefore, to make it easier to use class names, you can *import* the namespaces you're interested in, which is usually is just a handful from among the many namespaces in the .NET Framework.</span></span> <span data-ttu-id="6e3e5-202">如果您已导入命名空间，则可以使用只是类名称 (`Chart`) 而不是完全限定名称 (`System.Web.Helpers.Chart`)。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-202">If you've imported a namespace, you can use just a class name (`Chart`) instead of the fully qualified name (`System.Web.Helpers.Chart`).</span></span> <span data-ttu-id="6e3e5-203">在你的代码运行并遇到一个类名称，它可以查看在只需导入若要查找此类的命名空间中。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-203">When your code runs and encounters a class name, it can look in just the namespaces you've imported to find that class.</span></span>
> 
> <span data-ttu-id="6e3e5-204">在您使用 ASP.NET Web Pages 使用 Razor 语法创建网页，通常使用同一组类每次包括`WebPage`类、 各种帮助程序，等等。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-204">When you use ASP.NET Web Pages with Razor syntax to create web pages, you typically use the same set of classes each time, including the `WebPage` class, the various helpers, and so on.</span></span> <span data-ttu-id="6e3e5-205">若要保存的工作的导入相关命名空间，每次创建网站时，ASP.NET 配置以便自动导入一组核心命名空间为每个网站。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-205">To save you the work of importing the relevant namespaces every time you create a website, ASP.NET is configured so it automatically imports a set of core namespaces for every website.</span></span> <span data-ttu-id="6e3e5-206">这就是为什么没有处理命名空间或导入到现在; 为止您使用过的所有类都都已为您导入的命名空间中。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-206">That's why you haven't had to deal with namespaces or importing up to now; all the classes you've worked with are in namespaces that are already imported for you.</span></span>
> 
> <span data-ttu-id="6e3e5-207">但是，有时您需要使用不会自动为您导入的命名空间中的类。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-207">However, sometimes you need to work with a class that isn't in a namespace that's automatically imported for you.</span></span> <span data-ttu-id="6e3e5-208">这种情况下，您可以使用该类的完全限定的名称，也可以手动导入的命名空间包含类。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-208">In that case, you can either use that class's fully-qualified name, or you can manually import the namespace that contains the class.</span></span> <span data-ttu-id="6e3e5-209">若要导入命名空间，请使用`using`语句 (`import`在 Visual Basic 中)，如前面在示例中看到一文。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-209">To import a namespace, you use the `using` statement (`import` in Visual Basic), as you saw in an example earlier the article.</span></span>
> 
> <span data-ttu-id="6e3e5-210">例如，`DataSet`类位于`System.Data`命名空间。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-210">For example, the `DataSet` class is in the `System.Data` namespace.</span></span> <span data-ttu-id="6e3e5-211">`System.Data`命名空间不是自动提供给 ASP.NET Razor 页面。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-211">The `System.Data` namespace is not automatically available to ASP.NET Razor pages.</span></span> <span data-ttu-id="6e3e5-212">因此，若要使用`DataSet`类使用完全限定的名称，则可以使用如下代码：</span><span class="sxs-lookup"><span data-stu-id="6e3e5-212">Therefore, to work with the `DataSet` class using its fully qualified name, you can use code like this:</span></span>
> 
> `var dataSet = new System.Data.DataSet();`
> 
> <span data-ttu-id="6e3e5-213">如果您必须使用`DataSet`重复类可以导入此类的命名空间，然后使用在代码中的只是类名称：</span><span class="sxs-lookup"><span data-stu-id="6e3e5-213">If you have to use the `DataSet` class repeatedly you can import a namespace like this and then use just the class name in code:</span></span>
> 
> [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample8.cshtml)]
> 
> <span data-ttu-id="6e3e5-214">您可以添加`using`有你想要引用任何其他.NET Framework 命名空间的语句。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-214">You can add `using` statements for any other .NET Framework namespaces that you want to reference.</span></span> <span data-ttu-id="6e3e5-215">但是，如所述，您无需执行此操作通常情况下，因为您将使用的类的大部分都是自动导入由 ASP.NET 在中使用的命名空间中 *.cshtml*并 *.vbhtml*页。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-215">However, as noted, you won't need to do this often, because most of the classes that you'll work with are in namespaces that are imported automatically by ASP.NET for use in *.cshtml* and *.vbhtml* pages.</span></span>


<a id="Displaying_Charts"></a>
## <a name="displaying-charts-inside-a-web-page"></a><span data-ttu-id="6e3e5-216">显示在网页上的图表</span><span class="sxs-lookup"><span data-stu-id="6e3e5-216">Displaying Charts Inside a Web Page</span></span>

<span data-ttu-id="6e3e5-217">在示例中您已了解到目前为止，创建一个图表，然后再直接向浏览器作为图形呈现图表。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-217">In the examples you've seen so far, you create a chart and then the chart is rendered directly to the browser as a graphic.</span></span> <span data-ttu-id="6e3e5-218">在许多情况下，不过，你想要显示的图表作为一部分的页上，而不仅仅是通过在浏览器本身。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-218">In many cases, though, you want to display a chart as part of a page, not just by itself in the browser.</span></span> <span data-ttu-id="6e3e5-219">若要执行此操作需要两步过程。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-219">To do that requires a two-step process.</span></span> <span data-ttu-id="6e3e5-220">第一步是创建图表中，将生成的页面，如您所见。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-220">The first step is to create a page that generates the chart, as you've already seen.</span></span>

<span data-ttu-id="6e3e5-221">第二步是在另一页中显示生成的映像。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-221">The second step is to display the resulting image in another page.</span></span> <span data-ttu-id="6e3e5-222">若要显示的图像，应使用对应的 HTML`<img>`元素，在相同的方式来显示任何图像。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-222">To display the image, you use an HTML `<img>` element, in the same way you would to display any image.</span></span> <span data-ttu-id="6e3e5-223">但是，而不是引用 *.jpg*或 *.png*文件中，`<img>`元素引用 *.cshtml*文件，其中包含`Chart`帮助程序，创建的图表。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-223">However, instead of referencing a *.jpg* or *.png* file, the `<img>` element references the *.cshtml* file that contains the `Chart` helper that creates the chart.</span></span> <span data-ttu-id="6e3e5-224">显示页的运行时，则`<img>`元素获得的输出`Chart`帮助程序，并将呈现图表。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-224">When the display page runs, the `<img>` element gets the output of the `Chart` helper and renders the chart.</span></span>

![](7-displaying-data-in-a-chart/_static/image11.jpg)

1. <span data-ttu-id="6e3e5-225">创建名为的文件*ShowChart.cshtml*。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-225">Create a file named *ShowChart.cshtml*.</span></span>
2. <span data-ttu-id="6e3e5-226">使用以下内容替换现有内容：</span><span class="sxs-lookup"><span data-stu-id="6e3e5-226">Replace the existing content with the following:</span></span> 

    [!code-html[Main](7-displaying-data-in-a-chart/samples/sample9.html)]

    <span data-ttu-id="6e3e5-227">该代码使用`<img>`元素以显示你前面创建的图表*ChartArrayBasic.cshtml*文件。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-227">The code uses the `<img>` element to display the chart that you created earlier in the *ChartArrayBasic.cshtml* file.</span></span>
3. <span data-ttu-id="6e3e5-228">在浏览器中运行 web 页。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-228">Run the web page in a browser.</span></span> <span data-ttu-id="6e3e5-229">*ShowChart.cshtml*文件将显示图表图像中包含的代码基础*ChartArrayBasic.cshtml*文件。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-229">The *ShowChart.cshtml* file displays the chart image based on the code contained in the *ChartArrayBasic.cshtml* file.</span></span>

<a id="Styling_a_Chart"></a>
## <a name="styling-a-chart"></a><span data-ttu-id="6e3e5-230">设置图表的样式</span><span class="sxs-lookup"><span data-stu-id="6e3e5-230">Styling a Chart</span></span>

<span data-ttu-id="6e3e5-231">`Chart`帮助器支持大量的选项允许你自定义图表的外观。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-231">The `Chart` helper supports a large number of options that let you customize the appearance of the chart.</span></span> <span data-ttu-id="6e3e5-232">可以设置颜色、 字体、 边框和等等。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-232">You can set colors, fonts, borders, and so on.</span></span> <span data-ttu-id="6e3e5-233">若要自定义图表的外观的简单方法是使用*主题*。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-233">An easy way to customize the appearance of a chart is to use a *theme*.</span></span> <span data-ttu-id="6e3e5-234">主题是信息的指定如何呈现使用字体、 颜色、 标签、 调色板、 边框和效果的图表的集合。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-234">Themes are collections of information that specify how to render a chart using fonts, colors, labels, palettes, borders, and effects.</span></span> <span data-ttu-id="6e3e5-235">（请注意图表的样式并不表示图表的类型。）</span><span class="sxs-lookup"><span data-stu-id="6e3e5-235">(Note that the style of a chart does not indicate the type of chart.)</span></span>

<span data-ttu-id="6e3e5-236">下表列出了内置的主题。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-236">The following table lists built-in themes.</span></span>

| <span data-ttu-id="6e3e5-237">主题</span><span class="sxs-lookup"><span data-stu-id="6e3e5-237">Theme</span></span> | <span data-ttu-id="6e3e5-238">描述</span><span class="sxs-lookup"><span data-stu-id="6e3e5-238">Description</span></span> |
| --- | --- |
| `Vanilla` | <span data-ttu-id="6e3e5-239">白色背景上显示红色柱形。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-239">Displays red columns on a white background.</span></span> |
| `Blue` | <span data-ttu-id="6e3e5-240">显示蓝色蓝色的渐变背景上的列。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-240">Displays blue columns on a blue gradient background.</span></span> |
| `Green` | <span data-ttu-id="6e3e5-241">显示蓝绿色渐变背景上的列。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-241">Displays blue columns on a green gradient background.</span></span> |
| `Yellow` | <span data-ttu-id="6e3e5-242">显示黄色的渐变背景的橙色列。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-242">Displays orange columns on a yellow gradient background.</span></span> |
| `Vanilla3D` | <span data-ttu-id="6e3e5-243">白色背景上显示三维红色的列。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-243">Displays 3-D red columns on a white background.</span></span> |

<span data-ttu-id="6e3e5-244">您可以指定要在创建新图表时使用的主题。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-244">You can specify the theme to use when you create a new chart.</span></span>

1. <span data-ttu-id="6e3e5-245">创建一个名为的新文件*ChartStyleGreen.cshtml*。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-245">Create a new file named *ChartStyleGreen.cshtml*.</span></span>
2. <span data-ttu-id="6e3e5-246">在页中的现有内容替换为以下：</span><span class="sxs-lookup"><span data-stu-id="6e3e5-246">Replace the existing content in the page with the following:</span></span>

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample10.cshtml)]

    <span data-ttu-id="6e3e5-247">此代码等同于前面的示例使用的数据库的数据，但将添加`theme`参数创建时`Chart`对象。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-247">This code is the same as the earlier example that uses the database for data, but adds the `theme` parameter when it creates the `Chart` object.</span></span> <span data-ttu-id="6e3e5-248">下面显示了更改后的代码：</span><span class="sxs-lookup"><span data-stu-id="6e3e5-248">The following shows the changed code:</span></span>

    [!code-csharp[Main](7-displaying-data-in-a-chart/samples/sample11.cs)]
3. <span data-ttu-id="6e3e5-249">在浏览器中运行页。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-249">Run the page in a browser.</span></span> <span data-ttu-id="6e3e5-250">你看到与之前相同的数据，但该图表看上去更加完善：</span><span class="sxs-lookup"><span data-stu-id="6e3e5-250">You see the same data as before, but the chart looks more polished:</span></span> 

    ![](7-displaying-data-in-a-chart/_static/image12.jpg)

<a id="Saving_a_Chart"></a>
## <a name="saving-a-chart"></a><span data-ttu-id="6e3e5-251">保存图表</span><span class="sxs-lookup"><span data-stu-id="6e3e5-251">Saving a Chart</span></span>

<span data-ttu-id="6e3e5-252">当你使用`Chart`作为您的帮助器就目前而言此文章介绍了帮助程序在每次调用时它都会重新创建从零开始的图表。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-252">When you use the `Chart` helper as you've seen so far in this article, the helper re-creates the chart from scratch each time it's invoked.</span></span> <span data-ttu-id="6e3e5-253">如有必要，该图表的代码还重新查询数据库或重新读取 XML 文件来获取的数据。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-253">If necessary, the code for the chart also re-queries the database or re-reads the XML file to get the data.</span></span> <span data-ttu-id="6e3e5-254">在某些情况下，执行此操作可以是一个复杂的操作，例如如果你要查询的数据库很大，或 XML 文件包含大量数据。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-254">In some cases, doing this can be a complex operation, such as if the database that you're querying is large, or if the XML file contains a lot of data.</span></span> <span data-ttu-id="6e3e5-255">即使在图表不会涉及大量数据，动态创建映像的过程将占用服务器资源，并且如果很多人请求的页显示图表，可以有影响对你的网站的性能。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-255">Even if the chart doesn't involve a lot of data, the process of dynamically creating an image takes up server resources, and if many people request the page or pages that display the chart, there can be an impact on the performance of your website.</span></span>

<span data-ttu-id="6e3e5-256">若要帮助你减少创建图表的潜在性能影响，可以创建图表第一次需要它，然后将其保存。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-256">To help you reduce the potential performance impact of creating a chart, you can create a chart the first time you need it and then save it.</span></span> <span data-ttu-id="6e3e5-257">当图表再次需要时，而不是重新生成它，可以只是提取已保存的版本和呈现的。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-257">When the chart is needed again, rather than regenerating it, you can just fetch the saved version and render that.</span></span>

<span data-ttu-id="6e3e5-258">可以将图表保存在以下方面：</span><span class="sxs-lookup"><span data-stu-id="6e3e5-258">You can save a chart in these ways:</span></span>

- <span data-ttu-id="6e3e5-259">缓存中 （在服务器上） 的计算机内存的图表。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-259">Cache the chart in computer memory (on the server).</span></span>
- <span data-ttu-id="6e3e5-260">将图表保存为图像文件。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-260">Save the chart as an image file.</span></span>
- <span data-ttu-id="6e3e5-261">将图表保存为 XML 文件。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-261">Save the chart as an XML file.</span></span> <span data-ttu-id="6e3e5-262">此选项可以修改图表，然后将其保存。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-262">This option lets you modify the chart before you save it.</span></span>

### <a name="caching-a-chart"></a><span data-ttu-id="6e3e5-263">缓存图表</span><span class="sxs-lookup"><span data-stu-id="6e3e5-263">Caching a Chart</span></span>

<span data-ttu-id="6e3e5-264">创建图表后，可以对其进行缓存。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-264">After you've created a chart, you can cache it.</span></span> <span data-ttu-id="6e3e5-265">缓存图表意味着，它不一定是重新创建，如果需要再次显示。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-265">Caching a chart means that it doesn't have to be re-created if it needs to be displayed again.</span></span> <span data-ttu-id="6e3e5-266">时将图表保存在缓存中时，你向其提供一个键，它必须是唯一的该图表。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-266">When you save a chart in the cache, you give it a key that must be unique to that chart.</span></span>

<span data-ttu-id="6e3e5-267">如果在服务器内存不足，可能会去除图表保存到缓存。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-267">Charts saved to the cache might be removed if the server runs low on memory.</span></span> <span data-ttu-id="6e3e5-268">此外，如果出于任何原因重新启动你的应用程序清除了缓存。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-268">In addition, the cache is cleared if your application restarts for any reason.</span></span> <span data-ttu-id="6e3e5-269">因此，若要使用缓存图表的标准方法是以始终首先检查在缓存中，是可用，以及如果没有，则若要创建或重新创建它。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-269">Therefore, the standard way to work with a cached chart is to always check first whether it's available in the cache, and if not, then to create or re-create it.</span></span>

1. <span data-ttu-id="6e3e5-270">在你的网站的根目录，创建名为的文件*ShowCachedChart.cshtml*。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-270">At the root of your website, create a file named *ShowCachedChart.cshtml*.</span></span>
2. <span data-ttu-id="6e3e5-271">使用以下内容替换现有内容：</span><span class="sxs-lookup"><span data-stu-id="6e3e5-271">Replace the existing content with the following:</span></span> 

    [!code-html[Main](7-displaying-data-in-a-chart/samples/sample12.html)]

    <span data-ttu-id="6e3e5-272">`<img>`标记包含`src`属性，指向*ChartSaveToCache.cshtml*文件，并将密钥传递给查询字符串形式的页。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-272">The `<img>` tag includes a `src` attribute that points to the *ChartSaveToCache.cshtml* file and passes a key to the page as a query string.</span></span> <span data-ttu-id="6e3e5-273">项包含值&quot;myChartKey&quot;。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-273">The key contains the value &quot;myChartKey&quot;.</span></span> <span data-ttu-id="6e3e5-274">*ChartSaveToCache.cshtml*文件包含`Chart`帮助程序创建的图表。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-274">The *ChartSaveToCache.cshtml* file contains the `Chart` helper that creates the chart.</span></span> <span data-ttu-id="6e3e5-275">稍后，你将创建此页。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-275">You'll create this page in a moment.</span></span>

    <span data-ttu-id="6e3e5-276">在页面末尾是一个名为页的链接*ClearCache.cshtml*。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-276">At the end of the page there's a link to a page named *ClearCache.cshtml*.</span></span> <span data-ttu-id="6e3e5-277">这是还将稍后创建的页。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-277">That's a page that you'll also create shortly.</span></span> <span data-ttu-id="6e3e5-278">所需*ClearCache.cshtml*仅以测试此示例中的缓存，不是链接或使用缓存图表时您通常要包括的页面。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-278">You need the *ClearCache.cshtml* only to test caching for this example — it's not a link or page that you'd normally include when working with cached charts.</span></span>
3. <span data-ttu-id="6e3e5-279">在你的网站的根目录，创建名为的新文件*ChartSaveToCache.cshtml*。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-279">At the root of your website, create a new file named *ChartSaveToCache.cshtml*.</span></span>
4. <span data-ttu-id="6e3e5-280">使用以下内容替换现有内容：</span><span class="sxs-lookup"><span data-stu-id="6e3e5-280">Replace the existing content with the following:</span></span>

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample13.cshtml)]

    <span data-ttu-id="6e3e5-281">代码首先检查是否任何内容传递作为查询字符串中的密钥值。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-281">The code first checks whether anything was passed as the key value in the query string.</span></span> <span data-ttu-id="6e3e5-282">因此，该代码尝试通过调用读取缓存图表如果`GetFromCache`方法并将其传递该密钥。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-282">If so, the code tries to read a chart out of the cache by calling the `GetFromCache` method and passing it the key.</span></span> <span data-ttu-id="6e3e5-283">如果事实证明，没有任何缓存下该密钥 （后者会发生第一次请求图表） 中，代码会像往常一样创建图表。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-283">If it turns out that there's nothing in the cache under that key (which would happen the first time that the chart is requested), the code creates the chart as usual.</span></span> <span data-ttu-id="6e3e5-284">完成图表后，代码将其保存到缓存通过调用`SaveToCache`。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-284">When the chart is finished, the code saves it to the cache by calling `SaveToCache`.</span></span> <span data-ttu-id="6e3e5-285">该方法要求的密钥 （因此，图表可以请求更高版本），并且应在缓存中保存图表的时间量。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-285">That method requires a key (so the chart can be requested later), and the amount of time that the chart should be saved in the cache.</span></span> <span data-ttu-id="6e3e5-286">（将缓存图表的确切时间将取决于何种频率认为它所代表的数据可能会更改。）`SaveToCache`方法还需要`slidingExpiration`参数&#8212;如果将其设置为 true 时，超时计数器将重置每次访问图表。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-286">(The exact time you'd cache a chart would depend on how often you thought the data it represents might change.) The `SaveToCache` method also requires a `slidingExpiration` parameter &#8212; if this is set to true, the timeout counter is reset each time the chart is accessed.</span></span> <span data-ttu-id="6e3e5-287">在这种情况下，这实际上意味着图表的缓存条目过期后用户访问图表的最后一个时间 2 分钟。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-287">In this case, it in effect means that the chart's cache entry expires 2 minutes after the last time someone accessed the chart.</span></span> <span data-ttu-id="6e3e5-288">（可调过期的替代方法是绝对到期，这意味着缓存项何时过期恰好在 2 分钟后已放入缓存，无论何种频率必须被访问。）</span><span class="sxs-lookup"><span data-stu-id="6e3e5-288">(The alternative to sliding expiration is absolute expiration, meaning that the cache entry would expire exactly 2 minutes after it was put into the cache, no matter how often it had been accessed.)</span></span>

    <span data-ttu-id="6e3e5-289">最后，代码使用`WriteFromCache`方法来提取并呈现来自缓存的图表。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-289">Finally, the code uses the `WriteFromCache` method to fetch and render the chart from the cache.</span></span> <span data-ttu-id="6e3e5-290">请注意，此方法是外部`if`检查缓存中，因为它将从缓存获取图表，该图表已最初要使用还是必须生成并保存在缓存中的块。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-290">Note that this method is outside the `if` block that checks the cache, because it will get the chart from the cache whether the chart was there to begin with or had to be generated and saved in the cache.</span></span>

    <span data-ttu-id="6e3e5-291">请注意，在此示例中，`AddTitle`方法包含时间戳。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-291">Notice that in the example, the `AddTitle` method includes a timestamp.</span></span> <span data-ttu-id="6e3e5-292">(它将添加的当前日期和时间&#8212; `DateTime.Now` &#8212;为标题。)</span><span class="sxs-lookup"><span data-stu-id="6e3e5-292">(It adds the current date and time &#8212; `DateTime.Now` &#8212; to the title.)</span></span>
5. <span data-ttu-id="6e3e5-293">创建一个名为的新页*ClearCache.cshtml*和其内容替换为以下代码：</span><span class="sxs-lookup"><span data-stu-id="6e3e5-293">Create a new page named *ClearCache.cshtml* and replace its content with the following:</span></span>

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample14.cshtml)]

    <span data-ttu-id="6e3e5-294">使用此页`WebCache`帮助器来删除缓存中的图表*ChartSaveToCache.cshtml*。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-294">This page uses the `WebCache` helper to remove the chart that's cached in *ChartSaveToCache.cshtml*.</span></span> <span data-ttu-id="6e3e5-295">如前文所述，通常不必像这样的页面。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-295">As noted earlier, you don't normally have to have a page like this.</span></span> <span data-ttu-id="6e3e5-296">要创建在此处仅以使其更易于测试缓存。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-296">You're creating it here only to make it easier to test caching.</span></span>
6. <span data-ttu-id="6e3e5-297">运行*ShowCachedChart.cshtml*网页在浏览器中。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-297">Run the *ShowCachedChart.cshtml* web page in a browser.</span></span> <span data-ttu-id="6e3e5-298">该页面显示图表图像基于中包含的代码*ChartSaveToCache.cshtml*文件。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-298">The page displays the chart image based on the code contained in the *ChartSaveToCache.cshtml* file.</span></span> <span data-ttu-id="6e3e5-299">记下的时间戳显示图表标题中。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-299">Take note of what the timestamp says in the chart title.</span></span> 

    ![描述：在图表标题中的时间戳的基本图表的图片](7-displaying-data-in-a-chart/_static/image13.jpg)
7. <span data-ttu-id="6e3e5-301">关闭浏览器。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-301">Close the browser.</span></span>
8. <span data-ttu-id="6e3e5-302">运行*ShowCachedChart.cshtml*试。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-302">Run the *ShowCachedChart.cshtml* again.</span></span> <span data-ttu-id="6e3e5-303">请注意，时间戳相同与之前一样，这表示图表未重新生成，但已改为从缓存中读取。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-303">Notice that the timestamp is the same as before, which indicates that the chart was not regenerated, but was instead read from the cache.</span></span>
9. <span data-ttu-id="6e3e5-304">在中*ShowCachedChart.cshtml*，单击**清除缓存**链接。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-304">In *ShowCachedChart.cshtml*, click the **Clear cache** link.</span></span> <span data-ttu-id="6e3e5-305">将进入*ClearCache.cshtml*，报告已清除的缓存。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-305">This takes you to *ClearCache.cshtml*, which reports that the cache has been cleared.</span></span>
10. <span data-ttu-id="6e3e5-306">单击**返回到 ShowCachedChart.cshtml**链接，或重新运行*ShowCachedChart.cshtml*从 WebMatrix。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-306">Click the **Return to ShowCachedChart.cshtml** link, or re-run *ShowCachedChart.cshtml* from WebMatrix.</span></span> <span data-ttu-id="6e3e5-307">请注意，此时间已更改的时间戳，因为清除缓存。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-307">Notice that this time the timestamp has changed, because the cache has been cleared.</span></span> <span data-ttu-id="6e3e5-308">因此，代码必须重新生成图表，并将其放回缓存。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-308">Therefore, the code had to regenerate the chart and put it back into the cache.</span></span>

### <a name="saving-a-chart-as-an-image-file"></a><span data-ttu-id="6e3e5-309">将图表另存为图像文件</span><span class="sxs-lookup"><span data-stu-id="6e3e5-309">Saving a Chart as an Image File</span></span>

<span data-ttu-id="6e3e5-310">此外可以将图表保存为图像文件 (例如，作为 *.jpg*文件) 的服务器上。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-310">You can also save a chart as an image file (for example, as a *.jpg* file) on the server.</span></span> <span data-ttu-id="6e3e5-311">然后可以使用图像文件的任何图像的方式。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-311">You can then use the image file the way you would any image.</span></span> <span data-ttu-id="6e3e5-312">优点是该文件是存储而不是保存到临时缓存。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-312">The advantage is the file is stored rather than saved to a temporary cache.</span></span> <span data-ttu-id="6e3e5-313">可以将新的图表图像保存在不同时间 （例如每隔一小时），然后保留永久性记录随着时间的推移发生的更改。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-313">You can save a new chart image at different times (for example, every hour) and then keep a permanent record of the changes that occur over time.</span></span> <span data-ttu-id="6e3e5-314">请注意，您必须确保 web 应用程序具有你想要将图像文件放在服务器上将文件保存到文件夹的权限。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-314">Note that you must make sure that your web application has permission to save a file to the folder on the server where you want to put the image file.</span></span>

1. <span data-ttu-id="6e3e5-315">在你的网站的根目录，创建名为的文件夹 *\_ChartFiles*如果尚不存在。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-315">At the root of your website, create a folder named *\_ChartFiles* if it does not already exist.</span></span>
2. <span data-ttu-id="6e3e5-316">在你的网站的根目录，创建名为的新文件*ChartSave.cshtml*。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-316">At the root of your website, create a new file named *ChartSave.cshtml*.</span></span>
3. <span data-ttu-id="6e3e5-317">使用以下内容替换现有内容：</span><span class="sxs-lookup"><span data-stu-id="6e3e5-317">Replace the existing content with the following:</span></span>

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample15.cshtml)]

    <span data-ttu-id="6e3e5-318">代码首先检查以查看是否 *.jpg*文件存在通过调用`File.Exists`方法。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-318">The code first checks to see whether the *.jpg* file exists by calling the `File.Exists` method.</span></span> <span data-ttu-id="6e3e5-319">如果该文件不存在，代码会创建一个新`Chart`数组中。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-319">If the file does not exist, the code creates a new `Chart` from an array.</span></span> <span data-ttu-id="6e3e5-320">这一次，该代码调用`Save`方法，并传递`path`参数来指定文件路径和保存图表的文件名。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-320">This time, the code calls the `Save` method and passes the `path` parameter to specify the file path and file name of where to save the chart.</span></span> <span data-ttu-id="6e3e5-321">在页的正文`<img>`元素使用的路径以指向 *.jpg*文件以显示。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-321">In the body of the page, an `<img>` element uses the path to point to the *.jpg* file to display.</span></span>
4. <span data-ttu-id="6e3e5-322">运行*ChartSave.cshtml*文件。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-322">Run the *ChartSave.cshtml* file.</span></span>
5. <span data-ttu-id="6e3e5-323">返回到 WebMatrix。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-323">Return to WebMatrix.</span></span> <span data-ttu-id="6e3e5-324">请注意，名为图像文件*chart01.jpg*已保存在 *\_ChartFiles*文件夹。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-324">Notice that an image file named *chart01.jpg* has been saved in the *\_ChartFiles* folder.</span></span>

### <a name="saving-a-chart-as-an-xml-file"></a><span data-ttu-id="6e3e5-325">将图表另存为 XML 文件</span><span class="sxs-lookup"><span data-stu-id="6e3e5-325">Saving a Chart as an XML File</span></span>

<span data-ttu-id="6e3e5-326">最后，可以将图表保存为服务器上的 XML 文件。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-326">Finally, you can save a chart as an XML file on the server.</span></span> <span data-ttu-id="6e3e5-327">通过缓存图表或将图表保存到文件中使用此方法的一个优点是可以如果想要显示图表之前修改的 XML。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-327">An advantage of using this method over caching the chart or saving the chart to a file is that you could modify the XML before displaying the chart if you wanted to.</span></span> <span data-ttu-id="6e3e5-328">你的应用程序必须具有你想要将图像文件放在服务器上文件夹的读/写权限。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-328">Your application has to have read/write permissions for the folder on the server where you want to put the image file.</span></span>

1. <span data-ttu-id="6e3e5-329">在你的网站的根目录，创建名为的新文件*ChartSaveXml.cshtml*。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-329">At the root of your website, create a new file named *ChartSaveXml.cshtml*.</span></span>
2. <span data-ttu-id="6e3e5-330">使用以下内容替换现有内容：</span><span class="sxs-lookup"><span data-stu-id="6e3e5-330">Replace the existing content with the following:</span></span>

    [!code-cshtml[Main](7-displaying-data-in-a-chart/samples/sample16.cshtml)]

    <span data-ttu-id="6e3e5-331">此代码是类似于你此前看到的用于存储在缓存中，一个图表，但它使用 XML 文件的代码。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-331">This code is similar to the code that you saw earlier for storing a chart in the cache, except that it uses an XML file.</span></span> <span data-ttu-id="6e3e5-332">代码首先检查以查看 XML 文件是否存在通过调用`File.Exists`方法。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-332">The code first checks to see whether the XML file exists by calling the `File.Exists` method.</span></span> <span data-ttu-id="6e3e5-333">如果文件确实存在，代码会创建一个新`Chart`对象，并将文件名作为传递`themePath`参数。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-333">If the file does exist, the code creates a new `Chart` object and passes the file name as the `themePath` parameter.</span></span> <span data-ttu-id="6e3e5-334">这将创建基于无论是在 XML 文件中的图表。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-334">This creates the chart based on whatever's in the XML file.</span></span> <span data-ttu-id="6e3e5-335">如果 XML 文件尚不存在，代码创建示例一样正常的图表，然后调用`SaveXml`将其保存。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-335">If the XML file doesn't already exist, the code creates a chart like normal and then calls `SaveXml` to save it.</span></span> <span data-ttu-id="6e3e5-336">使用呈现图表`Write`方法中，为你前面所见。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-336">The chart is rendered using the `Write` method, as you've seen before.</span></span>

    <span data-ttu-id="6e3e5-337">与显示缓存的页面，此代码在图表标题中包含时间戳。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-337">As with the page that showed caching, this code includes a timestamp in the chart title.</span></span>
3. <span data-ttu-id="6e3e5-338">创建一个名为的新页*ChartDisplayXMLChart.cshtml*并向其添加以下标记：</span><span class="sxs-lookup"><span data-stu-id="6e3e5-338">Create a new page named *ChartDisplayXMLChart.cshtml* and add the following markup to it:</span></span> 

    [!code-html[Main](7-displaying-data-in-a-chart/samples/sample17.html)]
4. <span data-ttu-id="6e3e5-339">运行*ChartDisplayXMLChart.cshtml*页。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-339">Run the *ChartDisplayXMLChart.cshtml* page.</span></span> <span data-ttu-id="6e3e5-340">显示图表。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-340">The chart is displayed.</span></span> <span data-ttu-id="6e3e5-341">记下在图表的标题中时间戳。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-341">Take note of the timestamp in the chart's title.</span></span>
5. <span data-ttu-id="6e3e5-342">关闭浏览器。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-342">Close the browser.</span></span>
6. <span data-ttu-id="6e3e5-343">在 WebMatrix 中，右键单击 *\_ChartFiles*文件夹中，单击**刷新**，然后打开该文件夹。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-343">In WebMatrix, right-click the *\_ChartFiles* folder, click **Refresh**, and then open the folder.</span></span> <span data-ttu-id="6e3e5-344">*XMLChart.xml*此文件夹中的文件由创建`Chart`帮助器。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-344">The *XMLChart.xml* file in this folder was created by the `Chart` helper.</span></span> 

    ![描述：显示图表帮助程序创建的 XMLChart.xml 文件 _ChartFiles 文件夹。](7-displaying-data-in-a-chart/_static/image14.jpg)
7. <span data-ttu-id="6e3e5-346">运行*ChartDisplayXMLChart.cshtml*页。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-346">Run the *ChartDisplayXMLChart.cshtml* page again.</span></span> <span data-ttu-id="6e3e5-347">该图表显示相同的时间戳作为第一次运行页面。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-347">The chart shows the same timestamp as the first time you ran the page.</span></span> <span data-ttu-id="6e3e5-348">这是因为正在从以前保存的 XML 生成图表。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-348">That's because the chart is being generated from the XML you saved earlier.</span></span>
8. <span data-ttu-id="6e3e5-349">在 WebMatrix 中，打开 *\_ChartFiles*文件夹并删除*XMLChart.xml*文件。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-349">In WebMatrix, open the *\_ChartFiles* folder and delete the *XMLChart.xml* file.</span></span>
9. <span data-ttu-id="6e3e5-350">运行*ChartDisplayXMLChart.cshtml*页上一次。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-350">Run the *ChartDisplayXMLChart.cshtml* page once more.</span></span> <span data-ttu-id="6e3e5-351">这一次，更新时间戳，因为`Chart`帮助程序不得不重新创建 XML 文件。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-351">This time, the timestamp is updated, because the `Chart` helper had to recreate the XML file.</span></span> <span data-ttu-id="6e3e5-352">如果你想，检查 *\_ChartFiles*文件夹，然后请注意，XML 文件又回来了。</span><span class="sxs-lookup"><span data-stu-id="6e3e5-352">If you want, check the *\_ChartFiles* folder and notice that the XML file is back.</span></span>

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a><span data-ttu-id="6e3e5-353">其他资源</span><span class="sxs-lookup"><span data-stu-id="6e3e5-353">Additional Resources</span></span>

- [<span data-ttu-id="6e3e5-354">介绍使用数据库中 ASP.NET Web Pages 站点</span><span class="sxs-lookup"><span data-stu-id="6e3e5-354">Introduction to Working with a Database in ASP.NET Web Pages Sites</span></span>](https://go.microsoft.com/fwlink/?LinkId=202893)
- [<span data-ttu-id="6e3e5-355">使用缓存在 ASP.NET Web Pages 站点中以提高性能</span><span class="sxs-lookup"><span data-stu-id="6e3e5-355">Using Caching in ASP.NET Web Pages Sites to Improve Performance</span></span>](https://go.microsoft.com/fwlink/?LinkId=202903)
- <span data-ttu-id="6e3e5-356">[图表类](https://msdn.microsoft.com/library/system.web.helpers.chart(v=vs.99))（MSDN 上的 ASP.NET Web Pages API 参考）</span><span class="sxs-lookup"><span data-stu-id="6e3e5-356">[Chart Class](https://msdn.microsoft.com/library/system.web.helpers.chart(v=vs.99)) (ASP.NET Web Pages API reference on MSDN)</span></span>
