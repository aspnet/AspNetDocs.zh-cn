---
uid: mvc/overview/getting-started/introduction/examining-the-edit-methods-and-edit-view
title: 检查 "编辑" 方法和 "编辑视图" |Microsoft Docs
author: Rick-Anderson
description: ''
ms.author: riande
ms.date: 01/06/2019
ms.assetid: 52a4d5fe-aa31-4471-b3cb-a064f82cb791
msc.legacyurl: /mvc/overview/getting-started/introduction/examining-the-edit-methods-and-edit-view
msc.type: authoredcontent
ms.openlocfilehash: 1894971430c4febee19f095373411ed319edc015
ms.sourcegitcommit: 4e6d586faadbe4d9ef27122f86335ec9385134af
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/28/2020
ms.locfileid: "89045203"
---
# <a name="examining-the-edit-methods-and-edit-view"></a><span data-ttu-id="abf62-102">检查 Edit 方法和编辑视图</span><span class="sxs-lookup"><span data-stu-id="abf62-102">Examining the Edit Methods and Edit View</span></span>

<span data-ttu-id="abf62-103">作者： [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="abf62-103">by [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

[!INCLUDE [consider RP](~/includes/razor.md)]

<span data-ttu-id="abf62-104">在本部分中，你将检查电影控制器的生成的 `Edit` 操作方法和视图。</span><span class="sxs-lookup"><span data-stu-id="abf62-104">In this section, you'll examine the generated `Edit` action methods and views for the movie controller.</span></span> <span data-ttu-id="abf62-105">但首先我们要 diversion，使发布日期看起来更好。</span><span class="sxs-lookup"><span data-stu-id="abf62-105">But first we'll take a short diversion to make the release date look better.</span></span> <span data-ttu-id="abf62-106">打开 *Models\Movie.cs* 文件，并添加以下突出显示的行：</span><span class="sxs-lookup"><span data-stu-id="abf62-106">Open the *Models\Movie.cs* file and add the highlighted lines shown below:</span></span>

[!code-csharp[Main](examining-the-edit-methods-and-edit-view/samples/sample1.cs?highlight=2,12-14)]

<span data-ttu-id="abf62-107">你还可以将日期区域性指定为以下形式：</span><span class="sxs-lookup"><span data-stu-id="abf62-107">You can also make the date culture specific like this:</span></span>

[!code-csharp[Main](examining-the-edit-methods-and-edit-view/samples/sample2.cs?highlight=3)]

<span data-ttu-id="abf62-108">我们将在下一教程中介绍 [DataAnnotations](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.aspx)。</span><span class="sxs-lookup"><span data-stu-id="abf62-108">We'll cover [DataAnnotations](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.aspx) in the next tutorial.</span></span> <span data-ttu-id="abf62-109">[Display](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.displayattribute.aspx) 特性指定要显示的字段名称的内容（本例中应为“Release Date”，而不是“ReleaseDate”）。</span><span class="sxs-lookup"><span data-stu-id="abf62-109">The [Display](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.displayattribute.aspx) attribute specifies what to display for the name of a field (in this case "Release Date" instead of "ReleaseDate").</span></span> <span data-ttu-id="abf62-110">[DataType](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.datatypeattribute.aspx)特性指定数据的类型，在本例中为日期，因此不显示存储在字段中的时间信息。</span><span class="sxs-lookup"><span data-stu-id="abf62-110">The [DataType](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.datatypeattribute.aspx) attribute specifies the type of the data, in this case it's a date, so the time information stored in the field is not displayed.</span></span> <span data-ttu-id="abf62-111">Chrome 浏览器中的 bug 所需的 [DisplayFormat](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.displayformatattribute.aspx) 属性不正确地呈现日期格式。</span><span class="sxs-lookup"><span data-stu-id="abf62-111">The [DisplayFormat](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.displayformatattribute.aspx) attribute is needed for a bug in the Chrome browser that renders date formats incorrectly.</span></span>

<span data-ttu-id="abf62-112">运行应用程序并浏览到 `Movies` 控制器。</span><span class="sxs-lookup"><span data-stu-id="abf62-112">Run the application and browse to the `Movies` controller.</span></span> <span data-ttu-id="abf62-113">将鼠标指针停留在 **编辑** 链接上可查看它所链接到的 URL。</span><span class="sxs-lookup"><span data-stu-id="abf62-113">Hold the mouse pointer over an **Edit** link to see the URL that it links to.</span></span>

![EditLink_sm](examining-the-edit-methods-and-edit-view/_static/image1.png)

<span data-ttu-id="abf62-115">**编辑**链接由 `Html.ActionLink` *Views\Movies\Index.cshtml*视图中的方法生成：</span><span class="sxs-lookup"><span data-stu-id="abf62-115">The **Edit** link was generated by the `Html.ActionLink` method in the *Views\Movies\Index.cshtml* view:</span></span>

[!code-cshtml[Main](examining-the-edit-methods-and-edit-view/samples/sample3.cshtml)]

![Html.actionlink](examining-the-edit-methods-and-edit-view/_static/image2.png)

<span data-ttu-id="abf62-117">`Html`对象是一个使用[WebViewPage](https://msdn.microsoft.com/library/gg402107(VS.98).aspx)基类上的属性公开的帮助器。</span><span class="sxs-lookup"><span data-stu-id="abf62-117">The `Html` object is a helper that's exposed using a property on the [System.Web.Mvc.WebViewPage](https://msdn.microsoft.com/library/gg402107(VS.98).aspx) base class.</span></span> <span data-ttu-id="abf62-118">`ActionLink`利用帮助器的方法，可以轻松地动态生成链接到控制器操作方法的 HTML 超链接。</span><span class="sxs-lookup"><span data-stu-id="abf62-118">The `ActionLink` method of the helper makes it easy to dynamically generate HTML hyperlinks that link to action methods on controllers.</span></span> <span data-ttu-id="abf62-119">方法的第一个参数 `ActionLink` 是要呈现的链接文本 (例如 `<a>Edit Me</a>`) 。</span><span class="sxs-lookup"><span data-stu-id="abf62-119">The first argument to the `ActionLink` method is the link text to render (for example, `<a>Edit Me</a>`).</span></span> <span data-ttu-id="abf62-120">第二个参数是要调用的操作方法的名称，在此示例中 (`Edit`) 操作。</span><span class="sxs-lookup"><span data-stu-id="abf62-120">The second argument is the name of the action method to invoke (In this case, the `Edit` action).</span></span> <span data-ttu-id="abf62-121">最后一个自变量是在此示例中生成路由数据 (的 [匿名对象](https://weblogs.asp.net/scottgu/archive/2007/05/15/new-orcas-language-feature-anonymous-types.aspx) ，ID 为 4) 。</span><span class="sxs-lookup"><span data-stu-id="abf62-121">The final argument is an [anonymous object](https://weblogs.asp.net/scottgu/archive/2007/05/15/new-orcas-language-feature-anonymous-types.aspx) that generates the route data (in this case, the ID of 4).</span></span>

<span data-ttu-id="abf62-122">上图中显示的生成链接是 `http://localhost:1234/Movies/Edit/4` 。</span><span class="sxs-lookup"><span data-stu-id="abf62-122">The generated link shown in the previous image is `http://localhost:1234/Movies/Edit/4`.</span></span> <span data-ttu-id="abf62-123">在 *应用 \_ Start\RouteConfig.cs* 中建立的默认路由 () 采用 URL 模式 `{controller}/{action}/{id}` 。</span><span class="sxs-lookup"><span data-stu-id="abf62-123">The default route (established in *App\_Start\RouteConfig.cs*) takes the URL pattern `{controller}/{action}/{id}`.</span></span> <span data-ttu-id="abf62-124">因此，ASP.NET 将转换为 `http://localhost:1234/Movies/Edit/4` `Edit` 控制器操作方法的请求，该方法的 `Movies` 参数 `ID` 等于4。</span><span class="sxs-lookup"><span data-stu-id="abf62-124">Therefore, ASP.NET translates `http://localhost:1234/Movies/Edit/4` into a request to the `Edit` action method of the `Movies` controller with the parameter `ID` equal to 4.</span></span> <span data-ttu-id="abf62-125">从 *应用程序 \_ Start\RouteConfig.cs* 文件中检查以下代码。</span><span class="sxs-lookup"><span data-stu-id="abf62-125">Examine the following code from the *App\_Start\RouteConfig.cs* file.</span></span> <span data-ttu-id="abf62-126">[Maproute.html](../../older-versions-1/controllers-and-routing/asp-net-mvc-routing-overview-cs.md)方法用于将 HTTP 请求路由到正确的控制器和操作方法，并提供可选的 ID 参数。</span><span class="sxs-lookup"><span data-stu-id="abf62-126">The [MapRoute](../../older-versions-1/controllers-and-routing/asp-net-mvc-routing-overview-cs.md) method is used to route HTTP requests to the correct controller and action method and supply the optional ID parameter.</span></span> <span data-ttu-id="abf62-127">[HtmlHelpers](https://msdn.microsoft.com/library/system.web.mvc.htmlhelper(v=vs.108).aspx)使用[maproute.html](../../older-versions-1/controllers-and-routing/asp-net-mvc-routing-overview-cs.md)方法 `ActionLink` 来生成 url，如控制器、操作方法和任何路由数据。</span><span class="sxs-lookup"><span data-stu-id="abf62-127">The [MapRoute](../../older-versions-1/controllers-and-routing/asp-net-mvc-routing-overview-cs.md) method is also used by the [HtmlHelpers](https://msdn.microsoft.com/library/system.web.mvc.htmlhelper(v=vs.108).aspx) such as `ActionLink` to generate URLs given the controller, action method and any route data.</span></span>

[!code-csharp[Main](examining-the-edit-methods-and-edit-view/samples/sample4.cs?highlight=7)]

<span data-ttu-id="abf62-128">你还可以使用查询字符串传递操作方法参数。</span><span class="sxs-lookup"><span data-stu-id="abf62-128">You can also pass action method parameters using a query string.</span></span> <span data-ttu-id="abf62-129">例如，URL 还将 `http://localhost:1234/Movies/Edit?ID=3` 3 的参数传递 `ID` 给 `Edit` 控制器的操作方法 `Movies` 。</span><span class="sxs-lookup"><span data-stu-id="abf62-129">For example, the URL `http://localhost:1234/Movies/Edit?ID=3` also passes the parameter `ID` of 3 to the `Edit` action method of the `Movies` controller.</span></span>

![EditQueryString](examining-the-edit-methods-and-edit-view/_static/image3.png)

<span data-ttu-id="abf62-131">打开 `Movies` 控制器。</span><span class="sxs-lookup"><span data-stu-id="abf62-131">Open the `Movies` controller.</span></span> <span data-ttu-id="abf62-132">下面显示了这两个 `Edit` 操作方法。</span><span class="sxs-lookup"><span data-stu-id="abf62-132">The two `Edit` action methods are shown below.</span></span>

[!code-csharp[Main](examining-the-edit-methods-and-edit-view/samples/sample5.cs?highlight=19-21)]

<span data-ttu-id="abf62-133">请注意第二个 `Edit` 操作方法的前面是 `HttpPost` 特性。</span><span class="sxs-lookup"><span data-stu-id="abf62-133">Notice the second `Edit` action method is preceded by the `HttpPost` attribute.</span></span> <span data-ttu-id="abf62-134">此特性指定只能 `Edit` 为 POST 请求调用方法的重载。</span><span class="sxs-lookup"><span data-stu-id="abf62-134">This attribute specifies that the overload of the `Edit` method can be invoked only for POST requests.</span></span> <span data-ttu-id="abf62-135">您可以将属性应用于 `HttpGet` 第一个编辑方法，但这并不是必需的，因为它是默认值。</span><span class="sxs-lookup"><span data-stu-id="abf62-135">You could apply the `HttpGet` attribute to the first edit method, but that's not necessary because it's the default.</span></span> <span data-ttu-id="abf62-136"> (将引用隐式分配属性作为方法的操作方法 `HttpGet` `HttpGet` 。 ) [Bind](https://msdn.microsoft.com/library/system.web.mvc.bindattribute(v=vs.108).aspx) 特性是另一个重要的安全机制，可防止黑客将数据过度发布到模型。</span><span class="sxs-lookup"><span data-stu-id="abf62-136">(We'll refer to action methods that are implicitly assigned the `HttpGet` attribute as `HttpGet` methods.) The [Bind](https://msdn.microsoft.com/library/system.web.mvc.bindattribute(v=vs.108).aspx) attribute is another important security mechanism that keeps hackers from over-posting data to your model.</span></span> <span data-ttu-id="abf62-137">只应在要更改的 bind 特性中包括属性。</span><span class="sxs-lookup"><span data-stu-id="abf62-137">You should only include properties in the bind attribute that you want to change.</span></span> <span data-ttu-id="abf62-138">可以在我的 [过多发布安全说明](https://go.microsoft.com/fwlink/?LinkId=317598)中阅读过多发布和 bind 属性。</span><span class="sxs-lookup"><span data-stu-id="abf62-138">You can read about overposting and the bind attribute in my [overposting security note](https://go.microsoft.com/fwlink/?LinkId=317598).</span></span> <span data-ttu-id="abf62-139">在本教程中使用的简单模型中，将绑定模型中的所有数据。</span><span class="sxs-lookup"><span data-stu-id="abf62-139">In the simple model used in this tutorial, we will be binding all the data in the model.</span></span> <span data-ttu-id="abf62-140">[ValidateAntiForgeryToken](https://msdn.microsoft.com/library/system.web.mvc.validateantiforgerytokenattribute(v=vs.108).aspx)属性用于防止请求伪造，并 `@Html.AntiForgeryToken()` 在编辑视图文件 (*Views\Movies\Edit.cshtml*) 中配对，部分如下所示：</span><span class="sxs-lookup"><span data-stu-id="abf62-140">The [ValidateAntiForgeryToken](https://msdn.microsoft.com/library/system.web.mvc.validateantiforgerytokenattribute(v=vs.108).aspx) attribute is used to prevent forgery of a request and is paired up with `@Html.AntiForgeryToken()` in the edit view file (*Views\Movies\Edit.cshtml*), a portion is shown below:</span></span>

[!code-cshtml[Main](examining-the-edit-methods-and-edit-view/samples/sample6.cshtml?highlight=9)]

<span data-ttu-id="abf62-141">`@Html.AntiForgeryToken()` 生成一个隐藏的窗体 anti-spam 标记，该标记在控制器的方法中必须匹配 `Edit` `Movies` 。</span><span class="sxs-lookup"><span data-stu-id="abf62-141">`@Html.AntiForgeryToken()` generates a hidden form anti-forgery token that must match in the `Edit` method of the `Movies` controller.</span></span> <span data-ttu-id="abf62-142">有关跨站点请求 (伪造的详细信息，请参阅 XSRF 或 CSRF) 中的教程 [XSRF/CSRF/](../../security/xsrfcsrf-prevention-in-aspnet-mvc-and-web-pages.md)。</span><span class="sxs-lookup"><span data-stu-id="abf62-142">You can read more about Cross-site request forgery (also known as XSRF or CSRF) in my tutorial [XSRF/CSRF Prevention in MVC](../../security/xsrfcsrf-prevention-in-aspnet-mvc-and-web-pages.md).</span></span>

<span data-ttu-id="abf62-143">`HttpGet` `Edit` 方法采用 "影片 ID" 参数，使用实体框架方法查找电影 `Find` ，并将所选电影返回到 "编辑" 视图。</span><span class="sxs-lookup"><span data-stu-id="abf62-143">The `HttpGet` `Edit` method takes the movie ID parameter, looks up the movie using the Entity Framework `Find` method, and returns the selected movie to the Edit view.</span></span> <span data-ttu-id="abf62-144">如果找不到电影，则返回 [HttpNotFound](https://msdn.microsoft.com/library/gg453938(VS.98).aspx) 。</span><span class="sxs-lookup"><span data-stu-id="abf62-144">If a movie cannot be found, [HttpNotFound](https://msdn.microsoft.com/library/gg453938(VS.98).aspx) is returned.</span></span> <span data-ttu-id="abf62-145">当基架系统创建“编辑”视图时，它会检查 `Movie` 类并创建代码为类的每个属性呈现 `<label>` 和 `<input>` 元素。</span><span class="sxs-lookup"><span data-stu-id="abf62-145">When the scaffolding system created the Edit view, it examined the `Movie` class and created code to render `<label>` and `<input>` elements for each property of the class.</span></span> <span data-ttu-id="abf62-146">下面的示例演示了 visual studio 基架系统生成的编辑视图：</span><span class="sxs-lookup"><span data-stu-id="abf62-146">The following example shows the Edit view that was generated by the visual studio scaffolding system:</span></span>

[!code-cshtml[Main](examining-the-edit-methods-and-edit-view/samples/sample7.cshtml)]

<span data-ttu-id="abf62-147">请注意视图模板如何 `@model MvcMovie.Models.Movie` 在文件顶部包含一条语句，这会指定该视图要求视图模板的模型为类型 `Movie` 。</span><span class="sxs-lookup"><span data-stu-id="abf62-147">Notice how the view template has a `@model MvcMovie.Models.Movie` statement at the top of the file — this specifies that the view expects the model for the view template to be of type `Movie`.</span></span>

<span data-ttu-id="abf62-148">基架代码使用多个 *帮助器方法* 来简化 HTML 标记。</span><span class="sxs-lookup"><span data-stu-id="abf62-148">The scaffolded code uses several *helper methods* to streamline the HTML markup.</span></span> <span data-ttu-id="abf62-149">[`Html.LabelFor`](https://msdn.microsoft.com/library/gg401864(VS.98).aspx)帮助器显示 (&quot; 标题 &quot; 、 &quot; ReleaseDate &quot; 、 &quot; 流派 &quot; 或 &quot; 价格 &quot;) 的字段的名称。</span><span class="sxs-lookup"><span data-stu-id="abf62-149">The [`Html.LabelFor`](https://msdn.microsoft.com/library/gg401864(VS.98).aspx) helper displays the name of the field (&quot;Title&quot;, &quot;ReleaseDate&quot;, &quot;Genre&quot;, or &quot;Price&quot;).</span></span> <span data-ttu-id="abf62-150">[`Html.EditorFor`](https://msdn.microsoft.com/library/system.web.mvc.html.editorextensions.editorfor(VS.98).aspx)帮助器呈现一个 HTML `<input>` 元素。</span><span class="sxs-lookup"><span data-stu-id="abf62-150">The [`Html.EditorFor`](https://msdn.microsoft.com/library/system.web.mvc.html.editorextensions.editorfor(VS.98).aspx) helper renders an HTML `<input>` element.</span></span> <span data-ttu-id="abf62-151">[`Html.ValidationMessageFor`](https://msdn.microsoft.com/library/system.web.mvc.html.validationextensions.validationmessagefor(VS.98).aspx)帮助器将显示与该属性相关联的所有验证消息。</span><span class="sxs-lookup"><span data-stu-id="abf62-151">The [`Html.ValidationMessageFor`](https://msdn.microsoft.com/library/system.web.mvc.html.validationextensions.validationmessagefor(VS.98).aspx) helper displays any validation messages associated with that property.</span></span>

<span data-ttu-id="abf62-152">运行应用程序并导航到 */Movies* URL。</span><span class="sxs-lookup"><span data-stu-id="abf62-152">Run the application and navigate to the */Movies* URL.</span></span> <span data-ttu-id="abf62-153">点击“编辑”链接。</span><span class="sxs-lookup"><span data-stu-id="abf62-153">Click an **Edit** link.</span></span> <span data-ttu-id="abf62-154">在浏览器中查看页面的源。</span><span class="sxs-lookup"><span data-stu-id="abf62-154">In the browser, view the source for the page.</span></span> <span data-ttu-id="abf62-155">窗体元素的 HTML 如下所示。</span><span class="sxs-lookup"><span data-stu-id="abf62-155">The HTML for the form element is shown below.</span></span>

[!code-cshtml[Main](examining-the-edit-methods-and-edit-view/samples/sample8.cshtml?highlight=1-2)]

<span data-ttu-id="abf62-156">`<input>`元素位于一个 HTML 元素中， `<form>` 其 `action` 特性设置为发布到 */Movies/Edit* URL。</span><span class="sxs-lookup"><span data-stu-id="abf62-156">The `<input>` elements are in an HTML `<form>` element whose `action` attribute is set to post to the */Movies/Edit* URL.</span></span> <span data-ttu-id="abf62-157">单击 " **保存** " 按钮后，窗体数据将发布到服务器。</span><span class="sxs-lookup"><span data-stu-id="abf62-157">The form data will be posted to the server when the **Save** button is clicked.</span></span> <span data-ttu-id="abf62-158">第二行显示调用生成的隐藏的 [XSRF](../../security/xsrfcsrf-prevention-in-aspnet-mvc-and-web-pages.md) 标记 `@Html.AntiForgeryToken()` 。</span><span class="sxs-lookup"><span data-stu-id="abf62-158">The second line shows the hidden [XSRF](../../security/xsrfcsrf-prevention-in-aspnet-mvc-and-web-pages.md) token generated by the `@Html.AntiForgeryToken()` call.</span></span>

## <a name="processing-the-post-request"></a><span data-ttu-id="abf62-159">处理 POST 请求</span><span class="sxs-lookup"><span data-stu-id="abf62-159">Processing the POST Request</span></span>

<span data-ttu-id="abf62-160">以下列表显示了 `Edit` 操作方法的 `HttpPost` 版本。</span><span class="sxs-lookup"><span data-stu-id="abf62-160">The following listing shows the `HttpPost` version of the `Edit` action method.</span></span>

[!code-csharp[Main](examining-the-edit-methods-and-edit-view/samples/sample9.cs)]

<span data-ttu-id="abf62-161">[ValidateAntiForgeryToken](https://msdn.microsoft.com/library/system.web.mvc.validateantiforgerytokenattribute(v=vs.108).aspx)属性验证视图中的调用生成的[XSRF](../../security/xsrfcsrf-prevention-in-aspnet-mvc-and-web-pages.md)标记 `@Html.AntiForgeryToken()` 。</span><span class="sxs-lookup"><span data-stu-id="abf62-161">The [ValidateAntiForgeryToken](https://msdn.microsoft.com/library/system.web.mvc.validateantiforgerytokenattribute(v=vs.108).aspx) attribute validates the [XSRF](../../security/xsrfcsrf-prevention-in-aspnet-mvc-and-web-pages.md) token generated by the `@Html.AntiForgeryToken()` call in the view.</span></span>

<span data-ttu-id="abf62-162">[ASP.NET MVC 模型联编](https://msdn.microsoft.com/library/dd410405.aspx)程序使用已发布的窗体值并创建 `Movie` 作为参数传递的对象 `movie` 。</span><span class="sxs-lookup"><span data-stu-id="abf62-162">The [ASP.NET MVC model binder](https://msdn.microsoft.com/library/dd410405.aspx) takes the posted form values and creates a `Movie` object that's passed as the `movie` parameter.</span></span> <span data-ttu-id="abf62-163">`ModelState.IsValid`验证在表单中提交的数据是否可用于修改对象)  (编辑或更新 `Movie` 。</span><span class="sxs-lookup"><span data-stu-id="abf62-163">The `ModelState.IsValid` verifies that the data submitted in the form can be used to modify (edit or update) a `Movie` object.</span></span> <span data-ttu-id="abf62-164">如果数据有效，则会将电影数据保存到 `Movies` `db`)  (实例的集合中 `MovieDBContext` 。</span><span class="sxs-lookup"><span data-stu-id="abf62-164">If the data is valid, the movie data is saved to the `Movies` collection of the `db`(`MovieDBContext` instance).</span></span> <span data-ttu-id="abf62-165">通过调用的方法，将新的电影数据保存到数据库中 `SaveChanges` `MovieDBContext` 。</span><span class="sxs-lookup"><span data-stu-id="abf62-165">The new movie data is saved to the database by calling the `SaveChanges` method of `MovieDBContext`.</span></span> <span data-ttu-id="abf62-166">保存数据后，代码将用户重定向到 `MoviesController` 类的 `Index` 操作方法，此方法显示电影集合，包括刚才所做的更改。</span><span class="sxs-lookup"><span data-stu-id="abf62-166">After saving the data, the code redirects the user to the `Index` action method of the `MoviesController` class, which displays the movie collection, including the changes just made.</span></span>

<span data-ttu-id="abf62-167">一旦客户端验证确定字段的值无效，就会显示一条错误消息。</span><span class="sxs-lookup"><span data-stu-id="abf62-167">As soon as the client-side validation determines the value of a field isn't valid, an error message is displayed.</span></span> <span data-ttu-id="abf62-168">如果禁用 JavaScript，将禁用客户端验证。</span><span class="sxs-lookup"><span data-stu-id="abf62-168">If JavaScript is disabled, client side validation is disabled.</span></span> <span data-ttu-id="abf62-169">但是，服务器会检测到已发布的值无效，并且将显示错误消息的窗体值。</span><span class="sxs-lookup"><span data-stu-id="abf62-169">However, the server detects the posted values aren't valid, and the form values are redisplayed with error messages.</span></span>

<span data-ttu-id="abf62-170">稍后将在本教程中更详细地检查验证。</span><span class="sxs-lookup"><span data-stu-id="abf62-170">Validation is examined in more detail later in the tutorial.</span></span>

<span data-ttu-id="abf62-171">`Html.ValidationMessageFor`*编辑.* view 模板中的帮助器负责显示适当的错误消息。</span><span class="sxs-lookup"><span data-stu-id="abf62-171">The `Html.ValidationMessageFor` helpers in the *Edit.cshtml* view template take care of displaying appropriate error messages.</span></span>

![abcNotValid](examining-the-edit-methods-and-edit-view/_static/image4.png)

<span data-ttu-id="abf62-173">所有 `HttpGet` 方法都遵循类似的模式。</span><span class="sxs-lookup"><span data-stu-id="abf62-173">All the `HttpGet` methods follow a similar pattern.</span></span> <span data-ttu-id="abf62-174">它们获取影片对象 (或对象列表（在) 情况下）， `Index` 并将模型传递给视图。</span><span class="sxs-lookup"><span data-stu-id="abf62-174">They get a movie object (or list of objects, in the case of `Index`), and pass the model to the view.</span></span> <span data-ttu-id="abf62-175">`Create`方法将空电影对象传递到 "创建" 视图。</span><span class="sxs-lookup"><span data-stu-id="abf62-175">The `Create` method passes an empty movie object to the Create view.</span></span> <span data-ttu-id="abf62-176">在方法的 `HttpPost` 重载中，创建、编辑、删除或以其他方式修改数据的所有方法都执行此操作。</span><span class="sxs-lookup"><span data-stu-id="abf62-176">All the methods that create, edit, delete, or otherwise modify data do so in the `HttpPost` overload of the method.</span></span> <span data-ttu-id="abf62-177">修改 HTTP GET 方法中的数据存在安全风险，如博客文章 [ASP.NET MVC Tip #46 中所述–不要使用删除链接，因为它们创建了安全漏洞](http://stephenwalther.com/blog/archive/2009/01/21/asp.net-mvc-tip-46-ndash-donrsquot-use-delete-links-because.aspx)。</span><span class="sxs-lookup"><span data-stu-id="abf62-177">Modifying data in an HTTP GET method is a security risk, as described in the blog post entry [ASP.NET MVC Tip #46 – Don't use Delete Links because they create Security Holes](http://stephenwalther.com/blog/archive/2009/01/21/asp.net-mvc-tip-46-ndash-donrsquot-use-delete-links-because.aspx).</span></span> <span data-ttu-id="abf62-178">修改 GET 方法中的数据也违反了 HTTP 最佳做法和体系结构 [REST](http://en.wikipedia.org/wiki/Representational_State_Transfer) 模式，该模式指定 GET 请求不应更改应用程序的状态。</span><span class="sxs-lookup"><span data-stu-id="abf62-178">Modifying data in a GET method also violates HTTP best practices and the architectural [REST](http://en.wikipedia.org/wiki/Representational_State_Transfer) pattern, which specifies that GET requests should not change the state of your application.</span></span> <span data-ttu-id="abf62-179">换句话说，执行 GET 操作应是没有任何隐患的安全操作，也不会修改持久数据。</span><span class="sxs-lookup"><span data-stu-id="abf62-179">In other words, performing a GET operation should be a safe operation that has no side effects and doesn't modify your persisted data.</span></span>

## <a name="jquery-validation-for-non-english-locales"></a><span data-ttu-id="abf62-180">非英语区域设置的 jQuery 验证</span><span class="sxs-lookup"><span data-stu-id="abf62-180">jQuery validation for non-English locales</span></span>

<span data-ttu-id="abf62-181">如果你使用的是美国英语计算机，则可以跳过本部分并转到下一教程。</span><span class="sxs-lookup"><span data-stu-id="abf62-181">If you are using a US-English computer, you can skip this section and go to the next tutorial.</span></span> <span data-ttu-id="abf62-182">你可以在 [此处](https://archive.msdn.microsoft.com/Project/Download/FileDownload.aspx?ProjectName=aspnetmvcsamples&amp;DownloadId=16475)下载本教程的全球化版本。</span><span class="sxs-lookup"><span data-stu-id="abf62-182">You can download the Globalize version of this tutorial [here](https://archive.msdn.microsoft.com/Project/Download/FileDownload.aspx?ProjectName=aspnetmvcsamples&amp;DownloadId=16475).</span></span> <span data-ttu-id="abf62-183">有关国际化的优秀两部分教程，请参阅 [Nadeem 的 ASP.NET MVC 5 国际化](http://afana.me/post/aspnet-mvc-internationalization.aspx)。</span><span class="sxs-lookup"><span data-stu-id="abf62-183">For an excellent two part tutorial on Internationalization, see [Nadeem's ASP.NET MVC 5 Internationalization](http://afana.me/post/aspnet-mvc-internationalization.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="abf62-184">若要支持使用逗号 (的非英语区域设置的 jQuery 验证 &quot; 、 &quot;) 用于小数点和非美国英语日期格式，你必须将 *globalize.js* 和特定 *区域性/globalize.cultures.js* 文件从 [https://github.com/jquery/globalize](https://github.com/jquery/globalize) (和 JavaScript ) 到使用 `Globalize.parseFloat` 。</span><span class="sxs-lookup"><span data-stu-id="abf62-184">to support jQuery validation for non-English locales that use a comma (&quot;,&quot;) for a decimal point, and non US-English date formats, you must include *globalize.js* and your specific *cultures/globalize.cultures.js* file(from [https://github.com/jquery/globalize](https://github.com/jquery/globalize) ) and JavaScript to use `Globalize.parseFloat`.</span></span> <span data-ttu-id="abf62-185">可以从 NuGet 获取 jQuery 非英语验证。</span><span class="sxs-lookup"><span data-stu-id="abf62-185">You can get the jQuery non-English validation from NuGet.</span></span> <span data-ttu-id="abf62-186">如果你使用的是英语区域设置， (不安装全球化。 ) </span><span class="sxs-lookup"><span data-stu-id="abf62-186">(Don't install Globalize if you are using a English locale.)</span></span>

1. <span data-ttu-id="abf62-187">从 " **工具** " 菜单中，单击 " **Nuget 包管理器**"，然后单击 " **管理解决方案的 NuGet 包**"。</span><span class="sxs-lookup"><span data-stu-id="abf62-187">From the **Tools** menu click **NuGet Package Manager**, and then click **Manage NuGet Packages for Solution**.</span></span>

    ![](examining-the-edit-methods-and-edit-view/_static/image5.png)
2. <span data-ttu-id="abf62-188">在左侧窗格中，选择 "<strong>浏览"\*。</strong> \* (参阅下图。 ) </span><span class="sxs-lookup"><span data-stu-id="abf62-188">On the left pane, select <strong>Browse *.</strong>*(See the image below.)</span></span>
3. <span data-ttu-id="abf62-189">在 "输入" 框中，输入 \* 全球化 \* \*。</span><span class="sxs-lookup"><span data-stu-id="abf62-189">In the input box, enter \*Globalize\*\*.</span></span>

    <span data-ttu-id="abf62-190">![](examining-the-edit-methods-and-edit-view/_static/image6.png) 选择 `jQuery.Validation.Globalize` "选择"， `MvcMovie` 然后单击 " **安装**"。</span><span class="sxs-lookup"><span data-stu-id="abf62-190">![](examining-the-edit-methods-and-edit-view/_static/image6.png) Choose `jQuery.Validation.Globalize`, choose `MvcMovie` and click **Install**.</span></span> <span data-ttu-id="abf62-191">*Scripts\jquery.globalize\globalize.js*文件将添加到你的项目中。</span><span class="sxs-lookup"><span data-stu-id="abf62-191">The *Scripts\jquery.globalize\globalize.js* file will be added to your project.</span></span> <span data-ttu-id="abf62-192">\* Scripts\jquery.globalize\cultures \* 文件夹将包含许多区域性 JavaScript 文件。</span><span class="sxs-lookup"><span data-stu-id="abf62-192">The \*Scripts\jquery.globalize\cultures\* folder will contain many culture JavaScript files.</span></span> <span data-ttu-id="abf62-193">请注意，安装此包可能需要5分钟。</span><span class="sxs-lookup"><span data-stu-id="abf62-193">Note, it may take five minutes to install this package.</span></span>

   <span data-ttu-id="abf62-194">下面的代码演示对 Views\Movies\Edit.cshtml 文件所做的修改：</span><span class="sxs-lookup"><span data-stu-id="abf62-194">The following code shows the modifications to the Views\Movies\Edit.cshtml file:</span></span>

[!code-cshtml[Main](examining-the-edit-methods-and-edit-view/samples/sample10.cshtml)]

<span data-ttu-id="abf62-195">若要避免在每个编辑视图中重复此代码，可以将其移动到布局文件中。</span><span class="sxs-lookup"><span data-stu-id="abf62-195">To avoid repeating this code in every Edit view, you can move it to the layout file.</span></span> <span data-ttu-id="abf62-196">若要优化脚本下载，请参阅我的教程 [捆绑和缩减](../../performance/bundling-and-minification.md)。</span><span class="sxs-lookup"><span data-stu-id="abf62-196">To optimize the script download, see my tutorial [Bundling and Minification](../../performance/bundling-and-minification.md).</span></span>

<span data-ttu-id="abf62-197">有关详细信息，请参阅 [ASP.NET mvc 3 国际化](http://afana.me/post/aspnet-mvc-internationalization.aspx) 和 [ASP.NET MVC 3 国际化-第2部分 (NerdDinner) ](http://afana.me/post/aspnet-mvc-internationalization-part-2.aspx)。</span><span class="sxs-lookup"><span data-stu-id="abf62-197">For more information see [ASP.NET MVC 3 Internationalization](http://afana.me/post/aspnet-mvc-internationalization.aspx) and [ASP.NET MVC 3 Internationalization - Part 2 (NerdDinner)](http://afana.me/post/aspnet-mvc-internationalization-part-2.aspx).</span></span>

<span data-ttu-id="abf62-198">作为临时修补程序，如果无法在区域设置中使用验证，则可以强制计算机使用美国英语，或者可以在浏览器中禁用 JavaScript。</span><span class="sxs-lookup"><span data-stu-id="abf62-198">As a temporary fix, if you can't get validation working in your locale, you can force your computer to use US English or you can disable JavaScript in your browser.</span></span> <span data-ttu-id="abf62-199">若要强制计算机使用美国英语，可以将全球化元素添加到项目根 *web.config* 文件中。</span><span class="sxs-lookup"><span data-stu-id="abf62-199">To force your computer to use US English, you can add the globalization element to the projects root *web.config* file.</span></span> <span data-ttu-id="abf62-200">下面的代码演示将区域性设置为美国英语的全球化元素。</span><span class="sxs-lookup"><span data-stu-id="abf62-200">The following code shows the globalization element with the culture set to United States English.</span></span>

[!code-xml[Main](examining-the-edit-methods-and-edit-view/samples/sample11.xml)]

<a id="gettingstarted"></a><span data-ttu-id="abf62-201"><a id="jQueryAjaxJSON"></a> 在下一教程中，我们将实现搜索功能。</span><span class="sxs-lookup"><span data-stu-id="abf62-201"><a id="jQueryAjaxJSON"></a> In the next tutorial, we'll implement search functionality.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="abf62-202">[上一页](accessing-your-models-data-from-a-controller.md)
> [下一页](adding-search.md)</span><span class="sxs-lookup"><span data-stu-id="abf62-202">[Previous](accessing-your-models-data-from-a-controller.md)
[Next](adding-search.md)</span></span>
