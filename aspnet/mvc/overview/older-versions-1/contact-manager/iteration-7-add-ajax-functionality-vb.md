---
uid: mvc/overview/older-versions-1/contact-manager/iteration-7-add-ajax-functionality-vb
title: 迭代#7 = 添加 Ajax 功能 （VB） |微软文档
author: rick-anderson
description: 在第七次迭代中，我们通过增加对Ajax的支持来提高应用程序的响应性和性能。
ms.author: riande
ms.date: 02/20/2009
ms.assetid: f640e063-150e-453d-8cfc-7e54a6ce0f1e
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-7-add-ajax-functionality-vb
msc.type: authoredcontent
ms.openlocfilehash: 04eaaa129a56b765c090e64118ed528c65987b50
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542295"
---
# <a name="iteration-7--add-ajax-functionality-vb"></a><span data-ttu-id="3ca5e-103">迭代 7 – 添加 Ajax 功能 (VB)</span><span class="sxs-lookup"><span data-stu-id="3ca5e-103">Iteration #7 – Add Ajax functionality (VB)</span></span>

<span data-ttu-id="3ca5e-104">由[微软](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="3ca5e-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="3ca5e-105">下载代码</span><span class="sxs-lookup"><span data-stu-id="3ca5e-105">Download Code</span></span>](iteration-7-add-ajax-functionality-vb/_static/contactmanager_7_vb1.zip)

> <span data-ttu-id="3ca5e-106">在第七次迭代中，我们通过增加对Ajax的支持来提高应用程序的响应性和性能。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-106">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="building-a-contact-management-aspnet-mvc-application-vb"></a><span data-ttu-id="3ca5e-107">构建 MVC 应用程序 （VB） ASP.NET联系人管理</span><span class="sxs-lookup"><span data-stu-id="3ca5e-107">Building a Contact Management ASP.NET MVC Application (VB)</span></span>

<span data-ttu-id="3ca5e-108">在本系列教程中，我们从头到尾构建整个联系人管理应用程序。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-108">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="3ca5e-109">通过联系人管理器应用程序，您可以存储联系人信息 （姓名、电话号码和电子邮件地址） 人员列表。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-109">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="3ca5e-110">我们通过多次迭代构建应用程序。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-110">We build the application over multiple iterations.</span></span> <span data-ttu-id="3ca5e-111">每次迭代时，我们都会逐步改进应用程序。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-111">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="3ca5e-112">此多迭代方法的目标是使您能够了解每次更改的原因。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-112">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="3ca5e-113">迭代#1 - 创建应用程序。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-113">Iteration #1 - Create the application.</span></span> <span data-ttu-id="3ca5e-114">在第一次迭代中，我们以最简单的方式创建联系人管理器。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-114">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="3ca5e-115">我们添加对基本数据库操作的支持：创建、读取、更新和删除 （CRUD）。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-115">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="3ca5e-116">迭代#2 - 使应用程序看起来不错。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-116">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="3ca5e-117">在此迭代中，我们通过修改默认ASP.NET MVC 视图母版页和级联样式表来改进应用程序的外观。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-117">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="3ca5e-118">迭代#3 - 添加表单验证。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-118">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="3ca5e-119">在第三个迭代中，我们添加基本表单验证。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-119">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="3ca5e-120">我们防止人们在未填写所需表单字段的情况下提交表单。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-120">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="3ca5e-121">我们还验证电子邮件地址和电话号码。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-121">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="3ca5e-122">迭代#4 - 使应用程序松散耦合。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-122">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="3ca5e-123">在第四次迭代中，我们利用多种软件设计模式，使维护和修改联系人管理器应用程序变得更加容易。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-123">In this fourth iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="3ca5e-124">例如，我们重构应用程序以使用存储库模式和依赖项注入模式。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-124">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="3ca5e-125">迭代#5 - 创建单元测试。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-125">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="3ca5e-126">在第五次迭代中，我们通过添加单元测试使应用程序更易于维护和修改。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-126">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="3ca5e-127">我们模拟数据模型类，并为控制器和验证逻辑构建单元测试。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-127">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="3ca5e-128">迭代#6 - 使用测试驱动开发。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-128">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="3ca5e-129">在第六次迭代中，我们首先编写单元测试并针对单元测试编写代码，从而向应用程序添加新功能。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-129">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="3ca5e-130">在此迭代中，我们添加联系人组。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-130">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="3ca5e-131">迭代#7 - 添加Ajax功能。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-131">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="3ca5e-132">在第七次迭代中，我们通过增加对Ajax的支持来提高应用程序的响应性和性能。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-132">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="this-iteration"></a><span data-ttu-id="3ca5e-133">此迭代</span><span class="sxs-lookup"><span data-stu-id="3ca5e-133">This Iteration</span></span>

<span data-ttu-id="3ca5e-134">在此迭代的联系人管理器应用程序中，我们将重构应用程序以使用 Ajax。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-134">In this iteration of the Contact Manager application, we refactor our application to make use of Ajax.</span></span> <span data-ttu-id="3ca5e-135">通过使用Ajax，我们使我们的应用程序响应更快。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-135">By taking advantage of Ajax, we make our application more responsive.</span></span> <span data-ttu-id="3ca5e-136">当只需要更新页面中的某个区域时，我们可以避免呈现整个页面。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-136">We can avoid rendering an entire page when we need to update only a certain region in a page.</span></span>

<span data-ttu-id="3ca5e-137">我们将重构索引视图，以便每当有人选择新的联系人组时，我们就不需要重新显示整个页面。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-137">We'll refactor our Index view so that we don t need to redisplay the entire page whenever someone selects a new contact group.</span></span> <span data-ttu-id="3ca5e-138">相反，当有人单击联系人组时，我们只会更新联系人列表，并单独保留页面的其余部分。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-138">Instead, when someone clicks a contact group, we'll just update the list of contacts and leave the rest of the page alone.</span></span>

<span data-ttu-id="3ca5e-139">我们还将更改删除链接的工作方式。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-139">We'll also change the way our delete link works.</span></span> <span data-ttu-id="3ca5e-140">我们将显示 JavaScript 确认对话框，而不是显示单独的确认页。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-140">Instead of displaying a separate confirmation page, we'll display a JavaScript confirmation dialog.</span></span> <span data-ttu-id="3ca5e-141">如果确认要删除联系人，则对服务器执行 HTTP DELETE 操作以从数据库中删除联系人记录。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-141">If you confirm that you want to delete a contact, an HTTP DELETE operation is performed against the server to delete the contact record from the database.</span></span>

<span data-ttu-id="3ca5e-142">此外，我们将利用 jQuery 将动画效果添加到索引视图中。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-142">Furthermore, we will take advantage of jQuery to add animation effects to our Index view.</span></span> <span data-ttu-id="3ca5e-143">当从服务器提取新的联系人列表时，我们将显示一个动画。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-143">We'll display an animation when the new list of contacts is being fetched from the server.</span></span>

<span data-ttu-id="3ca5e-144">最后，我们将利用ASP.NETAJAX框架支持来管理浏览器历史记录。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-144">Finally, we'll take advantage of the ASP.NET AJAX framework support for managing browser history.</span></span> <span data-ttu-id="3ca5e-145">每当执行 Ajax 调用以更新联系人列表时，我们都会创建历史记录点。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-145">We'll create history points whenever we perform an Ajax call to update the contact list.</span></span> <span data-ttu-id="3ca5e-146">这样，浏览器的后退和向前按钮将工作。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-146">That way, the browser backward and forward buttons will work.</span></span>

## <a name="why-use-ajax"></a><span data-ttu-id="3ca5e-147">为什么要使用Ajax？</span><span class="sxs-lookup"><span data-stu-id="3ca5e-147">Why use Ajax?</span></span>

<span data-ttu-id="3ca5e-148">使用Ajax有很多好处。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-148">Using Ajax has many benefits.</span></span> <span data-ttu-id="3ca5e-149">首先，将Ajax功能添加到应用程序中可以提供更好的用户体验。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-149">First, adding Ajax functionality to an application results in a better user experience.</span></span> <span data-ttu-id="3ca5e-150">在正常 Web 应用程序中，每次用户执行操作时，都必须将整个页面发回服务器。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-150">In a normal web application, the entire page must be posted back to the server each and every time a user performs an action.</span></span> <span data-ttu-id="3ca5e-151">每当执行操作时，浏览器都会锁定，用户必须等待，直到提取并重新显示整个页面。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-151">Whenever you perform an action, the browser locks and the user must wait until the entire page is fetched and redisplayed.</span></span>

<span data-ttu-id="3ca5e-152">在桌面应用程序的情况下，这是不可接受的体验。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-152">This would be an unacceptable experience in the case of a desktop application.</span></span> <span data-ttu-id="3ca5e-153">但是，传统上，我们生活在一个Web应用程序的情况下，这种糟糕的用户体验，因为我们不知道我们可以做得更好。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-153">But, traditionally, we lived with this bad user experience in the case of a web application because we did not know that we could do any better.</span></span> <span data-ttu-id="3ca5e-154">我们认为这是Web应用程序的一个限制，而实际上，这只是我们想象力的一个限制。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-154">We thought it was a limitation of web applications when, in actuality, it was just a limitation of our imaginations.</span></span>

<span data-ttu-id="3ca5e-155">在 Ajax 应用程序中，无需仅更新页面就停止用户体验。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-155">In an Ajax application, you don t need to bring the user experience to a halt just to update a page.</span></span> <span data-ttu-id="3ca5e-156">相反，您可以在后台执行异步请求以更新页面。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-156">Instead, you can perform an asynchronous request in the background to update the page.</span></span> <span data-ttu-id="3ca5e-157">在页面部分更新时，不会强制用户等待。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-157">You don t force the user to wait while part of the page gets updated.</span></span>

<span data-ttu-id="3ca5e-158">通过使用Ajax，您还可以提高应用程序的性能。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-158">By taking advantage of Ajax, you also can improve the performance of your application.</span></span> <span data-ttu-id="3ca5e-159">请考虑联系人管理器应用程序现在如何工作，而无需 Ajax 功能。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-159">Consider how the Contact Manager application works right now without Ajax functionality.</span></span> <span data-ttu-id="3ca5e-160">单击联系人组时，必须重新显示整个索引视图。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-160">When you click a contact group, the entire Index view must be redisplayed.</span></span> <span data-ttu-id="3ca5e-161">必须从数据库服务器检索联系人列表和联系人组列表。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-161">The list of contacts and list of contact groups must be retrieved from the database server.</span></span> <span data-ttu-id="3ca5e-162">所有这些数据都必须通过从 Web 服务器到 Web 浏览器的线传递。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-162">All of this data must be passed across the wire from web server to web browser.</span></span>

<span data-ttu-id="3ca5e-163">但是，在将 Ajax 功能添加到应用程序后，我们可以避免在用户单击联系人组时重新播放整个页面。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-163">After we add Ajax functionality to our application, however, we can avoid redisplaying the entire page when a user clicks a contact group.</span></span> <span data-ttu-id="3ca5e-164">我们不再需要从数据库获取联系人组。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-164">We no longer need to grab the contact groups from the database.</span></span> <span data-ttu-id="3ca5e-165">我们也不需要将整个索引视图推送到导线上。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-165">We also don t need to push the entire Index view across the wire.</span></span> <span data-ttu-id="3ca5e-166">通过使用 Ajax，我们减少了数据库服务器必须执行的工作量，并减少了应用程序所需的网络流量。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-166">By taking advantage of Ajax, we reduce the amount of work that our database server must perform and we reduce the amount of network traffic required by our application.</span></span>

## <a name="don-t-be-afraid-of-ajax"></a><span data-ttu-id="3ca5e-167">不要害怕阿贾克斯</span><span class="sxs-lookup"><span data-stu-id="3ca5e-167">Don t be Afraid of Ajax</span></span>

<span data-ttu-id="3ca5e-168">一些开发人员避免使用Ajax，因为他们担心低级浏览器。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-168">Some developers avoid using Ajax because they worry about downlevel browsers.</span></span> <span data-ttu-id="3ca5e-169">他们希望确保他们的 Web 应用程序在不受支持 JavaScript 的浏览器访问时仍然有效。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-169">They want to make sure that their web applications will still work when accessed by a browser that does not support JavaScript.</span></span> <span data-ttu-id="3ca5e-170">由于Ajax依赖于JavaScript，一些开发人员避免使用Ajax。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-170">Because Ajax depends on JavaScript, some developers avoid using Ajax.</span></span>

<span data-ttu-id="3ca5e-171">但是，如果您对如何实现Ajax很小心，则可以构建同时使用高级浏览器和低级浏览器的应用程序。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-171">However, if you are careful about how you implement Ajax then you can build applications that work with both uplevel and downlevel browsers.</span></span> <span data-ttu-id="3ca5e-172">我们的联系人管理器应用程序将适用于支持 JavaScript 的浏览器和不支持的浏览器。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-172">Our Contact Manager application will work with browsers that support JavaScript and browsers that do not.</span></span>

<span data-ttu-id="3ca5e-173">如果将联系人管理器应用程序与支持 JavaScript 的浏览器一起使用，那么您将有更好的用户体验。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-173">If you use the Contact Manager application with a browser that supports JavaScript then you will have a better user experience.</span></span> <span data-ttu-id="3ca5e-174">例如，当您单击联系人组时，将仅更新显示联系人的页面区域。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-174">For example, when you click a contact group, only the region of the page that displays contacts will be updated.</span></span>

<span data-ttu-id="3ca5e-175">另一方面，如果将联系人管理器应用程序用于不支持 JavaScript（或禁用了 JavaScript）的浏览器，则您的用户体验将稍逊一筹。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-175">If, on the other hand, you use the Contact Manager application with a browser that does not support JavaScript (or that has JavaScript disabled) then you will have a slightly less desirable user experience.</span></span> <span data-ttu-id="3ca5e-176">例如，当您单击联系人组时，必须将整个 Index 视图发回浏览器才能显示联系人的匹配列表。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-176">For example, when you click a contact group, the entire Index view must be posted back to the browser in order to display the matching list of contacts.</span></span>

## <a name="adding-the-required-javascript-files"></a><span data-ttu-id="3ca5e-177">添加所需的 JavaScript 文件</span><span class="sxs-lookup"><span data-stu-id="3ca5e-177">Adding the Required JavaScript Files</span></span>

<span data-ttu-id="3ca5e-178">我们需要使用三个 JavaScript 文件将 Ajax 功能添加到我们的应用程序中。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-178">We'll need to use three JavaScript files to add Ajax functionality to our application.</span></span> <span data-ttu-id="3ca5e-179">所有这些文件都包含在新的ASP.NET MVC 应用程序的脚本文件夹中。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-179">All three of these files are included in the Scripts folder of a new ASP.NET MVC application.</span></span>

<span data-ttu-id="3ca5e-180">如果您计划在应用程序中的多个页面中使用Ajax，那么在应用程序的视图母版页中包含所需的 JavaScript 文件是有意义的。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-180">If you plan to use Ajax in multiple pages in your application then it makes sense to include the required JavaScript files in your application s view master page.</span></span> <span data-ttu-id="3ca5e-181">这样，JavaScript 文件将自动包含在应用程序中的所有页面中。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-181">That way, the JavaScript files will be included in all of the pages in your application automatically.</span></span>

<span data-ttu-id="3ca5e-182">在视图母版页&lt;的头部&gt;标记中添加以下 JavaScript：</span><span class="sxs-lookup"><span data-stu-id="3ca5e-182">Add the following JavaScript includes inside the &lt;head&gt; tag of your view master page:</span></span>

[!code-html[Main](iteration-7-add-ajax-functionality-vb/samples/sample1.html)]

## <a name="refactoring-the-index-view-to-use-ajax"></a><span data-ttu-id="3ca5e-183">重构索引视图以使用 Ajax</span><span class="sxs-lookup"><span data-stu-id="3ca5e-183">Refactoring the Index View to use Ajax</span></span>

<span data-ttu-id="3ca5e-184">让我们首先修改我们的 Index 视图，以便单击联系人组仅更新显示联系人的视图区域。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-184">Let s start by modifying our Index view so that clicking a contact group only updates the region of the view that displays contacts.</span></span> <span data-ttu-id="3ca5e-185">图 1 中的红色框包含我们要更新的区域。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-185">The red box in Figure 1 contains the region that we want to update.</span></span>

<span data-ttu-id="3ca5e-186">[![仅更新联系人](iteration-7-add-ajax-functionality-vb/_static/image1.jpg)](iteration-7-add-ajax-functionality-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="3ca5e-186">[![Updating only contacts](iteration-7-add-ajax-functionality-vb/_static/image1.jpg)](iteration-7-add-ajax-functionality-vb/_static/image1.png)</span></span>

<span data-ttu-id="3ca5e-187">**图 01**：仅更新联系人（[单击以查看全尺寸图像](iteration-7-add-ajax-functionality-vb/_static/image2.png)）</span><span class="sxs-lookup"><span data-stu-id="3ca5e-187">**Figure 01**: Updating only contacts([Click to view full-size image](iteration-7-add-ajax-functionality-vb/_static/image2.png))</span></span>

<span data-ttu-id="3ca5e-188">第一步是将要异步更新的视图部分分离为单独的部分（视图用户控件）。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-188">The first step is to separate the part of the view that we want to update asynchronously into a separate partial (view user control).</span></span> <span data-ttu-id="3ca5e-189">显示联系人表的 Index 视图部分已移动到清单 1 中的部分。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-189">The section of the Index view that displays the table of contacts has been moved into the partial in Listing 1.</span></span>

<span data-ttu-id="3ca5e-190">**清单 1 - 视图\联系人\联系人列表.ascx**</span><span class="sxs-lookup"><span data-stu-id="3ca5e-190">**Listing 1 - Views\Contact\ContactList.ascx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample2.aspx)]

<span data-ttu-id="3ca5e-191">请注意，清单 1 中的部分具有与索引视图不同的模型。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-191">Notice that the partial in Listing 1 has a different model than the Index view.</span></span> <span data-ttu-id="3ca5e-192">%@ Page %&lt;&gt;指令中的&lt;*继承*属性指定从 ViewUserControl 组&gt;类的部分继承。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-192">The *Inherits* attribute in the &lt;%@ Page %&gt; directive specifies that the partial inherits from the ViewUserControl&lt;Group&gt; class.</span></span>

<span data-ttu-id="3ca5e-193">更新的索引视图包含在清单 2 中。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-193">The updated Index view is contained in Listing 2.</span></span>

<span data-ttu-id="3ca5e-194">**清单2 - 视图\联系人\Index.aspx**</span><span class="sxs-lookup"><span data-stu-id="3ca5e-194">**Listing 2 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample3.aspx)]

<span data-ttu-id="3ca5e-195">关于清单2中更新的视图，您应该注意两件事。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-195">There are two things that you should notice about the updated view in Listing 2.</span></span> <span data-ttu-id="3ca5e-196">首先，请注意，移动到部分的所有内容都将替换为对 Html.Render 部分（）的调用。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-196">First, notice that all of the content moved into the partial is replaced with a call to Html.RenderPartial().</span></span> <span data-ttu-id="3ca5e-197">首次请求索引视图以显示初始联系人集时调用 Html.Render 部分（） 方法。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-197">The Html.RenderPartial() method is called when the Index view is first requested in order to display the initial set of contacts.</span></span>

<span data-ttu-id="3ca5e-198">其次，请注意，用于显示联系人组的 Html.ActionLink（） 已替换为 Ajax.ActionLink（）。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-198">Second, notice that the Html.ActionLink() used to display contact groups has been replaced with an Ajax.ActionLink().</span></span> <span data-ttu-id="3ca5e-199">Ajax.ActionLink（）使用以下参数调用：</span><span class="sxs-lookup"><span data-stu-id="3ca5e-199">The Ajax.ActionLink() is called with the following parameters:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample4.aspx)]

<span data-ttu-id="3ca5e-200">第一个参数表示要显示的链接的文本，第二个参数表示路由值，第三个参数表示 Ajax 选项。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-200">The first parameter represents the text to display for the link, the second parameter represents the route values, and the third parameter represents the Ajax options.</span></span> <span data-ttu-id="3ca5e-201">在这种情况下，我们使用 UpdateTargetId Ajax 选项来指向要在 Ajax &lt;&gt;请求完成后更新的 HTML div 标记。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-201">In this case, we use the UpdateTargetId Ajax option to point to the HTML &lt;div&gt; tag that we want to update after the Ajax request completes.</span></span> <span data-ttu-id="3ca5e-202">我们希望使用新的联系人列表&lt;更新&gt;div 标记。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-202">We want to update the &lt;div&gt; tag with the new list of contacts.</span></span>

<span data-ttu-id="3ca5e-203">联系人控制器的更新索引（） 方法包含在清单 3 中。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-203">The updated Index() method of the Contact controller is contained in Listing 3.</span></span>

<span data-ttu-id="3ca5e-204">**清单3 - 控制器\联系控制器.vb（索引方法）**</span><span class="sxs-lookup"><span data-stu-id="3ca5e-204">**Listing 3 - Controllers\ContactController.vb (Index method)**</span></span>

[!code-vb[Main](iteration-7-add-ajax-functionality-vb/samples/sample5.vb)]

<span data-ttu-id="3ca5e-205">更新的 Index（） 操作有条件地返回两件事情之一。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-205">The updated Index() action conditionally returns one of two things.</span></span> <span data-ttu-id="3ca5e-206">如果 Ajax 请求调用了 Index（） 操作，则控制器返回部分。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-206">If the Index() action is invoked by an Ajax request then the controller returns a partial.</span></span> <span data-ttu-id="3ca5e-207">否则，Index（） 操作将返回整个视图。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-207">Otherwise, the Index() action returns an entire view.</span></span>

<span data-ttu-id="3ca5e-208">请注意，当 Ajax 请求调用时，Index（） 操作不需要返回尽可能多的数据。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-208">Notice that the Index() action does not need to return as much data when invoked by an Ajax request.</span></span> <span data-ttu-id="3ca5e-209">在正常请求的上下文中，Index 操作返回所有联系人组和所选联系人组的列表。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-209">In the context of a normal request, the Index action returns a list of all of the contact groups and the selected contact group.</span></span> <span data-ttu-id="3ca5e-210">在 Ajax 请求的上下文中，Index（） 操作仅返回选定的组。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-210">In the context of an Ajax request, the Index() action returns only the selected group.</span></span> <span data-ttu-id="3ca5e-211">Ajax 意味着数据库服务器上的工作更少。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-211">Ajax means less work on your database server.</span></span>

<span data-ttu-id="3ca5e-212">我们修改的 Index 视图适用于上层浏览器和低级浏览器。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-212">Our modified Index view works in the case of both uplevel and downlevel browsers.</span></span> <span data-ttu-id="3ca5e-213">如果单击联系人组，并且您的浏览器支持 JavaScript，则仅更新包含联系人列表的视图区域。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-213">If you click a contact group, and your browser supports JavaScript, then only the region of the view that contains the list of contacts is updated.</span></span> <span data-ttu-id="3ca5e-214">另一方面，如果您的浏览器不支持 JavaScript，则整个视图将更新。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-214">If, on the other hand, your browser does not support JavaScript, then the entire view is updated.</span></span>

<span data-ttu-id="3ca5e-215">我们更新的索引视图有一个问题。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-215">Our updated Index view has one problem.</span></span> <span data-ttu-id="3ca5e-216">单击联系人组时，所选组不会突出显示。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-216">When you click a contact group, the selected group is not highlighted.</span></span> <span data-ttu-id="3ca5e-217">由于组列表显示在 Ajax 请求期间更新的区域之外，因此不会突出显示正确的组。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-217">Because the list of groups is displayed outside of the region that is updated during an Ajax request, the right group does not get highlighted.</span></span> <span data-ttu-id="3ca5e-218">我们将在下一节中解决此问题。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-218">We'll fix this issue in the next section.</span></span>

## <a name="adding-jquery-animation-effects"></a><span data-ttu-id="3ca5e-219">添加 jQuery 动画效果</span><span class="sxs-lookup"><span data-stu-id="3ca5e-219">Adding jQuery Animation Effects</span></span>

<span data-ttu-id="3ca5e-220">通常，当您单击网页中的链接时，可以使用浏览器进度栏来检测浏览器是否主动获取更新的内容。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-220">Normally, when you click a link in a web page, you can use the browser progress bar to detect whether or not the browser is actively fetching the updated content.</span></span> <span data-ttu-id="3ca5e-221">另一方面，当执行 Ajax 请求时，浏览器进度栏不显示任何进度。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-221">When performing an Ajax request, on the other hand, the browser progress bar does not show any progress.</span></span> <span data-ttu-id="3ca5e-222">这会使用户感到紧张。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-222">This can make users nervous.</span></span> <span data-ttu-id="3ca5e-223">您如何知道浏览器是否已冻结？</span><span class="sxs-lookup"><span data-stu-id="3ca5e-223">How do you know whether the browser has frozen?</span></span>

<span data-ttu-id="3ca5e-224">有几种方法可以向用户指示在执行 Ajax 请求时正在执行工作。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-224">There are several ways that you can indicate to a user that work is being performed while performing an Ajax request.</span></span> <span data-ttu-id="3ca5e-225">一种方法是显示一个简单的动画。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-225">One approach is to display a simple animation.</span></span> <span data-ttu-id="3ca5e-226">例如，当 Ajax 请求开始并淡入该区域时，可以淡出该区域。"</span><span class="sxs-lookup"><span data-stu-id="3ca5e-226">For example, you can fade out a region when an Ajax request begins and fade in the region when the request completes.</span></span>

<span data-ttu-id="3ca5e-227">我们将使用 Microsoft ASP.NET MVC 框架中包含的 jQuery 库来创建动画效果。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-227">We'll use the jQuery library which is included with the Microsoft ASP.NET MVC framework, to create the animation effects.</span></span> <span data-ttu-id="3ca5e-228">更新的索引视图包含在清单 4 中。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-228">The updated Index view is contained in Listing 4.</span></span>

<span data-ttu-id="3ca5e-229">**清单4 - 视图_联系人_Index.aspx**</span><span class="sxs-lookup"><span data-stu-id="3ca5e-229">**Listing 4 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample6.aspx)]

<span data-ttu-id="3ca5e-230">请注意，更新的索引视图包含三个新的 JavaScript 函数。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-230">Notice that the updated Index view contains three new JavaScript functions.</span></span> <span data-ttu-id="3ca5e-231">单击新联系人组时，前两个函数使用 jQuery 淡入淡出并淡入联系人列表中。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-231">The first two functions use jQuery to fade out and fade in the list of contacts when you click a new contact group.</span></span> <span data-ttu-id="3ca5e-232">当 Ajax 请求导致错误（例如，网络超时）时，第三个函数将显示一条错误消息。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-232">The third function displays an error message when an Ajax request results in an error (for example, network timeout).</span></span>

<span data-ttu-id="3ca5e-233">第一个函数还负责突出显示所选组。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-233">The first function also takes care of highlighting the selected group.</span></span> <span data-ttu-id="3ca5e-234">类\* 所选属性将添加到单击的元素的父元素（LI 元素）。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-234">A class= selected attribute is added to the parent element (the LI element) of the element clicked.</span></span> <span data-ttu-id="3ca5e-235">同样，jQuery 便于选择正确的元素并添加 CSS 类。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-235">Again, jQuery makes it easy to select the right element and add the CSS class.</span></span>

<span data-ttu-id="3ca5e-236">这些脚本在Ajax.ActionLink（））AjaxOptions参数的帮助下与组链接相关联。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-236">These scripts are tied to the group links with the help of the Ajax.ActionLink() AjaxOptions parameter.</span></span> <span data-ttu-id="3ca5e-237">更新的Ajax.ActionLink（）方法调用如下所示：</span><span class="sxs-lookup"><span data-stu-id="3ca5e-237">The updated Ajax.ActionLink() method call looks like this:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample7.aspx)]

## <a name="adding-browser-history-support"></a><span data-ttu-id="3ca5e-238">添加浏览器历史记录支持</span><span class="sxs-lookup"><span data-stu-id="3ca5e-238">Adding Browser History Support</span></span>

<span data-ttu-id="3ca5e-239">通常，当您单击链接以更新页面时，您的浏览器历史记录将更新。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-239">Normally, when you click a link to update a page, your browser history is updated.</span></span> <span data-ttu-id="3ca5e-240">这样，您可以单击浏览器"后退"按钮以及时移回页面的上一个状态。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-240">That way, you can click the browser Back button to move back in time to the previous state of the page.</span></span> <span data-ttu-id="3ca5e-241">例如，如果您单击"好友联系人组"然后单击"业务联系人组"，则可以单击浏览器"后退"按钮，在选择"好友联系人组"时导航回页面状态。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-241">For example, if you click the Friends contact group and then click the Business contact group, you can click the browser Back button to navigate back to the state of the page when the Friends contact group was selected.</span></span>

<span data-ttu-id="3ca5e-242">遗憾的是，执行 Ajax 请求不会自动更新浏览器历史记录。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-242">Unfortunately, performing an Ajax request does not update browser history automatically.</span></span> <span data-ttu-id="3ca5e-243">如果单击联系人组，并且使用 Ajax 请求检索匹配联系人的列表，则浏览器历史记录不会更新。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-243">If you click a contact group, and the list of matching contacts is retrieved with an Ajax request, then the browser history is not updated.</span></span> <span data-ttu-id="3ca5e-244">选择新的联系人组后，不能使用浏览器"后退"按钮导航回联系人组。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-244">You cannot use the browser Back button to navigate back to a contact group after selecting a new contact group.</span></span>

<span data-ttu-id="3ca5e-245">如果您希望用户在执行 Ajax 请求后能够使用浏览器"后退"按钮，则需要执行更多工作。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-245">If you want users to be able to use the browser Back button after performing Ajax requests then you need to perform a little more work.</span></span> <span data-ttu-id="3ca5e-246">您需要利用 ASP.NET AJAX 框架中构建的浏览器历史记录管理功能。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-246">You need to take advantage of the browser history management functionality built in the ASP.NET AJAX Framework.</span></span>

<span data-ttu-id="3ca5e-247">ASP.NET AJAX 浏览器历史记录，您需要执行以下三项操作：</span><span class="sxs-lookup"><span data-stu-id="3ca5e-247">ASP.NET AJAX browser history, you need to do three things:</span></span>

1. <span data-ttu-id="3ca5e-248">通过将启用浏览器历史记录属性设置为 true，启用浏览器历史记录。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-248">Enable Browser History by setting the enableBrowserHistory property to true.</span></span>
2. <span data-ttu-id="3ca5e-249">通过调用 addHistoryPoint（） 方法，在视图状态发生变化时保存历史记录点。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-249">Save history points when the state of a view changes by calling the addHistoryPoint() method.</span></span>
3. <span data-ttu-id="3ca5e-250">引发导航事件时重建视图的状态。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-250">Reconstruct the state of the view when the navigate event is raised.</span></span>

<span data-ttu-id="3ca5e-251">更新的索引视图包含在清单 5 中。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-251">The updated Index view is contained in Listing 5.</span></span>

<span data-ttu-id="3ca5e-252">**清单5 - 视图_联系人_Index.aspx**</span><span class="sxs-lookup"><span data-stu-id="3ca5e-252">**Listing 5 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample8.aspx)]

<span data-ttu-id="3ca5e-253">在清单5中，浏览器历史记录在页面 Init（） 函数中启用。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-253">In Listing 5, Browser History is enabled in the pageInit() function.</span></span> <span data-ttu-id="3ca5e-254">pageInit（） 函数还用于设置导航事件的事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-254">The pageInit() function is also used to set up the event handler for the navigate event.</span></span> <span data-ttu-id="3ca5e-255">每当浏览器"前进"或"后退"按钮导致页面状态更改时，将引发导航事件。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-255">The navigate event is raised whenever the browser Forward or Back button causes the state of the page to change.</span></span>

<span data-ttu-id="3ca5e-256">单击联系人组时将调用开始联系人列表（） 方法。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-256">The beginContactList() method is called when you click a contact group.</span></span> <span data-ttu-id="3ca5e-257">此方法通过调用 add 历史点（） 方法创建新的历史记录点。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-257">This method creates a new history point by calling the addHistoryPoint() method.</span></span> <span data-ttu-id="3ca5e-258">单击的联系人组的 ID 将添加到历史记录中。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-258">The id of the contact group clicked is added to history.</span></span>

<span data-ttu-id="3ca5e-259">从联系人组链接上的扩展属性检索组 ID。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-259">The group id is retrieved from an expando attribute on the contact group link.</span></span> <span data-ttu-id="3ca5e-260">链接呈现与以下调用Ajax.ActionLink（）。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-260">The link is rendered with the following call to Ajax.ActionLink().</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample9.aspx)]

<span data-ttu-id="3ca5e-261">传递给Ajax.ActionLink（）的最后一个参数将名为 groupid 的 expando 属性添加到链接（XHTML 兼容性小写）。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-261">The last parameter passed to the Ajax.ActionLink() adds an expando attribute named groupid to the link (lowercase for XHTML compatibility).</span></span>

<span data-ttu-id="3ca5e-262">当用户点击浏览器"后退"或"前进"按钮时，将引发导航事件并调用 navigate（） 方法。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-262">When a user hits the browser Back or Forward button, the navigate event is raised and the navigate() method is called.</span></span> <span data-ttu-id="3ca5e-263">此方法更新页面中显示的联系人，以匹配与传递给导航方法的浏览器历史记录点对应的页面状态。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-263">This method updates the contacts displayed in the page to match the state of the page that corresponds to the browser history point passed to the navigate method.</span></span>

## <a name="performing-ajax-deletes"></a><span data-ttu-id="3ca5e-264">执行 Ajax 删除</span><span class="sxs-lookup"><span data-stu-id="3ca5e-264">Performing Ajax Deletes</span></span>

<span data-ttu-id="3ca5e-265">目前，要删除联系人，您需要单击"删除"链接，然后单击删除确认页中显示的"删除"按钮（参见图 2）。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-265">Currently, in order to delete a contact, you need to click on the Delete link and then click the Delete button displayed in the delete confirmation page (see Figure 2).</span></span> <span data-ttu-id="3ca5e-266">这似乎是很多页面请求，以做一些简单的事情，如删除数据库记录。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-266">This seems like a lot of page requests to do something simple like deleting a database record.</span></span>

<span data-ttu-id="3ca5e-267">[![删除确认页](iteration-7-add-ajax-functionality-vb/_static/image2.jpg)](iteration-7-add-ajax-functionality-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="3ca5e-267">[![The delete confirmation page](iteration-7-add-ajax-functionality-vb/_static/image2.jpg)](iteration-7-add-ajax-functionality-vb/_static/image3.png)</span></span>

<span data-ttu-id="3ca5e-268">**图 02**： 删除确认页（[单击以查看全尺寸图像](iteration-7-add-ajax-functionality-vb/_static/image4.png)）</span><span class="sxs-lookup"><span data-stu-id="3ca5e-268">**Figure 02**: The delete confirmation page([Click to view full-size image](iteration-7-add-ajax-functionality-vb/_static/image4.png))</span></span>

<span data-ttu-id="3ca5e-269">最好跳过删除确认页，直接从索引视图中删除联系人。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-269">It is tempting to skip the delete confirmation page and delete a contact directly from the Index view.</span></span> <span data-ttu-id="3ca5e-270">您应该避免这种诱惑，因为采用这种方法会将应用程序打开到安全漏洞中。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-270">You should avoid this temptation because taking this approach opens your application to security holes.</span></span> <span data-ttu-id="3ca5e-271">通常，在调用修改 Web 应用程序状态的操作时，不希望执行 HTTP GET 操作。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-271">In general, you don t want to perform an HTTP GET operation when invoking an action that modifies the state of your web application.</span></span> <span data-ttu-id="3ca5e-272">执行删除时，要执行 HTTP POST，或者更好的是执行 HTTP DELETE 操作。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-272">When performing a delete, you want to perform an HTTP POST, or better yet, an HTTP DELETE operation.</span></span>

<span data-ttu-id="3ca5e-273">"删除"链接包含在"联系人列表"部分中。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-273">The Delete link is contained in the ContactList partial.</span></span> <span data-ttu-id="3ca5e-274">清单 6 中包含联系人列表部分的更新版本。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-274">An updated version of the ContactList partial is contained in Listing 6.</span></span>

<span data-ttu-id="3ca5e-275">**清单 6 - 视图\联系人列表.ascx**</span><span class="sxs-lookup"><span data-stu-id="3ca5e-275">**Listing 6 - Views\Contact\ContactList.ascx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample10.aspx)]

<span data-ttu-id="3ca5e-276">删除链接呈现与以下调用 Ajax.ImageActionLink（） 方法：</span><span class="sxs-lookup"><span data-stu-id="3ca5e-276">The Delete link is rendered with the following call to the Ajax.ImageActionLink() method:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample11.aspx)]

> [!NOTE] 
> 
> <span data-ttu-id="3ca5e-277">Ajax.ImageActionLink（）不是mVCASP.NET标准部分。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-277">The Ajax.ImageActionLink() is not a standard part of the ASP.NET MVC framework.</span></span> <span data-ttu-id="3ca5e-278">Ajax.ImageActionLink（）是联系人管理器项目中包括的自定义帮助器方法。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-278">The Ajax.ImageActionLink() is a custom helper methods included in the Contact Manager project.</span></span>

<span data-ttu-id="3ca5e-279">AjaxOptions 参数有两个属性。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-279">The AjaxOptions parameter has two properties.</span></span> <span data-ttu-id="3ca5e-280">首先，"确认"属性用于显示弹出的 JavaScript 确认对话框。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-280">First, the Confirm property is used to display a popup JavaScript confirmation dialog.</span></span> <span data-ttu-id="3ca5e-281">其次，HttpMethod 属性用于执行 HTTP DELETE 操作。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-281">Second, the HttpMethod property is used to perform an HTTP DELETE operation.</span></span>

<span data-ttu-id="3ca5e-282">清单7包含已添加到联系人控制器的新 AjaxDelete（） 操作。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-282">Listing 7 contains a new AjaxDelete() action that has been added to the Contact controller.</span></span>

<span data-ttu-id="3ca5e-283">**清单7 - 控制器\联系控制器.vb（Ajax删除）**</span><span class="sxs-lookup"><span data-stu-id="3ca5e-283">**Listing 7 - Controllers\ContactController.vb (AjaxDelete)**</span></span>   

[!code-vb[Main](iteration-7-add-ajax-functionality-vb/samples/sample12.vb)]

<span data-ttu-id="3ca5e-284">AjaxDelete（） 操作使用 AcceptVerbs 属性进行修饰。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-284">The AjaxDelete() action is decorated with an AcceptVerbs attribute.</span></span> <span data-ttu-id="3ca5e-285">此属性可防止调用操作，但 HTTP DELETE 操作以外的任何 HTTP 操作除外。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-285">This attribute prevents the action from being invoked except by any HTTP operation other than an HTTP DELETE operation.</span></span> <span data-ttu-id="3ca5e-286">特别是，您不能使用 HTTP GET 调用此操作。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-286">In particular, you cannot invoke this action with an HTTP GET.</span></span>

<span data-ttu-id="3ca5e-287">删除数据库记录后，需要显示不包含已删除记录的联系人的更新列表。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-287">After you delete database record, you need to display the updated list of contacts that does not contain the deleted record.</span></span> <span data-ttu-id="3ca5e-288">AjaxDelete（） 方法返回联系人列表部分和更新的联系人列表。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-288">The AjaxDelete() method returns the ContactList partial and the updated list of contacts.</span></span>

## <a name="summary"></a><span data-ttu-id="3ca5e-289">总结</span><span class="sxs-lookup"><span data-stu-id="3ca5e-289">Summary</span></span>

<span data-ttu-id="3ca5e-290">在此迭代中，我们将 Ajax 功能添加到我们的联系人管理器应用程序中。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-290">In this iteration, we added Ajax functionality to our Contact Manager application.</span></span> <span data-ttu-id="3ca5e-291">我们使用Ajax来提高应用程序的响应性和性能。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-291">We used Ajax to improve the responsiveness and performance of our application.</span></span>

<span data-ttu-id="3ca5e-292">首先，我们重构了 Index 视图，以便单击联系人组不会更新整个视图。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-292">First, we refactored the Index view so that clicking a contact group does not update the entire view.</span></span> <span data-ttu-id="3ca5e-293">相反，单击联系人组只会更新联系人列表。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-293">Instead, clicking a contact group only updates the list of contacts.</span></span>

<span data-ttu-id="3ca5e-294">接下来，我们使用 jQuery 动画效果淡入淡出并淡入联系人列表中。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-294">Next, we used jQuery animation effects to fade out and fade in the list of contacts.</span></span> <span data-ttu-id="3ca5e-295">向 Ajax 应用程序添加动画可用于向应用程序的用户提供等效的浏览器进度栏。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-295">Adding animation to an Ajax application can be used to provide users of the application with the equivalent of a browser progress bar.</span></span>

<span data-ttu-id="3ca5e-296">我们还向 Ajax 应用程序添加了浏览器历史记录支持。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-296">We also added browser history support to our Ajax application.</span></span> <span data-ttu-id="3ca5e-297">我们允许用户单击浏览器"后退"和"前进"按钮以更改"索引"视图的状态。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-297">We enabled users to click the browser Back and Forward buttons to change the state of the Index view.</span></span>

<span data-ttu-id="3ca5e-298">最后，我们创建了一个支持 HTTP DELETE 操作的删除链接。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-298">Finally, we created a delete link that supports HTTP DELETE operations.</span></span> <span data-ttu-id="3ca5e-299">通过执行 Ajax 删除，我们允许用户删除数据库记录，而无需用户请求额外的删除确认页。</span><span class="sxs-lookup"><span data-stu-id="3ca5e-299">By performing Ajax deletes, we enable users to delete database records without requiring the user to request an additional delete confirmation page.</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="3ca5e-300">上一篇</span><span class="sxs-lookup"><span data-stu-id="3ca5e-300">Previous</span></span>](iteration-6-use-test-driven-development-vb.md)
