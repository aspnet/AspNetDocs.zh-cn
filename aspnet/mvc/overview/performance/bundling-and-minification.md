---
uid: mvc/overview/performance/bundling-and-minification
title: 绑定和缩减 |Microsoft Docs
author: Rick-Anderson
description: 绑定和缩减是可以在 ASP.NET 4.5 中使用的两种技术来提高请求加载时间。 绑定和缩减通过 reducin 缩短加载时间 。
ms.author: riande
ms.date: 08/23/2012
ms.assetid: 5894dc13-5d45-4dad-8096-136499120f1d
msc.legacyurl: /mvc/overview/performance/bundling-and-minification
msc.type: authoredcontent
ms.openlocfilehash: 61bfe5dbac04b57e1461183b66ead2f01fe0734c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/06/2020
ms.locfileid: "78432950"
---
# <a name="bundling-and-minification"></a><span data-ttu-id="ed97a-104">Bundling and Minification（绑定和缩小）</span><span class="sxs-lookup"><span data-stu-id="ed97a-104">Bundling and Minification</span></span>

<span data-ttu-id="ed97a-105">作者： [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="ed97a-105">by [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

> <span data-ttu-id="ed97a-106">绑定和缩减是可以在 ASP.NET 4.5 中使用的两种技术来提高请求加载时间。</span><span class="sxs-lookup"><span data-stu-id="ed97a-106">Bundling and minification are two techniques you can use in ASP.NET 4.5 to improve request load time.</span></span> <span data-ttu-id="ed97a-107">绑定和缩减减少了对服务器的请求数并减小了请求资产（如 CSS 和 JavaScript）的大小，从而缩短了加载时间。</span><span class="sxs-lookup"><span data-stu-id="ed97a-107">Bundling and minification improves load time by reducing the number of requests to the server and reducing the size of requested assets (such as CSS and JavaScript.)</span></span>

<span data-ttu-id="ed97a-108">大多数当前的主要浏览器将每个主机名的[同时连接](http://www.browserscope.org/?category=network)数限制为6。</span><span class="sxs-lookup"><span data-stu-id="ed97a-108">Most of the current major browsers limit the number of [simultaneous connections](http://www.browserscope.org/?category=network) per each hostname to six.</span></span> <span data-ttu-id="ed97a-109">这意味着，在处理六个请求时，对主机上的资产的其他请求将由浏览器进行排队。</span><span class="sxs-lookup"><span data-stu-id="ed97a-109">That means that while six requests are being processed, additional requests for assets on a host will be queued by the browser.</span></span> <span data-ttu-id="ed97a-110">在下图中，IE F12 开发人员工具网络选项卡显示示例应用程序的 "关于" 视图所需的资产计时。</span><span class="sxs-lookup"><span data-stu-id="ed97a-110">In the image below, the IE F12 developer tools network tabs shows the timing for assets required by the About view of a sample application.</span></span>

![B/M](bundling-and-minification/_static/image1.png)

<span data-ttu-id="ed97a-112">灰色条显示了在浏览器等待六个连接限制时，请求排队的时间。</span><span class="sxs-lookup"><span data-stu-id="ed97a-112">The gray bars show the time the request is queued by the browser waiting on the six connection limit.</span></span> <span data-ttu-id="ed97a-113">黄色条为第一字节的请求时间，即，发送请求和接收来自服务器的第一个响应所需的时间。</span><span class="sxs-lookup"><span data-stu-id="ed97a-113">The yellow bar is the request time to first byte, that is, the time taken to send the request and receive the first response from the server.</span></span> <span data-ttu-id="ed97a-114">蓝条显示从服务器接收响应数据所用的时间。</span><span class="sxs-lookup"><span data-stu-id="ed97a-114">The blue bars show the time taken to receive the response data from the server.</span></span> <span data-ttu-id="ed97a-115">可以双击某个资产获取详细计时信息。</span><span class="sxs-lookup"><span data-stu-id="ed97a-115">You can double-click on an asset to get detailed timing information.</span></span> <span data-ttu-id="ed97a-116">例如，下图显示了用于加载 */Scripts/MyScripts/JavaScript6.js*文件的计时详细信息。</span><span class="sxs-lookup"><span data-stu-id="ed97a-116">For example, the following image shows the timing details for loading the */Scripts/MyScripts/JavaScript6.js* file.</span></span>

![](bundling-and-minification/_static/image2.png)

<span data-ttu-id="ed97a-117">上图显示了**开始**事件，此事件提供请求排队的时间，因为浏览器会限制同时连接的数量。</span><span class="sxs-lookup"><span data-stu-id="ed97a-117">The preceding image shows the **Start** event, which gives the time the request was queued because of the browser limit the number of simultaneous connections.</span></span> <span data-ttu-id="ed97a-118">在这种情况下，请求会排队等候等待另一个请求完成的46毫秒。</span><span class="sxs-lookup"><span data-stu-id="ed97a-118">In this case, the request was queued for 46 milliseconds waiting for another request to complete.</span></span>

## <a name="bundling"></a><span data-ttu-id="ed97a-119">捆绑</span><span class="sxs-lookup"><span data-stu-id="ed97a-119">Bundling</span></span>

<span data-ttu-id="ed97a-120">捆绑是 ASP.NET 4.5 中的一项新功能，可轻松地将多个文件组合或捆绑到一个文件中。</span><span class="sxs-lookup"><span data-stu-id="ed97a-120">Bundling is a new feature in ASP.NET 4.5 that makes it easy to combine or bundle multiple files into a single file.</span></span> <span data-ttu-id="ed97a-121">你可以创建 CSS、JavaScript 和其他捆绑包。</span><span class="sxs-lookup"><span data-stu-id="ed97a-121">You can create CSS, JavaScript and other bundles.</span></span> <span data-ttu-id="ed97a-122">较少的文件意味着 HTTP 请求更少，并且可以提高首页加载性能。</span><span class="sxs-lookup"><span data-stu-id="ed97a-122">Fewer files means fewer HTTP requests and that can improve first page load performance.</span></span>

<span data-ttu-id="ed97a-123">下图显示了与前面所示的 "关于" 视图相同的计时视图，但此时启用了绑定和缩减。</span><span class="sxs-lookup"><span data-stu-id="ed97a-123">The following image shows the same timing view of the About view shown previously, but this time with bundling and minification enabled.</span></span>

![](bundling-and-minification/_static/image3.png)

## <a name="minification"></a><span data-ttu-id="ed97a-124">缩减</span><span class="sxs-lookup"><span data-stu-id="ed97a-124">Minification</span></span>

<span data-ttu-id="ed97a-125">缩减对脚本或 css 执行各种不同的代码优化，如删除不必要的空白和注释并缩短变量名称为一个字符。</span><span class="sxs-lookup"><span data-stu-id="ed97a-125">Minification performs a variety of different code optimizations to scripts or css, such as removing unnecessary white space and comments and shortening variable names to one character.</span></span> <span data-ttu-id="ed97a-126">请考虑以下 JavaScript 函数。</span><span class="sxs-lookup"><span data-stu-id="ed97a-126">Consider the following JavaScript function.</span></span>

[!code-javascript[Main](bundling-and-minification/samples/sample1.js)]

<span data-ttu-id="ed97a-127">缩减之后，该函数将缩小为以下内容：</span><span class="sxs-lookup"><span data-stu-id="ed97a-127">After minification, the function is reduced to the following:</span></span>

[!code-javascript[Main](bundling-and-minification/samples/sample2.js)]

<span data-ttu-id="ed97a-128">除了删除注释和不必要的空格外，以下参数和变量名称已重命名（缩短），如下所示：</span><span class="sxs-lookup"><span data-stu-id="ed97a-128">In addition to removing the comments and unnecessary whitespace, the following parameters and variable names were renamed (shortened) as follows:</span></span>

| <span data-ttu-id="ed97a-129">**原始**</span><span class="sxs-lookup"><span data-stu-id="ed97a-129">**Original**</span></span> | <span data-ttu-id="ed97a-130">**更名**</span><span class="sxs-lookup"><span data-stu-id="ed97a-130">**Renamed**</span></span> |
| --- | --- |
| <span data-ttu-id="ed97a-131">imageTagAndImageID</span><span class="sxs-lookup"><span data-stu-id="ed97a-131">imageTagAndImageID</span></span> | <span data-ttu-id="ed97a-132">n</span><span class="sxs-lookup"><span data-stu-id="ed97a-132">n</span></span> |
| <span data-ttu-id="ed97a-133">imageContext</span><span class="sxs-lookup"><span data-stu-id="ed97a-133">imageContext</span></span> | <span data-ttu-id="ed97a-134">t</span><span class="sxs-lookup"><span data-stu-id="ed97a-134">t</span></span> |
| <span data-ttu-id="ed97a-135">imageElement</span><span class="sxs-lookup"><span data-stu-id="ed97a-135">imageElement</span></span> | <span data-ttu-id="ed97a-136">i</span><span class="sxs-lookup"><span data-stu-id="ed97a-136">i</span></span> |

## <a name="impact-of-bundling-and-minification"></a><span data-ttu-id="ed97a-137">绑定和缩减的影响</span><span class="sxs-lookup"><span data-stu-id="ed97a-137">Impact of Bundling and Minification</span></span>

<span data-ttu-id="ed97a-138">下表显示了几个重要的差异，分别列出了每个资产，并使用了示例程序中的绑定和缩减（B/M）。</span><span class="sxs-lookup"><span data-stu-id="ed97a-138">The following table shows several important differences between listing all the assets individually and using bundling and minification (B/M) in the sample program.</span></span>

|  | <span data-ttu-id="ed97a-139">**使用 B/M**</span><span class="sxs-lookup"><span data-stu-id="ed97a-139">**Using B/M**</span></span> | <span data-ttu-id="ed97a-140">**无 B/M**</span><span class="sxs-lookup"><span data-stu-id="ed97a-140">**Without B/M**</span></span> | <span data-ttu-id="ed97a-141">**更改**</span><span class="sxs-lookup"><span data-stu-id="ed97a-141">**Change**</span></span> |
| --- | --- | --- | --- |
| <span data-ttu-id="ed97a-142">**文件请求**</span><span class="sxs-lookup"><span data-stu-id="ed97a-142">**File Requests**</span></span> | <span data-ttu-id="ed97a-143">9</span><span class="sxs-lookup"><span data-stu-id="ed97a-143">9</span></span> | <span data-ttu-id="ed97a-144">34</span><span class="sxs-lookup"><span data-stu-id="ed97a-144">34</span></span> | <span data-ttu-id="ed97a-145">256%</span><span class="sxs-lookup"><span data-stu-id="ed97a-145">256%</span></span> |
| <span data-ttu-id="ed97a-146">**已发送 KB**</span><span class="sxs-lookup"><span data-stu-id="ed97a-146">**KB Sent**</span></span> | <span data-ttu-id="ed97a-147">3.26</span><span class="sxs-lookup"><span data-stu-id="ed97a-147">3.26</span></span> | <span data-ttu-id="ed97a-148">11.92</span><span class="sxs-lookup"><span data-stu-id="ed97a-148">11.92</span></span> | <span data-ttu-id="ed97a-149">266%</span><span class="sxs-lookup"><span data-stu-id="ed97a-149">266%</span></span> |
| <span data-ttu-id="ed97a-150">**已收到 KB**</span><span class="sxs-lookup"><span data-stu-id="ed97a-150">**KB Received**</span></span> | <span data-ttu-id="ed97a-151">388.51</span><span class="sxs-lookup"><span data-stu-id="ed97a-151">388.51</span></span> | <span data-ttu-id="ed97a-152">530</span><span class="sxs-lookup"><span data-stu-id="ed97a-152">530</span></span> | <span data-ttu-id="ed97a-153">36%</span><span class="sxs-lookup"><span data-stu-id="ed97a-153">36%</span></span> |
| <span data-ttu-id="ed97a-154">**加载时间**</span><span class="sxs-lookup"><span data-stu-id="ed97a-154">**Load Time**</span></span> | <span data-ttu-id="ed97a-155">510 MS</span><span class="sxs-lookup"><span data-stu-id="ed97a-155">510 MS</span></span> | <span data-ttu-id="ed97a-156">780 MS</span><span class="sxs-lookup"><span data-stu-id="ed97a-156">780 MS</span></span> | <span data-ttu-id="ed97a-157">53%</span><span class="sxs-lookup"><span data-stu-id="ed97a-157">53%</span></span> |

<span data-ttu-id="ed97a-158">发送的字节数明显降低，因为浏览器与它们应用于请求的 HTTP 标头非常详细。</span><span class="sxs-lookup"><span data-stu-id="ed97a-158">The bytes sent had a significant reduction with bundling as browsers are fairly verbose with the HTTP headers they apply on requests.</span></span> <span data-ttu-id="ed97a-159">接收的字节数减少不大，因为最大文件（*脚本\\jquery-ui-* 和*脚本\\/selfservice/scripts/jquery-1.10.2.min.js 1.7.1*）已缩小。</span><span class="sxs-lookup"><span data-stu-id="ed97a-159">The received bytes reduction is not as large because the largest files (*Scripts\\jquery-ui-1.8.11.min.js* and *Scripts\\jquery-1.7.1.min.js*) are already minified.</span></span> <span data-ttu-id="ed97a-160">注意：示例程序上的计时使用[Fiddler](http://www.fiddler2.com/fiddler2/)工具来模拟慢速网络。</span><span class="sxs-lookup"><span data-stu-id="ed97a-160">Note: The timings on the sample program used the [Fiddler](http://www.fiddler2.com/fiddler2/) tool to simulate a slow network.</span></span> <span data-ttu-id="ed97a-161">（从 "Fiddler**规则**" 菜单中，选择 "**性能**"，然后**模拟调制解调器速度**。）</span><span class="sxs-lookup"><span data-stu-id="ed97a-161">(From the Fiddler **Rules** menu, select **Performance** then **Simulate Modem Speeds**.)</span></span>

## <a name="debugging-bundled-and-minified-javascript"></a><span data-ttu-id="ed97a-162">调试捆绑的和缩小的 JavaScript</span><span class="sxs-lookup"><span data-stu-id="ed97a-162">Debugging Bundled and Minified JavaScript</span></span>

<span data-ttu-id="ed97a-163">可以轻松地在开发环境中调试 JavaScript （其中*web.config*文件中的[编译元素](https://msdn.microsoft.com/library/s10awwz0.aspx)设置为 `debug="true"`），因为 javascript 文件不是捆绑的或缩小的。</span><span class="sxs-lookup"><span data-stu-id="ed97a-163">It's easy to debug your JavaScript in a development environment (where the [compilation Element](https://msdn.microsoft.com/library/s10awwz0.aspx) in the *Web.config* file is set to `debug="true"` ) because the JavaScript files are not bundled or minified.</span></span> <span data-ttu-id="ed97a-164">你还可以调试在其中捆绑了 JavaScript 文件并缩小的发布版本。</span><span class="sxs-lookup"><span data-stu-id="ed97a-164">You can also debug a release build where your JavaScript files are bundled and minified.</span></span> <span data-ttu-id="ed97a-165">使用 IE F12 开发人员工具，可以使用以下方法调试缩小捆绑中包含的 JavaScript 函数：</span><span class="sxs-lookup"><span data-stu-id="ed97a-165">Using the IE F12 developer tools, you debug a JavaScript function included in a minified bundle using the following approach:</span></span>

1. <span data-ttu-id="ed97a-166">选择 "**脚本**" 选项卡，然后选择 "**启动调试**" 按钮。</span><span class="sxs-lookup"><span data-stu-id="ed97a-166">Select the **Script** tab and then select the **Start debugging** button.</span></span>
2. <span data-ttu-id="ed97a-167">使用 "资产" 按钮选择包含要调试的 JavaScript 函数的捆绑包。</span><span class="sxs-lookup"><span data-stu-id="ed97a-167">Select the bundle containing the JavaScript function you want to debug using the assets button.</span></span>  
    ![](bundling-and-minification/_static/image4.png)
3. <span data-ttu-id="ed97a-168">通过选择 "**配置" 按钮**![](bundling-and-minification/_static/image5.png)设置缩小 javascript 的格式，然后选择 "**设置 javascript 格式**"。</span><span class="sxs-lookup"><span data-stu-id="ed97a-168">Format the minified JavaScript by selecting the **Configuration button** ![](bundling-and-minification/_static/image5.png), and then selecting **Format JavaScript**.</span></span>
4. <span data-ttu-id="ed97a-169">在 "**搜索脚本**" 输入框中，选择要调试的函数的名称。</span><span class="sxs-lookup"><span data-stu-id="ed97a-169">In the **Search Script** input box, select the name of the function you want to debug.</span></span> <span data-ttu-id="ed97a-170">在下图中，在 "**搜索脚本**" 输入框中输入**AddAltToImg** 。</span><span class="sxs-lookup"><span data-stu-id="ed97a-170">In the following image, **AddAltToImg** was entered in the **Search Script** input box.</span></span>  
    ![](bundling-and-minification/_static/image6.png)

<span data-ttu-id="ed97a-171">有关使用 F12 开发人员工具进行调试的详细信息，请参阅 MSDN 文章[使用 f12 开发人员工具调试 JavaScript 错误](https://msdn.microsoft.com/library/ie/gg699336(v=vs.85).aspx)。</span><span class="sxs-lookup"><span data-stu-id="ed97a-171">For more information on debugging with the F12 developer tools, see the MSDN article [Using the F12 Developer Tools to Debug JavaScript Errors](https://msdn.microsoft.com/library/ie/gg699336(v=vs.85).aspx).</span></span>

## <a name="controlling-bundling-and-minification"></a><span data-ttu-id="ed97a-172">控制绑定和缩减</span><span class="sxs-lookup"><span data-stu-id="ed97a-172">Controlling Bundling and Minification</span></span>

<span data-ttu-id="ed97a-173">通过在*web.config 文件中的*[编译元素](https://msdn.microsoft.com/library/s10awwz0.aspx)中设置 debug 属性的值，可启用或禁用绑定和缩减。</span><span class="sxs-lookup"><span data-stu-id="ed97a-173">Bundling and minification is enabled or disabled by setting the value of the debug attribute in the [compilation Element](https://msdn.microsoft.com/library/s10awwz0.aspx)  in the *Web.config* file.</span></span> <span data-ttu-id="ed97a-174">在下面的 XML 中，`debug` 设置为 true，因此将禁用捆绑和缩减。</span><span class="sxs-lookup"><span data-stu-id="ed97a-174">In the following XML, `debug` is set to true so bundling and minification is disabled.</span></span>

[!code-xml[Main](bundling-and-minification/samples/sample3.xml?highlight=2)]

<span data-ttu-id="ed97a-175">若要启用捆绑和缩减，请将 `debug` 值设置为 "false"。</span><span class="sxs-lookup"><span data-stu-id="ed97a-175">To enable bundling and minification, set the `debug` value to "false".</span></span> <span data-ttu-id="ed97a-176">您可以用 `BundleTable`*类的 `EnableOptimizations`* 属性覆盖 web.config 设置。</span><span class="sxs-lookup"><span data-stu-id="ed97a-176">You can override the *Web.config* setting with the `EnableOptimizations` property on the `BundleTable` class.</span></span> <span data-ttu-id="ed97a-177">下面的代码启用绑定和缩减，并覆盖*web.config*文件中的任何设置。</span><span class="sxs-lookup"><span data-stu-id="ed97a-177">The following code enables bundling and minification and overrides any setting in the *Web.config* file.</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample4.cs?highlight=7)]

> [!NOTE]
> <span data-ttu-id="ed97a-178">除非 `true` `EnableOptimizations` 或*web.config 文件中的*[编译元素](https://msdn.microsoft.com/library/s10awwz0.aspx)中的 debug 特性设置为 `false`，否则，将不会捆绑文件或缩小文件。</span><span class="sxs-lookup"><span data-stu-id="ed97a-178">Unless `EnableOptimizations` is `true` or the debug attribute in the [compilation Element](https://msdn.microsoft.com/library/s10awwz0.aspx)  in the *Web.config* file is set to `false`, files will not be bundled or minified.</span></span> <span data-ttu-id="ed97a-179">此外，将不会使用文件的最小版本，将选择完整的调试版本。</span><span class="sxs-lookup"><span data-stu-id="ed97a-179">Additionally, the .min version of files will not be used, the full debug versions will be selected.</span></span> <span data-ttu-id="ed97a-180">`EnableOptimizations` 重写*web.config*文件中的[编译元素](https://msdn.microsoft.com/library/s10awwz0.aspx)中的 debug 特性</span><span class="sxs-lookup"><span data-stu-id="ed97a-180">`EnableOptimizations` overrides the debug attribute in the [compilation Element](https://msdn.microsoft.com/library/s10awwz0.aspx)  in the *Web.config* file</span></span>

## <a name="using-bundling-and-minification-with-aspnet-web-forms-and-web-pages"></a><span data-ttu-id="ed97a-181">将绑定和缩减用于 ASP.NET Web 窗体和网页</span><span class="sxs-lookup"><span data-stu-id="ed97a-181">Using Bundling and Minification with ASP.NET Web Forms and Web Pages</span></span>

- <span data-ttu-id="ed97a-182">对于网页，请参阅[将 Web 优化添加到网页站点](https://docs.microsoft.com/archive/blogs/rickandy/adding-web-optimization-to-a-web-pages-site)中的博客文章。</span><span class="sxs-lookup"><span data-stu-id="ed97a-182">For Web Pages, see the blog entry [Adding Web Optimization to a Web Pages Site](https://docs.microsoft.com/archive/blogs/rickandy/adding-web-optimization-to-a-web-pages-site).</span></span>
- <span data-ttu-id="ed97a-183">对于 Web 窗体，请参阅博客文章[将绑定和缩减添加到 Web 窗体](https://docs.microsoft.com/archive/blogs/rickandy/adding-bundling-and-minification-to-web-forms)。</span><span class="sxs-lookup"><span data-stu-id="ed97a-183">For Web Forms, see the blog entry [Adding Bundling and Minification to Web Forms](https://docs.microsoft.com/archive/blogs/rickandy/adding-bundling-and-minification-to-web-forms).</span></span>

## <a name="using-bundling-and-minification-with-aspnet-mvc"></a><span data-ttu-id="ed97a-184">将绑定和缩减用于 ASP.NET MVC</span><span class="sxs-lookup"><span data-stu-id="ed97a-184">Using Bundling and Minification with ASP.NET MVC</span></span>

<span data-ttu-id="ed97a-185">在本部分中，我们将创建一个 ASP.NET MVC 项目来检查绑定和缩减。</span><span class="sxs-lookup"><span data-stu-id="ed97a-185">In this section we will create an ASP.NET MVC project to examine bundling and minification.</span></span> <span data-ttu-id="ed97a-186">首先，创建一个名为**MvcBM**的新 ASP.NET MVC internet 项目，而无需更改任何默认值。</span><span class="sxs-lookup"><span data-stu-id="ed97a-186">First, create a new ASP.NET MVC internet project named **MvcBM** without changing any of the defaults.</span></span>

<span data-ttu-id="ed97a-187">打开*应用程序\\\_启动\\BundleConfig.cs*文件，并检查用于创建、注册和配置绑定的 `RegisterBundles` 方法。</span><span class="sxs-lookup"><span data-stu-id="ed97a-187">Open the *App\\\_Start\\BundleConfig.cs* file and examine the `RegisterBundles` method which is used to create, register and configure bundles.</span></span> <span data-ttu-id="ed97a-188">下面的代码演示 `RegisterBundles` 方法的一部分。</span><span class="sxs-lookup"><span data-stu-id="ed97a-188">The following code shows a portion of the `RegisterBundles` method.</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample5.cs)]

<span data-ttu-id="ed97a-189">前面的代码将创建一个名为 *~/bundles/jquery*的新 JavaScript 包，其中包含所有合适的（即 debug 或缩小，但不包括）。*vsdoc*）*文件，该文件夹与*通配符 "~/Scripts/jquery-{version}.js" 匹配。</span><span class="sxs-lookup"><span data-stu-id="ed97a-189">The  preceding code creates a new JavaScript bundle named *~/bundles/jquery* that includes all the appropriate (that is debug or minified but not .*vsdoc*) files in the *Scripts* folder that match the wild card string "~/Scripts/jquery-{version}.js".</span></span> <span data-ttu-id="ed97a-190">对于 ASP.NET MVC 4，这意味着，对于调试配置，会将文件 */selfservice/scripts/jquery-1.10.2.min.js 1.7.1*添加到绑定中。</span><span class="sxs-lookup"><span data-stu-id="ed97a-190">For ASP.NET MVC 4, this means with a debug configuration, the file *jquery-1.7.1.js* will be added to the bundle.</span></span> <span data-ttu-id="ed97a-191">在发布配置中，将添加 */selfservice/scripts/jquery-1.10.2.min.js 1.7.1* 。</span><span class="sxs-lookup"><span data-stu-id="ed97a-191">In a release configuration, *jquery-1.7.1.min.js* will be added.</span></span> <span data-ttu-id="ed97a-192">绑定框架遵循几个常见约定，如：</span><span class="sxs-lookup"><span data-stu-id="ed97a-192">The bundling framework follows several common conventions such as:</span></span>

- <span data-ttu-id="ed97a-193">如果存在*FileX*和*FileX* ，则选择 "文件" 进行发布。</span><span class="sxs-lookup"><span data-stu-id="ed97a-193">Selecting ".min" file for release when *FileX.min.js* and *FileX.js* exist.</span></span>
- <span data-ttu-id="ed97a-194">选择要调试的非 "min" 版本。</span><span class="sxs-lookup"><span data-stu-id="ed97a-194">Selecting the non ".min" version for debug.</span></span>
- <span data-ttu-id="ed97a-195">忽略仅由 IntelliSense 使用的 "-vsdoc" 文件（如 */selfservice/scripts/jquery-1.10.2.min.js 1.7.1-vsdoc*）。</span><span class="sxs-lookup"><span data-stu-id="ed97a-195">Ignoring "-vsdoc" files (such as *jquery-1.7.1-vsdoc.js*), which are used only by IntelliSense.</span></span>

<span data-ttu-id="ed97a-196">上面所示的 `{version}` 通配符用于在*脚本*文件夹中自动创建具有适当版本 jQuery 的 jquery 包。</span><span class="sxs-lookup"><span data-stu-id="ed97a-196">The `{version}` wild card matching shown above is used to automatically create a jQuery bundle with the appropriate version of jQuery in your *Scripts* folder.</span></span> <span data-ttu-id="ed97a-197">在此示例中，使用通配符具有以下优势：</span><span class="sxs-lookup"><span data-stu-id="ed97a-197">In this example, using a wild card provides the following benefits:</span></span>

- <span data-ttu-id="ed97a-198">允许你使用 NuGet 更新到较新的 jQuery 版本，而无需在视图页中更改前面的绑定代码或 jQuery 引用。</span><span class="sxs-lookup"><span data-stu-id="ed97a-198">Allows you to use NuGet to update to a newer jQuery version without changing the preceding bundling code or jQuery references in your view pages.</span></span>
- <span data-ttu-id="ed97a-199">将自动选择调试配置的完整版本，并为发布版本自动选择 "min" 版本。</span><span class="sxs-lookup"><span data-stu-id="ed97a-199">Automatically selects the full version for debug configurations and the ".min" version for release builds.</span></span>

## <a name="using-a-cdn"></a><span data-ttu-id="ed97a-200">使用 CDN</span><span class="sxs-lookup"><span data-stu-id="ed97a-200">Using a CDN</span></span>

 <span data-ttu-id="ed97a-201">以下代码使用 CDN jQuery 束替换本地 jQuery 包。</span><span class="sxs-lookup"><span data-stu-id="ed97a-201">The follow code replaces the local jQuery bundle with a CDN jQuery bundle.</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample6.cs)]

<span data-ttu-id="ed97a-202">在上面的代码中，在发布模式下将从 CDN 请求 jQuery，并在调试模式下以本地方式提取 jQuery 的调试版本。</span><span class="sxs-lookup"><span data-stu-id="ed97a-202">In the code above, jQuery will be requested from the CDN while in release mode and the debug version of jQuery will be fetched locally in debug mode.</span></span> <span data-ttu-id="ed97a-203">使用 CDN 时，应具有回退机制，以防 CDN 请求失败。</span><span class="sxs-lookup"><span data-stu-id="ed97a-203">When using a CDN, you should have a fallback mechanism in case the CDN request fails.</span></span> <span data-ttu-id="ed97a-204">布局文件末尾的以下标记片段显示在 CDN 出现故障时，添加到请求 jQuery 的脚本。</span><span class="sxs-lookup"><span data-stu-id="ed97a-204">The following markup fragment from the end of the layout file shows script added to request jQuery should the CDN fail.</span></span>

[!code-cshtml[Main](bundling-and-minification/samples/sample7.cshtml?highlight=5-13)]

## <a name="creating-a-bundle"></a><span data-ttu-id="ed97a-205">创建捆绑包</span><span class="sxs-lookup"><span data-stu-id="ed97a-205">Creating a Bundle</span></span>

<span data-ttu-id="ed97a-206">[捆绑](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx)类 `Include` 方法采用字符串数组，其中每个字符串都是资源的虚拟路径。</span><span class="sxs-lookup"><span data-stu-id="ed97a-206">The [Bundle](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx) class `Include` method takes an array of strings, where each string is a virtual path to resource.</span></span> <span data-ttu-id="ed97a-207">以下从应用中的 `RegisterBundles` 方法中的代码 *\\\_Start\\BundleConfig.cs*文件中显示如何将多个文件添加到捆绑包：</span><span class="sxs-lookup"><span data-stu-id="ed97a-207">The following code from the `RegisterBundles` method in the *App\\\_Start\\BundleConfig.cs* file shows how multiple files are added to a bundle:</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample8.cs)]

<span data-ttu-id="ed97a-208">提供[捆绑](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx)类 `IncludeDirectory` 方法，以添加与搜索模式匹配的目录（以及所有子目录）中的所有文件。</span><span class="sxs-lookup"><span data-stu-id="ed97a-208">The [Bundle](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx) class `IncludeDirectory` method is provided to add all the files in a directory (and optionally all subdirectories) which match a search pattern.</span></span> <span data-ttu-id="ed97a-209">[包](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx)类 `IncludeDirectory` API 如下所示：</span><span class="sxs-lookup"><span data-stu-id="ed97a-209">The [Bundle](https://msdn.microsoft.com/library/system.web.optimization.bundle(v=VS.110).aspx) class `IncludeDirectory` API is shown below:</span></span>

[!code-csharp[Main](bundling-and-minification/samples/sample9.cs)]

<span data-ttu-id="ed97a-210">使用 Render 方法（用于 CSS 的`Styles.Render` 和 JavaScript 的 `Scripts.Render`），在视图中引用绑定。</span><span class="sxs-lookup"><span data-stu-id="ed97a-210">Bundles are referenced in views using the Render method, (`Styles.Render` for CSS and `Scripts.Render` for JavaScript).</span></span> <span data-ttu-id="ed97a-211">*\\共享\\\_Layout*文件的视图中的以下标记显示了默认 ASP.NET internet 项目视图如何引用 CSS 和 JavaScript 捆绑。</span><span class="sxs-lookup"><span data-stu-id="ed97a-211">The following markup from the *Views\\Shared\\\_Layout.cshtml* file shows how the default ASP.NET internet project views reference CSS and JavaScript bundles.</span></span>

[!code-cshtml[Main](bundling-and-minification/samples/sample10.cshtml?highlight=5-6,11)]

<span data-ttu-id="ed97a-212">请注意，Render 方法采用字符串数组，因此你可以在一个代码行中添加多个绑定。</span><span class="sxs-lookup"><span data-stu-id="ed97a-212">Notice the Render methods takes an array of strings, so you can add multiple bundles in one line of code.</span></span> <span data-ttu-id="ed97a-213">通常需要使用呈现方法，这些方法可创建所需的 HTML 来引用资产。</span><span class="sxs-lookup"><span data-stu-id="ed97a-213">You will generally want to use the Render methods which create the necessary HTML to reference the asset.</span></span> <span data-ttu-id="ed97a-214">您可以使用 `Url` 方法生成资产的 URL，而无需使用引用资产所需的标记。</span><span class="sxs-lookup"><span data-stu-id="ed97a-214">You can use the `Url` method to generate the URL to the asset without the markup needed to reference the asset.</span></span> <span data-ttu-id="ed97a-215">假设你想要使用新的 HTML5 [async](http://www.whatwg.org/specs/web-apps/current-work/#attr-script-async)属性。</span><span class="sxs-lookup"><span data-stu-id="ed97a-215">Suppose you wanted to use the new HTML5 [async](http://www.whatwg.org/specs/web-apps/current-work/#attr-script-async) attribute.</span></span> <span data-ttu-id="ed97a-216">下面的代码演示如何使用 `Url` 方法引用 modernizr。</span><span class="sxs-lookup"><span data-stu-id="ed97a-216">The following code shows how to reference modernizr using the `Url` method.</span></span>

[!code-cshtml[Main](bundling-and-minification/samples/sample11.cshtml?highlight=11)]

## <a name="using-the--wildcard-character-to-select-files"></a><span data-ttu-id="ed97a-217">使用 "\*" 通配符选择文件</span><span class="sxs-lookup"><span data-stu-id="ed97a-217">Using the "\*" Wildcard Character to Select Files</span></span>

<span data-ttu-id="ed97a-218">在 `Include` 方法中指定的虚拟路径和 `IncludeDirectory` 方法中的搜索模式可以接受一个 "\*" 通配符，作为最后一个路径段中的前缀或后缀。</span><span class="sxs-lookup"><span data-stu-id="ed97a-218">The virtual path specified in the `Include` method and the search pattern in the `IncludeDirectory` method can accept one "\*" wildcard character as a prefix or suffix to in the last path segment.</span></span> <span data-ttu-id="ed97a-219">搜索字符串不区分大小写。</span><span class="sxs-lookup"><span data-stu-id="ed97a-219">The search string is case insensitive.</span></span> <span data-ttu-id="ed97a-220">`IncludeDirectory` 方法提供搜索子目录的选项。</span><span class="sxs-lookup"><span data-stu-id="ed97a-220">The `IncludeDirectory` method has the option of searching subdirectories.</span></span>

<span data-ttu-id="ed97a-221">请考虑使用以下 JavaScript 文件的项目：</span><span class="sxs-lookup"><span data-stu-id="ed97a-221">Consider a project with the following JavaScript files:</span></span>

- <span data-ttu-id="ed97a-222">*脚本\\Common\\AddAltToImg*</span><span class="sxs-lookup"><span data-stu-id="ed97a-222">*Scripts\\Common\\AddAltToImg.js*</span></span>
- <span data-ttu-id="ed97a-223">*脚本\\Common\\ToggleDiv*</span><span class="sxs-lookup"><span data-stu-id="ed97a-223">*Scripts\\Common\\ToggleDiv.js*</span></span>
- <span data-ttu-id="ed97a-224">*脚本\\Common\\ToggleImg*</span><span class="sxs-lookup"><span data-stu-id="ed97a-224">*Scripts\\Common\\ToggleImg.js*</span></span>
- <span data-ttu-id="ed97a-225">*脚本\\Common\\Sub1\\ToggleLinks*</span><span class="sxs-lookup"><span data-stu-id="ed97a-225">*Scripts\\Common\\Sub1\\ToggleLinks.js*</span></span>

![dir imag](bundling-and-minification/_static/image7.png)

<span data-ttu-id="ed97a-227">下表显示了使用通配符添加到捆绑包的文件，如下所示：</span><span class="sxs-lookup"><span data-stu-id="ed97a-227">The following table shows the files added to a bundle using the wildcard as shown:</span></span>

| <span data-ttu-id="ed97a-228">**Call**</span><span class="sxs-lookup"><span data-stu-id="ed97a-228">**Call**</span></span> | <span data-ttu-id="ed97a-229">**添加的文件或引发的异常**</span><span class="sxs-lookup"><span data-stu-id="ed97a-229">**Files Added or Exception Raised**</span></span> |
| --- | --- |
| <span data-ttu-id="ed97a-230">Include （"~/Scripts/Common/\*.js"）</span><span class="sxs-lookup"><span data-stu-id="ed97a-230">Include("~/Scripts/Common/\*.js")</span></span> | <span data-ttu-id="ed97a-231">*AddAltToImg*、 *ToggleDiv*、 *ToggleImg*</span><span class="sxs-lookup"><span data-stu-id="ed97a-231">*AddAltToImg.js*, *ToggleDiv.js*, *ToggleImg.js*</span></span> |
| <span data-ttu-id="ed97a-232">Include （"~/Scripts/Common/T\*.js"）</span><span class="sxs-lookup"><span data-stu-id="ed97a-232">Include("~/Scripts/Common/T\*.js")</span></span> | <span data-ttu-id="ed97a-233">模式异常无效。</span><span class="sxs-lookup"><span data-stu-id="ed97a-233">Invalid pattern exception.</span></span> <span data-ttu-id="ed97a-234">仅前缀或后缀允许使用通配符。</span><span class="sxs-lookup"><span data-stu-id="ed97a-234">The wildcard character is only allowed on the prefix or suffix.</span></span> |
| <span data-ttu-id="ed97a-235">Include （"~/Scripts/Common/\*og。\*"）</span><span class="sxs-lookup"><span data-stu-id="ed97a-235">Include("~/Scripts/Common/\*og.\*")</span></span> | <span data-ttu-id="ed97a-236">模式异常无效。</span><span class="sxs-lookup"><span data-stu-id="ed97a-236">Invalid pattern exception.</span></span> <span data-ttu-id="ed97a-237">只允许使用一个通配符。</span><span class="sxs-lookup"><span data-stu-id="ed97a-237">Only one wildcard character is allowed.</span></span> |
| <span data-ttu-id="ed97a-238">Include （"~/Scripts/Common/T\*"）</span><span class="sxs-lookup"><span data-stu-id="ed97a-238">Include("~/Scripts/Common/T\*")</span></span> | <span data-ttu-id="ed97a-239">*ToggleDiv*， *ToggleImg*</span><span class="sxs-lookup"><span data-stu-id="ed97a-239">*ToggleDiv.js*, *ToggleImg.js*</span></span> |
| <span data-ttu-id="ed97a-240">Include （"~/Scripts/Common/\*"）</span><span class="sxs-lookup"><span data-stu-id="ed97a-240">Include("~/Scripts/Common/\*")</span></span> | <span data-ttu-id="ed97a-241">模式异常无效。</span><span class="sxs-lookup"><span data-stu-id="ed97a-241">Invalid pattern exception.</span></span> <span data-ttu-id="ed97a-242">纯通配符段无效。</span><span class="sxs-lookup"><span data-stu-id="ed97a-242">A pure wildcard segment is not valid.</span></span> |
| <span data-ttu-id="ed97a-243">IncludeDirectory （"~/Scripts/Common"，"T\*"）</span><span class="sxs-lookup"><span data-stu-id="ed97a-243">IncludeDirectory("~/Scripts/Common", "T\*")</span></span> | <span data-ttu-id="ed97a-244">*ToggleDiv*， *ToggleImg*</span><span class="sxs-lookup"><span data-stu-id="ed97a-244">*ToggleDiv.js*, *ToggleImg.js*</span></span> |
| <span data-ttu-id="ed97a-245">IncludeDirectory （"~/Scripts/Common"，"T\*"，true）</span><span class="sxs-lookup"><span data-stu-id="ed97a-245">IncludeDirectory("~/Scripts/Common", "T\*", true)</span></span> | <span data-ttu-id="ed97a-246">*ToggleDiv*、 *ToggleImg*、 *ToggleLinks*</span><span class="sxs-lookup"><span data-stu-id="ed97a-246">*ToggleDiv.js*, *ToggleImg.js*, *ToggleLinks.js*</span></span> |

<span data-ttu-id="ed97a-247">通常，出于以下原因，将每个文件显式添加到捆绑包通常是首选的：</span><span class="sxs-lookup"><span data-stu-id="ed97a-247">Explicitly adding each file to a bundle is generally the preferred over wildcard loading of files for the following reasons:</span></span>

- <span data-ttu-id="ed97a-248">按通配符添加脚本默认为按字母顺序加载它们，这通常不是你想要的。</span><span class="sxs-lookup"><span data-stu-id="ed97a-248">Adding scripts by wildcard defaults to loading them in alphabetical order, which is typically not what you want.</span></span> <span data-ttu-id="ed97a-249">通常需要以特定（非字母）顺序添加 CSS 和 JavaScript 文件。</span><span class="sxs-lookup"><span data-stu-id="ed97a-249">CSS and JavaScript files frequently need to be added in a specific (non-alphabetic) order.</span></span> <span data-ttu-id="ed97a-250">可以通过添加自定义[IBundleOrderer](https://msdn.microsoft.com/library/system.web.optimization.ibundleorderer(VS.110).aspx)实现来缓解这一风险，但显式添加每个文件会更容易出错。</span><span class="sxs-lookup"><span data-stu-id="ed97a-250">You can mitigate this risk by adding a custom [IBundleOrderer](https://msdn.microsoft.com/library/system.web.optimization.ibundleorderer(VS.110).aspx) implementation, but explicitly adding each file is less error prone.</span></span> <span data-ttu-id="ed97a-251">例如，你可能会在将来向文件夹中添加新资产，这可能需要你修改[IBundleOrderer](https://msdn.microsoft.com/library/system.web.optimization.ibundleorderer(VS.110).aspx)实现。</span><span class="sxs-lookup"><span data-stu-id="ed97a-251">For example, you might add new assets to a folder in the future which might require you to modify your [IBundleOrderer](https://msdn.microsoft.com/library/system.web.optimization.ibundleorderer(VS.110).aspx) implementation.</span></span>
- <span data-ttu-id="ed97a-252">使用通配符加载查看添加到目录中的特定文件可以包含在引用该捆绑包的所有视图中。</span><span class="sxs-lookup"><span data-stu-id="ed97a-252">View specific files added to a directory using wild card loading can be included in all views referencing that bundle.</span></span> <span data-ttu-id="ed97a-253">如果将特定于视图的脚本添加到捆绑包，则可能会在引用此绑定的其他视图上出现 JavaScript 错误。</span><span class="sxs-lookup"><span data-stu-id="ed97a-253">If the view specific script is added to a bundle, you may get a JavaScript error on other views that reference the bundle.</span></span>
- <span data-ttu-id="ed97a-254">导入其他文件的 CSS 文件会导致导入的文件加载两次。</span><span class="sxs-lookup"><span data-stu-id="ed97a-254">CSS files that import other files result in the imported files loaded twice.</span></span> <span data-ttu-id="ed97a-255">例如，下面的代码创建一个绑定，其中大部分 jQuery UI 主题都加载了两次。</span><span class="sxs-lookup"><span data-stu-id="ed97a-255">For example, the following code creates a bundle with most of the jQuery UI theme CSS files loaded twice.</span></span> 

    [!code-csharp[Main](bundling-and-minification/samples/sample12.cs)]

  <span data-ttu-id="ed97a-256">通配符选择器 "\*" 会引入文件夹中的每个 CSS 文件，包括*内容\\主题\\基本\\jquery. 所有 .css*文件。</span><span class="sxs-lookup"><span data-stu-id="ed97a-256">The wild card selector "\*.css" brings in each CSS file in the folder, including the *Content\\themes\\base\\jquery.ui.all.css* file.</span></span> <span data-ttu-id="ed97a-257">*Jquery. the .css*文件导入其他 css 文件。</span><span class="sxs-lookup"><span data-stu-id="ed97a-257">The *jquery.ui.all.css* file imports other CSS files.</span></span>

## <a name="bundle-caching"></a><span data-ttu-id="ed97a-258">绑定缓存</span><span class="sxs-lookup"><span data-stu-id="ed97a-258">Bundle Caching</span></span>

<span data-ttu-id="ed97a-259">绑定将 HTTP Expires 标头设置为从创建捆绑包起一年。</span><span class="sxs-lookup"><span data-stu-id="ed97a-259">Bundles set the HTTP Expires Header one year from when the bundle is created.</span></span> <span data-ttu-id="ed97a-260">如果导航到以前查看过的页面，则 Fiddler 会显示 IE 不会发出针对捆绑包的条件请求，即，来自 IE 的绑定没有 HTTP GET 请求，并且没有来自服务器的 HTTP 304 响应。</span><span class="sxs-lookup"><span data-stu-id="ed97a-260">If you navigate to a previously viewed page, Fiddler shows IE does not make a conditional request for the bundle, that is, there are no HTTP GET requests from IE for the bundles and no HTTP 304 responses from the server.</span></span> <span data-ttu-id="ed97a-261">可以强制 IE 使用 F5 键对每个绑定发出条件请求（导致每个绑定出现 HTTP 304 响应）。</span><span class="sxs-lookup"><span data-stu-id="ed97a-261">You can force IE to make a conditional request for each bundle with the F5 key (resulting in a HTTP 304 response for each bundle).</span></span> <span data-ttu-id="ed97a-262">您可以使用 ^ F5 强制执行完全刷新（这会导致每个绑定出现 HTTP 200 响应）。</span><span class="sxs-lookup"><span data-stu-id="ed97a-262">You can force a full refresh by using ^F5 (resulting in a HTTP 200 response for each bundle.)</span></span>

<span data-ttu-id="ed97a-263">下图显示了 "Fiddler 响应" 窗格的 "**缓存**" 选项卡：</span><span class="sxs-lookup"><span data-stu-id="ed97a-263">The following image shows the **Caching** tab of the Fiddler response pane:</span></span>

![fiddler 缓存图像](bundling-and-minification/_static/image8.png)

<span data-ttu-id="ed97a-265">请求</span><span class="sxs-lookup"><span data-stu-id="ed97a-265">The request</span></span>   
`http://localhost/MvcBM_time/bundles/AllMyScripts?v=r0sLDicvP58AIXN_mc3QdyVvVj5euZNzdsa2N1PKvb81`  
 <span data-ttu-id="ed97a-266">适用于捆绑**AllMyScripts** ，包含查询字符串对**v = R0sLDicvP58AIXN\\\_mc3QdyVvVj5euZNzdsa2N1PKvb81**。</span><span class="sxs-lookup"><span data-stu-id="ed97a-266">is for the bundle **AllMyScripts** and contains a query string pair **v=r0sLDicvP58AIXN\\\_mc3QdyVvVj5euZNzdsa2N1PKvb81**.</span></span> <span data-ttu-id="ed97a-267">查询字符串**v**具有一个值标记，它是用于缓存的唯一标识符。</span><span class="sxs-lookup"><span data-stu-id="ed97a-267">The query string **v** has a value token that is a unique identifier used for caching.</span></span> <span data-ttu-id="ed97a-268">只要捆绑包不会更改，ASP.NET 应用程序就会使用此令牌请求**AllMyScripts**捆绑。</span><span class="sxs-lookup"><span data-stu-id="ed97a-268">As long as the bundle doesn't change, the ASP.NET application will request the **AllMyScripts** bundle using this token.</span></span> <span data-ttu-id="ed97a-269">如果捆绑中的任何文件发生更改，ASP.NET 优化框架将生成新的令牌，以确保对绑定的浏览器请求获得最新的捆绑。</span><span class="sxs-lookup"><span data-stu-id="ed97a-269">If any file in the bundle changes, the ASP.NET optimization framework will generate a new token, guaranteeing that browser requests for the bundle will get the latest bundle.</span></span>

<span data-ttu-id="ed97a-270">如果运行 IE9 F12 开发人员工具并导航到以前加载的页面，则 IE 会错误地显示对每个绑定和返回 HTTP 304 的服务器发出的条件 GET 请求。</span><span class="sxs-lookup"><span data-stu-id="ed97a-270">If you run the IE9 F12 developer tools and navigate to a previously loaded page, IE incorrectly shows conditional GET requests made to each bundle and the server returning HTTP 304.</span></span> <span data-ttu-id="ed97a-271">你可以阅读为什么 IE9 在使用 Cdn 的博客条目中进行条件请求时遇到问题[，并使其过期以提高网站性能](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx)。</span><span class="sxs-lookup"><span data-stu-id="ed97a-271">You can read why IE9 has problems determining if a conditional request was made in the blog entry [Using CDNs and Expires to Improve Web Site Performance](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx).</span></span>

## <a name="less-coffeescript-scss-sass-bundling"></a><span data-ttu-id="ed97a-272">LESS、CoffeeScript、SCSS、Sass 绑定。</span><span class="sxs-lookup"><span data-stu-id="ed97a-272">LESS, CoffeeScript, SCSS, Sass Bundling.</span></span>

<span data-ttu-id="ed97a-273">绑定和缩减框架提供了一种机制来处理中间语言（如[SCSS](http://sass-lang.com/)、 [Sass](http://sass-lang.com/)、 [LESS](http://www.dotlesscss.org/)或[Coffeescript](http://coffeescript.org/)），并将缩减等转换应用到生成的绑定。</span><span class="sxs-lookup"><span data-stu-id="ed97a-273">The bundling and minification framework provides a mechanism to process intermediate languages such as [SCSS](http://sass-lang.com/), [Sass](http://sass-lang.com/), [LESS](http://www.dotlesscss.org/) or [Coffeescript](http://coffeescript.org/), and apply transforms such as minification to the resulting bundle.</span></span> <span data-ttu-id="ed97a-274">例如，若要将[文件添加](http://www.dotlesscss.org/)到 MVC 4 项目，请执行以下操作：</span><span class="sxs-lookup"><span data-stu-id="ed97a-274">For example, to add [.less](http://www.dotlesscss.org/) files to your MVC 4 project:</span></span>

1. <span data-ttu-id="ed97a-275">为较少的内容创建一个文件夹。</span><span class="sxs-lookup"><span data-stu-id="ed97a-275">Create a folder for your LESS content.</span></span> <span data-ttu-id="ed97a-276">下面的示例使用*Content\\MyLess*文件夹。</span><span class="sxs-lookup"><span data-stu-id="ed97a-276">The following example uses the *Content\\MyLess* folder.</span></span>
2. <span data-ttu-id="ed97a-277">将[不太少](http://www.dotlesscss.org/)的 NuGet**包添加到你的项目**中。</span><span class="sxs-lookup"><span data-stu-id="ed97a-277">Add the [.less](http://www.dotlesscss.org/) NuGet package **dotless** to your project.</span></span>  
    <span data-ttu-id="ed97a-278">![NuGet 无点安装](bundling-and-minification/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="ed97a-278">![NuGet dotless install](bundling-and-minification/_static/image9.png)</span></span>
3. <span data-ttu-id="ed97a-279">添加一个实现[IBundleTransform](https://msdn.microsoft.com/library/system.web.optimization.ibundletransform(VS.110).aspx)接口的类。</span><span class="sxs-lookup"><span data-stu-id="ed97a-279">Add a class that implements the [IBundleTransform](https://msdn.microsoft.com/library/system.web.optimization.ibundletransform(VS.110).aspx) interface.</span></span> <span data-ttu-id="ed97a-280">对于更少的转换，请将以下代码添加到你的项目中。</span><span class="sxs-lookup"><span data-stu-id="ed97a-280">For the .less transform, add the following code to your project.</span></span>

    [!code-csharp[Main](bundling-and-minification/samples/sample13.cs)]
4. <span data-ttu-id="ed97a-281">使用 `LessTransform` 和[CssMinify](https://msdn.microsoft.com/library/system.web.optimization.cssminify(VS.110).aspx)转换创建更少的文件包。</span><span class="sxs-lookup"><span data-stu-id="ed97a-281">Create a bundle of LESS files with the `LessTransform` and the [CssMinify](https://msdn.microsoft.com/library/system.web.optimization.cssminify(VS.110).aspx) transform.</span></span> <span data-ttu-id="ed97a-282">将以下代码添加到应用中的 `RegisterBundles` 方法 *\\_Start\\BundleConfig.cs*文件。</span><span class="sxs-lookup"><span data-stu-id="ed97a-282">Add the following code to the `RegisterBundles` method in the *App\\_Start\\BundleConfig.cs* file.</span></span>

    [!code-csharp[Main](bundling-and-minification/samples/sample14.cs)]
5. <span data-ttu-id="ed97a-283">将以下代码添加到引用较少绑定的任何视图。</span><span class="sxs-lookup"><span data-stu-id="ed97a-283">Add the following code to any views which references the LESS bundle.</span></span>

    [!code-cshtml[Main](bundling-and-minification/samples/sample15.cshtml)]

## <a name="bundle-considerations"></a><span data-ttu-id="ed97a-284">捆绑包注意事项</span><span class="sxs-lookup"><span data-stu-id="ed97a-284">Bundle Considerations</span></span>

<span data-ttu-id="ed97a-285">创建捆绑包时应遵循的一个好约定是在绑定名称中包含 "捆绑" 作为前缀。</span><span class="sxs-lookup"><span data-stu-id="ed97a-285">A good convention to follow when creating bundles is to include "bundle" as a prefix in the bundle name.</span></span> <span data-ttu-id="ed97a-286">这会阻止可能的[路由冲突](https://forums.asp.net/post/5012037.aspx)。</span><span class="sxs-lookup"><span data-stu-id="ed97a-286">This will prevent a possible [routing conflict](https://forums.asp.net/post/5012037.aspx).</span></span>

<span data-ttu-id="ed97a-287">更新捆绑包中的一个文件后，系统将为捆绑包查询字符串参数生成一个新的令牌，并且在客户端下次请求包含该绑定的页面时，必须下载完全绑定。</span><span class="sxs-lookup"><span data-stu-id="ed97a-287">Once you update one file in a bundle, a new token is generated for the bundle query string parameter and the full bundle must be downloaded the next time a client requests a page containing the bundle.</span></span> <span data-ttu-id="ed97a-288">在每个资产单独列出的传统标记中，只会下载已更改的文件。</span><span class="sxs-lookup"><span data-stu-id="ed97a-288">In traditional markup where each asset is listed individually, only the changed file would be downloaded.</span></span> <span data-ttu-id="ed97a-289">经常更改的资产可能不适合进行捆绑。</span><span class="sxs-lookup"><span data-stu-id="ed97a-289">Assets that change frequently may not be good candidates for bundling.</span></span>

<span data-ttu-id="ed97a-290">绑定和缩减主要改善第一页请求加载时间。</span><span class="sxs-lookup"><span data-stu-id="ed97a-290">Bundling and minification primarily improve the first page request load time.</span></span> <span data-ttu-id="ed97a-291">请求网页后，浏览器会缓存资产（JavaScript、CSS 和图像），因此，在请求同一页面或同一站点上请求同一资产的页面时，绑定和缩减不会提供任何性能提升。</span><span class="sxs-lookup"><span data-stu-id="ed97a-291">Once a webpage has been requested, the browser caches the assets (JavaScript, CSS and images) so bundling and minification won't provide any performance boost when requesting the same page, or pages on the same site requesting the same assets.</span></span> <span data-ttu-id="ed97a-292">如果你没有正确地在资产上设置 expires 标头，并且不使用捆绑和缩减，则浏览器新鲜度试探法会在几天后将资产标记为过时，并且浏览器将需要对每个资产进行验证请求。</span><span class="sxs-lookup"><span data-stu-id="ed97a-292">If you don't set the expires header correctly on your assets, and you don't use bundling and minification, the browsers freshness heuristics will mark the assets stale after a few days and the browser will require a validation request for each asset.</span></span> <span data-ttu-id="ed97a-293">在这种情况下，绑定和缩减在第一次请求页面后会提高性能。</span><span class="sxs-lookup"><span data-stu-id="ed97a-293">In this case, bundling and minification provide a performance increase after the first page request.</span></span> <span data-ttu-id="ed97a-294">有关详细信息，请参阅[使用 cdn 的博客并过期以提高网站性能](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx)。</span><span class="sxs-lookup"><span data-stu-id="ed97a-294">For details, see the blog [Using CDNs and Expires to Improve Web Site Performance](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx).</span></span>

<span data-ttu-id="ed97a-295">对于每个主机名，可以通过使用[CDN](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx)来减少六个同时连接的浏览器限制。</span><span class="sxs-lookup"><span data-stu-id="ed97a-295">The browser limitation of six simultaneous connections per each hostname can be mitigated by using a [CDN](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx).</span></span> <span data-ttu-id="ed97a-296">由于 CDN 的主机名将不同于托管站点的主机名，因此来自 CDN 的资产请求将不会计为托管环境的六个同时连接限制。</span><span class="sxs-lookup"><span data-stu-id="ed97a-296">Because the CDN will have a different hostname than your hosting site, asset requests from the CDN will not count against the six simultaneous connections limit to your hosting environment.</span></span> <span data-ttu-id="ed97a-297">CDN 还可以提供常见的包缓存和边缘缓存优点。</span><span class="sxs-lookup"><span data-stu-id="ed97a-297">A CDN can also provide common package caching and edge caching advantages.</span></span>

<span data-ttu-id="ed97a-298">捆绑包应按需要它们的页面进行分区。</span><span class="sxs-lookup"><span data-stu-id="ed97a-298">Bundles should be partitioned by pages that need them.</span></span> <span data-ttu-id="ed97a-299">例如，internet 应用程序的默认 ASP.NET MVC 模板会创建独立于 jQuery 的 jQuery 验证捆绑。</span><span class="sxs-lookup"><span data-stu-id="ed97a-299">For example, the default ASP.NET MVC template for an internet application creates a jQuery Validation bundle separate from jQuery.</span></span> <span data-ttu-id="ed97a-300">由于创建的默认视图不包含任何输入，也不会发布值，因此它们不包括验证捆绑。</span><span class="sxs-lookup"><span data-stu-id="ed97a-300">Because the default views created have no input and do not post values, they don't include the validation bundle.</span></span>

<span data-ttu-id="ed97a-301">`System.Web.Optimization` 命名空间是在*system.web*中实现的。</span><span class="sxs-lookup"><span data-stu-id="ed97a-301">The `System.Web.Optimization` namespace is implemented in *System.Web.Optimization.dll*.</span></span> <span data-ttu-id="ed97a-302">它利用 WebGrease 库（*WebGrease*） for 缩减功能，后者又使用*Antlr3*。</span><span class="sxs-lookup"><span data-stu-id="ed97a-302">It leverages the WebGrease library (*WebGrease.dll*) for minification capabilities, which in turn uses *Antlr3.Runtime.dll*.</span></span>

<span data-ttu-id="ed97a-303">*我使用 Twitter 进行快速发布和共享链接。我的 Twitter 句柄为*： [@RickAndMSFT](http://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="ed97a-303">*I use Twitter to make quick posts and share links. My Twitter handle is*: [@RickAndMSFT](http://twitter.com/RickAndMSFT)</span></span>

## <a name="additional-resources"></a><span data-ttu-id="ed97a-304">其他资源</span><span class="sxs-lookup"><span data-stu-id="ed97a-304">Additional resources</span></span>

- <span data-ttu-id="ed97a-305">视频：通过[Howard Dierking](https://twitter.com/#!/howard_dierking)进行[捆绑和优化](https://channel9.msdn.com/Events/aspConf/aspConf/Bundling-and-Optimizing)</span><span class="sxs-lookup"><span data-stu-id="ed97a-305">Video:[Bundling and Optimizing](https://channel9.msdn.com/Events/aspConf/aspConf/Bundling-and-Optimizing) by [Howard Dierking](https://twitter.com/#!/howard_dierking)</span></span>
- <span data-ttu-id="ed97a-306">[将 Web 优化添加到网页站点](https://blogs.msdn.com/b/rickandy/archive/2012/08/15/adding-web-optimization-to-a-web-pages-site.aspx)。</span><span class="sxs-lookup"><span data-stu-id="ed97a-306">[Adding Web Optimization to a Web Pages Site](https://blogs.msdn.com/b/rickandy/archive/2012/08/15/adding-web-optimization-to-a-web-pages-site.aspx).</span></span>
- <span data-ttu-id="ed97a-307">[将绑定和缩减添加到 Web 窗体](https://blogs.msdn.com/b/rickandy/archive/2012/08/14/adding-bundling-and-minification-to-web-forms.aspx)。</span><span class="sxs-lookup"><span data-stu-id="ed97a-307">[Adding Bundling and Minification to Web Forms](https://blogs.msdn.com/b/rickandy/archive/2012/08/14/adding-bundling-and-minification-to-web-forms.aspx).</span></span>
- <span data-ttu-id="ed97a-308">[Henrik F Nielsen](http://en.wikipedia.org/wiki/Henrik_Frystyk_Nielsen) [@frystyk](https://twitter.com/frystyk) [的 Web 浏览的绑定和缩减的性能影响](https://blogs.msdn.com/b/henrikn/archive/2012/06/17/performance-implications-of-bundling-and-minification-on-http.aspx)</span><span class="sxs-lookup"><span data-stu-id="ed97a-308">[Performance Implications of Bundling and Minification on Web Browsing](https://blogs.msdn.com/b/henrikn/archive/2012/06/17/performance-implications-of-bundling-and-minification-on-http.aspx) by [Henrik F Nielsen](http://en.wikipedia.org/wiki/Henrik_Frystyk_Nielsen) [@frystyk](https://twitter.com/frystyk)</span></span>
- <span data-ttu-id="ed97a-309">[使用 cdn 并过期](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx)，通过 Rick Anderson [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)提高网站性能</span><span class="sxs-lookup"><span data-stu-id="ed97a-309">[Using CDNs and Expires to Improve Web Site Performance](https://blogs.msdn.com/b/rickandy/archive/2011/05/21/using-cdns-to-improve-web-site-performance.aspx) by Rick Anderson [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT)</span></span>
- [<span data-ttu-id="ed97a-310">最小化 RTT （往返时间）</span><span class="sxs-lookup"><span data-stu-id="ed97a-310">Minimize RTT (round-trip times)</span></span>](https://developers.google.com/speed/docs/best-practices/rtt)

## <a name="contributors"></a><span data-ttu-id="ed97a-311">参与者</span><span class="sxs-lookup"><span data-stu-id="ed97a-311">Contributors</span></span>

- <span data-ttu-id="ed97a-312">Hao Kung</span><span class="sxs-lookup"><span data-stu-id="ed97a-312">Hao Kung</span></span>
- [<span data-ttu-id="ed97a-313">Howard Dierking</span><span class="sxs-lookup"><span data-stu-id="ed97a-313">Howard Dierking</span></span>](https://twitter.com/#!/howard_dierking)
- <span data-ttu-id="ed97a-314">Diana LaRose</span><span class="sxs-lookup"><span data-stu-id="ed97a-314">Diana LaRose</span></span>
