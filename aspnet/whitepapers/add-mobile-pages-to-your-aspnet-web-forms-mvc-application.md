---
uid: whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
title: 如何：向 ASP.NET Web 窗体/MVC 应用程序添加移动页面 |Microsoft Docs
author: rick-anderson
description: 本指南说明如何从 ASP.NET Web Forms/MVC 应用程序为移动设备提供优化页面的各种方法，并提供体系结构和 。
ms.author: riande
ms.date: 01/20/2011
ms.assetid: 3124f28e-cc32-418a-afe3-519fa56f4c36
msc.legacyurl: /whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
msc.type: content
ms.openlocfilehash: 63c555358d06a9506bb5c8c993800c3307108192
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/06/2020
ms.locfileid: "78462212"
---
# <a name="how-to-add-mobile-pages-to-your-aspnet-web-forms--mvc-application"></a><span data-ttu-id="2725f-103">如何：向 ASP.NET Web 窗体/MVC 应用程序添加移动页</span><span class="sxs-lookup"><span data-stu-id="2725f-103">How To: Add Mobile Pages to Your ASP.NET Web Forms / MVC Application</span></span>

> <span data-ttu-id="2725f-104">**适用于**</span><span class="sxs-lookup"><span data-stu-id="2725f-104">**Applies To**</span></span>
> 
> - <span data-ttu-id="2725f-105">ASP.NET Web 窗体4.0 版</span><span class="sxs-lookup"><span data-stu-id="2725f-105">ASP.NET Web Forms version 4.0</span></span>
> - <span data-ttu-id="2725f-106">ASP.NET MVC 版本3。0</span><span class="sxs-lookup"><span data-stu-id="2725f-106">ASP.NET MVC version 3.0</span></span>
> 
> <span data-ttu-id="2725f-107">**摘要**</span><span class="sxs-lookup"><span data-stu-id="2725f-107">**Summary**</span></span>
> 
> <span data-ttu-id="2725f-108">本指南介绍了从 ASP.NET Web Forms/MVC 应用程序为移动设备提供优化页面的各种方法，并提供了面向各种设备时要考虑的体系结构和设计问题。</span><span class="sxs-lookup"><span data-stu-id="2725f-108">This How To describes various ways to serve pages optimized for mobile devices from your ASP.NET Web Forms / MVC application, and suggests architectural and design issues to consider when targeting a broad range of devices.</span></span> <span data-ttu-id="2725f-109">本文档还介绍了从 ASP.NET 2.0 到3.5 的 ASP.NET 移动控件现在已过时的原因，并讨论了一些新式替代方法。</span><span class="sxs-lookup"><span data-stu-id="2725f-109">This document also explains why the ASP.NET Mobile Controls from ASP.NET 2.0 to 3.5 are now obsolete, and discusses some modern alternatives.</span></span>

## <a name="contents"></a><span data-ttu-id="2725f-110">内容</span><span class="sxs-lookup"><span data-stu-id="2725f-110">Contents</span></span>

- <span data-ttu-id="2725f-111">概述</span><span class="sxs-lookup"><span data-stu-id="2725f-111">Overview</span></span>
- <span data-ttu-id="2725f-112">体系结构选项</span><span class="sxs-lookup"><span data-stu-id="2725f-112">Architectural options</span></span>
- <span data-ttu-id="2725f-113">浏览器和设备检测</span><span class="sxs-lookup"><span data-stu-id="2725f-113">Browser and device detection</span></span>
- <span data-ttu-id="2725f-114">ASP.NET Web 窗体应用程序如何提供特定于移动的页面</span><span class="sxs-lookup"><span data-stu-id="2725f-114">How ASP.NET Web Forms applications can present mobile-specific pages</span></span>
- <span data-ttu-id="2725f-115">ASP.NET MVC 应用程序如何提供特定于移动的页面</span><span class="sxs-lookup"><span data-stu-id="2725f-115">How ASP.NET MVC applications can present mobile-specific pages</span></span>
- <span data-ttu-id="2725f-116">其他资源</span><span class="sxs-lookup"><span data-stu-id="2725f-116">Additional resources</span></span>

<span data-ttu-id="2725f-117">有关演示如何将此白皮书用于 ASP.NET Web 窗体和 MVC 的可下载代码示例，请参阅[采用 ASP.NET & 站点的移动应用](https://docs.microsoft.com/aspnet/mobile/overview)。</span><span class="sxs-lookup"><span data-stu-id="2725f-117">For downloadable code samples demonstrating this white paper's techniques for both ASP.NET Web Forms and MVC, see [Mobile Apps & Sites with ASP.NET](https://docs.microsoft.com/aspnet/mobile/overview).</span></span>

## <a name="overview"></a><span data-ttu-id="2725f-118">概述</span><span class="sxs-lookup"><span data-stu-id="2725f-118">Overview</span></span>

<span data-ttu-id="2725f-119">移动设备–智能手机、功能电话和平板电脑–以一种访问 Web 的方式继续增长。</span><span class="sxs-lookup"><span data-stu-id="2725f-119">Mobile devices – smartphones, feature phones, and tablets – continue to grow in popularity as a means to access the Web.</span></span> <span data-ttu-id="2725f-120">对于许多 web 开发人员和面向 web 的企业而言，这意味着对于使用这些设备的访问者而言，为访问者提供丰富的浏览体验变得越来越重要。</span><span class="sxs-lookup"><span data-stu-id="2725f-120">For many web developers and web-oriented businesses, this means it's increasingly important to provide a great browsing experience for visitors using those devices.</span></span>

### <a name="how-earlier-versions-of-aspnet-supported-mobile-browsers"></a><span data-ttu-id="2725f-121">更早版本的 ASP.NET 支持的移动浏览器</span><span class="sxs-lookup"><span data-stu-id="2725f-121">How earlier versions of ASP.NET supported mobile browsers</span></span>

<span data-ttu-id="2725f-122">ASP.NET 版本2.0 到3.5 包括*ASP.NET 移动控件*：针对移动设备的一组服务器控件和*MobileControls*命名空间*中的移动*设备。</span><span class="sxs-lookup"><span data-stu-id="2725f-122">ASP.NET versions 2.0 to 3.5 included *ASP.NET Mobile Controls*: a set of server controls for mobile devices in the *System.Web.Mobile.dll* assembly and the *System.Web.UI.MobileControls* namespace.</span></span> <span data-ttu-id="2725f-123">该程序集仍包含在 ASP.NET 4 中，但已弃用。</span><span class="sxs-lookup"><span data-stu-id="2725f-123">The assembly is still included in ASP.NET 4, but it is deprecated.</span></span> <span data-ttu-id="2725f-124">建议开发人员迁移到更现代的方法，如本文中所述。</span><span class="sxs-lookup"><span data-stu-id="2725f-124">Developers are advised to migrate to more modern approaches, such as those described in this paper.</span></span>

<span data-ttu-id="2725f-125">将 ASP.NET 移动控件标记为过时的原因是其设计面向2005及更早版本常见的移动电话。</span><span class="sxs-lookup"><span data-stu-id="2725f-125">The reason why ASP.NET Mobile Controls have been marked as obsolete is that their design is oriented around the mobile phones that were common around 2005 and earlier.</span></span> <span data-ttu-id="2725f-126">控件的主要目的是为该时代的 WAP 浏览器呈现 WML 或 cHTML 标记（而不是常规 HTML）。</span><span class="sxs-lookup"><span data-stu-id="2725f-126">The controls are mainly designed to render WML or cHTML markup (instead of regular HTML) for the WAP browsers of that era.</span></span> <span data-ttu-id="2725f-127">但对于大多数项目，WAP、WML 和 cHTML 不再相关，因为现在 HTML 已成为移动和桌面浏览器的广泛标记语言。</span><span class="sxs-lookup"><span data-stu-id="2725f-127">But WAP, WML, and cHTML are no longer relevant for most projects, because HTML has now become the ubiquitous markup language for mobile and desktop browsers alike.</span></span>

### <a name="the-challenges-of-supporting-mobile-devices-today"></a><span data-ttu-id="2725f-128">目前支持移动设备的挑战</span><span class="sxs-lookup"><span data-stu-id="2725f-128">The challenges of supporting mobile devices today</span></span>

<span data-ttu-id="2725f-129">尽管移动浏览器现在已经完全支持 HTML，但当您想要创建精彩的移动浏览体验时，您仍会遇到许多挑战：</span><span class="sxs-lookup"><span data-stu-id="2725f-129">Even though mobile browsers now almost universally support HTML, you will still face many challenges when aiming to create great mobile browsing experiences:</span></span>

- <span data-ttu-id="2725f-130">***屏幕大小***-移动设备外形明显不同，其屏幕通常比桌面监视器小得多。</span><span class="sxs-lookup"><span data-stu-id="2725f-130">***Screen size*** - Mobile devices vary dramatically in form, and their screens are often much smaller than desktop monitors.</span></span> <span data-ttu-id="2725f-131">因此，您可能需要为它们设计完全不同的页面布局。</span><span class="sxs-lookup"><span data-stu-id="2725f-131">So, you may need to design completely different page layouts for them.</span></span>
- <span data-ttu-id="2725f-132">***输入法***–某些设备有键盘，某些设备有 styluses，其他设备使用触控。</span><span class="sxs-lookup"><span data-stu-id="2725f-132">***Input methods*** – Some devices have keypads, some have styluses, others use touch.</span></span> <span data-ttu-id="2725f-133">您可能需要考虑多个导航机制和数据输入方法。</span><span class="sxs-lookup"><span data-stu-id="2725f-133">You may need to consider multiple navigation mechanisms and data input methods.</span></span>
- <span data-ttu-id="2725f-134">***标准相容性***–许多移动浏览器不支持最新的 HTML、CSS 或 JavaScript 标准。</span><span class="sxs-lookup"><span data-stu-id="2725f-134">***Standards compliance*** – Many mobile browsers do not support the latest HTML, CSS, or JavaScript standards.</span></span>
- <span data-ttu-id="2725f-135">***带宽***–移动电话数据网络性能差异很高，某些最终用户在 tariffs 上按兆字节收费。</span><span class="sxs-lookup"><span data-stu-id="2725f-135">***Bandwidth*** – Cellular data network performance varies wildly, and some end users are on tariffs that charge by the megabyte.</span></span>

<span data-ttu-id="2725f-136">没有一种适合全部的解决方案;根据访问应用程序的设备，应用程序的外观和行为将有所不同。</span><span class="sxs-lookup"><span data-stu-id="2725f-136">There's no one-size-fits-all solution; your application will have to look and behave differently according to the device accessing it.</span></span> <span data-ttu-id="2725f-137">对于 web 开发人员来说，这对于桌面 "browser 大战" 来说可能是一个更大的挑战。</span><span class="sxs-lookup"><span data-stu-id="2725f-137">Depending on what level of mobile support you want, this can be a bigger challenge for web developers than the desktop "browser wars" ever was.</span></span>

<span data-ttu-id="2725f-138">首次出现移动浏览器支持的开发人员最初认为仅支持最新和最先进的智能手机（例如 Windows Phone 7、iPhone 或 Android），这可能是因为开发人员通常是装置.</span><span class="sxs-lookup"><span data-stu-id="2725f-138">Developers approaching mobile browser support for the first time often initially think it's only important to support the latest and most sophisticated smartphones (e.g., Windows Phone 7, iPhone, or Android), perhaps because developers often personally own such devices.</span></span> <span data-ttu-id="2725f-139">然而，更便宜的手机仍然非常受欢迎，其所有者确实会使用它们来浏览 web，尤其是在使用手机进行宽带连接的国家/地区。</span><span class="sxs-lookup"><span data-stu-id="2725f-139">However, cheaper phones are still extremely popular, and their owners do use them to browse the web – especially in countries where mobile phones are easier to get than a broadband connection.</span></span> <span data-ttu-id="2725f-140">企业需要通过考虑其可能的客户来决定要支持的设备范围。</span><span class="sxs-lookup"><span data-stu-id="2725f-140">Your business will need to decide what range of devices to support by considering its likely customers.</span></span> <span data-ttu-id="2725f-141">如果要为一项高级的运行状况 spa 构建在线小册子，则可以仅针对高级智能手机进行业务决策，而如果要为电影创建票证预定系统，则可能需要考虑到功能不太强大的访问者部.</span><span class="sxs-lookup"><span data-stu-id="2725f-141">If you're building an online brochure for a luxury health spa, you might make a business decision only to target advanced smartphones, whereas if you're creating a ticket booking system for a cinema, you probably need to account for visitors with less powerful feature phones.</span></span>

## <a name="architectural-options"></a><span data-ttu-id="2725f-142">体系结构选项</span><span class="sxs-lookup"><span data-stu-id="2725f-142">Architectural options</span></span>

<span data-ttu-id="2725f-143">在转到 ASP.NET Web 窗体或 MVC 的特定技术详细信息之前，请注意，一般情况下，web 开发人员有三个主要可能选项用于支持移动浏览器：</span><span class="sxs-lookup"><span data-stu-id="2725f-143">Before we get to the specific technical details of ASP.NET Web Forms or MVC, note that web developers in general have three main possible options for supporting mobile browsers:</span></span>

1. <span data-ttu-id="2725f-144">***不执行任何操作–*** 你只需创建一个面向桌面的标准 web 应用程序，然后依赖移动浏览器将其呈现为可接受。</span><span class="sxs-lookup"><span data-stu-id="2725f-144">***Do nothing –*** You can simply create a standard, desktop-oriented web application, and rely on mobile browsers to render it acceptably.</span></span> 

    - <span data-ttu-id="2725f-145">**优势**：这是实施和维护的最便宜的选项–无需额外工作</span><span class="sxs-lookup"><span data-stu-id="2725f-145">**Advantage**: It's the cheapest option to implement and maintain – no extra work</span></span>
    - <span data-ttu-id="2725f-146">**缺点**：提供最差的最终用户体验：</span><span class="sxs-lookup"><span data-stu-id="2725f-146">**Disadvantage**: Gives the worst end-user experience:</span></span> 

        - <span data-ttu-id="2725f-147">最新的智能手机可能会呈现您的 HTML 和桌面浏览器，但用户仍会被迫水平和垂直滚动以在小屏幕上使用您的内容。</span><span class="sxs-lookup"><span data-stu-id="2725f-147">The latest smartphones may render your HTML just as well as a desktop browser, but users will still be forced to zoom and scroll horizontally and vertically to consume your content on a small screen.</span></span> <span data-ttu-id="2725f-148">这并不是最佳做法。</span><span class="sxs-lookup"><span data-stu-id="2725f-148">This is far from optimal.</span></span>
        - <span data-ttu-id="2725f-149">较旧的设备和功能电话可能无法以令人满意的方式呈现你的标记。</span><span class="sxs-lookup"><span data-stu-id="2725f-149">Older devices and feature phones may fail to render your markup in a satisfactory way.</span></span>
        - <span data-ttu-id="2725f-150">即使是最新的 tablet 设备（其屏幕可以像便携式计算机屏幕一样大），也会应用不同的交互规则。</span><span class="sxs-lookup"><span data-stu-id="2725f-150">Even on the latest tablet devices (whose screens can be as big as laptop screens), different interaction rules apply.</span></span> <span data-ttu-id="2725f-151">基于触摸的输入最适用于更大的按钮和链接，并使链接更进一步，而且没有办法将鼠标光标悬停在弹出菜单上。</span><span class="sxs-lookup"><span data-stu-id="2725f-151">Touch-based input works best with larger buttons and links spread further apart, and there's no way to hover a mouse cursor over a fly-out menu.</span></span>
2. <span data-ttu-id="2725f-152">\***解决客户端问题\*-** 通过使用 CSS 和[渐进式增强功能](http://en.wikipedia.org/wiki/Progressive_enhancement)，你可以创建可适应每个浏览器运行的标记、样式和脚本。</span><span class="sxs-lookup"><span data-stu-id="2725f-152">***Solve the problem on the client* –** With careful use of CSS and [progressive enhancement](http://en.wikipedia.org/wiki/Progressive_enhancement) you can create markup, styles, and scripts that adapt to whatever browser is running them.</span></span> <span data-ttu-id="2725f-153">例如，使用[CSS 3 媒体查询](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/)，您可以创建多列布局，在其屏幕比所选阈值更窄的设备上启用单列布局。</span><span class="sxs-lookup"><span data-stu-id="2725f-153">For example, with [CSS 3 media queries](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/), you could create a multi-column layout that turns into a single column layout on devices whose screens are narrower than a chosen threshold.</span></span> 

    - <span data-ttu-id="2725f-154">**优势**：针对使用中的特定设备优化呈现，甚至根据所拥有的任何屏幕和输入特征，对未知未来的设备进行渲染</span><span class="sxs-lookup"><span data-stu-id="2725f-154">**Advantage**: Optimizes rendering for the specific device in use, even for unknown future devices according to whatever screen and input characteristics they have</span></span>
    - <span data-ttu-id="2725f-155">**优势**：使你能够在所有设备类型之间共享服务器端逻辑–最小程度地重复代码或工作量</span><span class="sxs-lookup"><span data-stu-id="2725f-155">**Advantage**: Easily lets you share server-side logic across all device types – minimal duplication of code or effort</span></span>
    - <span data-ttu-id="2725f-156">**缺点**：移动设备与桌面设备的不同之处在于，你可能希望你的移动页面与桌面页面完全不同，并显示不同的信息。</span><span class="sxs-lookup"><span data-stu-id="2725f-156">**Disadvantage**: Mobile devices are so different from desktop devices that you may really want your mobile pages to be completely different from your desktop pages, showing different information.</span></span> <span data-ttu-id="2725f-157">此类变体可能效率低下，甚至不可能通过 CSS 来实现可靠地实现，尤其是考虑旧设备如何解释 CSS 规则。</span><span class="sxs-lookup"><span data-stu-id="2725f-157">Such variations can be inefficient or impossible to achieve robustly through CSS alone, especially considering how inconsistently older devices interpret CSS rules.</span></span> <span data-ttu-id="2725f-158">这对于 CSS 3 属性尤其如此。</span><span class="sxs-lookup"><span data-stu-id="2725f-158">This is particularly true of CSS 3 attributes.</span></span>
    - <span data-ttu-id="2725f-159">**缺点**：不支持不同设备的不同服务器端逻辑和工作流。</span><span class="sxs-lookup"><span data-stu-id="2725f-159">**Disadvantage**: Provides no support for varying server-side logic and workflows for different devices.</span></span> <span data-ttu-id="2725f-160">例如，你不能通过单独使用 CSS 来实现移动用户的简化购物车结帐工作流。</span><span class="sxs-lookup"><span data-stu-id="2725f-160">You can't, for example, implement a simplified shopping cart checkout workflow for mobile users by means of CSS alone.</span></span>
    - <span data-ttu-id="2725f-161">**缺点**：带宽使用效率低下。</span><span class="sxs-lookup"><span data-stu-id="2725f-161">**Disadvantage**: Inefficient bandwidth use.</span></span> <span data-ttu-id="2725f-162">您的服务器可能必须传输适用于所有可能设备的标记和样式，即使目标设备将仅使用该信息的子集。</span><span class="sxs-lookup"><span data-stu-id="2725f-162">You server may have to transmit the markup and styles that apply to all possible devices, even though the target device will only use a subset of that information.</span></span>
3. <span data-ttu-id="2725f-163">\***解决服务器上的问题\*–** 如果服务器知道哪个设备正在访问它（或至少具有该设备的特征，例如，其屏幕大小和输入方法，以及它是否是移动设备），则可运行不同的逻辑并输出不同的 HTML 标记。</span><span class="sxs-lookup"><span data-stu-id="2725f-163">***Solve the problem on the server* –** If your server knows what device is accessing it – or at least the characteristics of that device, such as its screen size and input method, and whether it's a mobile device – it can run different logic and output different HTML markup.</span></span> 

    - <span data-ttu-id="2725f-164">**优势：** 最大灵活性。</span><span class="sxs-lookup"><span data-stu-id="2725f-164">**Advantage:** Maximum flexibility.</span></span> <span data-ttu-id="2725f-165">对于移动的服务器端逻辑大小并无限制，或者针对所需的特定于设备的布局优化了标记。</span><span class="sxs-lookup"><span data-stu-id="2725f-165">There's no limit to how much you can vary your server-side logic for mobiles or optimize your markup for the desired, device-specific layout.</span></span>
    - <span data-ttu-id="2725f-166">**优势：** 有效的带宽使用。</span><span class="sxs-lookup"><span data-stu-id="2725f-166">**Advantage:** Efficient bandwidth use.</span></span> <span data-ttu-id="2725f-167">只需传输目标设备将要使用的标记和样式信息。</span><span class="sxs-lookup"><span data-stu-id="2725f-167">You only need to transmit the markup and styling information that the target device is going to use.</span></span>
    - <span data-ttu-id="2725f-168">**缺点：** 有时会强制重复工作或编写代码（例如，使您可以创建 Web 窗体页或 MVC 视图的类似但稍有不同的副本）。</span><span class="sxs-lookup"><span data-stu-id="2725f-168">**Disadvantage:** Sometimes forces repetition of effort or code (e.g., making you create similar but slightly different copies of your Web Forms pages or MVC views).</span></span> <span data-ttu-id="2725f-169">在可能的情况下，你会将公共逻辑划分为基础层或服务，但仍需要复制某些 UI 代码或标记部分，然后进行并行维护。</span><span class="sxs-lookup"><span data-stu-id="2725f-169">Where possible you will factor out common logic into an underlying layer or service, but still, some parts of your UI code or markup may have to be duplicated and then maintained in parallel.</span></span>
    - <span data-ttu-id="2725f-170">**缺点：** 设备检测并不重要。</span><span class="sxs-lookup"><span data-stu-id="2725f-170">**Disadvantage:** Device detection is not trivial.</span></span> <span data-ttu-id="2725f-171">它需要一个列表或已知设备类型的数据库及其特征（可能并非始终都是最新的），并且不保证能够精确地匹配每个传入的请求。</span><span class="sxs-lookup"><span data-stu-id="2725f-171">It requires a list or database of known device types and their characteristics (which may not always be perfectly up-to-date) and isn't guaranteed to accurately match every incoming request.</span></span> <span data-ttu-id="2725f-172">本文档稍后将介绍某些选项及其缺陷。</span><span class="sxs-lookup"><span data-stu-id="2725f-172">This document describes some options and their pitfalls later.</span></span>

<span data-ttu-id="2725f-173">为了获得最佳结果，大多数开发人员都发现需要组合选项（2）和（3）。</span><span class="sxs-lookup"><span data-stu-id="2725f-173">To get the best results, most developers find they need to combine options (2) and (3).</span></span> <span data-ttu-id="2725f-174">使用 CSS 或 JavaScript 的客户端最适合使用次要样式差别，而在服务器端代码中最有效地实现了数据、工作流或标记的主要差异。</span><span class="sxs-lookup"><span data-stu-id="2725f-174">Minor stylistic differences are best accommodated on the client using CSS or even JavaScript, whereas major differences in data, workflow, or markup are most effectively implemented in server-side code.</span></span>

### <a name="this-paper-focuses-on-server-side-techniques"></a><span data-ttu-id="2725f-175">本白皮书重点介绍服务器端技术</span><span class="sxs-lookup"><span data-stu-id="2725f-175">This paper focuses on server-side techniques</span></span>

<span data-ttu-id="2725f-176">由于 ASP.NET Web 窗体和 MVC 主要是服务器端技术，因此此白皮书将重点介绍服务器端技术，使你可以为移动浏览器生成不同的标记和逻辑。</span><span class="sxs-lookup"><span data-stu-id="2725f-176">Since ASP.NET Web Forms and MVC are both primarily server-side technologies, this white paper will focus on server-side techniques that let you produce different markup and logic for mobile browsers.</span></span> <span data-ttu-id="2725f-177">当然，您还可以将其与任何客户端技术（例如，CSS 3 媒体查询、渐进式增强 JavaScript）结合在一起，但这比 ASP.NET 开发的 web 设计更重要。</span><span class="sxs-lookup"><span data-stu-id="2725f-177">Of course, you can also combine this with any client-side technique (e.g., CSS 3 media queries, progressive-enhancement JavaScript), but that's more a matter of web design than ASP.NET development.</span></span>

## <a name="browser-and-device-detection"></a><span data-ttu-id="2725f-178">浏览器和设备检测</span><span class="sxs-lookup"><span data-stu-id="2725f-178">Browser and device detection</span></span>

<span data-ttu-id="2725f-179">用于支持移动设备的所有服务器端技术的主要先决条件是了解访问者所使用的设备。</span><span class="sxs-lookup"><span data-stu-id="2725f-179">The key prerequisite for all server-side techniques for supporting mobile devices is to know what device your visitor is using.</span></span> <span data-ttu-id="2725f-180">事实上，甚至比知道设备的制造商和型号，也知道设备的*特性*。</span><span class="sxs-lookup"><span data-stu-id="2725f-180">In fact, even better than knowing the manufacturer and model number of that device is knowing the *characteristics* of the device.</span></span> <span data-ttu-id="2725f-181">特征可能包括：</span><span class="sxs-lookup"><span data-stu-id="2725f-181">Characteristics may include:</span></span>

- <span data-ttu-id="2725f-182">它是移动设备吗？</span><span class="sxs-lookup"><span data-stu-id="2725f-182">Is it a mobile device?</span></span>
- <span data-ttu-id="2725f-183">输入法（鼠标/键盘、触控、键盘、操纵杆、...）</span><span class="sxs-lookup"><span data-stu-id="2725f-183">Input method (mouse/keyboard, touch, keypad, joystick, …)</span></span>
- <span data-ttu-id="2725f-184">屏幕大小（物理和以像素为单位）</span><span class="sxs-lookup"><span data-stu-id="2725f-184">Screen size (physically and in pixels)</span></span>
- <span data-ttu-id="2725f-185">支持的媒体和数据格式</span><span class="sxs-lookup"><span data-stu-id="2725f-185">Supported media and data formats</span></span>
- <span data-ttu-id="2725f-186">等。</span><span class="sxs-lookup"><span data-stu-id="2725f-186">Etc.</span></span>

<span data-ttu-id="2725f-187">最好根据特征来做出决策，而不是型号，因为这样就可以更好地处理将来的设备了。</span><span class="sxs-lookup"><span data-stu-id="2725f-187">It's better to make decisions based on characteristics than model number, because then you'll be better equipped to handle future devices.</span></span>

### <a name="using-aspnets-built-in-browser-detection-support"></a><span data-ttu-id="2725f-188">使用 ASP。网络的内置浏览器检测支持</span><span class="sxs-lookup"><span data-stu-id="2725f-188">Using ASP.NET's built-in browser detection support</span></span>

<span data-ttu-id="2725f-189">ASP.NET Web 窗体和 MVC 开发人员可以通过检查*请求 .browser*对象的属性来立即发现访问浏览器的重要特性。</span><span class="sxs-lookup"><span data-stu-id="2725f-189">ASP.NET Web Forms and MVC developers can immediately discover important characteristics of a visiting browser by inspecting properties of the *Request.Browser* object.</span></span> <span data-ttu-id="2725f-190">例如，请参阅</span><span class="sxs-lookup"><span data-stu-id="2725f-190">For example, see</span></span>

- <span data-ttu-id="2725f-191">Request.Browser.IsMobileDevice</span><span class="sxs-lookup"><span data-stu-id="2725f-191">Request.Browser.IsMobileDevice</span></span>
- <span data-ttu-id="2725f-192">MobileDeviceManufacturer，请求. MobileDeviceModel</span><span class="sxs-lookup"><span data-stu-id="2725f-192">Request.Browser.MobileDeviceManufacturer, Request.Browser.MobileDeviceModel</span></span>
- <span data-ttu-id="2725f-193">Request.Browser.ScreenPixelsWidth</span><span class="sxs-lookup"><span data-stu-id="2725f-193">Request.Browser.ScreenPixelsWidth</span></span>
- <span data-ttu-id="2725f-194">Request.Browser.SupportsXmlHttp</span><span class="sxs-lookup"><span data-stu-id="2725f-194">Request.Browser.SupportsXmlHttp</span></span>
- <span data-ttu-id="2725f-195">...和其他许多</span><span class="sxs-lookup"><span data-stu-id="2725f-195">…and many others</span></span>

<span data-ttu-id="2725f-196">在后台，ASP.NET 平台会将传入*用户代理*（UA） HTTP 标头与一组浏览器定义 XML 文件中的正则表达式匹配。</span><span class="sxs-lookup"><span data-stu-id="2725f-196">Behind the scenes, the ASP.NET platform matches the incoming *User-Agent* (UA) HTTP header against regular expressions in a set of Browser Definition XML files.</span></span> <span data-ttu-id="2725f-197">默认情况下，平台包括许多常见移动设备的定义，你可以为要识别的其他用户添加自定义浏览器定义文件。</span><span class="sxs-lookup"><span data-stu-id="2725f-197">By default the platform includes definitions for many common mobile devices, and you can add custom Browser Definition files for others you wish to recognize.</span></span> <span data-ttu-id="2725f-198">有关更多详细信息，请参阅 MSDN 页面[ASP.NET Web 服务器控件和浏览器功能](https://msdn.microsoft.com/library/x3k2ssx2.aspx)。</span><span class="sxs-lookup"><span data-stu-id="2725f-198">For more details, see the MSDN page [ASP.NET Web Server Controls and Browser Capabilities](https://msdn.microsoft.com/library/x3k2ssx2.aspx).</span></span>

### <a name="using-the-wurfl-device-database-via-51degreesmobi-foundation"></a><span data-ttu-id="2725f-199">通过 51Degrees.mobi Foundation 使用 WURFL 设备数据库</span><span class="sxs-lookup"><span data-stu-id="2725f-199">Using the WURFL device database via 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="2725f-200">.ASP。对于许多应用程序而言，网络的内置浏览器检测支持就足以满足以下两个主要情况：</span><span class="sxs-lookup"><span data-stu-id="2725f-200">While ASP.NET's built-in browser detection support will be sufficient for many applications, there are two main cases when it might not be enough:</span></span>

- <span data-ttu-id="2725f-201">***你需要识别最新的设备***（不为其手动创建浏览器定义文件）。</span><span class="sxs-lookup"><span data-stu-id="2725f-201">***You want to recognize the latest devices***(without manually creating Browser Definition files for them).</span></span> <span data-ttu-id="2725f-202">请注意，.NET 4 的浏览器定义文件不是最新的，不能识别 Windows Phone 7、Android 手机、Opera 移动浏览器或 Apple Ipad。</span><span class="sxs-lookup"><span data-stu-id="2725f-202">Note that .NET 4's Browser Definition files are not recent enough to recognize Windows Phone 7, Android phones, Opera Mobile browsers, or Apple iPads.</span></span>
- <span data-ttu-id="2725f-203">***你需要有关设备功能的更多详细信息***。</span><span class="sxs-lookup"><span data-stu-id="2725f-203">***You need more detailed information about device capabilities***.</span></span> <span data-ttu-id="2725f-204">可能需要了解设备的输入法（例如，touch vs 小键盘）或浏览器支持的音频格式。</span><span class="sxs-lookup"><span data-stu-id="2725f-204">You may need to know about a device's input method (e.g., touch vs keypad), or what audio formats the browser supports.</span></span> <span data-ttu-id="2725f-205">此信息不适用于标准浏览器定义文件。</span><span class="sxs-lookup"><span data-stu-id="2725f-205">This information isn't available in the standard Browser Definition files.</span></span>

<span data-ttu-id="2725f-206">[*无线通用资源文件*（WURFL）项目](http://wurfl.sourceforge.net/)维护有关目前正在使用的移动设备的更多最新信息和详细信息。</span><span class="sxs-lookup"><span data-stu-id="2725f-206">The [*Wireless Universal Resource File* (WURFL) project](http://wurfl.sourceforge.net/) maintains much more up-to-date and detailed information about mobile devices in use today.</span></span>

<span data-ttu-id="2725f-207">.NET 开发人员的优秀新闻是 ASP。网络的浏览器检测功能是可扩展的，因此可以对其进行增强，以解决这些问题。</span><span class="sxs-lookup"><span data-stu-id="2725f-207">The great news for .NET developers is that ASP.NET's browser detection feature is extensible, so it's possible to enhance it to overcome these problems.</span></span> <span data-ttu-id="2725f-208">例如，你可以将开源[*51Degrees.mobi Foundation*](https://github.com/51Degrees/dotNET-Device-Detection)库添加到你的项目。</span><span class="sxs-lookup"><span data-stu-id="2725f-208">For example, you can add the open source [*51Degrees.mobi Foundation*](https://github.com/51Degrees/dotNET-Device-Detection) library to your project.</span></span> <span data-ttu-id="2725f-209">它是一个 ASP.NET IHttpModule 或 Browser 功能提供程序（可在 Web 窗体和 MVC 应用程序上使用），可直接读取 WURFL 数据并将其挂接到 ASP。网络的内置浏览器检测机制。</span><span class="sxs-lookup"><span data-stu-id="2725f-209">It's an ASP.NET IHttpModule or Browser Capabilities Provider (usable on both Web Forms and MVC applications), that directly reads WURFL data and hooks it into ASP.NET's built-in browser detection mechanism.</span></span> <span data-ttu-id="2725f-210">安装该模块后， *Browser*会突然包含更准确和更详细的信息：它将正确识别之前提到的许多设备并列出其功能（包括其他功能，例如输入方法）。</span><span class="sxs-lookup"><span data-stu-id="2725f-210">Once you've installed the module, *Request.Browser* will suddenly contain a lot more accurate and detailed information: it will correctly recognize many of the devices previously mentioned and list their capabilities (including additional capabilities such as input method).</span></span> <span data-ttu-id="2725f-211">有关更多详细信息，请参阅项目的文档。</span><span class="sxs-lookup"><span data-stu-id="2725f-211">See the project's documentation for more details.</span></span>

## <a name="how-web-forms-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="2725f-212">Web 窗体应用程序如何提供特定于移动的页面</span><span class="sxs-lookup"><span data-stu-id="2725f-212">How Web Forms applications can present mobile-specific pages</span></span>

<span data-ttu-id="2725f-213">默认情况下，新的 Web 窗体应用程序在常见的移动设备上的显示方式如下：</span><span class="sxs-lookup"><span data-stu-id="2725f-213">By default, here's how a brand new Web Forms application displays on common mobile devices:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image1.png)

<span data-ttu-id="2725f-214">很显然，这两种布局看起来都不太方便移动–此页面适用于面向横向的大型监视器，不适用于面向纵向的小屏幕。</span><span class="sxs-lookup"><span data-stu-id="2725f-214">Clearly, neither layout looks very mobile-friendly – this page was designed for a large, landscape-oriented monitor, not for a small portrait-oriented screen.</span></span> <span data-ttu-id="2725f-215">那么，您该怎么办呢？</span><span class="sxs-lookup"><span data-stu-id="2725f-215">So what can you do about it?</span></span>

<span data-ttu-id="2725f-216">如本文前面所述，有多种方法可为移动设备定制页面。</span><span class="sxs-lookup"><span data-stu-id="2725f-216">As discussed earlier in this paper, there are many ways to tailor your pages for mobile devices.</span></span> <span data-ttu-id="2725f-217">某些技术是基于服务器的，其他技术在客户端上运行。</span><span class="sxs-lookup"><span data-stu-id="2725f-217">Some techniques are server-based, others run on the client.</span></span>

### <a name="creating-a-mobile-specific-master-page"></a><span data-ttu-id="2725f-218">创建特定于移动设备的母版页</span><span class="sxs-lookup"><span data-stu-id="2725f-218">Creating a mobile-specific master page</span></span>

<span data-ttu-id="2725f-219">根据你的要求，你可以为所有访问者使用相同的 Web 窗体，但可以有两个单独的母版页：一个用于桌面访问者，另一个用于移动访问者。</span><span class="sxs-lookup"><span data-stu-id="2725f-219">Depending on your requirements, you may be able to use the same Web Forms for all visitors, but have two separate master pages: one for desktop visitors, another for mobile visitors.</span></span> <span data-ttu-id="2725f-220">这使你可以灵活地更改 CSS 样式表或顶级 HTML 标记，使其适合移动设备，而不会强制复制任何页面逻辑。</span><span class="sxs-lookup"><span data-stu-id="2725f-220">This gives you the flexibility of changing the CSS stylesheet or your top-level HTML markup to suit mobile devices, without forcing you to duplicate any page logic.</span></span>

<span data-ttu-id="2725f-221">这很简单。</span><span class="sxs-lookup"><span data-stu-id="2725f-221">This is easy to do.</span></span> <span data-ttu-id="2725f-222">例如，可以将以下 PreInit 处理程序添加到 Web 窗体：</span><span class="sxs-lookup"><span data-stu-id="2725f-222">For example, you can add a PreInit handler such as the following to a Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample1.cs)]

<span data-ttu-id="2725f-223">现在，在应用程序的顶层文件夹中创建名为 "Mobile" 的母版页，并在检测到移动设备时使用该母版页。</span><span class="sxs-lookup"><span data-stu-id="2725f-223">Now, create a master page called Mobile.Master in the top-level folder of your application, and it will be used when a mobile device is detected.</span></span> <span data-ttu-id="2725f-224">如果需要，你的移动母版页可以引用特定于移动的 CSS 样式表。</span><span class="sxs-lookup"><span data-stu-id="2725f-224">Your mobile master page can reference a mobile-specific CSS stylesheet if necessary.</span></span> <span data-ttu-id="2725f-225">桌面访问者仍将看到您的默认母版页，而不是移动设备。</span><span class="sxs-lookup"><span data-stu-id="2725f-225">Desktop visitors will still see your default master page, not the mobile one.</span></span>

### <a name="creating-independent-mobile-specific-web-forms"></a><span data-ttu-id="2725f-226">创建独立的移动特定 Web 窗体</span><span class="sxs-lookup"><span data-stu-id="2725f-226">Creating independent mobile-specific Web Forms</span></span>

<span data-ttu-id="2725f-227">为了最大限度地提高灵活性，您可以进一步了解不同设备类型的单独母版页。</span><span class="sxs-lookup"><span data-stu-id="2725f-227">For maximum flexibility, you can go much further than just having separate master pages for different device types.</span></span> <span data-ttu-id="2725f-228">可以实现两种*完全不同的 Web 窗体页*集–一组用于桌面浏览器，另一组用于移动。</span><span class="sxs-lookup"><span data-stu-id="2725f-228">You can implement two *totally separate sets of Web Forms pages* – one set for desktop browsers, another set for mobiles.</span></span> <span data-ttu-id="2725f-229">如果要向移动用户提供非常不同的信息或工作流，这种方法的效果最佳。</span><span class="sxs-lookup"><span data-stu-id="2725f-229">This works best if you want to present very different information or workflows to mobile visitors.</span></span> <span data-ttu-id="2725f-230">本部分的其余部分详细介绍了这种方法。</span><span class="sxs-lookup"><span data-stu-id="2725f-230">The rest of this section describes this approach in detail.</span></span>

<span data-ttu-id="2725f-231">假设已有为桌面浏览器设计的 Web 窗体应用程序，最简单的方法是在项目中创建一个名为 "Mobile" 的子文件夹，并在该文件夹中生成移动页。</span><span class="sxs-lookup"><span data-stu-id="2725f-231">Assuming you already have a Web Forms application designed for desktop browsers, the easiest way to proceed is to create a subfolder called "Mobile" within your project, and build your mobile pages there.</span></span> <span data-ttu-id="2725f-232">您可以使用与任何其他 Web 窗体应用程序相同的方法来构造整个子站点及其自己的母版页、样式表和页面。</span><span class="sxs-lookup"><span data-stu-id="2725f-232">You can construct an entire sub-site, with its own master pages, style sheets, and pages, using all the same techniques that you'd use for any other Web Forms application.</span></span> <span data-ttu-id="2725f-233">不一定需要为桌面站点中的*每个*页面生成等效的移动设备;你可以选择哪些功能子集对于移动访问者是有意义的。</span><span class="sxs-lookup"><span data-stu-id="2725f-233">You don't necessarily need to produce a mobile equivalent for *every* page in your desktop site; you can choose what subset of functionality makes sense for mobile visitors.</span></span>

<span data-ttu-id="2725f-234">如果需要，您的移动页面可以与您的常规页面共享常见静态资源（例如图像、JavaScript 或 CSS 文件）。</span><span class="sxs-lookup"><span data-stu-id="2725f-234">Your mobile pages can share common static resources (such as images, JavaScript, or CSS files) with your regular pages if you wish.</span></span> <span data-ttu-id="2725f-235">由于你的 "Mobile" 文件夹在 IIS 中承载时*不*会标记为单独的应用程序（它只是 Web 窗体页的简单子文件夹），因此它还将与桌面页面共享所有相同的配置、会话数据和其他基础结构。</span><span class="sxs-lookup"><span data-stu-id="2725f-235">Since your "Mobile" folder will *not* be marked as a separate application when hosted in IIS (it's just a simple subfolder of Web Forms pages), it will also share all the same configuration, Session data, and other infrastructure as your desktop pages.</span></span>

> [!NOTE]
> <span data-ttu-id="2725f-236">由于这种方法通常涉及到一些代码重复（移动页面可能与桌面页面共享某些相似之处），因此，将任何常见业务逻辑或数据访问代码分解为共享的基础层或服务非常重要。</span><span class="sxs-lookup"><span data-stu-id="2725f-236">Since this approach usually involves some duplication of code (mobile pages are likely to share some similarities with desktop pages), it's important to factor out any common business logic or data access code into a shared underlying layer or service.</span></span> <span data-ttu-id="2725f-237">否则，会将创建和维护应用程序的工作量加倍。</span><span class="sxs-lookup"><span data-stu-id="2725f-237">Otherwise, you'll double the effort of creating and maintaining your application.</span></span>

#### <a name="redirecting-mobile-visitors-to-your-mobile-pages"></a><span data-ttu-id="2725f-238">将移动访问者重定向到你的移动页面</span><span class="sxs-lookup"><span data-stu-id="2725f-238">Redirecting mobile visitors to your mobile pages</span></span>

<span data-ttu-id="2725f-239">通常，仅在其浏览会话中（而不是在其会话*中的每*个请求中）将移动访问者重定向到移动页，这通常很方便，因为：</span><span class="sxs-lookup"><span data-stu-id="2725f-239">It's often convenient to redirect mobile visitors to the mobile pages only on the *first* request in their browsing session (and not on every request in their session), because:</span></span>

- <span data-ttu-id="2725f-240">然后，你可以轻松地允许移动访问者访问你的桌面页面（如果需要），只需在母版页上放置一个指向 "桌面版本" 的链接即可。</span><span class="sxs-lookup"><span data-stu-id="2725f-240">You can then easily allow mobile visitors to access your desktop pages if they wish – just put a link on your master page that goes to "Desktop version".</span></span> <span data-ttu-id="2725f-241">访问者将不会重定向回移动页，因为它不再是其会话中的第一个请求。</span><span class="sxs-lookup"><span data-stu-id="2725f-241">The visitor won't be redirected back to a mobile page, because it's no longer the first request in their session.</span></span>
- <span data-ttu-id="2725f-242">它避免了干扰在站点的桌面和移动部件之间共享的任何动态资源的请求的风险（例如，如果你有一个常见的 Web 窗体，你的网站的桌面和移动部分都显示在 IFRAME 或特定的 Ajax 处理程序中）</span><span class="sxs-lookup"><span data-stu-id="2725f-242">It avoids the risk of interfering with requests for any dynamic resources shared between desktop and mobile parts of your site (e.g., if you have a common Web Form that both desktop and mobile parts of your site display in an IFRAME, or certain Ajax handlers)</span></span>

<span data-ttu-id="2725f-243">为此，可以 **\_Start**方法将重定向逻辑放入会话中。</span><span class="sxs-lookup"><span data-stu-id="2725f-243">To do this, you can place your redirection logic in a **Session\_Start** method.</span></span> <span data-ttu-id="2725f-244">例如，将以下方法添加到 Global.asax.cs 文件：</span><span class="sxs-lookup"><span data-stu-id="2725f-244">For example, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample2.cs)]

#### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="2725f-245">配置 Forms 身份验证以遵守你的移动页面</span><span class="sxs-lookup"><span data-stu-id="2725f-245">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="2725f-246">请注意，窗体身份验证在身份验证过程中和之后就可以在何处重定向访问者做出一些假设：</span><span class="sxs-lookup"><span data-stu-id="2725f-246">Note that Forms Authentication makes certain assumptions about where it can redirect visitors during and after the authentication process:</span></span>

- <span data-ttu-id="2725f-247">当用户需要进行身份验证时，表单身份验证会将他们重定向到桌面登录页，无论他们是桌面还是移动用户（因为它仅具有*一个*登录 URL 的概念）。</span><span class="sxs-lookup"><span data-stu-id="2725f-247">When a user needs to be authenticated, Forms Authentication will redirect them to your desktop login page, regardless of whether they're a desktop or mobile user (because it only has a concept of *one* login URL).</span></span> <span data-ttu-id="2725f-248">假设你想要以不同的方式为移动登录页样式，则需要增强你的桌面登录页，以便将移动用户重定向到单独的移动登录页。</span><span class="sxs-lookup"><span data-stu-id="2725f-248">Assuming you want to style your mobile login page differently, you need to enhance your desktop login page so that it redirects mobile users to a separate mobile login page.</span></span> <span data-ttu-id="2725f-249">例如，将以下代码添加到你的**桌面**登录页代码隐藏中：</span><span class="sxs-lookup"><span data-stu-id="2725f-249">For example, add the following code to your **desktop** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample3.cs)]
- <span data-ttu-id="2725f-250">用户成功登录后，窗体身份验证默认情况下会将其重定向到桌面主页（因为它只有*一个*默认页面的概念）。</span><span class="sxs-lookup"><span data-stu-id="2725f-250">After a user successfully logs in, Forms Authentication will by default redirect them to your desktop home page (because it only has a concept of *one* default page).</span></span> <span data-ttu-id="2725f-251">需要增强移动登录页面，使其在成功登录后重定向到移动主页。</span><span class="sxs-lookup"><span data-stu-id="2725f-251">You need to enhance your mobile login page so that it redirects to the mobile home page after a successful log-in.</span></span> <span data-ttu-id="2725f-252">例如，将以下代码添加到**移动**登录页的代码隐藏中：</span><span class="sxs-lookup"><span data-stu-id="2725f-252">For example, add the following code to your **mobile** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample4.cs)]
  
  <span data-ttu-id="2725f-253">此代码假定页面具有名为 LoginUser 的登录服务器控件，如默认项目模板中所示。</span><span class="sxs-lookup"><span data-stu-id="2725f-253">This code assumes your page has a Login server control called LoginUser, as in the default project template.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="2725f-254">使用输出缓存</span><span class="sxs-lookup"><span data-stu-id="2725f-254">Working with Output Caching</span></span>

<span data-ttu-id="2725f-255">如果使用的是输出缓存，请注意，默认情况下，桌面用户可以访问某个 URL （导致其输出被缓存），后跟移动用户，随后将收到缓存的桌面输出。</span><span class="sxs-lookup"><span data-stu-id="2725f-255">If you're using output caching, beware that by default it's possible for a desktop user to visit a certain URL (causing its output to be cached), followed by a mobile user who then receives the cached desktop output.</span></span> <span data-ttu-id="2725f-256">无论是按设备类型改变母版页还是按设备实现完全不同的 Web 窗体，此警告都适用。</span><span class="sxs-lookup"><span data-stu-id="2725f-256">This warning applies whether you're just varying your master page by device type, or implementing totally separate Web Forms per device type.</span></span>

<span data-ttu-id="2725f-257">若要避免此问题，可以指示 ASP.NET 根据访问者是否使用移动设备来改变缓存条目。</span><span class="sxs-lookup"><span data-stu-id="2725f-257">To avoid the problem, you can instruct ASP.NET to vary the cache entry according to whether the visitor is using a mobile device.</span></span> <span data-ttu-id="2725f-258">将 VaryByCustom 参数添加到页面的 OutputCache 声明中，如下所示：</span><span class="sxs-lookup"><span data-stu-id="2725f-258">Add a VaryByCustom parameter to your page's OutputCache declaration as follows:</span></span>

[!code-aspx[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample5.aspx)]

<span data-ttu-id="2725f-259">接下来，通过将以下方法重写添加到 Global.asax.cs 文件，将*isMobileDevice*定义为自定义缓存参数：</span><span class="sxs-lookup"><span data-stu-id="2725f-259">Next, define *isMobileDevice* as a custom cache parameter by adding the following method override to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample6.cs)]

<span data-ttu-id="2725f-260">这将确保页面的移动访问者不接收先前由桌面访问者放入缓存的输出。</span><span class="sxs-lookup"><span data-stu-id="2725f-260">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="2725f-261">工作示例</span><span class="sxs-lookup"><span data-stu-id="2725f-261">A working example</span></span>

<span data-ttu-id="2725f-262">若要查看这些方法的运行情况，请下载[此白皮书的代码示例](https://docs.microsoft.com/aspnet/mobile/overview)。</span><span class="sxs-lookup"><span data-stu-id="2725f-262">To see these techniques in action, download [this white paper's code samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="2725f-263">Web 窗体示例应用程序将移动用户自动重定向到名为 Mobile 的子文件夹中的一组特定于移动的页面。</span><span class="sxs-lookup"><span data-stu-id="2725f-263">The Web Forms sample application automatically redirects mobile users to a set of mobile-specific pages in a subfolder called Mobile.</span></span> <span data-ttu-id="2725f-264">这些页面的标记和样式更适合移动浏览器，如以下屏幕截图所示：</span><span class="sxs-lookup"><span data-stu-id="2725f-264">The markup and styling of those pages is better optimized for mobile browsers, as you can see from the following screenshots:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image2.png)

<span data-ttu-id="2725f-265">有关优化移动浏览器的标记和 CSS 的更多提示，请参阅本文档后面的 "移动浏览器的样式移动页样式" 部分。</span><span class="sxs-lookup"><span data-stu-id="2725f-265">For more tips about optimizing your markup and CSS for mobile browsers, see the section "Styling mobile pages for mobile browsers" later in this document.</span></span>

## <a name="how-aspnet-mvc-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="2725f-266">ASP.NET MVC 应用程序如何提供特定于移动的页面</span><span class="sxs-lookup"><span data-stu-id="2725f-266">How ASP.NET MVC applications can present mobile-specific pages</span></span>

<span data-ttu-id="2725f-267">由于模型-视图-控制器模式将应用程序逻辑（在控制器中）与表示逻辑（在视图中）分离开来，因此，您可以从以下任何方法中进行选择，以便在服务器端代码中处理移动支持：</span><span class="sxs-lookup"><span data-stu-id="2725f-267">Since the Model-View-Controller pattern decouples application logic (in controllers) from presentation logic (in views), you can choose from any of the following approaches to handling mobile support in server-side code:</span></span>

1. <span data-ttu-id="2725f-268">\***为桌面和移动浏览器使用相同的控制器和视图，但根据设备类型，使用不同的 Razor 布局呈现视图。**</span><span class="sxs-lookup"><span data-stu-id="2725f-268">\***Use the same controllers and views for both desktop and mobile browsers, but render the views with different Razor layouts depending on the device type\*.**</span></span> <span data-ttu-id="2725f-269">如果要在所有设备上显示相同的数据，但只是想要提供不同的 CSS 样式表或更改移动的一些顶级 HTML 元素，此选项效果最佳。</span><span class="sxs-lookup"><span data-stu-id="2725f-269">This option works best if you're displaying identical data on all devices, but simply want to supply different CSS stylesheets or change a few top-level HTML elements for mobiles.</span></span>
2. <span data-ttu-id="2725f-270">***为桌面和移动浏览器使用相同的控制器，但根据设备类型呈现不同的视图***。</span><span class="sxs-lookup"><span data-stu-id="2725f-270">***Use the same controllers for both desktop and mobile browsers, but render different views depending on the device type***.</span></span> <span data-ttu-id="2725f-271">如果要显示大致相同的数据并为最终用户提供相同的工作流，则此选项最有效，但要呈现与所使用的设备不同的 HTML 标记。</span><span class="sxs-lookup"><span data-stu-id="2725f-271">This option works best if you're displaying roughly the same data and providing the same workflows for end users, but want to render very different HTML markup to suit the device being used.</span></span>
3. <span data-ttu-id="2725f-272">\***为桌面和移动浏览器创建不同的区域，同时为每个 \* 实现独立的控制器和视图。**</span><span class="sxs-lookup"><span data-stu-id="2725f-272">\***Create separate areas for desktop and mobile browsers, implementing independent controllers and views for each\*.**</span></span> <span data-ttu-id="2725f-273">如果要显示的屏幕非常不同，其中包含不同的信息，并通过为其设备类型优化的不同工作流，则此选项的效果最佳。</span><span class="sxs-lookup"><span data-stu-id="2725f-273">This option works best if you're displaying very different screens, containing different information and leading the user through different workflows optimized for their device type.</span></span> <span data-ttu-id="2725f-274">这可能意味着某些代码重复，但你可以通过将常见逻辑分解为基础层或服务来最大程度地减少这种情况。</span><span class="sxs-lookup"><span data-stu-id="2725f-274">It may mean some repetition of code, but you can minimize that by factoring out common logic into an underlying layer or service.</span></span>

<span data-ttu-id="2725f-275">如果要采用**第一个**选项，并且仅改变每个设备类型的 Razor 布局，则非常简单。</span><span class="sxs-lookup"><span data-stu-id="2725f-275">If you want to take the **first** option and vary only the Razor layout per device type, it's very easy.</span></span> <span data-ttu-id="2725f-276">只需修改 \_Viewstart.cshtml 文件，如下所示：</span><span class="sxs-lookup"><span data-stu-id="2725f-276">Just modify your \_ViewStart.cshtml file as follows:</span></span>

[!code-cshtml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample7.cshtml)]

<span data-ttu-id="2725f-277">现在，你可以使用为移动设备优化的页面结构和 CSS 规则，创建名为 \_LayoutMobile 的特定于移动设备的布局。</span><span class="sxs-lookup"><span data-stu-id="2725f-277">Now you can create a mobile-specific layout called \_LayoutMobile.cshtml with a page structure and CSS rules optimized for mobile devices.</span></span>

<span data-ttu-id="2725f-278">如果要根据访问者的设备类型使用**第二个**选项呈现完全不同的视图，请参阅[Scott Hanselman 的博客文章](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx)。</span><span class="sxs-lookup"><span data-stu-id="2725f-278">If you want to take the **second** option render totally different views according to the visitor's device type, see [Scott Hanselman's blog post](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx).</span></span>

<span data-ttu-id="2725f-279">本文的其余部分重点介绍**第三个**选项–为移动设备创建单独的控制器*和*视图–因此，你可以精确控制为移动用户提供的功能的子集。</span><span class="sxs-lookup"><span data-stu-id="2725f-279">The rest of this paper focuses on the **third** option – creating separate controllers *and* views for mobile devices – so you can control exactly what subset of functionality is offered for mobile visitors.</span></span>

### <a name="setting-up-a-mobile-area-within-your-aspnet-mvc-application"></a><span data-ttu-id="2725f-280">在 ASP.NET MVC 应用程序中设置移动区域</span><span class="sxs-lookup"><span data-stu-id="2725f-280">Setting up a Mobile area within your ASP.NET MVC application</span></span>

<span data-ttu-id="2725f-281">您可以按如下方式将名为 "Mobile" 的区域添加到现有的 ASP.NET MVC 应用程序：右键单击 "解决方案资源管理器中的项目名称，然后选择" 添加à区域 "。</span><span class="sxs-lookup"><span data-stu-id="2725f-281">You can add an area called "Mobile" to an existing ASP.NET MVC application in the normal way: right-click on your project name in Solution Explorer, then choose Add à Area.</span></span> <span data-ttu-id="2725f-282">然后，你可以像对 ASP.NET MVC 应用程序中的任何其他区域一样添加控制器和视图。</span><span class="sxs-lookup"><span data-stu-id="2725f-282">You can then add controllers and views as you would for any other area within an ASP.NET MVC application.</span></span> <span data-ttu-id="2725f-283">例如，将名为 HomeController 的新控制器添加到你的移动区域，作为移动访问者的主页。</span><span class="sxs-lookup"><span data-stu-id="2725f-283">For example, add to your Mobile area a new controller called HomeController to act as a homepage for mobile visitors.</span></span>

### <a name="ensuring-the-url-mobile-reaches-the-mobile-homepage"></a><span data-ttu-id="2725f-284">确保 URL/移动到达移动主页</span><span class="sxs-lookup"><span data-stu-id="2725f-284">Ensuring the URL /Mobile reaches the mobile homepage</span></span>

<span data-ttu-id="2725f-285">如果希望 URL/移动在移动区域内的 HomeController 上达到索引操作，则需要对路由配置进行两处小的更改。</span><span class="sxs-lookup"><span data-stu-id="2725f-285">If you want the URL /Mobile to reach the Index action on HomeController inside your Mobile area, you will need to make two small changes to your routing configuration.</span></span> <span data-ttu-id="2725f-286">首先，更新 MobileAreaRegistration 类，使 HomeController 成为移动区域中的默认控制器，如以下代码所示：</span><span class="sxs-lookup"><span data-stu-id="2725f-286">First, update your MobileAreaRegistration class so that HomeController is the default controller in your Mobile area, as shown in the following code:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample8.cs)]

<span data-ttu-id="2725f-287">这意味着移动主页现在位于/移动而不是/Mobile/Home，因为 "Home" 现在是移动页面的隐式默认控制器名称。</span><span class="sxs-lookup"><span data-stu-id="2725f-287">This means the mobile homepage will now be located at /Mobile, rather than /Mobile/Home, because "Home" is now the implicitly default controller name for mobile pages.</span></span>

<span data-ttu-id="2725f-288">接下来，请注意，通过将第二个 HomeController 添加到你的应用程序（即移动设备，除了现有桌面一台），你将会损坏你的常规桌面主页。</span><span class="sxs-lookup"><span data-stu-id="2725f-288">Next, note that by adding a second HomeController to your application (i.e., the mobile one, in addition to the existing desktop one), you'll have broken your regular desktop homepage.</span></span> <span data-ttu-id="2725f-289">它将失败，并出现错误 "*找到多个匹配名称为 ' Home ' 的控制器的类型*"。</span><span class="sxs-lookup"><span data-stu-id="2725f-289">It will fail with the error "*Multiple types were found that match the controller named 'Home'*".</span></span> <span data-ttu-id="2725f-290">若要解决此问题，请更新顶层路由配置（在 Global.asax.cs 中），以指定在存在不明确的情况下桌面 HomeController 应优先使用：</span><span class="sxs-lookup"><span data-stu-id="2725f-290">To resolve this, update your top-level routing configuration (in Global.asax.cs) to specify that your desktop HomeController should take priority when there's ambiguity:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample9.cs)]

<span data-ttu-id="2725f-291">现在，此错误将消失，URL http：\/\/*yoursite*/将到达桌面主页，并且 http：\/\/*yoursite*/mobile/将到达移动主页。</span><span class="sxs-lookup"><span data-stu-id="2725f-291">Now the error will go away, and the URL http:\/\/*yoursite*/ will reach the desktop homepage, and http:\/\/*yoursite*/mobile/ will reach the mobile homepage.</span></span>

### <a name="redirecting-mobile-visitors-to-your-mobile-area"></a><span data-ttu-id="2725f-292">将移动访问者重定向到你的移动区域</span><span class="sxs-lookup"><span data-stu-id="2725f-292">Redirecting mobile visitors to your mobile area</span></span>

<span data-ttu-id="2725f-293">ASP.NET MVC 中有许多不同的扩展点，因此有许多可能的方法来注入重定向逻辑。</span><span class="sxs-lookup"><span data-stu-id="2725f-293">There are many different extensibility points in ASP.NET MVC, so there are many possible ways to inject redirection logic.</span></span> <span data-ttu-id="2725f-294">一个巧妙的方法是创建一个筛选器属性 [RedirectMobileDevicesToMobileArea]，如果满足以下条件，则执行重定向：</span><span class="sxs-lookup"><span data-stu-id="2725f-294">One neat option is to create a filter attribute, [RedirectMobileDevicesToMobileArea], that performs a redirection if the following conditions are met:</span></span>

1. <span data-ttu-id="2725f-295">这是用户会话中的第一个请求（即 IsNewSession 等于 true）</span><span class="sxs-lookup"><span data-stu-id="2725f-295">It's the first request in the user's session (i.e., Session.IsNewSession equals true)</span></span>
2. <span data-ttu-id="2725f-296">请求来自移动浏览器（即 IsMobileDevice 等于 true）</span><span class="sxs-lookup"><span data-stu-id="2725f-296">The request comes from a mobile browser (i.e., Request.Browser.IsMobileDevice equals true)</span></span>
3. <span data-ttu-id="2725f-297">用户还没有在移动区域请求资源（即 URL 的*路径*部分不以/移动开头）</span><span class="sxs-lookup"><span data-stu-id="2725f-297">The user is not already requesting a resource in the mobile area (i.e., the *path* part of the URL does not begin with /Mobile)</span></span>

<span data-ttu-id="2725f-298">本白皮书附带的可下载示例包括此逻辑的实现。</span><span class="sxs-lookup"><span data-stu-id="2725f-298">The downloadable sample included with this white paper includes an implementation of this logic.</span></span> <span data-ttu-id="2725f-299">它实现为从 AuthorizeAttribute 派生的授权筛选器，这意味着即使你使用的是输出缓存，也可以正常工作，即使桌面访问者首次访问某个 URL，也可能会缓存桌面输出，并将其提供给后续的移动访问者）。</span><span class="sxs-lookup"><span data-stu-id="2725f-299">It's implemented as an authorization filter, derived from AuthorizeAttribute, which means it can work correctly even if you are using output caching (otherwise, if a desktop visitor first accesses a certain URL, the desktop output might be cached and then served to subsequent mobile visitors).</span></span>

<span data-ttu-id="2725f-300">作为筛选器，你可以选择将其应用于特定控制器和操作，例如，</span><span class="sxs-lookup"><span data-stu-id="2725f-300">As it's a filter, you can choose either to apply it to specific controllers and actions, e.g.,</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample10.cs)]

<span data-ttu-id="2725f-301">…</span><span class="sxs-lookup"><span data-stu-id="2725f-301">…</span></span> <span data-ttu-id="2725f-302">也可以将其作为 Global.asax.cs 文件中的 MVC 3*全局筛选器*应用于所有控制器和操作：</span><span class="sxs-lookup"><span data-stu-id="2725f-302">or you can apply it to all controllers and actions as an MVC 3 *global filter* in your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample11.cs)]

<span data-ttu-id="2725f-303">可下载的示例还演示了如何创建此属性的子类，以重定向到移动区域中的特定位置。</span><span class="sxs-lookup"><span data-stu-id="2725f-303">The downloadable sample also demonstrates how you can create subclasses of this attribute that redirect to specific locations within your mobile area.</span></span> <span data-ttu-id="2725f-304">例如，这意味着您可以：</span><span class="sxs-lookup"><span data-stu-id="2725f-304">This means, for example, you can:</span></span>

- <span data-ttu-id="2725f-305">按上面所示注册一个全局筛选器，默认情况下将移动访问者发送到移动主页。</span><span class="sxs-lookup"><span data-stu-id="2725f-305">Register a global filter as shown above that sends mobile visitors to the mobile homepage by default.</span></span>
- <span data-ttu-id="2725f-306">还将特殊的 [RedirectMobileDevicesToMobileProductPage] 筛选器应用于 "查看产品" 操作，该操作会将移动访问者移动到所请求的任何产品页的移动版本。</span><span class="sxs-lookup"><span data-stu-id="2725f-306">Also apply a special [RedirectMobileDevicesToMobileProductPage] filter to a "view product" action that takes mobile visitors to the mobile version of whatever product page they had requested.</span></span>
- <span data-ttu-id="2725f-307">同时将筛选器的其他特殊子类应用于特定操作，将移动访问者重定向到等效的移动页面</span><span class="sxs-lookup"><span data-stu-id="2725f-307">Also apply other special subclasses of the filter to specific actions, redirecting mobile visitors to the equivalent mobile page</span></span>

### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="2725f-308">配置 Forms 身份验证以遵守你的移动页面</span><span class="sxs-lookup"><span data-stu-id="2725f-308">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="2725f-309">如果使用 Forms 身份验证，应注意，当用户需要登录时，它会自动将用户重定向到单个特定的 "登录" URL，默认情况下，该 URL 为 **/Account/LogOn**。</span><span class="sxs-lookup"><span data-stu-id="2725f-309">If you're using Forms Authentication, you should note that when a user needs to log in, it automatically redirects the user to a single specific "log on" URL, which by default is **/Account/LogOn**.</span></span> <span data-ttu-id="2725f-310">这意味着移动用户可能会被重定向到桌面的 "登录" 操作。</span><span class="sxs-lookup"><span data-stu-id="2725f-310">This means that mobile users may be redirected to your desktop "log on" action.</span></span>

<span data-ttu-id="2725f-311">若要避免此问题，请将逻辑添加到桌面的 "登录" 操作，以便它再次将移动用户重定向到移动设备上的 "登录" 操作。</span><span class="sxs-lookup"><span data-stu-id="2725f-311">To avoid this problem, add logic to your desktop "log on" action so that it redirects mobile users again to a mobile "log on" action.</span></span> <span data-ttu-id="2725f-312">如果使用的是默认的 ASP.NET MVC 应用程序模板，请按如下所示更新 AccountController 的登录操作：</span><span class="sxs-lookup"><span data-stu-id="2725f-312">If you're using the default ASP.NET MVC application template, update AccountController's LogOn action as follows:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample12.cs)]

<span data-ttu-id="2725f-313">…</span><span class="sxs-lookup"><span data-stu-id="2725f-313">…</span></span> <span data-ttu-id="2725f-314">然后，在移动区域中名为 AccountController 的控制器上实施适当的特定于移动设备的 "登录" 操作。</span><span class="sxs-lookup"><span data-stu-id="2725f-314">and then implement a suitable mobile-specific "log on" action on a controller called AccountController in your Mobile area.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="2725f-315">使用输出缓存</span><span class="sxs-lookup"><span data-stu-id="2725f-315">Working with Output Caching</span></span>

<span data-ttu-id="2725f-316">如果使用的是 [OutputCache] 筛选器，则必须根据设备类型强制缓存项发生变化。</span><span class="sxs-lookup"><span data-stu-id="2725f-316">If you're using the [OutputCache] filter, you must force the cache entry to vary by device type.</span></span> <span data-ttu-id="2725f-317">例如，编写：</span><span class="sxs-lookup"><span data-stu-id="2725f-317">For example, write:</span></span>

[!code-javascript[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample13.js)]

<span data-ttu-id="2725f-318">然后，将以下方法添加到 Global.asax.cs 文件：</span><span class="sxs-lookup"><span data-stu-id="2725f-318">Then, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample14.cs)]

<span data-ttu-id="2725f-319">这将确保页面的移动访问者不接收先前由桌面访问者放入缓存的输出。</span><span class="sxs-lookup"><span data-stu-id="2725f-319">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="2725f-320">工作示例</span><span class="sxs-lookup"><span data-stu-id="2725f-320">A working example</span></span>

<span data-ttu-id="2725f-321">若要查看这些方法的运行情况，请下载[此白皮书代码关联的示例](https://docs.microsoft.com/aspnet/mobile/overview)。</span><span class="sxs-lookup"><span data-stu-id="2725f-321">To see these techniques in action, download [this white paper's code associated samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="2725f-322">该示例包括一个 ASP.NET MVC 3 （候选发布版）应用程序，该应用程序已增强，可使用上述方法支持移动设备。</span><span class="sxs-lookup"><span data-stu-id="2725f-322">The sample includes an ASP.NET MVC 3 (Release Candidate) application enhanced to support mobile devices using the methods described above.</span></span>

## <a name="further-guidance-and-suggestions"></a><span data-ttu-id="2725f-323">进一步指导和建议</span><span class="sxs-lookup"><span data-stu-id="2725f-323">Further guidance and suggestions</span></span>

<span data-ttu-id="2725f-324">以下讨论适用于使用本文档中所述的技术的 Web 窗体和 MVC 开发人员。</span><span class="sxs-lookup"><span data-stu-id="2725f-324">The following discussion applies both to Web Forms and MVC developers who are using the techniques covered in this document.</span></span>

### <a name="enhancing-your-redirection-logic-using-51degreesmobi-foundation"></a><span data-ttu-id="2725f-325">使用 51Degrees.mobi Foundation 增强重定向逻辑</span><span class="sxs-lookup"><span data-stu-id="2725f-325">Enhancing your redirection logic using 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="2725f-326">本文档中所示的重定向逻辑对于您的应用程序而言可能是足够的，但如果您需要禁用会话，或在拒绝 cookie 的移动浏览器（它们不能有会话）时，它将不起作用，因为它不知道给定的请求是否为该访问者的第一个。</span><span class="sxs-lookup"><span data-stu-id="2725f-326">The redirection logic shown in this document may be perfectly sufficient for your application, but it won't work if you need to disable sessions, or with mobile browsers that reject cookies (these can't have sessions), because it won't know whether a given request is the first one from that visitor.</span></span>

<span data-ttu-id="2725f-327">您已经了解了开源 51Degrees.mobi Foundation 如何提高 ASP 的准确性。网络浏览器检测。</span><span class="sxs-lookup"><span data-stu-id="2725f-327">You already learned how the open source 51Degrees.mobi Foundation can improve the accuracy of ASP.NET's browser detection.</span></span> <span data-ttu-id="2725f-328">它还可以将移动访问者重定向到 web.config 中配置的特定位置。它可以通过存储访问者的 HTTP 标头和 IP 地址的哈希哈希的哈希值，而不依赖于 ASP.NET 会话（和 cookie），因此它知道每个请求是否是来自给定 vistor 的第一个请求。</span><span class="sxs-lookup"><span data-stu-id="2725f-328">It also has a built-in ability to redirect mobile visitors to specific locations configured in Web.config. It's able to work without depending on ASP.NET Sessions (and hence cookies) by storing a temporary log of hashes of visitors' HTTP headers and IP addresses, so it knows whether or not each request is the first one from a given vistor.</span></span>

<span data-ttu-id="2725f-329">添加到 web.config 文件的 fiftyOne 部分的以下元素会将第一个请求从检测到的移动设备重定向到页面 ~/Mobile/Default.aspx。</span><span class="sxs-lookup"><span data-stu-id="2725f-329">The following element added to the fiftyOne section of the web.config file will redirect the first request from a detected mobile device to the page ~/Mobile/Default.aspx.</span></span> <span data-ttu-id="2725f-330">无论设备类型如何，都*不*会重定向对移动文件夹下的页面的任何请求。</span><span class="sxs-lookup"><span data-stu-id="2725f-330">Any requests to pages under the Mobile folder will *not* be redirected, regardless of device type.</span></span> <span data-ttu-id="2725f-331">如果移动设备在20分钟或更长时间内处于非活动状态，则将忘记该设备，并将后续请求作为新请求被视为用于重定向目的的新请求。</span><span class="sxs-lookup"><span data-stu-id="2725f-331">If the mobile device has been inactive for a period of 20 minutes or more the device will be forgotten and subsequent requests will be treated as new ones for the purposes of redirection.</span></span>

[!code-xml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample15.xml)]

<span data-ttu-id="2725f-332">有关更多详细信息，请参阅[51Degrees.mobi Foundation 文档](https://github.com/51Degrees/dotNET-Device-Detection)。</span><span class="sxs-lookup"><span data-stu-id="2725f-332">For more details, see [51degrees.mobi Foundation documentation](https://github.com/51Degrees/dotNET-Device-Detection).</span></span>

> [!NOTE]
> <span data-ttu-id="2725f-333">你*可以*在 ASP.NET MVC 应用程序上使用 51Degrees.mobi Foundation 的重定向功能，但你将需要根据普通 url 定义重定向配置，而不是按路由参数或在操作上放置 MVC 筛选器。</span><span class="sxs-lookup"><span data-stu-id="2725f-333">You *can* use 51Degrees.mobi Foundation's redirection feature on ASP.NET MVC applications, but you will need to define your redirection configuration in terms of plain URLs, not in terms of routing parameters or by putting MVC filters on actions.</span></span> <span data-ttu-id="2725f-334">这是因为（在撰写本文时），51Degrees.mobi Foundation 无法识别筛选器或路由。</span><span class="sxs-lookup"><span data-stu-id="2725f-334">This is because (at the time of writing) 51Degrees.mobi Foundation does not recognize filters or routing.</span></span>

### <a name="disabling-transcoders-and-proxy-servers"></a><span data-ttu-id="2725f-335">禁用转码器和代理服务器</span><span class="sxs-lookup"><span data-stu-id="2725f-335">Disabling Transcoders and Proxy Servers</span></span>

<span data-ttu-id="2725f-336">移动网络运营商的移动 internet 方法分为两大目标：</span><span class="sxs-lookup"><span data-stu-id="2725f-336">Mobile network operators have two broad objectives in their approach to the mobile internet:</span></span>

1. <span data-ttu-id="2725f-337">提供尽可能多的相关内容</span><span class="sxs-lookup"><span data-stu-id="2725f-337">Provide as much relevant content as possible</span></span>
2. <span data-ttu-id="2725f-338">最大限度地提高可共享有限无线网络带宽的客户数量</span><span class="sxs-lookup"><span data-stu-id="2725f-338">Maximize the number of customers who can share the limited radio network bandwidth</span></span>

<span data-ttu-id="2725f-339">由于大多数网页是针对大型桌面大小的屏幕和快速固定线宽带连接而设计的，因此许多运算符使用*转码器*或*代理服务器*来动态地更改 web 内容。</span><span class="sxs-lookup"><span data-stu-id="2725f-339">Since most web pages were designed for large desktop-sized screens and fast fixed-line broadband connections, many operators use *transcoders* or *proxy servers* that dynamically alter web content.</span></span> <span data-ttu-id="2725f-340">它们可能会修改您的 HTML 标记或 CSS，使其适合较小的屏幕（特别是对于缺少处理复杂布局的处理能力的 "功能电话"），并且它们可能会重新压缩图像（大幅降低其质量）以提高页面交付速度。</span><span class="sxs-lookup"><span data-stu-id="2725f-340">They may modify your HTML markup or CSS to suit smaller screens (especially for "feature phones" that lack the processing power to handle complex layouts), and they may recompress your images (significantly reducing their quality) to improve page delivery speeds.</span></span>

<span data-ttu-id="2725f-341">但是，如果你已完成生成移动优化的网站的版本，你可能不希望网络运营商进一步干扰。</span><span class="sxs-lookup"><span data-stu-id="2725f-341">But if you've taken the effort to produce a mobile-optimized version of your site, you probably don't want the network operator to interfere with it any further.</span></span> <span data-ttu-id="2725f-342">可以在任何 ASP.NET Web 窗体中将以下行添加到页面\_Load 事件：</span><span class="sxs-lookup"><span data-stu-id="2725f-342">You can add the following line to the Page\_Load event in any ASP.NET Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample16.cs)]

<span data-ttu-id="2725f-343">或者，对于 ASP.NET MVC 控制器，可以添加以下方法替代，使其适用于该控制器上的所有操作：</span><span class="sxs-lookup"><span data-stu-id="2725f-343">Or, for an ASP.NET MVC controller, you could add the following method override so that it applies to all actions on that controller:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample17.cs)]

<span data-ttu-id="2725f-344">生成的 HTTP 消息通知 W3C 兼容转码器和代理不更改内容。</span><span class="sxs-lookup"><span data-stu-id="2725f-344">The resulting HTTP message informs W3C compliant transcoders and proxies not to alter content.</span></span> <span data-ttu-id="2725f-345">当然，不保证移动网络操作员会遵守此消息。</span><span class="sxs-lookup"><span data-stu-id="2725f-345">Of course, there is no guarantee that mobile network operators will respect this message.</span></span>

### <a name="styling-mobile-pages-for-mobile-browsers"></a><span data-ttu-id="2725f-346">移动浏览器的样式移动页面</span><span class="sxs-lookup"><span data-stu-id="2725f-346">Styling mobile pages for mobile browsers</span></span>

<span data-ttu-id="2725f-347">它不在本文档的讨论范围内，可以更详细地说明哪些类型的 HTML 标记正确工作，或者哪些 web 设计技术可最大程度地提高特定设备的可用性。</span><span class="sxs-lookup"><span data-stu-id="2725f-347">It's beyond the scope of this document to describe in great detail what kinds of HTML markup work correctly or which web design techniques maximize usability on particular devices.</span></span> <span data-ttu-id="2725f-348">你需要找到一个非常简单的布局，针对移动大小的屏幕进行了优化，无需使用不可靠的 HTML 或 CSS 定位技巧。</span><span class="sxs-lookup"><span data-stu-id="2725f-348">It's up to you to find a sufficiently simple layout, optimized for a mobile-sized screen, without using unreliable HTML or CSS positioning tricks.</span></span> <span data-ttu-id="2725f-349">但值得一提的一项重要技巧是*视区 meta 标记*。</span><span class="sxs-lookup"><span data-stu-id="2725f-349">One important technique worth mentioning, however, is the *viewport meta tag*.</span></span>

<span data-ttu-id="2725f-350">某些新式移动浏览器在工作中显示用于桌面监视器的网页，在虚拟画布上呈现页面，也称为 "视区" （例如，在 iPhone 上，虚拟视口为980像素宽，在默认情况下，在 Opera Mobile 上为850像素宽），然后缩小结果以适应屏幕的物理像素。</span><span class="sxs-lookup"><span data-stu-id="2725f-350">Certain modern mobile browsers, in an effort display web pages meant for desktop monitors, render the page on a virtual canvas, also called "viewport" (e.g., the virtual viewport is 980 pixels wide on iPhone, and 850 pixels wide on Opera Mobile by default) and then scale the result down to fit onto the screen's physical pixels.</span></span> <span data-ttu-id="2725f-351">然后，用户可以放大并平移该视区。</span><span class="sxs-lookup"><span data-stu-id="2725f-351">The user can then zoom in and pan around that viewport.</span></span> <span data-ttu-id="2725f-352">这种方法的优点在于，浏览器可让浏览器按其预期的布局来显示页面，但它也具有一些强制缩放和平移的缺点，这对用户来说不方便。</span><span class="sxs-lookup"><span data-stu-id="2725f-352">This has the advantage that it lets the browser display the page in its intended layout, but it's also has the disadvantage that it forces zooming and panning, which is inconvenient for the user.</span></span> <span data-ttu-id="2725f-353">如果你正在设计 mobile，则最好设计较窄的屏幕，这样就不需要缩放或水平滚动。</span><span class="sxs-lookup"><span data-stu-id="2725f-353">If you're designing for mobile, it's better to design for a narrow screen so that no zooming or horizontal scrolling is necessary.</span></span>

<span data-ttu-id="2725f-354">通过非标准*视区*meta 标记，告诉移动浏览器视区的宽度。</span><span class="sxs-lookup"><span data-stu-id="2725f-354">A way to tell the mobile browser how wide the viewport should be is through the nonstandard *viewport* meta tag.</span></span> <span data-ttu-id="2725f-355">例如，如果将以下内容添加到页面的 HEAD 部分，</span><span class="sxs-lookup"><span data-stu-id="2725f-355">For example, if you add the following to your page's HEAD section,</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample18.html)]

<span data-ttu-id="2725f-356">…</span><span class="sxs-lookup"><span data-stu-id="2725f-356">…</span></span> <span data-ttu-id="2725f-357">然后，支持 smartphone 浏览器会在480像素宽的虚拟画布上设计页面。</span><span class="sxs-lookup"><span data-stu-id="2725f-357">then supporting smartphone browsers will lay out the page on a 480-pixel wide virtual canvas.</span></span> <span data-ttu-id="2725f-358">这意味着，如果 HTML 元素以百分比的形式定义其宽度，则将根据此480像素宽度（而非默认视区宽度）来解释百分比。</span><span class="sxs-lookup"><span data-stu-id="2725f-358">This means that if your HTML elements define their widths in percentage terms, the percentages will be interpreted with respect to this 480-pixel width, not the default viewport width.</span></span> <span data-ttu-id="2725f-359">因此，用户不太可能需要水平缩放和平移–大幅改善移动浏览体验。</span><span class="sxs-lookup"><span data-stu-id="2725f-359">As a result, the user is less likely to have to zoom and pan horizontally – considerably improving the mobile browsing experience.</span></span>

<span data-ttu-id="2725f-360">如果希望视区宽度与设备的物理像素匹配，可以指定以下内容：</span><span class="sxs-lookup"><span data-stu-id="2725f-360">If you want the viewport width to match the device's physical pixels, you can specify the following:</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample19.html)]

<span data-ttu-id="2725f-361">为了使其正常工作，您不能显式强制元素超过该宽度（例如，使用*width*特性或 CSS 属性），否则浏览器将被强制使用更大的视区，而不考虑。</span><span class="sxs-lookup"><span data-stu-id="2725f-361">For this to work correctly, you must not explicitly force elements to exceed that width (e.g., using a *width* attribute or CSS property), otherwise the browser will be forced to use a larger viewport regardless.</span></span> <span data-ttu-id="2725f-362">另请参阅：[有关非标准视口标记的更多详细信息](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html)。</span><span class="sxs-lookup"><span data-stu-id="2725f-362">See also: [more details about the nonstandard viewport tag](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html).</span></span>

<span data-ttu-id="2725f-363">大多数新式智能手机支持*双重方向*：它们可以处于纵向或横向模式。</span><span class="sxs-lookup"><span data-stu-id="2725f-363">Most modern smartphones support *dual orientation*: they can be held in either portrait or landscape mode.</span></span> <span data-ttu-id="2725f-364">因此，不一定要对屏幕宽度（以像素为单位）做出假设。</span><span class="sxs-lookup"><span data-stu-id="2725f-364">So, it's important not to make assumptions about the screen width in pixels.</span></span> <span data-ttu-id="2725f-365">不要假设屏幕宽度是固定的，因为用户可以在页面上重新定向其设备。</span><span class="sxs-lookup"><span data-stu-id="2725f-365">Don't even assume that the screen width is fixed, because the user can re-orient their device while they are on your page.</span></span>

<span data-ttu-id="2725f-366">较早的 Windows Mobile 和 Blackberry 设备还可以接受页眉中的以下 meta 标记，以通知它们内容已针对移动优化，因此不应进行转换。</span><span class="sxs-lookup"><span data-stu-id="2725f-366">Older Windows Mobile and Blackberry devices may also accept the following meta tags in the page header to inform them content has been optimized for mobile and therefore should not be transformed.</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample20.html)]

## <a name="additional-resources"></a><span data-ttu-id="2725f-367">其他资源</span><span class="sxs-lookup"><span data-stu-id="2725f-367">Additional Resources</span></span>

<span data-ttu-id="2725f-368">有关可用于测试移动 ASP.NET web 应用程序的移动设备仿真程序和模拟器的列表，请参阅 "[模拟常用移动设备进行测试](../mobile/device-simulators.md)" 页。</span><span class="sxs-lookup"><span data-stu-id="2725f-368">For a list of mobile device emulators and simulators you can use to test your mobile ASP.NET web application, see the page [Simulate popular mobile devices for testing](../mobile/device-simulators.md).</span></span>

## <a name="credits"></a><span data-ttu-id="2725f-369">学分</span><span class="sxs-lookup"><span data-stu-id="2725f-369">Credits</span></span>

- <span data-ttu-id="2725f-370">主要作者： Steven Sanderson</span><span class="sxs-lookup"><span data-stu-id="2725f-370">Primary author: Steven Sanderson</span></span>
- <span data-ttu-id="2725f-371">审阅者/其他内容作者： James Rosewell、Mikael Söderström、Scott Hanselman、Scott Hunter</span><span class="sxs-lookup"><span data-stu-id="2725f-371">Reviewers / additional content writers: James Rosewell, Mikael Söderström, Scott Hanselman, Scott Hunter</span></span>
