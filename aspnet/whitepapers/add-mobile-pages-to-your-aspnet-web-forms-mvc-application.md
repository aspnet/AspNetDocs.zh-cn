---
uid: whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
title: 如何：将移动页面添加到 ASP.NET Web 窗体 / MVC 应用程序 |Microsoft Docs
author: rick-anderson
description: 此方法向介绍了各种方法提供针对 ASP.NET Web 窗体中的移动设备优化的页面 / MVC 应用程序，并提供的建议体系结构和...
ms.author: riande
ms.date: 01/20/2011
ms.assetid: 3124f28e-cc32-418a-afe3-519fa56f4c36
msc.legacyurl: /whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
msc.type: content
ms.openlocfilehash: 63c555358d06a9506bb5c8c993800c3307108192
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/06/2019
ms.locfileid: "65114434"
---
# <a name="how-to-add-mobile-pages-to-your-aspnet-web-forms--mvc-application"></a><span data-ttu-id="6a900-103">如何：向 ASP.NET Web 窗体 / MVC 应用程序添加移动页面</span><span class="sxs-lookup"><span data-stu-id="6a900-103">How To: Add Mobile Pages to Your ASP.NET Web Forms / MVC Application</span></span>

> <span data-ttu-id="6a900-104">**适用于**</span><span class="sxs-lookup"><span data-stu-id="6a900-104">**Applies To**</span></span>
> 
> - <span data-ttu-id="6a900-105">ASP.NET Web 窗体版本 4.0</span><span class="sxs-lookup"><span data-stu-id="6a900-105">ASP.NET Web Forms version 4.0</span></span>
> - <span data-ttu-id="6a900-106">ASP.NET MVC 版本 3.0</span><span class="sxs-lookup"><span data-stu-id="6a900-106">ASP.NET MVC version 3.0</span></span>
> 
> <span data-ttu-id="6a900-107">**摘要**</span><span class="sxs-lookup"><span data-stu-id="6a900-107">**Summary**</span></span>
> 
> <span data-ttu-id="6a900-108">此方法向介绍了各种方法提供针对 ASP.NET Web 窗体中的移动设备优化的页面 / MVC 应用程序，并建议体系结构和设计要考虑面向范围广泛的设备时的问题。</span><span class="sxs-lookup"><span data-stu-id="6a900-108">This How To describes various ways to serve pages optimized for mobile devices from your ASP.NET Web Forms / MVC application, and suggests architectural and design issues to consider when targeting a broad range of devices.</span></span> <span data-ttu-id="6a900-109">本文档还介绍了为什么 ASP.NET 移动控件从 ASP.NET 2.0 到 3.5 现已过时，并讨论某些现代的替代方法。</span><span class="sxs-lookup"><span data-stu-id="6a900-109">This document also explains why the ASP.NET Mobile Controls from ASP.NET 2.0 to 3.5 are now obsolete, and discusses some modern alternatives.</span></span>

## <a name="contents"></a><span data-ttu-id="6a900-110">内容</span><span class="sxs-lookup"><span data-stu-id="6a900-110">Contents</span></span>

- <span data-ttu-id="6a900-111">概述</span><span class="sxs-lookup"><span data-stu-id="6a900-111">Overview</span></span>
- <span data-ttu-id="6a900-112">体系结构选项</span><span class="sxs-lookup"><span data-stu-id="6a900-112">Architectural options</span></span>
- <span data-ttu-id="6a900-113">浏览器和设备检测</span><span class="sxs-lookup"><span data-stu-id="6a900-113">Browser and device detection</span></span>
- <span data-ttu-id="6a900-114">ASP.NET Web 窗体应用程序可以如何提供移动特定页</span><span class="sxs-lookup"><span data-stu-id="6a900-114">How ASP.NET Web Forms applications can present mobile-specific pages</span></span>
- <span data-ttu-id="6a900-115">ASP.NET MVC 应用程序可以如何提供移动特定页</span><span class="sxs-lookup"><span data-stu-id="6a900-115">How ASP.NET MVC applications can present mobile-specific pages</span></span>
- <span data-ttu-id="6a900-116">其他资源</span><span class="sxs-lookup"><span data-stu-id="6a900-116">Additional resources</span></span>

<span data-ttu-id="6a900-117">本白皮书主要技术演示 ASP.NET Web 窗体和 MVC 的可下载代码示例，请参阅[移动应用和 asp.net 站点](https://docs.microsoft.com/aspnet/mobile/overview)。</span><span class="sxs-lookup"><span data-stu-id="6a900-117">For downloadable code samples demonstrating this white paper's techniques for both ASP.NET Web Forms and MVC, see [Mobile Apps & Sites with ASP.NET](https://docs.microsoft.com/aspnet/mobile/overview).</span></span>

## <a name="overview"></a><span data-ttu-id="6a900-118">概述</span><span class="sxs-lookup"><span data-stu-id="6a900-118">Overview</span></span>

<span data-ttu-id="6a900-119">移动设备 – 智能手机、 功能手机和平板电脑-不断增大作为一种方式来访问 Web 的受欢迎程度。</span><span class="sxs-lookup"><span data-stu-id="6a900-119">Mobile devices – smartphones, feature phones, and tablets – continue to grow in popularity as a means to access the Web.</span></span> <span data-ttu-id="6a900-120">对于许多 web 开发人员和面向 web 的企业，这意味着它是为使用这些设备的访问者提供了很好的浏览体验越来越重要。</span><span class="sxs-lookup"><span data-stu-id="6a900-120">For many web developers and web-oriented businesses, this means it's increasingly important to provide a great browsing experience for visitors using those devices.</span></span>

### <a name="how-earlier-versions-of-aspnet-supported-mobile-browsers"></a><span data-ttu-id="6a900-121">如何早期版本的 ASP.NET 支持移动浏览器</span><span class="sxs-lookup"><span data-stu-id="6a900-121">How earlier versions of ASP.NET supported mobile browsers</span></span>

<span data-ttu-id="6a900-122">ASP.NET 版本 2.0 到 3.5 包含*ASP.NET 移动控件*： 一组中的移动设备的服务器控件*System.Web.Mobile.dll*程序集和*System.Web.UI.MobileControls*命名空间。</span><span class="sxs-lookup"><span data-stu-id="6a900-122">ASP.NET versions 2.0 to 3.5 included *ASP.NET Mobile Controls*: a set of server controls for mobile devices in the *System.Web.Mobile.dll* assembly and the *System.Web.UI.MobileControls* namespace.</span></span> <span data-ttu-id="6a900-123">程序集仍包含在 ASP.NET 4 中，但不推荐使用。</span><span class="sxs-lookup"><span data-stu-id="6a900-123">The assembly is still included in ASP.NET 4, but it is deprecated.</span></span> <span data-ttu-id="6a900-124">建议开发人员将迁移到更现代的方法，如本文中所述。</span><span class="sxs-lookup"><span data-stu-id="6a900-124">Developers are advised to migrate to more modern approaches, such as those described in this paper.</span></span>

<span data-ttu-id="6a900-125">为什么 ASP.NET 移动控件具有已标记为过时的原因是，其设计面向的是常见围绕 2005年及更早版本的手机。</span><span class="sxs-lookup"><span data-stu-id="6a900-125">The reason why ASP.NET Mobile Controls have been marked as obsolete is that their design is oriented around the mobile phones that were common around 2005 and earlier.</span></span> <span data-ttu-id="6a900-126">控件主要设计用于呈现 WML 或 cHTML 标记 （而不是常规的 HTML) 的那个时代的 WAP 浏览器。</span><span class="sxs-lookup"><span data-stu-id="6a900-126">The controls are mainly designed to render WML or cHTML markup (instead of regular HTML) for the WAP browsers of that era.</span></span> <span data-ttu-id="6a900-127">但 WAP、 WML 和 cHTML 不再适用于大多数项目，因为 HTML 现在已成为移动和桌面浏览器等内容的通用标记语言。</span><span class="sxs-lookup"><span data-stu-id="6a900-127">But WAP, WML, and cHTML are no longer relevant for most projects, because HTML has now become the ubiquitous markup language for mobile and desktop browsers alike.</span></span>

### <a name="the-challenges-of-supporting-mobile-devices-today"></a><span data-ttu-id="6a900-128">现在支持移动设备的挑战</span><span class="sxs-lookup"><span data-stu-id="6a900-128">The challenges of supporting mobile devices today</span></span>

<span data-ttu-id="6a900-129">尽管移动浏览器现在普遍支持 HTML，仍将面临着许多挑战，当热情，希望创建强大的移动浏览体验：</span><span class="sxs-lookup"><span data-stu-id="6a900-129">Even though mobile browsers now almost universally support HTML, you will still face many challenges when aiming to create great mobile browsing experiences:</span></span>

- <span data-ttu-id="6a900-130">***屏幕大小***-在表单中，显著不同的移动设备和其屏幕通常是很多小于桌面监视器。</span><span class="sxs-lookup"><span data-stu-id="6a900-130">***Screen size*** - Mobile devices vary dramatically in form, and their screens are often much smaller than desktop monitors.</span></span> <span data-ttu-id="6a900-131">因此，您可能需要为其设计完全不同的页面布局。</span><span class="sxs-lookup"><span data-stu-id="6a900-131">So, you may need to design completely different page layouts for them.</span></span>
- <span data-ttu-id="6a900-132">***输入方法***– 某些设备具有小键盘、 一些具有 styluses、 其他人使用触摸屏输入。</span><span class="sxs-lookup"><span data-stu-id="6a900-132">***Input methods*** – Some devices have keypads, some have styluses, others use touch.</span></span> <span data-ttu-id="6a900-133">您可能需要考虑多个导航机制和数据的输入的方法。</span><span class="sxs-lookup"><span data-stu-id="6a900-133">You may need to consider multiple navigation mechanisms and data input methods.</span></span>
- <span data-ttu-id="6a900-134">***标准符合性***– 很多移动浏览器不支持的最新的 HTML、 CSS 或 JavaScript 标准。</span><span class="sxs-lookup"><span data-stu-id="6a900-134">***Standards compliance*** – Many mobile browsers do not support the latest HTML, CSS, or JavaScript standards.</span></span>
- <span data-ttu-id="6a900-135">***带宽***-移动电话数据网络性能而发生变化差异很大，和一些最终用户位于关税根据的兆字节。</span><span class="sxs-lookup"><span data-stu-id="6a900-135">***Bandwidth*** – Cellular data network performance varies wildly, and some end users are on tariffs that charge by the megabyte.</span></span>

<span data-ttu-id="6a900-136">没有一刀切的解决方案;你的应用程序将需要的外观和行为以不同的方式根据设备对其进行访问。</span><span class="sxs-lookup"><span data-stu-id="6a900-136">There's no one-size-fits-all solution; your application will have to look and behave differently according to the device accessing it.</span></span> <span data-ttu-id="6a900-137">具体取决于所需的移动设备级别，这可以是支持的面向 web 开发人员比以往桌面"浏览器大战"一个更大挑战。</span><span class="sxs-lookup"><span data-stu-id="6a900-137">Depending on what level of mobile support you want, this can be a bigger challenge for web developers than the desktop "browser wars" ever was.</span></span>

<span data-ttu-id="6a900-138">通常最初接近的第一次移动浏览器支持的开发人员认为务必仅支持最新和最复杂的智能手机 （例如，Windows Phone 7、 iPhone 或 Android），可能是因为开发人员通常个人拥有此类设备。</span><span class="sxs-lookup"><span data-stu-id="6a900-138">Developers approaching mobile browser support for the first time often initially think it's only important to support the latest and most sophisticated smartphones (e.g., Windows Phone 7, iPhone, or Android), perhaps because developers often personally own such devices.</span></span> <span data-ttu-id="6a900-139">但是，更便宜的手机仍然非常受欢迎，而且其所有者使用它们来浏览 web – 尤其是在移动电话是比使用宽带连接更容易获取的国家/地区。</span><span class="sxs-lookup"><span data-stu-id="6a900-139">However, cheaper phones are still extremely popular, and their owners do use them to browse the web – especially in countries where mobile phones are easier to get than a broadband connection.</span></span> <span data-ttu-id="6a900-140">你的业务需要决定哪些设备，以支持通过考虑其有可能购买产品的范围。</span><span class="sxs-lookup"><span data-stu-id="6a900-140">Your business will need to decide what range of devices to support by considering its likely customers.</span></span> <span data-ttu-id="6a900-141">如果您正在构建 luxury 运行状况 spa 联机手册，您可能会使的业务决策仅面向高级智能手机，而如果要创建电影的票证预订系统，可能需要考虑使用较不强大的功能的访问者手机。</span><span class="sxs-lookup"><span data-stu-id="6a900-141">If you're building an online brochure for a luxury health spa, you might make a business decision only to target advanced smartphones, whereas if you're creating a ticket booking system for a cinema, you probably need to account for visitors with less powerful feature phones.</span></span>

## <a name="architectural-options"></a><span data-ttu-id="6a900-142">体系结构选项</span><span class="sxs-lookup"><span data-stu-id="6a900-142">Architectural options</span></span>

<span data-ttu-id="6a900-143">我们进入 ASP.NET Web 窗体或 MVC 的特定技术细节之前，请注意，web 开发人员通常具有三个主要的可能选项，以支持移动浏览器：</span><span class="sxs-lookup"><span data-stu-id="6a900-143">Before we get to the specific technical details of ASP.NET Web Forms or MVC, note that web developers in general have three main possible options for supporting mobile browsers:</span></span>

1. <span data-ttu-id="6a900-144">***不执行任何操作 –*** 只需创建标准的、 面向桌面的 web 应用程序，并依赖于移动浏览器的呈现效果可接受。</span><span class="sxs-lookup"><span data-stu-id="6a900-144">***Do nothing –*** You can simply create a standard, desktop-oriented web application, and rely on mobile browsers to render it acceptably.</span></span> 

    - <span data-ttu-id="6a900-145">**利用**:它是最便宜的选项来实施和维护-无需额外工作</span><span class="sxs-lookup"><span data-stu-id="6a900-145">**Advantage**: It's the cheapest option to implement and maintain – no extra work</span></span>
    - <span data-ttu-id="6a900-146">**缺点**:提供的最差的最终用户体验：</span><span class="sxs-lookup"><span data-stu-id="6a900-146">**Disadvantage**: Gives the worst end-user experience:</span></span> 

        - <span data-ttu-id="6a900-147">最新的智能手机与桌面浏览器中，可能会呈现在 HTML，但用户仍必须来缩放和水平滚动和垂直来使用您在小屏幕上的内容。</span><span class="sxs-lookup"><span data-stu-id="6a900-147">The latest smartphones may render your HTML just as well as a desktop browser, but users will still be forced to zoom and scroll horizontally and vertically to consume your content on a small screen.</span></span> <span data-ttu-id="6a900-148">这是与最佳相差甚远。</span><span class="sxs-lookup"><span data-stu-id="6a900-148">This is far from optimal.</span></span>
        - <span data-ttu-id="6a900-149">较旧的设备和功能手机可能会失败的令人满意的方式呈现您的标记。</span><span class="sxs-lookup"><span data-stu-id="6a900-149">Older devices and feature phones may fail to render your markup in a satisfactory way.</span></span>
        - <span data-ttu-id="6a900-150">甚至在最新的 tablet 设备 （其屏幕可以是笔记本电脑屏幕一样大），不同的交互的规则适用。</span><span class="sxs-lookup"><span data-stu-id="6a900-150">Even on the latest tablet devices (whose screens can be as big as laptop screens), different interaction rules apply.</span></span> <span data-ttu-id="6a900-151">基于触控的输入最适用于较大的按钮和链接跨页进一步相隔，并且没有办法鼠标光标悬停在飞出式菜单。</span><span class="sxs-lookup"><span data-stu-id="6a900-151">Touch-based input works best with larger buttons and links spread further apart, and there's no way to hover a mouse cursor over a fly-out menu.</span></span>
2. <span data-ttu-id="6a900-152">\***解决此问题在客户端上的\*–** 与小心使用 CSS 并[渐进式增强](http://en.wikipedia.org/wiki/Progressive_enhancement)标记、 样式和适应任何浏览器运行这些脚本可以创建。</span><span class="sxs-lookup"><span data-stu-id="6a900-152">***Solve the problem on the client* –** With careful use of CSS and [progressive enhancement](http://en.wikipedia.org/wiki/Progressive_enhancement) you can create markup, styles, and scripts that adapt to whatever browser is running them.</span></span> <span data-ttu-id="6a900-153">例如，对于[CSS 3 媒体查询](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/)，可以创建在屏幕的窄于所选阈值的设备将变为单列布局的多列布局。</span><span class="sxs-lookup"><span data-stu-id="6a900-153">For example, with [CSS 3 media queries](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/), you could create a multi-column layout that turns into a single column layout on devices whose screens are narrower than a chosen threshold.</span></span> 

    - <span data-ttu-id="6a900-154">**利用**:优化中使用，即使对于根据它们具有的任何屏幕和输入的特征的未知未来设备的特定设备的呈现</span><span class="sxs-lookup"><span data-stu-id="6a900-154">**Advantage**: Optimizes rendering for the specific device in use, even for unknown future devices according to whatever screen and input characteristics they have</span></span>
    - <span data-ttu-id="6a900-155">**利用**:轻松允许您跨所有设备类型-最小重复代码或工作量共享服务器端逻辑</span><span class="sxs-lookup"><span data-stu-id="6a900-155">**Advantage**: Easily lets you share server-side logic across all device types – minimal duplication of code or effort</span></span>
    - <span data-ttu-id="6a900-156">**缺点**:移动设备是因此不同于桌面版设备，你可能非常希望移动页是完全不同于桌面页面，显示不同的信息。</span><span class="sxs-lookup"><span data-stu-id="6a900-156">**Disadvantage**: Mobile devices are so different from desktop devices that you may really want your mobile pages to be completely different from your desktop pages, showing different information.</span></span> <span data-ttu-id="6a900-157">此类变体可能效率很低或不可能实现能够稳定地通过 CSS 独立的尤其要考虑如何不一致较旧的设备解释 CSS 规则。</span><span class="sxs-lookup"><span data-stu-id="6a900-157">Such variations can be inefficient or impossible to achieve robustly through CSS alone, especially considering how inconsistently older devices interpret CSS rules.</span></span> <span data-ttu-id="6a900-158">这是 CSS 3 属性尤其如此。</span><span class="sxs-lookup"><span data-stu-id="6a900-158">This is particularly true of CSS 3 attributes.</span></span>
    - <span data-ttu-id="6a900-159">**缺点**:为不同的服务器端逻辑和工作流适用于不同设备提供任何支持。</span><span class="sxs-lookup"><span data-stu-id="6a900-159">**Disadvantage**: Provides no support for varying server-side logic and workflows for different devices.</span></span> <span data-ttu-id="6a900-160">例如，不能通过 CSS 单独实现的简化购物车签出工作流为移动用户。</span><span class="sxs-lookup"><span data-stu-id="6a900-160">You can't, for example, implement a simplified shopping cart checkout workflow for mobile users by means of CSS alone.</span></span>
    - <span data-ttu-id="6a900-161">**缺点**:效率低下的带宽使用。</span><span class="sxs-lookup"><span data-stu-id="6a900-161">**Disadvantage**: Inefficient bandwidth use.</span></span> <span data-ttu-id="6a900-162">你的服务器可能要传输的标记和样式应用于所有可能的设备，即使目标设备将仅使用该信息的子集。</span><span class="sxs-lookup"><span data-stu-id="6a900-162">You server may have to transmit the markup and styles that apply to all possible devices, even though the target device will only use a subset of that information.</span></span>
3. <span data-ttu-id="6a900-163">\***解决此问题在服务器上的\*–** 服务器知道哪些设备正在访问它 – 或在该设备，例如，其屏幕大小和输入的法的最少的特征以及是否是移动设备-它可以运行不同的逻辑和输出不同的 HTML 标记。</span><span class="sxs-lookup"><span data-stu-id="6a900-163">***Solve the problem on the server* –** If your server knows what device is accessing it – or at least the characteristics of that device, such as its screen size and input method, and whether it's a mobile device – it can run different logic and output different HTML markup.</span></span> 

    - <span data-ttu-id="6a900-164">**优点：** 最大的灵活性。</span><span class="sxs-lookup"><span data-stu-id="6a900-164">**Advantage:** Maximum flexibility.</span></span> <span data-ttu-id="6a900-165">没有任何限制到多少可以改变您的服务器端逻辑面向移动或优化您的标记所需的、 特定于设备的布局。</span><span class="sxs-lookup"><span data-stu-id="6a900-165">There's no limit to how much you can vary your server-side logic for mobiles or optimize your markup for the desired, device-specific layout.</span></span>
    - <span data-ttu-id="6a900-166">**优点：** 高效的带宽使用。</span><span class="sxs-lookup"><span data-stu-id="6a900-166">**Advantage:** Efficient bandwidth use.</span></span> <span data-ttu-id="6a900-167">只需传输的标记和目标设备要使用的样式信息。</span><span class="sxs-lookup"><span data-stu-id="6a900-167">You only need to transmit the markup and styling information that the target device is going to use.</span></span>
    - <span data-ttu-id="6a900-168">**缺点：** 有时会强制的工作或代码重复 （例如，使你创建的 Web 窗体页或 MVC 视图的类似但略有不同副本项）。</span><span class="sxs-lookup"><span data-stu-id="6a900-168">**Disadvantage:** Sometimes forces repetition of effort or code (e.g., making you create similar but slightly different copies of your Web Forms pages or MVC views).</span></span> <span data-ttu-id="6a900-169">其中可能您应考虑常见逻辑基础层或服务，但仍，UI 代码或标记的某些部分可能要复制，然后同时维护。</span><span class="sxs-lookup"><span data-stu-id="6a900-169">Where possible you will factor out common logic into an underlying layer or service, but still, some parts of your UI code or markup may have to be duplicated and then maintained in parallel.</span></span>
    - <span data-ttu-id="6a900-170">**缺点：** 设备检测也十分重要。</span><span class="sxs-lookup"><span data-stu-id="6a900-170">**Disadvantage:** Device detection is not trivial.</span></span> <span data-ttu-id="6a900-171">它要求的列表或已知的设备类型和它们的特征 （这可能始终无法完全保持最新） 的数据库，并且不能保证每个传入请求进行准确匹配。</span><span class="sxs-lookup"><span data-stu-id="6a900-171">It requires a list or database of known device types and their characteristics (which may not always be perfectly up-to-date) and isn't guaranteed to accurately match every incoming request.</span></span> <span data-ttu-id="6a900-172">本文档介绍一些选项和其缺陷更高版本。</span><span class="sxs-lookup"><span data-stu-id="6a900-172">This document describes some options and their pitfalls later.</span></span>

<span data-ttu-id="6a900-173">若要获取最佳结果，大多数开发人员找到所需组合选项 (2) 和 (3)。</span><span class="sxs-lookup"><span data-stu-id="6a900-173">To get the best results, most developers find they need to combine options (2) and (3).</span></span> <span data-ttu-id="6a900-174">使用 CSS 或甚至 JavaScript 在客户端上最容纳样式的不同之处，而在服务器端代码中最有效地实现数据、 工作流或标记中的主要差异。</span><span class="sxs-lookup"><span data-stu-id="6a900-174">Minor stylistic differences are best accommodated on the client using CSS or even JavaScript, whereas major differences in data, workflow, or markup are most effectively implemented in server-side code.</span></span>

### <a name="this-paper-focuses-on-server-side-techniques"></a><span data-ttu-id="6a900-175">本白皮书主要介绍服务器端技术</span><span class="sxs-lookup"><span data-stu-id="6a900-175">This paper focuses on server-side techniques</span></span>

<span data-ttu-id="6a900-176">由于 ASP.NET Web 窗体和 MVC 这两种主要的服务器端技术，本白皮书将重点介绍服务器端的技巧，以帮助您生成不同的标记和移动浏览器的逻辑。</span><span class="sxs-lookup"><span data-stu-id="6a900-176">Since ASP.NET Web Forms and MVC are both primarily server-side technologies, this white paper will focus on server-side techniques that let you produce different markup and logic for mobile browsers.</span></span> <span data-ttu-id="6a900-177">当然，还可以将此合并任何客户端技术 （例如，CSS 3 媒体查询，渐进式增强 JavaScript），但这是更多的是 web 设计的 ASP.NET 开发比。</span><span class="sxs-lookup"><span data-stu-id="6a900-177">Of course, you can also combine this with any client-side technique (e.g., CSS 3 media queries, progressive-enhancement JavaScript), but that's more a matter of web design than ASP.NET development.</span></span>

## <a name="browser-and-device-detection"></a><span data-ttu-id="6a900-178">浏览器和设备检测</span><span class="sxs-lookup"><span data-stu-id="6a900-178">Browser and device detection</span></span>

<span data-ttu-id="6a900-179">有关支持的移动设备的所有服务器端方法的关键先决条件是知道您访问者使用哪些设备。</span><span class="sxs-lookup"><span data-stu-id="6a900-179">The key prerequisite for all server-side techniques for supporting mobile devices is to know what device your visitor is using.</span></span> <span data-ttu-id="6a900-180">事实上，甚至更好了解该设备的制造商和型号的数知道*特征*的设备。</span><span class="sxs-lookup"><span data-stu-id="6a900-180">In fact, even better than knowing the manufacturer and model number of that device is knowing the *characteristics* of the device.</span></span> <span data-ttu-id="6a900-181">特征可能包括：</span><span class="sxs-lookup"><span data-stu-id="6a900-181">Characteristics may include:</span></span>

- <span data-ttu-id="6a900-182">为移动设备？</span><span class="sxs-lookup"><span data-stu-id="6a900-182">Is it a mobile device?</span></span>
- <span data-ttu-id="6a900-183">输入的法 （鼠标/键盘、 触摸、 键盘、 游戏杆，...）</span><span class="sxs-lookup"><span data-stu-id="6a900-183">Input method (mouse/keyboard, touch, keypad, joystick, …)</span></span>
- <span data-ttu-id="6a900-184">屏幕大小 （以物理方式和以像素为单位）</span><span class="sxs-lookup"><span data-stu-id="6a900-184">Screen size (physically and in pixels)</span></span>
- <span data-ttu-id="6a900-185">支持的媒体和数据格式</span><span class="sxs-lookup"><span data-stu-id="6a900-185">Supported media and data formats</span></span>
- <span data-ttu-id="6a900-186">等等。</span><span class="sxs-lookup"><span data-stu-id="6a900-186">Etc.</span></span>

<span data-ttu-id="6a900-187">更好一些，因为做出决策基于特征与型号，则您将能够更好地处理的未来设备。</span><span class="sxs-lookup"><span data-stu-id="6a900-187">It's better to make decisions based on characteristics than model number, because then you'll be better equipped to handle future devices.</span></span>

### <a name="using-aspnets-built-in-browser-detection-support"></a><span data-ttu-id="6a900-188">使用 ASP。NET 的内置浏览器检测支持</span><span class="sxs-lookup"><span data-stu-id="6a900-188">Using ASP.NET's built-in browser detection support</span></span>

<span data-ttu-id="6a900-189">ASP.NET Web 窗体和 MVC 开发人员可以立即发现正在访问的浏览器的重要特征，通过检查的属性*Request.Browser*对象。</span><span class="sxs-lookup"><span data-stu-id="6a900-189">ASP.NET Web Forms and MVC developers can immediately discover important characteristics of a visiting browser by inspecting properties of the *Request.Browser* object.</span></span> <span data-ttu-id="6a900-190">有关示例，请参阅</span><span class="sxs-lookup"><span data-stu-id="6a900-190">For example, see</span></span>

- <span data-ttu-id="6a900-191">Request.Browser.IsMobileDevice</span><span class="sxs-lookup"><span data-stu-id="6a900-191">Request.Browser.IsMobileDevice</span></span>
- <span data-ttu-id="6a900-192">Request.Browser.MobileDeviceManufacturer Request.Browser.MobileDeviceModel</span><span class="sxs-lookup"><span data-stu-id="6a900-192">Request.Browser.MobileDeviceManufacturer, Request.Browser.MobileDeviceModel</span></span>
- <span data-ttu-id="6a900-193">Request.Browser.ScreenPixelsWidth</span><span class="sxs-lookup"><span data-stu-id="6a900-193">Request.Browser.ScreenPixelsWidth</span></span>
- <span data-ttu-id="6a900-194">Request.Browser.SupportsXmlHttp</span><span class="sxs-lookup"><span data-stu-id="6a900-194">Request.Browser.SupportsXmlHttp</span></span>
- <span data-ttu-id="6a900-195">...和许多其他</span><span class="sxs-lookup"><span data-stu-id="6a900-195">…and many others</span></span>

<span data-ttu-id="6a900-196">在后台，ASP.NET 平台匹配传入*用户代理*(UA) HTTP 标头与一系列浏览器定义 XML 文件中的正则表达式。</span><span class="sxs-lookup"><span data-stu-id="6a900-196">Behind the scenes, the ASP.NET platform matches the incoming *User-Agent* (UA) HTTP header against regular expressions in a set of Browser Definition XML files.</span></span> <span data-ttu-id="6a900-197">默认情况下该平台包括许多常见的移动设备的定义，并可以将自定义浏览器定义文件添加为其他人想要识别。</span><span class="sxs-lookup"><span data-stu-id="6a900-197">By default the platform includes definitions for many common mobile devices, and you can add custom Browser Definition files for others you wish to recognize.</span></span> <span data-ttu-id="6a900-198">有关更多详细信息，请参阅 MSDN 页面[ASP.NET Web 服务器控件和浏览器功能](https://msdn.microsoft.com/library/x3k2ssx2.aspx)。</span><span class="sxs-lookup"><span data-stu-id="6a900-198">For more details, see the MSDN page [ASP.NET Web Server Controls and Browser Capabilities](https://msdn.microsoft.com/library/x3k2ssx2.aspx).</span></span>

### <a name="using-the-wurfl-device-database-via-51degreesmobi-foundation"></a><span data-ttu-id="6a900-199">使用 WURFL 设备数据库通过 51Degrees.mobi Foundation</span><span class="sxs-lookup"><span data-stu-id="6a900-199">Using the WURFL device database via 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="6a900-200">尽管 ASP。NET 的内置浏览器检测的支持足以满足许多应用程序，有两种主要情况时它可能不够：</span><span class="sxs-lookup"><span data-stu-id="6a900-200">While ASP.NET's built-in browser detection support will be sufficient for many applications, there are two main cases when it might not be enough:</span></span>

- <span data-ttu-id="6a900-201">***你想要识别的最新设备***（而无需手动创建它们的浏览器定义文件）。</span><span class="sxs-lookup"><span data-stu-id="6a900-201">***You want to recognize the latest devices***(without manually creating Browser Definition files for them).</span></span> <span data-ttu-id="6a900-202">请注意.NET 4 的浏览器定义文件不是不够高，无法识别 Windows Phone 7、 Android 手机、 Opera Mobile 浏览器或 Apple Ipad。</span><span class="sxs-lookup"><span data-stu-id="6a900-202">Note that .NET 4's Browser Definition files are not recent enough to recognize Windows Phone 7, Android phones, Opera Mobile browsers, or Apple iPads.</span></span>
- <span data-ttu-id="6a900-203">***你需要有关设备功能的更多详细的信息***。</span><span class="sxs-lookup"><span data-stu-id="6a900-203">***You need more detailed information about device capabilities***.</span></span> <span data-ttu-id="6a900-204">可能需要了解的有关设备的输入法 （例如，触摸 vs 键盘），或哪些音频格式浏览器支持。</span><span class="sxs-lookup"><span data-stu-id="6a900-204">You may need to know about a device's input method (e.g., touch vs keypad), or what audio formats the browser supports.</span></span> <span data-ttu-id="6a900-205">在标准的浏览器定义文件中，此信息不可用。</span><span class="sxs-lookup"><span data-stu-id="6a900-205">This information isn't available in the standard Browser Definition files.</span></span>

<span data-ttu-id="6a900-206">[*无线通用资源文件*(WURFL) 项目](http://wurfl.sourceforge.net/)维护更多最新信息和详细信息中使用的移动设备有关今天。</span><span class="sxs-lookup"><span data-stu-id="6a900-206">The [*Wireless Universal Resource File* (WURFL) project](http://wurfl.sourceforge.net/) maintains much more up-to-date and detailed information about mobile devices in use today.</span></span>

<span data-ttu-id="6a900-207">面向.NET 开发人员欣慰的是该 ASP。NET 的浏览器检测功能是可扩展的因此可以增强它，以解决这些问题。</span><span class="sxs-lookup"><span data-stu-id="6a900-207">The great news for .NET developers is that ASP.NET's browser detection feature is extensible, so it's possible to enhance it to overcome these problems.</span></span> <span data-ttu-id="6a900-208">例如，可以添加开放源代码[ *51Degrees.mobi Foundation* ](https://github.com/51Degrees/dotNET-Device-Detection)到你的项目的库。</span><span class="sxs-lookup"><span data-stu-id="6a900-208">For example, you can add the open source [*51Degrees.mobi Foundation*](https://github.com/51Degrees/dotNET-Device-Detection) library to your project.</span></span> <span data-ttu-id="6a900-209">它是一个 ASP.NET IHttpModule 或浏览器功能提供程序 （Web 窗体和 MVC 应用程序上可用），直接读取 WURFL 数据并将其挂钩到 ASP。NET 的内置浏览器检测机制。</span><span class="sxs-lookup"><span data-stu-id="6a900-209">It's an ASP.NET IHttpModule or Browser Capabilities Provider (usable on both Web Forms and MVC applications), that directly reads WURFL data and hooks it into ASP.NET's built-in browser detection mechanism.</span></span> <span data-ttu-id="6a900-210">安装该模块后*Request.Browser*突然将包含更准确、 最详细的信息： 它将正确识别的许多设备如前面所述，并列出其功能 （包括其他功能等输入法）。</span><span class="sxs-lookup"><span data-stu-id="6a900-210">Once you've installed the module, *Request.Browser* will suddenly contain a lot more accurate and detailed information: it will correctly recognize many of the devices previously mentioned and list their capabilities (including additional capabilities such as input method).</span></span> <span data-ttu-id="6a900-211">请参阅更多详细信息的项目的文档。</span><span class="sxs-lookup"><span data-stu-id="6a900-211">See the project's documentation for more details.</span></span>

## <a name="how-web-forms-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="6a900-212">Web 窗体应用程序可以如何提供移动特定页</span><span class="sxs-lookup"><span data-stu-id="6a900-212">How Web Forms applications can present mobile-specific pages</span></span>

<span data-ttu-id="6a900-213">默认情况下，下面是一个全新的 Web 窗体应用程序常见移动设备上的显示方式：</span><span class="sxs-lookup"><span data-stu-id="6a900-213">By default, here's how a brand new Web Forms application displays on common mobile devices:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image1.png)

<span data-ttu-id="6a900-214">很明显，既不布局看起来非常适合移动应用-此页专为大型的、 面向布局的监视器，不适用于较小的面向纵向的屏幕。</span><span class="sxs-lookup"><span data-stu-id="6a900-214">Clearly, neither layout looks very mobile-friendly – this page was designed for a large, landscape-oriented monitor, not for a small portrait-oriented screen.</span></span> <span data-ttu-id="6a900-215">那么可以你如何做它？</span><span class="sxs-lookup"><span data-stu-id="6a900-215">So what can you do about it?</span></span>

<span data-ttu-id="6a900-216">如之前在本白皮书中所述，有很多种定制您的移动设备的页面。</span><span class="sxs-lookup"><span data-stu-id="6a900-216">As discussed earlier in this paper, there are many ways to tailor your pages for mobile devices.</span></span> <span data-ttu-id="6a900-217">一些技术是基于服务器的其他人在客户端上运行。</span><span class="sxs-lookup"><span data-stu-id="6a900-217">Some techniques are server-based, others run on the client.</span></span>

### <a name="creating-a-mobile-specific-master-page"></a><span data-ttu-id="6a900-218">创建移动特定的母版页</span><span class="sxs-lookup"><span data-stu-id="6a900-218">Creating a mobile-specific master page</span></span>

<span data-ttu-id="6a900-219">具体取决于您的需求，您可能能够使用相同的 Web 窗体的所有访问者，但有两个单独的主页面： 一个用于桌面的访问者、 另一个用于移动访问者。</span><span class="sxs-lookup"><span data-stu-id="6a900-219">Depending on your requirements, you may be able to use the same Web Forms for all visitors, but have two separate master pages: one for desktop visitors, another for mobile visitors.</span></span> <span data-ttu-id="6a900-220">这样，你可以灵活地更改的 CSS 样式表或你的顶级 HTML 标记以适应移动设备，而不会迫使您可以复制任何页面逻辑。</span><span class="sxs-lookup"><span data-stu-id="6a900-220">This gives you the flexibility of changing the CSS stylesheet or your top-level HTML markup to suit mobile devices, without forcing you to duplicate any page logic.</span></span>

<span data-ttu-id="6a900-221">这很容易地执行操作。</span><span class="sxs-lookup"><span data-stu-id="6a900-221">This is easy to do.</span></span> <span data-ttu-id="6a900-222">例如，可以将如下所示的 PreInit 处理程序添加到 Web 窗体：</span><span class="sxs-lookup"><span data-stu-id="6a900-222">For example, you can add a PreInit handler such as the following to a Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample1.cs)]

<span data-ttu-id="6a900-223">现在，创建主页面在应用程序的顶级文件夹中调用 Mobile.Master 和将检测到移动设备时使用它。</span><span class="sxs-lookup"><span data-stu-id="6a900-223">Now, create a master page called Mobile.Master in the top-level folder of your application, and it will be used when a mobile device is detected.</span></span> <span data-ttu-id="6a900-224">如有必要，移动母版页可以引用特定于移动的 CSS 样式表。</span><span class="sxs-lookup"><span data-stu-id="6a900-224">Your mobile master page can reference a mobile-specific CSS stylesheet if necessary.</span></span> <span data-ttu-id="6a900-225">桌面的访问者仍会看到默认主页面，一个不移动。</span><span class="sxs-lookup"><span data-stu-id="6a900-225">Desktop visitors will still see your default master page, not the mobile one.</span></span>

### <a name="creating-independent-mobile-specific-web-forms"></a><span data-ttu-id="6a900-226">创建独立的特定于移动 Web 窗体</span><span class="sxs-lookup"><span data-stu-id="6a900-226">Creating independent mobile-specific Web Forms</span></span>

<span data-ttu-id="6a900-227">最大的灵活性，可以进一步得比只让不同设备类型的单独主页面。</span><span class="sxs-lookup"><span data-stu-id="6a900-227">For maximum flexibility, you can go much further than just having separate master pages for different device types.</span></span> <span data-ttu-id="6a900-228">您可以实现两个*完全不同的 Web 窗体页集*– 一个为桌面浏览器设置，另一个为设置移动设备。</span><span class="sxs-lookup"><span data-stu-id="6a900-228">You can implement two *totally separate sets of Web Forms pages* – one set for desktop browsers, another set for mobiles.</span></span> <span data-ttu-id="6a900-229">此效果最佳，如果你想要向移动访客提供非常不同的信息或工作流。</span><span class="sxs-lookup"><span data-stu-id="6a900-229">This works best if you want to present very different information or workflows to mobile visitors.</span></span> <span data-ttu-id="6a900-230">本部分的其余部分将介绍这种方法在详细信息。</span><span class="sxs-lookup"><span data-stu-id="6a900-230">The rest of this section describes this approach in detail.</span></span>

<span data-ttu-id="6a900-231">假设已设计用于桌面浏览器的 Web 窗体应用程序，以继续操作的最简单方法是创建您的项目内名为"Mobile"的子文件夹和生成移动页面存在。</span><span class="sxs-lookup"><span data-stu-id="6a900-231">Assuming you already have a Web Forms application designed for desktop browsers, the easiest way to proceed is to create a subfolder called "Mobile" within your project, and build your mobile pages there.</span></span> <span data-ttu-id="6a900-232">您可以构造整个子站点，具有其自己的母版页、 样式表和页，使用完全相同，会使用任何其他 Web 窗体应用程序技术。</span><span class="sxs-lookup"><span data-stu-id="6a900-232">You can construct an entire sub-site, with its own master pages, style sheets, and pages, using all the same techniques that you'd use for any other Web Forms application.</span></span> <span data-ttu-id="6a900-233">您不一定要生成移动等效于*每个*在桌面网站页上，你可以选择哪些功能的子集有意义的移动访问者。</span><span class="sxs-lookup"><span data-stu-id="6a900-233">You don't necessarily need to produce a mobile equivalent for *every* page in your desktop site; you can choose what subset of functionality makes sense for mobile visitors.</span></span>

<span data-ttu-id="6a900-234">移动页面可以共享公共静态资源 (如图像、 JavaScript 或 CSS 文件) 如果你想在正则页面使用。</span><span class="sxs-lookup"><span data-stu-id="6a900-234">Your mobile pages can share common static resources (such as images, JavaScript, or CSS files) with your regular pages if you wish.</span></span> <span data-ttu-id="6a900-235">由于"Mobile"文件夹将*不*标记作为单独的应用程序时承载于 IIS （它是只是 Web 窗体页的简单子文件夹），它将还共享所有相同的配置、 会话数据和其他基础结构，即你桌面的页数。</span><span class="sxs-lookup"><span data-stu-id="6a900-235">Since your "Mobile" folder will *not* be marked as a separate application when hosted in IIS (it's just a simple subfolder of Web Forms pages), it will also share all the same configuration, Session data, and other infrastructure as your desktop pages.</span></span>

> [!NOTE]
> <span data-ttu-id="6a900-236">由于这种方法通常涉及一些重复代码 （移动页面有可能与桌面页面共享一些相似之处），务必分离出任何常见业务逻辑或数据访问代码到共享的基础层或服务。</span><span class="sxs-lookup"><span data-stu-id="6a900-236">Since this approach usually involves some duplication of code (mobile pages are likely to share some similarities with desktop pages), it's important to factor out any common business logic or data access code into a shared underlying layer or service.</span></span> <span data-ttu-id="6a900-237">否则，你将双精度的创建和维护你的应用程序的工作量。</span><span class="sxs-lookup"><span data-stu-id="6a900-237">Otherwise, you'll double the effort of creating and maintaining your application.</span></span>

#### <a name="redirecting-mobile-visitors-to-your-mobile-pages"></a><span data-ttu-id="6a900-238">重定向移动的访客移动页面</span><span class="sxs-lookup"><span data-stu-id="6a900-238">Redirecting mobile visitors to your mobile pages</span></span>

<span data-ttu-id="6a900-239">通常很方便为仅在重定向移动的访客移动页面*第一个*请求在其浏览会话中 （而不对其会话中的每个请求），因为：</span><span class="sxs-lookup"><span data-stu-id="6a900-239">It's often convenient to redirect mobile visitors to the mobile pages only on the *first* request in their browsing session (and not on every request in their session), because:</span></span>

- <span data-ttu-id="6a900-240">然后，您可以轻松地允许移动访问者可以根据自己的意愿 – 只需将链接放上将转到"桌面版本"到母版页访问桌面页面。</span><span class="sxs-lookup"><span data-stu-id="6a900-240">You can then easily allow mobile visitors to access your desktop pages if they wish – just put a link on your master page that goes to "Desktop version".</span></span> <span data-ttu-id="6a900-241">访问者不会重定向回到移动页，因为它不能再在第一个请求在其会话。</span><span class="sxs-lookup"><span data-stu-id="6a900-241">The visitor won't be redirected back to a mobile page, because it's no longer the first request in their session.</span></span>
- <span data-ttu-id="6a900-242">它可避免干扰 （例如，如果必须在你的网站的桌面和移动部件会显示在 IFRAME 中或某些 Ajax 处理程序的常见 Web 窗体） 的你的站点的桌面和移动部分之间共享的所有动态资源的请求的风险</span><span class="sxs-lookup"><span data-stu-id="6a900-242">It avoids the risk of interfering with requests for any dynamic resources shared between desktop and mobile parts of your site (e.g., if you have a common Web Form that both desktop and mobile parts of your site display in an IFRAME, or certain Ajax handlers)</span></span>

<span data-ttu-id="6a900-243">若要执行此操作，可以将放置在你重定向逻辑**会话\_启动**方法。</span><span class="sxs-lookup"><span data-stu-id="6a900-243">To do this, you can place your redirection logic in a **Session\_Start** method.</span></span> <span data-ttu-id="6a900-244">例如，将以下方法添加到 Global.asax.cs 文件：</span><span class="sxs-lookup"><span data-stu-id="6a900-244">For example, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample2.cs)]

#### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="6a900-245">配置窗体身份验证遵循移动页面</span><span class="sxs-lookup"><span data-stu-id="6a900-245">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="6a900-246">请注意窗体身份验证做出了假设，它可以将重定向访问者期间和之后的身份验证过程：</span><span class="sxs-lookup"><span data-stu-id="6a900-246">Note that Forms Authentication makes certain assumptions about where it can redirect visitors during and after the authentication process:</span></span>

- <span data-ttu-id="6a900-247">当用户需要进行身份验证时，窗体身份验证将它们重定向到您的桌面登录页，而不考虑它们是桌面或移动用户 (因为它仅有的概念*一个*登录 URL)。</span><span class="sxs-lookup"><span data-stu-id="6a900-247">When a user needs to be authenticated, Forms Authentication will redirect them to your desktop login page, regardless of whether they're a desktop or mobile user (because it only has a concept of *one* login URL).</span></span> <span data-ttu-id="6a900-248">假定你想要以不同方式设置您的移动登录页的样式，您需要增强您的桌面登录页，以便它将移动用户重定向到一个单独移动登录页面。</span><span class="sxs-lookup"><span data-stu-id="6a900-248">Assuming you want to style your mobile login page differently, you need to enhance your desktop login page so that it redirects mobile users to a separate mobile login page.</span></span> <span data-ttu-id="6a900-249">例如，以下代码添加到您**桌面**隐藏代码的登录页：</span><span class="sxs-lookup"><span data-stu-id="6a900-249">For example, add the following code to your **desktop** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample3.cs)]
- <span data-ttu-id="6a900-250">用户成功登录后，窗体身份验证将默认情况下将它们重定向到桌面的主页 (因为它仅有的概念*一个*默认页)。</span><span class="sxs-lookup"><span data-stu-id="6a900-250">After a user successfully logs in, Forms Authentication will by default redirect them to your desktop home page (because it only has a concept of *one* default page).</span></span> <span data-ttu-id="6a900-251">您需要增强您的移动登录页，以便它将重定向到移动主页后成功日志中。</span><span class="sxs-lookup"><span data-stu-id="6a900-251">You need to enhance your mobile login page so that it redirects to the mobile home page after a successful log-in.</span></span> <span data-ttu-id="6a900-252">例如，以下代码添加到您**移动**隐藏代码的登录页：</span><span class="sxs-lookup"><span data-stu-id="6a900-252">For example, add the following code to your **mobile** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample4.cs)]
  
  <span data-ttu-id="6a900-253">此代码假定您的页面具有名为 LoginUser，如下所示的默认项目模板的登录服务器控件。</span><span class="sxs-lookup"><span data-stu-id="6a900-253">This code assumes your page has a Login server control called LoginUser, as in the default project template.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="6a900-254">使用输出缓存</span><span class="sxs-lookup"><span data-stu-id="6a900-254">Working with Output Caching</span></span>

<span data-ttu-id="6a900-255">如果您使用输出缓存，请注意，默认情况下，它是桌面的用户可以访问特定 URL （导致要缓存其输出） 后, 跟然后接收缓存的桌面输出的移动用户。</span><span class="sxs-lookup"><span data-stu-id="6a900-255">If you're using output caching, beware that by default it's possible for a desktop user to visit a certain URL (causing its output to be cached), followed by a mobile user who then receives the cached desktop output.</span></span> <span data-ttu-id="6a900-256">无论是只是不同的主页面按设备类型，还是实现完全独立的 Web 窗体，每个设备类型，将应用此警告。</span><span class="sxs-lookup"><span data-stu-id="6a900-256">This warning applies whether you're just varying your master page by device type, or implementing totally separate Web Forms per device type.</span></span>

<span data-ttu-id="6a900-257">若要避免此问题，您可以指示 ASP.NET 来改变缓存项根据访问者是否正在使用移动设备。</span><span class="sxs-lookup"><span data-stu-id="6a900-257">To avoid the problem, you can instruct ASP.NET to vary the cache entry according to whether the visitor is using a mobile device.</span></span> <span data-ttu-id="6a900-258">将 VaryByCustom 参数添加到页面的 OutputCache 声明，如下所示：</span><span class="sxs-lookup"><span data-stu-id="6a900-258">Add a VaryByCustom parameter to your page's OutputCache declaration as follows:</span></span>

[!code-aspx[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample5.aspx)]

<span data-ttu-id="6a900-259">接下来，定义*isMobileDevice*作为自定义缓存参数通过添加以下方法重写到 Global.asax.cs 文件：</span><span class="sxs-lookup"><span data-stu-id="6a900-259">Next, define *isMobileDevice* as a custom cache parameter by adding the following method override to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample6.cs)]

<span data-ttu-id="6a900-260">这将确保移动到页面的访问者未收到以前桌面的访问者放入缓存的输出。</span><span class="sxs-lookup"><span data-stu-id="6a900-260">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="6a900-261">运行示例</span><span class="sxs-lookup"><span data-stu-id="6a900-261">A working example</span></span>

<span data-ttu-id="6a900-262">若要查看这些技术中操作，请下载[本白皮书的代码示例](https://docs.microsoft.com/aspnet/mobile/overview)。</span><span class="sxs-lookup"><span data-stu-id="6a900-262">To see these techniques in action, download [this white paper's code samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="6a900-263">Web 窗体示例应用程序自动重定向到一组特定于移动的页名为移动的子文件夹中的移动用户。</span><span class="sxs-lookup"><span data-stu-id="6a900-263">The Web Forms sample application automatically redirects mobile users to a set of mobile-specific pages in a subfolder called Mobile.</span></span> <span data-ttu-id="6a900-264">您可以看到与以下屏幕截图针对移动浏览器，更好地优化的标记和这些页面的样式：</span><span class="sxs-lookup"><span data-stu-id="6a900-264">The markup and styling of those pages is better optimized for mobile browsers, as you can see from the following screenshots:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image2.png)

<span data-ttu-id="6a900-265">有关针对移动浏览器优化您的标记和 CSS 的信息的更多技巧，请参阅"样式移动页针对移动浏览器"在本文档后面的部分。</span><span class="sxs-lookup"><span data-stu-id="6a900-265">For more tips about optimizing your markup and CSS for mobile browsers, see the section "Styling mobile pages for mobile browsers" later in this document.</span></span>

## <a name="how-aspnet-mvc-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="6a900-266">ASP.NET MVC 应用程序可以如何提供移动特定页</span><span class="sxs-lookup"><span data-stu-id="6a900-266">How ASP.NET MVC applications can present mobile-specific pages</span></span>

<span data-ttu-id="6a900-267">由于模型-视图-控制器模式将 （在控制器） （在视图中） 的表示逻辑从应用程序逻辑中分离出来，你可以处理在服务器端代码中的移动支持到选择从任何以下方法之一：</span><span class="sxs-lookup"><span data-stu-id="6a900-267">Since the Model-View-Controller pattern decouples application logic (in controllers) from presentation logic (in views), you can choose from any of the following approaches to handling mobile support in server-side code:</span></span>

1. <span data-ttu-id="6a900-268">\***对于桌面和移动浏览器，使用相同的控制器和视图，但呈现的视图具有不同的 Razor 布局，具体取决于设备类型\*。**</span><span class="sxs-lookup"><span data-stu-id="6a900-268">\***Use the same controllers and views for both desktop and mobile browsers, but render the views with different Razor layouts depending on the device type\*.**</span></span> <span data-ttu-id="6a900-269">如果要在所有设备上显示相同的数据，但只是想要提供不同的 CSS 样式表或更改的几个面向移动的顶级 HTML 元素，此选项效果最佳。</span><span class="sxs-lookup"><span data-stu-id="6a900-269">This option works best if you're displaying identical data on all devices, but simply want to supply different CSS stylesheets or change a few top-level HTML elements for mobiles.</span></span>
2. <span data-ttu-id="6a900-270">***对于桌面和移动浏览器，使用相同的控制器，但呈现不同的视图，具体取决于设备类型***。</span><span class="sxs-lookup"><span data-stu-id="6a900-270">***Use the same controllers for both desktop and mobile browsers, but render different views depending on the device type***.</span></span> <span data-ttu-id="6a900-271">如果您是显示大致相同的数据并提供相同的工作流对于最终用户，此选项效果最佳，但想要呈现非常不同的 HTML 标记，以满足所用设备。</span><span class="sxs-lookup"><span data-stu-id="6a900-271">This option works best if you're displaying roughly the same data and providing the same workflows for end users, but want to render very different HTML markup to suit the device being used.</span></span>
3. <span data-ttu-id="6a900-272">\***创建桌面和移动浏览器，为每个实现独立的控制器和视图的单独区域\*。**</span><span class="sxs-lookup"><span data-stu-id="6a900-272">\***Create separate areas for desktop and mobile browsers, implementing independent controllers and views for each\*.**</span></span> <span data-ttu-id="6a900-273">如果您是显示非常不同的屏幕、 包含不同的信息并导致用户针对其设备类型进行了优化的不同工作流完成时，此选项效果最佳。</span><span class="sxs-lookup"><span data-stu-id="6a900-273">This option works best if you're displaying very different screens, containing different information and leading the user through different workflows optimized for their device type.</span></span> <span data-ttu-id="6a900-274">这可能意味着一些重复代码，但你可以最小化它通过分离出常见逻辑到基础层或服务。</span><span class="sxs-lookup"><span data-stu-id="6a900-274">It may mean some repetition of code, but you can minimize that by factoring out common logic into an underlying layer or service.</span></span>

<span data-ttu-id="6a900-275">如果你想要采取**第一个**选项以及更改仅 Razor 布局每种设备类型，它是非常简单。</span><span class="sxs-lookup"><span data-stu-id="6a900-275">If you want to take the **first** option and vary only the Razor layout per device type, it's very easy.</span></span> <span data-ttu-id="6a900-276">只需修改你\_ViewStart.cshtml 文件，如下所示：</span><span class="sxs-lookup"><span data-stu-id="6a900-276">Just modify your \_ViewStart.cshtml file as follows:</span></span>

[!code-cshtml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample7.cshtml)]

<span data-ttu-id="6a900-277">现在，你可以创建一种称为移动特定布局\_LayoutMobile.cshtml 与页结构和 CSS 规则针对移动设备进行了优化。</span><span class="sxs-lookup"><span data-stu-id="6a900-277">Now you can create a mobile-specific layout called \_LayoutMobile.cshtml with a page structure and CSS rules optimized for mobile devices.</span></span>

<span data-ttu-id="6a900-278">如果你想要采取**第二个**选项根据访问者的设备类型的呈现器完全不同视图，请参阅[Scott Hanselman 的博客文章](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx)。</span><span class="sxs-lookup"><span data-stu-id="6a900-278">If you want to take the **second** option render totally different views according to the visitor's device type, see [Scott Hanselman's blog post](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx).</span></span>

<span data-ttu-id="6a900-279">本白皮书的其余部分重点介绍**第三个**选项 – 创建单独的控制器*和*移动设备 – 以便您可以控制完全移动访客提供哪些功能的子集的视图。</span><span class="sxs-lookup"><span data-stu-id="6a900-279">The rest of this paper focuses on the **third** option – creating separate controllers *and* views for mobile devices – so you can control exactly what subset of functionality is offered for mobile visitors.</span></span>

### <a name="setting-up-a-mobile-area-within-your-aspnet-mvc-application"></a><span data-ttu-id="6a900-280">在 ASP.NET MVC 应用程序中的移动区域设置</span><span class="sxs-lookup"><span data-stu-id="6a900-280">Setting up a Mobile area within your ASP.NET MVC application</span></span>

<span data-ttu-id="6a900-281">您可以添加以正常方式调用"移动"到现有的 ASP.NET MVC 应用程序的区域： 右键单击项目名称在解决方案资源管理器，然后选择添加-> 区域。</span><span class="sxs-lookup"><span data-stu-id="6a900-281">You can add an area called "Mobile" to an existing ASP.NET MVC application in the normal way: right-click on your project name in Solution Explorer, then choose Add à Area.</span></span> <span data-ttu-id="6a900-282">根据需要对 ASP.NET MVC 应用程序内的任何其他区域，然后可以添加控制器和视图。</span><span class="sxs-lookup"><span data-stu-id="6a900-282">You can then add controllers and views as you would for any other area within an ASP.NET MVC application.</span></span> <span data-ttu-id="6a900-283">例如，将添加到您移动的区域的新控制器名为 HomeController，将其用作主页移动访客。</span><span class="sxs-lookup"><span data-stu-id="6a900-283">For example, add to your Mobile area a new controller called HomeController to act as a homepage for mobile visitors.</span></span>

### <a name="ensuring-the-url-mobile-reaches-the-mobile-homepage"></a><span data-ttu-id="6a900-284">确保 URL 网站达到移动主页</span><span class="sxs-lookup"><span data-stu-id="6a900-284">Ensuring the URL /Mobile reaches the mobile homepage</span></span>

<span data-ttu-id="6a900-285">如果你想要访问在您移动的区域内 HomeController 的索引操作的 URL 网站，您需要对路由配置进行两个较小的更改。</span><span class="sxs-lookup"><span data-stu-id="6a900-285">If you want the URL /Mobile to reach the Index action on HomeController inside your Mobile area, you will need to make two small changes to your routing configuration.</span></span> <span data-ttu-id="6a900-286">首先，更新 MobileAreaRegistration 类以便 HomeController 默认控制器在您移动的区域，如下面的代码中所示：</span><span class="sxs-lookup"><span data-stu-id="6a900-286">First, update your MobileAreaRegistration class so that HomeController is the default controller in your Mobile area, as shown in the following code:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample8.cs)]

<span data-ttu-id="6a900-287">这意味着移动主页现在将位于的网站，而不是移动/主页，因为"Home"现在是隐式的移动页的默认控制器名称。</span><span class="sxs-lookup"><span data-stu-id="6a900-287">This means the mobile homepage will now be located at /Mobile, rather than /Mobile/Home, because "Home" is now the implicitly default controller name for mobile pages.</span></span>

<span data-ttu-id="6a900-288">接下来，请注意，通过将第二个 HomeController 添加到你的应用程序 （即，移动的一个，除了一个现有的桌面），在将已中断了常规桌面主页。</span><span class="sxs-lookup"><span data-stu-id="6a900-288">Next, note that by adding a second HomeController to your application (i.e., the mobile one, in addition to the existing desktop one), you'll have broken your regular desktop homepage.</span></span> <span data-ttu-id="6a900-289">它将失败并出现错误"*找到多个类型符合名为 Home 控制器*"。</span><span class="sxs-lookup"><span data-stu-id="6a900-289">It will fail with the error "*Multiple types were found that match the controller named 'Home'*".</span></span> <span data-ttu-id="6a900-290">若要解决此问题，更新顶层路由配置 （在 Global.asax.cs) 指定多义性时，桌面 HomeController 的执行优先级：</span><span class="sxs-lookup"><span data-stu-id="6a900-290">To resolve this, update your top-level routing configuration (in Global.asax.cs) to specify that your desktop HomeController should take priority when there's ambiguity:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample9.cs)]

<span data-ttu-id="6a900-291">现在，该错误会随手可得，，URL http:\/\/*yoursite*/ 桌面主页和 http 将到达：\/\/*yoursite*/mobile/ 将访问移动的主页。</span><span class="sxs-lookup"><span data-stu-id="6a900-291">Now the error will go away, and the URL http:\/\/*yoursite*/ will reach the desktop homepage, and http:\/\/*yoursite*/mobile/ will reach the mobile homepage.</span></span>

### <a name="redirecting-mobile-visitors-to-your-mobile-area"></a><span data-ttu-id="6a900-292">重定向到您移动的区域的移动访问者</span><span class="sxs-lookup"><span data-stu-id="6a900-292">Redirecting mobile visitors to your mobile area</span></span>

<span data-ttu-id="6a900-293">有许多不同的扩展点在 ASP.NET MVC 中，因此有许多种方法，以插入重定向逻辑。</span><span class="sxs-lookup"><span data-stu-id="6a900-293">There are many different extensibility points in ASP.NET MVC, so there are many possible ways to inject redirection logic.</span></span> <span data-ttu-id="6a900-294">一种巧妙方法是创建一个筛选器属性，[RedirectMobileDevicesToMobileArea] 执行的重定向，如果满足以下条件：</span><span class="sxs-lookup"><span data-stu-id="6a900-294">One neat option is to create a filter attribute, [RedirectMobileDevicesToMobileArea], that performs a redirection if the following conditions are met:</span></span>

1. <span data-ttu-id="6a900-295">它是用户的会话中的第一个请求 （即，Session.IsNewSession 等于 true）</span><span class="sxs-lookup"><span data-stu-id="6a900-295">It's the first request in the user's session (i.e., Session.IsNewSession equals true)</span></span>
2. <span data-ttu-id="6a900-296">请求来自移动浏览器 （即，Request.Browser.IsMobileDevice 等于 true）</span><span class="sxs-lookup"><span data-stu-id="6a900-296">The request comes from a mobile browser (i.e., Request.Browser.IsMobileDevice equals true)</span></span>
3. <span data-ttu-id="6a900-297">用户已不请求移动的区域中的资源 (即*路径*与网站的 URL 的一部分不会开始)</span><span class="sxs-lookup"><span data-stu-id="6a900-297">The user is not already requesting a resource in the mobile area (i.e., the *path* part of the URL does not begin with /Mobile)</span></span>

<span data-ttu-id="6a900-298">此白皮书随附的可下载示例包含一个实现，此逻辑。</span><span class="sxs-lookup"><span data-stu-id="6a900-298">The downloadable sample included with this white paper includes an implementation of this logic.</span></span> <span data-ttu-id="6a900-299">它作为授权筛选器，从 AuthorizeAttribute，这意味着它可以正常起作用，即使您使用输出缓存 （否则为如果桌面的访问者首次访问特定 URL，桌面输出可能会缓存，然后提供给派生实现后续移动访问者）。</span><span class="sxs-lookup"><span data-stu-id="6a900-299">It's implemented as an authorization filter, derived from AuthorizeAttribute, which means it can work correctly even if you are using output caching (otherwise, if a desktop visitor first accesses a certain URL, the desktop output might be cached and then served to subsequent mobile visitors).</span></span>

<span data-ttu-id="6a900-300">由于它是一个筛选器，您可以选择将其应用到特定控制器和操作，例如，</span><span class="sxs-lookup"><span data-stu-id="6a900-300">As it's a filter, you can choose either to apply it to specific controllers and actions, e.g.,</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample10.cs)]

<span data-ttu-id="6a900-301">…</span><span class="sxs-lookup"><span data-stu-id="6a900-301">…</span></span> <span data-ttu-id="6a900-302">也可以为 MVC 3 应用它的所有控制器和操作*全局筛选器*Global.asax.cs 文件中：</span><span class="sxs-lookup"><span data-stu-id="6a900-302">or you can apply it to all controllers and actions as an MVC 3 *global filter* in your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample11.cs)]

<span data-ttu-id="6a900-303">可下载的示例还演示了如何创建此属性将重定向到您移动的区域中的特定位置的子类。</span><span class="sxs-lookup"><span data-stu-id="6a900-303">The downloadable sample also demonstrates how you can create subclasses of this attribute that redirect to specific locations within your mobile area.</span></span> <span data-ttu-id="6a900-304">例如，这意味着您可以：</span><span class="sxs-lookup"><span data-stu-id="6a900-304">This means, for example, you can:</span></span>

- <span data-ttu-id="6a900-305">注册全局筛选器如下所示更高版本，默认情况下发送到移动主页的移动访问者。</span><span class="sxs-lookup"><span data-stu-id="6a900-305">Register a global filter as shown above that sends mobile visitors to the mobile homepage by default.</span></span>
- <span data-ttu-id="6a900-306">也适用于采用移动到具有请求的任何产品页面的移动版本的访问者的"查看产品"操作的特殊 [RedirectMobileDevicesToMobileProductPage] 筛选器。</span><span class="sxs-lookup"><span data-stu-id="6a900-306">Also apply a special [RedirectMobileDevicesToMobileProductPage] filter to a "view product" action that takes mobile visitors to the mobile version of whatever product page they had requested.</span></span>
- <span data-ttu-id="6a900-307">也适用于特定操作，将重定向到等效的移动页的移动访问者的筛选器的其他特殊子类</span><span class="sxs-lookup"><span data-stu-id="6a900-307">Also apply other special subclasses of the filter to specific actions, redirecting mobile visitors to the equivalent mobile page</span></span>

### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="6a900-308">配置窗体身份验证遵循移动页面</span><span class="sxs-lookup"><span data-stu-id="6a900-308">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="6a900-309">如果使用的窗体身份验证，则应注意，当用户需要登录时，它会自动将用户重定向到单个特定"登录"的 URL，即默认情况下 **/帐户/登录**。</span><span class="sxs-lookup"><span data-stu-id="6a900-309">If you're using Forms Authentication, you should note that when a user needs to log in, it automatically redirects the user to a single specific "log on" URL, which by default is **/Account/LogOn**.</span></span> <span data-ttu-id="6a900-310">这意味着可能会移动用户重定向到你的桌面"登录"操作。</span><span class="sxs-lookup"><span data-stu-id="6a900-310">This means that mobile users may be redirected to your desktop "log on" action.</span></span>

<span data-ttu-id="6a900-311">若要避免此问题，请将逻辑添加到桌面"登录"操作，以便它将重定向移动用户再次到"登录"的移动操作。</span><span class="sxs-lookup"><span data-stu-id="6a900-311">To avoid this problem, add logic to your desktop "log on" action so that it redirects mobile users again to a mobile "log on" action.</span></span> <span data-ttu-id="6a900-312">如果使用默认 ASP.NET MVC 应用程序模板，请按如下所示更新 AccountController 的登录操作：</span><span class="sxs-lookup"><span data-stu-id="6a900-312">If you're using the default ASP.NET MVC application template, update AccountController's LogOn action as follows:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample12.cs)]

<span data-ttu-id="6a900-313">…</span><span class="sxs-lookup"><span data-stu-id="6a900-313">…</span></span> <span data-ttu-id="6a900-314">然后在您移动的区域中称为 AccountController 的控制器上实现一个适合移动特定"登录"操作。</span><span class="sxs-lookup"><span data-stu-id="6a900-314">and then implement a suitable mobile-specific "log on" action on a controller called AccountController in your Mobile area.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="6a900-315">使用输出缓存</span><span class="sxs-lookup"><span data-stu-id="6a900-315">Working with Output Caching</span></span>

<span data-ttu-id="6a900-316">如果你使用 [OutputCache] 筛选器，必须强制执行要因设备类型的缓存项。</span><span class="sxs-lookup"><span data-stu-id="6a900-316">If you're using the [OutputCache] filter, you must force the cache entry to vary by device type.</span></span> <span data-ttu-id="6a900-317">例如，编写：</span><span class="sxs-lookup"><span data-stu-id="6a900-317">For example, write:</span></span>

[!code-javascript[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample13.js)]

<span data-ttu-id="6a900-318">然后，将以下方法添加到 Global.asax.cs 文件：</span><span class="sxs-lookup"><span data-stu-id="6a900-318">Then, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample14.cs)]

<span data-ttu-id="6a900-319">这将确保移动到页面的访问者未收到以前桌面的访问者放入缓存的输出。</span><span class="sxs-lookup"><span data-stu-id="6a900-319">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="6a900-320">运行示例</span><span class="sxs-lookup"><span data-stu-id="6a900-320">A working example</span></span>

<span data-ttu-id="6a900-321">若要查看这些技术中操作，请下载[此白皮书代码关联示例](https://docs.microsoft.com/aspnet/mobile/overview)。</span><span class="sxs-lookup"><span data-stu-id="6a900-321">To see these techniques in action, download [this white paper's code associated samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="6a900-322">此示例包含了增强，可支持移动设备使用上面所述的方法的 ASP.NET MVC 3 （候选发布） 应用程序。</span><span class="sxs-lookup"><span data-stu-id="6a900-322">The sample includes an ASP.NET MVC 3 (Release Candidate) application enhanced to support mobile devices using the methods described above.</span></span>

## <a name="further-guidance-and-suggestions"></a><span data-ttu-id="6a900-323">更多指导和建议</span><span class="sxs-lookup"><span data-stu-id="6a900-323">Further guidance and suggestions</span></span>

<span data-ttu-id="6a900-324">下面的讨论同时适用于 Web 窗体和 MVC 开发人员使用本文档中介绍的技术。</span><span class="sxs-lookup"><span data-stu-id="6a900-324">The following discussion applies both to Web Forms and MVC developers who are using the techniques covered in this document.</span></span>

### <a name="enhancing-your-redirection-logic-using-51degreesmobi-foundation"></a><span data-ttu-id="6a900-325">增强你使用 51Degrees.mobi Foundation 的重定向逻辑</span><span class="sxs-lookup"><span data-stu-id="6a900-325">Enhancing your redirection logic using 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="6a900-326">本文档中所示的重定向逻辑可以完全满足您的应用程序，但它不起作用，如果你需要禁用会话，或与拒绝 （它们不能具有会话） cookie，因为它不会知道是否给定请求的移动浏览器第一个从该访问者。</span><span class="sxs-lookup"><span data-stu-id="6a900-326">The redirection logic shown in this document may be perfectly sufficient for your application, but it won't work if you need to disable sessions, or with mobile browsers that reject cookies (these can't have sessions), because it won't know whether a given request is the first one from that visitor.</span></span>

<span data-ttu-id="6a900-327">您已经了解开放源代码 51Degrees.mobi Foundation 可以如何改进 ASP 的准确性。NET 的浏览器检测。</span><span class="sxs-lookup"><span data-stu-id="6a900-327">You already learned how the open source 51Degrees.mobi Foundation can improve the accuracy of ASP.NET's browser detection.</span></span> <span data-ttu-id="6a900-328">它还具有一项内置功能将重定向到在 Web.config 中配置的特定位置的移动访问者。可以在无需具体取决于 ASP.NET 会话 (并因此 cookie) 通过将存储的哈希值的访问者的 HTTP 标头和 IP 地址的临时日志，因此它知道每个请求是否是从给定见的第一个。</span><span class="sxs-lookup"><span data-stu-id="6a900-328">It also has a built-in ability to redirect mobile visitors to specific locations configured in Web.config. It's able to work without depending on ASP.NET Sessions (and hence cookies) by storing a temporary log of hashes of visitors' HTTP headers and IP addresses, so it knows whether or not each request is the first one from a given vistor.</span></span>

<span data-ttu-id="6a900-329">以下元素添加到 web.config 文件的 fiftyOne 部分将重定向到的页检测到的移动设备从第一个请求 ~ / Mobile/Default.aspx。</span><span class="sxs-lookup"><span data-stu-id="6a900-329">The following element added to the fiftyOne section of the web.config file will redirect the first request from a detected mobile device to the page ~/Mobile/Default.aspx.</span></span> <span data-ttu-id="6a900-330">对移动文件夹下的页面的任何请求将*不*重定向，而不考虑设备类型。</span><span class="sxs-lookup"><span data-stu-id="6a900-330">Any requests to pages under the Mobile folder will *not* be redirected, regardless of device type.</span></span> <span data-ttu-id="6a900-331">如果移动设备已被一段非活动状态 20 分钟或更多设备的系统将忘记和后续请求将被视为新的重定向的目的。</span><span class="sxs-lookup"><span data-stu-id="6a900-331">If the mobile device has been inactive for a period of 20 minutes or more the device will be forgotten and subsequent requests will be treated as new ones for the purposes of redirection.</span></span>

[!code-xml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample15.xml)]

<span data-ttu-id="6a900-332">有关更多详细信息，请参阅[51degrees.mobi Foundation 文档](https://github.com/51Degrees/dotNET-Device-Detection)。</span><span class="sxs-lookup"><span data-stu-id="6a900-332">For more details, see [51degrees.mobi Foundation documentation](https://github.com/51Degrees/dotNET-Device-Detection).</span></span>

> [!NOTE]
> <span data-ttu-id="6a900-333">您*可以*使用 51Degrees.mobi Foundation 重定向功能在 ASP.NET MVC 应用程序，但您将需要定义您在普通的 Url，不是作为路由参数或通过将置于 MVC 筛选器方面的重定向配置上的操作。</span><span class="sxs-lookup"><span data-stu-id="6a900-333">You *can* use 51Degrees.mobi Foundation's redirection feature on ASP.NET MVC applications, but you will need to define your redirection configuration in terms of plain URLs, not in terms of routing parameters or by putting MVC filters on actions.</span></span> <span data-ttu-id="6a900-334">这是因为 （在撰写本文时） 51Degrees.mobi Foundation 不能识别筛选器或路由。</span><span class="sxs-lookup"><span data-stu-id="6a900-334">This is because (at the time of writing) 51Degrees.mobi Foundation does not recognize filters or routing.</span></span>

### <a name="disabling-transcoders-and-proxy-servers"></a><span data-ttu-id="6a900-335">禁用转码器和代理服务器</span><span class="sxs-lookup"><span data-stu-id="6a900-335">Disabling Transcoders and Proxy Servers</span></span>

<span data-ttu-id="6a900-336">移动网络运营商在其移动 internet 方法中具有两个广泛的目标：</span><span class="sxs-lookup"><span data-stu-id="6a900-336">Mobile network operators have two broad objectives in their approach to the mobile internet:</span></span>

1. <span data-ttu-id="6a900-337">提供作为尽可能得多相关内容</span><span class="sxs-lookup"><span data-stu-id="6a900-337">Provide as much relevant content as possible</span></span>
2. <span data-ttu-id="6a900-338">最大程度提高可共享的有限的广播网络带宽的客户数</span><span class="sxs-lookup"><span data-stu-id="6a900-338">Maximize the number of customers who can share the limited radio network bandwidth</span></span>

<span data-ttu-id="6a900-339">由于大多数 web 页面为大尺寸桌面屏幕和快速修复行宽带连接设计，使用很多运算符*转码器*或*代理服务器*动态更改 web 内容。</span><span class="sxs-lookup"><span data-stu-id="6a900-339">Since most web pages were designed for large desktop-sized screens and fast fixed-line broadband connections, many operators use *transcoders* or *proxy servers* that dynamically alter web content.</span></span> <span data-ttu-id="6a900-340">它们可能会修改你的 HTML 标记或 CSS 以适合较小的屏幕 （尤其是对于"功能手机"缺少的处理能力来处理复杂的布局的），并且它们可能会重新压缩映像 （显著减少其质量） 以提高页传递速度。</span><span class="sxs-lookup"><span data-stu-id="6a900-340">They may modify your HTML markup or CSS to suit smaller screens (especially for "feature phones" that lack the processing power to handle complex layouts), and they may recompress your images (significantly reducing their quality) to improve page delivery speeds.</span></span>

<span data-ttu-id="6a900-341">但如果您执行了生成移动优化你的站点版本的工作，您可能不希望要进行干预任何进一步的网络运算符。</span><span class="sxs-lookup"><span data-stu-id="6a900-341">But if you've taken the effort to produce a mobile-optimized version of your site, you probably don't want the network operator to interfere with it any further.</span></span> <span data-ttu-id="6a900-342">可以将以下行添加到页面\_任何 ASP.NET Web 窗体中的 Load 事件：</span><span class="sxs-lookup"><span data-stu-id="6a900-342">You can add the following line to the Page\_Load event in any ASP.NET Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample16.cs)]

<span data-ttu-id="6a900-343">或者，为 ASP.NET MVC 控制器，你可以添加以下方法重写，以便它适用于该控制器上的所有操作：</span><span class="sxs-lookup"><span data-stu-id="6a900-343">Or, for an ASP.NET MVC controller, you could add the following method override so that it applies to all actions on that controller:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample17.cs)]

<span data-ttu-id="6a900-344">生成的 HTTP 消息通知 W3C 兼容转码器和代理服务器不以更改内容。</span><span class="sxs-lookup"><span data-stu-id="6a900-344">The resulting HTTP message informs W3C compliant transcoders and proxies not to alter content.</span></span> <span data-ttu-id="6a900-345">当然，就移动网络运营商将遵守此消息不能保证。</span><span class="sxs-lookup"><span data-stu-id="6a900-345">Of course, there is no guarantee that mobile network operators will respect this message.</span></span>

### <a name="styling-mobile-pages-for-mobile-browsers"></a><span data-ttu-id="6a900-346">针对移动浏览器样式移动页面</span><span class="sxs-lookup"><span data-stu-id="6a900-346">Styling mobile pages for mobile browsers</span></span>

<span data-ttu-id="6a900-347">它不在范围内的此文档，以详细说明哪些类型的 HTML 标记工作正确或哪些 web 设计技术最大限度地在特定设备上的可用性。</span><span class="sxs-lookup"><span data-stu-id="6a900-347">It's beyond the scope of this document to describe in great detail what kinds of HTML markup work correctly or which web design techniques maximize usability on particular devices.</span></span> <span data-ttu-id="6a900-348">它已经注册到你要查找足够简单的布局，优化移动大小的屏幕，而无需使用不可靠 HTML 或 CSS 定位技巧。</span><span class="sxs-lookup"><span data-stu-id="6a900-348">It's up to you to find a sufficiently simple layout, optimized for a mobile-sized screen, without using unreliable HTML or CSS positioning tricks.</span></span> <span data-ttu-id="6a900-349">但是，是一个重要的技术，值得一提的是，*视区 meta 标记*。</span><span class="sxs-lookup"><span data-stu-id="6a900-349">One important technique worth mentioning, however, is the *viewport meta tag*.</span></span>

<span data-ttu-id="6a900-350">某些新型移动浏览器，适用于桌面监视器，工作量显示网页中的呈现在虚拟的画布上，也称为"视区"页面 （例如，虚拟视区是 980 像素宽，在 iPhone 和 850 像素宽 Opera Mobile 在默认情况下），然后缩减结果以适合屏幕的物理像素。</span><span class="sxs-lookup"><span data-stu-id="6a900-350">Certain modern mobile browsers, in an effort display web pages meant for desktop monitors, render the page on a virtual canvas, also called "viewport" (e.g., the virtual viewport is 980 pixels wide on iPhone, and 850 pixels wide on Opera Mobile by default) and then scale the result down to fit onto the screen's physical pixels.</span></span> <span data-ttu-id="6a900-351">用户可以然后缩放和平移围绕该视区。</span><span class="sxs-lookup"><span data-stu-id="6a900-351">The user can then zoom in and pan around that viewport.</span></span> <span data-ttu-id="6a900-352">这样做的好处，它允许在其预期布局中显示页面的浏览器，但它也是具有它会强制缩放和平移，这对于用户是不方便的缺点。</span><span class="sxs-lookup"><span data-stu-id="6a900-352">This has the advantage that it lets the browser display the page in its intended layout, but it's also has the disadvantage that it forces zooming and panning, which is inconvenient for the user.</span></span> <span data-ttu-id="6a900-353">如果您正在设计的移动，最好是设计为窄的屏幕，以便有必要采取任何缩放或水平滚动。</span><span class="sxs-lookup"><span data-stu-id="6a900-353">If you're designing for mobile, it's better to design for a narrow screen so that no zooming or horizontal scrolling is necessary.</span></span>

<span data-ttu-id="6a900-354">指出在移动浏览器宽度应是视区的方法是通过使用了非标准*视区*meta 标记。</span><span class="sxs-lookup"><span data-stu-id="6a900-354">A way to tell the mobile browser how wide the viewport should be is through the nonstandard *viewport* meta tag.</span></span> <span data-ttu-id="6a900-355">例如，如果您将以下代码添加到页面的 HEAD 部分中，</span><span class="sxs-lookup"><span data-stu-id="6a900-355">For example, if you add the following to your page's HEAD section,</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample18.html)]

<span data-ttu-id="6a900-356">…</span><span class="sxs-lookup"><span data-stu-id="6a900-356">…</span></span> <span data-ttu-id="6a900-357">然后支持智能手机浏览器将布局 480 像素范围虚拟画布上的页面。</span><span class="sxs-lookup"><span data-stu-id="6a900-357">then supporting smartphone browsers will lay out the page on a 480-pixel wide virtual canvas.</span></span> <span data-ttu-id="6a900-358">这意味着，如果你的 HTML 元素以百分比表示定义其宽度，百分比将解释相对于此 480 像素宽度，不默认视区宽度。</span><span class="sxs-lookup"><span data-stu-id="6a900-358">This means that if your HTML elements define their widths in percentage terms, the percentages will be interpreted with respect to this 480-pixel width, not the default viewport width.</span></span> <span data-ttu-id="6a900-359">因此，用户很少需要缩放和平移水平 – 显著提高的移动浏览体验。</span><span class="sxs-lookup"><span data-stu-id="6a900-359">As a result, the user is less likely to have to zoom and pan horizontally – considerably improving the mobile browsing experience.</span></span>

<span data-ttu-id="6a900-360">如果你想要匹配设备的物理像素的视区宽度，您可以指定以下各项：</span><span class="sxs-lookup"><span data-stu-id="6a900-360">If you want the viewport width to match the device's physical pixels, you can specify the following:</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample19.html)]

<span data-ttu-id="6a900-361">此才能正常工作，您必须显式强制元素超过该宽度 (例如，使用*宽度*属性或 CSS 属性)，否则在浏览器将强制使用更大的视区而不考虑。</span><span class="sxs-lookup"><span data-stu-id="6a900-361">For this to work correctly, you must not explicitly force elements to exceed that width (e.g., using a *width* attribute or CSS property), otherwise the browser will be forced to use a larger viewport regardless.</span></span> <span data-ttu-id="6a900-362">另请参阅：[更多详细信息使用了非标准的视区标记](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html)。</span><span class="sxs-lookup"><span data-stu-id="6a900-362">See also: [more details about the nonstandard viewport tag](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html).</span></span>

<span data-ttu-id="6a900-363">支持大多数现代智能手机*双方向*： 它们可以保存在纵向或横向模式中。</span><span class="sxs-lookup"><span data-stu-id="6a900-363">Most modern smartphones support *dual orientation*: they can be held in either portrait or landscape mode.</span></span> <span data-ttu-id="6a900-364">因此，务必不要假设屏幕宽度以像素为单位。</span><span class="sxs-lookup"><span data-stu-id="6a900-364">So, it's important not to make assumptions about the screen width in pixels.</span></span> <span data-ttu-id="6a900-365">不要甚至假设屏幕宽度的固定不变，因为用户可以在页面上，则重定向其设备。</span><span class="sxs-lookup"><span data-stu-id="6a900-365">Don't even assume that the screen width is fixed, because the user can re-orient their device while they are on your page.</span></span>

<span data-ttu-id="6a900-366">页标头以通知其内容中的以下元标记已针对移动进行优化，因此不应转换，可能会也接受较旧的 Windows Mobile 和 Blackberry 设备。</span><span class="sxs-lookup"><span data-stu-id="6a900-366">Older Windows Mobile and Blackberry devices may also accept the following meta tags in the page header to inform them content has been optimized for mobile and therefore should not be transformed.</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample20.html)]

## <a name="additional-resources"></a><span data-ttu-id="6a900-367">其他资源</span><span class="sxs-lookup"><span data-stu-id="6a900-367">Additional Resources</span></span>

<span data-ttu-id="6a900-368">有关移动设备仿真程序和模拟器可用于测试移动的 ASP.NET web 应用程序的列表，请参阅页面[模拟常用移动设备进行测试](../mobile/device-simulators.md)。</span><span class="sxs-lookup"><span data-stu-id="6a900-368">For a list of mobile device emulators and simulators you can use to test your mobile ASP.NET web application, see the page [Simulate popular mobile devices for testing](../mobile/device-simulators.md).</span></span>

## <a name="credits"></a><span data-ttu-id="6a900-369">信用</span><span class="sxs-lookup"><span data-stu-id="6a900-369">Credits</span></span>

- <span data-ttu-id="6a900-370">主要作者：Steven Sanderson</span><span class="sxs-lookup"><span data-stu-id="6a900-370">Primary author: Steven Sanderson</span></span>
- <span data-ttu-id="6a900-371">审阅者 / 其他内容编写器：James Rosewell, Mikael Söderström, Scott Hanselman, Scott Hunter</span><span class="sxs-lookup"><span data-stu-id="6a900-371">Reviewers / additional content writers: James Rosewell, Mikael Söderström, Scott Hanselman, Scott Hunter</span></span>
